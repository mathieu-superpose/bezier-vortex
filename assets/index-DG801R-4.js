(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const a of s.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&n(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();function x1(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var GM={exports:{}},bv={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MC;function sF(){if(MC)return bv;MC=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function t(n,i,s){var a=null;if(s!==void 0&&(a=""+s),i.key!==void 0&&(a=""+i.key),"key"in i){s={};for(var l in i)l!=="key"&&(s[l]=i[l])}else s=i;return i=s.ref,{$$typeof:r,type:n,key:a,ref:i!==void 0?i:null,props:s}}return bv.Fragment=e,bv.jsx=t,bv.jsxs=t,bv}var EC;function rF(){return EC||(EC=1,GM.exports=sF()),GM.exports}var xi=rF(),HM={exports:{}},vn={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AC;function aF(){if(AC)return vn;AC=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),i=Symbol.for("react.profiler"),s=Symbol.for("react.consumer"),a=Symbol.for("react.context"),l=Symbol.for("react.forward_ref"),c=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),m=Symbol.for("react.lazy"),y=Symbol.iterator;function v(X){return X===null||typeof X!="object"?null:(X=y&&X[y]||X["@@iterator"],typeof X=="function"?X:null)}var x={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},S=Object.assign,A={};function E(X,re,we){this.props=X,this.context=re,this.refs=A,this.updater=we||x}E.prototype.isReactComponent={},E.prototype.setState=function(X,re){if(typeof X!="object"&&typeof X!="function"&&X!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,X,re,"setState")},E.prototype.forceUpdate=function(X){this.updater.enqueueForceUpdate(this,X,"forceUpdate")};function M(){}M.prototype=E.prototype;function C(X,re,we){this.props=X,this.context=re,this.refs=A,this.updater=we||x}var w=C.prototype=new M;w.constructor=C,S(w,E.prototype),w.isPureReactComponent=!0;var D=Array.isArray,z={H:null,A:null,T:null,S:null,V:null},B=Object.prototype.hasOwnProperty;function F(X,re,we,Fe,oe,De){return we=De.ref,{$$typeof:r,type:X,key:re,ref:we!==void 0?we:null,props:De}}function H(X,re){return F(X.type,re,void 0,void 0,void 0,X.props)}function I(X){return typeof X=="object"&&X!==null&&X.$$typeof===r}function P(X){var re={"=":"=0",":":"=2"};return"$"+X.replace(/[=:]/g,function(we){return re[we]})}var Z=/\/+/g;function ue(X,re){return typeof X=="object"&&X!==null&&X.key!=null?P(""+X.key):re.toString(36)}function se(){}function pe(X){switch(X.status){case"fulfilled":return X.value;case"rejected":throw X.reason;default:switch(typeof X.status=="string"?X.then(se,se):(X.status="pending",X.then(function(re){X.status==="pending"&&(X.status="fulfilled",X.value=re)},function(re){X.status==="pending"&&(X.status="rejected",X.reason=re)})),X.status){case"fulfilled":return X.value;case"rejected":throw X.reason}}throw X}function Se(X,re,we,Fe,oe){var De=typeof X;(De==="undefined"||De==="boolean")&&(X=null);var je=!1;if(X===null)je=!0;else switch(De){case"bigint":case"string":case"number":je=!0;break;case"object":switch(X.$$typeof){case r:case e:je=!0;break;case m:return je=X._init,Se(je(X._payload),re,we,Fe,oe)}}if(je)return oe=oe(X),je=Fe===""?"."+ue(X,0):Fe,D(oe)?(we="",je!=null&&(we=je.replace(Z,"$&/")+"/"),Se(oe,re,we,"",function(nn){return nn})):oe!=null&&(I(oe)&&(oe=H(oe,we+(oe.key==null||X&&X.key===oe.key?"":(""+oe.key).replace(Z,"$&/")+"/")+je)),re.push(oe)),1;je=0;var nt=Fe===""?".":Fe+":";if(D(X))for(var lt=0;lt<X.length;lt++)Fe=X[lt],De=nt+ue(Fe,lt),je+=Se(Fe,re,we,De,oe);else if(lt=v(X),typeof lt=="function")for(X=lt.call(X),lt=0;!(Fe=X.next()).done;)Fe=Fe.value,De=nt+ue(Fe,lt++),je+=Se(Fe,re,we,De,oe);else if(De==="object"){if(typeof X.then=="function")return Se(pe(X),re,we,Fe,oe);throw re=String(X),Error("Objects are not valid as a React child (found: "+(re==="[object Object]"?"object with keys {"+Object.keys(X).join(", ")+"}":re)+"). If you meant to render a collection of children, use an array instead.")}return je}function V(X,re,we){if(X==null)return X;var Fe=[],oe=0;return Se(X,Fe,"","",function(De){return re.call(we,De,oe++)}),Fe}function Q(X){if(X._status===-1){var re=X._result;re=re(),re.then(function(we){(X._status===0||X._status===-1)&&(X._status=1,X._result=we)},function(we){(X._status===0||X._status===-1)&&(X._status=2,X._result=we)}),X._status===-1&&(X._status=0,X._result=re)}if(X._status===1)return X._result.default;throw X._result}var J=typeof reportError=="function"?reportError:function(X){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var re=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof X=="object"&&X!==null&&typeof X.message=="string"?String(X.message):String(X),error:X});if(!window.dispatchEvent(re))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",X);return}console.error(X)};function ve(){}return vn.Children={map:V,forEach:function(X,re,we){V(X,function(){re.apply(this,arguments)},we)},count:function(X){var re=0;return V(X,function(){re++}),re},toArray:function(X){return V(X,function(re){return re})||[]},only:function(X){if(!I(X))throw Error("React.Children.only expected to receive a single React element child.");return X}},vn.Component=E,vn.Fragment=t,vn.Profiler=i,vn.PureComponent=C,vn.StrictMode=n,vn.Suspense=c,vn.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=z,vn.__COMPILER_RUNTIME={__proto__:null,c:function(X){return z.H.useMemoCache(X)}},vn.cache=function(X){return function(){return X.apply(null,arguments)}},vn.cloneElement=function(X,re,we){if(X==null)throw Error("The argument must be a React element, but you passed "+X+".");var Fe=S({},X.props),oe=X.key,De=void 0;if(re!=null)for(je in re.ref!==void 0&&(De=void 0),re.key!==void 0&&(oe=""+re.key),re)!B.call(re,je)||je==="key"||je==="__self"||je==="__source"||je==="ref"&&re.ref===void 0||(Fe[je]=re[je]);var je=arguments.length-2;if(je===1)Fe.children=we;else if(1<je){for(var nt=Array(je),lt=0;lt<je;lt++)nt[lt]=arguments[lt+2];Fe.children=nt}return F(X.type,oe,void 0,void 0,De,Fe)},vn.createContext=function(X){return X={$$typeof:a,_currentValue:X,_currentValue2:X,_threadCount:0,Provider:null,Consumer:null},X.Provider=X,X.Consumer={$$typeof:s,_context:X},X},vn.createElement=function(X,re,we){var Fe,oe={},De=null;if(re!=null)for(Fe in re.key!==void 0&&(De=""+re.key),re)B.call(re,Fe)&&Fe!=="key"&&Fe!=="__self"&&Fe!=="__source"&&(oe[Fe]=re[Fe]);var je=arguments.length-2;if(je===1)oe.children=we;else if(1<je){for(var nt=Array(je),lt=0;lt<je;lt++)nt[lt]=arguments[lt+2];oe.children=nt}if(X&&X.defaultProps)for(Fe in je=X.defaultProps,je)oe[Fe]===void 0&&(oe[Fe]=je[Fe]);return F(X,De,void 0,void 0,null,oe)},vn.createRef=function(){return{current:null}},vn.forwardRef=function(X){return{$$typeof:l,render:X}},vn.isValidElement=I,vn.lazy=function(X){return{$$typeof:m,_payload:{_status:-1,_result:X},_init:Q}},vn.memo=function(X,re){return{$$typeof:d,type:X,compare:re===void 0?null:re}},vn.startTransition=function(X){var re=z.T,we={};z.T=we;try{var Fe=X(),oe=z.S;oe!==null&&oe(we,Fe),typeof Fe=="object"&&Fe!==null&&typeof Fe.then=="function"&&Fe.then(ve,J)}catch(De){J(De)}finally{z.T=re}},vn.unstable_useCacheRefresh=function(){return z.H.useCacheRefresh()},vn.use=function(X){return z.H.use(X)},vn.useActionState=function(X,re,we){return z.H.useActionState(X,re,we)},vn.useCallback=function(X,re){return z.H.useCallback(X,re)},vn.useContext=function(X){return z.H.useContext(X)},vn.useDebugValue=function(){},vn.useDeferredValue=function(X,re){return z.H.useDeferredValue(X,re)},vn.useEffect=function(X,re,we){var Fe=z.H;if(typeof we=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Fe.useEffect(X,re)},vn.useId=function(){return z.H.useId()},vn.useImperativeHandle=function(X,re,we){return z.H.useImperativeHandle(X,re,we)},vn.useInsertionEffect=function(X,re){return z.H.useInsertionEffect(X,re)},vn.useLayoutEffect=function(X,re){return z.H.useLayoutEffect(X,re)},vn.useMemo=function(X,re){return z.H.useMemo(X,re)},vn.useOptimistic=function(X,re){return z.H.useOptimistic(X,re)},vn.useReducer=function(X,re,we){return z.H.useReducer(X,re,we)},vn.useRef=function(X){return z.H.useRef(X)},vn.useState=function(X){return z.H.useState(X)},vn.useSyncExternalStore=function(X,re,we){return z.H.useSyncExternalStore(X,re,we)},vn.useTransition=function(){return z.H.useTransition()},vn.version="19.1.0",vn}var RC;function jg(){return RC||(RC=1,HM.exports=aF()),HM.exports}var Tt=jg();const oF=x1(Tt);var kM={exports:{}},Tv={},qM={exports:{}},WM={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var NC;function lF(){return NC||(NC=1,function(r){function e(V,Q){var J=V.length;V.push(Q);e:for(;0<J;){var ve=J-1>>>1,X=V[ve];if(0<i(X,Q))V[ve]=Q,V[J]=X,J=ve;else break e}}function t(V){return V.length===0?null:V[0]}function n(V){if(V.length===0)return null;var Q=V[0],J=V.pop();if(J!==Q){V[0]=J;e:for(var ve=0,X=V.length,re=X>>>1;ve<re;){var we=2*(ve+1)-1,Fe=V[we],oe=we+1,De=V[oe];if(0>i(Fe,J))oe<X&&0>i(De,Fe)?(V[ve]=De,V[oe]=J,ve=oe):(V[ve]=Fe,V[we]=J,ve=we);else if(oe<X&&0>i(De,J))V[ve]=De,V[oe]=J,ve=oe;else break e}}return Q}function i(V,Q){var J=V.sortIndex-Q.sortIndex;return J!==0?J:V.id-Q.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();r.unstable_now=function(){return a.now()-l}}var c=[],d=[],m=1,y=null,v=3,x=!1,S=!1,A=!1,E=!1,M=typeof setTimeout=="function"?setTimeout:null,C=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;function D(V){for(var Q=t(d);Q!==null;){if(Q.callback===null)n(d);else if(Q.startTime<=V)n(d),Q.sortIndex=Q.expirationTime,e(c,Q);else break;Q=t(d)}}function z(V){if(A=!1,D(V),!S)if(t(c)!==null)S=!0,B||(B=!0,ue());else{var Q=t(d);Q!==null&&Se(z,Q.startTime-V)}}var B=!1,F=-1,H=5,I=-1;function P(){return E?!0:!(r.unstable_now()-I<H)}function Z(){if(E=!1,B){var V=r.unstable_now();I=V;var Q=!0;try{e:{S=!1,A&&(A=!1,C(F),F=-1),x=!0;var J=v;try{t:{for(D(V),y=t(c);y!==null&&!(y.expirationTime>V&&P());){var ve=y.callback;if(typeof ve=="function"){y.callback=null,v=y.priorityLevel;var X=ve(y.expirationTime<=V);if(V=r.unstable_now(),typeof X=="function"){y.callback=X,D(V),Q=!0;break t}y===t(c)&&n(c),D(V)}else n(c);y=t(c)}if(y!==null)Q=!0;else{var re=t(d);re!==null&&Se(z,re.startTime-V),Q=!1}}break e}finally{y=null,v=J,x=!1}Q=void 0}}finally{Q?ue():B=!1}}}var ue;if(typeof w=="function")ue=function(){w(Z)};else if(typeof MessageChannel<"u"){var se=new MessageChannel,pe=se.port2;se.port1.onmessage=Z,ue=function(){pe.postMessage(null)}}else ue=function(){M(Z,0)};function Se(V,Q){F=M(function(){V(r.unstable_now())},Q)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(V){V.callback=null},r.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):H=0<V?Math.floor(1e3/V):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_next=function(V){switch(v){case 1:case 2:case 3:var Q=3;break;default:Q=v}var J=v;v=Q;try{return V()}finally{v=J}},r.unstable_requestPaint=function(){E=!0},r.unstable_runWithPriority=function(V,Q){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var J=v;v=V;try{return Q()}finally{v=J}},r.unstable_scheduleCallback=function(V,Q,J){var ve=r.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?ve+J:ve):J=ve,V){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=J+X,V={id:m++,callback:Q,priorityLevel:V,startTime:J,expirationTime:X,sortIndex:-1},J>ve?(V.sortIndex=J,e(d,V),t(c)===null&&V===t(d)&&(A?(C(F),F=-1):A=!0,Se(z,J-ve))):(V.sortIndex=X,e(c,V),S||x||(S=!0,B||(B=!0,ue()))),V},r.unstable_shouldYield=P,r.unstable_wrapCallback=function(V){var Q=v;return function(){var J=v;v=Q;try{return V.apply(this,arguments)}finally{v=J}}}}(WM)),WM}var CC;function uF(){return CC||(CC=1,qM.exports=lF()),qM.exports}var XM={exports:{}},Br={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wC;function cF(){if(wC)return Br;wC=1;var r=jg();function e(c){var d="https://react.dev/errors/"+c;if(1<arguments.length){d+="?args[]="+encodeURIComponent(arguments[1]);for(var m=2;m<arguments.length;m++)d+="&args[]="+encodeURIComponent(arguments[m])}return"Minified React error #"+c+"; visit "+d+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function t(){}var n={d:{f:t,r:function(){throw Error(e(522))},D:t,C:t,L:t,m:t,X:t,S:t,M:t},p:0,findDOMNode:null},i=Symbol.for("react.portal");function s(c,d,m){var y=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:i,key:y==null?null:""+y,children:c,containerInfo:d,implementation:m}}var a=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function l(c,d){if(c==="font")return"";if(typeof d=="string")return d==="use-credentials"?d:""}return Br.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=n,Br.createPortal=function(c,d){var m=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!d||d.nodeType!==1&&d.nodeType!==9&&d.nodeType!==11)throw Error(e(299));return s(c,d,null,m)},Br.flushSync=function(c){var d=a.T,m=n.p;try{if(a.T=null,n.p=2,c)return c()}finally{a.T=d,n.p=m,n.d.f()}},Br.preconnect=function(c,d){typeof c=="string"&&(d?(d=d.crossOrigin,d=typeof d=="string"?d==="use-credentials"?d:"":void 0):d=null,n.d.C(c,d))},Br.prefetchDNS=function(c){typeof c=="string"&&n.d.D(c)},Br.preinit=function(c,d){if(typeof c=="string"&&d&&typeof d.as=="string"){var m=d.as,y=l(m,d.crossOrigin),v=typeof d.integrity=="string"?d.integrity:void 0,x=typeof d.fetchPriority=="string"?d.fetchPriority:void 0;m==="style"?n.d.S(c,typeof d.precedence=="string"?d.precedence:void 0,{crossOrigin:y,integrity:v,fetchPriority:x}):m==="script"&&n.d.X(c,{crossOrigin:y,integrity:v,fetchPriority:x,nonce:typeof d.nonce=="string"?d.nonce:void 0})}},Br.preinitModule=function(c,d){if(typeof c=="string")if(typeof d=="object"&&d!==null){if(d.as==null||d.as==="script"){var m=l(d.as,d.crossOrigin);n.d.M(c,{crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0})}}else d==null&&n.d.M(c)},Br.preload=function(c,d){if(typeof c=="string"&&typeof d=="object"&&d!==null&&typeof d.as=="string"){var m=d.as,y=l(m,d.crossOrigin);n.d.L(c,m,{crossOrigin:y,integrity:typeof d.integrity=="string"?d.integrity:void 0,nonce:typeof d.nonce=="string"?d.nonce:void 0,type:typeof d.type=="string"?d.type:void 0,fetchPriority:typeof d.fetchPriority=="string"?d.fetchPriority:void 0,referrerPolicy:typeof d.referrerPolicy=="string"?d.referrerPolicy:void 0,imageSrcSet:typeof d.imageSrcSet=="string"?d.imageSrcSet:void 0,imageSizes:typeof d.imageSizes=="string"?d.imageSizes:void 0,media:typeof d.media=="string"?d.media:void 0})}},Br.preloadModule=function(c,d){if(typeof c=="string")if(d){var m=l(d.as,d.crossOrigin);n.d.m(c,{as:typeof d.as=="string"&&d.as!=="script"?d.as:void 0,crossOrigin:m,integrity:typeof d.integrity=="string"?d.integrity:void 0})}else n.d.m(c)},Br.requestFormReset=function(c){n.d.r(c)},Br.unstable_batchedUpdates=function(c,d){return c(d)},Br.useFormState=function(c,d,m){return a.H.useFormState(c,d,m)},Br.useFormStatus=function(){return a.H.useHostTransitionStatus()},Br.version="19.1.0",Br}var DC;function hF(){if(DC)return XM.exports;DC=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),XM.exports=cF(),XM.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UC;function fF(){if(UC)return Tv;UC=1;var r=uF(),e=jg(),t=hF();function n(o){var u="https://react.dev/errors/"+o;if(1<arguments.length){u+="?args[]="+encodeURIComponent(arguments[1]);for(var p=2;p<arguments.length;p++)u+="&args[]="+encodeURIComponent(arguments[p])}return"Minified React error #"+o+"; visit "+u+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function i(o){return!(!o||o.nodeType!==1&&o.nodeType!==9&&o.nodeType!==11)}function s(o){var u=o,p=o;if(o.alternate)for(;u.return;)u=u.return;else{o=u;do u=o,(u.flags&4098)!==0&&(p=u.return),o=u.return;while(o)}return u.tag===3?p:null}function a(o){if(o.tag===13){var u=o.memoizedState;if(u===null&&(o=o.alternate,o!==null&&(u=o.memoizedState)),u!==null)return u.dehydrated}return null}function l(o){if(s(o)!==o)throw Error(n(188))}function c(o){var u=o.alternate;if(!u){if(u=s(o),u===null)throw Error(n(188));return u!==o?null:o}for(var p=o,g=u;;){var b=p.return;if(b===null)break;var R=b.alternate;if(R===null){if(g=b.return,g!==null){p=g;continue}break}if(b.child===R.child){for(R=b.child;R;){if(R===p)return l(b),o;if(R===g)return l(b),u;R=R.sibling}throw Error(n(188))}if(p.return!==g.return)p=b,g=R;else{for(var O=!1,k=b.child;k;){if(k===p){O=!0,p=b,g=R;break}if(k===g){O=!0,g=b,p=R;break}k=k.sibling}if(!O){for(k=R.child;k;){if(k===p){O=!0,p=R,g=b;break}if(k===g){O=!0,g=R,p=b;break}k=k.sibling}if(!O)throw Error(n(189))}}if(p.alternate!==g)throw Error(n(190))}if(p.tag!==3)throw Error(n(188));return p.stateNode.current===p?o:u}function d(o){var u=o.tag;if(u===5||u===26||u===27||u===6)return o;for(o=o.child;o!==null;){if(u=d(o),u!==null)return u;o=o.sibling}return null}var m=Object.assign,y=Symbol.for("react.element"),v=Symbol.for("react.transitional.element"),x=Symbol.for("react.portal"),S=Symbol.for("react.fragment"),A=Symbol.for("react.strict_mode"),E=Symbol.for("react.profiler"),M=Symbol.for("react.provider"),C=Symbol.for("react.consumer"),w=Symbol.for("react.context"),D=Symbol.for("react.forward_ref"),z=Symbol.for("react.suspense"),B=Symbol.for("react.suspense_list"),F=Symbol.for("react.memo"),H=Symbol.for("react.lazy"),I=Symbol.for("react.activity"),P=Symbol.for("react.memo_cache_sentinel"),Z=Symbol.iterator;function ue(o){return o===null||typeof o!="object"?null:(o=Z&&o[Z]||o["@@iterator"],typeof o=="function"?o:null)}var se=Symbol.for("react.client.reference");function pe(o){if(o==null)return null;if(typeof o=="function")return o.$$typeof===se?null:o.displayName||o.name||null;if(typeof o=="string")return o;switch(o){case S:return"Fragment";case E:return"Profiler";case A:return"StrictMode";case z:return"Suspense";case B:return"SuspenseList";case I:return"Activity"}if(typeof o=="object")switch(o.$$typeof){case x:return"Portal";case w:return(o.displayName||"Context")+".Provider";case C:return(o._context.displayName||"Context")+".Consumer";case D:var u=o.render;return o=o.displayName,o||(o=u.displayName||u.name||"",o=o!==""?"ForwardRef("+o+")":"ForwardRef"),o;case F:return u=o.displayName||null,u!==null?u:pe(o.type)||"Memo";case H:u=o._payload,o=o._init;try{return pe(o(u))}catch{}}return null}var Se=Array.isArray,V=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Q=t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,J={pending:!1,data:null,method:null,action:null},ve=[],X=-1;function re(o){return{current:o}}function we(o){0>X||(o.current=ve[X],ve[X]=null,X--)}function Fe(o,u){X++,ve[X]=o.current,o.current=u}var oe=re(null),De=re(null),je=re(null),nt=re(null);function lt(o,u){switch(Fe(je,u),Fe(De,o),Fe(oe,null),u.nodeType){case 9:case 11:o=(o=u.documentElement)&&(o=o.namespaceURI)?JN(o):0;break;default:if(o=u.tagName,u=u.namespaceURI)u=JN(u),o=$N(u,o);else switch(o){case"svg":o=1;break;case"math":o=2;break;default:o=0}}we(oe),Fe(oe,o)}function nn(){we(oe),we(De),we(je)}function Pt(o){o.memoizedState!==null&&Fe(nt,o);var u=oe.current,p=$N(u,o.type);u!==p&&(Fe(De,o),Fe(oe,p))}function mn(o){De.current===o&&(we(oe),we(De)),nt.current===o&&(we(nt),yv._currentValue=J)}var An=Object.prototype.hasOwnProperty,$t=r.unstable_scheduleCallback,ne=r.unstable_cancelCallback,oi=r.unstable_shouldYield,Ze=r.unstable_requestPaint,Ge=r.unstable_now,He=r.unstable_getCurrentPriorityLevel,at=r.unstable_ImmediatePriority,Ie=r.unstable_UserBlockingPriority,j=r.unstable_NormalPriority,G=r.unstable_LowPriority,de=r.unstable_IdlePriority,Le=r.log,ke=r.unstable_setDisableYieldValue,Be=null,ct=null;function it(o){if(typeof Le=="function"&&ke(o),ct&&typeof ct.setStrictMode=="function")try{ct.setStrictMode(Be,o)}catch{}}var ot=Math.clz32?Math.clz32:St,xn=Math.log,et=Math.LN2;function St(o){return o>>>=0,o===0?32:31-(xn(o)/et|0)|0}var Rt=256,Nt=4194304;function ht(o){var u=o&42;if(u!==0)return u;switch(o&-o){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return o&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return o}}function dn(o,u,p){var g=o.pendingLanes;if(g===0)return 0;var b=0,R=o.suspendedLanes,O=o.pingedLanes;o=o.warmLanes;var k=g&134217727;return k!==0?(g=k&~R,g!==0?b=ht(g):(O&=k,O!==0?b=ht(O):p||(p=k&~o,p!==0&&(b=ht(p))))):(k=g&~R,k!==0?b=ht(k):O!==0?b=ht(O):p||(p=g&~o,p!==0&&(b=ht(p)))),b===0?0:u!==0&&u!==b&&(u&R)===0&&(R=b&-b,p=u&-u,R>=p||R===32&&(p&4194048)!==0)?u:b}function kt(o,u){return(o.pendingLanes&~(o.suspendedLanes&~o.pingedLanes)&u)===0}function zn(o,u){switch(o){case 1:case 2:case 4:case 8:case 64:return u+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return u+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function fe(){var o=Rt;return Rt<<=1,(Rt&4194048)===0&&(Rt=256),o}function mt(){var o=Nt;return Nt<<=1,(Nt&62914560)===0&&(Nt=4194304),o}function Ue(o){for(var u=[],p=0;31>p;p++)u.push(o);return u}function Ke(o,u){o.pendingLanes|=u,u!==268435456&&(o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0)}function yt(o,u,p,g,b,R){var O=o.pendingLanes;o.pendingLanes=p,o.suspendedLanes=0,o.pingedLanes=0,o.warmLanes=0,o.expiredLanes&=p,o.entangledLanes&=p,o.errorRecoveryDisabledLanes&=p,o.shellSuspendCounter=0;var k=o.entanglements,$=o.expirationTimes,Te=o.hiddenUpdates;for(p=O&~p;0<p;){var We=31-ot(p),Je=1<<We;k[We]=0,$[We]=-1;var Ee=Te[We];if(Ee!==null)for(Te[We]=null,We=0;We<Ee.length;We++){var Ne=Ee[We];Ne!==null&&(Ne.lane&=-536870913)}p&=~Je}g!==0&&gt(o,g,0),R!==0&&b===0&&o.tag!==0&&(o.suspendedLanes|=R&~(O&~u))}function gt(o,u,p){o.pendingLanes|=u,o.suspendedLanes&=~u;var g=31-ot(u);o.entangledLanes|=u,o.entanglements[g]=o.entanglements[g]|1073741824|p&4194090}function Jt(o,u){var p=o.entangledLanes|=u;for(o=o.entanglements;p;){var g=31-ot(p),b=1<<g;b&u|o[g]&u&&(o[g]|=u),p&=~b}}function Qn(o){switch(o){case 2:o=1;break;case 8:o=4;break;case 32:o=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:o=128;break;case 268435456:o=134217728;break;default:o=0}return o}function Ci(o){return o&=-o,2<o?8<o?(o&134217727)!==0?32:268435456:8:2}function Dn(){var o=Q.p;return o!==0?o:(o=window.event,o===void 0?32:vC(o.type))}function Mr(o,u){var p=Q.p;try{return Q.p=o,u()}finally{Q.p=p}}var ds=Math.random().toString(36).slice(2),ts="__reactFiber$"+ds,ps="__reactProps$"+ds,Qs="__reactContainer$"+ds,Er="__reactEvents$"+ds,vf="__reactListeners$"+ds,Ka="__reactHandles$"+ds,or="__reactResources$"+ds,Qa="__reactMarker$"+ds;function ii(o){delete o[ts],delete o[ps],delete o[Er],delete o[vf],delete o[Ka]}function Ja(o){var u=o[ts];if(u)return u;for(var p=o.parentNode;p;){if(u=p[Qs]||p[ts]){if(p=u.alternate,u.child!==null||p!==null&&p.child!==null)for(o=iC(o);o!==null;){if(p=o[ts])return p;o=iC(o)}return u}o=p,p=o.parentNode}return null}function $a(o){if(o=o[ts]||o[Qs]){var u=o.tag;if(u===5||u===6||u===13||u===26||u===27||u===3)return o}return null}function Xl(o){var u=o.tag;if(u===5||u===26||u===27||u===6)return o.stateNode;throw Error(n(33))}function il(o){var u=o[or];return u||(u=o[or]={hoistableStyles:new Map,hoistableScripts:new Map}),u}function ns(o){o[Qa]=!0}var qc=new Set,Wc={};function eo(o,u){q(o,u),q(o+"Capture",u)}function q(o,u){for(Wc[o]=u,o=0;o<u.length;o++)qc.add(u[o])}var he=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),Ae={},Re={};function ye(o){return An.call(Re,o)?!0:An.call(Ae,o)?!1:he.test(o)?Re[o]=!0:(Ae[o]=!0,!1)}function $e(o,u,p){if(ye(u))if(p===null)o.removeAttribute(u);else{switch(typeof p){case"undefined":case"function":case"symbol":o.removeAttribute(u);return;case"boolean":var g=u.toLowerCase().slice(0,5);if(g!=="data-"&&g!=="aria-"){o.removeAttribute(u);return}}o.setAttribute(u,""+p)}}function ut(o,u,p){if(p===null)o.removeAttribute(u);else{switch(typeof p){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(u);return}o.setAttribute(u,""+p)}}function dt(o,u,p,g){if(g===null)o.removeAttribute(p);else{switch(typeof g){case"undefined":case"function":case"symbol":case"boolean":o.removeAttribute(p);return}o.setAttributeNS(u,p,""+g)}}var bt,Wt;function It(o){if(bt===void 0)try{throw Error()}catch(p){var u=p.stack.trim().match(/\n( *(at )?)/);bt=u&&u[1]||"",Wt=-1<p.stack.indexOf(`
    at`)?" (<anonymous>)":-1<p.stack.indexOf("@")?"@unknown:0:0":""}return`
`+bt+o+Wt}var Ut=!1;function Sn(o,u){if(!o||Ut)return"";Ut=!0;var p=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var g={DetermineComponentFrameRoot:function(){try{if(u){var Je=function(){throw Error()};if(Object.defineProperty(Je.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(Je,[])}catch(Ne){var Ee=Ne}Reflect.construct(o,[],Je)}else{try{Je.call()}catch(Ne){Ee=Ne}o.call(Je.prototype)}}else{try{throw Error()}catch(Ne){Ee=Ne}(Je=o())&&typeof Je.catch=="function"&&Je.catch(function(){})}}catch(Ne){if(Ne&&Ee&&typeof Ne.stack=="string")return[Ne.stack,Ee.stack]}return[null,null]}};g.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var b=Object.getOwnPropertyDescriptor(g.DetermineComponentFrameRoot,"name");b&&b.configurable&&Object.defineProperty(g.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var R=g.DetermineComponentFrameRoot(),O=R[0],k=R[1];if(O&&k){var $=O.split(`
`),Te=k.split(`
`);for(b=g=0;g<$.length&&!$[g].includes("DetermineComponentFrameRoot");)g++;for(;b<Te.length&&!Te[b].includes("DetermineComponentFrameRoot");)b++;if(g===$.length||b===Te.length)for(g=$.length-1,b=Te.length-1;1<=g&&0<=b&&$[g]!==Te[b];)b--;for(;1<=g&&0<=b;g--,b--)if($[g]!==Te[b]){if(g!==1||b!==1)do if(g--,b--,0>b||$[g]!==Te[b]){var We=`
`+$[g].replace(" at new "," at ");return o.displayName&&We.includes("<anonymous>")&&(We=We.replace("<anonymous>",o.displayName)),We}while(1<=g&&0<=b);break}}}finally{Ut=!1,Error.prepareStackTrace=p}return(p=o?o.displayName||o.name:"")?It(p):""}function Pn(o){switch(o.tag){case 26:case 27:case 5:return It(o.type);case 16:return It("Lazy");case 13:return It("Suspense");case 19:return It("SuspenseList");case 0:case 15:return Sn(o.type,!1);case 11:return Sn(o.type.render,!1);case 1:return Sn(o.type,!0);case 31:return It("Activity");default:return""}}function wi(o){try{var u="";do u+=Pn(o),o=o.return;while(o);return u}catch(p){return`
Error generating stack: `+p.message+`
`+p.stack}}function Tn(o){switch(typeof o){case"bigint":case"boolean":case"number":case"string":case"undefined":return o;case"object":return o;default:return""}}function Rn(o){var u=o.type;return(o=o.nodeName)&&o.toLowerCase()==="input"&&(u==="checkbox"||u==="radio")}function zt(o){var u=Rn(o)?"checked":"value",p=Object.getOwnPropertyDescriptor(o.constructor.prototype,u),g=""+o[u];if(!o.hasOwnProperty(u)&&typeof p<"u"&&typeof p.get=="function"&&typeof p.set=="function"){var b=p.get,R=p.set;return Object.defineProperty(o,u,{configurable:!0,get:function(){return b.call(this)},set:function(O){g=""+O,R.call(this,O)}}),Object.defineProperty(o,u,{enumerable:p.enumerable}),{getValue:function(){return g},setValue:function(O){g=""+O},stopTracking:function(){o._valueTracker=null,delete o[u]}}}}function Bi(o){o._valueTracker||(o._valueTracker=zt(o))}function Ln(o){if(!o)return!1;var u=o._valueTracker;if(!u)return!0;var p=u.getValue(),g="";return o&&(g=Rn(o)?o.checked?"true":"false":o.value),o=g,o!==p?(u.setValue(o),!0):!1}function Os(o){if(o=o||(typeof document<"u"?document:void 0),typeof o>"u")return null;try{return o.activeElement||o.body}catch{return o.body}}var To=/[\n"\\]/g;function li(o){return o.replace(To,function(u){return"\\"+u.charCodeAt(0).toString(16)+" "})}function Mo(o,u,p,g,b,R,O,k){o.name="",O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"?o.type=O:o.removeAttribute("type"),u!=null?O==="number"?(u===0&&o.value===""||o.value!=u)&&(o.value=""+Tn(u)):o.value!==""+Tn(u)&&(o.value=""+Tn(u)):O!=="submit"&&O!=="reset"||o.removeAttribute("value"),u!=null?Ps(o,O,Tn(u)):p!=null?Ps(o,O,Tn(p)):g!=null&&o.removeAttribute("value"),b==null&&R!=null&&(o.defaultChecked=!!R),b!=null&&(o.checked=b&&typeof b!="function"&&typeof b!="symbol"),k!=null&&typeof k!="function"&&typeof k!="symbol"&&typeof k!="boolean"?o.name=""+Tn(k):o.removeAttribute("name")}function si(o,u,p,g,b,R,O,k){if(R!=null&&typeof R!="function"&&typeof R!="symbol"&&typeof R!="boolean"&&(o.type=R),u!=null||p!=null){if(!(R!=="submit"&&R!=="reset"||u!=null))return;p=p!=null?""+Tn(p):"",u=u!=null?""+Tn(u):p,k||u===o.value||(o.value=u),o.defaultValue=u}g=g??b,g=typeof g!="function"&&typeof g!="symbol"&&!!g,o.checked=k?o.checked:!!g,o.defaultChecked=!!g,O!=null&&typeof O!="function"&&typeof O!="symbol"&&typeof O!="boolean"&&(o.name=O)}function Ps(o,u,p){u==="number"&&Os(o.ownerDocument)===o||o.defaultValue===""+p||(o.defaultValue=""+p)}function is(o,u,p,g){if(o=o.options,u){u={};for(var b=0;b<p.length;b++)u["$"+p[b]]=!0;for(p=0;p<o.length;p++)b=u.hasOwnProperty("$"+o[p].value),o[p].selected!==b&&(o[p].selected=b),b&&g&&(o[p].defaultSelected=!0)}else{for(p=""+Tn(p),u=null,b=0;b<o.length;b++){if(o[b].value===p){o[b].selected=!0,g&&(o[b].defaultSelected=!0);return}u!==null||o[b].disabled||(u=o[b])}u!==null&&(u.selected=!0)}}function Ms(o,u,p){if(u!=null&&(u=""+Tn(u),u!==o.value&&(o.value=u),p==null)){o.defaultValue!==u&&(o.defaultValue=u);return}o.defaultValue=p!=null?""+Tn(p):""}function Es(o,u,p,g){if(u==null){if(g!=null){if(p!=null)throw Error(n(92));if(Se(g)){if(1<g.length)throw Error(n(93));g=g[0]}p=g}p==null&&(p=""),u=p}p=Tn(u),o.defaultValue=p,g=o.textContent,g===p&&g!==""&&g!==null&&(o.value=g)}function lr(o,u){if(u){var p=o.firstChild;if(p&&p===o.lastChild&&p.nodeType===3){p.nodeValue=u;return}}o.textContent=u}var Eo=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function _f(o,u,p){var g=u.indexOf("--")===0;p==null||typeof p=="boolean"||p===""?g?o.setProperty(u,""):u==="float"?o.cssFloat="":o[u]="":g?o.setProperty(u,p):typeof p!="number"||p===0||Eo.has(u)?u==="float"?o.cssFloat=p:o[u]=(""+p).trim():o[u]=p+"px"}function xf(o,u,p){if(u!=null&&typeof u!="object")throw Error(n(62));if(o=o.style,p!=null){for(var g in p)!p.hasOwnProperty(g)||u!=null&&u.hasOwnProperty(g)||(g.indexOf("--")===0?o.setProperty(g,""):g==="float"?o.cssFloat="":o[g]="");for(var b in u)g=u[b],u.hasOwnProperty(b)&&p[b]!==g&&_f(o,b,g)}else for(var R in u)u.hasOwnProperty(R)&&_f(o,R,u[R])}function Dp(o){if(o.indexOf("-")===-1)return!1;switch(o){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var uy=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),g0=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function Sf(o){return g0.test(""+o)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":o}var Up=null;function Lp(o){return o=o.target||o.srcElement||window,o.correspondingUseElement&&(o=o.correspondingUseElement),o.nodeType===3?o.parentNode:o}var Yl=null,Zu=null;function cy(o){var u=$a(o);if(u&&(o=u.stateNode)){var p=o[ps]||null;e:switch(o=u.stateNode,u.type){case"input":if(Mo(o,p.value,p.defaultValue,p.defaultValue,p.checked,p.defaultChecked,p.type,p.name),u=p.name,p.type==="radio"&&u!=null){for(p=o;p.parentNode;)p=p.parentNode;for(p=p.querySelectorAll('input[name="'+li(""+u)+'"][type="radio"]'),u=0;u<p.length;u++){var g=p[u];if(g!==o&&g.form===o.form){var b=g[ps]||null;if(!b)throw Error(n(90));Mo(g,b.value,b.defaultValue,b.defaultValue,b.checked,b.defaultChecked,b.type,b.name)}}for(u=0;u<p.length;u++)g=p[u],g.form===o.form&&Ln(g)}break e;case"textarea":Ms(o,p.value,p.defaultValue);break e;case"select":u=p.value,u!=null&&is(o,!!p.multiple,u,!1)}}}var bf=!1;function hy(o,u,p){if(bf)return o(u,p);bf=!0;try{var g=o(u);return g}finally{if(bf=!1,(Yl!==null||Zu!==null)&&(Go(),Yl&&(u=Yl,o=Zu,Zu=Yl=null,cy(u),o)))for(u=0;u<o.length;u++)cy(o[u])}}function Xc(o,u){var p=o.stateNode;if(p===null)return null;var g=p[ps]||null;if(g===null)return null;p=g[u];e:switch(u){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(g=!g.disabled)||(o=o.type,g=!(o==="button"||o==="input"||o==="select"||o==="textarea")),o=!g;break e;default:o=!1}if(o)return null;if(p&&typeof p!="function")throw Error(n(231,u,typeof p));return p}var Ao=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),Tf=!1;if(Ao)try{var Yc={};Object.defineProperty(Yc,"passive",{get:function(){Tf=!0}}),window.addEventListener("test",Yc,Yc),window.removeEventListener("test",Yc,Yc)}catch{Tf=!1}var sl=null,fy=null,Bp=null;function dy(){if(Bp)return Bp;var o,u=fy,p=u.length,g,b="value"in sl?sl.value:sl.textContent,R=b.length;for(o=0;o<p&&u[o]===b[o];o++);var O=p-o;for(g=1;g<=O&&u[p-g]===b[R-g];g++);return Bp=b.slice(o,1<g?1-g:void 0)}function jl(o){var u=o.keyCode;return"charCode"in o?(o=o.charCode,o===0&&u===13&&(o=13)):o=u,o===10&&(o=13),32<=o||o===13?o:0}function jc(){return!0}function Mf(){return!1}function ur(o){function u(p,g,b,R,O){this._reactName=p,this._targetInst=b,this.type=g,this.nativeEvent=R,this.target=O,this.currentTarget=null;for(var k in o)o.hasOwnProperty(k)&&(p=o[k],this[k]=p?p(R):R[k]);return this.isDefaultPrevented=(R.defaultPrevented!=null?R.defaultPrevented:R.returnValue===!1)?jc:Mf,this.isPropagationStopped=Mf,this}return m(u.prototype,{preventDefault:function(){this.defaultPrevented=!0;var p=this.nativeEvent;p&&(p.preventDefault?p.preventDefault():typeof p.returnValue!="unknown"&&(p.returnValue=!1),this.isDefaultPrevented=jc)},stopPropagation:function(){var p=this.nativeEvent;p&&(p.stopPropagation?p.stopPropagation():typeof p.cancelBubble!="unknown"&&(p.cancelBubble=!0),this.isPropagationStopped=jc)},persist:function(){},isPersistent:jc}),u}var Zl={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(o){return o.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Zc=ur(Zl),Kc=m({},Zl,{view:0,detail:0}),y0=ur(Kc),rl,Qc,Jc,$c=m({},Kc,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Af,button:0,buttons:0,relatedTarget:function(o){return o.relatedTarget===void 0?o.fromElement===o.srcElement?o.toElement:o.fromElement:o.relatedTarget},movementX:function(o){return"movementX"in o?o.movementX:(o!==Jc&&(Jc&&o.type==="mousemove"?(rl=o.screenX-Jc.screenX,Qc=o.screenY-Jc.screenY):Qc=rl=0,Jc=o),rl)},movementY:function(o){return"movementY"in o?o.movementY:Qc}}),py=ur($c),v0=m({},$c,{dataTransfer:0}),rM=ur(v0),Is=m({},Kc,{relatedTarget:0}),Op=ur(Is),_0=m({},Zl,{animationName:0,elapsedTime:0,pseudoElement:0}),x0=ur(_0),S0=m({},Zl,{clipboardData:function(o){return"clipboardData"in o?o.clipboardData:window.clipboardData}}),b0=ur(S0),Ef=m({},Zl,{data:0}),Pp=ur(Ef),T0={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},M0={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},E0={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function my(o){var u=this.nativeEvent;return u.getModifierState?u.getModifierState(o):(o=E0[o])?!!u[o]:!1}function Af(){return my}var A0=m({},Kc,{key:function(o){if(o.key){var u=T0[o.key]||o.key;if(u!=="Unidentified")return u}return o.type==="keypress"?(o=jl(o),o===13?"Enter":String.fromCharCode(o)):o.type==="keydown"||o.type==="keyup"?M0[o.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Af,charCode:function(o){return o.type==="keypress"?jl(o):0},keyCode:function(o){return o.type==="keydown"||o.type==="keyup"?o.keyCode:0},which:function(o){return o.type==="keypress"?jl(o):o.type==="keydown"||o.type==="keyup"?o.keyCode:0}}),gy=ur(A0),yy=m({},$c,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),Ip=ur(yy),R0=m({},Kc,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Af}),vy=ur(R0),N0=m({},Zl,{propertyName:0,elapsedTime:0,pseudoElement:0}),al=ur(N0),_y=m({},$c,{deltaX:function(o){return"deltaX"in o?o.deltaX:"wheelDeltaX"in o?-o.wheelDeltaX:0},deltaY:function(o){return"deltaY"in o?o.deltaY:"wheelDeltaY"in o?-o.wheelDeltaY:"wheelDelta"in o?-o.wheelDelta:0},deltaZ:0,deltaMode:0}),aM=ur(_y),C0=m({},Zl,{newState:0,oldState:0}),Kl=ur(C0),ol=[9,13,27,32],Rf=Ao&&"CompositionEvent"in window,Ku=null;Ao&&"documentMode"in document&&(Ku=document.documentMode);var Nf=Ao&&"TextEvent"in window&&!Ku,Cf=Ao&&(!Rf||Ku&&8<Ku&&11>=Ku),Ql=" ",Fs=!1;function wf(o,u){switch(o){case"keyup":return ol.indexOf(u.keyCode)!==-1;case"keydown":return u.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function xy(o){return o=o.detail,typeof o=="object"&&"data"in o?o.data:null}var Jl=!1;function Df(o,u){switch(o){case"compositionend":return xy(u);case"keypress":return u.which!==32?null:(Fs=!0,Ql);case"textInput":return o=u.data,o===Ql&&Fs?null:o;default:return null}}function Sy(o,u){if(Jl)return o==="compositionend"||!Rf&&wf(o,u)?(o=dy(),Bp=fy=sl=null,Jl=!1,o):null;switch(o){case"paste":return null;case"keypress":if(!(u.ctrlKey||u.altKey||u.metaKey)||u.ctrlKey&&u.altKey){if(u.char&&1<u.char.length)return u.char;if(u.which)return String.fromCharCode(u.which)}return null;case"compositionend":return Cf&&u.locale!=="ko"?null:u.data;default:return null}}var Fp={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function by(o){var u=o&&o.nodeName&&o.nodeName.toLowerCase();return u==="input"?!!Fp[o.type]:u==="textarea"}function Ar(o,u,p,g){Yl?Zu?Zu.push(g):Zu=[g]:Yl=g,u=Nx(u,"onChange"),0<u.length&&(p=new Zc("onChange","change",null,p,g),o.push({event:p,listeners:u}))}var eh=null,Qu=null;function w0(o){YN(o,0)}function Uf(o){var u=Xl(o);if(Ln(u))return o}function zp(o,u){if(o==="change")return u}var Vp=!1;if(Ao){var Gp;if(Ao){var th="oninput"in document;if(!th){var nh=document.createElement("div");nh.setAttribute("oninput","return;"),th=typeof nh.oninput=="function"}Gp=th}else Gp=!1;Vp=Gp&&(!document.documentMode||9<document.documentMode)}function Di(){eh&&(eh.detachEvent("onpropertychange",D0),Qu=eh=null)}function D0(o){if(o.propertyName==="value"&&Uf(Qu)){var u=[];Ar(u,Qu,o,Lp(o)),hy(w0,u)}}function oM(o,u,p){o==="focusin"?(Di(),eh=u,Qu=p,eh.attachEvent("onpropertychange",D0)):o==="focusout"&&Di()}function U0(o){if(o==="selectionchange"||o==="keyup"||o==="keydown")return Uf(Qu)}function Lf(o,u){if(o==="click")return Uf(u)}function $l(o,u){if(o==="input"||o==="change")return Uf(u)}function L0(o,u){return o===u&&(o!==0||1/o===1/u)||o!==o&&u!==u}var Rr=typeof Object.is=="function"?Object.is:L0;function to(o,u){if(Rr(o,u))return!0;if(typeof o!="object"||o===null||typeof u!="object"||u===null)return!1;var p=Object.keys(o),g=Object.keys(u);if(p.length!==g.length)return!1;for(g=0;g<p.length;g++){var b=p[g];if(!An.call(u,b)||!Rr(o[b],u[b]))return!1}return!0}function Nr(o){for(;o&&o.firstChild;)o=o.firstChild;return o}function Ty(o,u){var p=Nr(o);o=0;for(var g;p;){if(p.nodeType===3){if(g=o+p.textContent.length,o<=u&&g>=u)return{node:p,offset:u-o};o=g}e:{for(;p;){if(p.nextSibling){p=p.nextSibling;break e}p=p.parentNode}p=void 0}p=Nr(p)}}function My(o,u){return o&&u?o===u?!0:o&&o.nodeType===3?!1:u&&u.nodeType===3?My(o,u.parentNode):"contains"in o?o.contains(u):o.compareDocumentPosition?!!(o.compareDocumentPosition(u)&16):!1:!1}function Ey(o){o=o!=null&&o.ownerDocument!=null&&o.ownerDocument.defaultView!=null?o.ownerDocument.defaultView:window;for(var u=Os(o.document);u instanceof o.HTMLIFrameElement;){try{var p=typeof u.contentWindow.location.href=="string"}catch{p=!1}if(p)o=u.contentWindow;else break;u=Os(o.document)}return u}function Bf(o){var u=o&&o.nodeName&&o.nodeName.toLowerCase();return u&&(u==="input"&&(o.type==="text"||o.type==="search"||o.type==="tel"||o.type==="url"||o.type==="password")||u==="textarea"||o.contentEditable==="true")}var Ay=Ao&&"documentMode"in document&&11>=document.documentMode,ll=null,Hp=null,Of=null,kp=!1;function Ry(o,u,p){var g=p.window===p?p.document:p.nodeType===9?p:p.ownerDocument;kp||ll==null||ll!==Os(g)||(g=ll,"selectionStart"in g&&Bf(g)?g={start:g.selectionStart,end:g.selectionEnd}:(g=(g.ownerDocument&&g.ownerDocument.defaultView||window).getSelection(),g={anchorNode:g.anchorNode,anchorOffset:g.anchorOffset,focusNode:g.focusNode,focusOffset:g.focusOffset}),Of&&to(Of,g)||(Of=g,g=Nx(Hp,"onSelect"),0<g.length&&(u=new Zc("onSelect","select",null,u,p),o.push({event:u,listeners:g}),u.target=ll)))}function zs(o,u){var p={};return p[o.toLowerCase()]=u.toLowerCase(),p["Webkit"+o]="webkit"+u,p["Moz"+o]="moz"+u,p}var eu={animationend:zs("Animation","AnimationEnd"),animationiteration:zs("Animation","AnimationIteration"),animationstart:zs("Animation","AnimationStart"),transitionrun:zs("Transition","TransitionRun"),transitionstart:zs("Transition","TransitionStart"),transitioncancel:zs("Transition","TransitionCancel"),transitionend:zs("Transition","TransitionEnd")},qp={},B0={};Ao&&(B0=document.createElement("div").style,"AnimationEvent"in window||(delete eu.animationend.animation,delete eu.animationiteration.animation,delete eu.animationstart.animation),"TransitionEvent"in window||delete eu.transitionend.transition);function ul(o){if(qp[o])return qp[o];if(!eu[o])return o;var u=eu[o],p;for(p in u)if(u.hasOwnProperty(p)&&p in B0)return qp[o]=u[p];return o}var cr=ul("animationend"),Ny=ul("animationiteration"),Cr=ul("animationstart"),O0=ul("transitionrun"),cl=ul("transitionstart"),ih=ul("transitioncancel"),hl=ul("transitionend"),Wp=new Map,Pf="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");Pf.push("scrollEnd");function As(o,u){Wp.set(o,u),eo(u,[o])}var Cy=new WeakMap;function Vs(o,u){if(typeof o=="object"&&o!==null){var p=Cy.get(o);return p!==void 0?p:(u={value:o,source:u,stack:wi(u)},Cy.set(o,u),u)}return{value:o,source:u,stack:wi(u)}}var Js=[],xa=0,Xp=0;function If(){for(var o=xa,u=Xp=xa=0;u<o;){var p=Js[u];Js[u++]=null;var g=Js[u];Js[u++]=null;var b=Js[u];Js[u++]=null;var R=Js[u];if(Js[u++]=null,g!==null&&b!==null){var O=g.pending;O===null?b.next=b:(b.next=O.next,O.next=b),g.pending=b}R!==0&&wy(p,b,R)}}function tu(o,u,p,g){Js[xa++]=o,Js[xa++]=u,Js[xa++]=p,Js[xa++]=g,Xp|=g,o.lanes|=g,o=o.alternate,o!==null&&(o.lanes|=g)}function Yp(o,u,p,g){return tu(o,u,p,g),sh(o)}function fl(o,u){return tu(o,null,null,u),sh(o)}function wy(o,u,p){o.lanes|=p;var g=o.alternate;g!==null&&(g.lanes|=p);for(var b=!1,R=o.return;R!==null;)R.childLanes|=p,g=R.alternate,g!==null&&(g.childLanes|=p),R.tag===22&&(o=R.stateNode,o===null||o._visibility&1||(b=!0)),o=R,R=R.return;return o.tag===3?(R=o.stateNode,b&&u!==null&&(b=31-ot(p),o=R.hiddenUpdates,g=o[b],g===null?o[b]=[u]:g.push(u),u.lane=p|536870912),R):null}function sh(o){if(50<Vo)throw Vo=0,mc=null,Error(n(185));for(var u=o.return;u!==null;)o=u,u=o.return;return o.tag===3?o.stateNode:null}var nu={};function Dy(o,u,p,g){this.tag=o,this.key=p,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=u,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=g,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function wr(o,u,p,g){return new Dy(o,u,p,g)}function Ff(o){return o=o.prototype,!(!o||!o.isReactComponent)}function ji(o,u){var p=o.alternate;return p===null?(p=wr(o.tag,u,o.key,o.mode),p.elementType=o.elementType,p.type=o.type,p.stateNode=o.stateNode,p.alternate=o,o.alternate=p):(p.pendingProps=u,p.type=o.type,p.flags=0,p.subtreeFlags=0,p.deletions=null),p.flags=o.flags&65011712,p.childLanes=o.childLanes,p.lanes=o.lanes,p.child=o.child,p.memoizedProps=o.memoizedProps,p.memoizedState=o.memoizedState,p.updateQueue=o.updateQueue,u=o.dependencies,p.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext},p.sibling=o.sibling,p.index=o.index,p.ref=o.ref,p.refCleanup=o.refCleanup,p}function Uy(o,u){o.flags&=65011714;var p=o.alternate;return p===null?(o.childLanes=0,o.lanes=u,o.child=null,o.subtreeFlags=0,o.memoizedProps=null,o.memoizedState=null,o.updateQueue=null,o.dependencies=null,o.stateNode=null):(o.childLanes=p.childLanes,o.lanes=p.lanes,o.child=p.child,o.subtreeFlags=0,o.deletions=null,o.memoizedProps=p.memoizedProps,o.memoizedState=p.memoizedState,o.updateQueue=p.updateQueue,o.type=p.type,u=p.dependencies,o.dependencies=u===null?null:{lanes:u.lanes,firstContext:u.firstContext}),o}function Rs(o,u,p,g,b,R){var O=0;if(g=o,typeof o=="function")Ff(o)&&(O=1);else if(typeof o=="string")O=WI(o,p,oe.current)?26:o==="html"||o==="head"||o==="body"?27:5;else e:switch(o){case I:return o=wr(31,p,u,b),o.elementType=I,o.lanes=R,o;case S:return iu(p.children,b,R,u);case A:O=8,b|=24;break;case E:return o=wr(12,p,u,b|2),o.elementType=E,o.lanes=R,o;case z:return o=wr(13,p,u,b),o.elementType=z,o.lanes=R,o;case B:return o=wr(19,p,u,b),o.elementType=B,o.lanes=R,o;default:if(typeof o=="object"&&o!==null)switch(o.$$typeof){case M:case w:O=10;break e;case C:O=9;break e;case D:O=11;break e;case F:O=14;break e;case H:O=16,g=null;break e}O=29,p=Error(n(130,o===null?"null":typeof o,"")),g=null}return u=wr(O,p,u,b),u.elementType=o,u.type=g,u.lanes=R,u}function iu(o,u,p,g){return o=wr(7,o,g,u),o.lanes=p,o}function zf(o,u,p){return o=wr(6,o,null,u),o.lanes=p,o}function jp(o,u,p){return u=wr(4,o.children!==null?o.children:[],o.key,u),u.lanes=p,u.stateNode={containerInfo:o.containerInfo,pendingChildren:null,implementation:o.implementation},u}var rh=[],Dr=0,Vf=null,ah=0,Gs=[],Xr=0,su=null,Ro=1,No="";function dl(o,u){rh[Dr++]=ah,rh[Dr++]=Vf,Vf=o,ah=u}function Zp(o,u,p){Gs[Xr++]=Ro,Gs[Xr++]=No,Gs[Xr++]=su,su=o;var g=Ro;o=No;var b=32-ot(g)-1;g&=~(1<<b),p+=1;var R=32-ot(u)+b;if(30<R){var O=b-b%5;R=(g&(1<<O)-1).toString(32),g>>=O,b-=O,Ro=1<<32-ot(u)+b|p<<b|g,No=R+o}else Ro=1<<R|p<<b|g,No=o}function Ly(o){o.return!==null&&(dl(o,1),Zp(o,1,0))}function By(o){for(;o===Vf;)Vf=rh[--Dr],rh[Dr]=null,ah=rh[--Dr],rh[Dr]=null;for(;o===su;)su=Gs[--Xr],Gs[Xr]=null,No=Gs[--Xr],Gs[Xr]=null,Ro=Gs[--Xr],Gs[Xr]=null}var hr=null,Oi=null,Vn=!1,Sa=null,Yr=!1,Kp=Error(n(519));function ru(o){var u=Error(n(418,""));throw Ju(Vs(u,o)),Kp}function P0(o){var u=o.stateNode,p=o.type,g=o.memoizedProps;switch(u[ts]=o,u[ps]=g,p){case"dialog":Un("cancel",u),Un("close",u);break;case"iframe":case"object":case"embed":Un("load",u);break;case"video":case"audio":for(p=0;p<hv.length;p++)Un(hv[p],u);break;case"source":Un("error",u);break;case"img":case"image":case"link":Un("error",u),Un("load",u);break;case"details":Un("toggle",u);break;case"input":Un("invalid",u),si(u,g.value,g.defaultValue,g.checked,g.defaultChecked,g.type,g.name,!0),Bi(u);break;case"select":Un("invalid",u);break;case"textarea":Un("invalid",u),Es(u,g.value,g.defaultValue,g.children),Bi(u)}p=g.children,typeof p!="string"&&typeof p!="number"&&typeof p!="bigint"||u.textContent===""+p||g.suppressHydrationWarning===!0||QN(u.textContent,p)?(g.popover!=null&&(Un("beforetoggle",u),Un("toggle",u)),g.onScroll!=null&&Un("scroll",u),g.onScrollEnd!=null&&Un("scrollend",u),g.onClick!=null&&(u.onclick=Cx),u=!0):u=!1,u||ru(o)}function Oy(o){for(hr=o.return;hr;)switch(hr.tag){case 5:case 13:Yr=!1;return;case 27:case 3:Yr=!0;return;default:hr=hr.return}}function no(o){if(o!==hr)return!1;if(!Vn)return Oy(o),Vn=!0,!1;var u=o.tag,p;if((p=u!==3&&u!==27)&&((p=u===5)&&(p=o.type,p=!(p!=="form"&&p!=="button")||RM(o.type,o.memoizedProps)),p=!p),p&&Oi&&ru(o),Oy(o),u===13){if(o=o.memoizedState,o=o!==null?o.dehydrated:null,!o)throw Error(n(317));e:{for(o=o.nextSibling,u=0;o;){if(o.nodeType===8)if(p=o.data,p==="/$"){if(u===0){Oi=Rl(o.nextSibling);break e}u--}else p!=="$"&&p!=="$!"&&p!=="$?"||u++;o=o.nextSibling}Oi=null}}else u===27?(u=Oi,Dh(o.type)?(o=DM,DM=null,Oi=o):Oi=u):Oi=hr?Rl(o.stateNode.nextSibling):null;return!0}function oh(){Oi=hr=null,Vn=!1}function qn(){var o=Sa;return o!==null&&(qt===null?qt=o:qt.push.apply(qt,o),Sa=null),o}function Ju(o){Sa===null?Sa=[o]:Sa.push(o)}var Py=re(null),au=null,pl=null;function ou(o,u,p){Fe(Py,u._currentValue),u._currentValue=p}function ml(o){o._currentValue=Py.current,we(Py)}function Iy(o,u,p){for(;o!==null;){var g=o.alternate;if((o.childLanes&u)!==u?(o.childLanes|=u,g!==null&&(g.childLanes|=u)):g!==null&&(g.childLanes&u)!==u&&(g.childLanes|=u),o===p)break;o=o.return}}function Gf(o,u,p,g){var b=o.child;for(b!==null&&(b.return=o);b!==null;){var R=b.dependencies;if(R!==null){var O=b.child;R=R.firstContext;e:for(;R!==null;){var k=R;R=b;for(var $=0;$<u.length;$++)if(k.context===u[$]){R.lanes|=p,k=R.alternate,k!==null&&(k.lanes|=p),Iy(R.return,p,o),g||(O=null);break e}R=k.next}}else if(b.tag===18){if(O=b.return,O===null)throw Error(n(341));O.lanes|=p,R=O.alternate,R!==null&&(R.lanes|=p),Iy(O,p,o),O=null}else O=b.child;if(O!==null)O.return=b;else for(O=b;O!==null;){if(O===o){O=null;break}if(b=O.sibling,b!==null){b.return=O.return,O=b;break}O=O.return}b=O}}function ba(o,u,p,g){o=null;for(var b=u,R=!1;b!==null;){if(!R){if((b.flags&524288)!==0)R=!0;else if((b.flags&262144)!==0)break}if(b.tag===10){var O=b.alternate;if(O===null)throw Error(n(387));if(O=O.memoizedProps,O!==null){var k=b.type;Rr(b.pendingProps.value,O.value)||(o!==null?o.push(k):o=[k])}}else if(b===nt.current){if(O=b.alternate,O===null)throw Error(n(387));O.memoizedState.memoizedState!==b.memoizedState.memoizedState&&(o!==null?o.push(yv):o=[yv])}b=b.return}o!==null&&Gf(u,o,p,g),u.flags|=262144}function Hf(o){for(o=o.firstContext;o!==null;){if(!Rr(o.context._currentValue,o.memoizedValue))return!0;o=o.next}return!1}function Co(o){au=o,pl=null,o=o.dependencies,o!==null&&(o.firstContext=null)}function Gi(o){return Qp(au,o)}function kf(o,u){return au===null&&Co(o),Qp(o,u)}function Qp(o,u){var p=u._currentValue;if(u={context:u,memoizedValue:p,next:null},pl===null){if(o===null)throw Error(n(308));pl=u,o.dependencies={lanes:0,firstContext:u},o.flags|=524288}else pl=pl.next=u;return p}var Fy=typeof AbortController<"u"?AbortController:function(){var o=[],u=this.signal={aborted:!1,addEventListener:function(p,g){o.push(g)}};this.abort=function(){u.aborted=!0,o.forEach(function(p){return p()})}},lM=r.unstable_scheduleCallback,I0=r.unstable_NormalPriority,ss={$$typeof:w,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function Jp(){return{controller:new Fy,data:new Map,refCount:0}}function lh(o){o.refCount--,o.refCount===0&&lM(I0,function(){o.controller.abort()})}var uh=null,qf=0,un=0,ch=null;function jr(o,u){if(uh===null){var p=uh=[];qf=0,un=vM(),ch={status:"pending",value:void 0,then:function(g){p.push(g)}}}return qf++,u.then($p,$p),u}function $p(){if(--qf===0&&uh!==null){ch!==null&&(ch.status="fulfilled");var o=uh;uh=null,un=0,ch=null;for(var u=0;u<o.length;u++)(0,o[u])()}}function uM(o,u){var p=[],g={status:"pending",value:null,reason:null,then:function(b){p.push(b)}};return o.then(function(){g.status="fulfilled",g.value=u;for(var b=0;b<p.length;b++)(0,p[b])(u)},function(b){for(g.status="rejected",g.reason=b,b=0;b<p.length;b++)(0,p[b])(void 0)}),g}var Wf=V.S;V.S=function(o,u){typeof u=="object"&&u!==null&&typeof u.then=="function"&&jr(o,u),Wf!==null&&Wf(o,u)};var Ta=re(null);function lu(){var o=Ta.current;return o!==null?o:sn.pooledCache}function Xf(o,u){u===null?Fe(Ta,Ta.current):Fe(Ta,u.pool)}function em(){var o=lu();return o===null?null:{parent:ss._currentValue,pool:o}}var Yf=Error(n(460)),zy=Error(n(474)),io=Error(n(542)),jf={then:function(){}};function tm(o){return o=o.status,o==="fulfilled"||o==="rejected"}function hh(){}function nm(o,u,p){switch(p=o[p],p===void 0?o.push(u):p!==u&&(u.then(hh,hh),u=p),u.status){case"fulfilled":return u.value;case"rejected":throw o=u.reason,F0(o),o;default:if(typeof u.status=="string")u.then(hh,hh);else{if(o=sn,o!==null&&100<o.shellSuspendCounter)throw Error(n(482));o=u,o.status="pending",o.then(function(g){if(u.status==="pending"){var b=u;b.status="fulfilled",b.value=g}},function(g){if(u.status==="pending"){var b=u;b.status="rejected",b.reason=g}})}switch(u.status){case"fulfilled":return u.value;case"rejected":throw o=u.reason,F0(o),o}throw Ma=u,Yf}}var Ma=null;function Vy(){if(Ma===null)throw Error(n(459));var o=Ma;return Ma=null,o}function F0(o){if(o===Yf||o===io)throw Error(n(483))}var gl=!1;function Gy(o){o.updateQueue={baseState:o.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function jt(o,u){o=o.updateQueue,u.updateQueue===o&&(u.updateQueue={baseState:o.baseState,firstBaseUpdate:o.firstBaseUpdate,lastBaseUpdate:o.lastBaseUpdate,shared:o.shared,callbacks:null})}function wo(o){return{lane:o,tag:0,payload:null,callback:null,next:null}}function yl(o,u,p){var g=o.updateQueue;if(g===null)return null;if(g=g.shared,(Wn&2)!==0){var b=g.pending;return b===null?u.next=u:(u.next=b.next,b.next=u),g.pending=u,u=sh(o),wy(o,null,p),u}return tu(o,g,u,p),sh(o)}function $u(o,u,p){if(u=u.updateQueue,u!==null&&(u=u.shared,(p&4194048)!==0)){var g=u.lanes;g&=o.pendingLanes,p|=g,u.lanes=p,Jt(o,p)}}function fh(o,u){var p=o.updateQueue,g=o.alternate;if(g!==null&&(g=g.updateQueue,p===g)){var b=null,R=null;if(p=p.firstBaseUpdate,p!==null){do{var O={lane:p.lane,tag:p.tag,payload:p.payload,callback:null,next:null};R===null?b=R=O:R=R.next=O,p=p.next}while(p!==null);R===null?b=R=u:R=R.next=u}else b=R=u;p={baseState:g.baseState,firstBaseUpdate:b,lastBaseUpdate:R,shared:g.shared,callbacks:g.callbacks},o.updateQueue=p;return}o=p.lastBaseUpdate,o===null?p.firstBaseUpdate=u:o.next=u,p.lastBaseUpdate=u}var Hy=!1;function Zf(){if(Hy){var o=ch;if(o!==null)throw o}}function dh(o,u,p,g){Hy=!1;var b=o.updateQueue;gl=!1;var R=b.firstBaseUpdate,O=b.lastBaseUpdate,k=b.shared.pending;if(k!==null){b.shared.pending=null;var $=k,Te=$.next;$.next=null,O===null?R=Te:O.next=Te,O=$;var We=o.alternate;We!==null&&(We=We.updateQueue,k=We.lastBaseUpdate,k!==O&&(k===null?We.firstBaseUpdate=Te:k.next=Te,We.lastBaseUpdate=$))}if(R!==null){var Je=b.baseState;O=0,We=Te=$=null,k=R;do{var Ee=k.lane&-536870913,Ne=Ee!==k.lane;if(Ne?(Vt&Ee)===Ee:(g&Ee)===Ee){Ee!==0&&Ee===un&&(Hy=!0),We!==null&&(We=We.next={lane:0,tag:k.tag,payload:k.payload,callback:null,next:null});e:{var Kt=o,Xt=k;Ee=u;var vi=p;switch(Xt.tag){case 1:if(Kt=Xt.payload,typeof Kt=="function"){Je=Kt.call(vi,Je,Ee);break e}Je=Kt;break e;case 3:Kt.flags=Kt.flags&-65537|128;case 0:if(Kt=Xt.payload,Ee=typeof Kt=="function"?Kt.call(vi,Je,Ee):Kt,Ee==null)break e;Je=m({},Je,Ee);break e;case 2:gl=!0}}Ee=k.callback,Ee!==null&&(o.flags|=64,Ne&&(o.flags|=8192),Ne=b.callbacks,Ne===null?b.callbacks=[Ee]:Ne.push(Ee))}else Ne={lane:Ee,tag:k.tag,payload:k.payload,callback:k.callback,next:null},We===null?(Te=We=Ne,$=Je):We=We.next=Ne,O|=Ee;if(k=k.next,k===null){if(k=b.shared.pending,k===null)break;Ne=k,k=Ne.next,Ne.next=null,b.lastBaseUpdate=Ne,b.shared.pending=null}}while(!0);We===null&&($=Je),b.baseState=$,b.firstBaseUpdate=Te,b.lastBaseUpdate=We,R===null&&(b.shared.lanes=0),ho|=O,o.lanes=O,o.memoizedState=Je}}function ph(o,u){if(typeof o!="function")throw Error(n(191,o));o.call(u)}function z0(o,u){var p=o.callbacks;if(p!==null)for(o.callbacks=null,o=0;o<p.length;o++)ph(p[o],u)}var mh=re(null),im=re(0);function V0(o,u){o=wa,Fe(im,o),Fe(mh,u),wa=o|u.baseLanes}function ky(){Fe(im,wa),Fe(mh,mh.current)}function Kf(){wa=im.current,we(mh),we(im)}var vl=0,cn=null,Jn=null,rs=null,sm=!1,uu=!1,fr=!1,ms=0,Ea=0,Hs=null,G0=0;function Zi(){throw Error(n(321))}function $s(o,u){if(u===null)return!1;for(var p=0;p<u.length&&p<o.length;p++)if(!Rr(o[p],u[p]))return!1;return!0}function _l(o,u,p,g,b,R){return vl=R,cn=u,u.memoizedState=null,u.updateQueue=null,u.lanes=0,V.H=o===null||o.memoizedState===null?dm:rv,fr=!1,R=p(g,b),fr=!1,uu&&(R=k0(u,p,g,b)),H0(o),R}function H0(o){V.H=$f;var u=Jn!==null&&Jn.next!==null;if(vl=0,rs=Jn=cn=null,sm=!1,Ea=0,Hs=null,u)throw Error(n(300));o===null||Ns||(o=o.dependencies,o!==null&&Hf(o)&&(Ns=!0))}function k0(o,u,p,g){cn=o;var b=0;do{if(uu&&(Hs=null),Ea=0,uu=!1,25<=b)throw Error(n(301));if(b+=1,rs=Jn=null,o.updateQueue!=null){var R=o.updateQueue;R.lastEffect=null,R.events=null,R.stores=null,R.memoCache!=null&&(R.memoCache.index=0)}V.H=mx,R=u(p,g)}while(uu);return R}function cM(){var o=V.H,u=o.useState()[0];return u=typeof u.then=="function"?so(u):u,o=o.useState()[0],(Jn!==null?Jn.memoizedState:null)!==o&&(cn.flags|=1024),u}function qy(){var o=ms!==0;return ms=0,o}function rm(o,u,p){u.updateQueue=o.updateQueue,u.flags&=-2053,o.lanes&=~p}function Wy(o){if(sm){for(o=o.memoizedState;o!==null;){var u=o.queue;u!==null&&(u.pending=null),o=o.next}sm=!1}vl=0,rs=Jn=cn=null,uu=!1,Ea=ms=0,Hs=null}function dr(){var o={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return rs===null?cn.memoizedState=rs=o:rs=rs.next=o,rs}function as(){if(Jn===null){var o=cn.alternate;o=o!==null?o.memoizedState:null}else o=Jn.next;var u=rs===null?cn.memoizedState:rs.next;if(u!==null)rs=u,Jn=o;else{if(o===null)throw cn.alternate===null?Error(n(467)):Error(n(310));Jn=o,o={memoizedState:Jn.memoizedState,baseState:Jn.baseState,baseQueue:Jn.baseQueue,queue:Jn.queue,next:null},rs===null?cn.memoizedState=rs=o:rs=rs.next=o}return rs}function cu(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function so(o){var u=Ea;return Ea+=1,Hs===null&&(Hs=[]),o=nm(Hs,o,u),u=cn,(rs===null?u.memoizedState:rs.next)===null&&(u=u.alternate,V.H=u===null||u.memoizedState===null?dm:rv),o}function am(o){if(o!==null&&typeof o=="object"){if(typeof o.then=="function")return so(o);if(o.$$typeof===w)return Gi(o)}throw Error(n(438,String(o)))}function Xy(o){var u=null,p=cn.updateQueue;if(p!==null&&(u=p.memoCache),u==null){var g=cn.alternate;g!==null&&(g=g.updateQueue,g!==null&&(g=g.memoCache,g!=null&&(u={data:g.data.map(function(b){return b.slice()}),index:0})))}if(u==null&&(u={data:[],index:0}),p===null&&(p=cu(),cn.updateQueue=p),p.memoCache=u,p=u.data[u.index],p===void 0)for(p=u.data[u.index]=Array(o),g=0;g<o;g++)p[g]=P;return u.index++,p}function xl(o,u){return typeof u=="function"?u(o):u}function hu(o){var u=as();return Yy(u,Jn,o)}function Yy(o,u,p){var g=o.queue;if(g===null)throw Error(n(311));g.lastRenderedReducer=p;var b=o.baseQueue,R=g.pending;if(R!==null){if(b!==null){var O=b.next;b.next=R.next,R.next=O}u.baseQueue=b=R,g.pending=null}if(R=o.baseState,b===null)o.memoizedState=R;else{u=b.next;var k=O=null,$=null,Te=u,We=!1;do{var Je=Te.lane&-536870913;if(Je!==Te.lane?(Vt&Je)===Je:(vl&Je)===Je){var Ee=Te.revertLane;if(Ee===0)$!==null&&($=$.next={lane:0,revertLane:0,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null}),Je===un&&(We=!0);else if((vl&Ee)===Ee){Te=Te.next,Ee===un&&(We=!0);continue}else Je={lane:0,revertLane:Te.revertLane,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null},$===null?(k=$=Je,O=R):$=$.next=Je,cn.lanes|=Ee,ho|=Ee;Je=Te.action,fr&&p(R,Je),R=Te.hasEagerState?Te.eagerState:p(R,Je)}else Ee={lane:Je,revertLane:Te.revertLane,action:Te.action,hasEagerState:Te.hasEagerState,eagerState:Te.eagerState,next:null},$===null?(k=$=Ee,O=R):$=$.next=Ee,cn.lanes|=Je,ho|=Je;Te=Te.next}while(Te!==null&&Te!==u);if($===null?O=R:$.next=k,!Rr(R,o.memoizedState)&&(Ns=!0,We&&(p=ch,p!==null)))throw p;o.memoizedState=R,o.baseState=O,o.baseQueue=$,g.lastRenderedState=R}return b===null&&(g.lanes=0),[o.memoizedState,g.dispatch]}function jy(o){var u=as(),p=u.queue;if(p===null)throw Error(n(311));p.lastRenderedReducer=o;var g=p.dispatch,b=p.pending,R=u.memoizedState;if(b!==null){p.pending=null;var O=b=b.next;do R=o(R,O.action),O=O.next;while(O!==b);Rr(R,u.memoizedState)||(Ns=!0),u.memoizedState=R,u.baseQueue===null&&(u.baseState=R),p.lastRenderedState=R}return[R,g]}function q0(o,u,p){var g=cn,b=as(),R=Vn;if(R){if(p===void 0)throw Error(n(407));p=p()}else p=u();var O=!Rr((Jn||b).memoizedState,p);O&&(b.memoizedState=p,Ns=!0),b=b.queue;var k=X0.bind(null,g,b,o);if(vh(2048,8,k,[o]),b.getSnapshot!==u||O||rs!==null&&rs.memoizedState.tag&1){if(g.flags|=2048,yh(9,Qf(),W0.bind(null,g,b,p,u),null),sn===null)throw Error(n(349));R||(vl&124)!==0||gh(g,u,p)}return p}function gh(o,u,p){o.flags|=16384,o={getSnapshot:u,value:p},u=cn.updateQueue,u===null?(u=cu(),cn.updateQueue=u,u.stores=[o]):(p=u.stores,p===null?u.stores=[o]:p.push(o))}function W0(o,u,p,g){u.value=p,u.getSnapshot=g,Y0(u)&&j0(o)}function X0(o,u,p){return p(function(){Y0(u)&&j0(o)})}function Y0(o){var u=o.getSnapshot;o=o.value;try{var p=u();return!Rr(o,p)}catch{return!0}}function j0(o){var u=fl(o,2);u!==null&&gr(u,o,2)}function Zy(o){var u=dr();if(typeof o=="function"){var p=o;if(o=p(),fr){it(!0);try{p()}finally{it(!1)}}}return u.memoizedState=u.baseState=o,u.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:xl,lastRenderedState:o},u}function Z0(o,u,p,g){return o.baseState=p,Yy(o,Jn,typeof g=="function"?g:xl)}function hM(o,u,p,g,b){if(fm(o))throw Error(n(485));if(o=u.action,o!==null){var R={payload:b,action:o,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(O){R.listeners.push(O)}};V.T!==null?p(!0):R.isTransition=!1,g(R),p=u.pending,p===null?(R.next=u.pending=R,K0(u,R)):(R.next=p.next,u.pending=p.next=R)}}function K0(o,u){var p=u.action,g=u.payload,b=o.state;if(u.isTransition){var R=V.T,O={};V.T=O;try{var k=p(b,g),$=V.S;$!==null&&$(O,k),Q0(o,u,k)}catch(Te){Ky(o,u,Te)}finally{V.T=R}}else try{R=p(b,g),Q0(o,u,R)}catch(Te){Ky(o,u,Te)}}function Q0(o,u,p){p!==null&&typeof p=="object"&&typeof p.then=="function"?p.then(function(g){J0(o,u,g)},function(g){return Ky(o,u,g)}):J0(o,u,p)}function J0(o,u,p){u.status="fulfilled",u.value=p,$0(u),o.state=p,u=o.pending,u!==null&&(p=u.next,p===u?o.pending=null:(p=p.next,u.next=p,K0(o,p)))}function Ky(o,u,p){var g=o.pending;if(o.pending=null,g!==null){g=g.next;do u.status="rejected",u.reason=p,$0(u),u=u.next;while(u!==g)}o.action=null}function $0(o){o=o.listeners;for(var u=0;u<o.length;u++)(0,o[u])()}function Qy(o,u){return u}function ex(o,u){if(Vn){var p=sn.formState;if(p!==null){e:{var g=cn;if(Vn){if(Oi){t:{for(var b=Oi,R=Yr;b.nodeType!==8;){if(!R){b=null;break t}if(b=Rl(b.nextSibling),b===null){b=null;break t}}R=b.data,b=R==="F!"||R==="F"?b:null}if(b){Oi=Rl(b.nextSibling),g=b.data==="F!";break e}}ru(g)}g=!1}g&&(u=p[0])}}return p=dr(),p.memoizedState=p.baseState=u,g={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Qy,lastRenderedState:u},p.queue=g,p=dx.bind(null,cn,g),g.dispatch=p,g=Zy(!1),R=hm.bind(null,cn,!1,g.queue),g=dr(),b={state:u,dispatch:null,action:o,pending:null},g.queue=b,p=hM.bind(null,cn,b,R,p),b.dispatch=p,g.memoizedState=o,[u,p,!1]}function tx(o){var u=as();return nx(u,Jn,o)}function nx(o,u,p){if(u=Yy(o,u,Qy)[0],o=hu(xl)[0],typeof u=="object"&&u!==null&&typeof u.then=="function")try{var g=so(u)}catch(O){throw O===Yf?io:O}else g=u;u=as();var b=u.queue,R=b.dispatch;return p!==u.memoizedState&&(cn.flags|=2048,yh(9,Qf(),fM.bind(null,b,p),null)),[g,R,o]}function fM(o,u){o.action=u}function ix(o){var u=as(),p=Jn;if(p!==null)return nx(u,p,o);as(),u=u.memoizedState,p=as();var g=p.queue.dispatch;return p.memoizedState=o,[u,g,!1]}function yh(o,u,p,g){return o={tag:o,create:p,deps:g,inst:u,next:null},u=cn.updateQueue,u===null&&(u=cu(),cn.updateQueue=u),p=u.lastEffect,p===null?u.lastEffect=o.next=o:(g=p.next,p.next=o,o.next=g,u.lastEffect=o),o}function Qf(){return{destroy:void 0,resource:void 0}}function Jy(){return as().memoizedState}function om(o,u,p,g){var b=dr();g=g===void 0?null:g,cn.flags|=o,b.memoizedState=yh(1|u,Qf(),p,g)}function vh(o,u,p,g){var b=as();g=g===void 0?null:g;var R=b.memoizedState.inst;Jn!==null&&g!==null&&$s(g,Jn.memoizedState.deps)?b.memoizedState=yh(u,R,p,g):(cn.flags|=o,b.memoizedState=yh(1|u,R,p,g))}function $y(o,u){om(8390656,8,o,u)}function ev(o,u){vh(2048,8,o,u)}function lm(o,u){return vh(4,2,o,u)}function um(o,u){return vh(4,4,o,u)}function sx(o,u){if(typeof u=="function"){o=o();var p=u(o);return function(){typeof p=="function"?p():u(null)}}if(u!=null)return o=o(),u.current=o,function(){u.current=null}}function rx(o,u,p){p=p!=null?p.concat([o]):null,vh(4,4,sx.bind(null,u,o),p)}function tv(){}function ax(o,u){var p=as();u=u===void 0?null:u;var g=p.memoizedState;return u!==null&&$s(u,g[1])?g[0]:(p.memoizedState=[o,u],o)}function nv(o,u){var p=as();u=u===void 0?null:u;var g=p.memoizedState;if(u!==null&&$s(u,g[1]))return g[0];if(g=o(),fr){it(!0);try{o()}finally{it(!1)}}return p.memoizedState=[g,u],g}function cm(o,u,p){return p===void 0||(vl&1073741824)!==0?o.memoizedState=u:(o.memoizedState=p,o=Mm(),cn.lanes|=o,ho|=o,p)}function ox(o,u,p,g){return Rr(p,u)?p:mh.current!==null?(o=cm(o,p,g),Rr(o,u)||(Ns=!0),o):(vl&42)===0?(Ns=!0,o.memoizedState=p):(o=Mm(),cn.lanes|=o,ho|=o,u)}function lx(o,u,p,g,b){var R=Q.p;Q.p=R!==0&&8>R?R:8;var O=V.T,k={};V.T=k,hm(o,!1,u,p);try{var $=b(),Te=V.S;if(Te!==null&&Te(k,$),$!==null&&typeof $=="object"&&typeof $.then=="function"){var We=uM($,g);Jf(o,u,We,qi(o))}else Jf(o,u,g,qi(o))}catch(Je){Jf(o,u,{then:function(){},status:"rejected",reason:Je},qi())}finally{Q.p=R,V.T=O}}function dM(){}function iv(o,u,p,g){if(o.tag!==5)throw Error(n(476));var b=ux(o).queue;lx(o,b,u,J,p===null?dM:function(){return cx(o),p(g)})}function ux(o){var u=o.memoizedState;if(u!==null)return u;u={memoizedState:J,baseState:J,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xl,lastRenderedState:J},next:null};var p={};return u.next={memoizedState:p,baseState:p,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:xl,lastRenderedState:p},next:null},o.memoizedState=u,o=o.alternate,o!==null&&(o.memoizedState=u),u}function cx(o){var u=ux(o).next.queue;Jf(o,u,{},qi())}function sv(){return Gi(yv)}function hx(){return as().memoizedState}function fx(){return as().memoizedState}function pM(o){for(var u=o.return;u!==null;){switch(u.tag){case 24:case 3:var p=qi();o=wo(p);var g=yl(u,o,p);g!==null&&(gr(g,u,p),$u(g,u,p)),u={cache:Jp()},o.payload=u;return}u=u.return}}function mM(o,u,p){var g=qi();p={lane:g,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null},fm(o)?px(u,p):(p=Yp(o,u,p,g),p!==null&&(gr(p,o,g),Zr(p,u,g)))}function dx(o,u,p){var g=qi();Jf(o,u,p,g)}function Jf(o,u,p,g){var b={lane:g,revertLane:0,action:p,hasEagerState:!1,eagerState:null,next:null};if(fm(o))px(u,b);else{var R=o.alternate;if(o.lanes===0&&(R===null||R.lanes===0)&&(R=u.lastRenderedReducer,R!==null))try{var O=u.lastRenderedState,k=R(O,p);if(b.hasEagerState=!0,b.eagerState=k,Rr(k,O))return tu(o,u,b,0),sn===null&&If(),!1}catch{}finally{}if(p=Yp(o,u,b,g),p!==null)return gr(p,o,g),Zr(p,u,g),!0}return!1}function hm(o,u,p,g){if(g={lane:2,revertLane:vM(),action:g,hasEagerState:!1,eagerState:null,next:null},fm(o)){if(u)throw Error(n(479))}else u=Yp(o,p,g,2),u!==null&&gr(u,o,2)}function fm(o){var u=o.alternate;return o===cn||u!==null&&u===cn}function px(o,u){uu=sm=!0;var p=o.pending;p===null?u.next=u:(u.next=p.next,p.next=u),o.pending=u}function Zr(o,u,p){if((p&4194048)!==0){var g=u.lanes;g&=o.pendingLanes,p|=g,u.lanes=p,Jt(o,p)}}var $f={readContext:Gi,use:am,useCallback:Zi,useContext:Zi,useEffect:Zi,useImperativeHandle:Zi,useLayoutEffect:Zi,useInsertionEffect:Zi,useMemo:Zi,useReducer:Zi,useRef:Zi,useState:Zi,useDebugValue:Zi,useDeferredValue:Zi,useTransition:Zi,useSyncExternalStore:Zi,useId:Zi,useHostTransitionStatus:Zi,useFormState:Zi,useActionState:Zi,useOptimistic:Zi,useMemoCache:Zi,useCacheRefresh:Zi},dm={readContext:Gi,use:am,useCallback:function(o,u){return dr().memoizedState=[o,u===void 0?null:u],o},useContext:Gi,useEffect:$y,useImperativeHandle:function(o,u,p){p=p!=null?p.concat([o]):null,om(4194308,4,sx.bind(null,u,o),p)},useLayoutEffect:function(o,u){return om(4194308,4,o,u)},useInsertionEffect:function(o,u){om(4,2,o,u)},useMemo:function(o,u){var p=dr();u=u===void 0?null:u;var g=o();if(fr){it(!0);try{o()}finally{it(!1)}}return p.memoizedState=[g,u],g},useReducer:function(o,u,p){var g=dr();if(p!==void 0){var b=p(u);if(fr){it(!0);try{p(u)}finally{it(!1)}}}else b=u;return g.memoizedState=g.baseState=b,o={pending:null,lanes:0,dispatch:null,lastRenderedReducer:o,lastRenderedState:b},g.queue=o,o=o.dispatch=mM.bind(null,cn,o),[g.memoizedState,o]},useRef:function(o){var u=dr();return o={current:o},u.memoizedState=o},useState:function(o){o=Zy(o);var u=o.queue,p=dx.bind(null,cn,u);return u.dispatch=p,[o.memoizedState,p]},useDebugValue:tv,useDeferredValue:function(o,u){var p=dr();return cm(p,o,u)},useTransition:function(){var o=Zy(!1);return o=lx.bind(null,cn,o.queue,!0,!1),dr().memoizedState=o,[!1,o]},useSyncExternalStore:function(o,u,p){var g=cn,b=dr();if(Vn){if(p===void 0)throw Error(n(407));p=p()}else{if(p=u(),sn===null)throw Error(n(349));(Vt&124)!==0||gh(g,u,p)}b.memoizedState=p;var R={value:p,getSnapshot:u};return b.queue=R,$y(X0.bind(null,g,R,o),[o]),g.flags|=2048,yh(9,Qf(),W0.bind(null,g,R,p,u),null),p},useId:function(){var o=dr(),u=sn.identifierPrefix;if(Vn){var p=No,g=Ro;p=(g&~(1<<32-ot(g)-1)).toString(32)+p,u=""+u+"R"+p,p=ms++,0<p&&(u+="H"+p.toString(32)),u+=""}else p=G0++,u=""+u+"r"+p.toString(32)+"";return o.memoizedState=u},useHostTransitionStatus:sv,useFormState:ex,useActionState:ex,useOptimistic:function(o){var u=dr();u.memoizedState=u.baseState=o;var p={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return u.queue=p,u=hm.bind(null,cn,!0,p),p.dispatch=u,[o,u]},useMemoCache:Xy,useCacheRefresh:function(){return dr().memoizedState=pM.bind(null,cn)}},rv={readContext:Gi,use:am,useCallback:ax,useContext:Gi,useEffect:ev,useImperativeHandle:rx,useInsertionEffect:lm,useLayoutEffect:um,useMemo:nv,useReducer:hu,useRef:Jy,useState:function(){return hu(xl)},useDebugValue:tv,useDeferredValue:function(o,u){var p=as();return ox(p,Jn.memoizedState,o,u)},useTransition:function(){var o=hu(xl)[0],u=as().memoizedState;return[typeof o=="boolean"?o:so(o),u]},useSyncExternalStore:q0,useId:hx,useHostTransitionStatus:sv,useFormState:tx,useActionState:tx,useOptimistic:function(o,u){var p=as();return Z0(p,Jn,o,u)},useMemoCache:Xy,useCacheRefresh:fx},mx={readContext:Gi,use:am,useCallback:ax,useContext:Gi,useEffect:ev,useImperativeHandle:rx,useInsertionEffect:lm,useLayoutEffect:um,useMemo:nv,useReducer:jy,useRef:Jy,useState:function(){return jy(xl)},useDebugValue:tv,useDeferredValue:function(o,u){var p=as();return Jn===null?cm(p,o,u):ox(p,Jn.memoizedState,o,u)},useTransition:function(){var o=jy(xl)[0],u=as().memoizedState;return[typeof o=="boolean"?o:so(o),u]},useSyncExternalStore:q0,useId:hx,useHostTransitionStatus:sv,useFormState:ix,useActionState:ix,useOptimistic:function(o,u){var p=as();return Jn!==null?Z0(p,Jn,o,u):(p.baseState=o,[o,p.queue.dispatch])},useMemoCache:Xy,useCacheRefresh:fx},ec=null,ed=0;function td(o){var u=ed;return ed+=1,ec===null&&(ec=[]),nm(ec,o,u)}function _h(o,u){u=u.props.ref,o.ref=u!==void 0?u:null}function pm(o,u){throw u.$$typeof===y?Error(n(525)):(o=Object.prototype.toString.call(u),Error(n(31,o==="[object Object]"?"object with keys {"+Object.keys(u).join(", ")+"}":o)))}function gx(o){var u=o._init;return u(o._payload)}function yx(o){function u(me,ce){if(o){var be=me.deletions;be===null?(me.deletions=[ce],me.flags|=16):be.push(ce)}}function p(me,ce){if(!o)return null;for(;ce!==null;)u(me,ce),ce=ce.sibling;return null}function g(me){for(var ce=new Map;me!==null;)me.key!==null?ce.set(me.key,me):ce.set(me.index,me),me=me.sibling;return ce}function b(me,ce){return me=ji(me,ce),me.index=0,me.sibling=null,me}function R(me,ce,be){return me.index=be,o?(be=me.alternate,be!==null?(be=be.index,be<ce?(me.flags|=67108866,ce):be):(me.flags|=67108866,ce)):(me.flags|=1048576,ce)}function O(me){return o&&me.alternate===null&&(me.flags|=67108866),me}function k(me,ce,be,Ye){return ce===null||ce.tag!==6?(ce=zf(be,me.mode,Ye),ce.return=me,ce):(ce=b(ce,be),ce.return=me,ce)}function $(me,ce,be,Ye){var At=be.type;return At===S?We(me,ce,be.props.children,Ye,be.key):ce!==null&&(ce.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===H&&gx(At)===ce.type)?(ce=b(ce,be.props),_h(ce,be),ce.return=me,ce):(ce=Rs(be.type,be.key,be.props,null,me.mode,Ye),_h(ce,be),ce.return=me,ce)}function Te(me,ce,be,Ye){return ce===null||ce.tag!==4||ce.stateNode.containerInfo!==be.containerInfo||ce.stateNode.implementation!==be.implementation?(ce=jp(be,me.mode,Ye),ce.return=me,ce):(ce=b(ce,be.children||[]),ce.return=me,ce)}function We(me,ce,be,Ye,At){return ce===null||ce.tag!==7?(ce=iu(be,me.mode,Ye,At),ce.return=me,ce):(ce=b(ce,be),ce.return=me,ce)}function Je(me,ce,be){if(typeof ce=="string"&&ce!==""||typeof ce=="number"||typeof ce=="bigint")return ce=zf(""+ce,me.mode,be),ce.return=me,ce;if(typeof ce=="object"&&ce!==null){switch(ce.$$typeof){case v:return be=Rs(ce.type,ce.key,ce.props,null,me.mode,be),_h(be,ce),be.return=me,be;case x:return ce=jp(ce,me.mode,be),ce.return=me,ce;case H:var Ye=ce._init;return ce=Ye(ce._payload),Je(me,ce,be)}if(Se(ce)||ue(ce))return ce=iu(ce,me.mode,be,null),ce.return=me,ce;if(typeof ce.then=="function")return Je(me,td(ce),be);if(ce.$$typeof===w)return Je(me,kf(me,ce),be);pm(me,ce)}return null}function Ee(me,ce,be,Ye){var At=ce!==null?ce.key:null;if(typeof be=="string"&&be!==""||typeof be=="number"||typeof be=="bigint")return At!==null?null:k(me,ce,""+be,Ye);if(typeof be=="object"&&be!==null){switch(be.$$typeof){case v:return be.key===At?$(me,ce,be,Ye):null;case x:return be.key===At?Te(me,ce,be,Ye):null;case H:return At=be._init,be=At(be._payload),Ee(me,ce,be,Ye)}if(Se(be)||ue(be))return At!==null?null:We(me,ce,be,Ye,null);if(typeof be.then=="function")return Ee(me,ce,td(be),Ye);if(be.$$typeof===w)return Ee(me,ce,kf(me,be),Ye);pm(me,be)}return null}function Ne(me,ce,be,Ye,At){if(typeof Ye=="string"&&Ye!==""||typeof Ye=="number"||typeof Ye=="bigint")return me=me.get(be)||null,k(ce,me,""+Ye,At);if(typeof Ye=="object"&&Ye!==null){switch(Ye.$$typeof){case v:return me=me.get(Ye.key===null?be:Ye.key)||null,$(ce,me,Ye,At);case x:return me=me.get(Ye.key===null?be:Ye.key)||null,Te(ce,me,Ye,At);case H:var Cn=Ye._init;return Ye=Cn(Ye._payload),Ne(me,ce,be,Ye,At)}if(Se(Ye)||ue(Ye))return me=me.get(be)||null,We(ce,me,Ye,At,null);if(typeof Ye.then=="function")return Ne(me,ce,be,td(Ye),At);if(Ye.$$typeof===w)return Ne(me,ce,be,kf(ce,Ye),At);pm(ce,Ye)}return null}function Kt(me,ce,be,Ye){for(var At=null,Cn=null,Bt=ce,Yt=ce=0,nr=null;Bt!==null&&Yt<be.length;Yt++){Bt.index>Yt?(nr=Bt,Bt=null):nr=Bt.sibling;var Yn=Ee(me,Bt,be[Yt],Ye);if(Yn===null){Bt===null&&(Bt=nr);break}o&&Bt&&Yn.alternate===null&&u(me,Bt),ce=R(Yn,ce,Yt),Cn===null?At=Yn:Cn.sibling=Yn,Cn=Yn,Bt=nr}if(Yt===be.length)return p(me,Bt),Vn&&dl(me,Yt),At;if(Bt===null){for(;Yt<be.length;Yt++)Bt=Je(me,be[Yt],Ye),Bt!==null&&(ce=R(Bt,ce,Yt),Cn===null?At=Bt:Cn.sibling=Bt,Cn=Bt);return Vn&&dl(me,Yt),At}for(Bt=g(Bt);Yt<be.length;Yt++)nr=Ne(Bt,me,Yt,be[Yt],Ye),nr!==null&&(o&&nr.alternate!==null&&Bt.delete(nr.key===null?Yt:nr.key),ce=R(nr,ce,Yt),Cn===null?At=nr:Cn.sibling=nr,Cn=nr);return o&&Bt.forEach(function(Ph){return u(me,Ph)}),Vn&&dl(me,Yt),At}function Xt(me,ce,be,Ye){if(be==null)throw Error(n(151));for(var At=null,Cn=null,Bt=ce,Yt=ce=0,nr=null,Yn=be.next();Bt!==null&&!Yn.done;Yt++,Yn=be.next()){Bt.index>Yt?(nr=Bt,Bt=null):nr=Bt.sibling;var Ph=Ee(me,Bt,Yn.value,Ye);if(Ph===null){Bt===null&&(Bt=nr);break}o&&Bt&&Ph.alternate===null&&u(me,Bt),ce=R(Ph,ce,Yt),Cn===null?At=Ph:Cn.sibling=Ph,Cn=Ph,Bt=nr}if(Yn.done)return p(me,Bt),Vn&&dl(me,Yt),At;if(Bt===null){for(;!Yn.done;Yt++,Yn=be.next())Yn=Je(me,Yn.value,Ye),Yn!==null&&(ce=R(Yn,ce,Yt),Cn===null?At=Yn:Cn.sibling=Yn,Cn=Yn);return Vn&&dl(me,Yt),At}for(Bt=g(Bt);!Yn.done;Yt++,Yn=be.next())Yn=Ne(Bt,me,Yt,Yn.value,Ye),Yn!==null&&(o&&Yn.alternate!==null&&Bt.delete(Yn.key===null?Yt:Yn.key),ce=R(Yn,ce,Yt),Cn===null?At=Yn:Cn.sibling=Yn,Cn=Yn);return o&&Bt.forEach(function(iF){return u(me,iF)}),Vn&&dl(me,Yt),At}function vi(me,ce,be,Ye){if(typeof be=="object"&&be!==null&&be.type===S&&be.key===null&&(be=be.props.children),typeof be=="object"&&be!==null){switch(be.$$typeof){case v:e:{for(var At=be.key;ce!==null;){if(ce.key===At){if(At=be.type,At===S){if(ce.tag===7){p(me,ce.sibling),Ye=b(ce,be.props.children),Ye.return=me,me=Ye;break e}}else if(ce.elementType===At||typeof At=="object"&&At!==null&&At.$$typeof===H&&gx(At)===ce.type){p(me,ce.sibling),Ye=b(ce,be.props),_h(Ye,be),Ye.return=me,me=Ye;break e}p(me,ce);break}else u(me,ce);ce=ce.sibling}be.type===S?(Ye=iu(be.props.children,me.mode,Ye,be.key),Ye.return=me,me=Ye):(Ye=Rs(be.type,be.key,be.props,null,me.mode,Ye),_h(Ye,be),Ye.return=me,me=Ye)}return O(me);case x:e:{for(At=be.key;ce!==null;){if(ce.key===At)if(ce.tag===4&&ce.stateNode.containerInfo===be.containerInfo&&ce.stateNode.implementation===be.implementation){p(me,ce.sibling),Ye=b(ce,be.children||[]),Ye.return=me,me=Ye;break e}else{p(me,ce);break}else u(me,ce);ce=ce.sibling}Ye=jp(be,me.mode,Ye),Ye.return=me,me=Ye}return O(me);case H:return At=be._init,be=At(be._payload),vi(me,ce,be,Ye)}if(Se(be))return Kt(me,ce,be,Ye);if(ue(be)){if(At=ue(be),typeof At!="function")throw Error(n(150));return be=At.call(be),Xt(me,ce,be,Ye)}if(typeof be.then=="function")return vi(me,ce,td(be),Ye);if(be.$$typeof===w)return vi(me,ce,kf(me,be),Ye);pm(me,be)}return typeof be=="string"&&be!==""||typeof be=="number"||typeof be=="bigint"?(be=""+be,ce!==null&&ce.tag===6?(p(me,ce.sibling),Ye=b(ce,be),Ye.return=me,me=Ye):(p(me,ce),Ye=zf(be,me.mode,Ye),Ye.return=me,me=Ye),O(me)):p(me,ce)}return function(me,ce,be,Ye){try{ed=0;var At=vi(me,ce,be,Ye);return ec=null,At}catch(Bt){if(Bt===Yf||Bt===io)throw Bt;var Cn=wr(29,Bt,null,me.mode);return Cn.lanes=Ye,Cn.return=me,Cn}finally{}}}var tc=yx(!0),vx=yx(!1),ui=re(null),ro=null;function fu(o){var u=o.alternate;Fe(Ki,Ki.current&1),Fe(ui,o),ro===null&&(u===null||mh.current!==null||u.memoizedState!==null)&&(ro=o)}function _x(o){if(o.tag===22){if(Fe(Ki,Ki.current),Fe(ui,o),ro===null){var u=o.alternate;u!==null&&u.memoizedState!==null&&(ro=o)}}else du()}function du(){Fe(Ki,Ki.current),Fe(ui,ui.current)}function Do(o){we(ui),ro===o&&(ro=null),we(Ki)}var Ki=re(0);function Sl(o){for(var u=o;u!==null;){if(u.tag===13){var p=u.memoizedState;if(p!==null&&(p=p.dehydrated,p===null||p.data==="$?"||wM(p)))return u}else if(u.tag===19&&u.memoizedProps.revealOrder!==void 0){if((u.flags&128)!==0)return u}else if(u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return null;u=u.return}u.sibling.return=u.return,u=u.sibling}return null}function pu(o,u,p,g){u=o.memoizedState,p=p(g,u),p=p==null?u:m({},u,p),o.memoizedState=p,o.lanes===0&&(o.updateQueue.baseState=p)}var pr={enqueueSetState:function(o,u,p){o=o._reactInternals;var g=qi(),b=wo(g);b.payload=u,p!=null&&(b.callback=p),u=yl(o,b,g),u!==null&&(gr(u,o,g),$u(u,o,g))},enqueueReplaceState:function(o,u,p){o=o._reactInternals;var g=qi(),b=wo(g);b.tag=1,b.payload=u,p!=null&&(b.callback=p),u=yl(o,b,g),u!==null&&(gr(u,o,g),$u(u,o,g))},enqueueForceUpdate:function(o,u){o=o._reactInternals;var p=qi(),g=wo(p);g.tag=2,u!=null&&(g.callback=u),u=yl(o,g,p),u!==null&&(gr(u,o,p),$u(u,o,p))}};function xx(o,u,p,g,b,R,O){return o=o.stateNode,typeof o.shouldComponentUpdate=="function"?o.shouldComponentUpdate(g,R,O):u.prototype&&u.prototype.isPureReactComponent?!to(p,g)||!to(b,R):!0}function Sx(o,u,p,g){o=u.state,typeof u.componentWillReceiveProps=="function"&&u.componentWillReceiveProps(p,g),typeof u.UNSAFE_componentWillReceiveProps=="function"&&u.UNSAFE_componentWillReceiveProps(p,g),u.state!==o&&pr.enqueueReplaceState(u,u.state,null)}function Uo(o,u){var p=u;if("ref"in u){p={};for(var g in u)g!=="ref"&&(p[g]=u[g])}if(o=o.defaultProps){p===u&&(p=m({},p));for(var b in o)p[b]===void 0&&(p[b]=o[b])}return p}var nc=typeof reportError=="function"?reportError:function(o){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var u=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof o=="object"&&o!==null&&typeof o.message=="string"?String(o.message):String(o),error:o});if(!window.dispatchEvent(u))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",o);return}console.error(o)};function nd(o){nc(o)}function mm(o){console.error(o)}function bx(o){nc(o)}function gm(o,u){try{var p=o.onUncaughtError;p(u.value,{componentStack:u.stack})}catch(g){setTimeout(function(){throw g})}}function Aa(o,u,p){try{var g=o.onCaughtError;g(p.value,{componentStack:p.stack,errorBoundary:u.tag===1?u.stateNode:null})}catch(b){setTimeout(function(){throw b})}}function ym(o,u,p){return p=wo(p),p.tag=3,p.payload={element:null},p.callback=function(){gm(o,u)},p}function Tx(o){return o=wo(o),o.tag=3,o}function vm(o,u,p,g){var b=p.type.getDerivedStateFromError;if(typeof b=="function"){var R=g.value;o.payload=function(){return b(R)},o.callback=function(){Aa(u,p,g)}}var O=p.stateNode;O!==null&&typeof O.componentDidCatch=="function"&&(o.callback=function(){Aa(u,p,g),typeof b!="function"&&(ia===null?ia=new Set([this]):ia.add(this));var k=g.stack;this.componentDidCatch(g.value,{componentStack:k!==null?k:""})})}function gM(o,u,p,g,b){if(p.flags|=32768,g!==null&&typeof g=="object"&&typeof g.then=="function"){if(u=p.alternate,u!==null&&ba(u,p,b,!0),p=ui.current,p!==null){switch(p.tag){case 13:return ro===null?h():p.alternate===null&&Mi===0&&(Mi=3),p.flags&=-257,p.flags|=65536,p.lanes=b,g===jf?p.flags|=16384:(u=p.updateQueue,u===null?p.updateQueue=new Set([g]):u.add(g),Ce(o,g,b)),!1;case 22:return p.flags|=65536,g===jf?p.flags|=16384:(u=p.updateQueue,u===null?(u={transitions:null,markerInstances:null,retryQueue:new Set([g])},p.updateQueue=u):(p=u.retryQueue,p===null?u.retryQueue=new Set([g]):p.add(g)),Ce(o,g,b)),!1}throw Error(n(435,p.tag))}return Ce(o,g,b),h(),!1}if(Vn)return u=ui.current,u!==null?((u.flags&65536)===0&&(u.flags|=256),u.flags|=65536,u.lanes=b,g!==Kp&&(o=Error(n(422),{cause:g}),Ju(Vs(o,p)))):(g!==Kp&&(u=Error(n(423),{cause:g}),Ju(Vs(u,p))),o=o.current.alternate,o.flags|=65536,b&=-b,o.lanes|=b,g=Vs(g,p),b=ym(o.stateNode,g,b),fh(o,b),Mi!==4&&(Mi=2)),!1;var R=Error(n(520),{cause:g});if(R=Vs(R,p),Xn===null?Xn=[R]:Xn.push(R),Mi!==4&&(Mi=2),u===null)return!0;g=Vs(g,p),p=u;do{switch(p.tag){case 3:return p.flags|=65536,o=b&-b,p.lanes|=o,o=ym(p.stateNode,g,o),fh(p,o),!1;case 1:if(u=p.type,R=p.stateNode,(p.flags&128)===0&&(typeof u.getDerivedStateFromError=="function"||R!==null&&typeof R.componentDidCatch=="function"&&(ia===null||!ia.has(R))))return p.flags|=65536,b&=-b,p.lanes|=b,b=Tx(b),vm(b,o,p,g),fh(p,b),!1}p=p.return}while(p!==null);return!1}var Mx=Error(n(461)),Ns=!1;function Qi(o,u,p,g){u.child=o===null?vx(u,null,p,g):tc(u,o.child,p,g)}function Ur(o,u,p,g,b){p=p.render;var R=u.ref;if("ref"in g){var O={};for(var k in g)k!=="ref"&&(O[k]=g[k])}else O=g;return Co(u),g=_l(o,u,p,O,R,b),k=qy(),o!==null&&!Ns?(rm(o,u,b),Cs(o,u,b)):(Vn&&k&&Ly(u),u.flags|=1,Qi(o,u,g,b),u.child)}function Lr(o,u,p,g,b){if(o===null){var R=p.type;return typeof R=="function"&&!Ff(R)&&R.defaultProps===void 0&&p.compare===null?(u.tag=15,u.type=R,av(o,u,R,g,b)):(o=Rs(p.type,null,g,u,u.mode,b),o.ref=u.ref,o.return=u,u.child=o)}if(R=o.child,!id(o,b)){var O=R.memoizedProps;if(p=p.compare,p=p!==null?p:to,p(O,g)&&o.ref===u.ref)return Cs(o,u,b)}return u.flags|=1,o=ji(R,g),o.ref=u.ref,o.return=u,u.child=o}function av(o,u,p,g,b){if(o!==null){var R=o.memoizedProps;if(to(R,g)&&o.ref===u.ref)if(Ns=!1,u.pendingProps=g=R,id(o,b))(o.flags&131072)!==0&&(Ns=!0);else return u.lanes=o.lanes,Cs(o,u,b)}return xh(o,u,p,g,b)}function ic(o,u,p){var g=u.pendingProps,b=g.children,R=o!==null?o.memoizedState:null;if(g.mode==="hidden"){if((u.flags&128)!==0){if(g=R!==null?R.baseLanes|p:p,o!==null){for(b=u.child=o.child,R=0;b!==null;)R=R|b.lanes|b.childLanes,b=b.sibling;u.childLanes=R&~g}else u.childLanes=0,u.child=null;return sc(o,u,g,p)}if((p&536870912)!==0)u.memoizedState={baseLanes:0,cachePool:null},o!==null&&Xf(u,R!==null?R.cachePool:null),R!==null?V0(u,R):ky(),_x(u);else return u.lanes=u.childLanes=536870912,sc(o,u,R!==null?R.baseLanes|p:p,p)}else R!==null?(Xf(u,R.cachePool),V0(u,R),du(),u.memoizedState=null):(o!==null&&Xf(u,null),ky(),du());return Qi(o,u,b,p),u.child}function sc(o,u,p,g){var b=lu();return b=b===null?null:{parent:ss._currentValue,pool:b},u.memoizedState={baseLanes:p,cachePool:b},o!==null&&Xf(u,null),ky(),_x(u),o!==null&&ba(o,u,g,!0),null}function rc(o,u){var p=u.ref;if(p===null)o!==null&&o.ref!==null&&(u.flags|=4194816);else{if(typeof p!="function"&&typeof p!="object")throw Error(n(284));(o===null||o.ref!==p)&&(u.flags|=4194816)}}function xh(o,u,p,g,b){return Co(u),p=_l(o,u,p,g,void 0,b),g=qy(),o!==null&&!Ns?(rm(o,u,b),Cs(o,u,b)):(Vn&&g&&Ly(u),u.flags|=1,Qi(o,u,p,b),u.child)}function Kr(o,u,p,g,b,R){return Co(u),u.updateQueue=null,p=k0(u,g,p,b),H0(o),g=qy(),o!==null&&!Ns?(rm(o,u,R),Cs(o,u,R)):(Vn&&g&&Ly(u),u.flags|=1,Qi(o,u,p,R),u.child)}function Qr(o,u,p,g,b){if(Co(u),u.stateNode===null){var R=nu,O=p.contextType;typeof O=="object"&&O!==null&&(R=Gi(O)),R=new p(g,R),u.memoizedState=R.state!==null&&R.state!==void 0?R.state:null,R.updater=pr,u.stateNode=R,R._reactInternals=u,R=u.stateNode,R.props=g,R.state=u.memoizedState,R.refs={},Gy(u),O=p.contextType,R.context=typeof O=="object"&&O!==null?Gi(O):nu,R.state=u.memoizedState,O=p.getDerivedStateFromProps,typeof O=="function"&&(pu(u,p,O,g),R.state=u.memoizedState),typeof p.getDerivedStateFromProps=="function"||typeof R.getSnapshotBeforeUpdate=="function"||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(O=R.state,typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount(),O!==R.state&&pr.enqueueReplaceState(R,R.state,null),dh(u,g,R,b),Zf(),R.state=u.memoizedState),typeof R.componentDidMount=="function"&&(u.flags|=4194308),g=!0}else if(o===null){R=u.stateNode;var k=u.memoizedProps,$=Uo(p,k);R.props=$;var Te=R.context,We=p.contextType;O=nu,typeof We=="object"&&We!==null&&(O=Gi(We));var Je=p.getDerivedStateFromProps;We=typeof Je=="function"||typeof R.getSnapshotBeforeUpdate=="function",k=u.pendingProps!==k,We||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(k||Te!==O)&&Sx(u,R,g,O),gl=!1;var Ee=u.memoizedState;R.state=Ee,dh(u,g,R,b),Zf(),Te=u.memoizedState,k||Ee!==Te||gl?(typeof Je=="function"&&(pu(u,p,Je,g),Te=u.memoizedState),($=gl||xx(u,p,$,g,Ee,Te,O))?(We||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(u.flags|=4194308)):(typeof R.componentDidMount=="function"&&(u.flags|=4194308),u.memoizedProps=g,u.memoizedState=Te),R.props=g,R.state=Te,R.context=O,g=$):(typeof R.componentDidMount=="function"&&(u.flags|=4194308),g=!1)}else{R=u.stateNode,jt(o,u),O=u.memoizedProps,We=Uo(p,O),R.props=We,Je=u.pendingProps,Ee=R.context,Te=p.contextType,$=nu,typeof Te=="object"&&Te!==null&&($=Gi(Te)),k=p.getDerivedStateFromProps,(Te=typeof k=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(O!==Je||Ee!==$)&&Sx(u,R,g,$),gl=!1,Ee=u.memoizedState,R.state=Ee,dh(u,g,R,b),Zf();var Ne=u.memoizedState;O!==Je||Ee!==Ne||gl||o!==null&&o.dependencies!==null&&Hf(o.dependencies)?(typeof k=="function"&&(pu(u,p,k,g),Ne=u.memoizedState),(We=gl||xx(u,p,We,g,Ee,Ne,$)||o!==null&&o.dependencies!==null&&Hf(o.dependencies))?(Te||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(g,Ne,$),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(g,Ne,$)),typeof R.componentDidUpdate=="function"&&(u.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(u.flags|=1024)):(typeof R.componentDidUpdate!="function"||O===o.memoizedProps&&Ee===o.memoizedState||(u.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||O===o.memoizedProps&&Ee===o.memoizedState||(u.flags|=1024),u.memoizedProps=g,u.memoizedState=Ne),R.props=g,R.state=Ne,R.context=$,g=We):(typeof R.componentDidUpdate!="function"||O===o.memoizedProps&&Ee===o.memoizedState||(u.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||O===o.memoizedProps&&Ee===o.memoizedState||(u.flags|=1024),g=!1)}return R=g,rc(o,u),g=(u.flags&128)!==0,R||g?(R=u.stateNode,p=g&&typeof p.getDerivedStateFromError!="function"?null:R.render(),u.flags|=1,o!==null&&g?(u.child=tc(u,o.child,null,b),u.child=tc(u,null,p,b)):Qi(o,u,p,b),u.memoizedState=R.state,o=u.child):o=Cs(o,u,b),o}function mu(o,u,p,g){return oh(),u.flags|=256,Qi(o,u,p,g),u.child}var ao={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function oo(o){return{baseLanes:o,cachePool:em()}}function gs(o,u,p){return o=o!==null?o.childLanes&~p:0,u&&(o|=Da),o}function Sh(o,u,p){var g=u.pendingProps,b=!1,R=(u.flags&128)!==0,O;if((O=R)||(O=o!==null&&o.memoizedState===null?!1:(Ki.current&2)!==0),O&&(b=!0,u.flags&=-129),O=(u.flags&32)!==0,u.flags&=-33,o===null){if(Vn){if(b?fu(u):du(),Vn){var k=Oi,$;if($=k){e:{for($=k,k=Yr;$.nodeType!==8;){if(!k){k=null;break e}if($=Rl($.nextSibling),$===null){k=null;break e}}k=$}k!==null?(u.memoizedState={dehydrated:k,treeContext:su!==null?{id:Ro,overflow:No}:null,retryLane:536870912,hydrationErrors:null},$=wr(18,null,null,0),$.stateNode=k,$.return=u,u.child=$,hr=u,Oi=null,$=!0):$=!1}$||ru(u)}if(k=u.memoizedState,k!==null&&(k=k.dehydrated,k!==null))return wM(k)?u.lanes=32:u.lanes=536870912,null;Do(u)}return k=g.children,g=g.fallback,b?(du(),b=u.mode,k=ac({mode:"hidden",children:k},b),g=iu(g,b,p,null),k.return=u,g.return=u,k.sibling=g,u.child=k,b=u.child,b.memoizedState=oo(p),b.childLanes=gs(o,O,p),u.memoizedState=ao,g):(fu(u),Lo(u,k))}if($=o.memoizedState,$!==null&&(k=$.dehydrated,k!==null)){if(R)u.flags&256?(fu(u),u.flags&=-257,u=ks(o,u,p)):u.memoizedState!==null?(du(),u.child=o.child,u.flags|=128,u=null):(du(),b=g.fallback,k=u.mode,g=ac({mode:"visible",children:g.children},k),b=iu(b,k,p,null),b.flags|=2,g.return=u,b.return=u,g.sibling=b,u.child=g,tc(u,o.child,null,p),g=u.child,g.memoizedState=oo(p),g.childLanes=gs(o,O,p),u.memoizedState=ao,u=b);else if(fu(u),wM(k)){if(O=k.nextSibling&&k.nextSibling.dataset,O)var Te=O.dgst;O=Te,g=Error(n(419)),g.stack="",g.digest=O,Ju({value:g,source:null,stack:null}),u=ks(o,u,p)}else if(Ns||ba(o,u,p,!1),O=(p&o.childLanes)!==0,Ns||O){if(O=sn,O!==null&&(g=p&-p,g=(g&42)!==0?1:Qn(g),g=(g&(O.suspendedLanes|p))!==0?0:g,g!==0&&g!==$.retryLane))throw $.retryLane=g,fl(o,g),gr(O,o,g),Mx;k.data==="$?"||h(),u=ks(o,u,p)}else k.data==="$?"?(u.flags|=192,u.child=o.child,u=null):(o=$.treeContext,Oi=Rl(k.nextSibling),hr=u,Vn=!0,Sa=null,Yr=!1,o!==null&&(Gs[Xr++]=Ro,Gs[Xr++]=No,Gs[Xr++]=su,Ro=o.id,No=o.overflow,su=u),u=Lo(u,g.children),u.flags|=4096);return u}return b?(du(),b=g.fallback,k=u.mode,$=o.child,Te=$.sibling,g=ji($,{mode:"hidden",children:g.children}),g.subtreeFlags=$.subtreeFlags&65011712,Te!==null?b=ji(Te,b):(b=iu(b,k,p,null),b.flags|=2),b.return=u,g.return=u,g.sibling=b,u.child=g,g=b,b=u.child,k=o.child.memoizedState,k===null?k=oo(p):($=k.cachePool,$!==null?(Te=ss._currentValue,$=$.parent!==Te?{parent:Te,pool:Te}:$):$=em(),k={baseLanes:k.baseLanes|p,cachePool:$}),b.memoizedState=k,b.childLanes=gs(o,O,p),u.memoizedState=ao,g):(fu(u),p=o.child,o=p.sibling,p=ji(p,{mode:"visible",children:g.children}),p.return=u,p.sibling=null,o!==null&&(O=u.deletions,O===null?(u.deletions=[o],u.flags|=16):O.push(o)),u.child=p,u.memoizedState=null,p)}function Lo(o,u){return u=ac({mode:"visible",children:u},o.mode),u.return=o,o.child=u}function ac(o,u){return o=wr(22,o,null,u),o.lanes=0,o.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},o}function ks(o,u,p){return tc(u,o.child,null,p),o=Lo(u,u.pendingProps.children),o.flags|=2,u.memoizedState=null,o}function qs(o,u,p){o.lanes|=u;var g=o.alternate;g!==null&&(g.lanes|=u),Iy(o.return,u,p)}function Bn(o,u,p,g,b){var R=o.memoizedState;R===null?o.memoizedState={isBackwards:u,rendering:null,renderingStartTime:0,last:g,tail:p,tailMode:b}:(R.isBackwards=u,R.rendering=null,R.renderingStartTime=0,R.last=g,R.tail=p,R.tailMode=b)}function Ra(o,u,p){var g=u.pendingProps,b=g.revealOrder,R=g.tail;if(Qi(o,u,g.children,p),g=Ki.current,(g&2)!==0)g=g&1|2,u.flags|=128;else{if(o!==null&&(o.flags&128)!==0)e:for(o=u.child;o!==null;){if(o.tag===13)o.memoizedState!==null&&qs(o,p,u);else if(o.tag===19)qs(o,p,u);else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===u)break e;for(;o.sibling===null;){if(o.return===null||o.return===u)break e;o=o.return}o.sibling.return=o.return,o=o.sibling}g&=1}switch(Fe(Ki,g),b){case"forwards":for(p=u.child,b=null;p!==null;)o=p.alternate,o!==null&&Sl(o)===null&&(b=p),p=p.sibling;p=b,p===null?(b=u.child,u.child=null):(b=p.sibling,p.sibling=null),Bn(u,!1,b,p,R);break;case"backwards":for(p=null,b=u.child,u.child=null;b!==null;){if(o=b.alternate,o!==null&&Sl(o)===null){u.child=b;break}o=b.sibling,b.sibling=p,p=b,b=o}Bn(u,!0,p,null,R);break;case"together":Bn(u,!1,null,null,void 0);break;default:u.memoizedState=null}return u.child}function Cs(o,u,p){if(o!==null&&(u.dependencies=o.dependencies),ho|=u.lanes,(p&u.childLanes)===0)if(o!==null){if(ba(o,u,p,!1),(p&u.childLanes)===0)return null}else return null;if(o!==null&&u.child!==o.child)throw Error(n(153));if(u.child!==null){for(o=u.child,p=ji(o,o.pendingProps),u.child=p,p.return=u;o.sibling!==null;)o=o.sibling,p=p.sibling=ji(o,o.pendingProps),p.return=u;p.sibling=null}return u.child}function id(o,u){return(o.lanes&u)!==0?!0:(o=o.dependencies,!!(o!==null&&Hf(o)))}function Na(o,u,p){switch(u.tag){case 3:lt(u,u.stateNode.containerInfo),ou(u,ss,o.memoizedState.cache),oh();break;case 27:case 5:Pt(u);break;case 4:lt(u,u.stateNode.containerInfo);break;case 10:ou(u,u.type,u.memoizedProps.value);break;case 13:var g=u.memoizedState;if(g!==null)return g.dehydrated!==null?(fu(u),u.flags|=128,null):(p&u.child.childLanes)!==0?Sh(o,u,p):(fu(u),o=Cs(o,u,p),o!==null?o.sibling:null);fu(u);break;case 19:var b=(o.flags&128)!==0;if(g=(p&u.childLanes)!==0,g||(ba(o,u,p,!1),g=(p&u.childLanes)!==0),b){if(g)return Ra(o,u,p);u.flags|=128}if(b=u.memoizedState,b!==null&&(b.rendering=null,b.tail=null,b.lastEffect=null),Fe(Ki,Ki.current),g)break;return null;case 22:case 23:return u.lanes=0,ic(o,u,p);case 24:ou(u,ss,o.memoizedState.cache)}return Cs(o,u,p)}function oc(o,u,p){if(o!==null)if(o.memoizedProps!==u.pendingProps)Ns=!0;else{if(!id(o,p)&&(u.flags&128)===0)return Ns=!1,Na(o,u,p);Ns=(o.flags&131072)!==0}else Ns=!1,Vn&&(u.flags&1048576)!==0&&Zp(u,ah,u.index);switch(u.lanes=0,u.tag){case 16:e:{o=u.pendingProps;var g=u.elementType,b=g._init;if(g=b(g._payload),u.type=g,typeof g=="function")Ff(g)?(o=Uo(g,o),u.tag=1,u=Qr(null,u,g,o,p)):(u.tag=0,u=xh(null,u,g,o,p));else{if(g!=null){if(b=g.$$typeof,b===D){u.tag=11,u=Ur(null,u,g,o,p);break e}else if(b===F){u.tag=14,u=Lr(null,u,g,o,p);break e}}throw u=pe(g)||g,Error(n(306,u,""))}}return u;case 0:return xh(o,u,u.type,u.pendingProps,p);case 1:return g=u.type,b=Uo(g,u.pendingProps),Qr(o,u,g,b,p);case 3:e:{if(lt(u,u.stateNode.containerInfo),o===null)throw Error(n(387));g=u.pendingProps;var R=u.memoizedState;b=R.element,jt(o,u),dh(u,g,null,p);var O=u.memoizedState;if(g=O.cache,ou(u,ss,g),g!==R.cache&&Gf(u,[ss],p,!0),Zf(),g=O.element,R.isDehydrated)if(R={element:g,isDehydrated:!1,cache:O.cache},u.updateQueue.baseState=R,u.memoizedState=R,u.flags&256){u=mu(o,u,g,p);break e}else if(g!==b){b=Vs(Error(n(424)),u),Ju(b),u=mu(o,u,g,p);break e}else{switch(o=u.stateNode.containerInfo,o.nodeType){case 9:o=o.body;break;default:o=o.nodeName==="HTML"?o.ownerDocument.body:o}for(Oi=Rl(o.firstChild),hr=u,Vn=!0,Sa=null,Yr=!0,p=vx(u,null,g,p),u.child=p;p;)p.flags=p.flags&-3|4096,p=p.sibling}else{if(oh(),g===b){u=Cs(o,u,p);break e}Qi(o,u,g,p)}u=u.child}return u;case 26:return rc(o,u),o===null?(p=oC(u.type,null,u.pendingProps,null))?u.memoizedState=p:Vn||(p=u.type,o=u.pendingProps,g=wx(je.current).createElement(p),g[ts]=u,g[ps]=o,yr(g,p,o),ns(g),u.stateNode=g):u.memoizedState=oC(u.type,o.memoizedProps,u.pendingProps,o.memoizedState),null;case 27:return Pt(u),o===null&&Vn&&(g=u.stateNode=sC(u.type,u.pendingProps,je.current),hr=u,Yr=!0,b=Oi,Dh(u.type)?(DM=b,Oi=Rl(g.firstChild)):Oi=b),Qi(o,u,u.pendingProps.children,p),rc(o,u),o===null&&(u.flags|=4194304),u.child;case 5:return o===null&&Vn&&((b=g=Oi)&&(g=UI(g,u.type,u.pendingProps,Yr),g!==null?(u.stateNode=g,hr=u,Oi=Rl(g.firstChild),Yr=!1,b=!0):b=!1),b||ru(u)),Pt(u),b=u.type,R=u.pendingProps,O=o!==null?o.memoizedProps:null,g=R.children,RM(b,R)?g=null:O!==null&&RM(b,O)&&(u.flags|=32),u.memoizedState!==null&&(b=_l(o,u,cM,null,null,p),yv._currentValue=b),rc(o,u),Qi(o,u,g,p),u.child;case 6:return o===null&&Vn&&((o=p=Oi)&&(p=LI(p,u.pendingProps,Yr),p!==null?(u.stateNode=p,hr=u,Oi=null,o=!0):o=!1),o||ru(u)),null;case 13:return Sh(o,u,p);case 4:return lt(u,u.stateNode.containerInfo),g=u.pendingProps,o===null?u.child=tc(u,null,g,p):Qi(o,u,g,p),u.child;case 11:return Ur(o,u,u.type,u.pendingProps,p);case 7:return Qi(o,u,u.pendingProps,p),u.child;case 8:return Qi(o,u,u.pendingProps.children,p),u.child;case 12:return Qi(o,u,u.pendingProps.children,p),u.child;case 10:return g=u.pendingProps,ou(u,u.type,g.value),Qi(o,u,g.children,p),u.child;case 9:return b=u.type._context,g=u.pendingProps.children,Co(u),b=Gi(b),g=g(b),u.flags|=1,Qi(o,u,g,p),u.child;case 14:return Lr(o,u,u.type,u.pendingProps,p);case 15:return av(o,u,u.type,u.pendingProps,p);case 19:return Ra(o,u,p);case 31:return g=u.pendingProps,p=u.mode,g={mode:g.mode,children:g.children},o===null?(p=ac(g,p),p.ref=u.ref,u.child=p,p.return=u,u=p):(p=ji(o.child,g),p.ref=u.ref,u.child=p,p.return=u,u=p),u;case 22:return ic(o,u,p);case 24:return Co(u),g=Gi(ss),o===null?(b=lu(),b===null&&(b=sn,R=Jp(),b.pooledCache=R,R.refCount++,R!==null&&(b.pooledCacheLanes|=p),b=R),u.memoizedState={parent:g,cache:b},Gy(u),ou(u,ss,b)):((o.lanes&p)!==0&&(jt(o,u),dh(u,null,null,p),Zf()),b=o.memoizedState,R=u.memoizedState,b.parent!==g?(b={parent:g,cache:g},u.memoizedState=b,u.lanes===0&&(u.memoizedState=u.updateQueue.baseState=b),ou(u,ss,g)):(g=R.cache,ou(u,ss,g),g!==b.cache&&Gf(u,[ss],p,!0))),Qi(o,u,u.pendingProps.children,p),u.child;case 29:throw u.pendingProps}throw Error(n(156,u.tag))}function lo(o){o.flags|=4}function sd(o,u){if(u.type!=="stylesheet"||(u.state.loading&4)!==0)o.flags&=-16777217;else if(o.flags|=16777216,!fC(u)){if(u=ui.current,u!==null&&((Vt&4194048)===Vt?ro!==null:(Vt&62914560)!==Vt&&(Vt&536870912)===0||u!==ro))throw Ma=jf,zy;o.flags|=8192}}function bl(o,u){u!==null&&(o.flags|=4),o.flags&16384&&(u=o.tag!==22?mt():536870912,o.lanes|=u,Fn|=u)}function lc(o,u){if(!Vn)switch(o.tailMode){case"hidden":u=o.tail;for(var p=null;u!==null;)u.alternate!==null&&(p=u),u=u.sibling;p===null?o.tail=null:p.sibling=null;break;case"collapsed":p=o.tail;for(var g=null;p!==null;)p.alternate!==null&&(g=p),p=p.sibling;g===null?u||o.tail===null?o.tail=null:o.tail.sibling=null:g.sibling=null}}function pi(o){var u=o.alternate!==null&&o.alternate.child===o.child,p=0,g=0;if(u)for(var b=o.child;b!==null;)p|=b.lanes|b.childLanes,g|=b.subtreeFlags&65011712,g|=b.flags&65011712,b.return=o,b=b.sibling;else for(b=o.child;b!==null;)p|=b.lanes|b.childLanes,g|=b.subtreeFlags,g|=b.flags,b.return=o,b=b.sibling;return o.subtreeFlags|=g,o.childLanes=p,u}function ov(o,u,p){var g=u.pendingProps;switch(By(u),u.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return pi(u),null;case 1:return pi(u),null;case 3:return p=u.stateNode,g=null,o!==null&&(g=o.memoizedState.cache),u.memoizedState.cache!==g&&(u.flags|=2048),ml(ss),nn(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(o===null||o.child===null)&&(no(u)?lo(u):o===null||o.memoizedState.isDehydrated&&(u.flags&256)===0||(u.flags|=1024,qn())),pi(u),null;case 26:return p=u.memoizedState,o===null?(lo(u),p!==null?(pi(u),sd(u,p)):(pi(u),u.flags&=-16777217)):p?p!==o.memoizedState?(lo(u),pi(u),sd(u,p)):(pi(u),u.flags&=-16777217):(o.memoizedProps!==g&&lo(u),pi(u),u.flags&=-16777217),null;case 27:mn(u),p=je.current;var b=u.type;if(o!==null&&u.stateNode!=null)o.memoizedProps!==g&&lo(u);else{if(!g){if(u.stateNode===null)throw Error(n(166));return pi(u),null}o=oe.current,no(u)?P0(u):(o=sC(b,g,p),u.stateNode=o,lo(u))}return pi(u),null;case 5:if(mn(u),p=u.type,o!==null&&u.stateNode!=null)o.memoizedProps!==g&&lo(u);else{if(!g){if(u.stateNode===null)throw Error(n(166));return pi(u),null}if(o=oe.current,no(u))P0(u);else{switch(b=wx(je.current),o){case 1:o=b.createElementNS("http://www.w3.org/2000/svg",p);break;case 2:o=b.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;default:switch(p){case"svg":o=b.createElementNS("http://www.w3.org/2000/svg",p);break;case"math":o=b.createElementNS("http://www.w3.org/1998/Math/MathML",p);break;case"script":o=b.createElement("div"),o.innerHTML="<script><\/script>",o=o.removeChild(o.firstChild);break;case"select":o=typeof g.is=="string"?b.createElement("select",{is:g.is}):b.createElement("select"),g.multiple?o.multiple=!0:g.size&&(o.size=g.size);break;default:o=typeof g.is=="string"?b.createElement(p,{is:g.is}):b.createElement(p)}}o[ts]=u,o[ps]=g;e:for(b=u.child;b!==null;){if(b.tag===5||b.tag===6)o.appendChild(b.stateNode);else if(b.tag!==4&&b.tag!==27&&b.child!==null){b.child.return=b,b=b.child;continue}if(b===u)break e;for(;b.sibling===null;){if(b.return===null||b.return===u)break e;b=b.return}b.sibling.return=b.return,b=b.sibling}u.stateNode=o;e:switch(yr(o,p,g),p){case"button":case"input":case"select":case"textarea":o=!!g.autoFocus;break e;case"img":o=!0;break e;default:o=!1}o&&lo(u)}}return pi(u),u.flags&=-16777217,null;case 6:if(o&&u.stateNode!=null)o.memoizedProps!==g&&lo(u);else{if(typeof g!="string"&&u.stateNode===null)throw Error(n(166));if(o=je.current,no(u)){if(o=u.stateNode,p=u.memoizedProps,g=null,b=hr,b!==null)switch(b.tag){case 27:case 5:g=b.memoizedProps}o[ts]=u,o=!!(o.nodeValue===p||g!==null&&g.suppressHydrationWarning===!0||QN(o.nodeValue,p)),o||ru(u)}else o=wx(o).createTextNode(g),o[ts]=u,u.stateNode=o}return pi(u),null;case 13:if(g=u.memoizedState,o===null||o.memoizedState!==null&&o.memoizedState.dehydrated!==null){if(b=no(u),g!==null&&g.dehydrated!==null){if(o===null){if(!b)throw Error(n(318));if(b=u.memoizedState,b=b!==null?b.dehydrated:null,!b)throw Error(n(317));b[ts]=u}else oh(),(u.flags&128)===0&&(u.memoizedState=null),u.flags|=4;pi(u),b=!1}else b=qn(),o!==null&&o.memoizedState!==null&&(o.memoizedState.hydrationErrors=b),b=!0;if(!b)return u.flags&256?(Do(u),u):(Do(u),null)}if(Do(u),(u.flags&128)!==0)return u.lanes=p,u;if(p=g!==null,o=o!==null&&o.memoizedState!==null,p){g=u.child,b=null,g.alternate!==null&&g.alternate.memoizedState!==null&&g.alternate.memoizedState.cachePool!==null&&(b=g.alternate.memoizedState.cachePool.pool);var R=null;g.memoizedState!==null&&g.memoizedState.cachePool!==null&&(R=g.memoizedState.cachePool.pool),R!==b&&(g.flags|=2048)}return p!==o&&p&&(u.child.flags|=8192),bl(u,u.updateQueue),pi(u),null;case 4:return nn(),o===null&&bM(u.stateNode.containerInfo),pi(u),null;case 10:return ml(u.type),pi(u),null;case 19:if(we(Ki),b=u.memoizedState,b===null)return pi(u),null;if(g=(u.flags&128)!==0,R=b.rendering,R===null)if(g)lc(b,!1);else{if(Mi!==0||o!==null&&(o.flags&128)!==0)for(o=u.child;o!==null;){if(R=Sl(o),R!==null){for(u.flags|=128,lc(b,!1),o=R.updateQueue,u.updateQueue=o,bl(u,o),u.subtreeFlags=0,o=p,p=u.child;p!==null;)Uy(p,o),p=p.sibling;return Fe(Ki,Ki.current&1|2),u.child}o=o.sibling}b.tail!==null&&Ge()>er&&(u.flags|=128,g=!0,lc(b,!1),u.lanes=4194304)}else{if(!g)if(o=Sl(R),o!==null){if(u.flags|=128,g=!0,o=o.updateQueue,u.updateQueue=o,bl(u,o),lc(b,!0),b.tail===null&&b.tailMode==="hidden"&&!R.alternate&&!Vn)return pi(u),null}else 2*Ge()-b.renderingStartTime>er&&p!==536870912&&(u.flags|=128,g=!0,lc(b,!1),u.lanes=4194304);b.isBackwards?(R.sibling=u.child,u.child=R):(o=b.last,o!==null?o.sibling=R:u.child=R,b.last=R)}return b.tail!==null?(u=b.tail,b.rendering=u,b.tail=u.sibling,b.renderingStartTime=Ge(),u.sibling=null,o=Ki.current,Fe(Ki,g?o&1|2:o&1),u):(pi(u),null);case 22:case 23:return Do(u),Kf(),g=u.memoizedState!==null,o!==null?o.memoizedState!==null!==g&&(u.flags|=8192):g&&(u.flags|=8192),g?(p&536870912)!==0&&(u.flags&128)===0&&(pi(u),u.subtreeFlags&6&&(u.flags|=8192)):pi(u),p=u.updateQueue,p!==null&&bl(u,p.retryQueue),p=null,o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(p=o.memoizedState.cachePool.pool),g=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(g=u.memoizedState.cachePool.pool),g!==p&&(u.flags|=2048),o!==null&&we(Ta),null;case 24:return p=null,o!==null&&(p=o.memoizedState.cache),u.memoizedState.cache!==p&&(u.flags|=2048),ml(ss),pi(u),null;case 25:return null;case 30:return null}throw Error(n(156,u.tag))}function bh(o,u){switch(By(u),u.tag){case 1:return o=u.flags,o&65536?(u.flags=o&-65537|128,u):null;case 3:return ml(ss),nn(),o=u.flags,(o&65536)!==0&&(o&128)===0?(u.flags=o&-65537|128,u):null;case 26:case 27:case 5:return mn(u),null;case 13:if(Do(u),o=u.memoizedState,o!==null&&o.dehydrated!==null){if(u.alternate===null)throw Error(n(340));oh()}return o=u.flags,o&65536?(u.flags=o&-65537|128,u):null;case 19:return we(Ki),null;case 4:return nn(),null;case 10:return ml(u.type),null;case 22:case 23:return Do(u),Kf(),o!==null&&we(Ta),o=u.flags,o&65536?(u.flags=o&-65537|128,u):null;case 24:return ml(ss),null;case 25:return null;default:return null}}function Th(o,u){switch(By(u),u.tag){case 3:ml(ss),nn();break;case 26:case 27:case 5:mn(u);break;case 4:nn();break;case 13:Do(u);break;case 19:we(Ki);break;case 10:ml(u.type);break;case 22:case 23:Do(u),Kf(),o!==null&&we(Ta);break;case 24:ml(ss)}}function uc(o,u){try{var p=u.updateQueue,g=p!==null?p.lastEffect:null;if(g!==null){var b=g.next;p=b;do{if((p.tag&o)===o){g=void 0;var R=p.create,O=p.inst;g=R(),O.destroy=g}p=p.next}while(p!==b)}}catch(k){le(u,u.return,k)}}function Jr(o,u,p){try{var g=u.updateQueue,b=g!==null?g.lastEffect:null;if(b!==null){var R=b.next;g=R;do{if((g.tag&o)===o){var O=g.inst,k=O.destroy;if(k!==void 0){O.destroy=void 0,b=u;var $=p,Te=k;try{Te()}catch(We){le(b,$,We)}}}g=g.next}while(g!==R)}}catch(We){le(u,u.return,We)}}function cc(o){var u=o.updateQueue;if(u!==null){var p=o.stateNode;try{z0(u,p)}catch(g){le(o,o.return,g)}}}function Tl(o,u,p){p.props=Uo(o.type,o.memoizedProps),p.state=o.memoizedState;try{p.componentWillUnmount()}catch(g){le(o,u,g)}}function hc(o,u){try{var p=o.ref;if(p!==null){switch(o.tag){case 26:case 27:case 5:var g=o.stateNode;break;case 30:g=o.stateNode;break;default:g=o.stateNode}typeof p=="function"?o.refCleanup=p(g):p.current=g}}catch(b){le(o,u,b)}}function Bo(o,u){var p=o.ref,g=o.refCleanup;if(p!==null)if(typeof g=="function")try{g()}catch(b){le(o,u,b)}finally{o.refCleanup=null,o=o.alternate,o!=null&&(o.refCleanup=null)}else if(typeof p=="function")try{p(null)}catch(b){le(o,u,b)}else p.current=null}function Mh(o){var u=o.type,p=o.memoizedProps,g=o.stateNode;try{e:switch(u){case"button":case"input":case"select":case"textarea":p.autoFocus&&g.focus();break e;case"img":p.src?g.src=p.src:p.srcSet&&(g.srcset=p.srcSet)}}catch(b){le(o,o.return,b)}}function rd(o,u,p){try{var g=o.stateNode;RI(g,o.type,p,u),g[ps]=u}catch(b){le(o,o.return,b)}}function ad(o){return o.tag===5||o.tag===3||o.tag===26||o.tag===27&&Dh(o.type)||o.tag===4}function gu(o){e:for(;;){for(;o.sibling===null;){if(o.return===null||ad(o.return))return null;o=o.return}for(o.sibling.return=o.return,o=o.sibling;o.tag!==5&&o.tag!==6&&o.tag!==18;){if(o.tag===27&&Dh(o.type)||o.flags&2||o.child===null||o.tag===4)continue e;o.child.return=o,o=o.child}if(!(o.flags&2))return o.stateNode}}function yu(o,u,p){var g=o.tag;if(g===5||g===6)o=o.stateNode,u?(p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p).insertBefore(o,u):(u=p.nodeType===9?p.body:p.nodeName==="HTML"?p.ownerDocument.body:p,u.appendChild(o),p=p._reactRootContainer,p!=null||u.onclick!==null||(u.onclick=Cx));else if(g!==4&&(g===27&&Dh(o.type)&&(p=o.stateNode,u=null),o=o.child,o!==null))for(yu(o,u,p),o=o.sibling;o!==null;)yu(o,u,p),o=o.sibling}function vu(o,u,p){var g=o.tag;if(g===5||g===6)o=o.stateNode,u?p.insertBefore(o,u):p.appendChild(o);else if(g!==4&&(g===27&&Dh(o.type)&&(p=o.stateNode),o=o.child,o!==null))for(vu(o,u,p),o=o.sibling;o!==null;)vu(o,u,p),o=o.sibling}function _u(o){var u=o.stateNode,p=o.memoizedProps;try{for(var g=o.type,b=u.attributes;b.length;)u.removeAttributeNode(b[0]);yr(u,g,p),u[ts]=o,u[ps]=p}catch(R){le(o,o.return,R)}}var Oo=!1,mi=!1,Eh=!1,$r=typeof WeakSet=="function"?WeakSet:Set,ci=null;function ys(o,u){if(o=o.containerInfo,EM=Px,o=Ey(o),Bf(o)){if("selectionStart"in o)var p={start:o.selectionStart,end:o.selectionEnd};else e:{p=(p=o.ownerDocument)&&p.defaultView||window;var g=p.getSelection&&p.getSelection();if(g&&g.rangeCount!==0){p=g.anchorNode;var b=g.anchorOffset,R=g.focusNode;g=g.focusOffset;try{p.nodeType,R.nodeType}catch{p=null;break e}var O=0,k=-1,$=-1,Te=0,We=0,Je=o,Ee=null;t:for(;;){for(var Ne;Je!==p||b!==0&&Je.nodeType!==3||(k=O+b),Je!==R||g!==0&&Je.nodeType!==3||($=O+g),Je.nodeType===3&&(O+=Je.nodeValue.length),(Ne=Je.firstChild)!==null;)Ee=Je,Je=Ne;for(;;){if(Je===o)break t;if(Ee===p&&++Te===b&&(k=O),Ee===R&&++We===g&&($=O),(Ne=Je.nextSibling)!==null)break;Je=Ee,Ee=Je.parentNode}Je=Ne}p=k===-1||$===-1?null:{start:k,end:$}}else p=null}p=p||{start:0,end:0}}else p=null;for(AM={focusedElem:o,selectionRange:p},Px=!1,ci=u;ci!==null;)if(u=ci,o=u.child,(u.subtreeFlags&1024)!==0&&o!==null)o.return=u,ci=o;else for(;ci!==null;){switch(u=ci,R=u.alternate,o=u.flags,u.tag){case 0:break;case 11:case 15:break;case 1:if((o&1024)!==0&&R!==null){o=void 0,p=u,b=R.memoizedProps,R=R.memoizedState,g=p.stateNode;try{var Kt=Uo(p.type,b,p.elementType===p.type);o=g.getSnapshotBeforeUpdate(Kt,R),g.__reactInternalSnapshotBeforeUpdate=o}catch(Xt){le(p,p.return,Xt)}}break;case 3:if((o&1024)!==0){if(o=u.stateNode.containerInfo,p=o.nodeType,p===9)CM(o);else if(p===1)switch(o.nodeName){case"HEAD":case"HTML":case"BODY":CM(o);break;default:o.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((o&1024)!==0)throw Error(n(163))}if(o=u.sibling,o!==null){o.return=u.return,ci=o;break}ci=u.return}}function Ml(o,u,p){var g=p.flags;switch(p.tag){case 0:case 11:case 15:mr(o,p),g&4&&uc(5,p);break;case 1:if(mr(o,p),g&4)if(o=p.stateNode,u===null)try{o.componentDidMount()}catch(O){le(p,p.return,O)}else{var b=Uo(p.type,u.memoizedProps);u=u.memoizedState;try{o.componentDidUpdate(b,u,o.__reactInternalSnapshotBeforeUpdate)}catch(O){le(p,p.return,O)}}g&64&&cc(p),g&512&&hc(p,p.return);break;case 3:if(mr(o,p),g&64&&(o=p.updateQueue,o!==null)){if(u=null,p.child!==null)switch(p.child.tag){case 27:case 5:u=p.child.stateNode;break;case 1:u=p.child.stateNode}try{z0(o,u)}catch(O){le(p,p.return,O)}}break;case 27:u===null&&g&4&&_u(p);case 26:case 5:mr(o,p),u===null&&g&4&&Mh(p),g&512&&hc(p,p.return);break;case 12:mr(o,p);break;case 13:mr(o,p),g&4&&xu(o,p),g&64&&(o=p.memoizedState,o!==null&&(o=o.dehydrated,o!==null&&(p=Ei.bind(null,p),BI(o,p))));break;case 22:if(g=p.memoizedState!==null||Oo,!g){u=u!==null&&u.memoizedState!==null||mi,b=Oo;var R=mi;Oo=g,(mi=u)&&!R?Po(o,p,(p.subtreeFlags&8772)!==0):mr(o,p),Oo=b,mi=R}break;case 30:break;default:mr(o,p)}}function gn(o){var u=o.alternate;u!==null&&(o.alternate=null,gn(u)),o.child=null,o.deletions=null,o.sibling=null,o.tag===5&&(u=o.stateNode,u!==null&&ii(u)),o.stateNode=null,o.return=null,o.dependencies=null,o.memoizedProps=null,o.memoizedState=null,o.pendingProps=null,o.stateNode=null,o.updateQueue=null}var Ht=null,In=!1;function Ca(o,u,p){for(p=p.child;p!==null;)fc(o,u,p),p=p.sibling}function fc(o,u,p){if(ct&&typeof ct.onCommitFiberUnmount=="function")try{ct.onCommitFiberUnmount(Be,p)}catch{}switch(p.tag){case 26:mi||Bo(p,u),Ca(o,u,p),p.memoizedState?p.memoizedState.count--:p.stateNode&&(p=p.stateNode,p.parentNode.removeChild(p));break;case 27:mi||Bo(p,u);var g=Ht,b=In;Dh(p.type)&&(Ht=p.stateNode,In=!1),Ca(o,u,p),dv(p.stateNode),Ht=g,In=b;break;case 5:mi||Bo(p,u);case 6:if(g=Ht,b=In,Ht=null,Ca(o,u,p),Ht=g,In=b,Ht!==null)if(In)try{(Ht.nodeType===9?Ht.body:Ht.nodeName==="HTML"?Ht.ownerDocument.body:Ht).removeChild(p.stateNode)}catch(R){le(p,u,R)}else try{Ht.removeChild(p.stateNode)}catch(R){le(p,u,R)}break;case 18:Ht!==null&&(In?(o=Ht,nC(o.nodeType===9?o.body:o.nodeName==="HTML"?o.ownerDocument.body:o,p.stateNode),Sv(o)):nC(Ht,p.stateNode));break;case 4:g=Ht,b=In,Ht=p.stateNode.containerInfo,In=!0,Ca(o,u,p),Ht=g,In=b;break;case 0:case 11:case 14:case 15:mi||Jr(2,p,u),mi||Jr(4,p,u),Ca(o,u,p);break;case 1:mi||(Bo(p,u),g=p.stateNode,typeof g.componentWillUnmount=="function"&&Tl(p,u,g)),Ca(o,u,p);break;case 21:Ca(o,u,p);break;case 22:mi=(g=mi)||p.memoizedState!==null,Ca(o,u,p),mi=g;break;default:Ca(o,u,p)}}function xu(o,u){if(u.memoizedState===null&&(o=u.alternate,o!==null&&(o=o.memoizedState,o!==null&&(o=o.dehydrated,o!==null))))try{Sv(o)}catch(p){le(u,u.return,p)}}function _m(o){switch(o.tag){case 13:case 19:var u=o.stateNode;return u===null&&(u=o.stateNode=new $r),u;case 22:return o=o.stateNode,u=o._retryCache,u===null&&(u=o._retryCache=new $r),u;default:throw Error(n(435,o.tag))}}function dc(o,u){var p=_m(o);u.forEach(function(g){var b=Zt.bind(null,o,g);p.has(g)||(p.add(g),g.then(b,b))})}function ws(o,u){var p=u.deletions;if(p!==null)for(var g=0;g<p.length;g++){var b=p[g],R=o,O=u,k=O;e:for(;k!==null;){switch(k.tag){case 27:if(Dh(k.type)){Ht=k.stateNode,In=!1;break e}break;case 5:Ht=k.stateNode,In=!1;break e;case 3:case 4:Ht=k.stateNode.containerInfo,In=!0;break e}k=k.return}if(Ht===null)throw Error(n(160));fc(R,O,b),Ht=null,In=!1,R=b.alternate,R!==null&&(R.return=null),b.return=null}if(u.subtreeFlags&13878)for(u=u.child;u!==null;)xm(u,o),u=u.sibling}var uo=null;function xm(o,u){var p=o.alternate,g=o.flags;switch(o.tag){case 0:case 11:case 14:case 15:ws(u,o),Hi(o),g&4&&(Jr(3,o,o.return),uc(3,o),Jr(5,o,o.return));break;case 1:ws(u,o),Hi(o),g&512&&(mi||p===null||Bo(p,p.return)),g&64&&Oo&&(o=o.updateQueue,o!==null&&(g=o.callbacks,g!==null&&(p=o.shared.hiddenCallbacks,o.shared.hiddenCallbacks=p===null?g:p.concat(g))));break;case 26:var b=uo;if(ws(u,o),Hi(o),g&512&&(mi||p===null||Bo(p,p.return)),g&4){var R=p!==null?p.memoizedState:null;if(g=o.memoizedState,p===null)if(g===null)if(o.stateNode===null){e:{g=o.type,p=o.memoizedProps,b=b.ownerDocument||b;t:switch(g){case"title":R=b.getElementsByTagName("title")[0],(!R||R[Qa]||R[ts]||R.namespaceURI==="http://www.w3.org/2000/svg"||R.hasAttribute("itemprop"))&&(R=b.createElement(g),b.head.insertBefore(R,b.querySelector("head > title"))),yr(R,g,p),R[ts]=o,ns(R),g=R;break e;case"link":var O=cC("link","href",b).get(g+(p.href||""));if(O){for(var k=0;k<O.length;k++)if(R=O[k],R.getAttribute("href")===(p.href==null||p.href===""?null:p.href)&&R.getAttribute("rel")===(p.rel==null?null:p.rel)&&R.getAttribute("title")===(p.title==null?null:p.title)&&R.getAttribute("crossorigin")===(p.crossOrigin==null?null:p.crossOrigin)){O.splice(k,1);break t}}R=b.createElement(g),yr(R,g,p),b.head.appendChild(R);break;case"meta":if(O=cC("meta","content",b).get(g+(p.content||""))){for(k=0;k<O.length;k++)if(R=O[k],R.getAttribute("content")===(p.content==null?null:""+p.content)&&R.getAttribute("name")===(p.name==null?null:p.name)&&R.getAttribute("property")===(p.property==null?null:p.property)&&R.getAttribute("http-equiv")===(p.httpEquiv==null?null:p.httpEquiv)&&R.getAttribute("charset")===(p.charSet==null?null:p.charSet)){O.splice(k,1);break t}}R=b.createElement(g),yr(R,g,p),b.head.appendChild(R);break;default:throw Error(n(468,g))}R[ts]=o,ns(R),g=R}o.stateNode=g}else hC(b,o.type,o.stateNode);else o.stateNode=uC(b,g,o.memoizedProps);else R!==g?(R===null?p.stateNode!==null&&(p=p.stateNode,p.parentNode.removeChild(p)):R.count--,g===null?hC(b,o.type,o.stateNode):uC(b,g,o.memoizedProps)):g===null&&o.stateNode!==null&&rd(o,o.memoizedProps,p.memoizedProps)}break;case 27:ws(u,o),Hi(o),g&512&&(mi||p===null||Bo(p,p.return)),p!==null&&g&4&&rd(o,o.memoizedProps,p.memoizedProps);break;case 5:if(ws(u,o),Hi(o),g&512&&(mi||p===null||Bo(p,p.return)),o.flags&32){b=o.stateNode;try{lr(b,"")}catch(Ne){le(o,o.return,Ne)}}g&4&&o.stateNode!=null&&(b=o.memoizedProps,rd(o,b,p!==null?p.memoizedProps:b)),g&1024&&(Eh=!0);break;case 6:if(ws(u,o),Hi(o),g&4){if(o.stateNode===null)throw Error(n(162));g=o.memoizedProps,p=o.stateNode;try{p.nodeValue=g}catch(Ne){le(o,o.return,Ne)}}break;case 3:if(Lx=null,b=uo,uo=Dx(u.containerInfo),ws(u,o),uo=b,Hi(o),g&4&&p!==null&&p.memoizedState.isDehydrated)try{Sv(u.containerInfo)}catch(Ne){le(o,o.return,Ne)}Eh&&(Eh=!1,Su(o));break;case 4:g=uo,uo=Dx(o.stateNode.containerInfo),ws(u,o),Hi(o),uo=g;break;case 12:ws(u,o),Hi(o);break;case 13:ws(u,o),Hi(o),o.child.flags&8192&&o.memoizedState!==null!=(p!==null&&p.memoizedState!==null)&&(ri=Ge()),g&4&&(g=o.updateQueue,g!==null&&(o.updateQueue=null,dc(o,g)));break;case 22:b=o.memoizedState!==null;var $=p!==null&&p.memoizedState!==null,Te=Oo,We=mi;if(Oo=Te||b,mi=We||$,ws(u,o),mi=We,Oo=Te,Hi(o),g&8192)e:for(u=o.stateNode,u._visibility=b?u._visibility&-2:u._visibility|1,b&&(p===null||$||Oo||mi||ea(o)),p=null,u=o;;){if(u.tag===5||u.tag===26){if(p===null){$=p=u;try{if(R=$.stateNode,b)O=R.style,typeof O.setProperty=="function"?O.setProperty("display","none","important"):O.display="none";else{k=$.stateNode;var Je=$.memoizedProps.style,Ee=Je!=null&&Je.hasOwnProperty("display")?Je.display:null;k.style.display=Ee==null||typeof Ee=="boolean"?"":(""+Ee).trim()}}catch(Ne){le($,$.return,Ne)}}}else if(u.tag===6){if(p===null){$=u;try{$.stateNode.nodeValue=b?"":$.memoizedProps}catch(Ne){le($,$.return,Ne)}}}else if((u.tag!==22&&u.tag!==23||u.memoizedState===null||u===o)&&u.child!==null){u.child.return=u,u=u.child;continue}if(u===o)break e;for(;u.sibling===null;){if(u.return===null||u.return===o)break e;p===u&&(p=null),u=u.return}p===u&&(p=null),u.sibling.return=u.return,u=u.sibling}g&4&&(g=o.updateQueue,g!==null&&(p=g.retryQueue,p!==null&&(g.retryQueue=null,dc(o,p))));break;case 19:ws(u,o),Hi(o),g&4&&(g=o.updateQueue,g!==null&&(o.updateQueue=null,dc(o,g)));break;case 30:break;case 21:break;default:ws(u,o),Hi(o)}}function Hi(o){var u=o.flags;if(u&2){try{for(var p,g=o.return;g!==null;){if(ad(g)){p=g;break}g=g.return}if(p==null)throw Error(n(160));switch(p.tag){case 27:var b=p.stateNode,R=gu(o);vu(o,R,b);break;case 5:var O=p.stateNode;p.flags&32&&(lr(O,""),p.flags&=-33);var k=gu(o);vu(o,k,O);break;case 3:case 4:var $=p.stateNode.containerInfo,Te=gu(o);yu(o,Te,$);break;default:throw Error(n(161))}}catch(We){le(o,o.return,We)}o.flags&=-3}u&4096&&(o.flags&=-4097)}function Su(o){if(o.subtreeFlags&1024)for(o=o.child;o!==null;){var u=o;Su(u),u.tag===5&&u.flags&1024&&u.stateNode.reset(),o=o.sibling}}function mr(o,u){if(u.subtreeFlags&8772)for(u=u.child;u!==null;)Ml(o,u.alternate,u),u=u.sibling}function ea(o){for(o=o.child;o!==null;){var u=o;switch(u.tag){case 0:case 11:case 14:case 15:Jr(4,u,u.return),ea(u);break;case 1:Bo(u,u.return);var p=u.stateNode;typeof p.componentWillUnmount=="function"&&Tl(u,u.return,p),ea(u);break;case 27:dv(u.stateNode);case 26:case 5:Bo(u,u.return),ea(u);break;case 22:u.memoizedState===null&&ea(u);break;case 30:ea(u);break;default:ea(u)}o=o.sibling}}function Po(o,u,p){for(p=p&&(u.subtreeFlags&8772)!==0,u=u.child;u!==null;){var g=u.alternate,b=o,R=u,O=R.flags;switch(R.tag){case 0:case 11:case 15:Po(b,R,p),uc(4,R);break;case 1:if(Po(b,R,p),g=R,b=g.stateNode,typeof b.componentDidMount=="function")try{b.componentDidMount()}catch(Te){le(g,g.return,Te)}if(g=R,b=g.updateQueue,b!==null){var k=g.stateNode;try{var $=b.shared.hiddenCallbacks;if($!==null)for(b.shared.hiddenCallbacks=null,b=0;b<$.length;b++)ph($[b],k)}catch(Te){le(g,g.return,Te)}}p&&O&64&&cc(R),hc(R,R.return);break;case 27:_u(R);case 26:case 5:Po(b,R,p),p&&g===null&&O&4&&Mh(R),hc(R,R.return);break;case 12:Po(b,R,p);break;case 13:Po(b,R,p),p&&O&4&&xu(b,R);break;case 22:R.memoizedState===null&&Po(b,R,p),hc(R,R.return);break;case 30:break;default:Po(b,R,p)}u=u.sibling}}function Sm(o,u){var p=null;o!==null&&o.memoizedState!==null&&o.memoizedState.cachePool!==null&&(p=o.memoizedState.cachePool.pool),o=null,u.memoizedState!==null&&u.memoizedState.cachePool!==null&&(o=u.memoizedState.cachePool.pool),o!==p&&(o!=null&&o.refCount++,p!=null&&lh(p))}function bm(o,u){o=null,u.alternate!==null&&(o=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==o&&(u.refCount++,o!=null&&lh(o))}function hi(o,u,p,g){if(u.subtreeFlags&10256)for(u=u.child;u!==null;)Tm(o,u,p,g),u=u.sibling}function Tm(o,u,p,g){var b=u.flags;switch(u.tag){case 0:case 11:case 15:hi(o,u,p,g),b&2048&&uc(9,u);break;case 1:hi(o,u,p,g);break;case 3:hi(o,u,p,g),b&2048&&(o=null,u.alternate!==null&&(o=u.alternate.memoizedState.cache),u=u.memoizedState.cache,u!==o&&(u.refCount++,o!=null&&lh(o)));break;case 12:if(b&2048){hi(o,u,p,g),o=u.stateNode;try{var R=u.memoizedProps,O=R.id,k=R.onPostCommit;typeof k=="function"&&k(O,u.alternate===null?"mount":"update",o.passiveEffectDuration,-0)}catch($){le(u,u.return,$)}}else hi(o,u,p,g);break;case 13:hi(o,u,p,g);break;case 23:break;case 22:R=u.stateNode,O=u.alternate,u.memoizedState!==null?R._visibility&2?hi(o,u,p,g):co(o,u):R._visibility&2?hi(o,u,p,g):(R._visibility|=2,El(o,u,p,g,(u.subtreeFlags&10256)!==0)),b&2048&&Sm(O,u);break;case 24:hi(o,u,p,g),b&2048&&bm(u.alternate,u);break;default:hi(o,u,p,g)}}function El(o,u,p,g,b){for(b=b&&(u.subtreeFlags&10256)!==0,u=u.child;u!==null;){var R=o,O=u,k=p,$=g,Te=O.flags;switch(O.tag){case 0:case 11:case 15:El(R,O,k,$,b),uc(8,O);break;case 23:break;case 22:var We=O.stateNode;O.memoizedState!==null?We._visibility&2?El(R,O,k,$,b):co(R,O):(We._visibility|=2,El(R,O,k,$,b)),b&&Te&2048&&Sm(O.alternate,O);break;case 24:El(R,O,k,$,b),b&&Te&2048&&bm(O.alternate,O);break;default:El(R,O,k,$,b)}u=u.sibling}}function co(o,u){if(u.subtreeFlags&10256)for(u=u.child;u!==null;){var p=o,g=u,b=g.flags;switch(g.tag){case 22:co(p,g),b&2048&&Sm(g.alternate,g);break;case 24:co(p,g),b&2048&&bm(g.alternate,g);break;default:co(p,g)}u=u.sibling}}var ta=8192;function Ah(o){if(o.subtreeFlags&ta)for(o=o.child;o!==null;)Ex(o),o=o.sibling}function Ex(o){switch(o.tag){case 26:Ah(o),o.flags&ta&&o.memoizedState!==null&&YI(uo,o.memoizedState,o.memoizedProps);break;case 5:Ah(o);break;case 3:case 4:var u=uo;uo=Dx(o.stateNode.containerInfo),Ah(o),uo=u;break;case 22:o.memoizedState===null&&(u=o.alternate,u!==null&&u.memoizedState!==null?(u=ta,ta=16777216,Ah(o),ta=u):Ah(o));break;default:Ah(o)}}function Ax(o){var u=o.alternate;if(u!==null&&(o=u.child,o!==null)){u.child=null;do u=o.sibling,o.sibling=null,o=u;while(o!==null)}}function gi(o){var u=o.deletions;if((o.flags&16)!==0){if(u!==null)for(var p=0;p<u.length;p++){var g=u[p];ci=g,Fo(g,o)}Ax(o)}if(o.subtreeFlags&10256)for(o=o.child;o!==null;)lv(o),o=o.sibling}function lv(o){switch(o.tag){case 0:case 11:case 15:gi(o),o.flags&2048&&Jr(9,o,o.return);break;case 3:gi(o);break;case 12:gi(o);break;case 22:var u=o.stateNode;o.memoizedState!==null&&u._visibility&2&&(o.return===null||o.return.tag!==13)?(u._visibility&=-3,Io(o)):gi(o);break;default:gi(o)}}function Io(o){var u=o.deletions;if((o.flags&16)!==0){if(u!==null)for(var p=0;p<u.length;p++){var g=u[p];ci=g,Fo(g,o)}Ax(o)}for(o=o.child;o!==null;){switch(u=o,u.tag){case 0:case 11:case 15:Jr(8,u,u.return),Io(u);break;case 22:p=u.stateNode,p._visibility&2&&(p._visibility&=-3,Io(u));break;default:Io(u)}o=o.sibling}}function Fo(o,u){for(;ci!==null;){var p=ci;switch(p.tag){case 0:case 11:case 15:Jr(8,p,u);break;case 23:case 22:if(p.memoizedState!==null&&p.memoizedState.cachePool!==null){var g=p.memoizedState.cachePool.pool;g!=null&&g.refCount++}break;case 24:lh(p.memoizedState.cache)}if(g=p.child,g!==null)g.return=p,ci=g;else e:for(p=o;ci!==null;){g=ci;var b=g.sibling,R=g.return;if(gn(g),g===p){ci=null;break e}if(b!==null){b.return=R,ci=b;break e}ci=R}}}var ki={getCacheForType:function(o){var u=Gi(ss),p=u.data.get(o);return p===void 0&&(p=o(),u.data.set(o,p)),p}},uv=typeof WeakMap=="function"?WeakMap:Map,Wn=0,sn=null,bn=null,Vt=0,pn=0,Pi=null,na=!1,Rh=!1,Nh=!1,wa=0,Mi=0,ho=0,zo=0,pc=0,Da=0,Fn=0,Xn=null,qt=null,Nn=!1,ri=0,er=1/0,Ua=null,ia=null,vs=0,tr=null,fi=null,sa=0,Al=0,od=null,ra=null,Vo=0,mc=null;function qi(){if((Wn&2)!==0&&Vt!==0)return Vt&-Vt;if(V.T!==null){var o=un;return o!==0?o:vM()}return Dn()}function Mm(){Da===0&&(Da=(Vt&536870912)===0||Vn?fe():536870912);var o=ui.current;return o!==null&&(o.flags|=32),Da}function gr(o,u,p){(o===sn&&(pn===2||pn===9)||o.cancelPendingCommit!==null)&&(Tu(o,0),fo(o,Vt,Da,!1)),Ke(o,p),((Wn&2)===0||o!==sn)&&(o===sn&&((Wn&2)===0&&(zo|=p),Mi===4&&fo(o,Vt,Da,!1)),Au(o))}function Ch(o,u,p){if((Wn&6)!==0)throw Error(n(327));var g=!p&&(u&124)===0&&(u&o.expiredLanes)===0||kt(o,u),b=g?T(o,u):f(o,u,!0),R=g;do{if(b===0){Rh&&!g&&fo(o,u,0,!1);break}else{if(p=o.current.alternate,R&&!bu(p)){b=f(o,u,!1),R=!1;continue}if(b===2){if(R=u,o.errorRecoveryDisabledLanes&R)var O=0;else O=o.pendingLanes&-536870913,O=O!==0?O:O&536870912?536870912:0;if(O!==0){u=O;e:{var k=o;b=Xn;var $=k.current.memoizedState.isDehydrated;if($&&(Tu(k,O).flags|=256),O=f(k,O,!1),O!==2){if(Nh&&!$){k.errorRecoveryDisabledLanes|=R,zo|=R,b=4;break e}R=qt,qt=b,R!==null&&(qt===null?qt=R:qt.push.apply(qt,R))}b=O}if(R=!1,b!==2)continue}}if(b===1){Tu(o,0),fo(o,u,0,!0);break}e:{switch(g=o,R=b,R){case 0:case 1:throw Error(n(345));case 4:if((u&4194048)!==u)break;case 6:fo(g,u,Da,!na);break e;case 2:qt=null;break;case 3:case 5:break;default:throw Error(n(329))}if((u&62914560)===u&&(b=ri+300-Ge(),10<b)){if(fo(g,u,Da,!na),dn(g,0,!0)!==0)break e;g.timeoutHandle=eC(ld.bind(null,g,p,qt,Ua,Nn,u,Da,zo,Fn,na,R,2,-0,0),b);break e}ld(g,p,qt,Ua,Nn,u,Da,zo,Fn,na,R,0,-0,0)}}break}while(!0);Au(o)}function ld(o,u,p,g,b,R,O,k,$,Te,We,Je,Ee,Ne){if(o.timeoutHandle=-1,Je=u.subtreeFlags,(Je&8192||(Je&16785408)===16785408)&&(gv={stylesheets:null,count:0,unsuspend:XI},Ex(u),Je=jI(),Je!==null)){o.cancelPendingCommit=Je(st.bind(null,o,u,R,p,g,b,O,k,$,We,1,Ee,Ne)),fo(o,R,O,!Te);return}st(o,u,R,p,g,b,O,k,$)}function bu(o){for(var u=o;;){var p=u.tag;if((p===0||p===11||p===15)&&u.flags&16384&&(p=u.updateQueue,p!==null&&(p=p.stores,p!==null)))for(var g=0;g<p.length;g++){var b=p[g],R=b.getSnapshot;b=b.value;try{if(!Rr(R(),b))return!1}catch{return!1}}if(p=u.child,u.subtreeFlags&16384&&p!==null)p.return=u,u=p;else{if(u===o)break;for(;u.sibling===null;){if(u.return===null||u.return===o)return!0;u=u.return}u.sibling.return=u.return,u=u.sibling}}return!0}function fo(o,u,p,g){u&=~pc,u&=~zo,o.suspendedLanes|=u,o.pingedLanes&=~u,g&&(o.warmLanes|=u),g=o.expirationTimes;for(var b=u;0<b;){var R=31-ot(b),O=1<<R;g[R]=-1,b&=~O}p!==0&&gt(o,p,u)}function Go(){return(Wn&6)===0?(cv(0),!1):!0}function gc(){if(bn!==null){if(pn===0)var o=bn.return;else o=bn,pl=au=null,Wy(o),ec=null,ed=0,o=bn;for(;o!==null;)Th(o.alternate,o),o=o.return;bn=null}}function Tu(o,u){var p=o.timeoutHandle;p!==-1&&(o.timeoutHandle=-1,CI(p)),p=o.cancelPendingCommit,p!==null&&(o.cancelPendingCommit=null,p()),gc(),sn=o,bn=p=ji(o.current,null),Vt=u,pn=0,Pi=null,na=!1,Rh=kt(o,u),Nh=!1,Fn=Da=pc=zo=ho=Mi=0,qt=Xn=null,Nn=!1,(u&8)!==0&&(u|=u&32);var g=o.entangledLanes;if(g!==0)for(o=o.entanglements,g&=u;0<g;){var b=31-ot(g),R=1<<b;u|=o[b],g&=~R}return wa=u,If(),p}function Em(o,u){cn=null,V.H=$f,u===Yf||u===io?(u=Vy(),pn=3):u===zy?(u=Vy(),pn=4):pn=u===Mx?8:u!==null&&typeof u=="object"&&typeof u.then=="function"?6:1,Pi=u,bn===null&&(Mi=1,gm(o,Vs(u,o.current)))}function wh(){var o=V.H;return V.H=$f,o===null?$f:o}function Am(){var o=V.A;return V.A=ki,o}function h(){Mi=4,na||(Vt&4194048)!==Vt&&ui.current!==null||(Rh=!0),(ho&134217727)===0&&(zo&134217727)===0||sn===null||fo(sn,Vt,Da,!1)}function f(o,u,p){var g=Wn;Wn|=2;var b=wh(),R=Am();(sn!==o||Vt!==u)&&(Ua=null,Tu(o,u)),u=!1;var O=Mi;e:do try{if(pn!==0&&bn!==null){var k=bn,$=Pi;switch(pn){case 8:gc(),O=6;break e;case 3:case 2:case 9:case 6:ui.current===null&&(u=!0);var Te=pn;if(pn=0,Pi=null,te(o,k,$,Te),p&&Rh){O=0;break e}break;default:Te=pn,pn=0,Pi=null,te(o,k,$,Te)}}_(),O=Mi;break}catch(We){Em(o,We)}while(!0);return u&&o.shellSuspendCounter++,pl=au=null,Wn=g,V.H=b,V.A=R,bn===null&&(sn=null,Vt=0,If()),O}function _(){for(;bn!==null;)U(bn)}function T(o,u){var p=Wn;Wn|=2;var g=wh(),b=Am();sn!==o||Vt!==u?(Ua=null,er=Ge()+500,Tu(o,u)):Rh=kt(o,u);e:do try{if(pn!==0&&bn!==null){u=bn;var R=Pi;t:switch(pn){case 1:pn=0,Pi=null,te(o,u,R,1);break;case 2:case 9:if(tm(R)){pn=0,Pi=null,W(u);break}u=function(){pn!==2&&pn!==9||sn!==o||(pn=7),Au(o)},R.then(u,u);break e;case 3:pn=7;break e;case 4:pn=5;break e;case 7:tm(R)?(pn=0,Pi=null,W(u)):(pn=0,Pi=null,te(o,u,R,7));break;case 5:var O=null;switch(bn.tag){case 26:O=bn.memoizedState;case 5:case 27:var k=bn;if(!O||fC(O)){pn=0,Pi=null;var $=k.sibling;if($!==null)bn=$;else{var Te=k.return;Te!==null?(bn=Te,xe(Te)):bn=null}break t}}pn=0,Pi=null,te(o,u,R,5);break;case 6:pn=0,Pi=null,te(o,u,R,6);break;case 8:gc(),Mi=6;break e;default:throw Error(n(462))}}N();break}catch(We){Em(o,We)}while(!0);return pl=au=null,V.H=g,V.A=b,Wn=p,bn!==null?0:(sn=null,Vt=0,If(),Mi)}function N(){for(;bn!==null&&!oi();)U(bn)}function U(o){var u=oc(o.alternate,o,wa);o.memoizedProps=o.pendingProps,u===null?xe(o):bn=u}function W(o){var u=o,p=u.alternate;switch(u.tag){case 15:case 0:u=Kr(p,u,u.pendingProps,u.type,void 0,Vt);break;case 11:u=Kr(p,u,u.pendingProps,u.type.render,u.ref,Vt);break;case 5:Wy(u);default:Th(p,u),u=bn=Uy(u,wa),u=oc(p,u,wa)}o.memoizedProps=o.pendingProps,u===null?xe(o):bn=u}function te(o,u,p,g){pl=au=null,Wy(u),ec=null,ed=0;var b=u.return;try{if(gM(o,b,u,p,Vt)){Mi=1,gm(o,Vs(p,o.current)),bn=null;return}}catch(R){if(b!==null)throw bn=b,R;Mi=1,gm(o,Vs(p,o.current)),bn=null;return}u.flags&32768?(Vn||g===1?o=!0:Rh||(Vt&536870912)!==0?o=!1:(na=o=!0,(g===2||g===9||g===3||g===6)&&(g=ui.current,g!==null&&g.tag===13&&(g.flags|=16384))),qe(u,o)):xe(u)}function xe(o){var u=o;do{if((u.flags&32768)!==0){qe(u,na);return}o=u.return;var p=ov(u.alternate,u,wa);if(p!==null){bn=p;return}if(u=u.sibling,u!==null){bn=u;return}bn=u=o}while(u!==null);Mi===0&&(Mi=5)}function qe(o,u){do{var p=bh(o.alternate,o);if(p!==null){p.flags&=32767,bn=p;return}if(p=o.return,p!==null&&(p.flags|=32768,p.subtreeFlags=0,p.deletions=null),!u&&(o=o.sibling,o!==null)){bn=o;return}bn=o=p}while(o!==null);Mi=6,bn=null}function st(o,u,p,g,b,R,O,k,$){o.cancelPendingCommit=null;do Mu();while(vs!==0);if((Wn&6)!==0)throw Error(n(327));if(u!==null){if(u===o.current)throw Error(n(177));if(R=u.lanes|u.childLanes,R|=Xp,yt(o,p,R,O,k,$),o===sn&&(bn=sn=null,Vt=0),fi=u,tr=o,sa=p,Al=R,od=b,ra=g,(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?(o.callbackNode=null,o.callbackPriority=0,Gn(j,function(){return Eu(),null})):(o.callbackNode=null,o.callbackPriority=0),g=(u.flags&13878)!==0,(u.subtreeFlags&13878)!==0||g){g=V.T,V.T=null,b=Q.p,Q.p=2,O=Wn,Wn|=4;try{ys(o,u,p)}finally{Wn=O,Q.p=b,V.T=g}}vs=1,vt(),xt(),rn()}}function vt(){if(vs===1){vs=0;var o=tr,u=fi,p=(u.flags&13878)!==0;if((u.subtreeFlags&13878)!==0||p){p=V.T,V.T=null;var g=Q.p;Q.p=2;var b=Wn;Wn|=4;try{xm(u,o);var R=AM,O=Ey(o.containerInfo),k=R.focusedElem,$=R.selectionRange;if(O!==k&&k&&k.ownerDocument&&My(k.ownerDocument.documentElement,k)){if($!==null&&Bf(k)){var Te=$.start,We=$.end;if(We===void 0&&(We=Te),"selectionStart"in k)k.selectionStart=Te,k.selectionEnd=Math.min(We,k.value.length);else{var Je=k.ownerDocument||document,Ee=Je&&Je.defaultView||window;if(Ee.getSelection){var Ne=Ee.getSelection(),Kt=k.textContent.length,Xt=Math.min($.start,Kt),vi=$.end===void 0?Xt:Math.min($.end,Kt);!Ne.extend&&Xt>vi&&(O=vi,vi=Xt,Xt=O);var me=Ty(k,Xt),ce=Ty(k,vi);if(me&&ce&&(Ne.rangeCount!==1||Ne.anchorNode!==me.node||Ne.anchorOffset!==me.offset||Ne.focusNode!==ce.node||Ne.focusOffset!==ce.offset)){var be=Je.createRange();be.setStart(me.node,me.offset),Ne.removeAllRanges(),Xt>vi?(Ne.addRange(be),Ne.extend(ce.node,ce.offset)):(be.setEnd(ce.node,ce.offset),Ne.addRange(be))}}}}for(Je=[],Ne=k;Ne=Ne.parentNode;)Ne.nodeType===1&&Je.push({element:Ne,left:Ne.scrollLeft,top:Ne.scrollTop});for(typeof k.focus=="function"&&k.focus(),k=0;k<Je.length;k++){var Ye=Je[k];Ye.element.scrollLeft=Ye.left,Ye.element.scrollTop=Ye.top}}Px=!!EM,AM=EM=null}finally{Wn=b,Q.p=g,V.T=p}}o.current=u,vs=2}}function xt(){if(vs===2){vs=0;var o=tr,u=fi,p=(u.flags&8772)!==0;if((u.subtreeFlags&8772)!==0||p){p=V.T,V.T=null;var g=Q.p;Q.p=2;var b=Wn;Wn|=4;try{Ml(o,u.alternate,u)}finally{Wn=b,Q.p=g,V.T=p}}vs=3}}function rn(){if(vs===4||vs===3){vs=0,Ze();var o=tr,u=fi,p=sa,g=ra;(u.subtreeFlags&10256)!==0||(u.flags&10256)!==0?vs=5:(vs=0,fi=tr=null,aa(o,o.pendingLanes));var b=o.pendingLanes;if(b===0&&(ia=null),Ci(p),u=u.stateNode,ct&&typeof ct.onCommitFiberRoot=="function")try{ct.onCommitFiberRoot(Be,u,void 0,(u.current.flags&128)===128)}catch{}if(g!==null){u=V.T,b=Q.p,Q.p=2,V.T=null;try{for(var R=o.onRecoverableError,O=0;O<g.length;O++){var k=g[O];R(k.value,{componentStack:k.stack})}}finally{V.T=u,Q.p=b}}(sa&3)!==0&&Mu(),Au(o),b=o.pendingLanes,(p&4194090)!==0&&(b&42)!==0?o===mc?Vo++:(Vo=0,mc=o):Vo=0,cv(0)}}function aa(o,u){(o.pooledCacheLanes&=u)===0&&(u=o.pooledCache,u!=null&&(o.pooledCache=null,lh(u)))}function Mu(o){return vt(),xt(),rn(),Eu()}function Eu(){if(vs!==5)return!1;var o=tr,u=Al;Al=0;var p=Ci(sa),g=V.T,b=Q.p;try{Q.p=32>p?32:p,V.T=null,p=od,od=null;var R=tr,O=sa;if(vs=0,fi=tr=null,sa=0,(Wn&6)!==0)throw Error(n(331));var k=Wn;if(Wn|=4,lv(R.current),Tm(R,R.current,O,p),Wn=k,cv(0,!1),ct&&typeof ct.onPostCommitFiberRoot=="function")try{ct.onPostCommitFiberRoot(Be,R)}catch{}return!0}finally{Q.p=b,V.T=g,aa(o,u)}}function Me(o,u,p){u=Vs(p,u),u=ym(o.stateNode,u,2),o=yl(o,u,2),o!==null&&(Ke(o,2),Au(o))}function le(o,u,p){if(o.tag===3)Me(o,o,p);else for(;u!==null;){if(u.tag===3){Me(u,o,p);break}else if(u.tag===1){var g=u.stateNode;if(typeof u.type.getDerivedStateFromError=="function"||typeof g.componentDidCatch=="function"&&(ia===null||!ia.has(g))){o=Vs(p,o),p=Tx(2),g=yl(u,p,2),g!==null&&(vm(p,g,u,o),Ke(g,2),Au(g));break}}u=u.return}}function Ce(o,u,p){var g=o.pingCache;if(g===null){g=o.pingCache=new uv;var b=new Set;g.set(u,b)}else b=g.get(u),b===void 0&&(b=new Set,g.set(u,b));b.has(p)||(Nh=!0,b.add(p),o=tt.bind(null,o,u,p),u.then(o,o))}function tt(o,u,p){var g=o.pingCache;g!==null&&g.delete(u),o.pingedLanes|=o.suspendedLanes&p,o.warmLanes&=~p,sn===o&&(Vt&p)===p&&(Mi===4||Mi===3&&(Vt&62914560)===Vt&&300>Ge()-ri?(Wn&2)===0&&Tu(o,0):pc|=p,Fn===Vt&&(Fn=0)),Au(o)}function Lt(o,u){u===0&&(u=mt()),o=fl(o,u),o!==null&&(Ke(o,u),Au(o))}function Ei(o){var u=o.memoizedState,p=0;u!==null&&(p=u.retryLane),Lt(o,p)}function Zt(o,u){var p=0;switch(o.tag){case 13:var g=o.stateNode,b=o.memoizedState;b!==null&&(p=b.retryLane);break;case 19:g=o.stateNode;break;case 22:g=o.stateNode._retryCache;break;default:throw Error(n(314))}g!==null&&g.delete(u),Lt(o,p)}function Gn(o,u){return $t(o,u)}var Ji=null,Mn=null,Ho=!1,Rm=!1,yM=!1,ud=0;function Au(o){o!==Mn&&o.next===null&&(Mn===null?Ji=Mn=o:Mn=Mn.next=o),Rm=!0,Ho||(Ho=!0,xI())}function cv(o,u){if(!yM&&Rm){yM=!0;do for(var p=!1,g=Ji;g!==null;){if(o!==0){var b=g.pendingLanes;if(b===0)var R=0;else{var O=g.suspendedLanes,k=g.pingedLanes;R=(1<<31-ot(42|o)+1)-1,R&=b&~(O&~k),R=R&201326741?R&201326741|1:R?R|2:0}R!==0&&(p=!0,qN(g,R))}else R=Vt,R=dn(g,g===sn?R:0,g.cancelPendingCommit!==null||g.timeoutHandle!==-1),(R&3)===0||kt(g,R)||(p=!0,qN(g,R));g=g.next}while(p);yM=!1}}function _I(){GN()}function GN(){Rm=Ho=!1;var o=0;ud!==0&&(NI()&&(o=ud),ud=0);for(var u=Ge(),p=null,g=Ji;g!==null;){var b=g.next,R=HN(g,u);R===0?(g.next=null,p===null?Ji=b:p.next=b,b===null&&(Mn=p)):(p=g,(o!==0||(R&3)!==0)&&(Rm=!0)),g=b}cv(o)}function HN(o,u){for(var p=o.suspendedLanes,g=o.pingedLanes,b=o.expirationTimes,R=o.pendingLanes&-62914561;0<R;){var O=31-ot(R),k=1<<O,$=b[O];$===-1?((k&p)===0||(k&g)!==0)&&(b[O]=zn(k,u)):$<=u&&(o.expiredLanes|=k),R&=~k}if(u=sn,p=Vt,p=dn(o,o===u?p:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),g=o.callbackNode,p===0||o===u&&(pn===2||pn===9)||o.cancelPendingCommit!==null)return g!==null&&g!==null&&ne(g),o.callbackNode=null,o.callbackPriority=0;if((p&3)===0||kt(o,p)){if(u=p&-p,u===o.callbackPriority)return u;switch(g!==null&&ne(g),Ci(p)){case 2:case 8:p=Ie;break;case 32:p=j;break;case 268435456:p=de;break;default:p=j}return g=kN.bind(null,o),p=$t(p,g),o.callbackPriority=u,o.callbackNode=p,u}return g!==null&&g!==null&&ne(g),o.callbackPriority=2,o.callbackNode=null,2}function kN(o,u){if(vs!==0&&vs!==5)return o.callbackNode=null,o.callbackPriority=0,null;var p=o.callbackNode;if(Mu()&&o.callbackNode!==p)return null;var g=Vt;return g=dn(o,o===sn?g:0,o.cancelPendingCommit!==null||o.timeoutHandle!==-1),g===0?null:(Ch(o,g,u),HN(o,Ge()),o.callbackNode!=null&&o.callbackNode===p?kN.bind(null,o):null)}function qN(o,u){if(Mu())return null;Ch(o,u,!0)}function xI(){wI(function(){(Wn&6)!==0?$t(at,_I):GN()})}function vM(){return ud===0&&(ud=fe()),ud}function WN(o){return o==null||typeof o=="symbol"||typeof o=="boolean"?null:typeof o=="function"?o:Sf(""+o)}function XN(o,u){var p=u.ownerDocument.createElement("input");return p.name=u.name,p.value=u.value,o.id&&p.setAttribute("form",o.id),u.parentNode.insertBefore(p,u),o=new FormData(o),p.parentNode.removeChild(p),o}function SI(o,u,p,g,b){if(u==="submit"&&p&&p.stateNode===b){var R=WN((b[ps]||null).action),O=g.submitter;O&&(u=(u=O[ps]||null)?WN(u.formAction):O.getAttribute("formAction"),u!==null&&(R=u,O=null));var k=new Zc("action","action",null,g,b);o.push({event:k,listeners:[{instance:null,listener:function(){if(g.defaultPrevented){if(ud!==0){var $=O?XN(b,O):new FormData(b);iv(p,{pending:!0,data:$,method:b.method,action:R},null,$)}}else typeof R=="function"&&(k.preventDefault(),$=O?XN(b,O):new FormData(b),iv(p,{pending:!0,data:$,method:b.method,action:R},R,$))},currentTarget:b}]})}}for(var _M=0;_M<Pf.length;_M++){var xM=Pf[_M],bI=xM.toLowerCase(),TI=xM[0].toUpperCase()+xM.slice(1);As(bI,"on"+TI)}As(cr,"onAnimationEnd"),As(Ny,"onAnimationIteration"),As(Cr,"onAnimationStart"),As("dblclick","onDoubleClick"),As("focusin","onFocus"),As("focusout","onBlur"),As(O0,"onTransitionRun"),As(cl,"onTransitionStart"),As(ih,"onTransitionCancel"),As(hl,"onTransitionEnd"),q("onMouseEnter",["mouseout","mouseover"]),q("onMouseLeave",["mouseout","mouseover"]),q("onPointerEnter",["pointerout","pointerover"]),q("onPointerLeave",["pointerout","pointerover"]),eo("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),eo("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),eo("onBeforeInput",["compositionend","keypress","textInput","paste"]),eo("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),eo("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),eo("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var hv="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),MI=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(hv));function YN(o,u){u=(u&4)!==0;for(var p=0;p<o.length;p++){var g=o[p],b=g.event;g=g.listeners;e:{var R=void 0;if(u)for(var O=g.length-1;0<=O;O--){var k=g[O],$=k.instance,Te=k.currentTarget;if(k=k.listener,$!==R&&b.isPropagationStopped())break e;R=k,b.currentTarget=Te;try{R(b)}catch(We){nc(We)}b.currentTarget=null,R=$}else for(O=0;O<g.length;O++){if(k=g[O],$=k.instance,Te=k.currentTarget,k=k.listener,$!==R&&b.isPropagationStopped())break e;R=k,b.currentTarget=Te;try{R(b)}catch(We){nc(We)}b.currentTarget=null,R=$}}}}function Un(o,u){var p=u[Er];p===void 0&&(p=u[Er]=new Set);var g=o+"__bubble";p.has(g)||(jN(u,o,2,!1),p.add(g))}function SM(o,u,p){var g=0;u&&(g|=4),jN(p,o,g,u)}var Rx="_reactListening"+Math.random().toString(36).slice(2);function bM(o){if(!o[Rx]){o[Rx]=!0,qc.forEach(function(p){p!=="selectionchange"&&(MI.has(p)||SM(p,!1,o),SM(p,!0,o))});var u=o.nodeType===9?o:o.ownerDocument;u===null||u[Rx]||(u[Rx]=!0,SM("selectionchange",!1,u))}}function jN(o,u,p,g){switch(vC(u)){case 2:var b=QI;break;case 8:b=JI;break;default:b=PM}p=b.bind(null,u,p,o),b=void 0,!Tf||u!=="touchstart"&&u!=="touchmove"&&u!=="wheel"||(b=!0),g?b!==void 0?o.addEventListener(u,p,{capture:!0,passive:b}):o.addEventListener(u,p,!0):b!==void 0?o.addEventListener(u,p,{passive:b}):o.addEventListener(u,p,!1)}function TM(o,u,p,g,b){var R=g;if((u&1)===0&&(u&2)===0&&g!==null)e:for(;;){if(g===null)return;var O=g.tag;if(O===3||O===4){var k=g.stateNode.containerInfo;if(k===b)break;if(O===4)for(O=g.return;O!==null;){var $=O.tag;if(($===3||$===4)&&O.stateNode.containerInfo===b)return;O=O.return}for(;k!==null;){if(O=Ja(k),O===null)return;if($=O.tag,$===5||$===6||$===26||$===27){g=R=O;continue e}k=k.parentNode}}g=g.return}hy(function(){var Te=R,We=Lp(p),Je=[];e:{var Ee=Wp.get(o);if(Ee!==void 0){var Ne=Zc,Kt=o;switch(o){case"keypress":if(jl(p)===0)break e;case"keydown":case"keyup":Ne=gy;break;case"focusin":Kt="focus",Ne=Op;break;case"focusout":Kt="blur",Ne=Op;break;case"beforeblur":case"afterblur":Ne=Op;break;case"click":if(p.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":Ne=py;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":Ne=rM;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":Ne=vy;break;case cr:case Ny:case Cr:Ne=x0;break;case hl:Ne=al;break;case"scroll":case"scrollend":Ne=y0;break;case"wheel":Ne=aM;break;case"copy":case"cut":case"paste":Ne=b0;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":Ne=Ip;break;case"toggle":case"beforetoggle":Ne=Kl}var Xt=(u&4)!==0,vi=!Xt&&(o==="scroll"||o==="scrollend"),me=Xt?Ee!==null?Ee+"Capture":null:Ee;Xt=[];for(var ce=Te,be;ce!==null;){var Ye=ce;if(be=Ye.stateNode,Ye=Ye.tag,Ye!==5&&Ye!==26&&Ye!==27||be===null||me===null||(Ye=Xc(ce,me),Ye!=null&&Xt.push(fv(ce,Ye,be))),vi)break;ce=ce.return}0<Xt.length&&(Ee=new Ne(Ee,Kt,null,p,We),Je.push({event:Ee,listeners:Xt}))}}if((u&7)===0){e:{if(Ee=o==="mouseover"||o==="pointerover",Ne=o==="mouseout"||o==="pointerout",Ee&&p!==Up&&(Kt=p.relatedTarget||p.fromElement)&&(Ja(Kt)||Kt[Qs]))break e;if((Ne||Ee)&&(Ee=We.window===We?We:(Ee=We.ownerDocument)?Ee.defaultView||Ee.parentWindow:window,Ne?(Kt=p.relatedTarget||p.toElement,Ne=Te,Kt=Kt?Ja(Kt):null,Kt!==null&&(vi=s(Kt),Xt=Kt.tag,Kt!==vi||Xt!==5&&Xt!==27&&Xt!==6)&&(Kt=null)):(Ne=null,Kt=Te),Ne!==Kt)){if(Xt=py,Ye="onMouseLeave",me="onMouseEnter",ce="mouse",(o==="pointerout"||o==="pointerover")&&(Xt=Ip,Ye="onPointerLeave",me="onPointerEnter",ce="pointer"),vi=Ne==null?Ee:Xl(Ne),be=Kt==null?Ee:Xl(Kt),Ee=new Xt(Ye,ce+"leave",Ne,p,We),Ee.target=vi,Ee.relatedTarget=be,Ye=null,Ja(We)===Te&&(Xt=new Xt(me,ce+"enter",Kt,p,We),Xt.target=be,Xt.relatedTarget=vi,Ye=Xt),vi=Ye,Ne&&Kt)t:{for(Xt=Ne,me=Kt,ce=0,be=Xt;be;be=Nm(be))ce++;for(be=0,Ye=me;Ye;Ye=Nm(Ye))be++;for(;0<ce-be;)Xt=Nm(Xt),ce--;for(;0<be-ce;)me=Nm(me),be--;for(;ce--;){if(Xt===me||me!==null&&Xt===me.alternate)break t;Xt=Nm(Xt),me=Nm(me)}Xt=null}else Xt=null;Ne!==null&&ZN(Je,Ee,Ne,Xt,!1),Kt!==null&&vi!==null&&ZN(Je,vi,Kt,Xt,!0)}}e:{if(Ee=Te?Xl(Te):window,Ne=Ee.nodeName&&Ee.nodeName.toLowerCase(),Ne==="select"||Ne==="input"&&Ee.type==="file")var At=zp;else if(by(Ee))if(Vp)At=$l;else{At=U0;var Cn=oM}else Ne=Ee.nodeName,!Ne||Ne.toLowerCase()!=="input"||Ee.type!=="checkbox"&&Ee.type!=="radio"?Te&&Dp(Te.elementType)&&(At=zp):At=Lf;if(At&&(At=At(o,Te))){Ar(Je,At,p,We);break e}Cn&&Cn(o,Ee,Te),o==="focusout"&&Te&&Ee.type==="number"&&Te.memoizedProps.value!=null&&Ps(Ee,"number",Ee.value)}switch(Cn=Te?Xl(Te):window,o){case"focusin":(by(Cn)||Cn.contentEditable==="true")&&(ll=Cn,Hp=Te,Of=null);break;case"focusout":Of=Hp=ll=null;break;case"mousedown":kp=!0;break;case"contextmenu":case"mouseup":case"dragend":kp=!1,Ry(Je,p,We);break;case"selectionchange":if(Ay)break;case"keydown":case"keyup":Ry(Je,p,We)}var Bt;if(Rf)e:{switch(o){case"compositionstart":var Yt="onCompositionStart";break e;case"compositionend":Yt="onCompositionEnd";break e;case"compositionupdate":Yt="onCompositionUpdate";break e}Yt=void 0}else Jl?wf(o,p)&&(Yt="onCompositionEnd"):o==="keydown"&&p.keyCode===229&&(Yt="onCompositionStart");Yt&&(Cf&&p.locale!=="ko"&&(Jl||Yt!=="onCompositionStart"?Yt==="onCompositionEnd"&&Jl&&(Bt=dy()):(sl=We,fy="value"in sl?sl.value:sl.textContent,Jl=!0)),Cn=Nx(Te,Yt),0<Cn.length&&(Yt=new Pp(Yt,o,null,p,We),Je.push({event:Yt,listeners:Cn}),Bt?Yt.data=Bt:(Bt=xy(p),Bt!==null&&(Yt.data=Bt)))),(Bt=Nf?Df(o,p):Sy(o,p))&&(Yt=Nx(Te,"onBeforeInput"),0<Yt.length&&(Cn=new Pp("onBeforeInput","beforeinput",null,p,We),Je.push({event:Cn,listeners:Yt}),Cn.data=Bt)),SI(Je,o,Te,p,We)}YN(Je,u)})}function fv(o,u,p){return{instance:o,listener:u,currentTarget:p}}function Nx(o,u){for(var p=u+"Capture",g=[];o!==null;){var b=o,R=b.stateNode;if(b=b.tag,b!==5&&b!==26&&b!==27||R===null||(b=Xc(o,p),b!=null&&g.unshift(fv(o,b,R)),b=Xc(o,u),b!=null&&g.push(fv(o,b,R))),o.tag===3)return g;o=o.return}return[]}function Nm(o){if(o===null)return null;do o=o.return;while(o&&o.tag!==5&&o.tag!==27);return o||null}function ZN(o,u,p,g,b){for(var R=u._reactName,O=[];p!==null&&p!==g;){var k=p,$=k.alternate,Te=k.stateNode;if(k=k.tag,$!==null&&$===g)break;k!==5&&k!==26&&k!==27||Te===null||($=Te,b?(Te=Xc(p,R),Te!=null&&O.unshift(fv(p,Te,$))):b||(Te=Xc(p,R),Te!=null&&O.push(fv(p,Te,$)))),p=p.return}O.length!==0&&o.push({event:u,listeners:O})}var EI=/\r\n?/g,AI=/\u0000|\uFFFD/g;function KN(o){return(typeof o=="string"?o:""+o).replace(EI,`
`).replace(AI,"")}function QN(o,u){return u=KN(u),KN(o)===u}function Cx(){}function yi(o,u,p,g,b,R){switch(p){case"children":typeof g=="string"?u==="body"||u==="textarea"&&g===""||lr(o,g):(typeof g=="number"||typeof g=="bigint")&&u!=="body"&&lr(o,""+g);break;case"className":ut(o,"class",g);break;case"tabIndex":ut(o,"tabindex",g);break;case"dir":case"role":case"viewBox":case"width":case"height":ut(o,p,g);break;case"style":xf(o,g,R);break;case"data":if(u!=="object"){ut(o,"data",g);break}case"src":case"href":if(g===""&&(u!=="a"||p!=="href")){o.removeAttribute(p);break}if(g==null||typeof g=="function"||typeof g=="symbol"||typeof g=="boolean"){o.removeAttribute(p);break}g=Sf(""+g),o.setAttribute(p,g);break;case"action":case"formAction":if(typeof g=="function"){o.setAttribute(p,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof R=="function"&&(p==="formAction"?(u!=="input"&&yi(o,u,"name",b.name,b,null),yi(o,u,"formEncType",b.formEncType,b,null),yi(o,u,"formMethod",b.formMethod,b,null),yi(o,u,"formTarget",b.formTarget,b,null)):(yi(o,u,"encType",b.encType,b,null),yi(o,u,"method",b.method,b,null),yi(o,u,"target",b.target,b,null)));if(g==null||typeof g=="symbol"||typeof g=="boolean"){o.removeAttribute(p);break}g=Sf(""+g),o.setAttribute(p,g);break;case"onClick":g!=null&&(o.onclick=Cx);break;case"onScroll":g!=null&&Un("scroll",o);break;case"onScrollEnd":g!=null&&Un("scrollend",o);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(p=g.__html,p!=null){if(b.children!=null)throw Error(n(60));o.innerHTML=p}}break;case"multiple":o.multiple=g&&typeof g!="function"&&typeof g!="symbol";break;case"muted":o.muted=g&&typeof g!="function"&&typeof g!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(g==null||typeof g=="function"||typeof g=="boolean"||typeof g=="symbol"){o.removeAttribute("xlink:href");break}p=Sf(""+g),o.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",p);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":g!=null&&typeof g!="function"&&typeof g!="symbol"?o.setAttribute(p,""+g):o.removeAttribute(p);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":g&&typeof g!="function"&&typeof g!="symbol"?o.setAttribute(p,""):o.removeAttribute(p);break;case"capture":case"download":g===!0?o.setAttribute(p,""):g!==!1&&g!=null&&typeof g!="function"&&typeof g!="symbol"?o.setAttribute(p,g):o.removeAttribute(p);break;case"cols":case"rows":case"size":case"span":g!=null&&typeof g!="function"&&typeof g!="symbol"&&!isNaN(g)&&1<=g?o.setAttribute(p,g):o.removeAttribute(p);break;case"rowSpan":case"start":g==null||typeof g=="function"||typeof g=="symbol"||isNaN(g)?o.removeAttribute(p):o.setAttribute(p,g);break;case"popover":Un("beforetoggle",o),Un("toggle",o),$e(o,"popover",g);break;case"xlinkActuate":dt(o,"http://www.w3.org/1999/xlink","xlink:actuate",g);break;case"xlinkArcrole":dt(o,"http://www.w3.org/1999/xlink","xlink:arcrole",g);break;case"xlinkRole":dt(o,"http://www.w3.org/1999/xlink","xlink:role",g);break;case"xlinkShow":dt(o,"http://www.w3.org/1999/xlink","xlink:show",g);break;case"xlinkTitle":dt(o,"http://www.w3.org/1999/xlink","xlink:title",g);break;case"xlinkType":dt(o,"http://www.w3.org/1999/xlink","xlink:type",g);break;case"xmlBase":dt(o,"http://www.w3.org/XML/1998/namespace","xml:base",g);break;case"xmlLang":dt(o,"http://www.w3.org/XML/1998/namespace","xml:lang",g);break;case"xmlSpace":dt(o,"http://www.w3.org/XML/1998/namespace","xml:space",g);break;case"is":$e(o,"is",g);break;case"innerText":case"textContent":break;default:(!(2<p.length)||p[0]!=="o"&&p[0]!=="O"||p[1]!=="n"&&p[1]!=="N")&&(p=uy.get(p)||p,$e(o,p,g))}}function MM(o,u,p,g,b,R){switch(p){case"style":xf(o,g,R);break;case"dangerouslySetInnerHTML":if(g!=null){if(typeof g!="object"||!("__html"in g))throw Error(n(61));if(p=g.__html,p!=null){if(b.children!=null)throw Error(n(60));o.innerHTML=p}}break;case"children":typeof g=="string"?lr(o,g):(typeof g=="number"||typeof g=="bigint")&&lr(o,""+g);break;case"onScroll":g!=null&&Un("scroll",o);break;case"onScrollEnd":g!=null&&Un("scrollend",o);break;case"onClick":g!=null&&(o.onclick=Cx);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!Wc.hasOwnProperty(p))e:{if(p[0]==="o"&&p[1]==="n"&&(b=p.endsWith("Capture"),u=p.slice(2,b?p.length-7:void 0),R=o[ps]||null,R=R!=null?R[p]:null,typeof R=="function"&&o.removeEventListener(u,R,b),typeof g=="function")){typeof R!="function"&&R!==null&&(p in o?o[p]=null:o.hasAttribute(p)&&o.removeAttribute(p)),o.addEventListener(u,g,b);break e}p in o?o[p]=g:g===!0?o.setAttribute(p,""):$e(o,p,g)}}}function yr(o,u,p){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Un("error",o),Un("load",o);var g=!1,b=!1,R;for(R in p)if(p.hasOwnProperty(R)){var O=p[R];if(O!=null)switch(R){case"src":g=!0;break;case"srcSet":b=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(n(137,u));default:yi(o,u,R,O,p,null)}}b&&yi(o,u,"srcSet",p.srcSet,p,null),g&&yi(o,u,"src",p.src,p,null);return;case"input":Un("invalid",o);var k=R=O=b=null,$=null,Te=null;for(g in p)if(p.hasOwnProperty(g)){var We=p[g];if(We!=null)switch(g){case"name":b=We;break;case"type":O=We;break;case"checked":$=We;break;case"defaultChecked":Te=We;break;case"value":R=We;break;case"defaultValue":k=We;break;case"children":case"dangerouslySetInnerHTML":if(We!=null)throw Error(n(137,u));break;default:yi(o,u,g,We,p,null)}}si(o,R,k,$,Te,O,b,!1),Bi(o);return;case"select":Un("invalid",o),g=O=R=null;for(b in p)if(p.hasOwnProperty(b)&&(k=p[b],k!=null))switch(b){case"value":R=k;break;case"defaultValue":O=k;break;case"multiple":g=k;default:yi(o,u,b,k,p,null)}u=R,p=O,o.multiple=!!g,u!=null?is(o,!!g,u,!1):p!=null&&is(o,!!g,p,!0);return;case"textarea":Un("invalid",o),R=b=g=null;for(O in p)if(p.hasOwnProperty(O)&&(k=p[O],k!=null))switch(O){case"value":g=k;break;case"defaultValue":b=k;break;case"children":R=k;break;case"dangerouslySetInnerHTML":if(k!=null)throw Error(n(91));break;default:yi(o,u,O,k,p,null)}Es(o,g,b,R),Bi(o);return;case"option":for($ in p)if(p.hasOwnProperty($)&&(g=p[$],g!=null))switch($){case"selected":o.selected=g&&typeof g!="function"&&typeof g!="symbol";break;default:yi(o,u,$,g,p,null)}return;case"dialog":Un("beforetoggle",o),Un("toggle",o),Un("cancel",o),Un("close",o);break;case"iframe":case"object":Un("load",o);break;case"video":case"audio":for(g=0;g<hv.length;g++)Un(hv[g],o);break;case"image":Un("error",o),Un("load",o);break;case"details":Un("toggle",o);break;case"embed":case"source":case"link":Un("error",o),Un("load",o);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Te in p)if(p.hasOwnProperty(Te)&&(g=p[Te],g!=null))switch(Te){case"children":case"dangerouslySetInnerHTML":throw Error(n(137,u));default:yi(o,u,Te,g,p,null)}return;default:if(Dp(u)){for(We in p)p.hasOwnProperty(We)&&(g=p[We],g!==void 0&&MM(o,u,We,g,p,void 0));return}}for(k in p)p.hasOwnProperty(k)&&(g=p[k],g!=null&&yi(o,u,k,g,p,null))}function RI(o,u,p,g){switch(u){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var b=null,R=null,O=null,k=null,$=null,Te=null,We=null;for(Ne in p){var Je=p[Ne];if(p.hasOwnProperty(Ne)&&Je!=null)switch(Ne){case"checked":break;case"value":break;case"defaultValue":$=Je;default:g.hasOwnProperty(Ne)||yi(o,u,Ne,null,g,Je)}}for(var Ee in g){var Ne=g[Ee];if(Je=p[Ee],g.hasOwnProperty(Ee)&&(Ne!=null||Je!=null))switch(Ee){case"type":R=Ne;break;case"name":b=Ne;break;case"checked":Te=Ne;break;case"defaultChecked":We=Ne;break;case"value":O=Ne;break;case"defaultValue":k=Ne;break;case"children":case"dangerouslySetInnerHTML":if(Ne!=null)throw Error(n(137,u));break;default:Ne!==Je&&yi(o,u,Ee,Ne,g,Je)}}Mo(o,O,k,$,Te,We,R,b);return;case"select":Ne=O=k=Ee=null;for(R in p)if($=p[R],p.hasOwnProperty(R)&&$!=null)switch(R){case"value":break;case"multiple":Ne=$;default:g.hasOwnProperty(R)||yi(o,u,R,null,g,$)}for(b in g)if(R=g[b],$=p[b],g.hasOwnProperty(b)&&(R!=null||$!=null))switch(b){case"value":Ee=R;break;case"defaultValue":k=R;break;case"multiple":O=R;default:R!==$&&yi(o,u,b,R,g,$)}u=k,p=O,g=Ne,Ee!=null?is(o,!!p,Ee,!1):!!g!=!!p&&(u!=null?is(o,!!p,u,!0):is(o,!!p,p?[]:"",!1));return;case"textarea":Ne=Ee=null;for(k in p)if(b=p[k],p.hasOwnProperty(k)&&b!=null&&!g.hasOwnProperty(k))switch(k){case"value":break;case"children":break;default:yi(o,u,k,null,g,b)}for(O in g)if(b=g[O],R=p[O],g.hasOwnProperty(O)&&(b!=null||R!=null))switch(O){case"value":Ee=b;break;case"defaultValue":Ne=b;break;case"children":break;case"dangerouslySetInnerHTML":if(b!=null)throw Error(n(91));break;default:b!==R&&yi(o,u,O,b,g,R)}Ms(o,Ee,Ne);return;case"option":for(var Kt in p)if(Ee=p[Kt],p.hasOwnProperty(Kt)&&Ee!=null&&!g.hasOwnProperty(Kt))switch(Kt){case"selected":o.selected=!1;break;default:yi(o,u,Kt,null,g,Ee)}for($ in g)if(Ee=g[$],Ne=p[$],g.hasOwnProperty($)&&Ee!==Ne&&(Ee!=null||Ne!=null))switch($){case"selected":o.selected=Ee&&typeof Ee!="function"&&typeof Ee!="symbol";break;default:yi(o,u,$,Ee,g,Ne)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var Xt in p)Ee=p[Xt],p.hasOwnProperty(Xt)&&Ee!=null&&!g.hasOwnProperty(Xt)&&yi(o,u,Xt,null,g,Ee);for(Te in g)if(Ee=g[Te],Ne=p[Te],g.hasOwnProperty(Te)&&Ee!==Ne&&(Ee!=null||Ne!=null))switch(Te){case"children":case"dangerouslySetInnerHTML":if(Ee!=null)throw Error(n(137,u));break;default:yi(o,u,Te,Ee,g,Ne)}return;default:if(Dp(u)){for(var vi in p)Ee=p[vi],p.hasOwnProperty(vi)&&Ee!==void 0&&!g.hasOwnProperty(vi)&&MM(o,u,vi,void 0,g,Ee);for(We in g)Ee=g[We],Ne=p[We],!g.hasOwnProperty(We)||Ee===Ne||Ee===void 0&&Ne===void 0||MM(o,u,We,Ee,g,Ne);return}}for(var me in p)Ee=p[me],p.hasOwnProperty(me)&&Ee!=null&&!g.hasOwnProperty(me)&&yi(o,u,me,null,g,Ee);for(Je in g)Ee=g[Je],Ne=p[Je],!g.hasOwnProperty(Je)||Ee===Ne||Ee==null&&Ne==null||yi(o,u,Je,Ee,g,Ne)}var EM=null,AM=null;function wx(o){return o.nodeType===9?o:o.ownerDocument}function JN(o){switch(o){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function $N(o,u){if(o===0)switch(u){case"svg":return 1;case"math":return 2;default:return 0}return o===1&&u==="foreignObject"?0:o}function RM(o,u){return o==="textarea"||o==="noscript"||typeof u.children=="string"||typeof u.children=="number"||typeof u.children=="bigint"||typeof u.dangerouslySetInnerHTML=="object"&&u.dangerouslySetInnerHTML!==null&&u.dangerouslySetInnerHTML.__html!=null}var NM=null;function NI(){var o=window.event;return o&&o.type==="popstate"?o===NM?!1:(NM=o,!0):(NM=null,!1)}var eC=typeof setTimeout=="function"?setTimeout:void 0,CI=typeof clearTimeout=="function"?clearTimeout:void 0,tC=typeof Promise=="function"?Promise:void 0,wI=typeof queueMicrotask=="function"?queueMicrotask:typeof tC<"u"?function(o){return tC.resolve(null).then(o).catch(DI)}:eC;function DI(o){setTimeout(function(){throw o})}function Dh(o){return o==="head"}function nC(o,u){var p=u,g=0,b=0;do{var R=p.nextSibling;if(o.removeChild(p),R&&R.nodeType===8)if(p=R.data,p==="/$"){if(0<g&&8>g){p=g;var O=o.ownerDocument;if(p&1&&dv(O.documentElement),p&2&&dv(O.body),p&4)for(p=O.head,dv(p),O=p.firstChild;O;){var k=O.nextSibling,$=O.nodeName;O[Qa]||$==="SCRIPT"||$==="STYLE"||$==="LINK"&&O.rel.toLowerCase()==="stylesheet"||p.removeChild(O),O=k}}if(b===0){o.removeChild(R),Sv(u);return}b--}else p==="$"||p==="$?"||p==="$!"?b++:g=p.charCodeAt(0)-48;else g=0;p=R}while(p);Sv(u)}function CM(o){var u=o.firstChild;for(u&&u.nodeType===10&&(u=u.nextSibling);u;){var p=u;switch(u=u.nextSibling,p.nodeName){case"HTML":case"HEAD":case"BODY":CM(p),ii(p);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(p.rel.toLowerCase()==="stylesheet")continue}o.removeChild(p)}}function UI(o,u,p,g){for(;o.nodeType===1;){var b=p;if(o.nodeName.toLowerCase()!==u.toLowerCase()){if(!g&&(o.nodeName!=="INPUT"||o.type!=="hidden"))break}else if(g){if(!o[Qa])switch(u){case"meta":if(!o.hasAttribute("itemprop"))break;return o;case"link":if(R=o.getAttribute("rel"),R==="stylesheet"&&o.hasAttribute("data-precedence"))break;if(R!==b.rel||o.getAttribute("href")!==(b.href==null||b.href===""?null:b.href)||o.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin)||o.getAttribute("title")!==(b.title==null?null:b.title))break;return o;case"style":if(o.hasAttribute("data-precedence"))break;return o;case"script":if(R=o.getAttribute("src"),(R!==(b.src==null?null:b.src)||o.getAttribute("type")!==(b.type==null?null:b.type)||o.getAttribute("crossorigin")!==(b.crossOrigin==null?null:b.crossOrigin))&&R&&o.hasAttribute("async")&&!o.hasAttribute("itemprop"))break;return o;default:return o}}else if(u==="input"&&o.type==="hidden"){var R=b.name==null?null:""+b.name;if(b.type==="hidden"&&o.getAttribute("name")===R)return o}else return o;if(o=Rl(o.nextSibling),o===null)break}return null}function LI(o,u,p){if(u==="")return null;for(;o.nodeType!==3;)if((o.nodeType!==1||o.nodeName!=="INPUT"||o.type!=="hidden")&&!p||(o=Rl(o.nextSibling),o===null))return null;return o}function wM(o){return o.data==="$!"||o.data==="$?"&&o.ownerDocument.readyState==="complete"}function BI(o,u){var p=o.ownerDocument;if(o.data!=="$?"||p.readyState==="complete")u();else{var g=function(){u(),p.removeEventListener("DOMContentLoaded",g)};p.addEventListener("DOMContentLoaded",g),o._reactRetry=g}}function Rl(o){for(;o!=null;o=o.nextSibling){var u=o.nodeType;if(u===1||u===3)break;if(u===8){if(u=o.data,u==="$"||u==="$!"||u==="$?"||u==="F!"||u==="F")break;if(u==="/$")return null}}return o}var DM=null;function iC(o){o=o.previousSibling;for(var u=0;o;){if(o.nodeType===8){var p=o.data;if(p==="$"||p==="$!"||p==="$?"){if(u===0)return o;u--}else p==="/$"&&u++}o=o.previousSibling}return null}function sC(o,u,p){switch(u=wx(p),o){case"html":if(o=u.documentElement,!o)throw Error(n(452));return o;case"head":if(o=u.head,!o)throw Error(n(453));return o;case"body":if(o=u.body,!o)throw Error(n(454));return o;default:throw Error(n(451))}}function dv(o){for(var u=o.attributes;u.length;)o.removeAttributeNode(u[0]);ii(o)}var ko=new Map,rC=new Set;function Dx(o){return typeof o.getRootNode=="function"?o.getRootNode():o.nodeType===9?o:o.ownerDocument}var yc=Q.d;Q.d={f:OI,r:PI,D:II,C:FI,L:zI,m:VI,X:HI,S:GI,M:kI};function OI(){var o=yc.f(),u=Go();return o||u}function PI(o){var u=$a(o);u!==null&&u.tag===5&&u.type==="form"?cx(u):yc.r(o)}var Cm=typeof document>"u"?null:document;function aC(o,u,p){var g=Cm;if(g&&typeof u=="string"&&u){var b=li(u);b='link[rel="'+o+'"][href="'+b+'"]',typeof p=="string"&&(b+='[crossorigin="'+p+'"]'),rC.has(b)||(rC.add(b),o={rel:o,crossOrigin:p,href:u},g.querySelector(b)===null&&(u=g.createElement("link"),yr(u,"link",o),ns(u),g.head.appendChild(u)))}}function II(o){yc.D(o),aC("dns-prefetch",o,null)}function FI(o,u){yc.C(o,u),aC("preconnect",o,u)}function zI(o,u,p){yc.L(o,u,p);var g=Cm;if(g&&o&&u){var b='link[rel="preload"][as="'+li(u)+'"]';u==="image"&&p&&p.imageSrcSet?(b+='[imagesrcset="'+li(p.imageSrcSet)+'"]',typeof p.imageSizes=="string"&&(b+='[imagesizes="'+li(p.imageSizes)+'"]')):b+='[href="'+li(o)+'"]';var R=b;switch(u){case"style":R=wm(o);break;case"script":R=Dm(o)}ko.has(R)||(o=m({rel:"preload",href:u==="image"&&p&&p.imageSrcSet?void 0:o,as:u},p),ko.set(R,o),g.querySelector(b)!==null||u==="style"&&g.querySelector(pv(R))||u==="script"&&g.querySelector(mv(R))||(u=g.createElement("link"),yr(u,"link",o),ns(u),g.head.appendChild(u)))}}function VI(o,u){yc.m(o,u);var p=Cm;if(p&&o){var g=u&&typeof u.as=="string"?u.as:"script",b='link[rel="modulepreload"][as="'+li(g)+'"][href="'+li(o)+'"]',R=b;switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":R=Dm(o)}if(!ko.has(R)&&(o=m({rel:"modulepreload",href:o},u),ko.set(R,o),p.querySelector(b)===null)){switch(g){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(p.querySelector(mv(R)))return}g=p.createElement("link"),yr(g,"link",o),ns(g),p.head.appendChild(g)}}}function GI(o,u,p){yc.S(o,u,p);var g=Cm;if(g&&o){var b=il(g).hoistableStyles,R=wm(o);u=u||"default";var O=b.get(R);if(!O){var k={loading:0,preload:null};if(O=g.querySelector(pv(R)))k.loading=5;else{o=m({rel:"stylesheet",href:o,"data-precedence":u},p),(p=ko.get(R))&&UM(o,p);var $=O=g.createElement("link");ns($),yr($,"link",o),$._p=new Promise(function(Te,We){$.onload=Te,$.onerror=We}),$.addEventListener("load",function(){k.loading|=1}),$.addEventListener("error",function(){k.loading|=2}),k.loading|=4,Ux(O,u,g)}O={type:"stylesheet",instance:O,count:1,state:k},b.set(R,O)}}}function HI(o,u){yc.X(o,u);var p=Cm;if(p&&o){var g=il(p).hoistableScripts,b=Dm(o),R=g.get(b);R||(R=p.querySelector(mv(b)),R||(o=m({src:o,async:!0},u),(u=ko.get(b))&&LM(o,u),R=p.createElement("script"),ns(R),yr(R,"link",o),p.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},g.set(b,R))}}function kI(o,u){yc.M(o,u);var p=Cm;if(p&&o){var g=il(p).hoistableScripts,b=Dm(o),R=g.get(b);R||(R=p.querySelector(mv(b)),R||(o=m({src:o,async:!0,type:"module"},u),(u=ko.get(b))&&LM(o,u),R=p.createElement("script"),ns(R),yr(R,"link",o),p.head.appendChild(R)),R={type:"script",instance:R,count:1,state:null},g.set(b,R))}}function oC(o,u,p,g){var b=(b=je.current)?Dx(b):null;if(!b)throw Error(n(446));switch(o){case"meta":case"title":return null;case"style":return typeof p.precedence=="string"&&typeof p.href=="string"?(u=wm(p.href),p=il(b).hoistableStyles,g=p.get(u),g||(g={type:"style",instance:null,count:0,state:null},p.set(u,g)),g):{type:"void",instance:null,count:0,state:null};case"link":if(p.rel==="stylesheet"&&typeof p.href=="string"&&typeof p.precedence=="string"){o=wm(p.href);var R=il(b).hoistableStyles,O=R.get(o);if(O||(b=b.ownerDocument||b,O={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},R.set(o,O),(R=b.querySelector(pv(o)))&&!R._p&&(O.instance=R,O.state.loading=5),ko.has(o)||(p={rel:"preload",as:"style",href:p.href,crossOrigin:p.crossOrigin,integrity:p.integrity,media:p.media,hrefLang:p.hrefLang,referrerPolicy:p.referrerPolicy},ko.set(o,p),R||qI(b,o,p,O.state))),u&&g===null)throw Error(n(528,""));return O}if(u&&g!==null)throw Error(n(529,""));return null;case"script":return u=p.async,p=p.src,typeof p=="string"&&u&&typeof u!="function"&&typeof u!="symbol"?(u=Dm(p),p=il(b).hoistableScripts,g=p.get(u),g||(g={type:"script",instance:null,count:0,state:null},p.set(u,g)),g):{type:"void",instance:null,count:0,state:null};default:throw Error(n(444,o))}}function wm(o){return'href="'+li(o)+'"'}function pv(o){return'link[rel="stylesheet"]['+o+"]"}function lC(o){return m({},o,{"data-precedence":o.precedence,precedence:null})}function qI(o,u,p,g){o.querySelector('link[rel="preload"][as="style"]['+u+"]")?g.loading=1:(u=o.createElement("link"),g.preload=u,u.addEventListener("load",function(){return g.loading|=1}),u.addEventListener("error",function(){return g.loading|=2}),yr(u,"link",p),ns(u),o.head.appendChild(u))}function Dm(o){return'[src="'+li(o)+'"]'}function mv(o){return"script[async]"+o}function uC(o,u,p){if(u.count++,u.instance===null)switch(u.type){case"style":var g=o.querySelector('style[data-href~="'+li(p.href)+'"]');if(g)return u.instance=g,ns(g),g;var b=m({},p,{"data-href":p.href,"data-precedence":p.precedence,href:null,precedence:null});return g=(o.ownerDocument||o).createElement("style"),ns(g),yr(g,"style",b),Ux(g,p.precedence,o),u.instance=g;case"stylesheet":b=wm(p.href);var R=o.querySelector(pv(b));if(R)return u.state.loading|=4,u.instance=R,ns(R),R;g=lC(p),(b=ko.get(b))&&UM(g,b),R=(o.ownerDocument||o).createElement("link"),ns(R);var O=R;return O._p=new Promise(function(k,$){O.onload=k,O.onerror=$}),yr(R,"link",g),u.state.loading|=4,Ux(R,p.precedence,o),u.instance=R;case"script":return R=Dm(p.src),(b=o.querySelector(mv(R)))?(u.instance=b,ns(b),b):(g=p,(b=ko.get(R))&&(g=m({},p),LM(g,b)),o=o.ownerDocument||o,b=o.createElement("script"),ns(b),yr(b,"link",g),o.head.appendChild(b),u.instance=b);case"void":return null;default:throw Error(n(443,u.type))}else u.type==="stylesheet"&&(u.state.loading&4)===0&&(g=u.instance,u.state.loading|=4,Ux(g,p.precedence,o));return u.instance}function Ux(o,u,p){for(var g=p.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),b=g.length?g[g.length-1]:null,R=b,O=0;O<g.length;O++){var k=g[O];if(k.dataset.precedence===u)R=k;else if(R!==b)break}R?R.parentNode.insertBefore(o,R.nextSibling):(u=p.nodeType===9?p.head:p,u.insertBefore(o,u.firstChild))}function UM(o,u){o.crossOrigin==null&&(o.crossOrigin=u.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=u.referrerPolicy),o.title==null&&(o.title=u.title)}function LM(o,u){o.crossOrigin==null&&(o.crossOrigin=u.crossOrigin),o.referrerPolicy==null&&(o.referrerPolicy=u.referrerPolicy),o.integrity==null&&(o.integrity=u.integrity)}var Lx=null;function cC(o,u,p){if(Lx===null){var g=new Map,b=Lx=new Map;b.set(p,g)}else b=Lx,g=b.get(p),g||(g=new Map,b.set(p,g));if(g.has(o))return g;for(g.set(o,null),p=p.getElementsByTagName(o),b=0;b<p.length;b++){var R=p[b];if(!(R[Qa]||R[ts]||o==="link"&&R.getAttribute("rel")==="stylesheet")&&R.namespaceURI!=="http://www.w3.org/2000/svg"){var O=R.getAttribute(u)||"";O=o+O;var k=g.get(O);k?k.push(R):g.set(O,[R])}}return g}function hC(o,u,p){o=o.ownerDocument||o,o.head.insertBefore(p,u==="title"?o.querySelector("head > title"):null)}function WI(o,u,p){if(p===1||u.itemProp!=null)return!1;switch(o){case"meta":case"title":return!0;case"style":if(typeof u.precedence!="string"||typeof u.href!="string"||u.href==="")break;return!0;case"link":if(typeof u.rel!="string"||typeof u.href!="string"||u.href===""||u.onLoad||u.onError)break;switch(u.rel){case"stylesheet":return o=u.disabled,typeof u.precedence=="string"&&o==null;default:return!0}case"script":if(u.async&&typeof u.async!="function"&&typeof u.async!="symbol"&&!u.onLoad&&!u.onError&&u.src&&typeof u.src=="string")return!0}return!1}function fC(o){return!(o.type==="stylesheet"&&(o.state.loading&3)===0)}var gv=null;function XI(){}function YI(o,u,p){if(gv===null)throw Error(n(475));var g=gv;if(u.type==="stylesheet"&&(typeof p.media!="string"||matchMedia(p.media).matches!==!1)&&(u.state.loading&4)===0){if(u.instance===null){var b=wm(p.href),R=o.querySelector(pv(b));if(R){o=R._p,o!==null&&typeof o=="object"&&typeof o.then=="function"&&(g.count++,g=Bx.bind(g),o.then(g,g)),u.state.loading|=4,u.instance=R,ns(R);return}R=o.ownerDocument||o,p=lC(p),(b=ko.get(b))&&UM(p,b),R=R.createElement("link"),ns(R);var O=R;O._p=new Promise(function(k,$){O.onload=k,O.onerror=$}),yr(R,"link",p),u.instance=R}g.stylesheets===null&&(g.stylesheets=new Map),g.stylesheets.set(u,o),(o=u.state.preload)&&(u.state.loading&3)===0&&(g.count++,u=Bx.bind(g),o.addEventListener("load",u),o.addEventListener("error",u))}}function jI(){if(gv===null)throw Error(n(475));var o=gv;return o.stylesheets&&o.count===0&&BM(o,o.stylesheets),0<o.count?function(u){var p=setTimeout(function(){if(o.stylesheets&&BM(o,o.stylesheets),o.unsuspend){var g=o.unsuspend;o.unsuspend=null,g()}},6e4);return o.unsuspend=u,function(){o.unsuspend=null,clearTimeout(p)}}:null}function Bx(){if(this.count--,this.count===0){if(this.stylesheets)BM(this,this.stylesheets);else if(this.unsuspend){var o=this.unsuspend;this.unsuspend=null,o()}}}var Ox=null;function BM(o,u){o.stylesheets=null,o.unsuspend!==null&&(o.count++,Ox=new Map,u.forEach(ZI,o),Ox=null,Bx.call(o))}function ZI(o,u){if(!(u.state.loading&4)){var p=Ox.get(o);if(p)var g=p.get(null);else{p=new Map,Ox.set(o,p);for(var b=o.querySelectorAll("link[data-precedence],style[data-precedence]"),R=0;R<b.length;R++){var O=b[R];(O.nodeName==="LINK"||O.getAttribute("media")!=="not all")&&(p.set(O.dataset.precedence,O),g=O)}g&&p.set(null,g)}b=u.instance,O=b.getAttribute("data-precedence"),R=p.get(O)||g,R===g&&p.set(null,b),p.set(O,b),this.count++,g=Bx.bind(this),b.addEventListener("load",g),b.addEventListener("error",g),R?R.parentNode.insertBefore(b,R.nextSibling):(o=o.nodeType===9?o.head:o,o.insertBefore(b,o.firstChild)),u.state.loading|=4}}var yv={$$typeof:w,Provider:null,Consumer:null,_currentValue:J,_currentValue2:J,_threadCount:0};function KI(o,u,p,g,b,R,O,k){this.tag=1,this.containerInfo=o,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ue(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ue(0),this.hiddenUpdates=Ue(null),this.identifierPrefix=g,this.onUncaughtError=b,this.onCaughtError=R,this.onRecoverableError=O,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=k,this.incompleteTransitions=new Map}function dC(o,u,p,g,b,R,O,k,$,Te,We,Je){return o=new KI(o,u,p,O,k,$,Te,Je),u=1,R===!0&&(u|=24),R=wr(3,null,null,u),o.current=R,R.stateNode=o,u=Jp(),u.refCount++,o.pooledCache=u,u.refCount++,R.memoizedState={element:g,isDehydrated:p,cache:u},Gy(R),o}function pC(o){return o?(o=nu,o):nu}function mC(o,u,p,g,b,R){b=pC(b),g.context===null?g.context=b:g.pendingContext=b,g=wo(u),g.payload={element:p},R=R===void 0?null:R,R!==null&&(g.callback=R),p=yl(o,g,u),p!==null&&(gr(p,o,u),$u(p,o,u))}function gC(o,u){if(o=o.memoizedState,o!==null&&o.dehydrated!==null){var p=o.retryLane;o.retryLane=p!==0&&p<u?p:u}}function OM(o,u){gC(o,u),(o=o.alternate)&&gC(o,u)}function yC(o){if(o.tag===13){var u=fl(o,67108864);u!==null&&gr(u,o,67108864),OM(o,67108864)}}var Px=!0;function QI(o,u,p,g){var b=V.T;V.T=null;var R=Q.p;try{Q.p=2,PM(o,u,p,g)}finally{Q.p=R,V.T=b}}function JI(o,u,p,g){var b=V.T;V.T=null;var R=Q.p;try{Q.p=8,PM(o,u,p,g)}finally{Q.p=R,V.T=b}}function PM(o,u,p,g){if(Px){var b=IM(g);if(b===null)TM(o,u,g,Ix,p),_C(o,g);else if(eF(b,o,u,p,g))g.stopPropagation();else if(_C(o,g),u&4&&-1<$I.indexOf(o)){for(;b!==null;){var R=$a(b);if(R!==null)switch(R.tag){case 3:if(R=R.stateNode,R.current.memoizedState.isDehydrated){var O=ht(R.pendingLanes);if(O!==0){var k=R;for(k.pendingLanes|=2,k.entangledLanes|=2;O;){var $=1<<31-ot(O);k.entanglements[1]|=$,O&=~$}Au(R),(Wn&6)===0&&(er=Ge()+500,cv(0))}}break;case 13:k=fl(R,2),k!==null&&gr(k,R,2),Go(),OM(R,2)}if(R=IM(g),R===null&&TM(o,u,g,Ix,p),R===b)break;b=R}b!==null&&g.stopPropagation()}else TM(o,u,g,null,p)}}function IM(o){return o=Lp(o),FM(o)}var Ix=null;function FM(o){if(Ix=null,o=Ja(o),o!==null){var u=s(o);if(u===null)o=null;else{var p=u.tag;if(p===13){if(o=a(u),o!==null)return o;o=null}else if(p===3){if(u.stateNode.current.memoizedState.isDehydrated)return u.tag===3?u.stateNode.containerInfo:null;o=null}else u!==o&&(o=null)}}return Ix=o,null}function vC(o){switch(o){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(He()){case at:return 2;case Ie:return 8;case j:case G:return 32;case de:return 268435456;default:return 32}default:return 32}}var zM=!1,Uh=null,Lh=null,Bh=null,vv=new Map,_v=new Map,Oh=[],$I="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function _C(o,u){switch(o){case"focusin":case"focusout":Uh=null;break;case"dragenter":case"dragleave":Lh=null;break;case"mouseover":case"mouseout":Bh=null;break;case"pointerover":case"pointerout":vv.delete(u.pointerId);break;case"gotpointercapture":case"lostpointercapture":_v.delete(u.pointerId)}}function xv(o,u,p,g,b,R){return o===null||o.nativeEvent!==R?(o={blockedOn:u,domEventName:p,eventSystemFlags:g,nativeEvent:R,targetContainers:[b]},u!==null&&(u=$a(u),u!==null&&yC(u)),o):(o.eventSystemFlags|=g,u=o.targetContainers,b!==null&&u.indexOf(b)===-1&&u.push(b),o)}function eF(o,u,p,g,b){switch(u){case"focusin":return Uh=xv(Uh,o,u,p,g,b),!0;case"dragenter":return Lh=xv(Lh,o,u,p,g,b),!0;case"mouseover":return Bh=xv(Bh,o,u,p,g,b),!0;case"pointerover":var R=b.pointerId;return vv.set(R,xv(vv.get(R)||null,o,u,p,g,b)),!0;case"gotpointercapture":return R=b.pointerId,_v.set(R,xv(_v.get(R)||null,o,u,p,g,b)),!0}return!1}function xC(o){var u=Ja(o.target);if(u!==null){var p=s(u);if(p!==null){if(u=p.tag,u===13){if(u=a(p),u!==null){o.blockedOn=u,Mr(o.priority,function(){if(p.tag===13){var g=qi();g=Qn(g);var b=fl(p,g);b!==null&&gr(b,p,g),OM(p,g)}});return}}else if(u===3&&p.stateNode.current.memoizedState.isDehydrated){o.blockedOn=p.tag===3?p.stateNode.containerInfo:null;return}}}o.blockedOn=null}function Fx(o){if(o.blockedOn!==null)return!1;for(var u=o.targetContainers;0<u.length;){var p=IM(o.nativeEvent);if(p===null){p=o.nativeEvent;var g=new p.constructor(p.type,p);Up=g,p.target.dispatchEvent(g),Up=null}else return u=$a(p),u!==null&&yC(u),o.blockedOn=p,!1;u.shift()}return!0}function SC(o,u,p){Fx(o)&&p.delete(u)}function tF(){zM=!1,Uh!==null&&Fx(Uh)&&(Uh=null),Lh!==null&&Fx(Lh)&&(Lh=null),Bh!==null&&Fx(Bh)&&(Bh=null),vv.forEach(SC),_v.forEach(SC)}function zx(o,u){o.blockedOn===u&&(o.blockedOn=null,zM||(zM=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,tF)))}var Vx=null;function bC(o){Vx!==o&&(Vx=o,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){Vx===o&&(Vx=null);for(var u=0;u<o.length;u+=3){var p=o[u],g=o[u+1],b=o[u+2];if(typeof g!="function"){if(FM(g||p)===null)continue;break}var R=$a(p);R!==null&&(o.splice(u,3),u-=3,iv(R,{pending:!0,data:b,method:p.method,action:g},g,b))}}))}function Sv(o){function u($){return zx($,o)}Uh!==null&&zx(Uh,o),Lh!==null&&zx(Lh,o),Bh!==null&&zx(Bh,o),vv.forEach(u),_v.forEach(u);for(var p=0;p<Oh.length;p++){var g=Oh[p];g.blockedOn===o&&(g.blockedOn=null)}for(;0<Oh.length&&(p=Oh[0],p.blockedOn===null);)xC(p),p.blockedOn===null&&Oh.shift();if(p=(o.ownerDocument||o).$$reactFormReplay,p!=null)for(g=0;g<p.length;g+=3){var b=p[g],R=p[g+1],O=b[ps]||null;if(typeof R=="function")O||bC(p);else if(O){var k=null;if(R&&R.hasAttribute("formAction")){if(b=R,O=R[ps]||null)k=O.formAction;else if(FM(b)!==null)continue}else k=O.action;typeof k=="function"?p[g+1]=k:(p.splice(g,3),g-=3),bC(p)}}}function VM(o){this._internalRoot=o}Gx.prototype.render=VM.prototype.render=function(o){var u=this._internalRoot;if(u===null)throw Error(n(409));var p=u.current,g=qi();mC(p,g,o,u,null,null)},Gx.prototype.unmount=VM.prototype.unmount=function(){var o=this._internalRoot;if(o!==null){this._internalRoot=null;var u=o.containerInfo;mC(o.current,2,null,o,null,null),Go(),u[Qs]=null}};function Gx(o){this._internalRoot=o}Gx.prototype.unstable_scheduleHydration=function(o){if(o){var u=Dn();o={blockedOn:null,target:o,priority:u};for(var p=0;p<Oh.length&&u!==0&&u<Oh[p].priority;p++);Oh.splice(p,0,o),p===0&&xC(o)}};var TC=e.version;if(TC!=="19.1.0")throw Error(n(527,TC,"19.1.0"));Q.findDOMNode=function(o){var u=o._reactInternals;if(u===void 0)throw typeof o.render=="function"?Error(n(188)):(o=Object.keys(o).join(","),Error(n(268,o)));return o=c(u),o=o!==null?d(o):null,o=o===null?null:o.stateNode,o};var nF={bundleType:0,version:"19.1.0",rendererPackageName:"react-dom",currentDispatcherRef:V,reconcilerVersion:"19.1.0"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Hx=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Hx.isDisabled&&Hx.supportsFiber)try{Be=Hx.inject(nF),ct=Hx}catch{}}return Tv.createRoot=function(o,u){if(!i(o))throw Error(n(299));var p=!1,g="",b=nd,R=mm,O=bx,k=null;return u!=null&&(u.unstable_strictMode===!0&&(p=!0),u.identifierPrefix!==void 0&&(g=u.identifierPrefix),u.onUncaughtError!==void 0&&(b=u.onUncaughtError),u.onCaughtError!==void 0&&(R=u.onCaughtError),u.onRecoverableError!==void 0&&(O=u.onRecoverableError),u.unstable_transitionCallbacks!==void 0&&(k=u.unstable_transitionCallbacks)),u=dC(o,1,!1,null,null,p,g,b,R,O,k,null),o[Qs]=u.current,bM(o),new VM(u)},Tv.hydrateRoot=function(o,u,p){if(!i(o))throw Error(n(299));var g=!1,b="",R=nd,O=mm,k=bx,$=null,Te=null;return p!=null&&(p.unstable_strictMode===!0&&(g=!0),p.identifierPrefix!==void 0&&(b=p.identifierPrefix),p.onUncaughtError!==void 0&&(R=p.onUncaughtError),p.onCaughtError!==void 0&&(O=p.onCaughtError),p.onRecoverableError!==void 0&&(k=p.onRecoverableError),p.unstable_transitionCallbacks!==void 0&&($=p.unstable_transitionCallbacks),p.formState!==void 0&&(Te=p.formState)),u=dC(o,1,!0,u,p??null,g,b,R,O,k,$,Te),u.context=pC(null),p=u.current,g=qi(),g=Qn(g),b=wo(g),b.callback=null,yl(p,b,g),p=g,u.current.lanes=p,Ke(u,p),Au(u),o[Qs]=u.current,bM(o),new Gx(u)},Tv.version="19.1.0",Tv}var LC;function dF(){if(LC)return kM.exports;LC=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),kM.exports=fF(),kM.exports}var pF=dF();/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const Zg="175",mF={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},gF={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},S1=0,fb=1,b1=2,yF=3,T1=0,F_=1,t_=2,ua=3,pa=0,Ti=1,Fr=2,Ga=0,_o=1,Yd=2,jd=3,Zd=4,Vd=5,_r=100,Fb=101,zb=102,M1=103,E1=104,Cu=200,Vb=201,Gb=202,Hb=203,Sg=204,bg=205,kb=206,qb=207,Wb=208,Xb=209,Yb=210,jD=211,ZD=212,KD=213,QD=214,Tg=0,Mg=1,Eg=2,Pc=3,Ag=4,Rg=5,Ng=6,Cg=7,Kg=0,A1=1,R1=2,Gr=0,N1=1,C1=2,w1=3,jb=4,JD=5,D1=6,U1=7,OA="attached",$D="detached",z_=300,va=301,Wa=302,Pu=303,Iu=304,Ic=306,zl=1e3,da=1001,Fc=1002,Si=1003,V_=1004,vF=1004,Ol=1005,_F=1005,Zn=1006,ef=1007,xF=1007,xr=1008,eU=1008,Xi=1009,tf=1010,nf=1011,jo=1012,Xs=1013,di=1014,Ri=1015,Ys=1016,G_=1017,H_=1018,Ha=1020,k_=35902,Zb=1021,Qg=1022,Ni=1023,Kb=1024,Qb=1025,ka=1026,qa=1027,gp=1028,ff=1029,lf=1030,yp=1031,tU=1032,vp=1033,sf=33776,wc=33777,Dc=33778,Uc=33779,wg=35840,Dg=35841,Ug=35842,Lg=35843,Bg=36196,Kd=37492,Qd=37496,Jd=37808,$d=37809,ep=37810,tp=37811,np=37812,ip=37813,sp=37814,rp=37815,ap=37816,op=37817,lp=37818,up=37819,cp=37820,hp=37821,rf=36492,db=36494,pb=36495,Jb=36283,Og=36284,Pg=36285,Ig=36286,nU=2200,iU=2201,sU=2202,p_=2300,mb=2301,eb=2302,Ld=2400,Bd=2401,m_=2402,$b=2500,L1=2501,SF=0,bF=1,TF=2,rU=3200,aU=3201,MF=3202,EF=3203,Fu=0,B1=1,Ia="",wt="srgb",xo="srgb-linear",g_="linear",$n="srgb",oU=0,Xh=7680,lU=7681,uU=7682,cU=7683,hU=34055,fU=34056,dU=5386,pU=512,mU=513,gU=514,yU=515,vU=516,_U=517,xU=518,gb=519,eT=512,q_=513,tT=514,W_=515,nT=516,iT=517,sT=518,rT=519,Fg=35044,Od=35048,AF=35040,RF=35045,NF=35049,CF=35041,wF=35046,DF=35050,UF=35042,LF="100",PA="300 es",zr=2e3,Vl=2001,BF={COMPUTE:"compute",RENDER:"render"};class bo{addEventListener(e,t){this._listeners===void 0&&(this._listeners={});const n=this._listeners;n[e]===void 0&&(n[e]=[]),n[e].indexOf(t)===-1&&n[e].push(t)}hasEventListener(e,t){const n=this._listeners;return n===void 0?!1:n[e]!==void 0&&n[e].indexOf(t)!==-1}removeEventListener(e,t){const n=this._listeners;if(n===void 0)return;const i=n[e];if(i!==void 0){const s=i.indexOf(t);s!==-1&&i.splice(s,1)}}dispatchEvent(e){const t=this._listeners;if(t===void 0)return;const n=t[e.type];if(n!==void 0){e.target=this;const i=n.slice(0);for(let s=0,a=i.length;s<a;s++)i[s].call(this,e);e.target=null}}}const Or=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];let BC=1234567;const Gd=Math.PI/180,fp=180/Math.PI;function So(){const r=Math.random()*4294967295|0,e=Math.random()*4294967295|0,t=Math.random()*4294967295|0,n=Math.random()*4294967295|0;return(Or[r&255]+Or[r>>8&255]+Or[r>>16&255]+Or[r>>24&255]+"-"+Or[e&255]+Or[e>>8&255]+"-"+Or[e>>16&15|64]+Or[e>>24&255]+"-"+Or[t&63|128]+Or[t>>8&255]+"-"+Or[t>>16&255]+Or[t>>24&255]+Or[n&255]+Or[n>>8&255]+Or[n>>16&255]+Or[n>>24&255]).toLowerCase()}function hn(r,e,t){return Math.max(e,Math.min(t,r))}function O1(r,e){return(r%e+e)%e}function OF(r,e,t,n,i){return n+(r-e)*(i-n)/(t-e)}function PF(r,e,t){return r!==e?(t-r)/(e-r):0}function n_(r,e,t){return(1-t)*r+t*e}function IF(r,e,t,n){return n_(r,e,1-Math.exp(-t*n))}function FF(r,e=1){return e-Math.abs(O1(r,e*2)-e)}function zF(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*(3-2*r))}function VF(r,e,t){return r<=e?0:r>=t?1:(r=(r-e)/(t-e),r*r*r*(r*(r*6-15)+10))}function GF(r,e){return r+Math.floor(Math.random()*(e-r+1))}function HF(r,e){return r+Math.random()*(e-r)}function kF(r){return r*(.5-Math.random())}function qF(r){r!==void 0&&(BC=r);let e=BC+=1831565813;return e=Math.imul(e^e>>>15,e|1),e^=e+Math.imul(e^e>>>7,e|61),((e^e>>>14)>>>0)/4294967296}function WF(r){return r*Gd}function XF(r){return r*fp}function YF(r){return(r&r-1)===0&&r!==0}function jF(r){return Math.pow(2,Math.ceil(Math.log(r)/Math.LN2))}function ZF(r){return Math.pow(2,Math.floor(Math.log(r)/Math.LN2))}function KF(r,e,t,n,i){const s=Math.cos,a=Math.sin,l=s(t/2),c=a(t/2),d=s((e+n)/2),m=a((e+n)/2),y=s((e-n)/2),v=a((e-n)/2),x=s((n-e)/2),S=a((n-e)/2);switch(i){case"XYX":r.set(l*m,c*y,c*v,l*d);break;case"YZY":r.set(c*v,l*m,c*y,l*d);break;case"ZXZ":r.set(c*y,c*v,l*m,l*d);break;case"XZX":r.set(l*m,c*S,c*x,l*d);break;case"YXY":r.set(c*x,l*m,c*S,l*d);break;case"ZYZ":r.set(c*S,c*x,l*m,l*d);break;default:console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order: "+i)}}function ha(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return r/4294967295;case Uint16Array:return r/65535;case Uint8Array:return r/255;case Int32Array:return Math.max(r/2147483647,-1);case Int16Array:return Math.max(r/32767,-1);case Int8Array:return Math.max(r/127,-1);default:throw new Error("Invalid component type.")}}function yn(r,e){switch(e.constructor){case Float32Array:return r;case Uint32Array:return Math.round(r*4294967295);case Uint16Array:return Math.round(r*65535);case Uint8Array:return Math.round(r*255);case Int32Array:return Math.round(r*2147483647);case Int16Array:return Math.round(r*32767);case Int8Array:return Math.round(r*127);default:throw new Error("Invalid component type.")}}const P1={DEG2RAD:Gd,RAD2DEG:fp,generateUUID:So,clamp:hn,euclideanModulo:O1,mapLinear:OF,inverseLerp:PF,lerp:n_,damp:IF,pingpong:FF,smoothstep:zF,smootherstep:VF,randInt:GF,randFloat:HF,randFloatSpread:kF,seededRandom:qF,degToRad:WF,radToDeg:XF,isPowerOfTwo:YF,ceilPowerOfTwo:jF,floorPowerOfTwo:ZF,setQuaternionFromProperEuler:KF,normalize:yn,denormalize:ha};class Xe{constructor(e=0,t=0){Xe.prototype.isVector2=!0,this.x=e,this.y=t}get width(){return this.x}set width(e){this.x=e}get height(){return this.y}set height(e){this.y=e}set(e,t){return this.x=e,this.y=t,this}setScalar(e){return this.x=e,this.y=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y)}copy(e){return this.x=e.x,this.y=e.y,this}add(e){return this.x+=e.x,this.y+=e.y,this}addScalar(e){return this.x+=e,this.y+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this}subScalar(e){return this.x-=e,this.y-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this}multiply(e){return this.x*=e.x,this.y*=e.y,this}multiplyScalar(e){return this.x*=e,this.y*=e,this}divide(e){return this.x/=e.x,this.y/=e.y,this}divideScalar(e){return this.multiplyScalar(1/e)}applyMatrix3(e){const t=this.x,n=this.y,i=e.elements;return this.x=i[0]*t+i[3]*n+i[6],this.y=i[1]*t+i[4]*n+i[7],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this}clamp(e,t){return this.x=hn(this.x,e.x,t.x),this.y=hn(this.y,e.y,t.y),this}clampScalar(e,t){return this.x=hn(this.x,e,t),this.y=hn(this.y,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(hn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(e){return this.x*e.x+this.y*e.y}cross(e){return this.x*e.y-this.y*e.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(hn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y;return t*t+n*n}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this}equals(e){return e.x===this.x&&e.y===this.y}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this}rotateAround(e,t){const n=Math.cos(t),i=Math.sin(t),s=this.x-e.x,a=this.y-e.y;return this.x=s*n-a*i+e.x,this.y=s*i+a*n+e.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class Qt{constructor(e,t,n,i,s,a,l,c,d){Qt.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,a,l,c,d)}set(e,t,n,i,s,a,l,c,d){const m=this.elements;return m[0]=e,m[1]=i,m[2]=l,m[3]=t,m[4]=s,m[5]=c,m[6]=n,m[7]=a,m[8]=d,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],this}extractBasis(e,t,n){return e.setFromMatrix3Column(this,0),t.setFromMatrix3Column(this,1),n.setFromMatrix3Column(this,2),this}setFromMatrix4(e){const t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,a=n[0],l=n[3],c=n[6],d=n[1],m=n[4],y=n[7],v=n[2],x=n[5],S=n[8],A=i[0],E=i[3],M=i[6],C=i[1],w=i[4],D=i[7],z=i[2],B=i[5],F=i[8];return s[0]=a*A+l*C+c*z,s[3]=a*E+l*w+c*B,s[6]=a*M+l*D+c*F,s[1]=d*A+m*C+y*z,s[4]=d*E+m*w+y*B,s[7]=d*M+m*D+y*F,s[2]=v*A+x*C+S*z,s[5]=v*E+x*w+S*B,s[8]=v*M+x*D+S*F,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],l=e[5],c=e[6],d=e[7],m=e[8];return t*a*m-t*l*d-n*s*m+n*l*c+i*s*d-i*a*c}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],l=e[5],c=e[6],d=e[7],m=e[8],y=m*a-l*d,v=l*c-m*s,x=d*s-a*c,S=t*y+n*v+i*x;if(S===0)return this.set(0,0,0,0,0,0,0,0,0);const A=1/S;return e[0]=y*A,e[1]=(i*d-m*n)*A,e[2]=(l*n-i*a)*A,e[3]=v*A,e[4]=(m*t-i*c)*A,e[5]=(i*s-l*t)*A,e[6]=x*A,e[7]=(n*c-d*t)*A,e[8]=(a*t-n*s)*A,this}transpose(){let e;const t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this}getNormalMatrix(e){return this.setFromMatrix4(e).invert().transpose()}transposeIntoArray(e){const t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this}setUvTransform(e,t,n,i,s,a,l){const c=Math.cos(s),d=Math.sin(s);return this.set(n*c,n*d,-n*(c*a+d*l)+a+e,-i*d,i*c,-i*(-d*a+c*l)+l+t,0,0,1),this}scale(e,t){return this.premultiply(YM.makeScale(e,t)),this}rotate(e){return this.premultiply(YM.makeRotation(-e)),this}translate(e,t){return this.premultiply(YM.makeTranslation(e,t)),this}makeTranslation(e,t){return e.isVector2?this.set(1,0,e.x,0,1,e.y,0,0,1):this.set(1,0,e,0,1,t,0,0,1),this}makeRotation(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,n,t,0,0,0,1),this}makeScale(e,t){return this.set(e,0,0,0,t,0,0,0,1),this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<9;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<9;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e}clone(){return new this.constructor().fromArray(this.elements)}}const YM=new Qt;function I1(r){for(let e=r.length-1;e>=0;--e)if(r[e]>=65535)return!0;return!1}const QF={Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function ug(r,e){return new QF[r](e)}function y_(r){return document.createElementNS("http://www.w3.org/1999/xhtml",r)}function F1(){const r=y_("canvas");return r.style.display="block",r}const OC={};function Il(r){r in OC||(OC[r]=!0,console.warn(r))}function JF(r,e,t){return new Promise(function(n,i){function s(){switch(r.clientWaitSync(e,r.SYNC_FLUSH_COMMANDS_BIT,0)){case r.WAIT_FAILED:i();break;case r.TIMEOUT_EXPIRED:setTimeout(s,t);break;default:n()}}setTimeout(s,t)})}function $F(r){const e=r.elements;e[2]=.5*e[2]+.5*e[3],e[6]=.5*e[6]+.5*e[7],e[10]=.5*e[10]+.5*e[11],e[14]=.5*e[14]+.5*e[15]}function ez(r){const e=r.elements;e[11]===-1?(e[10]=-e[10]-1,e[14]=-e[14]):(e[10]=-e[10],e[14]=-e[14]+1)}const PC=new Qt().set(.4123908,.3575843,.1804808,.212639,.7151687,.0721923,.0193308,.1191948,.9505322),IC=new Qt().set(3.2409699,-1.5373832,-.4986108,-.9692436,1.8759675,.0415551,.0556301,-.203977,1.0569715);function tz(){const r={enabled:!0,workingColorSpace:xo,spaces:{},convert:function(i,s,a){return this.enabled===!1||s===a||!s||!a||(this.spaces[s].transfer===$n&&(i.r=Lc(i.r),i.g=Lc(i.g),i.b=Lc(i.b)),this.spaces[s].primaries!==this.spaces[a].primaries&&(i.applyMatrix3(this.spaces[s].toXYZ),i.applyMatrix3(this.spaces[a].fromXYZ)),this.spaces[a].transfer===$n&&(i.r=gg(i.r),i.g=gg(i.g),i.b=gg(i.b))),i},fromWorkingColorSpace:function(i,s){return this.convert(i,this.workingColorSpace,s)},toWorkingColorSpace:function(i,s){return this.convert(i,s,this.workingColorSpace)},getPrimaries:function(i){return this.spaces[i].primaries},getTransfer:function(i){return i===Ia?g_:this.spaces[i].transfer},getLuminanceCoefficients:function(i,s=this.workingColorSpace){return i.fromArray(this.spaces[s].luminanceCoefficients)},define:function(i){Object.assign(this.spaces,i)},_getMatrix:function(i,s,a){return i.copy(this.spaces[s].toXYZ).multiply(this.spaces[a].fromXYZ)},_getDrawingBufferColorSpace:function(i){return this.spaces[i].outputColorSpaceConfig.drawingBufferColorSpace},_getUnpackColorSpace:function(i=this.workingColorSpace){return this.spaces[i].workingColorSpaceConfig.unpackColorSpace}},e=[.64,.33,.3,.6,.15,.06],t=[.2126,.7152,.0722],n=[.3127,.329];return r.define({[xo]:{primaries:e,whitePoint:n,transfer:g_,toXYZ:PC,fromXYZ:IC,luminanceCoefficients:t,workingColorSpaceConfig:{unpackColorSpace:wt},outputColorSpaceConfig:{drawingBufferColorSpace:wt}},[wt]:{primaries:e,whitePoint:n,transfer:$n,toXYZ:PC,fromXYZ:IC,luminanceCoefficients:t,outputColorSpaceConfig:{drawingBufferColorSpace:wt}}}),r}const on=tz();function Lc(r){return r<.04045?r*.0773993808:Math.pow(r*.9478672986+.0521327014,2.4)}function gg(r){return r<.0031308?r*12.92:1.055*Math.pow(r,.41666)-.055}let Um;class SU{static getDataURL(e,t="image/png"){if(/^data:/i.test(e.src)||typeof HTMLCanvasElement>"u")return e.src;let n;if(e instanceof HTMLCanvasElement)n=e;else{Um===void 0&&(Um=y_("canvas")),Um.width=e.width,Um.height=e.height;const i=Um.getContext("2d");e instanceof ImageData?i.putImageData(e,0,0):i.drawImage(e,0,0,e.width,e.height),n=Um}return n.toDataURL(t)}static sRGBToLinear(e){if(typeof HTMLImageElement<"u"&&e instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&e instanceof ImageBitmap){const t=y_("canvas");t.width=e.width,t.height=e.height;const n=t.getContext("2d");n.drawImage(e,0,0,e.width,e.height);const i=n.getImageData(0,0,e.width,e.height),s=i.data;for(let a=0;a<s.length;a++)s[a]=Lc(s[a]/255)*255;return n.putImageData(i,0,0),t}else if(e.data){const t=e.data.slice(0);for(let n=0;n<t.length;n++)t instanceof Uint8Array||t instanceof Uint8ClampedArray?t[n]=Math.floor(Lc(t[n]/255)*255):t[n]=Lc(t[n]);return{data:t,width:e.width,height:e.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),e}}let nz=0;class Jh{constructor(e=null){this.isSource=!0,Object.defineProperty(this,"id",{value:nz++}),this.uuid=So(),this.data=e,this.dataReady=!0,this.version=0}set needsUpdate(e){e===!0&&this.version++}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.images[this.uuid]!==void 0)return e.images[this.uuid];const n={uuid:this.uuid,url:""},i=this.data;if(i!==null){let s;if(Array.isArray(i)){s=[];for(let a=0,l=i.length;a<l;a++)i[a].isDataTexture?s.push(jM(i[a].image)):s.push(jM(i[a]))}else s=jM(i);n.url=s}return t||(e.images[this.uuid]=n),n}}function jM(r){return typeof HTMLImageElement<"u"&&r instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&r instanceof ImageBitmap?SU.getDataURL(r):r.data?{data:Array.from(r.data),width:r.width,height:r.height,type:r.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let iz=0;class Li extends bo{constructor(e=Li.DEFAULT_IMAGE,t=Li.DEFAULT_MAPPING,n=da,i=da,s=Zn,a=xr,l=Ni,c=Xi,d=Li.DEFAULT_ANISOTROPY,m=Ia){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:iz++}),this.uuid=So(),this.name="",this.source=new Jh(e),this.mipmaps=[],this.mapping=t,this.channel=0,this.wrapS=n,this.wrapT=i,this.magFilter=s,this.minFilter=a,this.anisotropy=d,this.format=l,this.internalFormat=null,this.type=c,this.offset=new Xe(0,0),this.repeat=new Xe(1,1),this.center=new Xe(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Qt,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=m,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(e=null){this.source.data=e}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(e){return this.name=e.name,this.source=e.source,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.channel=e.channel,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.colorSpace=e.colorSpace,this.renderTarget=e.renderTarget,this.isRenderTargetTexture=e.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(e.userData)),this.needsUpdate=!0,this}toJSON(e){const t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];const n={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(e).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(n.userData=this.userData),t||(e.textures[this.uuid]=n),n}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(e){if(this.mapping!==z_)return e;if(e.applyMatrix3(this.matrix),e.x<0||e.x>1)switch(this.wrapS){case zl:e.x=e.x-Math.floor(e.x);break;case da:e.x=e.x<0?0:1;break;case Fc:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x);break}if(e.y<0||e.y>1)switch(this.wrapT){case zl:e.y=e.y-Math.floor(e.y);break;case da:e.y=e.y<0?0:1;break;case Fc:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y);break}return this.flipY&&(e.y=1-e.y),e}set needsUpdate(e){e===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(e){e===!0&&this.pmremVersion++}}Li.DEFAULT_IMAGE=null;Li.DEFAULT_MAPPING=z_;Li.DEFAULT_ANISOTROPY=1;class Ot{constructor(e=0,t=0,n=0,i=1){Ot.prototype.isVector4=!0,this.x=e,this.y=t,this.z=n,this.w=i}get width(){return this.z}set width(e){this.z=e}get height(){return this.w}set height(e){this.w=e}set(e,t,n,i){return this.x=e,this.y=t,this.z=n,this.w=i,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this.w=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setW(e){return this.w=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z,this.w)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this.w*=e.w,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=this.w,a=e.elements;return this.x=a[0]*t+a[4]*n+a[8]*i+a[12]*s,this.y=a[1]*t+a[5]*n+a[9]*i+a[13]*s,this.z=a[2]*t+a[6]*n+a[10]*i+a[14]*s,this.w=a[3]*t+a[7]*n+a[11]*i+a[15]*s,this}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this.w/=e.w,this}divideScalar(e){return this.multiplyScalar(1/e)}setAxisAngleFromQuaternion(e){this.w=2*Math.acos(e.w);const t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this}setAxisAngleFromRotationMatrix(e){let t,n,i,s;const c=e.elements,d=c[0],m=c[4],y=c[8],v=c[1],x=c[5],S=c[9],A=c[2],E=c[6],M=c[10];if(Math.abs(m-v)<.01&&Math.abs(y-A)<.01&&Math.abs(S-E)<.01){if(Math.abs(m+v)<.1&&Math.abs(y+A)<.1&&Math.abs(S+E)<.1&&Math.abs(d+x+M-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;const w=(d+1)/2,D=(x+1)/2,z=(M+1)/2,B=(m+v)/4,F=(y+A)/4,H=(S+E)/4;return w>D&&w>z?w<.01?(n=0,i=.707106781,s=.707106781):(n=Math.sqrt(w),i=B/n,s=F/n):D>z?D<.01?(n=.707106781,i=0,s=.707106781):(i=Math.sqrt(D),n=B/i,s=H/i):z<.01?(n=.707106781,i=.707106781,s=0):(s=Math.sqrt(z),n=F/s,i=H/s),this.set(n,i,s,t),this}let C=Math.sqrt((E-S)*(E-S)+(y-A)*(y-A)+(v-m)*(v-m));return Math.abs(C)<.001&&(C=1),this.x=(E-S)/C,this.y=(y-A)/C,this.z=(v-m)/C,this.w=Math.acos((d+x+M-1)/2),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this.w=t[15],this}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this}clamp(e,t){return this.x=hn(this.x,e.x,t.x),this.y=hn(this.y,e.y,t.y),this.z=hn(this.z,e.z,t.z),this.w=hn(this.w,e.w,t.w),this}clampScalar(e,t){return this.x=hn(this.x,e,t),this.y=hn(this.y,e,t),this.z=hn(this.z,e,t),this.w=hn(this.w,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(hn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this.w=Math.trunc(this.w),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this.w=e.w+(t.w-e.w)*n,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this.w=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z,yield this.w}}class tl extends bo{constructor(e=1,t=1,n={}){super(),this.isRenderTarget=!0,this.width=e,this.height=t,this.depth=1,this.scissor=new Ot(0,0,e,t),this.scissorTest=!1,this.viewport=new Ot(0,0,e,t);const i={width:e,height:t,depth:1};n=Object.assign({generateMipmaps:!1,internalFormat:null,minFilter:Zn,depthBuffer:!0,stencilBuffer:!1,resolveDepthBuffer:!0,resolveStencilBuffer:!0,depthTexture:null,samples:0,count:1},n);const s=new Li(i,n.mapping,n.wrapS,n.wrapT,n.magFilter,n.minFilter,n.format,n.type,n.anisotropy,n.colorSpace);s.flipY=!1,s.generateMipmaps=n.generateMipmaps,s.internalFormat=n.internalFormat,this.textures=[];const a=n.count;for(let l=0;l<a;l++)this.textures[l]=s.clone(),this.textures[l].isRenderTargetTexture=!0,this.textures[l].renderTarget=this;this.depthBuffer=n.depthBuffer,this.stencilBuffer=n.stencilBuffer,this.resolveDepthBuffer=n.resolveDepthBuffer,this.resolveStencilBuffer=n.resolveStencilBuffer,this._depthTexture=n.depthTexture,this.samples=n.samples}get texture(){return this.textures[0]}set texture(e){this.textures[0]=e}set depthTexture(e){this._depthTexture!==null&&(this._depthTexture.renderTarget=null),e!==null&&(e.renderTarget=this),this._depthTexture=e}get depthTexture(){return this._depthTexture}setSize(e,t,n=1){if(this.width!==e||this.height!==t||this.depth!==n){this.width=e,this.height=t,this.depth=n;for(let i=0,s=this.textures.length;i<s;i++)this.textures[i].image.width=e,this.textures[i].image.height=t,this.textures[i].image.depth=n;this.dispose()}this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)}clone(){return new this.constructor().copy(this)}copy(e){this.width=e.width,this.height=e.height,this.depth=e.depth,this.scissor.copy(e.scissor),this.scissorTest=e.scissorTest,this.viewport.copy(e.viewport),this.textures.length=0;for(let t=0,n=e.textures.length;t<n;t++){this.textures[t]=e.textures[t].clone(),this.textures[t].isRenderTargetTexture=!0,this.textures[t].renderTarget=this;const i=Object.assign({},e.textures[t].image);this.textures[t].source=new Jh(i)}return this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.resolveDepthBuffer=e.resolveDepthBuffer,this.resolveStencilBuffer=e.resolveStencilBuffer,e.depthTexture!==null&&(this.depthTexture=e.depthTexture.clone()),this.samples=e.samples,this}dispose(){this.dispatchEvent({type:"dispose"})}}class Gl extends tl{constructor(e=1,t=1,n={}){super(e,t,n),this.isWebGLRenderTarget=!0}}class Jg extends Li{constructor(e=null,t=1,n=1,i=1){super(null),this.isDataArrayTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Si,this.minFilter=Si,this.wrapR=da,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class sz extends Gl{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGLArrayRenderTarget=!0,this.depth=n,this.texture=new Jg(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class aT extends Li{constructor(e=null,t=1,n=1,i=1){super(null),this.isData3DTexture=!0,this.image={data:e,width:t,height:n,depth:i},this.magFilter=Si,this.minFilter=Si,this.wrapR=da,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}class rz extends Gl{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isWebGL3DRenderTarget=!0,this.depth=n,this.texture=new aT(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class ma{constructor(e=0,t=0,n=0,i=1){this.isQuaternion=!0,this._x=e,this._y=t,this._z=n,this._w=i}static slerpFlat(e,t,n,i,s,a,l){let c=n[i+0],d=n[i+1],m=n[i+2],y=n[i+3];const v=s[a+0],x=s[a+1],S=s[a+2],A=s[a+3];if(l===0){e[t+0]=c,e[t+1]=d,e[t+2]=m,e[t+3]=y;return}if(l===1){e[t+0]=v,e[t+1]=x,e[t+2]=S,e[t+3]=A;return}if(y!==A||c!==v||d!==x||m!==S){let E=1-l;const M=c*v+d*x+m*S+y*A,C=M>=0?1:-1,w=1-M*M;if(w>Number.EPSILON){const z=Math.sqrt(w),B=Math.atan2(z,M*C);E=Math.sin(E*B)/z,l=Math.sin(l*B)/z}const D=l*C;if(c=c*E+v*D,d=d*E+x*D,m=m*E+S*D,y=y*E+A*D,E===1-l){const z=1/Math.sqrt(c*c+d*d+m*m+y*y);c*=z,d*=z,m*=z,y*=z}}e[t]=c,e[t+1]=d,e[t+2]=m,e[t+3]=y}static multiplyQuaternionsFlat(e,t,n,i,s,a){const l=n[i],c=n[i+1],d=n[i+2],m=n[i+3],y=s[a],v=s[a+1],x=s[a+2],S=s[a+3];return e[t]=l*S+m*y+c*x-d*v,e[t+1]=c*S+m*v+d*y-l*x,e[t+2]=d*S+m*x+l*v-c*y,e[t+3]=m*S-l*y-c*v-d*x,e}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get w(){return this._w}set w(e){this._w=e,this._onChangeCallback()}set(e,t,n,i){return this._x=e,this._y=t,this._z=n,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this}setFromEuler(e,t=!0){const n=e._x,i=e._y,s=e._z,a=e._order,l=Math.cos,c=Math.sin,d=l(n/2),m=l(i/2),y=l(s/2),v=c(n/2),x=c(i/2),S=c(s/2);switch(a){case"XYZ":this._x=v*m*y+d*x*S,this._y=d*x*y-v*m*S,this._z=d*m*S+v*x*y,this._w=d*m*y-v*x*S;break;case"YXZ":this._x=v*m*y+d*x*S,this._y=d*x*y-v*m*S,this._z=d*m*S-v*x*y,this._w=d*m*y+v*x*S;break;case"ZXY":this._x=v*m*y-d*x*S,this._y=d*x*y+v*m*S,this._z=d*m*S+v*x*y,this._w=d*m*y-v*x*S;break;case"ZYX":this._x=v*m*y-d*x*S,this._y=d*x*y+v*m*S,this._z=d*m*S-v*x*y,this._w=d*m*y+v*x*S;break;case"YZX":this._x=v*m*y+d*x*S,this._y=d*x*y+v*m*S,this._z=d*m*S-v*x*y,this._w=d*m*y-v*x*S;break;case"XZY":this._x=v*m*y-d*x*S,this._y=d*x*y-v*m*S,this._z=d*m*S+v*x*y,this._w=d*m*y+v*x*S;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+a)}return t===!0&&this._onChangeCallback(),this}setFromAxisAngle(e,t){const n=t/2,i=Math.sin(n);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(n),this._onChangeCallback(),this}setFromRotationMatrix(e){const t=e.elements,n=t[0],i=t[4],s=t[8],a=t[1],l=t[5],c=t[9],d=t[2],m=t[6],y=t[10],v=n+l+y;if(v>0){const x=.5/Math.sqrt(v+1);this._w=.25/x,this._x=(m-c)*x,this._y=(s-d)*x,this._z=(a-i)*x}else if(n>l&&n>y){const x=2*Math.sqrt(1+n-l-y);this._w=(m-c)/x,this._x=.25*x,this._y=(i+a)/x,this._z=(s+d)/x}else if(l>y){const x=2*Math.sqrt(1+l-n-y);this._w=(s-d)/x,this._x=(i+a)/x,this._y=.25*x,this._z=(c+m)/x}else{const x=2*Math.sqrt(1+y-n-l);this._w=(a-i)/x,this._x=(s+d)/x,this._y=(c+m)/x,this._z=.25*x}return this._onChangeCallback(),this}setFromUnitVectors(e,t){let n=e.dot(t)+1;return n<Number.EPSILON?(n=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0,this._w=n):(this._x=0,this._y=-e.z,this._z=e.y,this._w=n)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x,this._w=n),this.normalize()}angleTo(e){return 2*Math.acos(Math.abs(hn(this.dot(e),-1,1)))}rotateTowards(e,t){const n=this.angleTo(e);if(n===0)return this;const i=Math.min(1,t/n);return this.slerp(e,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this}multiply(e){return this.multiplyQuaternions(this,e)}premultiply(e){return this.multiplyQuaternions(e,this)}multiplyQuaternions(e,t){const n=e._x,i=e._y,s=e._z,a=e._w,l=t._x,c=t._y,d=t._z,m=t._w;return this._x=n*m+a*l+i*d-s*c,this._y=i*m+a*c+s*l-n*d,this._z=s*m+a*d+n*c-i*l,this._w=a*m-n*l-i*c-s*d,this._onChangeCallback(),this}slerp(e,t){if(t===0)return this;if(t===1)return this.copy(e);const n=this._x,i=this._y,s=this._z,a=this._w;let l=a*e._w+n*e._x+i*e._y+s*e._z;if(l<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,l=-l):this.copy(e),l>=1)return this._w=a,this._x=n,this._y=i,this._z=s,this;const c=1-l*l;if(c<=Number.EPSILON){const x=1-t;return this._w=x*a+t*this._w,this._x=x*n+t*this._x,this._y=x*i+t*this._y,this._z=x*s+t*this._z,this.normalize(),this}const d=Math.sqrt(c),m=Math.atan2(d,l),y=Math.sin((1-t)*m)/d,v=Math.sin(t*m)/d;return this._w=a*y+this._w*v,this._x=n*y+this._x*v,this._y=i*y+this._y*v,this._z=s*y+this._z*v,this._onChangeCallback(),this}slerpQuaternions(e,t,n){return this.copy(e).slerp(t,n)}random(){const e=2*Math.PI*Math.random(),t=2*Math.PI*Math.random(),n=Math.random(),i=Math.sqrt(1-n),s=Math.sqrt(n);return this.set(i*Math.sin(e),i*Math.cos(e),s*Math.sin(t),s*Math.cos(t))}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w}fromArray(e,t=0){return this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e}fromBufferAttribute(e,t){return this._x=e.getX(t),this._y=e.getY(t),this._z=e.getZ(t),this._w=e.getW(t),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class Y{constructor(e=0,t=0,n=0){Y.prototype.isVector3=!0,this.x=e,this.y=t,this.z=n}set(e,t,n){return n===void 0&&(n=this.z),this.x=e,this.y=t,this.z=n,this}setScalar(e){return this.x=e,this.y=e,this.z=e,this}setX(e){return this.x=e,this}setY(e){return this.y=e,this}setZ(e){return this.z=e,this}setComponent(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this}getComponent(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(e){return this.x=e.x,this.y=e.y,this.z=e.z,this}add(e){return this.x+=e.x,this.y+=e.y,this.z+=e.z,this}addScalar(e){return this.x+=e,this.y+=e,this.z+=e,this}addVectors(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this}addScaledVector(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this}sub(e){return this.x-=e.x,this.y-=e.y,this.z-=e.z,this}subScalar(e){return this.x-=e,this.y-=e,this.z-=e,this}subVectors(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this}multiply(e){return this.x*=e.x,this.y*=e.y,this.z*=e.z,this}multiplyScalar(e){return this.x*=e,this.y*=e,this.z*=e,this}multiplyVectors(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this}applyEuler(e){return this.applyQuaternion(FC.setFromEuler(e))}applyAxisAngle(e,t){return this.applyQuaternion(FC.setFromAxisAngle(e,t))}applyMatrix3(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[3]*n+s[6]*i,this.y=s[1]*t+s[4]*n+s[7]*i,this.z=s[2]*t+s[5]*n+s[8]*i,this}applyNormalMatrix(e){return this.applyMatrix3(e).normalize()}applyMatrix4(e){const t=this.x,n=this.y,i=this.z,s=e.elements,a=1/(s[3]*t+s[7]*n+s[11]*i+s[15]);return this.x=(s[0]*t+s[4]*n+s[8]*i+s[12])*a,this.y=(s[1]*t+s[5]*n+s[9]*i+s[13])*a,this.z=(s[2]*t+s[6]*n+s[10]*i+s[14])*a,this}applyQuaternion(e){const t=this.x,n=this.y,i=this.z,s=e.x,a=e.y,l=e.z,c=e.w,d=2*(a*i-l*n),m=2*(l*t-s*i),y=2*(s*n-a*t);return this.x=t+c*d+a*y-l*m,this.y=n+c*m+l*d-s*y,this.z=i+c*y+s*m-a*d,this}project(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)}unproject(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)}transformDirection(e){const t=this.x,n=this.y,i=this.z,s=e.elements;return this.x=s[0]*t+s[4]*n+s[8]*i,this.y=s[1]*t+s[5]*n+s[9]*i,this.z=s[2]*t+s[6]*n+s[10]*i,this.normalize()}divide(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this}divideScalar(e){return this.multiplyScalar(1/e)}min(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this}max(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this}clamp(e,t){return this.x=hn(this.x,e.x,t.x),this.y=hn(this.y,e.y,t.y),this.z=hn(this.z,e.z,t.z),this}clampScalar(e,t){return this.x=hn(this.x,e,t),this.y=hn(this.y,e,t),this.z=hn(this.z,e,t),this}clampLength(e,t){const n=this.length();return this.divideScalar(n||1).multiplyScalar(hn(n,e,t))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(e){return this.x*e.x+this.y*e.y+this.z*e.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(e){return this.normalize().multiplyScalar(e)}lerp(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this}lerpVectors(e,t,n){return this.x=e.x+(t.x-e.x)*n,this.y=e.y+(t.y-e.y)*n,this.z=e.z+(t.z-e.z)*n,this}cross(e){return this.crossVectors(this,e)}crossVectors(e,t){const n=e.x,i=e.y,s=e.z,a=t.x,l=t.y,c=t.z;return this.x=i*c-s*l,this.y=s*a-n*c,this.z=n*l-i*a,this}projectOnVector(e){const t=e.lengthSq();if(t===0)return this.set(0,0,0);const n=e.dot(this)/t;return this.copy(e).multiplyScalar(n)}projectOnPlane(e){return ZM.copy(this).projectOnVector(e),this.sub(ZM)}reflect(e){return this.sub(ZM.copy(e).multiplyScalar(2*this.dot(e)))}angleTo(e){const t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;const n=this.dot(e)/t;return Math.acos(hn(n,-1,1))}distanceTo(e){return Math.sqrt(this.distanceToSquared(e))}distanceToSquared(e){const t=this.x-e.x,n=this.y-e.y,i=this.z-e.z;return t*t+n*n+i*i}manhattanDistanceTo(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)}setFromSpherical(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)}setFromSphericalCoords(e,t,n){const i=Math.sin(t)*e;return this.x=i*Math.sin(n),this.y=Math.cos(t)*e,this.z=i*Math.cos(n),this}setFromCylindrical(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)}setFromCylindricalCoords(e,t,n){return this.x=e*Math.sin(t),this.y=n,this.z=e*Math.cos(t),this}setFromMatrixPosition(e){const t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this}setFromMatrixScale(e){const t=this.setFromMatrixColumn(e,0).length(),n=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=n,this.z=i,this}setFromMatrixColumn(e,t){return this.fromArray(e.elements,t*4)}setFromMatrix3Column(e,t){return this.fromArray(e.elements,t*3)}setFromEuler(e){return this.x=e._x,this.y=e._y,this.z=e._z,this}setFromColor(e){return this.x=e.r,this.y=e.g,this.z=e.b,this}equals(e){return e.x===this.x&&e.y===this.y&&e.z===this.z}fromArray(e,t=0){return this.x=e[t],this.y=e[t+1],this.z=e[t+2],this}toArray(e=[],t=0){return e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e}fromBufferAttribute(e,t){return this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const e=Math.random()*Math.PI*2,t=Math.random()*2-1,n=Math.sqrt(1-t*t);return this.x=n*Math.cos(e),this.y=t,this.z=n*Math.sin(e),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const ZM=new Y,FC=new ma;class ga{constructor(e=new Y(1/0,1/0,1/0),t=new Y(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromArray(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t+=3)this.expandByPoint(Nl.fromArray(e,t));return this}setFromBufferAttribute(e){this.makeEmpty();for(let t=0,n=e.count;t<n;t++)this.expandByPoint(Nl.fromBufferAttribute(e,t));return this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Nl.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}setFromObject(e,t=!1){return this.makeEmpty(),this.expandByObject(e,t)}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(e){return this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}expandByObject(e,t=!1){e.updateWorldMatrix(!1,!1);const n=e.geometry;if(n!==void 0){const s=n.getAttribute("position");if(t===!0&&s!==void 0&&e.isInstancedMesh!==!0)for(let a=0,l=s.count;a<l;a++)e.isMesh===!0?e.getVertexPosition(a,Nl):Nl.fromBufferAttribute(s,a),Nl.applyMatrix4(e.matrixWorld),this.expandByPoint(Nl);else e.boundingBox!==void 0?(e.boundingBox===null&&e.computeBoundingBox(),kx.copy(e.boundingBox)):(n.boundingBox===null&&n.computeBoundingBox(),kx.copy(n.boundingBox)),kx.applyMatrix4(e.matrixWorld),this.union(kx)}const i=e.children;for(let s=0,a=i.length;s<a;s++)this.expandByObject(i[s],t);return this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y&&e.z>=this.min.z&&e.z<=this.max.z}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y&&e.max.z>=this.min.z&&e.min.z<=this.max.z}intersectsSphere(e){return this.clampPoint(e.center,Nl),Nl.distanceToSquared(e.center)<=e.radius*e.radius}intersectsPlane(e){let t,n;return e.normal.x>0?(t=e.normal.x*this.min.x,n=e.normal.x*this.max.x):(t=e.normal.x*this.max.x,n=e.normal.x*this.min.x),e.normal.y>0?(t+=e.normal.y*this.min.y,n+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,n+=e.normal.y*this.min.y),e.normal.z>0?(t+=e.normal.z*this.min.z,n+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,n+=e.normal.z*this.min.z),t<=-e.constant&&n>=-e.constant}intersectsTriangle(e){if(this.isEmpty())return!1;this.getCenter(Mv),qx.subVectors(this.max,Mv),Lm.subVectors(e.a,Mv),Bm.subVectors(e.b,Mv),Om.subVectors(e.c,Mv),Ih.subVectors(Bm,Lm),Fh.subVectors(Om,Bm),cd.subVectors(Lm,Om);let t=[0,-Ih.z,Ih.y,0,-Fh.z,Fh.y,0,-cd.z,cd.y,Ih.z,0,-Ih.x,Fh.z,0,-Fh.x,cd.z,0,-cd.x,-Ih.y,Ih.x,0,-Fh.y,Fh.x,0,-cd.y,cd.x,0];return!KM(t,Lm,Bm,Om,qx)||(t=[1,0,0,0,1,0,0,0,1],!KM(t,Lm,Bm,Om,qx))?!1:(Wx.crossVectors(Ih,Fh),t=[Wx.x,Wx.y,Wx.z],KM(t,Lm,Bm,Om,qx))}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Nl).distanceTo(e)}getBoundingSphere(e){return this.isEmpty()?e.makeEmpty():(this.getCenter(e.center),e.radius=this.getSize(Nl).length()*.5),e}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}applyMatrix4(e){return this.isEmpty()?this:(vc[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),vc[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),vc[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),vc[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),vc[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),vc[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),vc[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),vc[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(vc),this)}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const vc=[new Y,new Y,new Y,new Y,new Y,new Y,new Y,new Y],Nl=new Y,kx=new ga,Lm=new Y,Bm=new Y,Om=new Y,Ih=new Y,Fh=new Y,cd=new Y,Mv=new Y,qx=new Y,Wx=new Y,hd=new Y;function KM(r,e,t,n,i){for(let s=0,a=r.length-3;s<=a;s+=3){hd.fromArray(r,s);const l=i.x*Math.abs(hd.x)+i.y*Math.abs(hd.y)+i.z*Math.abs(hd.z),c=e.dot(hd),d=t.dot(hd),m=n.dot(hd);if(Math.max(-Math.max(c,d,m),Math.min(c,d,m))>l)return!1}return!0}const az=new ga,Ev=new Y,QM=new Y;class br{constructor(e=new Y,t=-1){this.isSphere=!0,this.center=e,this.radius=t}set(e,t){return this.center.copy(e),this.radius=t,this}setFromPoints(e,t){const n=this.center;t!==void 0?n.copy(t):az.setFromPoints(e).getCenter(n);let i=0;for(let s=0,a=e.length;s<a;s++)i=Math.max(i,n.distanceToSquared(e[s]));return this.radius=Math.sqrt(i),this}copy(e){return this.center.copy(e.center),this.radius=e.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(e){return e.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(e){return e.distanceTo(this.center)-this.radius}intersectsSphere(e){const t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t}intersectsBox(e){return e.intersectsSphere(this)}intersectsPlane(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius}clampPoint(e,t){const n=this.center.distanceToSquared(e);return t.copy(e),n>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t}getBoundingBox(e){return this.isEmpty()?(e.makeEmpty(),e):(e.set(this.center,this.center),e.expandByScalar(this.radius),e)}applyMatrix4(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this}translate(e){return this.center.add(e),this}expandByPoint(e){if(this.isEmpty())return this.center.copy(e),this.radius=0,this;Ev.subVectors(e,this.center);const t=Ev.lengthSq();if(t>this.radius*this.radius){const n=Math.sqrt(t),i=(n-this.radius)*.5;this.center.addScaledVector(Ev,i/n),this.radius+=i}return this}union(e){return e.isEmpty()?this:this.isEmpty()?(this.copy(e),this):(this.center.equals(e.center)===!0?this.radius=Math.max(this.radius,e.radius):(QM.subVectors(e.center,this.center).setLength(e.radius),this.expandByPoint(Ev.copy(e.center).add(QM)),this.expandByPoint(Ev.copy(e.center).sub(QM))),this)}equals(e){return e.center.equals(this.center)&&e.radius===this.radius}clone(){return new this.constructor().copy(this)}}const _c=new Y,JM=new Y,Xx=new Y,zh=new Y,$M=new Y,Yx=new Y,eE=new Y;class $g{constructor(e=new Y,t=new Y(0,0,-1)){this.origin=e,this.direction=t}set(e,t){return this.origin.copy(e),this.direction.copy(t),this}copy(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this}at(e,t){return t.copy(this.origin).addScaledVector(this.direction,e)}lookAt(e){return this.direction.copy(e).sub(this.origin).normalize(),this}recast(e){return this.origin.copy(this.at(e,_c)),this}closestPointToPoint(e,t){t.subVectors(e,this.origin);const n=t.dot(this.direction);return n<0?t.copy(this.origin):t.copy(this.origin).addScaledVector(this.direction,n)}distanceToPoint(e){return Math.sqrt(this.distanceSqToPoint(e))}distanceSqToPoint(e){const t=_c.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):(_c.copy(this.origin).addScaledVector(this.direction,t),_c.distanceToSquared(e))}distanceSqToSegment(e,t,n,i){JM.copy(e).add(t).multiplyScalar(.5),Xx.copy(t).sub(e).normalize(),zh.copy(this.origin).sub(JM);const s=e.distanceTo(t)*.5,a=-this.direction.dot(Xx),l=zh.dot(this.direction),c=-zh.dot(Xx),d=zh.lengthSq(),m=Math.abs(1-a*a);let y,v,x,S;if(m>0)if(y=a*c-l,v=a*l-c,S=s*m,y>=0)if(v>=-S)if(v<=S){const A=1/m;y*=A,v*=A,x=y*(y+a*v+2*l)+v*(a*y+v+2*c)+d}else v=s,y=Math.max(0,-(a*v+l)),x=-y*y+v*(v+2*c)+d;else v=-s,y=Math.max(0,-(a*v+l)),x=-y*y+v*(v+2*c)+d;else v<=-S?(y=Math.max(0,-(-a*s+l)),v=y>0?-s:Math.min(Math.max(-s,-c),s),x=-y*y+v*(v+2*c)+d):v<=S?(y=0,v=Math.min(Math.max(-s,-c),s),x=v*(v+2*c)+d):(y=Math.max(0,-(a*s+l)),v=y>0?s:Math.min(Math.max(-s,-c),s),x=-y*y+v*(v+2*c)+d);else v=a>0?-s:s,y=Math.max(0,-(a*v+l)),x=-y*y+v*(v+2*c)+d;return n&&n.copy(this.origin).addScaledVector(this.direction,y),i&&i.copy(JM).addScaledVector(Xx,v),x}intersectSphere(e,t){_c.subVectors(e.center,this.origin);const n=_c.dot(this.direction),i=_c.dot(_c)-n*n,s=e.radius*e.radius;if(i>s)return null;const a=Math.sqrt(s-i),l=n-a,c=n+a;return c<0?null:l<0?this.at(c,t):this.at(l,t)}intersectsSphere(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius}distanceToPlane(e){const t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;const n=-(this.origin.dot(e.normal)+e.constant)/t;return n>=0?n:null}intersectPlane(e,t){const n=this.distanceToPlane(e);return n===null?null:this.at(n,t)}intersectsPlane(e){const t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0}intersectBox(e,t){let n,i,s,a,l,c;const d=1/this.direction.x,m=1/this.direction.y,y=1/this.direction.z,v=this.origin;return d>=0?(n=(e.min.x-v.x)*d,i=(e.max.x-v.x)*d):(n=(e.max.x-v.x)*d,i=(e.min.x-v.x)*d),m>=0?(s=(e.min.y-v.y)*m,a=(e.max.y-v.y)*m):(s=(e.max.y-v.y)*m,a=(e.min.y-v.y)*m),n>a||s>i||((s>n||isNaN(n))&&(n=s),(a<i||isNaN(i))&&(i=a),y>=0?(l=(e.min.z-v.z)*y,c=(e.max.z-v.z)*y):(l=(e.max.z-v.z)*y,c=(e.min.z-v.z)*y),n>c||l>i)||((l>n||n!==n)&&(n=l),(c<i||i!==i)&&(i=c),i<0)?null:this.at(n>=0?n:i,t)}intersectsBox(e){return this.intersectBox(e,_c)!==null}intersectTriangle(e,t,n,i,s){$M.subVectors(t,e),Yx.subVectors(n,e),eE.crossVectors($M,Yx);let a=this.direction.dot(eE),l;if(a>0){if(i)return null;l=1}else if(a<0)l=-1,a=-a;else return null;zh.subVectors(this.origin,e);const c=l*this.direction.dot(Yx.crossVectors(zh,Yx));if(c<0)return null;const d=l*this.direction.dot($M.cross(zh));if(d<0||c+d>a)return null;const m=-l*zh.dot(eE);return m<0?null:this.at(m/a,s)}applyMatrix4(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this}equals(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}clone(){return new this.constructor().copy(this)}}class Mt{constructor(e,t,n,i,s,a,l,c,d,m,y,v,x,S,A,E){Mt.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],e!==void 0&&this.set(e,t,n,i,s,a,l,c,d,m,y,v,x,S,A,E)}set(e,t,n,i,s,a,l,c,d,m,y,v,x,S,A,E){const M=this.elements;return M[0]=e,M[4]=t,M[8]=n,M[12]=i,M[1]=s,M[5]=a,M[9]=l,M[13]=c,M[2]=d,M[6]=m,M[10]=y,M[14]=v,M[3]=x,M[7]=S,M[11]=A,M[15]=E,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Mt().fromArray(this.elements)}copy(e){const t=this.elements,n=e.elements;return t[0]=n[0],t[1]=n[1],t[2]=n[2],t[3]=n[3],t[4]=n[4],t[5]=n[5],t[6]=n[6],t[7]=n[7],t[8]=n[8],t[9]=n[9],t[10]=n[10],t[11]=n[11],t[12]=n[12],t[13]=n[13],t[14]=n[14],t[15]=n[15],this}copyPosition(e){const t=this.elements,n=e.elements;return t[12]=n[12],t[13]=n[13],t[14]=n[14],this}setFromMatrix3(e){const t=e.elements;return this.set(t[0],t[3],t[6],0,t[1],t[4],t[7],0,t[2],t[5],t[8],0,0,0,0,1),this}extractBasis(e,t,n){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),n.setFromMatrixColumn(this,2),this}makeBasis(e,t,n){return this.set(e.x,t.x,n.x,0,e.y,t.y,n.y,0,e.z,t.z,n.z,0,0,0,0,1),this}extractRotation(e){const t=this.elements,n=e.elements,i=1/Pm.setFromMatrixColumn(e,0).length(),s=1/Pm.setFromMatrixColumn(e,1).length(),a=1/Pm.setFromMatrixColumn(e,2).length();return t[0]=n[0]*i,t[1]=n[1]*i,t[2]=n[2]*i,t[3]=0,t[4]=n[4]*s,t[5]=n[5]*s,t[6]=n[6]*s,t[7]=0,t[8]=n[8]*a,t[9]=n[9]*a,t[10]=n[10]*a,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromEuler(e){const t=this.elements,n=e.x,i=e.y,s=e.z,a=Math.cos(n),l=Math.sin(n),c=Math.cos(i),d=Math.sin(i),m=Math.cos(s),y=Math.sin(s);if(e.order==="XYZ"){const v=a*m,x=a*y,S=l*m,A=l*y;t[0]=c*m,t[4]=-c*y,t[8]=d,t[1]=x+S*d,t[5]=v-A*d,t[9]=-l*c,t[2]=A-v*d,t[6]=S+x*d,t[10]=a*c}else if(e.order==="YXZ"){const v=c*m,x=c*y,S=d*m,A=d*y;t[0]=v+A*l,t[4]=S*l-x,t[8]=a*d,t[1]=a*y,t[5]=a*m,t[9]=-l,t[2]=x*l-S,t[6]=A+v*l,t[10]=a*c}else if(e.order==="ZXY"){const v=c*m,x=c*y,S=d*m,A=d*y;t[0]=v-A*l,t[4]=-a*y,t[8]=S+x*l,t[1]=x+S*l,t[5]=a*m,t[9]=A-v*l,t[2]=-a*d,t[6]=l,t[10]=a*c}else if(e.order==="ZYX"){const v=a*m,x=a*y,S=l*m,A=l*y;t[0]=c*m,t[4]=S*d-x,t[8]=v*d+A,t[1]=c*y,t[5]=A*d+v,t[9]=x*d-S,t[2]=-d,t[6]=l*c,t[10]=a*c}else if(e.order==="YZX"){const v=a*c,x=a*d,S=l*c,A=l*d;t[0]=c*m,t[4]=A-v*y,t[8]=S*y+x,t[1]=y,t[5]=a*m,t[9]=-l*m,t[2]=-d*m,t[6]=x*y+S,t[10]=v-A*y}else if(e.order==="XZY"){const v=a*c,x=a*d,S=l*c,A=l*d;t[0]=c*m,t[4]=-y,t[8]=d*m,t[1]=v*y+A,t[5]=a*m,t[9]=x*y-S,t[2]=S*y-x,t[6]=l*m,t[10]=A*y+v}return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this}makeRotationFromQuaternion(e){return this.compose(oz,e,lz)}lookAt(e,t,n){const i=this.elements;return po.subVectors(e,t),po.lengthSq()===0&&(po.z=1),po.normalize(),Vh.crossVectors(n,po),Vh.lengthSq()===0&&(Math.abs(n.z)===1?po.x+=1e-4:po.z+=1e-4,po.normalize(),Vh.crossVectors(n,po)),Vh.normalize(),jx.crossVectors(po,Vh),i[0]=Vh.x,i[4]=jx.x,i[8]=po.x,i[1]=Vh.y,i[5]=jx.y,i[9]=po.y,i[2]=Vh.z,i[6]=jx.z,i[10]=po.z,this}multiply(e){return this.multiplyMatrices(this,e)}premultiply(e){return this.multiplyMatrices(e,this)}multiplyMatrices(e,t){const n=e.elements,i=t.elements,s=this.elements,a=n[0],l=n[4],c=n[8],d=n[12],m=n[1],y=n[5],v=n[9],x=n[13],S=n[2],A=n[6],E=n[10],M=n[14],C=n[3],w=n[7],D=n[11],z=n[15],B=i[0],F=i[4],H=i[8],I=i[12],P=i[1],Z=i[5],ue=i[9],se=i[13],pe=i[2],Se=i[6],V=i[10],Q=i[14],J=i[3],ve=i[7],X=i[11],re=i[15];return s[0]=a*B+l*P+c*pe+d*J,s[4]=a*F+l*Z+c*Se+d*ve,s[8]=a*H+l*ue+c*V+d*X,s[12]=a*I+l*se+c*Q+d*re,s[1]=m*B+y*P+v*pe+x*J,s[5]=m*F+y*Z+v*Se+x*ve,s[9]=m*H+y*ue+v*V+x*X,s[13]=m*I+y*se+v*Q+x*re,s[2]=S*B+A*P+E*pe+M*J,s[6]=S*F+A*Z+E*Se+M*ve,s[10]=S*H+A*ue+E*V+M*X,s[14]=S*I+A*se+E*Q+M*re,s[3]=C*B+w*P+D*pe+z*J,s[7]=C*F+w*Z+D*Se+z*ve,s[11]=C*H+w*ue+D*V+z*X,s[15]=C*I+w*se+D*Q+z*re,this}multiplyScalar(e){const t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this}determinant(){const e=this.elements,t=e[0],n=e[4],i=e[8],s=e[12],a=e[1],l=e[5],c=e[9],d=e[13],m=e[2],y=e[6],v=e[10],x=e[14],S=e[3],A=e[7],E=e[11],M=e[15];return S*(+s*c*y-i*d*y-s*l*v+n*d*v+i*l*x-n*c*x)+A*(+t*c*x-t*d*v+s*a*v-i*a*x+i*d*m-s*c*m)+E*(+t*d*y-t*l*x-s*a*y+n*a*x+s*l*m-n*d*m)+M*(-i*l*m-t*c*y+t*l*v+i*a*y-n*a*v+n*c*m)}transpose(){const e=this.elements;let t;return t=e[1],e[1]=e[4],e[4]=t,t=e[2],e[2]=e[8],e[8]=t,t=e[6],e[6]=e[9],e[9]=t,t=e[3],e[3]=e[12],e[12]=t,t=e[7],e[7]=e[13],e[13]=t,t=e[11],e[11]=e[14],e[14]=t,this}setPosition(e,t,n){const i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=n),this}invert(){const e=this.elements,t=e[0],n=e[1],i=e[2],s=e[3],a=e[4],l=e[5],c=e[6],d=e[7],m=e[8],y=e[9],v=e[10],x=e[11],S=e[12],A=e[13],E=e[14],M=e[15],C=y*E*d-A*v*d+A*c*x-l*E*x-y*c*M+l*v*M,w=S*v*d-m*E*d-S*c*x+a*E*x+m*c*M-a*v*M,D=m*A*d-S*y*d+S*l*x-a*A*x-m*l*M+a*y*M,z=S*y*c-m*A*c-S*l*v+a*A*v+m*l*E-a*y*E,B=t*C+n*w+i*D+s*z;if(B===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const F=1/B;return e[0]=C*F,e[1]=(A*v*s-y*E*s-A*i*x+n*E*x+y*i*M-n*v*M)*F,e[2]=(l*E*s-A*c*s+A*i*d-n*E*d-l*i*M+n*c*M)*F,e[3]=(y*c*s-l*v*s-y*i*d+n*v*d+l*i*x-n*c*x)*F,e[4]=w*F,e[5]=(m*E*s-S*v*s+S*i*x-t*E*x-m*i*M+t*v*M)*F,e[6]=(S*c*s-a*E*s-S*i*d+t*E*d+a*i*M-t*c*M)*F,e[7]=(a*v*s-m*c*s+m*i*d-t*v*d-a*i*x+t*c*x)*F,e[8]=D*F,e[9]=(S*y*s-m*A*s-S*n*x+t*A*x+m*n*M-t*y*M)*F,e[10]=(a*A*s-S*l*s+S*n*d-t*A*d-a*n*M+t*l*M)*F,e[11]=(m*l*s-a*y*s-m*n*d+t*y*d+a*n*x-t*l*x)*F,e[12]=z*F,e[13]=(m*A*i-S*y*i+S*n*v-t*A*v-m*n*E+t*y*E)*F,e[14]=(S*l*i-a*A*i-S*n*c+t*A*c+a*n*E-t*l*E)*F,e[15]=(a*y*i-m*l*i+m*n*c-t*y*c-a*n*v+t*l*v)*F,this}scale(e){const t=this.elements,n=e.x,i=e.y,s=e.z;return t[0]*=n,t[4]*=i,t[8]*=s,t[1]*=n,t[5]*=i,t[9]*=s,t[2]*=n,t[6]*=i,t[10]*=s,t[3]*=n,t[7]*=i,t[11]*=s,this}getMaxScaleOnAxis(){const e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],n=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,n,i))}makeTranslation(e,t,n){return e.isVector3?this.set(1,0,0,e.x,0,1,0,e.y,0,0,1,e.z,0,0,0,1):this.set(1,0,0,e,0,1,0,t,0,0,1,n,0,0,0,1),this}makeRotationX(e){const t=Math.cos(e),n=Math.sin(e);return this.set(1,0,0,0,0,t,-n,0,0,n,t,0,0,0,0,1),this}makeRotationY(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,0,n,0,0,1,0,0,-n,0,t,0,0,0,0,1),this}makeRotationZ(e){const t=Math.cos(e),n=Math.sin(e);return this.set(t,-n,0,0,n,t,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(e,t){const n=Math.cos(t),i=Math.sin(t),s=1-n,a=e.x,l=e.y,c=e.z,d=s*a,m=s*l;return this.set(d*a+n,d*l-i*c,d*c+i*l,0,d*l+i*c,m*l+n,m*c-i*a,0,d*c-i*l,m*c+i*a,s*c*c+n,0,0,0,0,1),this}makeScale(e,t,n){return this.set(e,0,0,0,0,t,0,0,0,0,n,0,0,0,0,1),this}makeShear(e,t,n,i,s,a){return this.set(1,n,s,0,e,1,a,0,t,i,1,0,0,0,0,1),this}compose(e,t,n){const i=this.elements,s=t._x,a=t._y,l=t._z,c=t._w,d=s+s,m=a+a,y=l+l,v=s*d,x=s*m,S=s*y,A=a*m,E=a*y,M=l*y,C=c*d,w=c*m,D=c*y,z=n.x,B=n.y,F=n.z;return i[0]=(1-(A+M))*z,i[1]=(x+D)*z,i[2]=(S-w)*z,i[3]=0,i[4]=(x-D)*B,i[5]=(1-(v+M))*B,i[6]=(E+C)*B,i[7]=0,i[8]=(S+w)*F,i[9]=(E-C)*F,i[10]=(1-(v+A))*F,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this}decompose(e,t,n){const i=this.elements;let s=Pm.set(i[0],i[1],i[2]).length();const a=Pm.set(i[4],i[5],i[6]).length(),l=Pm.set(i[8],i[9],i[10]).length();this.determinant()<0&&(s=-s),e.x=i[12],e.y=i[13],e.z=i[14],Cl.copy(this);const d=1/s,m=1/a,y=1/l;return Cl.elements[0]*=d,Cl.elements[1]*=d,Cl.elements[2]*=d,Cl.elements[4]*=m,Cl.elements[5]*=m,Cl.elements[6]*=m,Cl.elements[8]*=y,Cl.elements[9]*=y,Cl.elements[10]*=y,t.setFromRotationMatrix(Cl),n.x=s,n.y=a,n.z=l,this}makePerspective(e,t,n,i,s,a,l=zr){const c=this.elements,d=2*s/(t-e),m=2*s/(n-i),y=(t+e)/(t-e),v=(n+i)/(n-i);let x,S;if(l===zr)x=-(a+s)/(a-s),S=-2*a*s/(a-s);else if(l===Vl)x=-a/(a-s),S=-a*s/(a-s);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+l);return c[0]=d,c[4]=0,c[8]=y,c[12]=0,c[1]=0,c[5]=m,c[9]=v,c[13]=0,c[2]=0,c[6]=0,c[10]=x,c[14]=S,c[3]=0,c[7]=0,c[11]=-1,c[15]=0,this}makeOrthographic(e,t,n,i,s,a,l=zr){const c=this.elements,d=1/(t-e),m=1/(n-i),y=1/(a-s),v=(t+e)*d,x=(n+i)*m;let S,A;if(l===zr)S=(a+s)*y,A=-2*y;else if(l===Vl)S=s*y,A=-1*y;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+l);return c[0]=2*d,c[4]=0,c[8]=0,c[12]=-v,c[1]=0,c[5]=2*m,c[9]=0,c[13]=-x,c[2]=0,c[6]=0,c[10]=A,c[14]=-S,c[3]=0,c[7]=0,c[11]=0,c[15]=1,this}equals(e){const t=this.elements,n=e.elements;for(let i=0;i<16;i++)if(t[i]!==n[i])return!1;return!0}fromArray(e,t=0){for(let n=0;n<16;n++)this.elements[n]=e[n+t];return this}toArray(e=[],t=0){const n=this.elements;return e[t]=n[0],e[t+1]=n[1],e[t+2]=n[2],e[t+3]=n[3],e[t+4]=n[4],e[t+5]=n[5],e[t+6]=n[6],e[t+7]=n[7],e[t+8]=n[8],e[t+9]=n[9],e[t+10]=n[10],e[t+11]=n[11],e[t+12]=n[12],e[t+13]=n[13],e[t+14]=n[14],e[t+15]=n[15],e}}const Pm=new Y,Cl=new Mt,oz=new Y(0,0,0),lz=new Y(1,1,1),Vh=new Y,jx=new Y,po=new Y,zC=new Mt,VC=new ma;class _a{constructor(e=0,t=0,n=0,i=_a.DEFAULT_ORDER){this.isEuler=!0,this._x=e,this._y=t,this._z=n,this._order=i}get x(){return this._x}set x(e){this._x=e,this._onChangeCallback()}get y(){return this._y}set y(e){this._y=e,this._onChangeCallback()}get z(){return this._z}set z(e){this._z=e,this._onChangeCallback()}get order(){return this._order}set order(e){this._order=e,this._onChangeCallback()}set(e,t,n,i=this._order){return this._x=e,this._y=t,this._z=n,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this}setFromRotationMatrix(e,t=this._order,n=!0){const i=e.elements,s=i[0],a=i[4],l=i[8],c=i[1],d=i[5],m=i[9],y=i[2],v=i[6],x=i[10];switch(t){case"XYZ":this._y=Math.asin(hn(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(-m,x),this._z=Math.atan2(-a,s)):(this._x=Math.atan2(v,d),this._z=0);break;case"YXZ":this._x=Math.asin(-hn(m,-1,1)),Math.abs(m)<.9999999?(this._y=Math.atan2(l,x),this._z=Math.atan2(c,d)):(this._y=Math.atan2(-y,s),this._z=0);break;case"ZXY":this._x=Math.asin(hn(v,-1,1)),Math.abs(v)<.9999999?(this._y=Math.atan2(-y,x),this._z=Math.atan2(-a,d)):(this._y=0,this._z=Math.atan2(c,s));break;case"ZYX":this._y=Math.asin(-hn(y,-1,1)),Math.abs(y)<.9999999?(this._x=Math.atan2(v,x),this._z=Math.atan2(c,s)):(this._x=0,this._z=Math.atan2(-a,d));break;case"YZX":this._z=Math.asin(hn(c,-1,1)),Math.abs(c)<.9999999?(this._x=Math.atan2(-m,d),this._y=Math.atan2(-y,s)):(this._x=0,this._y=Math.atan2(l,x));break;case"XZY":this._z=Math.asin(-hn(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(v,d),this._y=Math.atan2(l,s)):(this._x=Math.atan2(-m,x),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+t)}return this._order=t,n===!0&&this._onChangeCallback(),this}setFromQuaternion(e,t,n){return zC.makeRotationFromQuaternion(e),this.setFromRotationMatrix(zC,t,n)}setFromVector3(e,t=this._order){return this.set(e.x,e.y,e.z,t)}reorder(e){return VC.setFromEuler(this),this.setFromQuaternion(VC,e)}equals(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order}fromArray(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this}toArray(e=[],t=0){return e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e}_onChange(e){return this._onChangeCallback=e,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}_a.DEFAULT_ORDER="XYZ";class zg{constructor(){this.mask=1}set(e){this.mask=(1<<e|0)>>>0}enable(e){this.mask|=1<<e|0}enableAll(){this.mask=-1}toggle(e){this.mask^=1<<e|0}disable(e){this.mask&=~(1<<e|0)}disableAll(){this.mask=0}test(e){return(this.mask&e.mask)!==0}isEnabled(e){return(this.mask&(1<<e|0))!==0}}let uz=0;const GC=new Y,Im=new ma,xc=new Mt,Zx=new Y,Av=new Y,cz=new Y,hz=new ma,HC=new Y(1,0,0),kC=new Y(0,1,0),qC=new Y(0,0,1),WC={type:"added"},fz={type:"removed"},Fm={type:"childadded",child:null},tE={type:"childremoved",child:null};class Hn extends bo{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:uz++}),this.uuid=So(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Hn.DEFAULT_UP.clone();const e=new Y,t=new _a,n=new ma,i=new Y(1,1,1);function s(){n.setFromEuler(t,!1)}function a(){t.setFromQuaternion(n,void 0,!1)}t._onChange(s),n._onChange(a),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:n},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Mt},normalMatrix:{value:new Qt}}),this.matrix=new Mt,this.matrixWorld=new Mt,this.matrixAutoUpdate=Hn.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Hn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new zg,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(e){return this.quaternion.premultiply(e),this}setRotationFromAxisAngle(e,t){this.quaternion.setFromAxisAngle(e,t)}setRotationFromEuler(e){this.quaternion.setFromEuler(e,!0)}setRotationFromMatrix(e){this.quaternion.setFromRotationMatrix(e)}setRotationFromQuaternion(e){this.quaternion.copy(e)}rotateOnAxis(e,t){return Im.setFromAxisAngle(e,t),this.quaternion.multiply(Im),this}rotateOnWorldAxis(e,t){return Im.setFromAxisAngle(e,t),this.quaternion.premultiply(Im),this}rotateX(e){return this.rotateOnAxis(HC,e)}rotateY(e){return this.rotateOnAxis(kC,e)}rotateZ(e){return this.rotateOnAxis(qC,e)}translateOnAxis(e,t){return GC.copy(e).applyQuaternion(this.quaternion),this.position.add(GC.multiplyScalar(t)),this}translateX(e){return this.translateOnAxis(HC,e)}translateY(e){return this.translateOnAxis(kC,e)}translateZ(e){return this.translateOnAxis(qC,e)}localToWorld(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(this.matrixWorld)}worldToLocal(e){return this.updateWorldMatrix(!0,!1),e.applyMatrix4(xc.copy(this.matrixWorld).invert())}lookAt(e,t,n){e.isVector3?Zx.copy(e):Zx.set(e,t,n);const i=this.parent;this.updateWorldMatrix(!0,!1),Av.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?xc.lookAt(Av,Zx,this.up):xc.lookAt(Zx,Av,this.up),this.quaternion.setFromRotationMatrix(xc),i&&(xc.extractRotation(i.matrixWorld),Im.setFromRotationMatrix(xc),this.quaternion.premultiply(Im.invert()))}add(e){if(arguments.length>1){for(let t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",e),this):(e&&e.isObject3D?(e.removeFromParent(),e.parent=this,this.children.push(e),e.dispatchEvent(WC),Fm.child=e,this.dispatchEvent(Fm),Fm.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this)}remove(e){if(arguments.length>1){for(let n=0;n<arguments.length;n++)this.remove(arguments[n]);return this}const t=this.children.indexOf(e);return t!==-1&&(e.parent=null,this.children.splice(t,1),e.dispatchEvent(fz),tE.child=e,this.dispatchEvent(tE),tE.child=null),this}removeFromParent(){const e=this.parent;return e!==null&&e.remove(this),this}clear(){return this.remove(...this.children)}attach(e){return this.updateWorldMatrix(!0,!1),xc.copy(this.matrixWorld).invert(),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),xc.multiply(e.parent.matrixWorld)),e.applyMatrix4(xc),e.removeFromParent(),e.parent=this,this.children.push(e),e.updateWorldMatrix(!1,!0),e.dispatchEvent(WC),Fm.child=e,this.dispatchEvent(Fm),Fm.child=null,this}getObjectById(e){return this.getObjectByProperty("id",e)}getObjectByName(e){return this.getObjectByProperty("name",e)}getObjectByProperty(e,t){if(this[e]===t)return this;for(let n=0,i=this.children.length;n<i;n++){const a=this.children[n].getObjectByProperty(e,t);if(a!==void 0)return a}}getObjectsByProperty(e,t,n=[]){this[e]===t&&n.push(this);const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].getObjectsByProperty(e,t,n);return n}getWorldPosition(e){return this.updateWorldMatrix(!0,!1),e.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Av,e,cz),e}getWorldScale(e){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Av,hz,e),e}getWorldDirection(e){this.updateWorldMatrix(!0,!1);const t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()}raycast(){}traverse(e){e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverse(e)}traverseVisible(e){if(this.visible===!1)return;e(this);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].traverseVisible(e)}traverseAncestors(e){const t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,e=!0);const t=this.children;for(let n=0,i=t.length;n<i;n++)t[n].updateMatrixWorld(e)}updateWorldMatrix(e,t){const n=this.parent;if(e===!0&&n!==null&&n.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),t===!0){const i=this.children;for(let s=0,a=i.length;s<a;s++)i[s].updateWorldMatrix(!1,!0)}}toJSON(e){const t=e===void 0||typeof e=="string",n={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},n.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(l=>({boxInitialized:l.boxInitialized,boxMin:l.box.min.toArray(),boxMax:l.box.max.toArray(),sphereInitialized:l.sphereInitialized,sphereRadius:l.sphere.radius,sphereCenter:l.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(e),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(e)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function s(l,c){return l[c.uuid]===void 0&&(l[c.uuid]=c.toJSON(e)),c.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(e).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(e).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=s(e.geometries,this.geometry);const l=this.geometry.parameters;if(l!==void 0&&l.shapes!==void 0){const c=l.shapes;if(Array.isArray(c))for(let d=0,m=c.length;d<m;d++){const y=c[d];s(e.shapes,y)}else s(e.shapes,c)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(s(e.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const l=[];for(let c=0,d=this.material.length;c<d;c++)l.push(s(e.materials,this.material[c]));i.material=l}else i.material=s(e.materials,this.material);if(this.children.length>0){i.children=[];for(let l=0;l<this.children.length;l++)i.children.push(this.children[l].toJSON(e).object)}if(this.animations.length>0){i.animations=[];for(let l=0;l<this.animations.length;l++){const c=this.animations[l];i.animations.push(s(e.animations,c))}}if(t){const l=a(e.geometries),c=a(e.materials),d=a(e.textures),m=a(e.images),y=a(e.shapes),v=a(e.skeletons),x=a(e.animations),S=a(e.nodes);l.length>0&&(n.geometries=l),c.length>0&&(n.materials=c),d.length>0&&(n.textures=d),m.length>0&&(n.images=m),y.length>0&&(n.shapes=y),v.length>0&&(n.skeletons=v),x.length>0&&(n.animations=x),S.length>0&&(n.nodes=S)}return n.object=i,n;function a(l){const c=[];for(const d in l){const m=l[d];delete m.metadata,c.push(m)}return c}}clone(e){return new this.constructor().copy(this,e)}copy(e,t=!0){if(this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.rotation.order=e.rotation.order,this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldAutoUpdate=e.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.animations=e.animations.slice(),this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(let n=0;n<e.children.length;n++){const i=e.children[n];this.add(i.clone())}return this}}Hn.DEFAULT_UP=new Y(0,1,0);Hn.DEFAULT_MATRIX_AUTO_UPDATE=!0;Hn.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const wl=new Y,Sc=new Y,nE=new Y,bc=new Y,zm=new Y,Vm=new Y,XC=new Y,iE=new Y,sE=new Y,rE=new Y,aE=new Ot,oE=new Ot,lE=new Ot;class Fa{constructor(e=new Y,t=new Y,n=new Y){this.a=e,this.b=t,this.c=n}static getNormal(e,t,n,i){i.subVectors(n,t),wl.subVectors(e,t),i.cross(wl);const s=i.lengthSq();return s>0?i.multiplyScalar(1/Math.sqrt(s)):i.set(0,0,0)}static getBarycoord(e,t,n,i,s){wl.subVectors(i,t),Sc.subVectors(n,t),nE.subVectors(e,t);const a=wl.dot(wl),l=wl.dot(Sc),c=wl.dot(nE),d=Sc.dot(Sc),m=Sc.dot(nE),y=a*d-l*l;if(y===0)return s.set(0,0,0),null;const v=1/y,x=(d*c-l*m)*v,S=(a*m-l*c)*v;return s.set(1-x-S,S,x)}static containsPoint(e,t,n,i){return this.getBarycoord(e,t,n,i,bc)===null?!1:bc.x>=0&&bc.y>=0&&bc.x+bc.y<=1}static getInterpolation(e,t,n,i,s,a,l,c){return this.getBarycoord(e,t,n,i,bc)===null?(c.x=0,c.y=0,"z"in c&&(c.z=0),"w"in c&&(c.w=0),null):(c.setScalar(0),c.addScaledVector(s,bc.x),c.addScaledVector(a,bc.y),c.addScaledVector(l,bc.z),c)}static getInterpolatedAttribute(e,t,n,i,s,a){return aE.setScalar(0),oE.setScalar(0),lE.setScalar(0),aE.fromBufferAttribute(e,t),oE.fromBufferAttribute(e,n),lE.fromBufferAttribute(e,i),a.setScalar(0),a.addScaledVector(aE,s.x),a.addScaledVector(oE,s.y),a.addScaledVector(lE,s.z),a}static isFrontFacing(e,t,n,i){return wl.subVectors(n,t),Sc.subVectors(e,t),wl.cross(Sc).dot(i)<0}set(e,t,n){return this.a.copy(e),this.b.copy(t),this.c.copy(n),this}setFromPointsAndIndices(e,t,n,i){return this.a.copy(e[t]),this.b.copy(e[n]),this.c.copy(e[i]),this}setFromAttributeAndIndices(e,t,n,i){return this.a.fromBufferAttribute(e,t),this.b.fromBufferAttribute(e,n),this.c.fromBufferAttribute(e,i),this}clone(){return new this.constructor().copy(this)}copy(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this}getArea(){return wl.subVectors(this.c,this.b),Sc.subVectors(this.a,this.b),wl.cross(Sc).length()*.5}getMidpoint(e){return e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)}getNormal(e){return Fa.getNormal(this.a,this.b,this.c,e)}getPlane(e){return e.setFromCoplanarPoints(this.a,this.b,this.c)}getBarycoord(e,t){return Fa.getBarycoord(e,this.a,this.b,this.c,t)}getInterpolation(e,t,n,i,s){return Fa.getInterpolation(e,this.a,this.b,this.c,t,n,i,s)}containsPoint(e){return Fa.containsPoint(e,this.a,this.b,this.c)}isFrontFacing(e){return Fa.isFrontFacing(this.a,this.b,this.c,e)}intersectsBox(e){return e.intersectsTriangle(this)}closestPointToPoint(e,t){const n=this.a,i=this.b,s=this.c;let a,l;zm.subVectors(i,n),Vm.subVectors(s,n),iE.subVectors(e,n);const c=zm.dot(iE),d=Vm.dot(iE);if(c<=0&&d<=0)return t.copy(n);sE.subVectors(e,i);const m=zm.dot(sE),y=Vm.dot(sE);if(m>=0&&y<=m)return t.copy(i);const v=c*y-m*d;if(v<=0&&c>=0&&m<=0)return a=c/(c-m),t.copy(n).addScaledVector(zm,a);rE.subVectors(e,s);const x=zm.dot(rE),S=Vm.dot(rE);if(S>=0&&x<=S)return t.copy(s);const A=x*d-c*S;if(A<=0&&d>=0&&S<=0)return l=d/(d-S),t.copy(n).addScaledVector(Vm,l);const E=m*S-x*y;if(E<=0&&y-m>=0&&x-S>=0)return XC.subVectors(s,i),l=(y-m)/(y-m+(x-S)),t.copy(i).addScaledVector(XC,l);const M=1/(E+A+v);return a=A*M,l=v*M,t.copy(n).addScaledVector(zm,a).addScaledVector(Vm,l)}equals(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}}const bU={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Gh={h:0,s:0,l:0},Kx={h:0,s:0,l:0};function uE(r,e,t){return t<0&&(t+=1),t>1&&(t-=1),t<1/6?r+(e-r)*6*t:t<1/2?e:t<2/3?r+(e-r)*6*(2/3-t):r}class ft{constructor(e,t,n){return this.isColor=!0,this.r=1,this.g=1,this.b=1,this.set(e,t,n)}set(e,t,n){if(t===void 0&&n===void 0){const i=e;i&&i.isColor?this.copy(i):typeof i=="number"?this.setHex(i):typeof i=="string"&&this.setStyle(i)}else this.setRGB(e,t,n);return this}setScalar(e){return this.r=e,this.g=e,this.b=e,this}setHex(e,t=wt){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(e&255)/255,on.toWorkingColorSpace(this,t),this}setRGB(e,t,n,i=on.workingColorSpace){return this.r=e,this.g=t,this.b=n,on.toWorkingColorSpace(this,i),this}setHSL(e,t,n,i=on.workingColorSpace){if(e=O1(e,1),t=hn(t,0,1),n=hn(n,0,1),t===0)this.r=this.g=this.b=n;else{const s=n<=.5?n*(1+t):n+t-n*t,a=2*n-s;this.r=uE(a,s,e+1/3),this.g=uE(a,s,e),this.b=uE(a,s,e-1/3)}return on.toWorkingColorSpace(this,i),this}setStyle(e,t=wt){function n(s){s!==void 0&&parseFloat(s)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}let i;if(i=/^(\w+)\(([^\)]*)\)/.exec(e)){let s;const a=i[1],l=i[2];switch(a){case"rgb":case"rgba":if(s=/^\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setRGB(Math.min(255,parseInt(s[1],10))/255,Math.min(255,parseInt(s[2],10))/255,Math.min(255,parseInt(s[3],10))/255,t);if(s=/^\s*(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setRGB(Math.min(100,parseInt(s[1],10))/100,Math.min(100,parseInt(s[2],10))/100,Math.min(100,parseInt(s[3],10))/100,t);break;case"hsl":case"hsla":if(s=/^\s*(\d*\.?\d+)\s*,\s*(\d*\.?\d+)\%\s*,\s*(\d*\.?\d+)\%\s*(?:,\s*(\d*\.?\d+)\s*)?$/.exec(l))return n(s[4]),this.setHSL(parseFloat(s[1])/360,parseFloat(s[2])/100,parseFloat(s[3])/100,t);break;default:console.warn("THREE.Color: Unknown color model "+e)}}else if(i=/^\#([A-Fa-f\d]+)$/.exec(e)){const s=i[1],a=s.length;if(a===3)return this.setRGB(parseInt(s.charAt(0),16)/15,parseInt(s.charAt(1),16)/15,parseInt(s.charAt(2),16)/15,t);if(a===6)return this.setHex(parseInt(s,16),t);console.warn("THREE.Color: Invalid hex color "+e)}else if(e&&e.length>0)return this.setColorName(e,t);return this}setColorName(e,t=wt){const n=bU[e.toLowerCase()];return n!==void 0?this.setHex(n,t):console.warn("THREE.Color: Unknown color "+e),this}clone(){return new this.constructor(this.r,this.g,this.b)}copy(e){return this.r=e.r,this.g=e.g,this.b=e.b,this}copySRGBToLinear(e){return this.r=Lc(e.r),this.g=Lc(e.g),this.b=Lc(e.b),this}copyLinearToSRGB(e){return this.r=gg(e.r),this.g=gg(e.g),this.b=gg(e.b),this}convertSRGBToLinear(){return this.copySRGBToLinear(this),this}convertLinearToSRGB(){return this.copyLinearToSRGB(this),this}getHex(e=wt){return on.fromWorkingColorSpace(Pr.copy(this),e),Math.round(hn(Pr.r*255,0,255))*65536+Math.round(hn(Pr.g*255,0,255))*256+Math.round(hn(Pr.b*255,0,255))}getHexString(e=wt){return("000000"+this.getHex(e).toString(16)).slice(-6)}getHSL(e,t=on.workingColorSpace){on.fromWorkingColorSpace(Pr.copy(this),t);const n=Pr.r,i=Pr.g,s=Pr.b,a=Math.max(n,i,s),l=Math.min(n,i,s);let c,d;const m=(l+a)/2;if(l===a)c=0,d=0;else{const y=a-l;switch(d=m<=.5?y/(a+l):y/(2-a-l),a){case n:c=(i-s)/y+(i<s?6:0);break;case i:c=(s-n)/y+2;break;case s:c=(n-i)/y+4;break}c/=6}return e.h=c,e.s=d,e.l=m,e}getRGB(e,t=on.workingColorSpace){return on.fromWorkingColorSpace(Pr.copy(this),t),e.r=Pr.r,e.g=Pr.g,e.b=Pr.b,e}getStyle(e=wt){on.fromWorkingColorSpace(Pr.copy(this),e);const t=Pr.r,n=Pr.g,i=Pr.b;return e!==wt?`color(${e} ${t.toFixed(3)} ${n.toFixed(3)} ${i.toFixed(3)})`:`rgb(${Math.round(t*255)},${Math.round(n*255)},${Math.round(i*255)})`}offsetHSL(e,t,n){return this.getHSL(Gh),this.setHSL(Gh.h+e,Gh.s+t,Gh.l+n)}add(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this}addColors(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this}addScalar(e){return this.r+=e,this.g+=e,this.b+=e,this}sub(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this}multiply(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this}multiplyScalar(e){return this.r*=e,this.g*=e,this.b*=e,this}lerp(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this}lerpColors(e,t,n){return this.r=e.r+(t.r-e.r)*n,this.g=e.g+(t.g-e.g)*n,this.b=e.b+(t.b-e.b)*n,this}lerpHSL(e,t){this.getHSL(Gh),e.getHSL(Kx);const n=n_(Gh.h,Kx.h,t),i=n_(Gh.s,Kx.s,t),s=n_(Gh.l,Kx.l,t);return this.setHSL(n,i,s),this}setFromVector3(e){return this.r=e.x,this.g=e.y,this.b=e.z,this}applyMatrix3(e){const t=this.r,n=this.g,i=this.b,s=e.elements;return this.r=s[0]*t+s[3]*n+s[6]*i,this.g=s[1]*t+s[4]*n+s[7]*i,this.b=s[2]*t+s[5]*n+s[8]*i,this}equals(e){return e.r===this.r&&e.g===this.g&&e.b===this.b}fromArray(e,t=0){return this.r=e[t],this.g=e[t+1],this.b=e[t+2],this}toArray(e=[],t=0){return e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e}fromBufferAttribute(e,t){return this.r=e.getX(t),this.g=e.getY(t),this.b=e.getZ(t),this}toJSON(){return this.getHex()}*[Symbol.iterator](){yield this.r,yield this.g,yield this.b}}const Pr=new ft;ft.NAMES=bU;let dz=0;class ar extends bo{constructor(){super(),this.isMaterial=!0,Object.defineProperty(this,"id",{value:dz++}),this.uuid=So(),this.name="",this.type="Material",this.blending=_o,this.side=pa,this.vertexColors=!1,this.opacity=1,this.transparent=!1,this.alphaHash=!1,this.blendSrc=Sg,this.blendDst=bg,this.blendEquation=_r,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.blendColor=new ft(0,0,0),this.blendAlpha=0,this.depthFunc=Pc,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=gb,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=Xh,this.stencilZFail=Xh,this.stencilZPass=Xh,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaToCoverage=!1,this.premultipliedAlpha=!1,this.forceSinglePass=!1,this.allowOverride=!0,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0,this._alphaTest=0}get alphaTest(){return this._alphaTest}set alphaTest(e){this._alphaTest>0!=e>0&&this.version++,this._alphaTest=e}onBeforeRender(){}onBeforeCompile(){}customProgramCacheKey(){return this.onBeforeCompile.toString()}setValues(e){if(e!==void 0)for(const t in e){const n=e[t];if(n===void 0){console.warn(`THREE.Material: parameter '${t}' has value of undefined.`);continue}const i=this[t];if(i===void 0){console.warn(`THREE.Material: '${t}' is not a property of THREE.${this.type}.`);continue}i&&i.isColor?i.set(n):i&&i.isVector3&&n&&n.isVector3?i.copy(n):this[t]=n}}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});const n={metadata:{version:4.6,type:"Material",generator:"Material.toJSON"}};n.uuid=this.uuid,n.type=this.type,this.name!==""&&(n.name=this.name),this.color&&this.color.isColor&&(n.color=this.color.getHex()),this.roughness!==void 0&&(n.roughness=this.roughness),this.metalness!==void 0&&(n.metalness=this.metalness),this.sheen!==void 0&&(n.sheen=this.sheen),this.sheenColor&&this.sheenColor.isColor&&(n.sheenColor=this.sheenColor.getHex()),this.sheenRoughness!==void 0&&(n.sheenRoughness=this.sheenRoughness),this.emissive&&this.emissive.isColor&&(n.emissive=this.emissive.getHex()),this.emissiveIntensity!==void 0&&this.emissiveIntensity!==1&&(n.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(n.specular=this.specular.getHex()),this.specularIntensity!==void 0&&(n.specularIntensity=this.specularIntensity),this.specularColor&&this.specularColor.isColor&&(n.specularColor=this.specularColor.getHex()),this.shininess!==void 0&&(n.shininess=this.shininess),this.clearcoat!==void 0&&(n.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(n.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatMap&&this.clearcoatMap.isTexture&&(n.clearcoatMap=this.clearcoatMap.toJSON(e).uuid),this.clearcoatRoughnessMap&&this.clearcoatRoughnessMap.isTexture&&(n.clearcoatRoughnessMap=this.clearcoatRoughnessMap.toJSON(e).uuid),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(n.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,n.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.dispersion!==void 0&&(n.dispersion=this.dispersion),this.iridescence!==void 0&&(n.iridescence=this.iridescence),this.iridescenceIOR!==void 0&&(n.iridescenceIOR=this.iridescenceIOR),this.iridescenceThicknessRange!==void 0&&(n.iridescenceThicknessRange=this.iridescenceThicknessRange),this.iridescenceMap&&this.iridescenceMap.isTexture&&(n.iridescenceMap=this.iridescenceMap.toJSON(e).uuid),this.iridescenceThicknessMap&&this.iridescenceThicknessMap.isTexture&&(n.iridescenceThicknessMap=this.iridescenceThicknessMap.toJSON(e).uuid),this.anisotropy!==void 0&&(n.anisotropy=this.anisotropy),this.anisotropyRotation!==void 0&&(n.anisotropyRotation=this.anisotropyRotation),this.anisotropyMap&&this.anisotropyMap.isTexture&&(n.anisotropyMap=this.anisotropyMap.toJSON(e).uuid),this.map&&this.map.isTexture&&(n.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(n.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(n.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(n.lightMap=this.lightMap.toJSON(e).uuid,n.lightMapIntensity=this.lightMapIntensity),this.aoMap&&this.aoMap.isTexture&&(n.aoMap=this.aoMap.toJSON(e).uuid,n.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(n.bumpMap=this.bumpMap.toJSON(e).uuid,n.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(n.normalMap=this.normalMap.toJSON(e).uuid,n.normalMapType=this.normalMapType,n.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(n.displacementMap=this.displacementMap.toJSON(e).uuid,n.displacementScale=this.displacementScale,n.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(n.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(n.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(n.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(n.specularMap=this.specularMap.toJSON(e).uuid),this.specularIntensityMap&&this.specularIntensityMap.isTexture&&(n.specularIntensityMap=this.specularIntensityMap.toJSON(e).uuid),this.specularColorMap&&this.specularColorMap.isTexture&&(n.specularColorMap=this.specularColorMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(n.envMap=this.envMap.toJSON(e).uuid,this.combine!==void 0&&(n.combine=this.combine)),this.envMapRotation!==void 0&&(n.envMapRotation=this.envMapRotation.toArray()),this.envMapIntensity!==void 0&&(n.envMapIntensity=this.envMapIntensity),this.reflectivity!==void 0&&(n.reflectivity=this.reflectivity),this.refractionRatio!==void 0&&(n.refractionRatio=this.refractionRatio),this.gradientMap&&this.gradientMap.isTexture&&(n.gradientMap=this.gradientMap.toJSON(e).uuid),this.transmission!==void 0&&(n.transmission=this.transmission),this.transmissionMap&&this.transmissionMap.isTexture&&(n.transmissionMap=this.transmissionMap.toJSON(e).uuid),this.thickness!==void 0&&(n.thickness=this.thickness),this.thicknessMap&&this.thicknessMap.isTexture&&(n.thicknessMap=this.thicknessMap.toJSON(e).uuid),this.attenuationDistance!==void 0&&this.attenuationDistance!==1/0&&(n.attenuationDistance=this.attenuationDistance),this.attenuationColor!==void 0&&(n.attenuationColor=this.attenuationColor.getHex()),this.size!==void 0&&(n.size=this.size),this.shadowSide!==null&&(n.shadowSide=this.shadowSide),this.sizeAttenuation!==void 0&&(n.sizeAttenuation=this.sizeAttenuation),this.blending!==_o&&(n.blending=this.blending),this.side!==pa&&(n.side=this.side),this.vertexColors===!0&&(n.vertexColors=!0),this.opacity<1&&(n.opacity=this.opacity),this.transparent===!0&&(n.transparent=!0),this.blendSrc!==Sg&&(n.blendSrc=this.blendSrc),this.blendDst!==bg&&(n.blendDst=this.blendDst),this.blendEquation!==_r&&(n.blendEquation=this.blendEquation),this.blendSrcAlpha!==null&&(n.blendSrcAlpha=this.blendSrcAlpha),this.blendDstAlpha!==null&&(n.blendDstAlpha=this.blendDstAlpha),this.blendEquationAlpha!==null&&(n.blendEquationAlpha=this.blendEquationAlpha),this.blendColor&&this.blendColor.isColor&&(n.blendColor=this.blendColor.getHex()),this.blendAlpha!==0&&(n.blendAlpha=this.blendAlpha),this.depthFunc!==Pc&&(n.depthFunc=this.depthFunc),this.depthTest===!1&&(n.depthTest=this.depthTest),this.depthWrite===!1&&(n.depthWrite=this.depthWrite),this.colorWrite===!1&&(n.colorWrite=this.colorWrite),this.stencilWriteMask!==255&&(n.stencilWriteMask=this.stencilWriteMask),this.stencilFunc!==gb&&(n.stencilFunc=this.stencilFunc),this.stencilRef!==0&&(n.stencilRef=this.stencilRef),this.stencilFuncMask!==255&&(n.stencilFuncMask=this.stencilFuncMask),this.stencilFail!==Xh&&(n.stencilFail=this.stencilFail),this.stencilZFail!==Xh&&(n.stencilZFail=this.stencilZFail),this.stencilZPass!==Xh&&(n.stencilZPass=this.stencilZPass),this.stencilWrite===!0&&(n.stencilWrite=this.stencilWrite),this.rotation!==void 0&&this.rotation!==0&&(n.rotation=this.rotation),this.polygonOffset===!0&&(n.polygonOffset=!0),this.polygonOffsetFactor!==0&&(n.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(n.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth!==void 0&&this.linewidth!==1&&(n.linewidth=this.linewidth),this.dashSize!==void 0&&(n.dashSize=this.dashSize),this.gapSize!==void 0&&(n.gapSize=this.gapSize),this.scale!==void 0&&(n.scale=this.scale),this.dithering===!0&&(n.dithering=!0),this.alphaTest>0&&(n.alphaTest=this.alphaTest),this.alphaHash===!0&&(n.alphaHash=!0),this.alphaToCoverage===!0&&(n.alphaToCoverage=!0),this.premultipliedAlpha===!0&&(n.premultipliedAlpha=!0),this.forceSinglePass===!0&&(n.forceSinglePass=!0),this.wireframe===!0&&(n.wireframe=!0),this.wireframeLinewidth>1&&(n.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(n.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(n.wireframeLinejoin=this.wireframeLinejoin),this.flatShading===!0&&(n.flatShading=!0),this.visible===!1&&(n.visible=!1),this.toneMapped===!1&&(n.toneMapped=!1),this.fog===!1&&(n.fog=!1),Object.keys(this.userData).length>0&&(n.userData=this.userData);function i(s){const a=[];for(const l in s){const c=s[l];delete c.metadata,a.push(c)}return a}if(t){const s=i(e.textures),a=i(e.images);s.length>0&&(n.textures=s),a.length>0&&(n.images=a)}return n}clone(){return new this.constructor().copy(this)}copy(e){this.name=e.name,this.blending=e.blending,this.side=e.side,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.blendColor.copy(e.blendColor),this.blendAlpha=e.blendAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;const t=e.clippingPlanes;let n=null;if(t!==null){const i=t.length;n=new Array(i);for(let s=0;s!==i;++s)n[s]=t[s].clone()}return this.clippingPlanes=n,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.alphaHash=e.alphaHash,this.alphaToCoverage=e.alphaToCoverage,this.premultipliedAlpha=e.premultipliedAlpha,this.forceSinglePass=e.forceSinglePass,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this}dispose(){this.dispatchEvent({type:"dispose"})}set needsUpdate(e){e===!0&&this.version++}onBuild(){console.warn("Material: onBuild() has been removed.")}}class fa extends ar{constructor(e){super(),this.isMeshBasicMaterial=!0,this.type="MeshBasicMaterial",this.color=new ft(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _a,this.combine=Kg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}const Rc=pz();function pz(){const r=new ArrayBuffer(4),e=new Float32Array(r),t=new Uint32Array(r),n=new Uint32Array(512),i=new Uint32Array(512);for(let c=0;c<256;++c){const d=c-127;d<-27?(n[c]=0,n[c|256]=32768,i[c]=24,i[c|256]=24):d<-14?(n[c]=1024>>-d-14,n[c|256]=1024>>-d-14|32768,i[c]=-d-1,i[c|256]=-d-1):d<=15?(n[c]=d+15<<10,n[c|256]=d+15<<10|32768,i[c]=13,i[c|256]=13):d<128?(n[c]=31744,n[c|256]=64512,i[c]=24,i[c|256]=24):(n[c]=31744,n[c|256]=64512,i[c]=13,i[c|256]=13)}const s=new Uint32Array(2048),a=new Uint32Array(64),l=new Uint32Array(64);for(let c=1;c<1024;++c){let d=c<<13,m=0;for(;(d&8388608)===0;)d<<=1,m-=8388608;d&=-8388609,m+=947912704,s[c]=d|m}for(let c=1024;c<2048;++c)s[c]=939524096+(c-1024<<13);for(let c=1;c<31;++c)a[c]=c<<23;a[31]=1199570944,a[32]=2147483648;for(let c=33;c<63;++c)a[c]=2147483648+(c-32<<23);a[63]=3347054592;for(let c=1;c<64;++c)c!==32&&(l[c]=1024);return{floatView:e,uint32View:t,baseTable:n,shiftTable:i,mantissaTable:s,exponentTable:a,offsetTable:l}}function Ba(r){Math.abs(r)>65504&&console.warn("THREE.DataUtils.toHalfFloat(): Value out of range."),r=hn(r,-65504,65504),Rc.floatView[0]=r;const e=Rc.uint32View[0],t=e>>23&511;return Rc.baseTable[t]+((e&8388607)>>Rc.shiftTable[t])}function Kv(r){const e=r>>10;return Rc.uint32View[0]=Rc.mantissaTable[Rc.offsetTable[e]+(r&1023)]+Rc.exponentTable[e],Rc.floatView[0]}class mz{static toHalfFloat(e){return Ba(e)}static fromHalfFloat(e){return Kv(e)}}const Ds=new Y,Qx=new Xe;let gz=0;class Kn{constructor(e,t,n=!1){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:gz++}),this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=n,this.usage=Fg,this.updateRanges=[],this.gpuType=Ri,this.version=0}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this.gpuType=e.gpuType,this}copyAt(e,t,n){e*=this.itemSize,n*=t.itemSize;for(let i=0,s=this.itemSize;i<s;i++)this.array[e+i]=t.array[n+i];return this}copyArray(e){return this.array.set(e),this}applyMatrix3(e){if(this.itemSize===2)for(let t=0,n=this.count;t<n;t++)Qx.fromBufferAttribute(this,t),Qx.applyMatrix3(e),this.setXY(t,Qx.x,Qx.y);else if(this.itemSize===3)for(let t=0,n=this.count;t<n;t++)Ds.fromBufferAttribute(this,t),Ds.applyMatrix3(e),this.setXYZ(t,Ds.x,Ds.y,Ds.z);return this}applyMatrix4(e){for(let t=0,n=this.count;t<n;t++)Ds.fromBufferAttribute(this,t),Ds.applyMatrix4(e),this.setXYZ(t,Ds.x,Ds.y,Ds.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)Ds.fromBufferAttribute(this,t),Ds.applyNormalMatrix(e),this.setXYZ(t,Ds.x,Ds.y,Ds.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)Ds.fromBufferAttribute(this,t),Ds.transformDirection(e),this.setXYZ(t,Ds.x,Ds.y,Ds.z);return this}set(e,t=0){return this.array.set(e,t),this}getComponent(e,t){let n=this.array[e*this.itemSize+t];return this.normalized&&(n=ha(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=yn(n,this.array)),this.array[e*this.itemSize+t]=n,this}getX(e){let t=this.array[e*this.itemSize];return this.normalized&&(t=ha(t,this.array)),t}setX(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize]=t,this}getY(e){let t=this.array[e*this.itemSize+1];return this.normalized&&(t=ha(t,this.array)),t}setY(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize+1]=t,this}getZ(e){let t=this.array[e*this.itemSize+2];return this.normalized&&(t=ha(t,this.array)),t}setZ(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize+2]=t,this}getW(e){let t=this.array[e*this.itemSize+3];return this.normalized&&(t=ha(t,this.array)),t}setW(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize+3]=t,this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=yn(t,this.array),n=yn(n,this.array)),this.array[e+0]=t,this.array[e+1]=n,this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=yn(t,this.array),n=yn(n,this.array),i=yn(i,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=yn(t,this.array),n=yn(n,this.array),i=yn(i,this.array),s=yn(s,this.array)),this.array[e+0]=t,this.array[e+1]=n,this.array[e+2]=i,this.array[e+3]=s,this}onUpload(e){return this.onUploadCallback=e,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const e={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(e.name=this.name),this.usage!==Fg&&(e.usage=this.usage),e}}class yz extends Kn{constructor(e,t,n){super(new Int8Array(e),t,n)}}class vz extends Kn{constructor(e,t,n){super(new Uint8Array(e),t,n)}}class _z extends Kn{constructor(e,t,n){super(new Uint8ClampedArray(e),t,n)}}class xz extends Kn{constructor(e,t,n){super(new Int16Array(e),t,n)}}class oT extends Kn{constructor(e,t,n){super(new Uint16Array(e),t,n)}}class Sz extends Kn{constructor(e,t,n){super(new Int32Array(e),t,n)}}class lT extends Kn{constructor(e,t,n){super(new Uint32Array(e),t,n)}}class z1 extends Kn{constructor(e,t,n){super(new Uint16Array(e),t,n),this.isFloat16BufferAttribute=!0}getX(e){let t=Kv(this.array[e*this.itemSize]);return this.normalized&&(t=ha(t,this.array)),t}setX(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize]=Ba(t),this}getY(e){let t=Kv(this.array[e*this.itemSize+1]);return this.normalized&&(t=ha(t,this.array)),t}setY(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize+1]=Ba(t),this}getZ(e){let t=Kv(this.array[e*this.itemSize+2]);return this.normalized&&(t=ha(t,this.array)),t}setZ(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize+2]=Ba(t),this}getW(e){let t=Kv(this.array[e*this.itemSize+3]);return this.normalized&&(t=ha(t,this.array)),t}setW(e,t){return this.normalized&&(t=yn(t,this.array)),this.array[e*this.itemSize+3]=Ba(t),this}setXY(e,t,n){return e*=this.itemSize,this.normalized&&(t=yn(t,this.array),n=yn(n,this.array)),this.array[e+0]=Ba(t),this.array[e+1]=Ba(n),this}setXYZ(e,t,n,i){return e*=this.itemSize,this.normalized&&(t=yn(t,this.array),n=yn(n,this.array),i=yn(i,this.array)),this.array[e+0]=Ba(t),this.array[e+1]=Ba(n),this.array[e+2]=Ba(i),this}setXYZW(e,t,n,i,s){return e*=this.itemSize,this.normalized&&(t=yn(t,this.array),n=yn(n,this.array),i=yn(i,this.array),s=yn(s,this.array)),this.array[e+0]=Ba(t),this.array[e+1]=Ba(n),this.array[e+2]=Ba(i),this.array[e+3]=Ba(s),this}}class Et extends Kn{constructor(e,t,n){super(new Float32Array(e),t,n)}}let bz=0;const qo=new Mt,cE=new Hn,Gm=new Y,mo=new ga,Rv=new ga,ir=new Y;class fn extends bo{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:bz++}),this.uuid=So(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(e){return Array.isArray(e)?this.index=new(I1(e)?lT:oT)(e,1):this.index=e,this}setIndirect(e){return this.indirect=e,this}getIndirect(){return this.indirect}getAttribute(e){return this.attributes[e]}setAttribute(e,t){return this.attributes[e]=t,this}deleteAttribute(e){return delete this.attributes[e],this}hasAttribute(e){return this.attributes[e]!==void 0}addGroup(e,t,n=0){this.groups.push({start:e,count:t,materialIndex:n})}clearGroups(){this.groups=[]}setDrawRange(e,t){this.drawRange.start=e,this.drawRange.count=t}applyMatrix4(e){const t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);const n=this.attributes.normal;if(n!==void 0){const s=new Qt().getNormalMatrix(e);n.applyNormalMatrix(s),n.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(e),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(e){return qo.makeRotationFromQuaternion(e),this.applyMatrix4(qo),this}rotateX(e){return qo.makeRotationX(e),this.applyMatrix4(qo),this}rotateY(e){return qo.makeRotationY(e),this.applyMatrix4(qo),this}rotateZ(e){return qo.makeRotationZ(e),this.applyMatrix4(qo),this}translate(e,t,n){return qo.makeTranslation(e,t,n),this.applyMatrix4(qo),this}scale(e,t,n){return qo.makeScale(e,t,n),this.applyMatrix4(qo),this}lookAt(e){return cE.lookAt(e),cE.updateMatrix(),this.applyMatrix4(cE.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(Gm).negate(),this.translate(Gm.x,Gm.y,Gm.z),this}setFromPoints(e){const t=this.getAttribute("position");if(t===void 0){const n=[];for(let i=0,s=e.length;i<s;i++){const a=e[i];n.push(a.x,a.y,a.z||0)}this.setAttribute("position",new Et(n,3))}else{const n=Math.min(e.length,t.count);for(let i=0;i<n;i++){const s=e[i];t.setXYZ(i,s.x,s.y,s.z||0)}e.length>t.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),t.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ga);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new Y(-1/0,-1/0,-1/0),new Y(1/0,1/0,1/0));return}if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(let n=0,i=t.length;n<i;n++){const s=t[n];mo.setFromBufferAttribute(s),this.morphTargetsRelative?(ir.addVectors(this.boundingBox.min,mo.min),this.boundingBox.expandByPoint(ir),ir.addVectors(this.boundingBox.max,mo.max),this.boundingBox.expandByPoint(ir)):(this.boundingBox.expandByPoint(mo.min),this.boundingBox.expandByPoint(mo.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new br);const e=this.attributes.position,t=this.morphAttributes.position;if(e&&e.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new Y,1/0);return}if(e){const n=this.boundingSphere.center;if(mo.setFromBufferAttribute(e),t)for(let s=0,a=t.length;s<a;s++){const l=t[s];Rv.setFromBufferAttribute(l),this.morphTargetsRelative?(ir.addVectors(mo.min,Rv.min),mo.expandByPoint(ir),ir.addVectors(mo.max,Rv.max),mo.expandByPoint(ir)):(mo.expandByPoint(Rv.min),mo.expandByPoint(Rv.max))}mo.getCenter(n);let i=0;for(let s=0,a=e.count;s<a;s++)ir.fromBufferAttribute(e,s),i=Math.max(i,n.distanceToSquared(ir));if(t)for(let s=0,a=t.length;s<a;s++){const l=t[s],c=this.morphTargetsRelative;for(let d=0,m=l.count;d<m;d++)ir.fromBufferAttribute(l,d),c&&(Gm.fromBufferAttribute(e,d),ir.add(Gm)),i=Math.max(i,n.distanceToSquared(ir))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const e=this.index,t=this.attributes;if(e===null||t.position===void 0||t.normal===void 0||t.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const n=t.position,i=t.normal,s=t.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new Kn(new Float32Array(4*n.count),4));const a=this.getAttribute("tangent"),l=[],c=[];for(let H=0;H<n.count;H++)l[H]=new Y,c[H]=new Y;const d=new Y,m=new Y,y=new Y,v=new Xe,x=new Xe,S=new Xe,A=new Y,E=new Y;function M(H,I,P){d.fromBufferAttribute(n,H),m.fromBufferAttribute(n,I),y.fromBufferAttribute(n,P),v.fromBufferAttribute(s,H),x.fromBufferAttribute(s,I),S.fromBufferAttribute(s,P),m.sub(d),y.sub(d),x.sub(v),S.sub(v);const Z=1/(x.x*S.y-S.x*x.y);isFinite(Z)&&(A.copy(m).multiplyScalar(S.y).addScaledVector(y,-x.y).multiplyScalar(Z),E.copy(y).multiplyScalar(x.x).addScaledVector(m,-S.x).multiplyScalar(Z),l[H].add(A),l[I].add(A),l[P].add(A),c[H].add(E),c[I].add(E),c[P].add(E))}let C=this.groups;C.length===0&&(C=[{start:0,count:e.count}]);for(let H=0,I=C.length;H<I;++H){const P=C[H],Z=P.start,ue=P.count;for(let se=Z,pe=Z+ue;se<pe;se+=3)M(e.getX(se+0),e.getX(se+1),e.getX(se+2))}const w=new Y,D=new Y,z=new Y,B=new Y;function F(H){z.fromBufferAttribute(i,H),B.copy(z);const I=l[H];w.copy(I),w.sub(z.multiplyScalar(z.dot(I))).normalize(),D.crossVectors(B,I);const Z=D.dot(c[H])<0?-1:1;a.setXYZW(H,w.x,w.y,w.z,Z)}for(let H=0,I=C.length;H<I;++H){const P=C[H],Z=P.start,ue=P.count;for(let se=Z,pe=Z+ue;se<pe;se+=3)F(e.getX(se+0)),F(e.getX(se+1)),F(e.getX(se+2))}}computeVertexNormals(){const e=this.index,t=this.getAttribute("position");if(t!==void 0){let n=this.getAttribute("normal");if(n===void 0)n=new Kn(new Float32Array(t.count*3),3),this.setAttribute("normal",n);else for(let v=0,x=n.count;v<x;v++)n.setXYZ(v,0,0,0);const i=new Y,s=new Y,a=new Y,l=new Y,c=new Y,d=new Y,m=new Y,y=new Y;if(e)for(let v=0,x=e.count;v<x;v+=3){const S=e.getX(v+0),A=e.getX(v+1),E=e.getX(v+2);i.fromBufferAttribute(t,S),s.fromBufferAttribute(t,A),a.fromBufferAttribute(t,E),m.subVectors(a,s),y.subVectors(i,s),m.cross(y),l.fromBufferAttribute(n,S),c.fromBufferAttribute(n,A),d.fromBufferAttribute(n,E),l.add(m),c.add(m),d.add(m),n.setXYZ(S,l.x,l.y,l.z),n.setXYZ(A,c.x,c.y,c.z),n.setXYZ(E,d.x,d.y,d.z)}else for(let v=0,x=t.count;v<x;v+=3)i.fromBufferAttribute(t,v+0),s.fromBufferAttribute(t,v+1),a.fromBufferAttribute(t,v+2),m.subVectors(a,s),y.subVectors(i,s),m.cross(y),n.setXYZ(v+0,m.x,m.y,m.z),n.setXYZ(v+1,m.x,m.y,m.z),n.setXYZ(v+2,m.x,m.y,m.z);this.normalizeNormals(),n.needsUpdate=!0}}normalizeNormals(){const e=this.attributes.normal;for(let t=0,n=e.count;t<n;t++)ir.fromBufferAttribute(e,t),ir.normalize(),e.setXYZ(t,ir.x,ir.y,ir.z)}toNonIndexed(){function e(l,c){const d=l.array,m=l.itemSize,y=l.normalized,v=new d.constructor(c.length*m);let x=0,S=0;for(let A=0,E=c.length;A<E;A++){l.isInterleavedBufferAttribute?x=c[A]*l.data.stride+l.offset:x=c[A]*m;for(let M=0;M<m;M++)v[S++]=d[x++]}return new Kn(v,m,y)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const t=new fn,n=this.index.array,i=this.attributes;for(const l in i){const c=i[l],d=e(c,n);t.setAttribute(l,d)}const s=this.morphAttributes;for(const l in s){const c=[],d=s[l];for(let m=0,y=d.length;m<y;m++){const v=d[m],x=e(v,n);c.push(x)}t.morphAttributes[l]=c}t.morphTargetsRelative=this.morphTargetsRelative;const a=this.groups;for(let l=0,c=a.length;l<c;l++){const d=a[l];t.addGroup(d.start,d.count,d.materialIndex)}return t}toJSON(){const e={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),Object.keys(this.userData).length>0&&(e.userData=this.userData),this.parameters!==void 0){const c=this.parameters;for(const d in c)c[d]!==void 0&&(e[d]=c[d]);return e}e.data={attributes:{}};const t=this.index;t!==null&&(e.data.index={type:t.array.constructor.name,array:Array.prototype.slice.call(t.array)});const n=this.attributes;for(const c in n){const d=n[c];e.data.attributes[c]=d.toJSON(e.data)}const i={};let s=!1;for(const c in this.morphAttributes){const d=this.morphAttributes[c],m=[];for(let y=0,v=d.length;y<v;y++){const x=d[y];m.push(x.toJSON(e.data))}m.length>0&&(i[c]=m,s=!0)}s&&(e.data.morphAttributes=i,e.data.morphTargetsRelative=this.morphTargetsRelative);const a=this.groups;a.length>0&&(e.data.groups=JSON.parse(JSON.stringify(a)));const l=this.boundingSphere;return l!==null&&(e.data.boundingSphere={center:l.center.toArray(),radius:l.radius}),e}clone(){return new this.constructor().copy(this)}copy(e){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const t={};this.name=e.name;const n=e.index;n!==null&&this.setIndex(n.clone());const i=e.attributes;for(const d in i){const m=i[d];this.setAttribute(d,m.clone(t))}const s=e.morphAttributes;for(const d in s){const m=[],y=s[d];for(let v=0,x=y.length;v<x;v++)m.push(y[v].clone(t));this.morphAttributes[d]=m}this.morphTargetsRelative=e.morphTargetsRelative;const a=e.groups;for(let d=0,m=a.length;d<m;d++){const y=a[d];this.addGroup(y.start,y.count,y.materialIndex)}const l=e.boundingBox;l!==null&&(this.boundingBox=l.clone());const c=e.boundingSphere;return c!==null&&(this.boundingSphere=c.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}const YC=new Mt,fd=new $g,Jx=new br,jC=new Y,$x=new Y,eS=new Y,tS=new Y,hE=new Y,nS=new Y,ZC=new Y,iS=new Y;class bi extends Hn{constructor(e=new fn,t=new fa){super(),this.isMesh=!0,this.type="Mesh",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const l=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}getVertexPosition(e,t){const n=this.geometry,i=n.attributes.position,s=n.morphAttributes.position,a=n.morphTargetsRelative;t.fromBufferAttribute(i,e);const l=this.morphTargetInfluences;if(s&&l){nS.set(0,0,0);for(let c=0,d=s.length;c<d;c++){const m=l[c],y=s[c];m!==0&&(hE.fromBufferAttribute(y,e),a?nS.addScaledVector(hE,m):nS.addScaledVector(hE.sub(t),m))}t.add(nS)}return t}raycast(e,t){const n=this.geometry,i=this.material,s=this.matrixWorld;i!==void 0&&(n.boundingSphere===null&&n.computeBoundingSphere(),Jx.copy(n.boundingSphere),Jx.applyMatrix4(s),fd.copy(e.ray).recast(e.near),!(Jx.containsPoint(fd.origin)===!1&&(fd.intersectSphere(Jx,jC)===null||fd.origin.distanceToSquared(jC)>(e.far-e.near)**2))&&(YC.copy(s).invert(),fd.copy(e.ray).applyMatrix4(YC),!(n.boundingBox!==null&&fd.intersectsBox(n.boundingBox)===!1)&&this._computeIntersections(e,t,fd)))}_computeIntersections(e,t,n){let i;const s=this.geometry,a=this.material,l=s.index,c=s.attributes.position,d=s.attributes.uv,m=s.attributes.uv1,y=s.attributes.normal,v=s.groups,x=s.drawRange;if(l!==null)if(Array.isArray(a))for(let S=0,A=v.length;S<A;S++){const E=v[S],M=a[E.materialIndex],C=Math.max(E.start,x.start),w=Math.min(l.count,Math.min(E.start+E.count,x.start+x.count));for(let D=C,z=w;D<z;D+=3){const B=l.getX(D),F=l.getX(D+1),H=l.getX(D+2);i=sS(this,M,e,n,d,m,y,B,F,H),i&&(i.faceIndex=Math.floor(D/3),i.face.materialIndex=E.materialIndex,t.push(i))}}else{const S=Math.max(0,x.start),A=Math.min(l.count,x.start+x.count);for(let E=S,M=A;E<M;E+=3){const C=l.getX(E),w=l.getX(E+1),D=l.getX(E+2);i=sS(this,a,e,n,d,m,y,C,w,D),i&&(i.faceIndex=Math.floor(E/3),t.push(i))}}else if(c!==void 0)if(Array.isArray(a))for(let S=0,A=v.length;S<A;S++){const E=v[S],M=a[E.materialIndex],C=Math.max(E.start,x.start),w=Math.min(c.count,Math.min(E.start+E.count,x.start+x.count));for(let D=C,z=w;D<z;D+=3){const B=D,F=D+1,H=D+2;i=sS(this,M,e,n,d,m,y,B,F,H),i&&(i.faceIndex=Math.floor(D/3),i.face.materialIndex=E.materialIndex,t.push(i))}}else{const S=Math.max(0,x.start),A=Math.min(c.count,x.start+x.count);for(let E=S,M=A;E<M;E+=3){const C=E,w=E+1,D=E+2;i=sS(this,a,e,n,d,m,y,C,w,D),i&&(i.faceIndex=Math.floor(E/3),t.push(i))}}}}function Tz(r,e,t,n,i,s,a,l){let c;if(e.side===Ti?c=n.intersectTriangle(a,s,i,!0,l):c=n.intersectTriangle(i,s,a,e.side===pa,l),c===null)return null;iS.copy(l),iS.applyMatrix4(r.matrixWorld);const d=t.ray.origin.distanceTo(iS);return d<t.near||d>t.far?null:{distance:d,point:iS.clone(),object:r}}function sS(r,e,t,n,i,s,a,l,c,d){r.getVertexPosition(l,$x),r.getVertexPosition(c,eS),r.getVertexPosition(d,tS);const m=Tz(r,e,t,n,$x,eS,tS,ZC);if(m){const y=new Y;Fa.getBarycoord(ZC,$x,eS,tS,y),i&&(m.uv=Fa.getInterpolatedAttribute(i,l,c,d,y,new Xe)),s&&(m.uv1=Fa.getInterpolatedAttribute(s,l,c,d,y,new Xe)),a&&(m.normal=Fa.getInterpolatedAttribute(a,l,c,d,y,new Y),m.normal.dot(n.direction)>0&&m.normal.multiplyScalar(-1));const v={a:l,b:c,c:d,normal:new Y,materialIndex:0};Fa.getNormal($x,eS,tS,v.normal),m.face=v,m.barycoord=y}return m}class Hc extends fn{constructor(e=1,t=1,n=1,i=1,s=1,a=1){super(),this.type="BoxGeometry",this.parameters={width:e,height:t,depth:n,widthSegments:i,heightSegments:s,depthSegments:a};const l=this;i=Math.floor(i),s=Math.floor(s),a=Math.floor(a);const c=[],d=[],m=[],y=[];let v=0,x=0;S("z","y","x",-1,-1,n,t,e,a,s,0),S("z","y","x",1,-1,n,t,-e,a,s,1),S("x","z","y",1,1,e,n,t,i,a,2),S("x","z","y",1,-1,e,n,-t,i,a,3),S("x","y","z",1,-1,e,t,n,i,s,4),S("x","y","z",-1,-1,e,t,-n,i,s,5),this.setIndex(c),this.setAttribute("position",new Et(d,3)),this.setAttribute("normal",new Et(m,3)),this.setAttribute("uv",new Et(y,2));function S(A,E,M,C,w,D,z,B,F,H,I){const P=D/F,Z=z/H,ue=D/2,se=z/2,pe=B/2,Se=F+1,V=H+1;let Q=0,J=0;const ve=new Y;for(let X=0;X<V;X++){const re=X*Z-se;for(let we=0;we<Se;we++){const Fe=we*P-ue;ve[A]=Fe*C,ve[E]=re*w,ve[M]=pe,d.push(ve.x,ve.y,ve.z),ve[A]=0,ve[E]=0,ve[M]=B>0?1:-1,m.push(ve.x,ve.y,ve.z),y.push(we/F),y.push(1-X/H),Q+=1}}for(let X=0;X<H;X++)for(let re=0;re<F;re++){const we=v+re+Se*X,Fe=v+re+Se*(X+1),oe=v+(re+1)+Se*(X+1),De=v+(re+1)+Se*X;c.push(we,Fe,De),c.push(Fe,oe,De),J+=6}l.addGroup(x,J,I),x+=J,v+=Q}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Hc(e.width,e.height,e.depth,e.widthSegments,e.heightSegments,e.depthSegments)}}function Vg(r){const e={};for(const t in r){e[t]={};for(const n in r[t]){const i=r[t][n];i&&(i.isColor||i.isMatrix3||i.isMatrix4||i.isVector2||i.isVector3||i.isVector4||i.isTexture||i.isQuaternion)?i.isRenderTargetTexture?(console.warn("UniformsUtils: Textures of render targets cannot be cloned via cloneUniforms() or mergeUniforms()."),e[t][n]=null):e[t][n]=i.clone():Array.isArray(i)?e[t][n]=i.slice():e[t][n]=i}}return e}function la(r){const e={};for(let t=0;t<r.length;t++){const n=Vg(r[t]);for(const i in n)e[i]=n[i]}return e}function Mz(r){const e=[];for(let t=0;t<r.length;t++)e.push(r[t].clone());return e}function TU(r){const e=r.getRenderTarget();return e===null?r.outputColorSpace:e.isXRRenderTarget===!0?e.texture.colorSpace:on.workingColorSpace}const MU={clone:Vg,merge:la};var Ez=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,Az=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;class Hl extends ar{constructor(e){super(),this.isShaderMaterial=!0,this.type="ShaderMaterial",this.defines={},this.uniforms={},this.uniformsGroups=[],this.vertexShader=Ez,this.fragmentShader=Az,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.forceSinglePass=!0,this.extensions={clipCullDistance:!1,multiDraw:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv1:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,this.glslVersion=null,e!==void 0&&this.setValues(e)}copy(e){return super.copy(e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Vg(e.uniforms),this.uniformsGroups=Mz(e.uniformsGroups),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.fog=e.fog,this.lights=e.lights,this.clipping=e.clipping,this.extensions=Object.assign({},e.extensions),this.glslVersion=e.glslVersion,this}toJSON(e){const t=super.toJSON(e);t.glslVersion=this.glslVersion,t.uniforms={};for(const i in this.uniforms){const a=this.uniforms[i].value;a&&a.isTexture?t.uniforms[i]={type:"t",value:a.toJSON(e).uuid}:a&&a.isColor?t.uniforms[i]={type:"c",value:a.getHex()}:a&&a.isVector2?t.uniforms[i]={type:"v2",value:a.toArray()}:a&&a.isVector3?t.uniforms[i]={type:"v3",value:a.toArray()}:a&&a.isVector4?t.uniforms[i]={type:"v4",value:a.toArray()}:a&&a.isMatrix3?t.uniforms[i]={type:"m3",value:a.toArray()}:a&&a.isMatrix4?t.uniforms[i]={type:"m4",value:a.toArray()}:t.uniforms[i]={value:a}}Object.keys(this.defines).length>0&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader,t.lights=this.lights,t.clipping=this.clipping;const n={};for(const i in this.extensions)this.extensions[i]===!0&&(n[i]=!0);return Object.keys(n).length>0&&(t.extensions=n),t}}class X_ extends Hn{constructor(){super(),this.isCamera=!0,this.type="Camera",this.matrixWorldInverse=new Mt,this.projectionMatrix=new Mt,this.projectionMatrixInverse=new Mt,this.coordinateSystem=zr}copy(e,t){return super.copy(e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this.coordinateSystem=e.coordinateSystem,this}getWorldDirection(e){return super.getWorldDirection(e).negate()}updateMatrixWorld(e){super.updateMatrixWorld(e),this.matrixWorldInverse.copy(this.matrixWorld).invert()}updateWorldMatrix(e,t){super.updateWorldMatrix(e,t),this.matrixWorldInverse.copy(this.matrixWorld).invert()}clone(){return new this.constructor().copy(this)}}const Hh=new Y,KC=new Xe,QC=new Xe;let us=class extends X_{constructor(e=50,t=1,n=.1,i=2e3){super(),this.isPerspectiveCamera=!0,this.type="PerspectiveCamera",this.fov=e,this.zoom=1,this.near=n,this.far=i,this.focus=10,this.aspect=t,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this}setFocalLength(e){const t=.5*this.getFilmHeight()/e;this.fov=fp*2*Math.atan(t),this.updateProjectionMatrix()}getFocalLength(){const e=Math.tan(Gd*.5*this.fov);return .5*this.getFilmHeight()/e}getEffectiveFOV(){return fp*2*Math.atan(Math.tan(Gd*.5*this.fov)/this.zoom)}getFilmWidth(){return this.filmGauge*Math.min(this.aspect,1)}getFilmHeight(){return this.filmGauge/Math.max(this.aspect,1)}getViewBounds(e,t,n){Hh.set(-1,-1,.5).applyMatrix4(this.projectionMatrixInverse),t.set(Hh.x,Hh.y).multiplyScalar(-e/Hh.z),Hh.set(1,1,.5).applyMatrix4(this.projectionMatrixInverse),n.set(Hh.x,Hh.y).multiplyScalar(-e/Hh.z)}getViewSize(e,t){return this.getViewBounds(e,KC,QC),t.subVectors(QC,KC)}setViewOffset(e,t,n,i,s,a){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=this.near;let t=e*Math.tan(Gd*.5*this.fov)/this.zoom,n=2*t,i=this.aspect*n,s=-.5*i;const a=this.view;if(this.view!==null&&this.view.enabled){const c=a.fullWidth,d=a.fullHeight;s+=a.offsetX*i/c,t-=a.offsetY*n/d,i*=a.width/c,n*=a.height/d}const l=this.filmOffset;l!==0&&(s+=e*l/this.getFilmWidth()),this.projectionMatrix.makePerspective(s,s+i,t,t-n,e,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}};const Hm=-90,km=1;class V1 extends Hn{constructor(e,t,n){super(),this.type="CubeCamera",this.renderTarget=n,this.coordinateSystem=null,this.activeMipmapLevel=0;const i=new us(Hm,km,e,t);i.layers=this.layers,this.add(i);const s=new us(Hm,km,e,t);s.layers=this.layers,this.add(s);const a=new us(Hm,km,e,t);a.layers=this.layers,this.add(a);const l=new us(Hm,km,e,t);l.layers=this.layers,this.add(l);const c=new us(Hm,km,e,t);c.layers=this.layers,this.add(c);const d=new us(Hm,km,e,t);d.layers=this.layers,this.add(d)}updateCoordinateSystem(){const e=this.coordinateSystem,t=this.children.concat(),[n,i,s,a,l,c]=t;for(const d of t)this.remove(d);if(e===zr)n.up.set(0,1,0),n.lookAt(1,0,0),i.up.set(0,1,0),i.lookAt(-1,0,0),s.up.set(0,0,-1),s.lookAt(0,1,0),a.up.set(0,0,1),a.lookAt(0,-1,0),l.up.set(0,1,0),l.lookAt(0,0,1),c.up.set(0,1,0),c.lookAt(0,0,-1);else if(e===Vl)n.up.set(0,-1,0),n.lookAt(-1,0,0),i.up.set(0,-1,0),i.lookAt(1,0,0),s.up.set(0,0,1),s.lookAt(0,1,0),a.up.set(0,0,-1),a.lookAt(0,-1,0),l.up.set(0,-1,0),l.lookAt(0,0,1),c.up.set(0,-1,0),c.lookAt(0,0,-1);else throw new Error("THREE.CubeCamera.updateCoordinateSystem(): Invalid coordinate system: "+e);for(const d of t)this.add(d),d.updateMatrixWorld()}update(e,t){this.parent===null&&this.updateMatrixWorld();const{renderTarget:n,activeMipmapLevel:i}=this;this.coordinateSystem!==e.coordinateSystem&&(this.coordinateSystem=e.coordinateSystem,this.updateCoordinateSystem());const[s,a,l,c,d,m]=this.children,y=e.getRenderTarget(),v=e.getActiveCubeFace(),x=e.getActiveMipmapLevel(),S=e.xr.enabled;e.xr.enabled=!1;const A=n.texture.generateMipmaps;n.texture.generateMipmaps=!1,e.setRenderTarget(n,0,i),e.render(t,s),e.setRenderTarget(n,1,i),e.render(t,a),e.setRenderTarget(n,2,i),e.render(t,l),e.setRenderTarget(n,3,i),e.render(t,c),e.setRenderTarget(n,4,i),e.render(t,d),n.texture.generateMipmaps=A,e.setRenderTarget(n,5,i),e.render(t,m),e.setRenderTarget(y,v,x),e.xr.enabled=S,n.texture.needsPMREMUpdate=!0}}class _p extends Li{constructor(e=[],t=va,n,i,s,a,l,c,d,m){super(e,t,n,i,s,a,l,c,d,m),this.isCubeTexture=!0,this.flipY=!1}get images(){return this.image}set images(e){this.image=e}}class G1 extends Gl{constructor(e=1,t={}){super(e,e,t),this.isWebGLCubeRenderTarget=!0;const n={width:e,height:e,depth:1},i=[n,n,n,n,n,n];this.texture=new _p(i,t.mapping,t.wrapS,t.wrapT,t.magFilter,t.minFilter,t.format,t.type,t.anisotropy,t.colorSpace),this.texture.isRenderTargetTexture=!0,this.texture.generateMipmaps=t.generateMipmaps!==void 0?t.generateMipmaps:!1,this.texture.minFilter=t.minFilter!==void 0?t.minFilter:Zn}fromEquirectangularTexture(e,t){this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const n={uniforms:{tEquirect:{value:null}},vertexShader:`

				varying vec3 vWorldDirection;

				vec3 transformDirection( in vec3 dir, in mat4 matrix ) {

					return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );

				}

				void main() {

					vWorldDirection = transformDirection( position, modelMatrix );

					#include <begin_vertex>
					#include <project_vertex>

				}
			`,fragmentShader:`

				uniform sampler2D tEquirect;

				varying vec3 vWorldDirection;

				#include <common>

				void main() {

					vec3 direction = normalize( vWorldDirection );

					vec2 sampleUV = equirectUv( direction );

					gl_FragColor = texture2D( tEquirect, sampleUV );

				}
			`},i=new Hc(5,5,5),s=new Hl({name:"CubemapFromEquirect",uniforms:Vg(n.uniforms),vertexShader:n.vertexShader,fragmentShader:n.fragmentShader,side:Ti,blending:Ga});s.uniforms.tEquirect.value=t;const a=new bi(i,s),l=t.minFilter;return t.minFilter===xr&&(t.minFilter=Zn),new V1(1,10,this).update(e,a),t.minFilter=l,a.geometry.dispose(),a.material.dispose(),this}clear(e,t=!0,n=!0,i=!0){const s=e.getRenderTarget();for(let a=0;a<6;a++)e.setRenderTarget(this,a),e.clear(t,n,i);e.setRenderTarget(s)}}class cg extends Hn{constructor(){super(),this.isGroup=!0,this.type="Group"}}const Rz={type:"move"};class i_{constructor(){this._targetRay=null,this._grip=null,this._hand=null}getHandSpace(){return this._hand===null&&(this._hand=new cg,this._hand.matrixAutoUpdate=!1,this._hand.visible=!1,this._hand.joints={},this._hand.inputState={pinching:!1}),this._hand}getTargetRaySpace(){return this._targetRay===null&&(this._targetRay=new cg,this._targetRay.matrixAutoUpdate=!1,this._targetRay.visible=!1,this._targetRay.hasLinearVelocity=!1,this._targetRay.linearVelocity=new Y,this._targetRay.hasAngularVelocity=!1,this._targetRay.angularVelocity=new Y),this._targetRay}getGripSpace(){return this._grip===null&&(this._grip=new cg,this._grip.matrixAutoUpdate=!1,this._grip.visible=!1,this._grip.hasLinearVelocity=!1,this._grip.linearVelocity=new Y,this._grip.hasAngularVelocity=!1,this._grip.angularVelocity=new Y),this._grip}dispatchEvent(e){return this._targetRay!==null&&this._targetRay.dispatchEvent(e),this._grip!==null&&this._grip.dispatchEvent(e),this._hand!==null&&this._hand.dispatchEvent(e),this}connect(e){if(e&&e.hand){const t=this._hand;if(t)for(const n of e.hand.values())this._getHandJoint(t,n)}return this.dispatchEvent({type:"connected",data:e}),this}disconnect(e){return this.dispatchEvent({type:"disconnected",data:e}),this._targetRay!==null&&(this._targetRay.visible=!1),this._grip!==null&&(this._grip.visible=!1),this._hand!==null&&(this._hand.visible=!1),this}update(e,t,n){let i=null,s=null,a=null;const l=this._targetRay,c=this._grip,d=this._hand;if(e&&t.session.visibilityState!=="visible-blurred"){if(d&&e.hand){a=!0;for(const A of e.hand.values()){const E=t.getJointPose(A,n),M=this._getHandJoint(d,A);E!==null&&(M.matrix.fromArray(E.transform.matrix),M.matrix.decompose(M.position,M.rotation,M.scale),M.matrixWorldNeedsUpdate=!0,M.jointRadius=E.radius),M.visible=E!==null}const m=d.joints["index-finger-tip"],y=d.joints["thumb-tip"],v=m.position.distanceTo(y.position),x=.02,S=.005;d.inputState.pinching&&v>x+S?(d.inputState.pinching=!1,this.dispatchEvent({type:"pinchend",handedness:e.handedness,target:this})):!d.inputState.pinching&&v<=x-S&&(d.inputState.pinching=!0,this.dispatchEvent({type:"pinchstart",handedness:e.handedness,target:this}))}else c!==null&&e.gripSpace&&(s=t.getPose(e.gripSpace,n),s!==null&&(c.matrix.fromArray(s.transform.matrix),c.matrix.decompose(c.position,c.rotation,c.scale),c.matrixWorldNeedsUpdate=!0,s.linearVelocity?(c.hasLinearVelocity=!0,c.linearVelocity.copy(s.linearVelocity)):c.hasLinearVelocity=!1,s.angularVelocity?(c.hasAngularVelocity=!0,c.angularVelocity.copy(s.angularVelocity)):c.hasAngularVelocity=!1));l!==null&&(i=t.getPose(e.targetRaySpace,n),i===null&&s!==null&&(i=s),i!==null&&(l.matrix.fromArray(i.transform.matrix),l.matrix.decompose(l.position,l.rotation,l.scale),l.matrixWorldNeedsUpdate=!0,i.linearVelocity?(l.hasLinearVelocity=!0,l.linearVelocity.copy(i.linearVelocity)):l.hasLinearVelocity=!1,i.angularVelocity?(l.hasAngularVelocity=!0,l.angularVelocity.copy(i.angularVelocity)):l.hasAngularVelocity=!1,this.dispatchEvent(Rz)))}return l!==null&&(l.visible=i!==null),c!==null&&(c.visible=s!==null),d!==null&&(d.visible=a!==null),this}_getHandJoint(e,t){if(e.joints[t.jointName]===void 0){const n=new cg;n.matrixAutoUpdate=!1,n.visible=!1,e.joints[t.jointName]=n,e.add(n)}return e.joints[t.jointName]}}class uT{constructor(e,t=25e-5){this.isFogExp2=!0,this.name="",this.color=new ft(e),this.density=t}clone(){return new uT(this.color,this.density)}toJSON(){return{type:"FogExp2",name:this.name,color:this.color.getHex(),density:this.density}}}class cT{constructor(e,t=1,n=1e3){this.isFog=!0,this.name="",this.color=new ft(e),this.near=t,this.far=n}clone(){return new cT(this.color,this.near,this.far)}toJSON(){return{type:"Fog",name:this.name,color:this.color.getHex(),near:this.near,far:this.far}}}let ey=class extends Hn{constructor(){super(),this.isScene=!0,this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.backgroundBlurriness=0,this.backgroundIntensity=1,this.backgroundRotation=new _a,this.environmentIntensity=1,this.environmentRotation=new _a,this.overrideMaterial=null,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}copy(e,t){return super.copy(e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),this.backgroundBlurriness=e.backgroundBlurriness,this.backgroundIntensity=e.backgroundIntensity,this.backgroundRotation.copy(e.backgroundRotation),this.environmentIntensity=e.environmentIntensity,this.environmentRotation.copy(e.environmentRotation),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.matrixAutoUpdate=e.matrixAutoUpdate,this}toJSON(e){const t=super.toJSON(e);return this.fog!==null&&(t.object.fog=this.fog.toJSON()),this.backgroundBlurriness>0&&(t.object.backgroundBlurriness=this.backgroundBlurriness),this.backgroundIntensity!==1&&(t.object.backgroundIntensity=this.backgroundIntensity),t.object.backgroundRotation=this.backgroundRotation.toArray(),this.environmentIntensity!==1&&(t.object.environmentIntensity=this.environmentIntensity),t.object.environmentRotation=this.environmentRotation.toArray(),t}};class Y_{constructor(e,t){this.isInterleavedBuffer=!0,this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Fg,this.updateRanges=[],this.version=0,this.uuid=So()}onUploadCallback(){}set needsUpdate(e){e===!0&&this.version++}setUsage(e){return this.usage=e,this}addUpdateRange(e,t){this.updateRanges.push({start:e,count:t})}clearUpdateRanges(){this.updateRanges.length=0}copy(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this}copyAt(e,t,n){e*=this.stride,n*=t.stride;for(let i=0,s=this.stride;i<s;i++)this.array[e+i]=t.array[n+i];return this}set(e,t=0){return this.array.set(e,t),this}clone(e){e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=So()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=this.array.slice(0).buffer);const t=new this.array.constructor(e.arrayBuffers[this.array.buffer._uuid]),n=new this.constructor(t,this.stride);return n.setUsage(this.usage),n}onUpload(e){return this.onUploadCallback=e,this}toJSON(e){return e.arrayBuffers===void 0&&(e.arrayBuffers={}),this.array.buffer._uuid===void 0&&(this.array.buffer._uuid=So()),e.arrayBuffers[this.array.buffer._uuid]===void 0&&(e.arrayBuffers[this.array.buffer._uuid]=Array.from(new Uint32Array(this.array.buffer))),{uuid:this.uuid,buffer:this.array.buffer._uuid,type:this.array.constructor.name,stride:this.stride}}}const oa=new Y;class uf{constructor(e,t,n,i=!1){this.isInterleavedBufferAttribute=!0,this.name="",this.data=e,this.itemSize=t,this.offset=n,this.normalized=i}get count(){return this.data.count}get array(){return this.data.array}set needsUpdate(e){this.data.needsUpdate=e}applyMatrix4(e){for(let t=0,n=this.data.count;t<n;t++)oa.fromBufferAttribute(this,t),oa.applyMatrix4(e),this.setXYZ(t,oa.x,oa.y,oa.z);return this}applyNormalMatrix(e){for(let t=0,n=this.count;t<n;t++)oa.fromBufferAttribute(this,t),oa.applyNormalMatrix(e),this.setXYZ(t,oa.x,oa.y,oa.z);return this}transformDirection(e){for(let t=0,n=this.count;t<n;t++)oa.fromBufferAttribute(this,t),oa.transformDirection(e),this.setXYZ(t,oa.x,oa.y,oa.z);return this}getComponent(e,t){let n=this.array[e*this.data.stride+this.offset+t];return this.normalized&&(n=ha(n,this.array)),n}setComponent(e,t,n){return this.normalized&&(n=yn(n,this.array)),this.data.array[e*this.data.stride+this.offset+t]=n,this}setX(e,t){return this.normalized&&(t=yn(t,this.array)),this.data.array[e*this.data.stride+this.offset]=t,this}setY(e,t){return this.normalized&&(t=yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+1]=t,this}setZ(e,t){return this.normalized&&(t=yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+2]=t,this}setW(e,t){return this.normalized&&(t=yn(t,this.array)),this.data.array[e*this.data.stride+this.offset+3]=t,this}getX(e){let t=this.data.array[e*this.data.stride+this.offset];return this.normalized&&(t=ha(t,this.array)),t}getY(e){let t=this.data.array[e*this.data.stride+this.offset+1];return this.normalized&&(t=ha(t,this.array)),t}getZ(e){let t=this.data.array[e*this.data.stride+this.offset+2];return this.normalized&&(t=ha(t,this.array)),t}getW(e){let t=this.data.array[e*this.data.stride+this.offset+3];return this.normalized&&(t=ha(t,this.array)),t}setXY(e,t,n){return e=e*this.data.stride+this.offset,this.normalized&&(t=yn(t,this.array),n=yn(n,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this}setXYZ(e,t,n,i){return e=e*this.data.stride+this.offset,this.normalized&&(t=yn(t,this.array),n=yn(n,this.array),i=yn(i,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this}setXYZW(e,t,n,i,s){return e=e*this.data.stride+this.offset,this.normalized&&(t=yn(t,this.array),n=yn(n,this.array),i=yn(i,this.array),s=yn(s,this.array)),this.data.array[e+0]=t,this.data.array[e+1]=n,this.data.array[e+2]=i,this.data.array[e+3]=s,this}clone(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.clone(): Cloning an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return new Kn(new this.array.constructor(t),this.itemSize,this.normalized)}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.clone(e)),new uf(e.interleavedBuffers[this.data.uuid],this.itemSize,this.offset,this.normalized)}toJSON(e){if(e===void 0){console.log("THREE.InterleavedBufferAttribute.toJSON(): Serializing an interleaved buffer attribute will de-interleave buffer data.");const t=[];for(let n=0;n<this.count;n++){const i=n*this.data.stride+this.offset;for(let s=0;s<this.itemSize;s++)t.push(this.data.array[i+s])}return{itemSize:this.itemSize,type:this.array.constructor.name,array:t,normalized:this.normalized}}else return e.interleavedBuffers===void 0&&(e.interleavedBuffers={}),e.interleavedBuffers[this.data.uuid]===void 0&&(e.interleavedBuffers[this.data.uuid]=this.data.toJSON(e)),{isInterleavedBufferAttribute:!0,itemSize:this.itemSize,data:this.data.uuid,offset:this.offset,normalized:this.normalized}}}class hT extends ar{constructor(e){super(),this.isSpriteMaterial=!0,this.type="SpriteMaterial",this.color=new ft(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}let qm;const Nv=new Y,Wm=new Y,Xm=new Y,Ym=new Xe,Cv=new Xe,EU=new Mt,rS=new Y,wv=new Y,aS=new Y,JC=new Xe,fE=new Xe,$C=new Xe;class AU extends Hn{constructor(e=new hT){if(super(),this.isSprite=!0,this.type="Sprite",qm===void 0){qm=new fn;const t=new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),n=new Y_(t,5);qm.setIndex([0,1,2,0,2,3]),qm.setAttribute("position",new uf(n,3,0,!1)),qm.setAttribute("uv",new uf(n,2,3,!1))}this.geometry=qm,this.material=e,this.center=new Xe(.5,.5)}raycast(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),Wm.setFromMatrixScale(this.matrixWorld),EU.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),Xm.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&Wm.multiplyScalar(-Xm.z);const n=this.material.rotation;let i,s;n!==0&&(s=Math.cos(n),i=Math.sin(n));const a=this.center;oS(rS.set(-.5,-.5,0),Xm,a,Wm,i,s),oS(wv.set(.5,-.5,0),Xm,a,Wm,i,s),oS(aS.set(.5,.5,0),Xm,a,Wm,i,s),JC.set(0,0),fE.set(1,0),$C.set(1,1);let l=e.ray.intersectTriangle(rS,wv,aS,!1,Nv);if(l===null&&(oS(wv.set(-.5,.5,0),Xm,a,Wm,i,s),fE.set(0,1),l=e.ray.intersectTriangle(rS,aS,wv,!1,Nv),l===null))return;const c=e.ray.origin.distanceTo(Nv);c<e.near||c>e.far||t.push({distance:c,point:Nv.clone(),uv:Fa.getInterpolation(Nv,rS,wv,aS,JC,fE,$C,new Xe),face:null,object:this})}copy(e,t){return super.copy(e,t),e.center!==void 0&&this.center.copy(e.center),this.material=e.material,this}}function oS(r,e,t,n,i,s){Ym.subVectors(r,t).addScalar(.5).multiply(n),i!==void 0?(Cv.x=s*Ym.x-i*Ym.y,Cv.y=i*Ym.x+s*Ym.y):Cv.copy(Ym),r.copy(e),r.x+=Cv.x,r.y+=Cv.y,r.applyMatrix4(EU)}const lS=new Y,ew=new Y;class RU extends Hn{constructor(){super(),this.isLOD=!0,this._currentLevel=0,this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}copy(e){super.copy(e,!1);const t=e.levels;for(let n=0,i=t.length;n<i;n++){const s=t[n];this.addLevel(s.object.clone(),s.distance,s.hysteresis)}return this.autoUpdate=e.autoUpdate,this}addLevel(e,t=0,n=0){t=Math.abs(t);const i=this.levels;let s;for(s=0;s<i.length&&!(t<i[s].distance);s++);return i.splice(s,0,{distance:t,hysteresis:n,object:e}),this.add(e),this}removeLevel(e){const t=this.levels;for(let n=0;n<t.length;n++)if(t[n].distance===e){const i=t.splice(n,1);return this.remove(i[0].object),!0}return!1}getCurrentLevel(){return this._currentLevel}getObjectForDistance(e){const t=this.levels;if(t.length>0){let n,i;for(n=1,i=t.length;n<i;n++){let s=t[n].distance;if(t[n].object.visible&&(s-=s*t[n].hysteresis),e<s)break}return t[n-1].object}return null}raycast(e,t){if(this.levels.length>0){lS.setFromMatrixPosition(this.matrixWorld);const i=e.ray.origin.distanceTo(lS);this.getObjectForDistance(i).raycast(e,t)}}update(e){const t=this.levels;if(t.length>1){lS.setFromMatrixPosition(e.matrixWorld),ew.setFromMatrixPosition(this.matrixWorld);const n=lS.distanceTo(ew)/e.zoom;t[0].object.visible=!0;let i,s;for(i=1,s=t.length;i<s;i++){let a=t[i].distance;if(t[i].object.visible&&(a-=a*t[i].hysteresis),n>=a)t[i-1].object.visible=!1,t[i].object.visible=!0;else break}for(this._currentLevel=i-1;i<s;i++)t[i].object.visible=!1}}toJSON(e){const t=super.toJSON(e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];const n=this.levels;for(let i=0,s=n.length;i<s;i++){const a=n[i];t.object.levels.push({object:a.object.uuid,distance:a.distance,hysteresis:a.hysteresis})}return t}}const tw=new Y,nw=new Ot,iw=new Ot,Nz=new Y,sw=new Mt,uS=new Y,dE=new br,rw=new Mt,pE=new $g;class NU extends bi{constructor(e,t){super(e,t),this.isSkinnedMesh=!0,this.type="SkinnedMesh",this.bindMode=OA,this.bindMatrix=new Mt,this.bindMatrixInverse=new Mt,this.boundingBox=null,this.boundingSphere=null}computeBoundingBox(){const e=this.geometry;this.boundingBox===null&&(this.boundingBox=new ga),this.boundingBox.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,uS),this.boundingBox.expandByPoint(uS)}computeBoundingSphere(){const e=this.geometry;this.boundingSphere===null&&(this.boundingSphere=new br),this.boundingSphere.makeEmpty();const t=e.getAttribute("position");for(let n=0;n<t.count;n++)this.getVertexPosition(n,uS),this.boundingSphere.expandByPoint(uS)}copy(e,t){return super.copy(e,t),this.bindMode=e.bindMode,this.bindMatrix.copy(e.bindMatrix),this.bindMatrixInverse.copy(e.bindMatrixInverse),this.skeleton=e.skeleton,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}raycast(e,t){const n=this.material,i=this.matrixWorld;n!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),dE.copy(this.boundingSphere),dE.applyMatrix4(i),e.ray.intersectsSphere(dE)!==!1&&(rw.copy(i).invert(),pE.copy(e.ray).applyMatrix4(rw),!(this.boundingBox!==null&&pE.intersectsBox(this.boundingBox)===!1)&&this._computeIntersections(e,t,pE)))}getVertexPosition(e,t){return super.getVertexPosition(e,t),this.applyBoneTransform(e,t),t}bind(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.copy(t).invert()}pose(){this.skeleton.pose()}normalizeSkinWeights(){const e=new Ot,t=this.geometry.attributes.skinWeight;for(let n=0,i=t.count;n<i;n++){e.fromBufferAttribute(t,n);const s=1/e.manhattanLength();s!==1/0?e.multiplyScalar(s):e.set(1,0,0,0),t.setXYZW(n,e.x,e.y,e.z,e.w)}}updateMatrixWorld(e){super.updateMatrixWorld(e),this.bindMode===OA?this.bindMatrixInverse.copy(this.matrixWorld).invert():this.bindMode===$D?this.bindMatrixInverse.copy(this.bindMatrix).invert():console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)}applyBoneTransform(e,t){const n=this.skeleton,i=this.geometry;nw.fromBufferAttribute(i.attributes.skinIndex,e),iw.fromBufferAttribute(i.attributes.skinWeight,e),tw.copy(t).applyMatrix4(this.bindMatrix),t.set(0,0,0);for(let s=0;s<4;s++){const a=iw.getComponent(s);if(a!==0){const l=nw.getComponent(s);sw.multiplyMatrices(n.bones[l].matrixWorld,n.boneInverses[l]),t.addScaledVector(Nz.copy(tw).applyMatrix4(sw),a)}}return t.applyMatrix4(this.bindMatrixInverse)}}class H1 extends Hn{constructor(){super(),this.isBone=!0,this.type="Bone"}}class Fl extends Li{constructor(e=null,t=1,n=1,i,s,a,l,c,d=Si,m=Si,y,v){super(null,a,l,c,d,m,i,s,y,v),this.isDataTexture=!0,this.image={data:e,width:t,height:n},this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1}}const aw=new Mt,Cz=new Mt;class fT{constructor(e=[],t=[]){this.uuid=So(),this.bones=e.slice(0),this.boneInverses=t,this.boneMatrices=null,this.boneTexture=null,this.init()}init(){const e=this.bones,t=this.boneInverses;if(this.boneMatrices=new Float32Array(e.length*16),t.length===0)this.calculateInverses();else if(e.length!==t.length){console.warn("THREE.Skeleton: Number of inverse bone matrices does not match amount of bones."),this.boneInverses=[];for(let n=0,i=this.bones.length;n<i;n++)this.boneInverses.push(new Mt)}}calculateInverses(){this.boneInverses.length=0;for(let e=0,t=this.bones.length;e<t;e++){const n=new Mt;this.bones[e]&&n.copy(this.bones[e].matrixWorld).invert(),this.boneInverses.push(n)}}pose(){for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&n.matrixWorld.copy(this.boneInverses[e]).invert()}for(let e=0,t=this.bones.length;e<t;e++){const n=this.bones[e];n&&(n.parent&&n.parent.isBone?(n.matrix.copy(n.parent.matrixWorld).invert(),n.matrix.multiply(n.matrixWorld)):n.matrix.copy(n.matrixWorld),n.matrix.decompose(n.position,n.quaternion,n.scale))}}update(){const e=this.bones,t=this.boneInverses,n=this.boneMatrices,i=this.boneTexture;for(let s=0,a=e.length;s<a;s++){const l=e[s]?e[s].matrixWorld:Cz;aw.multiplyMatrices(l,t[s]),aw.toArray(n,s*16)}i!==null&&(i.needsUpdate=!0)}clone(){return new fT(this.bones,this.boneInverses)}computeBoneTexture(){let e=Math.sqrt(this.bones.length*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4);t.set(this.boneMatrices);const n=new Fl(t,e,e,Ni,Ri);return n.needsUpdate=!0,this.boneMatrices=t,this.boneTexture=n,this}getBoneByName(e){for(let t=0,n=this.bones.length;t<n;t++){const i=this.bones[t];if(i.name===e)return i}}dispose(){this.boneTexture!==null&&(this.boneTexture.dispose(),this.boneTexture=null)}fromJSON(e,t){this.uuid=e.uuid;for(let n=0,i=e.bones.length;n<i;n++){const s=e.bones[n];let a=t[s];a===void 0&&(console.warn("THREE.Skeleton: No bone found with UUID:",s),a=new H1),this.bones.push(a),this.boneInverses.push(new Mt().fromArray(e.boneInverses[n]))}return this.init(),this}toJSON(){const e={metadata:{version:4.6,type:"Skeleton",generator:"Skeleton.toJSON"},bones:[],boneInverses:[]};e.uuid=this.uuid;const t=this.bones,n=this.boneInverses;for(let i=0,s=t.length;i<s;i++){const a=t[i];e.bones.push(a.uuid);const l=n[i];e.boneInverses.push(l.toArray())}return e}}class Qo extends Kn{constructor(e,t,n,i=1){super(e,t,n),this.isInstancedBufferAttribute=!0,this.meshPerAttribute=i}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}toJSON(){const e=super.toJSON();return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}const jm=new Mt,ow=new Mt,cS=[],lw=new ga,wz=new Mt,Dv=new bi,Uv=new br;class CU extends bi{constructor(e,t,n){super(e,t),this.isInstancedMesh=!0,this.instanceMatrix=new Qo(new Float32Array(n*16),16),this.instanceColor=null,this.morphTexture=null,this.count=n,this.boundingBox=null,this.boundingSphere=null;for(let i=0;i<n;i++)this.setMatrixAt(i,wz)}computeBoundingBox(){const e=this.geometry,t=this.count;this.boundingBox===null&&(this.boundingBox=new ga),e.boundingBox===null&&e.computeBoundingBox(),this.boundingBox.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,jm),lw.copy(e.boundingBox).applyMatrix4(jm),this.boundingBox.union(lw)}computeBoundingSphere(){const e=this.geometry,t=this.count;this.boundingSphere===null&&(this.boundingSphere=new br),e.boundingSphere===null&&e.computeBoundingSphere(),this.boundingSphere.makeEmpty();for(let n=0;n<t;n++)this.getMatrixAt(n,jm),Uv.copy(e.boundingSphere).applyMatrix4(jm),this.boundingSphere.union(Uv)}copy(e,t){return super.copy(e,t),this.instanceMatrix.copy(e.instanceMatrix),e.morphTexture!==null&&(this.morphTexture=e.morphTexture.clone()),e.instanceColor!==null&&(this.instanceColor=e.instanceColor.clone()),this.count=e.count,e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this}getColorAt(e,t){t.fromArray(this.instanceColor.array,e*3)}getMatrixAt(e,t){t.fromArray(this.instanceMatrix.array,e*16)}getMorphAt(e,t){const n=t.morphTargetInfluences,i=this.morphTexture.source.data.data,s=n.length+1,a=e*s+1;for(let l=0;l<n.length;l++)n[l]=i[a+l]}raycast(e,t){const n=this.matrixWorld,i=this.count;if(Dv.geometry=this.geometry,Dv.material=this.material,Dv.material!==void 0&&(this.boundingSphere===null&&this.computeBoundingSphere(),Uv.copy(this.boundingSphere),Uv.applyMatrix4(n),e.ray.intersectsSphere(Uv)!==!1))for(let s=0;s<i;s++){this.getMatrixAt(s,jm),ow.multiplyMatrices(n,jm),Dv.matrixWorld=ow,Dv.raycast(e,cS);for(let a=0,l=cS.length;a<l;a++){const c=cS[a];c.instanceId=s,c.object=this,t.push(c)}cS.length=0}}setColorAt(e,t){this.instanceColor===null&&(this.instanceColor=new Qo(new Float32Array(this.instanceMatrix.count*3).fill(1),3)),t.toArray(this.instanceColor.array,e*3)}setMatrixAt(e,t){t.toArray(this.instanceMatrix.array,e*16)}setMorphAt(e,t){const n=t.morphTargetInfluences,i=n.length+1;this.morphTexture===null&&(this.morphTexture=new Fl(new Float32Array(i*this.count),i,this.count,gp,Ri));const s=this.morphTexture.source.data.data;let a=0;for(let d=0;d<n.length;d++)a+=n[d];const l=this.geometry.morphTargetsRelative?1:1-a,c=i*e;s[c]=l,s.set(n,c+1)}updateMorphTargets(){}dispose(){this.dispatchEvent({type:"dispose"}),this.morphTexture!==null&&(this.morphTexture.dispose(),this.morphTexture=null)}}const mE=new Y,Dz=new Y,Uz=new Qt;class wu{constructor(e=new Y(1,0,0),t=0){this.isPlane=!0,this.normal=e,this.constant=t}set(e,t){return this.normal.copy(e),this.constant=t,this}setComponents(e,t,n,i){return this.normal.set(e,t,n),this.constant=i,this}setFromNormalAndCoplanarPoint(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this}setFromCoplanarPoints(e,t,n){const i=mE.subVectors(n,t).cross(Dz.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this}copy(e){return this.normal.copy(e.normal),this.constant=e.constant,this}normalize(){const e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this}negate(){return this.constant*=-1,this.normal.negate(),this}distanceToPoint(e){return this.normal.dot(e)+this.constant}distanceToSphere(e){return this.distanceToPoint(e.center)-e.radius}projectPoint(e,t){return t.copy(e).addScaledVector(this.normal,-this.distanceToPoint(e))}intersectLine(e,t){const n=e.delta(mE),i=this.normal.dot(n);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):null;const s=-(e.start.dot(this.normal)+this.constant)/i;return s<0||s>1?null:t.copy(e.start).addScaledVector(n,s)}intersectsLine(e){const t=this.distanceToPoint(e.start),n=this.distanceToPoint(e.end);return t<0&&n>0||n<0&&t>0}intersectsBox(e){return e.intersectsPlane(this)}intersectsSphere(e){return e.intersectsPlane(this)}coplanarPoint(e){return e.copy(this.normal).multiplyScalar(-this.constant)}applyMatrix4(e,t){const n=t||Uz.getNormalMatrix(e),i=this.coplanarPoint(mE).applyMatrix4(e),s=this.normal.applyMatrix3(n).normalize();return this.constant=-i.dot(s),this}translate(e){return this.constant-=e.dot(this.normal),this}equals(e){return e.normal.equals(this.normal)&&e.constant===this.constant}clone(){return new this.constructor().copy(this)}}const dd=new br,hS=new Y;class ty{constructor(e=new wu,t=new wu,n=new wu,i=new wu,s=new wu,a=new wu){this.planes=[e,t,n,i,s,a]}set(e,t,n,i,s,a){const l=this.planes;return l[0].copy(e),l[1].copy(t),l[2].copy(n),l[3].copy(i),l[4].copy(s),l[5].copy(a),this}copy(e){const t=this.planes;for(let n=0;n<6;n++)t[n].copy(e.planes[n]);return this}setFromProjectionMatrix(e,t=zr){const n=this.planes,i=e.elements,s=i[0],a=i[1],l=i[2],c=i[3],d=i[4],m=i[5],y=i[6],v=i[7],x=i[8],S=i[9],A=i[10],E=i[11],M=i[12],C=i[13],w=i[14],D=i[15];if(n[0].setComponents(c-s,v-d,E-x,D-M).normalize(),n[1].setComponents(c+s,v+d,E+x,D+M).normalize(),n[2].setComponents(c+a,v+m,E+S,D+C).normalize(),n[3].setComponents(c-a,v-m,E-S,D-C).normalize(),n[4].setComponents(c-l,v-y,E-A,D-w).normalize(),t===zr)n[5].setComponents(c+l,v+y,E+A,D+w).normalize();else if(t===Vl)n[5].setComponents(l,y,A,w).normalize();else throw new Error("THREE.Frustum.setFromProjectionMatrix(): Invalid coordinate system: "+t);return this}intersectsObject(e){if(e.boundingSphere!==void 0)e.boundingSphere===null&&e.computeBoundingSphere(),dd.copy(e.boundingSphere).applyMatrix4(e.matrixWorld);else{const t=e.geometry;t.boundingSphere===null&&t.computeBoundingSphere(),dd.copy(t.boundingSphere).applyMatrix4(e.matrixWorld)}return this.intersectsSphere(dd)}intersectsSprite(e){return dd.center.set(0,0,0),dd.radius=.7071067811865476,dd.applyMatrix4(e.matrixWorld),this.intersectsSphere(dd)}intersectsSphere(e){const t=this.planes,n=e.center,i=-e.radius;for(let s=0;s<6;s++)if(t[s].distanceToPoint(n)<i)return!1;return!0}intersectsBox(e){const t=this.planes;for(let n=0;n<6;n++){const i=t[n];if(hS.x=i.normal.x>0?e.max.x:e.min.x,hS.y=i.normal.y>0?e.max.y:e.min.y,hS.z=i.normal.z>0?e.max.z:e.min.z,i.distanceToPoint(hS)<0)return!1}return!0}containsPoint(e){const t=this.planes;for(let n=0;n<6;n++)if(t[n].distanceToPoint(e)<0)return!1;return!0}clone(){return new this.constructor().copy(this)}}function gE(r,e){return r-e}function Lz(r,e){return r.z-e.z}function Bz(r,e){return e.z-r.z}class Oz{constructor(){this.index=0,this.pool=[],this.list=[]}push(e,t,n,i){const s=this.pool,a=this.list;this.index>=s.length&&s.push({start:-1,count:-1,z:-1,index:-1});const l=s[this.index];a.push(l),this.index++,l.start=e,l.count=t,l.z=n,l.index=i}reset(){this.list.length=0,this.index=0}}const La=new Mt,Pz=new ft(1,1,1),yE=new ty,fS=new ga,pd=new br,Lv=new Y,uw=new Y,Iz=new Y,vE=new Oz,Ir=new bi,dS=[];function Fz(r,e,t=0){const n=e.itemSize;if(r.isInterleavedBufferAttribute||r.array.constructor!==e.array.constructor){const i=r.count;for(let s=0;s<i;s++)for(let a=0;a<n;a++)e.setComponent(s+t,a,r.getComponent(s,a))}else e.array.set(r.array,t*n);e.needsUpdate=!0}function md(r,e){if(r.constructor!==e.constructor){const t=Math.min(r.length,e.length);for(let n=0;n<t;n++)e[n]=r[n]}else{const t=Math.min(r.length,e.length);e.set(new r.constructor(r.buffer,0,t))}}class wU extends bi{constructor(e,t,n=t*2,i){super(new fn,i),this.isBatchedMesh=!0,this.perObjectFrustumCulled=!0,this.sortObjects=!0,this.boundingBox=null,this.boundingSphere=null,this.customSort=null,this._instanceInfo=[],this._geometryInfo=[],this._availableInstanceIds=[],this._availableGeometryIds=[],this._nextIndexStart=0,this._nextVertexStart=0,this._geometryCount=0,this._visibilityChanged=!0,this._geometryInitialized=!1,this._maxInstanceCount=e,this._maxVertexCount=t,this._maxIndexCount=n,this._multiDrawCounts=new Int32Array(e),this._multiDrawStarts=new Int32Array(e),this._multiDrawCount=0,this._multiDrawInstances=null,this._matricesTexture=null,this._indirectTexture=null,this._colorsTexture=null,this._initMatricesTexture(),this._initIndirectTexture()}get maxInstanceCount(){return this._maxInstanceCount}get instanceCount(){return this._instanceInfo.length-this._availableInstanceIds.length}get unusedVertexCount(){return this._maxVertexCount-this._nextVertexStart}get unusedIndexCount(){return this._maxIndexCount-this._nextIndexStart}_initMatricesTexture(){let e=Math.sqrt(this._maxInstanceCount*4);e=Math.ceil(e/4)*4,e=Math.max(e,4);const t=new Float32Array(e*e*4),n=new Fl(t,e,e,Ni,Ri);this._matricesTexture=n}_initIndirectTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Uint32Array(e*e),n=new Fl(t,e,e,ff,di);this._indirectTexture=n}_initColorsTexture(){let e=Math.sqrt(this._maxInstanceCount);e=Math.ceil(e);const t=new Float32Array(e*e*4).fill(1),n=new Fl(t,e,e,Ni,Ri);n.colorSpace=on.workingColorSpace,this._colorsTexture=n}_initializeGeometry(e){const t=this.geometry,n=this._maxVertexCount,i=this._maxIndexCount;if(this._geometryInitialized===!1){for(const s in e.attributes){const a=e.getAttribute(s),{array:l,itemSize:c,normalized:d}=a,m=new l.constructor(n*c),y=new Kn(m,c,d);t.setAttribute(s,y)}if(e.getIndex()!==null){const s=n>65535?new Uint32Array(i):new Uint16Array(i);t.setIndex(new Kn(s,1))}this._geometryInitialized=!0}}_validateGeometry(e){const t=this.geometry;if(!!e.getIndex()!=!!t.getIndex())throw new Error('THREE.BatchedMesh: All geometries must consistently have "index".');for(const n in t.attributes){if(!e.hasAttribute(n))throw new Error(`THREE.BatchedMesh: Added geometry missing "${n}". All geometries must have consistent attributes.`);const i=e.getAttribute(n),s=t.getAttribute(n);if(i.itemSize!==s.itemSize||i.normalized!==s.normalized)throw new Error("THREE.BatchedMesh: All attributes must have a consistent itemSize and normalized value.")}}validateInstanceId(e){const t=this._instanceInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid instanceId ${e}. Instance is either out of range or has been deleted.`)}validateGeometryId(e){const t=this._geometryInfo;if(e<0||e>=t.length||t[e].active===!1)throw new Error(`THREE.BatchedMesh: Invalid geometryId ${e}. Geometry is either out of range or has been deleted.`)}setCustomSort(e){return this.customSort=e,this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new ga);const e=this.boundingBox,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const s=t[n].geometryIndex;this.getMatrixAt(n,La),this.getBoundingBoxAt(s,fS).applyMatrix4(La),e.union(fS)}}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new br);const e=this.boundingSphere,t=this._instanceInfo;e.makeEmpty();for(let n=0,i=t.length;n<i;n++){if(t[n].active===!1)continue;const s=t[n].geometryIndex;this.getMatrixAt(n,La),this.getBoundingSphereAt(s,pd).applyMatrix4(La),e.union(pd)}}addInstance(e){if(this._instanceInfo.length>=this.maxInstanceCount&&this._availableInstanceIds.length===0)throw new Error("THREE.BatchedMesh: Maximum item count reached.");const n={visible:!0,active:!0,geometryIndex:e};let i=null;this._availableInstanceIds.length>0?(this._availableInstanceIds.sort(gE),i=this._availableInstanceIds.shift(),this._instanceInfo[i]=n):(i=this._instanceInfo.length,this._instanceInfo.push(n));const s=this._matricesTexture;La.identity().toArray(s.image.data,i*16),s.needsUpdate=!0;const a=this._colorsTexture;return a&&(Pz.toArray(a.image.data,i*4),a.needsUpdate=!0),this._visibilityChanged=!0,i}addGeometry(e,t=-1,n=-1){this._initializeGeometry(e),this._validateGeometry(e);const i={vertexStart:-1,vertexCount:-1,reservedVertexCount:-1,indexStart:-1,indexCount:-1,reservedIndexCount:-1,start:-1,count:-1,boundingBox:null,boundingSphere:null,active:!0},s=this._geometryInfo;i.vertexStart=this._nextVertexStart,i.reservedVertexCount=t===-1?e.getAttribute("position").count:t;const a=e.getIndex();if(a!==null&&(i.indexStart=this._nextIndexStart,i.reservedIndexCount=n===-1?a.count:n),i.indexStart!==-1&&i.indexStart+i.reservedIndexCount>this._maxIndexCount||i.vertexStart+i.reservedVertexCount>this._maxVertexCount)throw new Error("THREE.BatchedMesh: Reserved space request exceeds the maximum buffer size.");let c;return this._availableGeometryIds.length>0?(this._availableGeometryIds.sort(gE),c=this._availableGeometryIds.shift(),s[c]=i):(c=this._geometryCount,this._geometryCount++,s.push(i)),this.setGeometryAt(c,e),this._nextIndexStart=i.indexStart+i.reservedIndexCount,this._nextVertexStart=i.vertexStart+i.reservedVertexCount,c}setGeometryAt(e,t){if(e>=this._geometryCount)throw new Error("THREE.BatchedMesh: Maximum geometry count reached.");this._validateGeometry(t);const n=this.geometry,i=n.getIndex()!==null,s=n.getIndex(),a=t.getIndex(),l=this._geometryInfo[e];if(i&&a.count>l.reservedIndexCount||t.attributes.position.count>l.reservedVertexCount)throw new Error("THREE.BatchedMesh: Reserved space not large enough for provided geometry.");const c=l.vertexStart,d=l.reservedVertexCount;l.vertexCount=t.getAttribute("position").count;for(const m in n.attributes){const y=t.getAttribute(m),v=n.getAttribute(m);Fz(y,v,c);const x=y.itemSize;for(let S=y.count,A=d;S<A;S++){const E=c+S;for(let M=0;M<x;M++)v.setComponent(E,M,0)}v.needsUpdate=!0,v.addUpdateRange(c*x,d*x)}if(i){const m=l.indexStart,y=l.reservedIndexCount;l.indexCount=t.getIndex().count;for(let v=0;v<a.count;v++)s.setX(m+v,c+a.getX(v));for(let v=a.count,x=y;v<x;v++)s.setX(m+v,c);s.needsUpdate=!0,s.addUpdateRange(m,l.reservedIndexCount)}return l.start=i?l.indexStart:l.vertexStart,l.count=i?l.indexCount:l.vertexCount,l.boundingBox=null,t.boundingBox!==null&&(l.boundingBox=t.boundingBox.clone()),l.boundingSphere=null,t.boundingSphere!==null&&(l.boundingSphere=t.boundingSphere.clone()),this._visibilityChanged=!0,e}deleteGeometry(e){const t=this._geometryInfo;if(e>=t.length||t[e].active===!1)return this;const n=this._instanceInfo;for(let i=0,s=n.length;i<s;i++)n[i].active&&n[i].geometryIndex===e&&this.deleteInstance(i);return t[e].active=!1,this._availableGeometryIds.push(e),this._visibilityChanged=!0,this}deleteInstance(e){return this.validateInstanceId(e),this._instanceInfo[e].active=!1,this._availableInstanceIds.push(e),this._visibilityChanged=!0,this}optimize(){let e=0,t=0;const n=this._geometryInfo,i=n.map((a,l)=>l).sort((a,l)=>n[a].vertexStart-n[l].vertexStart),s=this.geometry;for(let a=0,l=n.length;a<l;a++){const c=i[a],d=n[c];if(d.active!==!1){if(s.index!==null){if(d.indexStart!==t){const{indexStart:m,vertexStart:y,reservedIndexCount:v}=d,x=s.index,S=x.array,A=e-y;for(let E=m;E<m+v;E++)S[E]=S[E]+A;x.array.copyWithin(t,m,m+v),x.addUpdateRange(t,v),d.indexStart=t}t+=d.reservedIndexCount}if(d.vertexStart!==e){const{vertexStart:m,reservedVertexCount:y}=d,v=s.attributes;for(const x in v){const S=v[x],{array:A,itemSize:E}=S;A.copyWithin(e*E,m*E,(m+y)*E),S.addUpdateRange(e*E,y*E)}d.vertexStart=e}e+=d.reservedVertexCount,d.start=s.index?d.indexStart:d.vertexStart,this._nextIndexStart=s.index?d.indexStart+d.reservedIndexCount:0,this._nextVertexStart=d.vertexStart+d.reservedVertexCount}}return this}getBoundingBoxAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingBox===null){const s=new ga,a=n.index,l=n.attributes.position;for(let c=i.start,d=i.start+i.count;c<d;c++){let m=c;a&&(m=a.getX(m)),s.expandByPoint(Lv.fromBufferAttribute(l,m))}i.boundingBox=s}return t.copy(i.boundingBox),t}getBoundingSphereAt(e,t){if(e>=this._geometryCount)return null;const n=this.geometry,i=this._geometryInfo[e];if(i.boundingSphere===null){const s=new br;this.getBoundingBoxAt(e,fS),fS.getCenter(s.center);const a=n.index,l=n.attributes.position;let c=0;for(let d=i.start,m=i.start+i.count;d<m;d++){let y=d;a&&(y=a.getX(y)),Lv.fromBufferAttribute(l,y),c=Math.max(c,s.center.distanceToSquared(Lv))}s.radius=Math.sqrt(c),i.boundingSphere=s}return t.copy(i.boundingSphere),t}setMatrixAt(e,t){this.validateInstanceId(e);const n=this._matricesTexture,i=this._matricesTexture.image.data;return t.toArray(i,e*16),n.needsUpdate=!0,this}getMatrixAt(e,t){return this.validateInstanceId(e),t.fromArray(this._matricesTexture.image.data,e*16)}setColorAt(e,t){return this.validateInstanceId(e),this._colorsTexture===null&&this._initColorsTexture(),t.toArray(this._colorsTexture.image.data,e*4),this._colorsTexture.needsUpdate=!0,this}getColorAt(e,t){return this.validateInstanceId(e),t.fromArray(this._colorsTexture.image.data,e*4)}setVisibleAt(e,t){return this.validateInstanceId(e),this._instanceInfo[e].visible===t?this:(this._instanceInfo[e].visible=t,this._visibilityChanged=!0,this)}getVisibleAt(e){return this.validateInstanceId(e),this._instanceInfo[e].visible}setGeometryIdAt(e,t){return this.validateInstanceId(e),this.validateGeometryId(t),this._instanceInfo[e].geometryIndex=t,this}getGeometryIdAt(e){return this.validateInstanceId(e),this._instanceInfo[e].geometryIndex}getGeometryRangeAt(e,t={}){this.validateGeometryId(e);const n=this._geometryInfo[e];return t.vertexStart=n.vertexStart,t.vertexCount=n.vertexCount,t.reservedVertexCount=n.reservedVertexCount,t.indexStart=n.indexStart,t.indexCount=n.indexCount,t.reservedIndexCount=n.reservedIndexCount,t.start=n.start,t.count=n.count,t}setInstanceCount(e){const t=this._availableInstanceIds,n=this._instanceInfo;for(t.sort(gE);t[t.length-1]===n.length;)n.pop(),t.pop();if(e<n.length)throw new Error(`BatchedMesh: Instance ids outside the range ${e} are being used. Cannot shrink instance count.`);const i=new Int32Array(e),s=new Int32Array(e);md(this._multiDrawCounts,i),md(this._multiDrawStarts,s),this._multiDrawCounts=i,this._multiDrawStarts=s,this._maxInstanceCount=e;const a=this._indirectTexture,l=this._matricesTexture,c=this._colorsTexture;a.dispose(),this._initIndirectTexture(),md(a.image.data,this._indirectTexture.image.data),l.dispose(),this._initMatricesTexture(),md(l.image.data,this._matricesTexture.image.data),c&&(c.dispose(),this._initColorsTexture(),md(c.image.data,this._colorsTexture.image.data))}setGeometrySize(e,t){const n=[...this._geometryInfo].filter(l=>l.active);if(Math.max(...n.map(l=>l.vertexStart+l.reservedVertexCount))>e)throw new Error(`BatchedMesh: Geometry vertex values are being used outside the range ${t}. Cannot shrink further.`);if(this.geometry.index&&Math.max(...n.map(c=>c.indexStart+c.reservedIndexCount))>t)throw new Error(`BatchedMesh: Geometry index values are being used outside the range ${t}. Cannot shrink further.`);const s=this.geometry;s.dispose(),this._maxVertexCount=e,this._maxIndexCount=t,this._geometryInitialized&&(this._geometryInitialized=!1,this.geometry=new fn,this._initializeGeometry(s));const a=this.geometry;s.index&&md(s.index.array,a.index.array);for(const l in s.attributes)md(s.attributes[l].array,a.attributes[l].array)}raycast(e,t){const n=this._instanceInfo,i=this._geometryInfo,s=this.matrixWorld,a=this.geometry;Ir.material=this.material,Ir.geometry.index=a.index,Ir.geometry.attributes=a.attributes,Ir.geometry.boundingBox===null&&(Ir.geometry.boundingBox=new ga),Ir.geometry.boundingSphere===null&&(Ir.geometry.boundingSphere=new br);for(let l=0,c=n.length;l<c;l++){if(!n[l].visible||!n[l].active)continue;const d=n[l].geometryIndex,m=i[d];Ir.geometry.setDrawRange(m.start,m.count),this.getMatrixAt(l,Ir.matrixWorld).premultiply(s),this.getBoundingBoxAt(d,Ir.geometry.boundingBox),this.getBoundingSphereAt(d,Ir.geometry.boundingSphere),Ir.raycast(e,dS);for(let y=0,v=dS.length;y<v;y++){const x=dS[y];x.object=this,x.batchId=l,t.push(x)}dS.length=0}Ir.material=null,Ir.geometry.index=null,Ir.geometry.attributes={},Ir.geometry.setDrawRange(0,1/0)}copy(e){return super.copy(e),this.geometry=e.geometry.clone(),this.perObjectFrustumCulled=e.perObjectFrustumCulled,this.sortObjects=e.sortObjects,this.boundingBox=e.boundingBox!==null?e.boundingBox.clone():null,this.boundingSphere=e.boundingSphere!==null?e.boundingSphere.clone():null,this._geometryInfo=e._geometryInfo.map(t=>({...t,boundingBox:t.boundingBox!==null?t.boundingBox.clone():null,boundingSphere:t.boundingSphere!==null?t.boundingSphere.clone():null})),this._instanceInfo=e._instanceInfo.map(t=>({...t})),this._maxInstanceCount=e._maxInstanceCount,this._maxVertexCount=e._maxVertexCount,this._maxIndexCount=e._maxIndexCount,this._geometryInitialized=e._geometryInitialized,this._geometryCount=e._geometryCount,this._multiDrawCounts=e._multiDrawCounts.slice(),this._multiDrawStarts=e._multiDrawStarts.slice(),this._matricesTexture=e._matricesTexture.clone(),this._matricesTexture.image.data=this._matricesTexture.image.data.slice(),this._colorsTexture!==null&&(this._colorsTexture=e._colorsTexture.clone(),this._colorsTexture.image.data=this._colorsTexture.image.data.slice()),this}dispose(){this.geometry.dispose(),this._matricesTexture.dispose(),this._matricesTexture=null,this._indirectTexture.dispose(),this._indirectTexture=null,this._colorsTexture!==null&&(this._colorsTexture.dispose(),this._colorsTexture=null)}onBeforeRender(e,t,n,i,s){if(!this._visibilityChanged&&!this.perObjectFrustumCulled&&!this.sortObjects)return;const a=i.getIndex(),l=a===null?1:a.array.BYTES_PER_ELEMENT,c=this._instanceInfo,d=this._multiDrawStarts,m=this._multiDrawCounts,y=this._geometryInfo,v=this.perObjectFrustumCulled,x=this._indirectTexture,S=x.image.data;v&&(La.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse).multiply(this.matrixWorld),yE.setFromProjectionMatrix(La,e.coordinateSystem));let A=0;if(this.sortObjects){La.copy(this.matrixWorld).invert(),Lv.setFromMatrixPosition(n.matrixWorld).applyMatrix4(La),uw.set(0,0,-1).transformDirection(n.matrixWorld).transformDirection(La);for(let C=0,w=c.length;C<w;C++)if(c[C].visible&&c[C].active){const D=c[C].geometryIndex;this.getMatrixAt(C,La),this.getBoundingSphereAt(D,pd).applyMatrix4(La);let z=!1;if(v&&(z=!yE.intersectsSphere(pd)),!z){const B=y[D],F=Iz.subVectors(pd.center,Lv).dot(uw);vE.push(B.start,B.count,F,C)}}const E=vE.list,M=this.customSort;M===null?E.sort(s.transparent?Bz:Lz):M.call(this,E,n);for(let C=0,w=E.length;C<w;C++){const D=E[C];d[A]=D.start*l,m[A]=D.count,S[A]=D.index,A++}vE.reset()}else for(let E=0,M=c.length;E<M;E++)if(c[E].visible&&c[E].active){const C=c[E].geometryIndex;let w=!1;if(v&&(this.getMatrixAt(E,La),this.getBoundingSphereAt(C,pd).applyMatrix4(La),w=!yE.intersectsSphere(pd)),!w){const D=y[C];d[A]=D.start*l,m[A]=D.count,S[A]=E,A++}}x.needsUpdate=!0,this._multiDrawCount=A,this._visibilityChanged=!1}onBeforeShadow(e,t,n,i,s,a){this.onBeforeRender(e,null,i,s,a)}}class qr extends ar{constructor(e){super(),this.isLineBasicMaterial=!0,this.type="LineBasicMaterial",this.color=new ft(16777215),this.map=null,this.linewidth=1,this.linecap="round",this.linejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this.fog=e.fog,this}}const yb=new Y,vb=new Y,cw=new Mt,Bv=new $g,pS=new br,_E=new Y,hw=new Y;class cf extends Hn{constructor(e=new fn,t=new qr){super(),this.isLine=!0,this.type="Line",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[0];for(let i=1,s=t.count;i<s;i++)yb.fromBufferAttribute(t,i-1),vb.fromBufferAttribute(t,i),n[i]=n[i-1],n[i]+=yb.distanceTo(vb);e.setAttribute("lineDistance",new Et(n,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Line.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),pS.copy(n.boundingSphere),pS.applyMatrix4(i),pS.radius+=s,e.ray.intersectsSphere(pS)===!1)return;cw.copy(i).invert(),Bv.copy(e.ray).applyMatrix4(cw);const l=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,d=this.isLineSegments?2:1,m=n.index,v=n.attributes.position;if(m!==null){const x=Math.max(0,a.start),S=Math.min(m.count,a.start+a.count);for(let A=x,E=S-1;A<E;A+=d){const M=m.getX(A),C=m.getX(A+1),w=mS(this,e,Bv,c,M,C,A);w&&t.push(w)}if(this.isLineLoop){const A=m.getX(S-1),E=m.getX(x),M=mS(this,e,Bv,c,A,E,S-1);M&&t.push(M)}}else{const x=Math.max(0,a.start),S=Math.min(v.count,a.start+a.count);for(let A=x,E=S-1;A<E;A+=d){const M=mS(this,e,Bv,c,A,A+1,A);M&&t.push(M)}if(this.isLineLoop){const A=mS(this,e,Bv,c,S-1,x,S-1);A&&t.push(A)}}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const l=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}}function mS(r,e,t,n,i,s,a){const l=r.geometry.attributes.position;if(yb.fromBufferAttribute(l,i),vb.fromBufferAttribute(l,s),t.distanceSqToSegment(yb,vb,_E,hw)>n)return;_E.applyMatrix4(r.matrixWorld);const d=e.ray.origin.distanceTo(_E);if(!(d<e.near||d>e.far))return{distance:d,point:hw.clone().applyMatrix4(r.matrixWorld),index:a,face:null,faceIndex:null,barycoord:null,object:r}}const fw=new Y,dw=new Y;class Xu extends cf{constructor(e,t){super(e,t),this.isLineSegments=!0,this.type="LineSegments"}computeLineDistances(){const e=this.geometry;if(e.index===null){const t=e.attributes.position,n=[];for(let i=0,s=t.count;i<s;i+=2)fw.fromBufferAttribute(t,i),dw.fromBufferAttribute(t,i+1),n[i]=i===0?0:n[i-1],n[i+1]=n[i]+fw.distanceTo(dw);e.setAttribute("lineDistance",new Et(n,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");return this}}class DU extends cf{constructor(e,t){super(e,t),this.isLineLoop=!0,this.type="LineLoop"}}class dT extends ar{constructor(e){super(),this.isPointsMaterial=!0,this.type="PointsMaterial",this.color=new ft(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.fog=e.fog,this}}const pw=new Mt,IA=new $g,gS=new br,yS=new Y;class UU extends Hn{constructor(e=new fn,t=new dT){super(),this.isPoints=!0,this.type="Points",this.geometry=e,this.material=t,this.morphTargetDictionary=void 0,this.morphTargetInfluences=void 0,this.updateMorphTargets()}copy(e,t){return super.copy(e,t),this.material=Array.isArray(e.material)?e.material.slice():e.material,this.geometry=e.geometry,this}raycast(e,t){const n=this.geometry,i=this.matrixWorld,s=e.params.Points.threshold,a=n.drawRange;if(n.boundingSphere===null&&n.computeBoundingSphere(),gS.copy(n.boundingSphere),gS.applyMatrix4(i),gS.radius+=s,e.ray.intersectsSphere(gS)===!1)return;pw.copy(i).invert(),IA.copy(e.ray).applyMatrix4(pw);const l=s/((this.scale.x+this.scale.y+this.scale.z)/3),c=l*l,d=n.index,y=n.attributes.position;if(d!==null){const v=Math.max(0,a.start),x=Math.min(d.count,a.start+a.count);for(let S=v,A=x;S<A;S++){const E=d.getX(S);yS.fromBufferAttribute(y,E),mw(yS,E,c,i,e,t,this)}}else{const v=Math.max(0,a.start),x=Math.min(y.count,a.start+a.count);for(let S=v,A=x;S<A;S++)yS.fromBufferAttribute(y,S),mw(yS,S,c,i,e,t,this)}}updateMorphTargets(){const t=this.geometry.morphAttributes,n=Object.keys(t);if(n.length>0){const i=t[n[0]];if(i!==void 0){this.morphTargetInfluences=[],this.morphTargetDictionary={};for(let s=0,a=i.length;s<a;s++){const l=i[s].name||String(s);this.morphTargetInfluences.push(0),this.morphTargetDictionary[l]=s}}}}}function mw(r,e,t,n,i,s,a){const l=IA.distanceSqToPoint(r);if(l<t){const c=new Y;IA.closestPointToPoint(r,c),c.applyMatrix4(n);const d=i.ray.origin.distanceTo(c);if(d<i.near||d>i.far)return;s.push({distance:d,distanceToRay:Math.sqrt(l),point:c,index:e,face:null,faceIndex:null,barycoord:null,object:a})}}class LU extends Li{constructor(e,t,n,i,s=Zn,a=Zn,l,c,d){super(e,t,n,i,s,a,l,c,d),this.isVideoTexture=!0,this.generateMipmaps=!1;const m=this;function y(){m.needsUpdate=!0,e.requestVideoFrameCallback(y)}"requestVideoFrameCallback"in e&&e.requestVideoFrameCallback(y)}clone(){return new this.constructor(this.image).copy(this)}update(){const e=this.image;"requestVideoFrameCallback"in e===!1&&e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}class zz extends LU{constructor(e,t,n,i,s,a,l,c){super({},e,t,n,i,s,a,l,c),this.isVideoFrameTexture=!0}update(){}clone(){return new this.constructor().copy(this)}setFrame(e){this.image=e,this.needsUpdate=!0}}class k1 extends Li{constructor(e,t){super({width:e,height:t}),this.isFramebufferTexture=!0,this.magFilter=Si,this.minFilter=Si,this.generateMipmaps=!1,this.needsUpdate=!0}}class pT extends Li{constructor(e,t,n,i,s,a,l,c,d,m,y,v){super(null,a,l,c,d,m,i,s,y,v),this.isCompressedTexture=!0,this.image={width:t,height:n},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}}class Vz extends pT{constructor(e,t,n,i,s,a){super(e,t,n,s,a),this.isCompressedArrayTexture=!0,this.image.depth=i,this.wrapR=da,this.layerUpdates=new Set}addLayerUpdate(e){this.layerUpdates.add(e)}clearLayerUpdates(){this.layerUpdates.clear()}}class Gz extends pT{constructor(e,t,n){super(void 0,e[0].width,e[0].height,t,n,va),this.isCompressedCubeTexture=!0,this.isCubeTexture=!0,this.image=e}}class Hz extends Li{constructor(e,t,n,i,s,a,l,c,d){super(e,t,n,i,s,a,l,c,d),this.isCanvasTexture=!0,this.needsUpdate=!0}}class ya extends Li{constructor(e,t,n=di,i,s,a,l=Si,c=Si,d,m=ka){if(m!==ka&&m!==qa)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");super(null,i,s,a,l,c,m,n,d),this.isDepthTexture=!0,this.image={width:e,height:t},this.flipY=!1,this.generateMipmaps=!1,this.compareFunction=null}copy(e){return super.copy(e),this.source=new Jh(Object.assign({},e.image)),this.compareFunction=e.compareFunction,this}toJSON(e){const t=super.toJSON(e);return this.compareFunction!==null&&(t.compareFunction=this.compareFunction),t}}class ql{constructor(){this.type="Curve",this.arcLengthDivisions=200,this.needsUpdate=!1,this.cacheArcLengths=null}getPoint(){console.warn("THREE.Curve: .getPoint() not implemented.")}getPointAt(e,t){const n=this.getUtoTmapping(e);return this.getPoint(n,t)}getPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return t}getSpacedPoints(e=5){const t=[];for(let n=0;n<=e;n++)t.push(this.getPointAt(n/e));return t}getLength(){const e=this.getLengths();return e[e.length-1]}getLengths(e=this.arcLengthDivisions){if(this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;const t=[];let n,i=this.getPoint(0),s=0;t.push(0);for(let a=1;a<=e;a++)n=this.getPoint(a/e),s+=n.distanceTo(i),t.push(s),i=n;return this.cacheArcLengths=t,t}updateArcLengths(){this.needsUpdate=!0,this.getLengths()}getUtoTmapping(e,t=null){const n=this.getLengths();let i=0;const s=n.length;let a;t?a=t:a=e*n[s-1];let l=0,c=s-1,d;for(;l<=c;)if(i=Math.floor(l+(c-l)/2),d=n[i]-a,d<0)l=i+1;else if(d>0)c=i-1;else{c=i;break}if(i=c,n[i]===a)return i/(s-1);const m=n[i],v=n[i+1]-m,x=(a-m)/v;return(i+x)/(s-1)}getTangent(e,t){let i=e-1e-4,s=e+1e-4;i<0&&(i=0),s>1&&(s=1);const a=this.getPoint(i),l=this.getPoint(s),c=t||(a.isVector2?new Xe:new Y);return c.copy(l).sub(a).normalize(),c}getTangentAt(e,t){const n=this.getUtoTmapping(e);return this.getTangent(n,t)}computeFrenetFrames(e,t=!1){const n=new Y,i=[],s=[],a=[],l=new Y,c=new Mt;for(let x=0;x<=e;x++){const S=x/e;i[x]=this.getTangentAt(S,new Y)}s[0]=new Y,a[0]=new Y;let d=Number.MAX_VALUE;const m=Math.abs(i[0].x),y=Math.abs(i[0].y),v=Math.abs(i[0].z);m<=d&&(d=m,n.set(1,0,0)),y<=d&&(d=y,n.set(0,1,0)),v<=d&&n.set(0,0,1),l.crossVectors(i[0],n).normalize(),s[0].crossVectors(i[0],l),a[0].crossVectors(i[0],s[0]);for(let x=1;x<=e;x++){if(s[x]=s[x-1].clone(),a[x]=a[x-1].clone(),l.crossVectors(i[x-1],i[x]),l.length()>Number.EPSILON){l.normalize();const S=Math.acos(hn(i[x-1].dot(i[x]),-1,1));s[x].applyMatrix4(c.makeRotationAxis(l,S))}a[x].crossVectors(i[x],s[x])}if(t===!0){let x=Math.acos(hn(s[0].dot(s[e]),-1,1));x/=e,i[0].dot(l.crossVectors(s[0],s[e]))>0&&(x=-x);for(let S=1;S<=e;S++)s[S].applyMatrix4(c.makeRotationAxis(i[S],x*S)),a[S].crossVectors(i[S],s[S])}return{tangents:i,normals:s,binormals:a}}clone(){return new this.constructor().copy(this)}copy(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}toJSON(){const e={metadata:{version:4.6,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e}fromJSON(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}class mT extends ql{constructor(e=0,t=0,n=1,i=1,s=0,a=Math.PI*2,l=!1,c=0){super(),this.isEllipseCurve=!0,this.type="EllipseCurve",this.aX=e,this.aY=t,this.xRadius=n,this.yRadius=i,this.aStartAngle=s,this.aEndAngle=a,this.aClockwise=l,this.aRotation=c}getPoint(e,t=new Xe){const n=t,i=Math.PI*2;let s=this.aEndAngle-this.aStartAngle;const a=Math.abs(s)<Number.EPSILON;for(;s<0;)s+=i;for(;s>i;)s-=i;s<Number.EPSILON&&(a?s=0:s=i),this.aClockwise===!0&&!a&&(s===i?s=-i:s=s-i);const l=this.aStartAngle+e*s;let c=this.aX+this.xRadius*Math.cos(l),d=this.aY+this.yRadius*Math.sin(l);if(this.aRotation!==0){const m=Math.cos(this.aRotation),y=Math.sin(this.aRotation),v=c-this.aX,x=d-this.aY;c=v*m-x*y+this.aX,d=v*y+x*m+this.aY}return n.set(c,d)}copy(e){return super.copy(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}toJSON(){const e=super.toJSON();return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e}fromJSON(e){return super.fromJSON(e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this}}class BU extends mT{constructor(e,t,n,i,s,a){super(e,t,n,n,i,s,a),this.isArcCurve=!0,this.type="ArcCurve"}}function q1(){let r=0,e=0,t=0,n=0;function i(s,a,l,c){r=s,e=l,t=-3*s+3*a-2*l-c,n=2*s-2*a+l+c}return{initCatmullRom:function(s,a,l,c,d){i(a,l,d*(l-s),d*(c-a))},initNonuniformCatmullRom:function(s,a,l,c,d,m,y){let v=(a-s)/d-(l-s)/(d+m)+(l-a)/m,x=(l-a)/m-(c-a)/(m+y)+(c-l)/y;v*=m,x*=m,i(a,l,v,x)},calc:function(s){const a=s*s,l=a*s;return r+e*s+t*a+n*l}}}const vS=new Y,xE=new q1,SE=new q1,bE=new q1;class OU extends ql{constructor(e=[],t=!1,n="centripetal",i=.5){super(),this.isCatmullRomCurve3=!0,this.type="CatmullRomCurve3",this.points=e,this.closed=t,this.curveType=n,this.tension=i}getPoint(e,t=new Y){const n=t,i=this.points,s=i.length,a=(s-(this.closed?0:1))*e;let l=Math.floor(a),c=a-l;this.closed?l+=l>0?0:(Math.floor(Math.abs(l)/s)+1)*s:c===0&&l===s-1&&(l=s-2,c=1);let d,m;this.closed||l>0?d=i[(l-1)%s]:(vS.subVectors(i[0],i[1]).add(i[0]),d=vS);const y=i[l%s],v=i[(l+1)%s];if(this.closed||l+2<s?m=i[(l+2)%s]:(vS.subVectors(i[s-1],i[s-2]).add(i[s-1]),m=vS),this.curveType==="centripetal"||this.curveType==="chordal"){const x=this.curveType==="chordal"?.5:.25;let S=Math.pow(d.distanceToSquared(y),x),A=Math.pow(y.distanceToSquared(v),x),E=Math.pow(v.distanceToSquared(m),x);A<1e-4&&(A=1),S<1e-4&&(S=A),E<1e-4&&(E=A),xE.initNonuniformCatmullRom(d.x,y.x,v.x,m.x,S,A,E),SE.initNonuniformCatmullRom(d.y,y.y,v.y,m.y,S,A,E),bE.initNonuniformCatmullRom(d.z,y.z,v.z,m.z,S,A,E)}else this.curveType==="catmullrom"&&(xE.initCatmullRom(d.x,y.x,v.x,m.x,this.tension),SE.initCatmullRom(d.y,y.y,v.y,m.y,this.tension),bE.initCatmullRom(d.z,y.z,v.z,m.z,this.tension));return n.set(xE.calc(c),SE.calc(c),bE.calc(c)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new Y().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this}}function gw(r,e,t,n,i){const s=(n-e)*.5,a=(i-t)*.5,l=r*r,c=r*l;return(2*t-2*n+s+a)*c+(-3*t+3*n-2*s-a)*l+s*r+t}function kz(r,e){const t=1-r;return t*t*e}function qz(r,e){return 2*(1-r)*r*e}function Wz(r,e){return r*r*e}function s_(r,e,t,n){return kz(r,e)+qz(r,t)+Wz(r,n)}function Xz(r,e){const t=1-r;return t*t*t*e}function Yz(r,e){const t=1-r;return 3*t*t*r*e}function jz(r,e){return 3*(1-r)*r*r*e}function Zz(r,e){return r*r*r*e}function r_(r,e,t,n,i){return Xz(r,e)+Yz(r,t)+jz(r,n)+Zz(r,i)}class W1 extends ql{constructor(e=new Xe,t=new Xe,n=new Xe,i=new Xe){super(),this.isCubicBezierCurve=!0,this.type="CubicBezierCurve",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Xe){const n=t,i=this.v0,s=this.v1,a=this.v2,l=this.v3;return n.set(r_(e,i.x,s.x,a.x,l.x),r_(e,i.y,s.y,a.y,l.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class PU extends ql{constructor(e=new Y,t=new Y,n=new Y,i=new Y){super(),this.isCubicBezierCurve3=!0,this.type="CubicBezierCurve3",this.v0=e,this.v1=t,this.v2=n,this.v3=i}getPoint(e,t=new Y){const n=t,i=this.v0,s=this.v1,a=this.v2,l=this.v3;return n.set(r_(e,i.x,s.x,a.x,l.x),r_(e,i.y,s.y,a.y,l.y),r_(e,i.z,s.z,a.z,l.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this}}class X1 extends ql{constructor(e=new Xe,t=new Xe){super(),this.isLineCurve=!0,this.type="LineCurve",this.v1=e,this.v2=t}getPoint(e,t=new Xe){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Xe){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class IU extends ql{constructor(e=new Y,t=new Y){super(),this.isLineCurve3=!0,this.type="LineCurve3",this.v1=e,this.v2=t}getPoint(e,t=new Y){const n=t;return e===1?n.copy(this.v2):(n.copy(this.v2).sub(this.v1),n.multiplyScalar(e).add(this.v1)),n}getPointAt(e,t){return this.getPoint(e,t)}getTangent(e,t=new Y){return t.subVectors(this.v2,this.v1).normalize()}getTangentAt(e,t){return this.getTangent(e,t)}copy(e){return super.copy(e),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Y1 extends ql{constructor(e=new Xe,t=new Xe,n=new Xe){super(),this.isQuadraticBezierCurve=!0,this.type="QuadraticBezierCurve",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Xe){const n=t,i=this.v0,s=this.v1,a=this.v2;return n.set(s_(e,i.x,s.x,a.x),s_(e,i.y,s.y,a.y)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class j1 extends ql{constructor(e=new Y,t=new Y,n=new Y){super(),this.isQuadraticBezierCurve3=!0,this.type="QuadraticBezierCurve3",this.v0=e,this.v1=t,this.v2=n}getPoint(e,t=new Y){const n=t,i=this.v0,s=this.v1,a=this.v2;return n.set(s_(e,i.x,s.x,a.x),s_(e,i.y,s.y,a.y),s_(e,i.z,s.z,a.z)),n}copy(e){return super.copy(e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this}toJSON(){const e=super.toJSON();return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e}fromJSON(e){return super.fromJSON(e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this}}class Z1 extends ql{constructor(e=[]){super(),this.isSplineCurve=!0,this.type="SplineCurve",this.points=e}getPoint(e,t=new Xe){const n=t,i=this.points,s=(i.length-1)*e,a=Math.floor(s),l=s-a,c=i[a===0?a:a-1],d=i[a],m=i[a>i.length-2?i.length-1:a+1],y=i[a>i.length-3?i.length-1:a+2];return n.set(gw(l,c.x,d.x,m.x,y.x),gw(l,c.y,d.y,m.y,y.y)),n}copy(e){super.copy(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.points=[];for(let t=0,n=this.points.length;t<n;t++){const i=this.points[t];e.points.push(i.toArray())}return e}fromJSON(e){super.fromJSON(e),this.points=[];for(let t=0,n=e.points.length;t<n;t++){const i=e.points[t];this.points.push(new Xe().fromArray(i))}return this}}var _b=Object.freeze({__proto__:null,ArcCurve:BU,CatmullRomCurve3:OU,CubicBezierCurve:W1,CubicBezierCurve3:PU,EllipseCurve:mT,LineCurve:X1,LineCurve3:IU,QuadraticBezierCurve:Y1,QuadraticBezierCurve3:j1,SplineCurve:Z1});class FU extends ql{constructor(){super(),this.type="CurvePath",this.curves=[],this.autoClose=!1}add(e){this.curves.push(e)}closePath(){const e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);if(!e.equals(t)){const n=e.isVector2===!0?"LineCurve":"LineCurve3";this.curves.push(new _b[n](t,e))}return this}getPoint(e,t){const n=e*this.getLength(),i=this.getCurveLengths();let s=0;for(;s<i.length;){if(i[s]>=n){const a=i[s]-n,l=this.curves[s],c=l.getLength(),d=c===0?0:1-a/c;return l.getPointAt(d,t)}s++}return null}getLength(){const e=this.getCurveLengths();return e[e.length-1]}updateArcLengths(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()}getCurveLengths(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;const e=[];let t=0;for(let n=0,i=this.curves.length;n<i;n++)t+=this.curves[n].getLength(),e.push(t);return this.cacheLengths=e,e}getSpacedPoints(e=40){const t=[];for(let n=0;n<=e;n++)t.push(this.getPoint(n/e));return this.autoClose&&t.push(t[0]),t}getPoints(e=12){const t=[];let n;for(let i=0,s=this.curves;i<s.length;i++){const a=s[i],l=a.isEllipseCurve?e*2:a.isLineCurve||a.isLineCurve3?1:a.isSplineCurve?e*a.points.length:e,c=a.getPoints(l);for(let d=0;d<c.length;d++){const m=c[d];n&&n.equals(m)||(t.push(m),n=m)}}return this.autoClose&&t.length>1&&!t[t.length-1].equals(t[0])&&t.push(t[0]),t}copy(e){super.copy(e),this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this}toJSON(){const e=super.toJSON();e.autoClose=this.autoClose,e.curves=[];for(let t=0,n=this.curves.length;t<n;t++){const i=this.curves[t];e.curves.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.autoClose=e.autoClose,this.curves=[];for(let t=0,n=e.curves.length;t<n;t++){const i=e.curves[t];this.curves.push(new _b[i.type]().fromJSON(i))}return this}}class v_ extends FU{constructor(e){super(),this.type="Path",this.currentPoint=new Xe,e&&this.setFromPoints(e)}setFromPoints(e){this.moveTo(e[0].x,e[0].y);for(let t=1,n=e.length;t<n;t++)this.lineTo(e[t].x,e[t].y);return this}moveTo(e,t){return this.currentPoint.set(e,t),this}lineTo(e,t){const n=new X1(this.currentPoint.clone(),new Xe(e,t));return this.curves.push(n),this.currentPoint.set(e,t),this}quadraticCurveTo(e,t,n,i){const s=new Y1(this.currentPoint.clone(),new Xe(e,t),new Xe(n,i));return this.curves.push(s),this.currentPoint.set(n,i),this}bezierCurveTo(e,t,n,i,s,a){const l=new W1(this.currentPoint.clone(),new Xe(e,t),new Xe(n,i),new Xe(s,a));return this.curves.push(l),this.currentPoint.set(s,a),this}splineThru(e){const t=[this.currentPoint.clone()].concat(e),n=new Z1(t);return this.curves.push(n),this.currentPoint.copy(e[e.length-1]),this}arc(e,t,n,i,s,a){const l=this.currentPoint.x,c=this.currentPoint.y;return this.absarc(e+l,t+c,n,i,s,a),this}absarc(e,t,n,i,s,a){return this.absellipse(e,t,n,n,i,s,a),this}ellipse(e,t,n,i,s,a,l,c){const d=this.currentPoint.x,m=this.currentPoint.y;return this.absellipse(e+d,t+m,n,i,s,a,l,c),this}absellipse(e,t,n,i,s,a,l,c){const d=new mT(e,t,n,i,s,a,l,c);if(this.curves.length>0){const y=d.getPoint(0);y.equals(this.currentPoint)||this.lineTo(y.x,y.y)}this.curves.push(d);const m=d.getPoint(1);return this.currentPoint.copy(m),this}copy(e){return super.copy(e),this.currentPoint.copy(e.currentPoint),this}toJSON(){const e=super.toJSON();return e.currentPoint=this.currentPoint.toArray(),e}fromJSON(e){return super.fromJSON(e),this.currentPoint.fromArray(e.currentPoint),this}}class j_ extends fn{constructor(e=[new Xe(0,-.5),new Xe(.5,0),new Xe(0,.5)],t=12,n=0,i=Math.PI*2){super(),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:n,phiLength:i},t=Math.floor(t),i=hn(i,0,Math.PI*2);const s=[],a=[],l=[],c=[],d=[],m=1/t,y=new Y,v=new Xe,x=new Y,S=new Y,A=new Y;let E=0,M=0;for(let C=0;C<=e.length-1;C++)switch(C){case 0:E=e[C+1].x-e[C].x,M=e[C+1].y-e[C].y,x.x=M*1,x.y=-E,x.z=M*0,A.copy(x),x.normalize(),c.push(x.x,x.y,x.z);break;case e.length-1:c.push(A.x,A.y,A.z);break;default:E=e[C+1].x-e[C].x,M=e[C+1].y-e[C].y,x.x=M*1,x.y=-E,x.z=M*0,S.copy(x),x.x+=A.x,x.y+=A.y,x.z+=A.z,x.normalize(),c.push(x.x,x.y,x.z),A.copy(S)}for(let C=0;C<=t;C++){const w=n+C*m*i,D=Math.sin(w),z=Math.cos(w);for(let B=0;B<=e.length-1;B++){y.x=e[B].x*D,y.y=e[B].y,y.z=e[B].x*z,a.push(y.x,y.y,y.z),v.x=C/t,v.y=B/(e.length-1),l.push(v.x,v.y);const F=c[3*B+0]*D,H=c[3*B+1],I=c[3*B+0]*z;d.push(F,H,I)}}for(let C=0;C<t;C++)for(let w=0;w<e.length-1;w++){const D=w+C*e.length,z=D,B=D+e.length,F=D+e.length+1,H=D+1;s.push(z,B,H),s.push(F,H,B)}this.setIndex(s),this.setAttribute("position",new Et(a,3)),this.setAttribute("uv",new Et(l,2)),this.setAttribute("normal",new Et(d,3))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new j_(e.points,e.segments,e.phiStart,e.phiLength)}}class gT extends j_{constructor(e=1,t=1,n=4,i=8){const s=new v_;s.absarc(0,-t/2,e,Math.PI*1.5,0),s.absarc(0,t/2,e,0,Math.PI*.5),super(s.getPoints(n),i),this.type="CapsuleGeometry",this.parameters={radius:e,length:t,capSegments:n,radialSegments:i}}static fromJSON(e){return new gT(e.radius,e.length,e.capSegments,e.radialSegments)}}class yT extends fn{constructor(e=1,t=32,n=0,i=Math.PI*2){super(),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:n,thetaLength:i},t=Math.max(3,t);const s=[],a=[],l=[],c=[],d=new Y,m=new Xe;a.push(0,0,0),l.push(0,0,1),c.push(.5,.5);for(let y=0,v=3;y<=t;y++,v+=3){const x=n+y/t*i;d.x=e*Math.cos(x),d.y=e*Math.sin(x),a.push(d.x,d.y,d.z),l.push(0,0,1),m.x=(a[v]/e+1)/2,m.y=(a[v+1]/e+1)/2,c.push(m.x,m.y)}for(let y=1;y<=t;y++)s.push(y,y+1,0);this.setIndex(s),this.setAttribute("position",new Et(a,3)),this.setAttribute("normal",new Et(l,3)),this.setAttribute("uv",new Et(c,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new yT(e.radius,e.segments,e.thetaStart,e.thetaLength)}}class xp extends fn{constructor(e=1,t=1,n=1,i=32,s=1,a=!1,l=0,c=Math.PI*2){super(),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:n,radialSegments:i,heightSegments:s,openEnded:a,thetaStart:l,thetaLength:c};const d=this;i=Math.floor(i),s=Math.floor(s);const m=[],y=[],v=[],x=[];let S=0;const A=[],E=n/2;let M=0;C(),a===!1&&(e>0&&w(!0),t>0&&w(!1)),this.setIndex(m),this.setAttribute("position",new Et(y,3)),this.setAttribute("normal",new Et(v,3)),this.setAttribute("uv",new Et(x,2));function C(){const D=new Y,z=new Y;let B=0;const F=(t-e)/n;for(let H=0;H<=s;H++){const I=[],P=H/s,Z=P*(t-e)+e;for(let ue=0;ue<=i;ue++){const se=ue/i,pe=se*c+l,Se=Math.sin(pe),V=Math.cos(pe);z.x=Z*Se,z.y=-P*n+E,z.z=Z*V,y.push(z.x,z.y,z.z),D.set(Se,F,V).normalize(),v.push(D.x,D.y,D.z),x.push(se,1-P),I.push(S++)}A.push(I)}for(let H=0;H<i;H++)for(let I=0;I<s;I++){const P=A[I][H],Z=A[I+1][H],ue=A[I+1][H+1],se=A[I][H+1];(e>0||I!==0)&&(m.push(P,Z,se),B+=3),(t>0||I!==s-1)&&(m.push(Z,ue,se),B+=3)}d.addGroup(M,B,0),M+=B}function w(D){const z=S,B=new Xe,F=new Y;let H=0;const I=D===!0?e:t,P=D===!0?1:-1;for(let ue=1;ue<=i;ue++)y.push(0,E*P,0),v.push(0,P,0),x.push(.5,.5),S++;const Z=S;for(let ue=0;ue<=i;ue++){const pe=ue/i*c+l,Se=Math.cos(pe),V=Math.sin(pe);F.x=I*V,F.y=E*P,F.z=I*Se,y.push(F.x,F.y,F.z),v.push(0,P,0),B.x=Se*.5+.5,B.y=V*.5*P+.5,x.push(B.x,B.y),S++}for(let ue=0;ue<i;ue++){const se=z+ue,pe=Z+ue;D===!0?m.push(pe,pe+1,se):m.push(pe+1,pe,se),H+=3}d.addGroup(M,H,D===!0?1:2),M+=H}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new xp(e.radiusTop,e.radiusBottom,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class vT extends xp{constructor(e=1,t=1,n=32,i=1,s=!1,a=0,l=Math.PI*2){super(0,e,t,n,i,s,a,l),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:n,heightSegments:i,openEnded:s,thetaStart:a,thetaLength:l}}static fromJSON(e){return new vT(e.radius,e.height,e.radialSegments,e.heightSegments,e.openEnded,e.thetaStart,e.thetaLength)}}class df extends fn{constructor(e=[],t=[],n=1,i=0){super(),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:n,detail:i};const s=[],a=[];l(i),d(n),m(),this.setAttribute("position",new Et(s,3)),this.setAttribute("normal",new Et(s.slice(),3)),this.setAttribute("uv",new Et(a,2)),i===0?this.computeVertexNormals():this.normalizeNormals();function l(C){const w=new Y,D=new Y,z=new Y;for(let B=0;B<t.length;B+=3)x(t[B+0],w),x(t[B+1],D),x(t[B+2],z),c(w,D,z,C)}function c(C,w,D,z){const B=z+1,F=[];for(let H=0;H<=B;H++){F[H]=[];const I=C.clone().lerp(D,H/B),P=w.clone().lerp(D,H/B),Z=B-H;for(let ue=0;ue<=Z;ue++)ue===0&&H===B?F[H][ue]=I:F[H][ue]=I.clone().lerp(P,ue/Z)}for(let H=0;H<B;H++)for(let I=0;I<2*(B-H)-1;I++){const P=Math.floor(I/2);I%2===0?(v(F[H][P+1]),v(F[H+1][P]),v(F[H][P])):(v(F[H][P+1]),v(F[H+1][P+1]),v(F[H+1][P]))}}function d(C){const w=new Y;for(let D=0;D<s.length;D+=3)w.x=s[D+0],w.y=s[D+1],w.z=s[D+2],w.normalize().multiplyScalar(C),s[D+0]=w.x,s[D+1]=w.y,s[D+2]=w.z}function m(){const C=new Y;for(let w=0;w<s.length;w+=3){C.x=s[w+0],C.y=s[w+1],C.z=s[w+2];const D=E(C)/2/Math.PI+.5,z=M(C)/Math.PI+.5;a.push(D,1-z)}S(),y()}function y(){for(let C=0;C<a.length;C+=6){const w=a[C+0],D=a[C+2],z=a[C+4],B=Math.max(w,D,z),F=Math.min(w,D,z);B>.9&&F<.1&&(w<.2&&(a[C+0]+=1),D<.2&&(a[C+2]+=1),z<.2&&(a[C+4]+=1))}}function v(C){s.push(C.x,C.y,C.z)}function x(C,w){const D=C*3;w.x=e[D+0],w.y=e[D+1],w.z=e[D+2]}function S(){const C=new Y,w=new Y,D=new Y,z=new Y,B=new Xe,F=new Xe,H=new Xe;for(let I=0,P=0;I<s.length;I+=9,P+=6){C.set(s[I+0],s[I+1],s[I+2]),w.set(s[I+3],s[I+4],s[I+5]),D.set(s[I+6],s[I+7],s[I+8]),B.set(a[P+0],a[P+1]),F.set(a[P+2],a[P+3]),H.set(a[P+4],a[P+5]),z.copy(C).add(w).add(D).divideScalar(3);const Z=E(z);A(B,P+0,C,Z),A(F,P+2,w,Z),A(H,P+4,D,Z)}}function A(C,w,D,z){z<0&&C.x===1&&(a[w]=C.x-1),D.x===0&&D.z===0&&(a[w]=z/2/Math.PI+.5)}function E(C){return Math.atan2(C.z,-C.x)}function M(C){return Math.atan2(-C.y,Math.sqrt(C.x*C.x+C.z*C.z))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new df(e.vertices,e.indices,e.radius,e.details)}}class _T extends df{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=1/n,s=[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-n,0,-i,n,0,i,-n,0,i,n,-i,-n,0,-i,n,0,i,-n,0,i,n,0,-n,0,-i,n,0,-i,-n,0,i,n,0,i],a=[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9];super(s,a,e,t),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new _T(e.radius,e.detail)}}const _S=new Y,xS=new Y,TE=new Y,SS=new Fa;class zU extends fn{constructor(e=null,t=1){if(super(),this.type="EdgesGeometry",this.parameters={geometry:e,thresholdAngle:t},e!==null){const i=Math.pow(10,4),s=Math.cos(Gd*t),a=e.getIndex(),l=e.getAttribute("position"),c=a?a.count:l.count,d=[0,0,0],m=["a","b","c"],y=new Array(3),v={},x=[];for(let S=0;S<c;S+=3){a?(d[0]=a.getX(S),d[1]=a.getX(S+1),d[2]=a.getX(S+2)):(d[0]=S,d[1]=S+1,d[2]=S+2);const{a:A,b:E,c:M}=SS;if(A.fromBufferAttribute(l,d[0]),E.fromBufferAttribute(l,d[1]),M.fromBufferAttribute(l,d[2]),SS.getNormal(TE),y[0]=`${Math.round(A.x*i)},${Math.round(A.y*i)},${Math.round(A.z*i)}`,y[1]=`${Math.round(E.x*i)},${Math.round(E.y*i)},${Math.round(E.z*i)}`,y[2]=`${Math.round(M.x*i)},${Math.round(M.y*i)},${Math.round(M.z*i)}`,!(y[0]===y[1]||y[1]===y[2]||y[2]===y[0]))for(let C=0;C<3;C++){const w=(C+1)%3,D=y[C],z=y[w],B=SS[m[C]],F=SS[m[w]],H=`${D}_${z}`,I=`${z}_${D}`;I in v&&v[I]?(TE.dot(v[I].normal)<=s&&(x.push(B.x,B.y,B.z),x.push(F.x,F.y,F.z)),v[I]=null):H in v||(v[H]={index0:d[C],index1:d[w],normal:TE.clone()})}}for(const S in v)if(v[S]){const{index0:A,index1:E}=v[S];_S.fromBufferAttribute(l,A),xS.fromBufferAttribute(l,E),x.push(_S.x,_S.y,_S.z),x.push(xS.x,xS.y,xS.z)}this.setAttribute("position",new Et(x,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}class Hd extends v_{constructor(e){super(e),this.uuid=So(),this.type="Shape",this.holes=[]}getPointsHoles(e){const t=[];for(let n=0,i=this.holes.length;n<i;n++)t[n]=this.holes[n].getPoints(e);return t}extractPoints(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}}copy(e){super.copy(e),this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(i.clone())}return this}toJSON(){const e=super.toJSON();e.uuid=this.uuid,e.holes=[];for(let t=0,n=this.holes.length;t<n;t++){const i=this.holes[t];e.holes.push(i.toJSON())}return e}fromJSON(e){super.fromJSON(e),this.uuid=e.uuid,this.holes=[];for(let t=0,n=e.holes.length;t<n;t++){const i=e.holes[t];this.holes.push(new v_().fromJSON(i))}return this}}function Kz(r,e,t=2){const n=e&&e.length,i=n?e[0]*t:r.length;let s=VU(r,0,i,t,!0);const a=[];if(!s||s.next===s.prev)return a;let l,c,d;if(n&&(s=tV(r,e,s,t)),r.length>80*t){l=1/0,c=1/0;let m=-1/0,y=-1/0;for(let v=t;v<i;v+=t){const x=r[v],S=r[v+1];x<l&&(l=x),S<c&&(c=S),x>m&&(m=x),S>y&&(y=S)}d=Math.max(m-l,y-c),d=d!==0?32767/d:0}return __(s,a,t,l,c,d,0),a}function VU(r,e,t,n,i){let s;if(i===fV(r,e,t,n)>0)for(let a=e;a<t;a+=n)s=yw(a/n|0,r[a],r[a+1],s);else for(let a=t-n;a>=e;a-=n)s=yw(a/n|0,r[a],r[a+1],s);return s&&Gg(s,s.next)&&(S_(s),s=s.next),s}function dp(r,e){if(!r)return r;e||(e=r);let t=r,n;do if(n=!1,!t.steiner&&(Gg(t,t.next)||$i(t.prev,t,t.next)===0)){if(S_(t),t=e=t.prev,t===t.next)break;n=!0}else t=t.next;while(n||t!==e);return e}function __(r,e,t,n,i,s,a){if(!r)return;!a&&s&&aV(r,n,i,s);let l=r;for(;r.prev!==r.next;){const c=r.prev,d=r.next;if(s?Jz(r,n,i,s):Qz(r)){e.push(c.i,r.i,d.i),S_(r),r=d.next,l=d.next;continue}if(r=d,r===l){a?a===1?(r=$z(dp(r),e),__(r,e,t,n,i,s,2)):a===2&&eV(r,e,t,n,i,s):__(dp(r),e,t,n,i,s,1);break}}}function Qz(r){const e=r.prev,t=r,n=r.next;if($i(e,t,n)>=0)return!1;const i=e.x,s=t.x,a=n.x,l=e.y,c=t.y,d=n.y,m=Math.min(i,s,a),y=Math.min(l,c,d),v=Math.max(i,s,a),x=Math.max(l,c,d);let S=n.next;for(;S!==e;){if(S.x>=m&&S.x<=v&&S.y>=y&&S.y<=x&&Qv(i,l,s,c,a,d,S.x,S.y)&&$i(S.prev,S,S.next)>=0)return!1;S=S.next}return!0}function Jz(r,e,t,n){const i=r.prev,s=r,a=r.next;if($i(i,s,a)>=0)return!1;const l=i.x,c=s.x,d=a.x,m=i.y,y=s.y,v=a.y,x=Math.min(l,c,d),S=Math.min(m,y,v),A=Math.max(l,c,d),E=Math.max(m,y,v),M=FA(x,S,e,t,n),C=FA(A,E,e,t,n);let w=r.prevZ,D=r.nextZ;for(;w&&w.z>=M&&D&&D.z<=C;){if(w.x>=x&&w.x<=A&&w.y>=S&&w.y<=E&&w!==i&&w!==a&&Qv(l,m,c,y,d,v,w.x,w.y)&&$i(w.prev,w,w.next)>=0||(w=w.prevZ,D.x>=x&&D.x<=A&&D.y>=S&&D.y<=E&&D!==i&&D!==a&&Qv(l,m,c,y,d,v,D.x,D.y)&&$i(D.prev,D,D.next)>=0))return!1;D=D.nextZ}for(;w&&w.z>=M;){if(w.x>=x&&w.x<=A&&w.y>=S&&w.y<=E&&w!==i&&w!==a&&Qv(l,m,c,y,d,v,w.x,w.y)&&$i(w.prev,w,w.next)>=0)return!1;w=w.prevZ}for(;D&&D.z<=C;){if(D.x>=x&&D.x<=A&&D.y>=S&&D.y<=E&&D!==i&&D!==a&&Qv(l,m,c,y,d,v,D.x,D.y)&&$i(D.prev,D,D.next)>=0)return!1;D=D.nextZ}return!0}function $z(r,e){let t=r;do{const n=t.prev,i=t.next.next;!Gg(n,i)&&HU(n,t,t.next,i)&&x_(n,i)&&x_(i,n)&&(e.push(n.i,t.i,i.i),S_(t),S_(t.next),t=r=i),t=t.next}while(t!==r);return dp(t)}function eV(r,e,t,n,i,s){let a=r;do{let l=a.next.next;for(;l!==a.prev;){if(a.i!==l.i&&uV(a,l)){let c=kU(a,l);a=dp(a,a.next),c=dp(c,c.next),__(a,e,t,n,i,s,0),__(c,e,t,n,i,s,0);return}l=l.next}a=a.next}while(a!==r)}function tV(r,e,t,n){const i=[];for(let s=0,a=e.length;s<a;s++){const l=e[s]*n,c=s<a-1?e[s+1]*n:r.length,d=VU(r,l,c,n,!1);d===d.next&&(d.steiner=!0),i.push(lV(d))}i.sort(nV);for(let s=0;s<i.length;s++)t=iV(i[s],t);return t}function nV(r,e){let t=r.x-e.x;if(t===0&&(t=r.y-e.y,t===0)){const n=(r.next.y-r.y)/(r.next.x-r.x),i=(e.next.y-e.y)/(e.next.x-e.x);t=n-i}return t}function iV(r,e){const t=sV(r,e);if(!t)return e;const n=kU(t,r);return dp(n,n.next),dp(t,t.next)}function sV(r,e){let t=e;const n=r.x,i=r.y;let s=-1/0,a;if(Gg(r,t))return t;do{if(Gg(r,t.next))return t.next;if(i<=t.y&&i>=t.next.y&&t.next.y!==t.y){const y=t.x+(i-t.y)*(t.next.x-t.x)/(t.next.y-t.y);if(y<=n&&y>s&&(s=y,a=t.x<t.next.x?t:t.next,y===n))return a}t=t.next}while(t!==e);if(!a)return null;const l=a,c=a.x,d=a.y;let m=1/0;t=a;do{if(n>=t.x&&t.x>=c&&n!==t.x&&GU(i<d?n:s,i,c,d,i<d?s:n,i,t.x,t.y)){const y=Math.abs(i-t.y)/(n-t.x);x_(t,r)&&(y<m||y===m&&(t.x>a.x||t.x===a.x&&rV(a,t)))&&(a=t,m=y)}t=t.next}while(t!==l);return a}function rV(r,e){return $i(r.prev,r,e.prev)<0&&$i(e.next,r,r.next)<0}function aV(r,e,t,n){let i=r;do i.z===0&&(i.z=FA(i.x,i.y,e,t,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next;while(i!==r);i.prevZ.nextZ=null,i.prevZ=null,oV(i)}function oV(r){let e,t=1;do{let n=r,i;r=null;let s=null;for(e=0;n;){e++;let a=n,l=0;for(let d=0;d<t&&(l++,a=a.nextZ,!!a);d++);let c=t;for(;l>0||c>0&&a;)l!==0&&(c===0||!a||n.z<=a.z)?(i=n,n=n.nextZ,l--):(i=a,a=a.nextZ,c--),s?s.nextZ=i:r=i,i.prevZ=s,s=i;n=a}s.nextZ=null,t*=2}while(e>1);return r}function FA(r,e,t,n,i){return r=(r-t)*i|0,e=(e-n)*i|0,r=(r|r<<8)&16711935,r=(r|r<<4)&252645135,r=(r|r<<2)&858993459,r=(r|r<<1)&1431655765,e=(e|e<<8)&16711935,e=(e|e<<4)&252645135,e=(e|e<<2)&858993459,e=(e|e<<1)&1431655765,r|e<<1}function lV(r){let e=r,t=r;do(e.x<t.x||e.x===t.x&&e.y<t.y)&&(t=e),e=e.next;while(e!==r);return t}function GU(r,e,t,n,i,s,a,l){return(i-a)*(e-l)>=(r-a)*(s-l)&&(r-a)*(n-l)>=(t-a)*(e-l)&&(t-a)*(s-l)>=(i-a)*(n-l)}function Qv(r,e,t,n,i,s,a,l){return!(r===a&&e===l)&&GU(r,e,t,n,i,s,a,l)}function uV(r,e){return r.next.i!==e.i&&r.prev.i!==e.i&&!cV(r,e)&&(x_(r,e)&&x_(e,r)&&hV(r,e)&&($i(r.prev,r,e.prev)||$i(r,e.prev,e))||Gg(r,e)&&$i(r.prev,r,r.next)>0&&$i(e.prev,e,e.next)>0)}function $i(r,e,t){return(e.y-r.y)*(t.x-e.x)-(e.x-r.x)*(t.y-e.y)}function Gg(r,e){return r.x===e.x&&r.y===e.y}function HU(r,e,t,n){const i=TS($i(r,e,t)),s=TS($i(r,e,n)),a=TS($i(t,n,r)),l=TS($i(t,n,e));return!!(i!==s&&a!==l||i===0&&bS(r,t,e)||s===0&&bS(r,n,e)||a===0&&bS(t,r,n)||l===0&&bS(t,e,n))}function bS(r,e,t){return e.x<=Math.max(r.x,t.x)&&e.x>=Math.min(r.x,t.x)&&e.y<=Math.max(r.y,t.y)&&e.y>=Math.min(r.y,t.y)}function TS(r){return r>0?1:r<0?-1:0}function cV(r,e){let t=r;do{if(t.i!==r.i&&t.next.i!==r.i&&t.i!==e.i&&t.next.i!==e.i&&HU(t,t.next,r,e))return!0;t=t.next}while(t!==r);return!1}function x_(r,e){return $i(r.prev,r,r.next)<0?$i(r,e,r.next)>=0&&$i(r,r.prev,e)>=0:$i(r,e,r.prev)<0||$i(r,r.next,e)<0}function hV(r,e){let t=r,n=!1;const i=(r.x+e.x)/2,s=(r.y+e.y)/2;do t.y>s!=t.next.y>s&&t.next.y!==t.y&&i<(t.next.x-t.x)*(s-t.y)/(t.next.y-t.y)+t.x&&(n=!n),t=t.next;while(t!==r);return n}function kU(r,e){const t=zA(r.i,r.x,r.y),n=zA(e.i,e.x,e.y),i=r.next,s=e.prev;return r.next=e,e.prev=r,t.next=i,i.prev=t,n.next=t,t.prev=n,s.next=n,n.prev=s,n}function yw(r,e,t,n){const i=zA(r,e,t);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function S_(r){r.next.prev=r.prev,r.prev.next=r.next,r.prevZ&&(r.prevZ.nextZ=r.nextZ),r.nextZ&&(r.nextZ.prevZ=r.prevZ)}function zA(r,e,t){return{i:r,x:e,y:t,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function fV(r,e,t,n){let i=0;for(let s=e,a=t-n;s<t;s+=n)i+=(r[a]-r[s])*(r[s+1]+r[a+1]),a=s;return i}class dV{static triangulate(e,t,n=2){return Kz(e,t,n)}}class Uu{static area(e){const t=e.length;let n=0;for(let i=t-1,s=0;s<t;i=s++)n+=e[i].x*e[s].y-e[s].x*e[i].y;return n*.5}static isClockWise(e){return Uu.area(e)<0}static triangulateShape(e,t){const n=[],i=[],s=[];vw(e),_w(n,e);let a=e.length;t.forEach(vw);for(let c=0;c<t.length;c++)i.push(a),a+=t[c].length,_w(n,t[c]);const l=dV.triangulate(n,i);for(let c=0;c<l.length;c+=3)s.push(l.slice(c,c+3));return s}}function vw(r){const e=r.length;e>2&&r[e-1].equals(r[0])&&r.pop()}function _w(r,e){for(let t=0;t<e.length;t++)r.push(e[t].x),r.push(e[t].y)}class xT extends fn{constructor(e=new Hd([new Xe(.5,.5),new Xe(-.5,.5),new Xe(-.5,-.5),new Xe(.5,-.5)]),t={}){super(),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},e=Array.isArray(e)?e:[e];const n=this,i=[],s=[];for(let l=0,c=e.length;l<c;l++){const d=e[l];a(d)}this.setAttribute("position",new Et(i,3)),this.setAttribute("uv",new Et(s,2)),this.computeVertexNormals();function a(l){const c=[],d=t.curveSegments!==void 0?t.curveSegments:12,m=t.steps!==void 0?t.steps:1,y=t.depth!==void 0?t.depth:1;let v=t.bevelEnabled!==void 0?t.bevelEnabled:!0,x=t.bevelThickness!==void 0?t.bevelThickness:.2,S=t.bevelSize!==void 0?t.bevelSize:x-.1,A=t.bevelOffset!==void 0?t.bevelOffset:0,E=t.bevelSegments!==void 0?t.bevelSegments:3;const M=t.extrudePath,C=t.UVGenerator!==void 0?t.UVGenerator:pV;let w,D=!1,z,B,F,H;M&&(w=M.getSpacedPoints(m),D=!0,v=!1,z=M.computeFrenetFrames(m,!1),B=new Y,F=new Y,H=new Y),v||(E=0,x=0,S=0,A=0);const I=l.extractPoints(d);let P=I.shape;const Z=I.holes;if(!Uu.isClockWise(P)){P=P.reverse();for(let Ze=0,Ge=Z.length;Ze<Ge;Ze++){const He=Z[Ze];Uu.isClockWise(He)&&(Z[Ze]=He.reverse())}}function se(Ze){const He=10000000000000001e-36;let at=Ze[0];for(let Ie=1;Ie<=Ze.length;Ie++){const j=Ie%Ze.length,G=Ze[j],de=G.x-at.x,Le=G.y-at.y,ke=de*de+Le*Le,Be=Math.max(Math.abs(G.x),Math.abs(G.y),Math.abs(at.x),Math.abs(at.y)),ct=He*Be*Be;if(ke<=ct){Ze.splice(j,1),Ie--;continue}at=G}}se(P),Z.forEach(se);const pe=Z.length,Se=P;for(let Ze=0;Ze<pe;Ze++){const Ge=Z[Ze];P=P.concat(Ge)}function V(Ze,Ge,He){return Ge||console.error("THREE.ExtrudeGeometry: vec does not exist"),Ze.clone().addScaledVector(Ge,He)}const Q=P.length;function J(Ze,Ge,He){let at,Ie,j;const G=Ze.x-Ge.x,de=Ze.y-Ge.y,Le=He.x-Ze.x,ke=He.y-Ze.y,Be=G*G+de*de,ct=G*ke-de*Le;if(Math.abs(ct)>Number.EPSILON){const it=Math.sqrt(Be),ot=Math.sqrt(Le*Le+ke*ke),xn=Ge.x-de/it,et=Ge.y+G/it,St=He.x-ke/ot,Rt=He.y+Le/ot,Nt=((St-xn)*ke-(Rt-et)*Le)/(G*ke-de*Le);at=xn+G*Nt-Ze.x,Ie=et+de*Nt-Ze.y;const ht=at*at+Ie*Ie;if(ht<=2)return new Xe(at,Ie);j=Math.sqrt(ht/2)}else{let it=!1;G>Number.EPSILON?Le>Number.EPSILON&&(it=!0):G<-Number.EPSILON?Le<-Number.EPSILON&&(it=!0):Math.sign(de)===Math.sign(ke)&&(it=!0),it?(at=-de,Ie=G,j=Math.sqrt(Be)):(at=G,Ie=de,j=Math.sqrt(Be/2))}return new Xe(at/j,Ie/j)}const ve=[];for(let Ze=0,Ge=Se.length,He=Ge-1,at=Ze+1;Ze<Ge;Ze++,He++,at++)He===Ge&&(He=0),at===Ge&&(at=0),ve[Ze]=J(Se[Ze],Se[He],Se[at]);const X=[];let re,we=ve.concat();for(let Ze=0,Ge=pe;Ze<Ge;Ze++){const He=Z[Ze];re=[];for(let at=0,Ie=He.length,j=Ie-1,G=at+1;at<Ie;at++,j++,G++)j===Ie&&(j=0),G===Ie&&(G=0),re[at]=J(He[at],He[j],He[G]);X.push(re),we=we.concat(re)}const Fe=[],oe=[];for(let Ze=0;Ze<E;Ze++){const Ge=Ze/E,He=x*Math.cos(Ge*Math.PI/2),at=S*Math.sin(Ge*Math.PI/2)+A;for(let Ie=0,j=Se.length;Ie<j;Ie++){const G=V(Se[Ie],ve[Ie],at);mn(G.x,G.y,-He),Ge==0&&Fe.push(G)}for(let Ie=0,j=pe;Ie<j;Ie++){const G=Z[Ie];re=X[Ie];const de=[];for(let Le=0,ke=G.length;Le<ke;Le++){const Be=V(G[Le],re[Le],at);mn(Be.x,Be.y,-He),Ge==0&&de.push(Be)}Ge==0&&oe.push(de)}}const De=Uu.triangulateShape(Fe,oe),je=De.length,nt=S+A;for(let Ze=0;Ze<Q;Ze++){const Ge=v?V(P[Ze],we[Ze],nt):P[Ze];D?(F.copy(z.normals[0]).multiplyScalar(Ge.x),B.copy(z.binormals[0]).multiplyScalar(Ge.y),H.copy(w[0]).add(F).add(B),mn(H.x,H.y,H.z)):mn(Ge.x,Ge.y,0)}for(let Ze=1;Ze<=m;Ze++)for(let Ge=0;Ge<Q;Ge++){const He=v?V(P[Ge],we[Ge],nt):P[Ge];D?(F.copy(z.normals[Ze]).multiplyScalar(He.x),B.copy(z.binormals[Ze]).multiplyScalar(He.y),H.copy(w[Ze]).add(F).add(B),mn(H.x,H.y,H.z)):mn(He.x,He.y,y/m*Ze)}for(let Ze=E-1;Ze>=0;Ze--){const Ge=Ze/E,He=x*Math.cos(Ge*Math.PI/2),at=S*Math.sin(Ge*Math.PI/2)+A;for(let Ie=0,j=Se.length;Ie<j;Ie++){const G=V(Se[Ie],ve[Ie],at);mn(G.x,G.y,y+He)}for(let Ie=0,j=Z.length;Ie<j;Ie++){const G=Z[Ie];re=X[Ie];for(let de=0,Le=G.length;de<Le;de++){const ke=V(G[de],re[de],at);D?mn(ke.x,ke.y+w[m-1].y,w[m-1].x+He):mn(ke.x,ke.y,y+He)}}}lt(),nn();function lt(){const Ze=i.length/3;if(v){let Ge=0,He=Q*Ge;for(let at=0;at<je;at++){const Ie=De[at];An(Ie[2]+He,Ie[1]+He,Ie[0]+He)}Ge=m+E*2,He=Q*Ge;for(let at=0;at<je;at++){const Ie=De[at];An(Ie[0]+He,Ie[1]+He,Ie[2]+He)}}else{for(let Ge=0;Ge<je;Ge++){const He=De[Ge];An(He[2],He[1],He[0])}for(let Ge=0;Ge<je;Ge++){const He=De[Ge];An(He[0]+Q*m,He[1]+Q*m,He[2]+Q*m)}}n.addGroup(Ze,i.length/3-Ze,0)}function nn(){const Ze=i.length/3;let Ge=0;Pt(Se,Ge),Ge+=Se.length;for(let He=0,at=Z.length;He<at;He++){const Ie=Z[He];Pt(Ie,Ge),Ge+=Ie.length}n.addGroup(Ze,i.length/3-Ze,1)}function Pt(Ze,Ge){let He=Ze.length;for(;--He>=0;){const at=He;let Ie=He-1;Ie<0&&(Ie=Ze.length-1);for(let j=0,G=m+E*2;j<G;j++){const de=Q*j,Le=Q*(j+1),ke=Ge+at+de,Be=Ge+Ie+de,ct=Ge+Ie+Le,it=Ge+at+Le;$t(ke,Be,ct,it)}}}function mn(Ze,Ge,He){c.push(Ze),c.push(Ge),c.push(He)}function An(Ze,Ge,He){ne(Ze),ne(Ge),ne(He);const at=i.length/3,Ie=C.generateTopUV(n,i,at-3,at-2,at-1);oi(Ie[0]),oi(Ie[1]),oi(Ie[2])}function $t(Ze,Ge,He,at){ne(Ze),ne(Ge),ne(at),ne(Ge),ne(He),ne(at);const Ie=i.length/3,j=C.generateSideWallUV(n,i,Ie-6,Ie-3,Ie-2,Ie-1);oi(j[0]),oi(j[1]),oi(j[3]),oi(j[1]),oi(j[2]),oi(j[3])}function ne(Ze){i.push(c[Ze*3+0]),i.push(c[Ze*3+1]),i.push(c[Ze*3+2])}function oi(Ze){s.push(Ze.x),s.push(Ze.y)}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes,n=this.parameters.options;return mV(t,n,e)}static fromJSON(e,t){const n=[];for(let s=0,a=e.shapes.length;s<a;s++){const l=t[e.shapes[s]];n.push(l)}const i=e.options.extrudePath;return i!==void 0&&(e.options.extrudePath=new _b[i.type]().fromJSON(i)),new xT(n,e.options)}}const pV={generateTopUV:function(r,e,t,n,i){const s=e[t*3],a=e[t*3+1],l=e[n*3],c=e[n*3+1],d=e[i*3],m=e[i*3+1];return[new Xe(s,a),new Xe(l,c),new Xe(d,m)]},generateSideWallUV:function(r,e,t,n,i,s){const a=e[t*3],l=e[t*3+1],c=e[t*3+2],d=e[n*3],m=e[n*3+1],y=e[n*3+2],v=e[i*3],x=e[i*3+1],S=e[i*3+2],A=e[s*3],E=e[s*3+1],M=e[s*3+2];return Math.abs(l-m)<Math.abs(a-d)?[new Xe(a,1-c),new Xe(d,1-y),new Xe(v,1-S),new Xe(A,1-M)]:[new Xe(l,1-c),new Xe(m,1-y),new Xe(x,1-S),new Xe(E,1-M)]}};function mV(r,e,t){if(t.shapes=[],Array.isArray(r))for(let n=0,i=r.length;n<i;n++){const s=r[n];t.shapes.push(s.uuid)}else t.shapes.push(r.uuid);return t.options=Object.assign({},e),e.extrudePath!==void 0&&(t.options.extrudePath=e.extrudePath.toJSON()),t}class ST extends df{constructor(e=1,t=0){const n=(1+Math.sqrt(5))/2,i=[-1,n,0,1,n,0,-1,-n,0,1,-n,0,0,-1,n,0,1,n,0,-1,-n,0,1,-n,n,0,-1,n,0,1,-n,0,-1,-n,0,1],s=[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1];super(i,s,e,t),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new ST(e.radius,e.detail)}}class Z_ extends df{constructor(e=1,t=0){const n=[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],i=[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2];super(n,i,e,t),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new Z_(e.radius,e.detail)}}class Sp extends fn{constructor(e=1,t=1,n=1,i=1){super(),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:n,heightSegments:i};const s=e/2,a=t/2,l=Math.floor(n),c=Math.floor(i),d=l+1,m=c+1,y=e/l,v=t/c,x=[],S=[],A=[],E=[];for(let M=0;M<m;M++){const C=M*v-a;for(let w=0;w<d;w++){const D=w*y-s;S.push(D,-C,0),A.push(0,0,1),E.push(w/l),E.push(1-M/c)}}for(let M=0;M<c;M++)for(let C=0;C<l;C++){const w=C+d*M,D=C+d*(M+1),z=C+1+d*(M+1),B=C+1+d*M;x.push(w,D,B),x.push(D,z,B)}this.setIndex(x),this.setAttribute("position",new Et(S,3)),this.setAttribute("normal",new Et(A,3)),this.setAttribute("uv",new Et(E,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new Sp(e.width,e.height,e.widthSegments,e.heightSegments)}}class bT extends fn{constructor(e=.5,t=1,n=32,i=1,s=0,a=Math.PI*2){super(),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:n,phiSegments:i,thetaStart:s,thetaLength:a},n=Math.max(3,n),i=Math.max(1,i);const l=[],c=[],d=[],m=[];let y=e;const v=(t-e)/i,x=new Y,S=new Xe;for(let A=0;A<=i;A++){for(let E=0;E<=n;E++){const M=s+E/n*a;x.x=y*Math.cos(M),x.y=y*Math.sin(M),c.push(x.x,x.y,x.z),d.push(0,0,1),S.x=(x.x/t+1)/2,S.y=(x.y/t+1)/2,m.push(S.x,S.y)}y+=v}for(let A=0;A<i;A++){const E=A*(n+1);for(let M=0;M<n;M++){const C=M+E,w=C,D=C+n+1,z=C+n+2,B=C+1;l.push(w,D,B),l.push(D,z,B)}}this.setIndex(l),this.setAttribute("position",new Et(c,3)),this.setAttribute("normal",new Et(d,3)),this.setAttribute("uv",new Et(m,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new bT(e.innerRadius,e.outerRadius,e.thetaSegments,e.phiSegments,e.thetaStart,e.thetaLength)}}class TT extends fn{constructor(e=new Hd([new Xe(0,.5),new Xe(-.5,-.5),new Xe(.5,-.5)]),t=12){super(),this.type="ShapeGeometry",this.parameters={shapes:e,curveSegments:t};const n=[],i=[],s=[],a=[];let l=0,c=0;if(Array.isArray(e)===!1)d(e);else for(let m=0;m<e.length;m++)d(e[m]),this.addGroup(l,c,m),l+=c,c=0;this.setIndex(n),this.setAttribute("position",new Et(i,3)),this.setAttribute("normal",new Et(s,3)),this.setAttribute("uv",new Et(a,2));function d(m){const y=i.length/3,v=m.extractPoints(t);let x=v.shape;const S=v.holes;Uu.isClockWise(x)===!1&&(x=x.reverse());for(let E=0,M=S.length;E<M;E++){const C=S[E];Uu.isClockWise(C)===!0&&(S[E]=C.reverse())}const A=Uu.triangulateShape(x,S);for(let E=0,M=S.length;E<M;E++){const C=S[E];x=x.concat(C)}for(let E=0,M=x.length;E<M;E++){const C=x[E];i.push(C.x,C.y,0),s.push(0,0,1),a.push(C.x,C.y)}for(let E=0,M=A.length;E<M;E++){const C=A[E],w=C[0]+y,D=C[1]+y,z=C[2]+y;n.push(w,D,z),c+=3}}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON(),t=this.parameters.shapes;return gV(t,e)}static fromJSON(e,t){const n=[];for(let i=0,s=e.shapes.length;i<s;i++){const a=t[e.shapes[i]];n.push(a)}return new TT(n,e.curveSegments)}}function gV(r,e){if(e.shapes=[],Array.isArray(r))for(let t=0,n=r.length;t<n;t++){const i=r[t];e.shapes.push(i.uuid)}else e.shapes.push(r.uuid);return e}class ny extends fn{constructor(e=1,t=32,n=16,i=0,s=Math.PI*2,a=0,l=Math.PI){super(),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:n,phiStart:i,phiLength:s,thetaStart:a,thetaLength:l},t=Math.max(3,Math.floor(t)),n=Math.max(2,Math.floor(n));const c=Math.min(a+l,Math.PI);let d=0;const m=[],y=new Y,v=new Y,x=[],S=[],A=[],E=[];for(let M=0;M<=n;M++){const C=[],w=M/n;let D=0;M===0&&a===0?D=.5/t:M===n&&c===Math.PI&&(D=-.5/t);for(let z=0;z<=t;z++){const B=z/t;y.x=-e*Math.cos(i+B*s)*Math.sin(a+w*l),y.y=e*Math.cos(a+w*l),y.z=e*Math.sin(i+B*s)*Math.sin(a+w*l),S.push(y.x,y.y,y.z),v.copy(y).normalize(),A.push(v.x,v.y,v.z),E.push(B+D,1-w),C.push(d++)}m.push(C)}for(let M=0;M<n;M++)for(let C=0;C<t;C++){const w=m[M][C+1],D=m[M][C],z=m[M+1][C],B=m[M+1][C+1];(M!==0||a>0)&&x.push(w,D,B),(M!==n-1||c<Math.PI)&&x.push(D,z,B)}this.setIndex(x),this.setAttribute("position",new Et(S,3)),this.setAttribute("normal",new Et(A,3)),this.setAttribute("uv",new Et(E,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ny(e.radius,e.widthSegments,e.heightSegments,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength)}}class MT extends df{constructor(e=1,t=0){const n=[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],i=[2,1,0,0,3,2,1,3,0,2,3,1];super(n,i,e,t),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t}}static fromJSON(e){return new MT(e.radius,e.detail)}}class ET extends fn{constructor(e=1,t=.4,n=12,i=48,s=Math.PI*2){super(),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:n,tubularSegments:i,arc:s},n=Math.floor(n),i=Math.floor(i);const a=[],l=[],c=[],d=[],m=new Y,y=new Y,v=new Y;for(let x=0;x<=n;x++)for(let S=0;S<=i;S++){const A=S/i*s,E=x/n*Math.PI*2;y.x=(e+t*Math.cos(E))*Math.cos(A),y.y=(e+t*Math.cos(E))*Math.sin(A),y.z=t*Math.sin(E),l.push(y.x,y.y,y.z),m.x=e*Math.cos(A),m.y=e*Math.sin(A),v.subVectors(y,m).normalize(),c.push(v.x,v.y,v.z),d.push(S/i),d.push(x/n)}for(let x=1;x<=n;x++)for(let S=1;S<=i;S++){const A=(i+1)*x+S-1,E=(i+1)*(x-1)+S-1,M=(i+1)*(x-1)+S,C=(i+1)*x+S;a.push(A,E,C),a.push(E,M,C)}this.setIndex(a),this.setAttribute("position",new Et(l,3)),this.setAttribute("normal",new Et(c,3)),this.setAttribute("uv",new Et(d,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new ET(e.radius,e.tube,e.radialSegments,e.tubularSegments,e.arc)}}class AT extends fn{constructor(e=1,t=.4,n=64,i=8,s=2,a=3){super(),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:n,radialSegments:i,p:s,q:a},n=Math.floor(n),i=Math.floor(i);const l=[],c=[],d=[],m=[],y=new Y,v=new Y,x=new Y,S=new Y,A=new Y,E=new Y,M=new Y;for(let w=0;w<=n;++w){const D=w/n*s*Math.PI*2;C(D,s,a,e,x),C(D+.01,s,a,e,S),E.subVectors(S,x),M.addVectors(S,x),A.crossVectors(E,M),M.crossVectors(A,E),A.normalize(),M.normalize();for(let z=0;z<=i;++z){const B=z/i*Math.PI*2,F=-t*Math.cos(B),H=t*Math.sin(B);y.x=x.x+(F*M.x+H*A.x),y.y=x.y+(F*M.y+H*A.y),y.z=x.z+(F*M.z+H*A.z),c.push(y.x,y.y,y.z),v.subVectors(y,x).normalize(),d.push(v.x,v.y,v.z),m.push(w/n),m.push(z/i)}}for(let w=1;w<=n;w++)for(let D=1;D<=i;D++){const z=(i+1)*(w-1)+(D-1),B=(i+1)*w+(D-1),F=(i+1)*w+D,H=(i+1)*(w-1)+D;l.push(z,B,H),l.push(B,F,H)}this.setIndex(l),this.setAttribute("position",new Et(c,3)),this.setAttribute("normal",new Et(d,3)),this.setAttribute("uv",new Et(m,2));function C(w,D,z,B,F){const H=Math.cos(w),I=Math.sin(w),P=z/D*w,Z=Math.cos(P);F.x=B*(2+Z)*.5*H,F.y=B*(2+Z)*I*.5,F.z=B*Math.sin(P)*.5}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}static fromJSON(e){return new AT(e.radius,e.tube,e.tubularSegments,e.radialSegments,e.p,e.q)}}class RT extends fn{constructor(e=new j1(new Y(-1,-1,0),new Y(-1,1,0),new Y(1,1,0)),t=64,n=1,i=8,s=!1){super(),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:n,radialSegments:i,closed:s};const a=e.computeFrenetFrames(t,s);this.tangents=a.tangents,this.normals=a.normals,this.binormals=a.binormals;const l=new Y,c=new Y,d=new Xe;let m=new Y;const y=[],v=[],x=[],S=[];A(),this.setIndex(S),this.setAttribute("position",new Et(y,3)),this.setAttribute("normal",new Et(v,3)),this.setAttribute("uv",new Et(x,2));function A(){for(let w=0;w<t;w++)E(w);E(s===!1?t:0),C(),M()}function E(w){m=e.getPointAt(w/t,m);const D=a.normals[w],z=a.binormals[w];for(let B=0;B<=i;B++){const F=B/i*Math.PI*2,H=Math.sin(F),I=-Math.cos(F);c.x=I*D.x+H*z.x,c.y=I*D.y+H*z.y,c.z=I*D.z+H*z.z,c.normalize(),v.push(c.x,c.y,c.z),l.x=m.x+n*c.x,l.y=m.y+n*c.y,l.z=m.z+n*c.z,y.push(l.x,l.y,l.z)}}function M(){for(let w=1;w<=t;w++)for(let D=1;D<=i;D++){const z=(i+1)*(w-1)+(D-1),B=(i+1)*w+(D-1),F=(i+1)*w+D,H=(i+1)*(w-1)+D;S.push(z,B,H),S.push(B,F,H)}}function C(){for(let w=0;w<=t;w++)for(let D=0;D<=i;D++)d.x=w/t,d.y=D/i,x.push(d.x,d.y)}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}toJSON(){const e=super.toJSON();return e.path=this.parameters.path.toJSON(),e}static fromJSON(e){return new RT(new _b[e.path.type]().fromJSON(e.path),e.tubularSegments,e.radius,e.radialSegments,e.closed)}}class qU extends fn{constructor(e=null){if(super(),this.type="WireframeGeometry",this.parameters={geometry:e},e!==null){const t=[],n=new Set,i=new Y,s=new Y;if(e.index!==null){const a=e.attributes.position,l=e.index;let c=e.groups;c.length===0&&(c=[{start:0,count:l.count,materialIndex:0}]);for(let d=0,m=c.length;d<m;++d){const y=c[d],v=y.start,x=y.count;for(let S=v,A=v+x;S<A;S+=3)for(let E=0;E<3;E++){const M=l.getX(S+E),C=l.getX(S+(E+1)%3);i.fromBufferAttribute(a,M),s.fromBufferAttribute(a,C),xw(i,s,n)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}}else{const a=e.attributes.position;for(let l=0,c=a.count/3;l<c;l++)for(let d=0;d<3;d++){const m=3*l+d,y=3*l+(d+1)%3;i.fromBufferAttribute(a,m),s.fromBufferAttribute(a,y),xw(i,s,n)===!0&&(t.push(i.x,i.y,i.z),t.push(s.x,s.y,s.z))}}this.setAttribute("position",new Et(t,3))}}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function xw(r,e,t){const n=`${r.x},${r.y},${r.z}-${e.x},${e.y},${e.z}`,i=`${e.x},${e.y},${e.z}-${r.x},${r.y},${r.z}`;return t.has(n)===!0||t.has(i)===!0?!1:(t.add(n),t.add(i),!0)}var Sw=Object.freeze({__proto__:null,BoxGeometry:Hc,CapsuleGeometry:gT,CircleGeometry:yT,ConeGeometry:vT,CylinderGeometry:xp,DodecahedronGeometry:_T,EdgesGeometry:zU,ExtrudeGeometry:xT,IcosahedronGeometry:ST,LatheGeometry:j_,OctahedronGeometry:Z_,PlaneGeometry:Sp,PolyhedronGeometry:df,RingGeometry:bT,ShapeGeometry:TT,SphereGeometry:ny,TetrahedronGeometry:MT,TorusGeometry:ET,TorusKnotGeometry:AT,TubeGeometry:RT,WireframeGeometry:qU});class K1 extends ar{constructor(e){super(),this.isShadowMaterial=!0,this.type="ShadowMaterial",this.color=new ft(0),this.transparent=!0,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.fog=e.fog,this}}class WU extends Hl{constructor(e){super(e),this.isRawShaderMaterial=!0,this.type="RawShaderMaterial"}}class NT extends ar{constructor(e){super(),this.isMeshStandardMaterial=!0,this.type="MeshStandardMaterial",this.defines={STANDARD:""},this.color=new ft(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fu,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _a,this.envMapIntensity=1,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.envMapIntensity=e.envMapIntensity,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class Q1 extends NT{constructor(e){super(),this.isMeshPhysicalMaterial=!0,this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.anisotropyRotation=0,this.anisotropyMap=null,this.clearcoatMap=null,this.clearcoatRoughness=0,this.clearcoatRoughnessMap=null,this.clearcoatNormalScale=new Xe(1,1),this.clearcoatNormalMap=null,this.ior=1.5,Object.defineProperty(this,"reflectivity",{get:function(){return hn(2.5*(this.ior-1)/(this.ior+1),0,1)},set:function(t){this.ior=(1+.4*t)/(1-.4*t)}}),this.iridescenceMap=null,this.iridescenceIOR=1.3,this.iridescenceThicknessRange=[100,400],this.iridescenceThicknessMap=null,this.sheenColor=new ft(0),this.sheenColorMap=null,this.sheenRoughness=1,this.sheenRoughnessMap=null,this.transmissionMap=null,this.thickness=0,this.thicknessMap=null,this.attenuationDistance=1/0,this.attenuationColor=new ft(1,1,1),this.specularIntensity=1,this.specularIntensityMap=null,this.specularColor=new ft(1,1,1),this.specularColorMap=null,this._anisotropy=0,this._clearcoat=0,this._dispersion=0,this._iridescence=0,this._sheen=0,this._transmission=0,this.setValues(e)}get anisotropy(){return this._anisotropy}set anisotropy(e){this._anisotropy>0!=e>0&&this.version++,this._anisotropy=e}get clearcoat(){return this._clearcoat}set clearcoat(e){this._clearcoat>0!=e>0&&this.version++,this._clearcoat=e}get iridescence(){return this._iridescence}set iridescence(e){this._iridescence>0!=e>0&&this.version++,this._iridescence=e}get dispersion(){return this._dispersion}set dispersion(e){this._dispersion>0!=e>0&&this.version++,this._dispersion=e}get sheen(){return this._sheen}set sheen(e){this._sheen>0!=e>0&&this.version++,this._sheen=e}get transmission(){return this._transmission}set transmission(e){this._transmission>0!=e>0&&this.version++,this._transmission=e}copy(e){return super.copy(e),this.defines={STANDARD:"",PHYSICAL:""},this.anisotropy=e.anisotropy,this.anisotropyRotation=e.anisotropyRotation,this.anisotropyMap=e.anisotropyMap,this.clearcoat=e.clearcoat,this.clearcoatMap=e.clearcoatMap,this.clearcoatRoughness=e.clearcoatRoughness,this.clearcoatRoughnessMap=e.clearcoatRoughnessMap,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.dispersion=e.dispersion,this.ior=e.ior,this.iridescence=e.iridescence,this.iridescenceMap=e.iridescenceMap,this.iridescenceIOR=e.iridescenceIOR,this.iridescenceThicknessRange=[...e.iridescenceThicknessRange],this.iridescenceThicknessMap=e.iridescenceThicknessMap,this.sheen=e.sheen,this.sheenColor.copy(e.sheenColor),this.sheenColorMap=e.sheenColorMap,this.sheenRoughness=e.sheenRoughness,this.sheenRoughnessMap=e.sheenRoughnessMap,this.transmission=e.transmission,this.transmissionMap=e.transmissionMap,this.thickness=e.thickness,this.thicknessMap=e.thicknessMap,this.attenuationDistance=e.attenuationDistance,this.attenuationColor.copy(e.attenuationColor),this.specularIntensity=e.specularIntensity,this.specularIntensityMap=e.specularIntensityMap,this.specularColor.copy(e.specularColor),this.specularColorMap=e.specularColorMap,this}}class J1 extends ar{constructor(e){super(),this.isMeshPhongMaterial=!0,this.type="MeshPhongMaterial",this.color=new ft(16777215),this.specular=new ft(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fu,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _a,this.combine=Kg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class $1 extends ar{constructor(e){super(),this.isMeshToonMaterial=!0,this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new ft(16777215),this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fu,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.fog=e.fog,this}}class eR extends ar{constructor(e){super(),this.isMeshNormalMaterial=!0,this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fu,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.flatShading=!1,this.setValues(e)}copy(e){return super.copy(e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.flatShading=e.flatShading,this}}class tR extends ar{constructor(e){super(),this.isMeshLambertMaterial=!0,this.type="MeshLambertMaterial",this.color=new ft(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new ft(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fu,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.envMapRotation=new _a,this.combine=Kg,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapRotation.copy(e.envMapRotation),this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.flatShading=e.flatShading,this.fog=e.fog,this}}class nR extends ar{constructor(e){super(),this.isMeshDepthMaterial=!0,this.type="MeshDepthMaterial",this.depthPacking=rU,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.setValues(e)}copy(e){return super.copy(e),this.depthPacking=e.depthPacking,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this}}class iR extends ar{constructor(e){super(),this.isMeshDistanceMaterial=!0,this.type="MeshDistanceMaterial",this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.setValues(e)}copy(e){return super.copy(e),this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this}}class sR extends ar{constructor(e){super(),this.isMeshMatcapMaterial=!0,this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new ft(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=Fu,this.normalScale=new Xe(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.flatShading=!1,this.fog=!0,this.setValues(e)}copy(e){return super.copy(e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.flatShading=e.flatShading,this.fog=e.fog,this}}class rR extends qr{constructor(e){super(),this.isLineDashedMaterial=!0,this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}copy(e){return super.copy(e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this}}function Pd(r,e){return!r||r.constructor===e?r:typeof e.BYTES_PER_ELEMENT=="number"?new e(r):Array.prototype.slice.call(r)}function XU(r){return ArrayBuffer.isView(r)&&!(r instanceof DataView)}function YU(r){function e(i,s){return r[i]-r[s]}const t=r.length,n=new Array(t);for(let i=0;i!==t;++i)n[i]=i;return n.sort(e),n}function VA(r,e,t){const n=r.length,i=new r.constructor(n);for(let s=0,a=0;a!==n;++s){const l=t[s]*e;for(let c=0;c!==e;++c)i[a++]=r[l+c]}return i}function aR(r,e,t,n){let i=1,s=r[0];for(;s!==void 0&&s[n]===void 0;)s=r[i++];if(s===void 0)return;let a=s[n];if(a!==void 0)if(Array.isArray(a))do a=s[n],a!==void 0&&(e.push(s.time),t.push(...a)),s=r[i++];while(s!==void 0);else if(a.toArray!==void 0)do a=s[n],a!==void 0&&(e.push(s.time),a.toArray(t,t.length)),s=r[i++];while(s!==void 0);else do a=s[n],a!==void 0&&(e.push(s.time),t.push(a)),s=r[i++];while(s!==void 0)}function yV(r,e,t,n,i=30){const s=r.clone();s.name=e;const a=[];for(let c=0;c<s.tracks.length;++c){const d=s.tracks[c],m=d.getValueSize(),y=[],v=[];for(let x=0;x<d.times.length;++x){const S=d.times[x]*i;if(!(S<t||S>=n)){y.push(d.times[x]);for(let A=0;A<m;++A)v.push(d.values[x*m+A])}}y.length!==0&&(d.times=Pd(y,d.times.constructor),d.values=Pd(v,d.values.constructor),a.push(d))}s.tracks=a;let l=1/0;for(let c=0;c<s.tracks.length;++c)l>s.tracks[c].times[0]&&(l=s.tracks[c].times[0]);for(let c=0;c<s.tracks.length;++c)s.tracks[c].shift(-1*l);return s.resetDuration(),s}function vV(r,e=0,t=r,n=30){n<=0&&(n=30);const i=t.tracks.length,s=e/n;for(let a=0;a<i;++a){const l=t.tracks[a],c=l.ValueTypeName;if(c==="bool"||c==="string")continue;const d=r.tracks.find(function(M){return M.name===l.name&&M.ValueTypeName===c});if(d===void 0)continue;let m=0;const y=l.getValueSize();l.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(m=y/3);let v=0;const x=d.getValueSize();d.createInterpolant.isInterpolantFactoryMethodGLTFCubicSpline&&(v=x/3);const S=l.times.length-1;let A;if(s<=l.times[0]){const M=m,C=y-m;A=l.values.slice(M,C)}else if(s>=l.times[S]){const M=S*y+m,C=M+y-m;A=l.values.slice(M,C)}else{const M=l.createInterpolant(),C=m,w=y-m;M.evaluate(s),A=M.resultBuffer.slice(C,w)}c==="quaternion"&&new ma().fromArray(A).normalize().conjugate().toArray(A);const E=d.times.length;for(let M=0;M<E;++M){const C=M*x+v;if(c==="quaternion")ma.multiplyQuaternionsFlat(d.values,C,A,0,d.values,C);else{const w=x-v*2;for(let D=0;D<w;++D)d.values[C+D]-=A[D]}}}return r.blendMode=L1,r}class _V{static convertArray(e,t){return Pd(e,t)}static isTypedArray(e){return XU(e)}static getKeyframeOrder(e){return YU(e)}static sortedArray(e,t,n){return VA(e,t,n)}static flattenJSON(e,t,n,i){aR(e,t,n,i)}static subclip(e,t,n,i,s=30){return yV(e,t,n,i,s)}static makeClipAdditive(e,t=0,n=e,i=30){return vV(e,t,n,i)}}class K_{constructor(e,t,n,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(n),this.sampleValues=t,this.valueSize=n,this.settings=null,this.DefaultSettings_={}}evaluate(e){const t=this.parameterPositions;let n=this._cachedIndex,i=t[n],s=t[n-1];e:{t:{let a;n:{i:if(!(e<i)){for(let l=n+2;;){if(i===void 0){if(e<s)break i;return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}if(n===l)break;if(s=i,i=t[++n],e<i)break t}a=t.length;break n}if(!(e>=s)){const l=t[1];e<l&&(n=2,s=l);for(let c=n-2;;){if(s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(n===c)break;if(i=s,s=t[--n-1],e>=s)break t}a=n,n=0;break n}break e}for(;n<a;){const l=n+a>>>1;e<t[l]?a=l:n=l+1}if(i=t[n],s=t[n-1],s===void 0)return this._cachedIndex=0,this.copySampleValue_(0);if(i===void 0)return n=t.length,this._cachedIndex=n,this.copySampleValue_(n-1)}this._cachedIndex=n,this.intervalChanged_(n,s,i)}return this.interpolate_(n,s,e,i)}getSettings_(){return this.settings||this.DefaultSettings_}copySampleValue_(e){const t=this.resultBuffer,n=this.sampleValues,i=this.valueSize,s=e*i;for(let a=0;a!==i;++a)t[a]=n[s+a];return t}interpolate_(){throw new Error("call to abstract method")}intervalChanged_(){}}class jU extends K_{constructor(e,t,n,i){super(e,t,n,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0,this.DefaultSettings_={endingStart:Ld,endingEnd:Ld}}intervalChanged_(e,t,n){const i=this.parameterPositions;let s=e-2,a=e+1,l=i[s],c=i[a];if(l===void 0)switch(this.getSettings_().endingStart){case Bd:s=e,l=2*t-n;break;case m_:s=i.length-2,l=t+i[s]-i[s+1];break;default:s=e,l=n}if(c===void 0)switch(this.getSettings_().endingEnd){case Bd:a=e,c=2*n-t;break;case m_:a=1,c=n+i[1]-i[0];break;default:a=e-1,c=t}const d=(n-t)*.5,m=this.valueSize;this._weightPrev=d/(t-l),this._weightNext=d/(c-n),this._offsetPrev=s*m,this._offsetNext=a*m}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=e*l,d=c-l,m=this._offsetPrev,y=this._offsetNext,v=this._weightPrev,x=this._weightNext,S=(n-t)/(i-t),A=S*S,E=A*S,M=-v*E+2*v*A-v*S,C=(1+v)*E+(-1.5-2*v)*A+(-.5+v)*S+1,w=(-1-x)*E+(1.5+x)*A+.5*S,D=x*E-x*A;for(let z=0;z!==l;++z)s[z]=M*a[m+z]+C*a[d+z]+w*a[c+z]+D*a[y+z];return s}}class oR extends K_{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=e*l,d=c-l,m=(n-t)/(i-t),y=1-m;for(let v=0;v!==l;++v)s[v]=a[d+v]*y+a[c+v]*m;return s}}class ZU extends K_{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e){return this.copySampleValue_(e-1)}}class nl{constructor(e,t,n,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Pd(t,this.TimeBufferType),this.values=Pd(n,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}static toJSON(e){const t=e.constructor;let n;if(t.toJSON!==this.toJSON)n=t.toJSON(e);else{n={name:e.name,times:Pd(e.times,Array),values:Pd(e.values,Array)};const i=e.getInterpolation();i!==e.DefaultInterpolation&&(n.interpolation=i)}return n.type=e.ValueTypeName,n}InterpolantFactoryMethodDiscrete(e){return new ZU(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodLinear(e){return new oR(this.times,this.values,this.getValueSize(),e)}InterpolantFactoryMethodSmooth(e){return new jU(this.times,this.values,this.getValueSize(),e)}setInterpolation(e){let t;switch(e){case p_:t=this.InterpolantFactoryMethodDiscrete;break;case mb:t=this.InterpolantFactoryMethodLinear;break;case eb:t=this.InterpolantFactoryMethodSmooth;break}if(t===void 0){const n="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0)if(e!==this.DefaultInterpolation)this.setInterpolation(this.DefaultInterpolation);else throw new Error(n);return console.warn("THREE.KeyframeTrack:",n),this}return this.createInterpolant=t,this}getInterpolation(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return p_;case this.InterpolantFactoryMethodLinear:return mb;case this.InterpolantFactoryMethodSmooth:return eb}}getValueSize(){return this.values.length/this.times.length}shift(e){if(e!==0){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]+=e}return this}scale(e){if(e!==1){const t=this.times;for(let n=0,i=t.length;n!==i;++n)t[n]*=e}return this}trim(e,t){const n=this.times,i=n.length;let s=0,a=i-1;for(;s!==i&&n[s]<e;)++s;for(;a!==-1&&n[a]>t;)--a;if(++a,s!==0||a!==i){s>=a&&(a=Math.max(a,1),s=a-1);const l=this.getValueSize();this.times=n.slice(s,a),this.values=this.values.slice(s*l,a*l)}return this}validate(){let e=!0;const t=this.getValueSize();t-Math.floor(t)!==0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);const n=this.times,i=this.values,s=n.length;s===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);let a=null;for(let l=0;l!==s;l++){const c=n[l];if(typeof c=="number"&&isNaN(c)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,l,c),e=!1;break}if(a!==null&&a>c){console.error("THREE.KeyframeTrack: Out of order keys.",this,l,c,a),e=!1;break}a=c}if(i!==void 0&&XU(i))for(let l=0,c=i.length;l!==c;++l){const d=i[l];if(isNaN(d)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,l,d),e=!1;break}}return e}optimize(){const e=this.times.slice(),t=this.values.slice(),n=this.getValueSize(),i=this.getInterpolation()===eb,s=e.length-1;let a=1;for(let l=1;l<s;++l){let c=!1;const d=e[l],m=e[l+1];if(d!==m&&(l!==1||d!==e[0]))if(i)c=!0;else{const y=l*n,v=y-n,x=y+n;for(let S=0;S!==n;++S){const A=t[y+S];if(A!==t[v+S]||A!==t[x+S]){c=!0;break}}}if(c){if(l!==a){e[a]=e[l];const y=l*n,v=a*n;for(let x=0;x!==n;++x)t[v+x]=t[y+x]}++a}}if(s>0){e[a]=e[s];for(let l=s*n,c=a*n,d=0;d!==n;++d)t[c+d]=t[l+d];++a}return a!==e.length?(this.times=e.slice(0,a),this.values=t.slice(0,a*n)):(this.times=e,this.values=t),this}clone(){const e=this.times.slice(),t=this.values.slice(),n=this.constructor,i=new n(this.name,e,t);return i.createInterpolant=this.createInterpolant,i}}nl.prototype.ValueTypeName="";nl.prototype.TimeBufferType=Float32Array;nl.prototype.ValueBufferType=Float32Array;nl.prototype.DefaultInterpolation=mb;class bp extends nl{constructor(e,t,n){super(e,t,n)}}bp.prototype.ValueTypeName="bool";bp.prototype.ValueBufferType=Array;bp.prototype.DefaultInterpolation=p_;bp.prototype.InterpolantFactoryMethodLinear=void 0;bp.prototype.InterpolantFactoryMethodSmooth=void 0;class lR extends nl{constructor(e,t,n,i){super(e,t,n,i)}}lR.prototype.ValueTypeName="color";class b_ extends nl{constructor(e,t,n,i){super(e,t,n,i)}}b_.prototype.ValueTypeName="number";class KU extends K_{constructor(e,t,n,i){super(e,t,n,i)}interpolate_(e,t,n,i){const s=this.resultBuffer,a=this.sampleValues,l=this.valueSize,c=(n-t)/(i-t);let d=e*l;for(let m=d+l;d!==m;d+=4)ma.slerpFlat(s,0,a,d-l,a,d,c);return s}}class Q_ extends nl{constructor(e,t,n,i){super(e,t,n,i)}InterpolantFactoryMethodLinear(e){return new KU(this.times,this.values,this.getValueSize(),e)}}Q_.prototype.ValueTypeName="quaternion";Q_.prototype.InterpolantFactoryMethodSmooth=void 0;class Tp extends nl{constructor(e,t,n){super(e,t,n)}}Tp.prototype.ValueTypeName="string";Tp.prototype.ValueBufferType=Array;Tp.prototype.DefaultInterpolation=p_;Tp.prototype.InterpolantFactoryMethodLinear=void 0;Tp.prototype.InterpolantFactoryMethodSmooth=void 0;class T_ extends nl{constructor(e,t,n,i){super(e,t,n,i)}}T_.prototype.ValueTypeName="vector";class M_{constructor(e="",t=-1,n=[],i=$b){this.name=e,this.tracks=n,this.duration=t,this.blendMode=i,this.uuid=So(),this.duration<0&&this.resetDuration()}static parse(e){const t=[],n=e.tracks,i=1/(e.fps||1);for(let a=0,l=n.length;a!==l;++a)t.push(SV(n[a]).scale(i));const s=new this(e.name,e.duration,t,e.blendMode);return s.uuid=e.uuid,s}static toJSON(e){const t=[],n=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid,blendMode:e.blendMode};for(let s=0,a=n.length;s!==a;++s)t.push(nl.toJSON(n[s]));return i}static CreateFromMorphTargetSequence(e,t,n,i){const s=t.length,a=[];for(let l=0;l<s;l++){let c=[],d=[];c.push((l+s-1)%s,l,(l+1)%s),d.push(0,1,0);const m=YU(c);c=VA(c,1,m),d=VA(d,1,m),!i&&c[0]===0&&(c.push(s),d.push(d[0])),a.push(new b_(".morphTargetInfluences["+t[l].name+"]",c,d).scale(1/n))}return new this(e,-1,a)}static findByName(e,t){let n=e;if(!Array.isArray(e)){const i=e;n=i.geometry&&i.geometry.animations||i.animations}for(let i=0;i<n.length;i++)if(n[i].name===t)return n[i];return null}static CreateClipsFromMorphTargetSequences(e,t,n){const i={},s=/^([\w-]*?)([\d]+)$/;for(let l=0,c=e.length;l<c;l++){const d=e[l],m=d.name.match(s);if(m&&m.length>1){const y=m[1];let v=i[y];v||(i[y]=v=[]),v.push(d)}}const a=[];for(const l in i)a.push(this.CreateFromMorphTargetSequence(l,i[l],t,n));return a}static parseAnimation(e,t){if(console.warn("THREE.AnimationClip: parseAnimation() is deprecated and will be removed with r185"),!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;const n=function(y,v,x,S,A){if(x.length!==0){const E=[],M=[];aR(x,E,M,S),E.length!==0&&A.push(new y(v,E,M))}},i=[],s=e.name||"default",a=e.fps||30,l=e.blendMode;let c=e.length||-1;const d=e.hierarchy||[];for(let y=0;y<d.length;y++){const v=d[y].keys;if(!(!v||v.length===0))if(v[0].morphTargets){const x={};let S;for(S=0;S<v.length;S++)if(v[S].morphTargets)for(let A=0;A<v[S].morphTargets.length;A++)x[v[S].morphTargets[A]]=-1;for(const A in x){const E=[],M=[];for(let C=0;C!==v[S].morphTargets.length;++C){const w=v[S];E.push(w.time),M.push(w.morphTarget===A?1:0)}i.push(new b_(".morphTargetInfluence["+A+"]",E,M))}c=x.length*a}else{const x=".bones["+t[y].name+"]";n(T_,x+".position",v,"pos",i),n(Q_,x+".quaternion",v,"rot",i),n(T_,x+".scale",v,"scl",i)}}return i.length===0?null:new this(s,c,i,l)}resetDuration(){const e=this.tracks;let t=0;for(let n=0,i=e.length;n!==i;++n){const s=this.tracks[n];t=Math.max(t,s.times[s.times.length-1])}return this.duration=t,this}trim(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this}validate(){let e=!0;for(let t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e}optimize(){for(let e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this}clone(){const e=[];for(let t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new this.constructor(this.name,this.duration,e,this.blendMode)}toJSON(){return this.constructor.toJSON(this)}}function xV(r){switch(r.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return b_;case"vector":case"vector2":case"vector3":case"vector4":return T_;case"color":return lR;case"quaternion":return Q_;case"bool":case"boolean":return bp;case"string":return Tp}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+r)}function SV(r){if(r.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");const e=xV(r.type);if(r.times===void 0){const t=[],n=[];aR(r.keys,t,n,"value"),r.times=t,r.values=n}return e.parse!==void 0?e.parse(r):new e(r.name,r.times,r.values,r.interpolation)}const Cc={enabled:!1,files:{},add:function(r,e){this.enabled!==!1&&(this.files[r]=e)},get:function(r){if(this.enabled!==!1)return this.files[r]},remove:function(r){delete this.files[r]},clear:function(){this.files={}}};class uR{constructor(e,t,n){const i=this;let s=!1,a=0,l=0,c;const d=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=n,this.itemStart=function(m){l++,s===!1&&i.onStart!==void 0&&i.onStart(m,a,l),s=!0},this.itemEnd=function(m){a++,i.onProgress!==void 0&&i.onProgress(m,a,l),a===l&&(s=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(m){i.onError!==void 0&&i.onError(m)},this.resolveURL=function(m){return c?c(m):m},this.setURLModifier=function(m){return c=m,this},this.addHandler=function(m,y){return d.push(m,y),this},this.removeHandler=function(m){const y=d.indexOf(m);return y!==-1&&d.splice(y,2),this},this.getHandler=function(m){for(let y=0,v=d.length;y<v;y+=2){const x=d[y],S=d[y+1];if(x.global&&(x.lastIndex=0),x.test(m))return S}return null}}}const QU=new uR;class ja{constructor(e){this.manager=e!==void 0?e:QU,this.crossOrigin="anonymous",this.withCredentials=!1,this.path="",this.resourcePath="",this.requestHeader={}}load(){}loadAsync(e,t){const n=this;return new Promise(function(i,s){n.load(e,i,t,s)})}parse(){}setCrossOrigin(e){return this.crossOrigin=e,this}setWithCredentials(e){return this.withCredentials=e,this}setPath(e){return this.path=e,this}setResourcePath(e){return this.resourcePath=e,this}setRequestHeader(e){return this.requestHeader=e,this}}ja.DEFAULT_MATERIAL_NAME="__DEFAULT";const Tc={};class bV extends Error{constructor(e,t){super(e),this.response=t}}class zc extends ja{constructor(e){super(e),this.mimeType="",this.responseType=""}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=Cc.get(e);if(s!==void 0)return this.manager.itemStart(e),setTimeout(()=>{t&&t(s),this.manager.itemEnd(e)},0),s;if(Tc[e]!==void 0){Tc[e].push({onLoad:t,onProgress:n,onError:i});return}Tc[e]=[],Tc[e].push({onLoad:t,onProgress:n,onError:i});const a=new Request(e,{headers:new Headers(this.requestHeader),credentials:this.withCredentials?"include":"same-origin"}),l=this.mimeType,c=this.responseType;fetch(a).then(d=>{if(d.status===200||d.status===0){if(d.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),typeof ReadableStream>"u"||d.body===void 0||d.body.getReader===void 0)return d;const m=Tc[e],y=d.body.getReader(),v=d.headers.get("X-File-Size")||d.headers.get("Content-Length"),x=v?parseInt(v):0,S=x!==0;let A=0;const E=new ReadableStream({start(M){C();function C(){y.read().then(({done:w,value:D})=>{if(w)M.close();else{A+=D.byteLength;const z=new ProgressEvent("progress",{lengthComputable:S,loaded:A,total:x});for(let B=0,F=m.length;B<F;B++){const H=m[B];H.onProgress&&H.onProgress(z)}M.enqueue(D),C()}},w=>{M.error(w)})}}});return new Response(E)}else throw new bV(`fetch for "${d.url}" responded with ${d.status}: ${d.statusText}`,d)}).then(d=>{switch(c){case"arraybuffer":return d.arrayBuffer();case"blob":return d.blob();case"document":return d.text().then(m=>new DOMParser().parseFromString(m,l));case"json":return d.json();default:if(l==="")return d.text();{const y=/charset="?([^;"\s]*)"?/i.exec(l),v=y&&y[1]?y[1].toLowerCase():void 0,x=new TextDecoder(v);return d.arrayBuffer().then(S=>x.decode(S))}}}).then(d=>{Cc.add(e,d);const m=Tc[e];delete Tc[e];for(let y=0,v=m.length;y<v;y++){const x=m[y];x.onLoad&&x.onLoad(d)}}).catch(d=>{const m=Tc[e];if(m===void 0)throw this.manager.itemError(e),d;delete Tc[e];for(let y=0,v=m.length;y<v;y++){const x=m[y];x.onError&&x.onError(d)}this.manager.itemError(e)}).finally(()=>{this.manager.itemEnd(e)}),this.manager.itemStart(e)}setResponseType(e){return this.responseType=e,this}setMimeType(e){return this.mimeType=e,this}}class TV extends ja{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new zc(this.manager);a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(l){try{t(s.parse(JSON.parse(l)))}catch(c){i?i(c):console.error(c),s.manager.itemError(e)}},n,i)}parse(e){const t=[];for(let n=0;n<e.length;n++){const i=M_.parse(e[n]);t.push(i)}return t}}class MV extends ja{constructor(e){super(e)}load(e,t,n,i){const s=this,a=[],l=new pT,c=new zc(this.manager);c.setPath(this.path),c.setResponseType("arraybuffer"),c.setRequestHeader(this.requestHeader),c.setWithCredentials(s.withCredentials);let d=0;function m(y){c.load(e[y],function(v){const x=s.parse(v,!0);a[y]={width:x.width,height:x.height,format:x.format,mipmaps:x.mipmaps},d+=1,d===6&&(x.mipmapCount===1&&(l.minFilter=Zn),l.image=a,l.format=x.format,l.needsUpdate=!0,t&&t(l))},n,i)}if(Array.isArray(e))for(let y=0,v=e.length;y<v;++y)m(y);else c.load(e,function(y){const v=s.parse(y,!0);if(v.isCubemap){const x=v.mipmaps.length/v.mipmapCount;for(let S=0;S<x;S++){a[S]={mipmaps:[]};for(let A=0;A<v.mipmapCount;A++)a[S].mipmaps.push(v.mipmaps[S*v.mipmapCount+A]),a[S].format=v.format,a[S].width=v.width,a[S].height=v.height}l.image=a}else l.image.width=v.width,l.image.height=v.height,l.mipmaps=v.mipmaps;v.mipmapCount===1&&(l.minFilter=Zn),l.format=v.format,l.needsUpdate=!0,t&&t(l)},n,i);return l}}class E_ extends ja{constructor(e){super(e)}load(e,t,n,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Cc.get(e);if(a!==void 0)return s.manager.itemStart(e),setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a;const l=y_("img");function c(){m(),Cc.add(e,this),t&&t(this),s.manager.itemEnd(e)}function d(y){m(),i&&i(y),s.manager.itemError(e),s.manager.itemEnd(e)}function m(){l.removeEventListener("load",c,!1),l.removeEventListener("error",d,!1)}return l.addEventListener("load",c,!1),l.addEventListener("error",d,!1),e.slice(0,5)!=="data:"&&this.crossOrigin!==void 0&&(l.crossOrigin=this.crossOrigin),s.manager.itemStart(e),l.src=e,l}}class EV extends ja{constructor(e){super(e)}load(e,t,n,i){const s=new _p;s.colorSpace=wt;const a=new E_(this.manager);a.setCrossOrigin(this.crossOrigin),a.setPath(this.path);let l=0;function c(d){a.load(e[d],function(m){s.images[d]=m,l++,l===6&&(s.needsUpdate=!0,t&&t(s))},void 0,i)}for(let d=0;d<e.length;++d)c(d);return s}}class AV extends ja{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new Fl,l=new zc(this.manager);return l.setResponseType("arraybuffer"),l.setRequestHeader(this.requestHeader),l.setPath(this.path),l.setWithCredentials(s.withCredentials),l.load(e,function(c){let d;try{d=s.parse(c)}catch(m){if(i!==void 0)i(m);else{console.error(m);return}}d.image!==void 0?a.image=d.image:d.data!==void 0&&(a.image.width=d.width,a.image.height=d.height,a.image.data=d.data),a.wrapS=d.wrapS!==void 0?d.wrapS:da,a.wrapT=d.wrapT!==void 0?d.wrapT:da,a.magFilter=d.magFilter!==void 0?d.magFilter:Zn,a.minFilter=d.minFilter!==void 0?d.minFilter:Zn,a.anisotropy=d.anisotropy!==void 0?d.anisotropy:1,d.colorSpace!==void 0&&(a.colorSpace=d.colorSpace),d.flipY!==void 0&&(a.flipY=d.flipY),d.format!==void 0&&(a.format=d.format),d.type!==void 0&&(a.type=d.type),d.mipmaps!==void 0&&(a.mipmaps=d.mipmaps,a.minFilter=xr),d.mipmapCount===1&&(a.minFilter=Zn),d.generateMipmaps!==void 0&&(a.generateMipmaps=d.generateMipmaps),a.needsUpdate=!0,t&&t(a,d)},n,i),a}}class CT extends ja{constructor(e){super(e)}load(e,t,n,i){const s=new Li,a=new E_(this.manager);return a.setCrossOrigin(this.crossOrigin),a.setPath(this.path),a.load(e,function(l){s.image=l,s.needsUpdate=!0,t!==void 0&&t(s)},n,i),s}}class pf extends Hn{constructor(e,t=1){super(),this.isLight=!0,this.type="Light",this.color=new ft(e),this.intensity=t}dispose(){}copy(e,t){return super.copy(e,t),this.color.copy(e.color),this.intensity=e.intensity,this}toJSON(e){const t=super.toJSON(e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),this.target!==void 0&&(t.object.target=this.target.uuid),t}}class cR extends pf{constructor(e,t,n){super(e,n),this.isHemisphereLight=!0,this.type="HemisphereLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.groundColor=new ft(t)}copy(e,t){return super.copy(e,t),this.groundColor.copy(e.groundColor),this}}const ME=new Mt,bw=new Y,Tw=new Y;class hR{constructor(e){this.camera=e,this.intensity=1,this.bias=0,this.normalBias=0,this.radius=1,this.blurSamples=8,this.mapSize=new Xe(512,512),this.map=null,this.mapPass=null,this.matrix=new Mt,this.autoUpdate=!0,this.needsUpdate=!1,this._frustum=new ty,this._frameExtents=new Xe(1,1),this._viewportCount=1,this._viewports=[new Ot(0,0,1,1)]}getViewportCount(){return this._viewportCount}getFrustum(){return this._frustum}updateMatrices(e){const t=this.camera,n=this.matrix;bw.setFromMatrixPosition(e.matrixWorld),t.position.copy(bw),Tw.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(Tw),t.updateMatrixWorld(),ME.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(ME),n.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),n.multiply(ME)}getViewport(e){return this._viewports[e]}getFrameExtents(){return this._frameExtents}dispose(){this.map&&this.map.dispose(),this.mapPass&&this.mapPass.dispose()}copy(e){return this.camera=e.camera.clone(),this.intensity=e.intensity,this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this}clone(){return new this.constructor().copy(this)}toJSON(){const e={};return this.intensity!==1&&(e.intensity=this.intensity),this.bias!==0&&(e.bias=this.bias),this.normalBias!==0&&(e.normalBias=this.normalBias),this.radius!==1&&(e.radius=this.radius),(this.mapSize.x!==512||this.mapSize.y!==512)&&(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}class RV extends hR{constructor(){super(new us(50,1,.5,500)),this.isSpotLightShadow=!0,this.focus=1}updateMatrices(e){const t=this.camera,n=fp*2*e.angle*this.focus,i=this.mapSize.width/this.mapSize.height,s=e.distance||t.far;(n!==t.fov||i!==t.aspect||s!==t.far)&&(t.fov=n,t.aspect=i,t.far=s,t.updateProjectionMatrix()),super.updateMatrices(e)}copy(e){return super.copy(e),this.focus=e.focus,this}}class wT extends pf{constructor(e,t,n=0,i=Math.PI/3,s=0,a=2){super(e,t),this.isSpotLight=!0,this.type="SpotLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.target=new Hn,this.distance=n,this.angle=i,this.penumbra=s,this.decay=a,this.map=null,this.shadow=new RV}get power(){return this.intensity*Math.PI}set power(e){this.intensity=e/Math.PI}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}const Mw=new Mt,Ov=new Y,EE=new Y;class NV extends hR{constructor(){super(new us(90,1,.5,500)),this.isPointLightShadow=!0,this._frameExtents=new Xe(4,2),this._viewportCount=6,this._viewports=[new Ot(2,1,1,1),new Ot(0,1,1,1),new Ot(3,1,1,1),new Ot(1,1,1,1),new Ot(3,0,1,1),new Ot(1,0,1,1)],this._cubeDirections=[new Y(1,0,0),new Y(-1,0,0),new Y(0,0,1),new Y(0,0,-1),new Y(0,1,0),new Y(0,-1,0)],this._cubeUps=[new Y(0,1,0),new Y(0,1,0),new Y(0,1,0),new Y(0,1,0),new Y(0,0,1),new Y(0,0,-1)]}updateMatrices(e,t=0){const n=this.camera,i=this.matrix,s=e.distance||n.far;s!==n.far&&(n.far=s,n.updateProjectionMatrix()),Ov.setFromMatrixPosition(e.matrixWorld),n.position.copy(Ov),EE.copy(n.position),EE.add(this._cubeDirections[t]),n.up.copy(this._cubeUps[t]),n.lookAt(EE),n.updateMatrixWorld(),i.makeTranslation(-Ov.x,-Ov.y,-Ov.z),Mw.multiplyMatrices(n.projectionMatrix,n.matrixWorldInverse),this._frustum.setFromProjectionMatrix(Mw)}}class fR extends pf{constructor(e,t,n=0,i=2){super(e,t),this.isPointLight=!0,this.type="PointLight",this.distance=n,this.decay=i,this.shadow=new NV}get power(){return this.intensity*4*Math.PI}set power(e){this.intensity=e/(4*Math.PI)}dispose(){this.shadow.dispose()}copy(e,t){return super.copy(e,t),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}class Mp extends X_{constructor(e=-1,t=1,n=1,i=-1,s=.1,a=2e3){super(),this.isOrthographicCamera=!0,this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e,this.right=t,this.top=n,this.bottom=i,this.near=s,this.far=a,this.updateProjectionMatrix()}copy(e,t){return super.copy(e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this}setViewOffset(e,t,n,i,s,a){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=n,this.view.offsetY=i,this.view.width=s,this.view.height=a,this.updateProjectionMatrix()}clearViewOffset(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()}updateProjectionMatrix(){const e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),n=(this.right+this.left)/2,i=(this.top+this.bottom)/2;let s=n-e,a=n+e,l=i+t,c=i-t;if(this.view!==null&&this.view.enabled){const d=(this.right-this.left)/this.view.fullWidth/this.zoom,m=(this.top-this.bottom)/this.view.fullHeight/this.zoom;s+=d*this.view.offsetX,a=s+d*this.view.width,l-=m*this.view.offsetY,c=l-m*this.view.height}this.projectionMatrix.makeOrthographic(s,a,l,c,this.near,this.far,this.coordinateSystem),this.projectionMatrixInverse.copy(this.projectionMatrix).invert()}toJSON(e){const t=super.toJSON(e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}class CV extends hR{constructor(){super(new Mp(-5,5,5,-5,.5,500)),this.isDirectionalLightShadow=!0}}class dR extends pf{constructor(e,t){super(e,t),this.isDirectionalLight=!0,this.type="DirectionalLight",this.position.copy(Hn.DEFAULT_UP),this.updateMatrix(),this.target=new Hn,this.shadow=new CV}dispose(){this.shadow.dispose()}copy(e){return super.copy(e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}class pR extends pf{constructor(e,t){super(e,t),this.isAmbientLight=!0,this.type="AmbientLight"}}class mR extends pf{constructor(e,t,n=10,i=10){super(e,t),this.isRectAreaLight=!0,this.type="RectAreaLight",this.width=n,this.height=i}get power(){return this.intensity*this.width*this.height*Math.PI}set power(e){this.intensity=e/(this.width*this.height*Math.PI)}copy(e){return super.copy(e),this.width=e.width,this.height=e.height,this}toJSON(e){const t=super.toJSON(e);return t.object.width=this.width,t.object.height=this.height,t}}class JU{constructor(){this.isSphericalHarmonics3=!0,this.coefficients=[];for(let e=0;e<9;e++)this.coefficients.push(new Y)}set(e){for(let t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this}zero(){for(let e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this}getAt(e,t){const n=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.282095),t.addScaledVector(a[1],.488603*i),t.addScaledVector(a[2],.488603*s),t.addScaledVector(a[3],.488603*n),t.addScaledVector(a[4],1.092548*(n*i)),t.addScaledVector(a[5],1.092548*(i*s)),t.addScaledVector(a[6],.315392*(3*s*s-1)),t.addScaledVector(a[7],1.092548*(n*s)),t.addScaledVector(a[8],.546274*(n*n-i*i)),t}getIrradianceAt(e,t){const n=e.x,i=e.y,s=e.z,a=this.coefficients;return t.copy(a[0]).multiplyScalar(.886227),t.addScaledVector(a[1],2*.511664*i),t.addScaledVector(a[2],2*.511664*s),t.addScaledVector(a[3],2*.511664*n),t.addScaledVector(a[4],2*.429043*n*i),t.addScaledVector(a[5],2*.429043*i*s),t.addScaledVector(a[6],.743125*s*s-.247708),t.addScaledVector(a[7],2*.429043*n*s),t.addScaledVector(a[8],.429043*(n*n-i*i)),t}add(e){for(let t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this}addScaledSH(e,t){for(let n=0;n<9;n++)this.coefficients[n].addScaledVector(e.coefficients[n],t);return this}scale(e){for(let t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this}lerp(e,t){for(let n=0;n<9;n++)this.coefficients[n].lerp(e.coefficients[n],t);return this}equals(e){for(let t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0}copy(e){return this.set(e.coefficients)}clone(){return new this.constructor().copy(this)}fromArray(e,t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].fromArray(e,t+i*3);return this}toArray(e=[],t=0){const n=this.coefficients;for(let i=0;i<9;i++)n[i].toArray(e,t+i*3);return e}static getBasisAt(e,t){const n=e.x,i=e.y,s=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*s,t[3]=.488603*n,t[4]=1.092548*n*i,t[5]=1.092548*i*s,t[6]=.315392*(3*s*s-1),t[7]=1.092548*n*s,t[8]=.546274*(n*n-i*i)}}class gR extends pf{constructor(e=new JU,t=1){super(void 0,t),this.isLightProbe=!0,this.sh=e}copy(e){return super.copy(e),this.sh.copy(e.sh),this}fromJSON(e){return this.intensity=e.intensity,this.sh.fromArray(e.sh),this}toJSON(e){const t=super.toJSON(e);return t.object.sh=this.sh.toArray(),t}}class DT extends ja{constructor(e){super(e),this.textures={}}load(e,t,n,i){const s=this,a=new zc(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(l){try{t(s.parse(JSON.parse(l)))}catch(c){i?i(c):console.error(c),s.manager.itemError(e)}},n,i)}parse(e){const t=this.textures;function n(s){return t[s]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",s),t[s]}const i=this.createMaterialFromType(e.type);if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=e.sheen),e.sheenColor!==void 0&&(i.sheenColor=new ft().setHex(e.sheenColor)),e.sheenRoughness!==void 0&&(i.sheenRoughness=e.sheenRoughness),e.emissive!==void 0&&i.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular!==void 0&&i.specular.setHex(e.specular),e.specularIntensity!==void 0&&(i.specularIntensity=e.specularIntensity),e.specularColor!==void 0&&i.specularColor!==void 0&&i.specularColor.setHex(e.specularColor),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.dispersion!==void 0&&(i.dispersion=e.dispersion),e.iridescence!==void 0&&(i.iridescence=e.iridescence),e.iridescenceIOR!==void 0&&(i.iridescenceIOR=e.iridescenceIOR),e.iridescenceThicknessRange!==void 0&&(i.iridescenceThicknessRange=e.iridescenceThicknessRange),e.transmission!==void 0&&(i.transmission=e.transmission),e.thickness!==void 0&&(i.thickness=e.thickness),e.attenuationDistance!==void 0&&(i.attenuationDistance=e.attenuationDistance),e.attenuationColor!==void 0&&i.attenuationColor!==void 0&&i.attenuationColor.setHex(e.attenuationColor),e.anisotropy!==void 0&&(i.anisotropy=e.anisotropy),e.anisotropyRotation!==void 0&&(i.anisotropyRotation=e.anisotropyRotation),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.shadowSide!==void 0&&(i.shadowSide=e.shadowSide),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.alphaHash!==void 0&&(i.alphaHash=e.alphaHash),e.depthFunc!==void 0&&(i.depthFunc=e.depthFunc),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.blendSrc!==void 0&&(i.blendSrc=e.blendSrc),e.blendDst!==void 0&&(i.blendDst=e.blendDst),e.blendEquation!==void 0&&(i.blendEquation=e.blendEquation),e.blendSrcAlpha!==void 0&&(i.blendSrcAlpha=e.blendSrcAlpha),e.blendDstAlpha!==void 0&&(i.blendDstAlpha=e.blendDstAlpha),e.blendEquationAlpha!==void 0&&(i.blendEquationAlpha=e.blendEquationAlpha),e.blendColor!==void 0&&i.blendColor!==void 0&&i.blendColor.setHex(e.blendColor),e.blendAlpha!==void 0&&(i.blendAlpha=e.blendAlpha),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==void 0&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.dithering!==void 0&&(i.dithering=e.dithering),e.alphaToCoverage!==void 0&&(i.alphaToCoverage=e.alphaToCoverage),e.premultipliedAlpha!==void 0&&(i.premultipliedAlpha=e.premultipliedAlpha),e.forceSinglePass!==void 0&&(i.forceSinglePass=e.forceSinglePass),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.vertexColors!==void 0&&(typeof e.vertexColors=="number"?i.vertexColors=e.vertexColors>0:i.vertexColors=e.vertexColors),e.uniforms!==void 0)for(const s in e.uniforms){const a=e.uniforms[s];switch(i.uniforms[s]={},a.type){case"t":i.uniforms[s].value=n(a.value);break;case"c":i.uniforms[s].value=new ft().setHex(a.value);break;case"v2":i.uniforms[s].value=new Xe().fromArray(a.value);break;case"v3":i.uniforms[s].value=new Y().fromArray(a.value);break;case"v4":i.uniforms[s].value=new Ot().fromArray(a.value);break;case"m3":i.uniforms[s].value=new Qt().fromArray(a.value);break;case"m4":i.uniforms[s].value=new Mt().fromArray(a.value);break;default:i.uniforms[s].value=a.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.glslVersion!==void 0&&(i.glslVersion=e.glslVersion),e.extensions!==void 0)for(const s in e.extensions)i.extensions[s]=e.extensions[s];if(e.lights!==void 0&&(i.lights=e.lights),e.clipping!==void 0&&(i.clipping=e.clipping),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=n(e.map)),e.matcap!==void 0&&(i.matcap=n(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=n(e.alphaMap)),e.bumpMap!==void 0&&(i.bumpMap=n(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=n(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){let s=e.normalScale;Array.isArray(s)===!1&&(s=[s,s]),i.normalScale=new Xe().fromArray(s)}return e.displacementMap!==void 0&&(i.displacementMap=n(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=n(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=n(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=n(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=n(e.specularMap)),e.specularIntensityMap!==void 0&&(i.specularIntensityMap=n(e.specularIntensityMap)),e.specularColorMap!==void 0&&(i.specularColorMap=n(e.specularColorMap)),e.envMap!==void 0&&(i.envMap=n(e.envMap)),e.envMapRotation!==void 0&&i.envMapRotation.fromArray(e.envMapRotation),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=n(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=n(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=n(e.gradientMap)),e.clearcoatMap!==void 0&&(i.clearcoatMap=n(e.clearcoatMap)),e.clearcoatRoughnessMap!==void 0&&(i.clearcoatRoughnessMap=n(e.clearcoatRoughnessMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=n(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new Xe().fromArray(e.clearcoatNormalScale)),e.iridescenceMap!==void 0&&(i.iridescenceMap=n(e.iridescenceMap)),e.iridescenceThicknessMap!==void 0&&(i.iridescenceThicknessMap=n(e.iridescenceThicknessMap)),e.transmissionMap!==void 0&&(i.transmissionMap=n(e.transmissionMap)),e.thicknessMap!==void 0&&(i.thicknessMap=n(e.thicknessMap)),e.anisotropyMap!==void 0&&(i.anisotropyMap=n(e.anisotropyMap)),e.sheenColorMap!==void 0&&(i.sheenColorMap=n(e.sheenColorMap)),e.sheenRoughnessMap!==void 0&&(i.sheenRoughnessMap=n(e.sheenRoughnessMap)),i}setTextures(e){return this.textures=e,this}createMaterialFromType(e){return DT.createMaterialFromType(e)}static createMaterialFromType(e){const t={ShadowMaterial:K1,SpriteMaterial:hT,RawShaderMaterial:WU,ShaderMaterial:Hl,PointsMaterial:dT,MeshPhysicalMaterial:Q1,MeshStandardMaterial:NT,MeshPhongMaterial:J1,MeshToonMaterial:$1,MeshNormalMaterial:eR,MeshLambertMaterial:tR,MeshDepthMaterial:nR,MeshDistanceMaterial:iR,MeshBasicMaterial:fa,MeshMatcapMaterial:sR,LineDashedMaterial:rR,LineBasicMaterial:qr,Material:ar};return new t[e]}}class GA{static extractUrlBase(e){const t=e.lastIndexOf("/");return t===-1?"./":e.slice(0,t+1)}static resolveURL(e,t){return typeof e!="string"||e===""?"":(/^https?:\/\//i.test(t)&&/^\//.test(e)&&(t=t.replace(/(^https?:\/\/[^\/]+).*/i,"$1")),/^(https?:)?\/\//i.test(e)||/^data:.*,.*$/i.test(e)||/^blob:.*$/i.test(e)?e:t+e)}}class $U extends fn{constructor(){super(),this.isInstancedBufferGeometry=!0,this.type="InstancedBufferGeometry",this.instanceCount=1/0}copy(e){return super.copy(e),this.instanceCount=e.instanceCount,this}toJSON(){const e=super.toJSON();return e.instanceCount=this.instanceCount,e.isInstancedBufferGeometry=!0,e}}class e3 extends ja{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new zc(s.manager);a.setPath(s.path),a.setRequestHeader(s.requestHeader),a.setWithCredentials(s.withCredentials),a.load(e,function(l){try{t(s.parse(JSON.parse(l)))}catch(c){i?i(c):console.error(c),s.manager.itemError(e)}},n,i)}parse(e){const t={},n={};function i(x,S){if(t[S]!==void 0)return t[S];const E=x.interleavedBuffers[S],M=s(x,E.buffer),C=ug(E.type,M),w=new Y_(C,E.stride);return w.uuid=E.uuid,t[S]=w,w}function s(x,S){if(n[S]!==void 0)return n[S];const E=x.arrayBuffers[S],M=new Uint32Array(E).buffer;return n[S]=M,M}const a=e.isInstancedBufferGeometry?new $U:new fn,l=e.data.index;if(l!==void 0){const x=ug(l.type,l.array);a.setIndex(new Kn(x,1))}const c=e.data.attributes;for(const x in c){const S=c[x];let A;if(S.isInterleavedBufferAttribute){const E=i(e.data,S.data);A=new uf(E,S.itemSize,S.offset,S.normalized)}else{const E=ug(S.type,S.array),M=S.isInstancedBufferAttribute?Qo:Kn;A=new M(E,S.itemSize,S.normalized)}S.name!==void 0&&(A.name=S.name),S.usage!==void 0&&A.setUsage(S.usage),a.setAttribute(x,A)}const d=e.data.morphAttributes;if(d)for(const x in d){const S=d[x],A=[];for(let E=0,M=S.length;E<M;E++){const C=S[E];let w;if(C.isInterleavedBufferAttribute){const D=i(e.data,C.data);w=new uf(D,C.itemSize,C.offset,C.normalized)}else{const D=ug(C.type,C.array);w=new Kn(D,C.itemSize,C.normalized)}C.name!==void 0&&(w.name=C.name),A.push(w)}a.morphAttributes[x]=A}e.data.morphTargetsRelative&&(a.morphTargetsRelative=!0);const y=e.data.groups||e.data.drawcalls||e.data.offsets;if(y!==void 0)for(let x=0,S=y.length;x!==S;++x){const A=y[x];a.addGroup(A.start,A.count,A.materialIndex)}const v=e.data.boundingSphere;if(v!==void 0){const x=new Y;v.center!==void 0&&x.fromArray(v.center),a.boundingSphere=new br(x,v.radius)}return e.name&&(a.name=e.name),e.userData&&(a.userData=e.userData),a}}class wV extends ja{constructor(e){super(e)}load(e,t,n,i){const s=this,a=this.path===""?GA.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||a;const l=new zc(this.manager);l.setPath(this.path),l.setRequestHeader(this.requestHeader),l.setWithCredentials(this.withCredentials),l.load(e,function(c){let d=null;try{d=JSON.parse(c)}catch(y){i!==void 0&&i(y),console.error("THREE:ObjectLoader: Can't parse "+e+".",y.message);return}const m=d.metadata;if(m===void 0||m.type===void 0||m.type.toLowerCase()==="geometry"){i!==void 0&&i(new Error("THREE.ObjectLoader: Can't load "+e)),console.error("THREE.ObjectLoader: Can't load "+e);return}s.parse(d,t)},n,i)}async loadAsync(e,t){const n=this,i=this.path===""?GA.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||i;const s=new zc(this.manager);s.setPath(this.path),s.setRequestHeader(this.requestHeader),s.setWithCredentials(this.withCredentials);const a=await s.loadAsync(e,t),l=JSON.parse(a),c=l.metadata;if(c===void 0||c.type===void 0||c.type.toLowerCase()==="geometry")throw new Error("THREE.ObjectLoader: Can't load "+e);return await n.parseAsync(l)}parse(e,t){const n=this.parseAnimations(e.animations),i=this.parseShapes(e.shapes),s=this.parseGeometries(e.geometries,i),a=this.parseImages(e.images,function(){t!==void 0&&t(d)}),l=this.parseTextures(e.textures,a),c=this.parseMaterials(e.materials,l),d=this.parseObject(e.object,s,c,l,n),m=this.parseSkeletons(e.skeletons,d);if(this.bindSkeletons(d,m),this.bindLightTargets(d),t!==void 0){let y=!1;for(const v in a)if(a[v].data instanceof HTMLImageElement){y=!0;break}y===!1&&t(d)}return d}async parseAsync(e){const t=this.parseAnimations(e.animations),n=this.parseShapes(e.shapes),i=this.parseGeometries(e.geometries,n),s=await this.parseImagesAsync(e.images),a=this.parseTextures(e.textures,s),l=this.parseMaterials(e.materials,a),c=this.parseObject(e.object,i,l,a,t),d=this.parseSkeletons(e.skeletons,c);return this.bindSkeletons(c,d),this.bindLightTargets(c),c}parseShapes(e){const t={};if(e!==void 0)for(let n=0,i=e.length;n<i;n++){const s=new Hd().fromJSON(e[n]);t[s.uuid]=s}return t}parseSkeletons(e,t){const n={},i={};if(t.traverse(function(s){s.isBone&&(i[s.uuid]=s)}),e!==void 0)for(let s=0,a=e.length;s<a;s++){const l=new fT().fromJSON(e[s],i);n[l.uuid]=l}return n}parseGeometries(e,t){const n={};if(e!==void 0){const i=new e3;for(let s=0,a=e.length;s<a;s++){let l;const c=e[s];switch(c.type){case"BufferGeometry":case"InstancedBufferGeometry":l=i.parse(c);break;default:c.type in Sw?l=Sw[c.type].fromJSON(c,t):console.warn(`THREE.ObjectLoader: Unsupported geometry type "${c.type}"`)}l.uuid=c.uuid,c.name!==void 0&&(l.name=c.name),c.userData!==void 0&&(l.userData=c.userData),n[c.uuid]=l}}return n}parseMaterials(e,t){const n={},i={};if(e!==void 0){const s=new DT;s.setTextures(t);for(let a=0,l=e.length;a<l;a++){const c=e[a];n[c.uuid]===void 0&&(n[c.uuid]=s.parse(c)),i[c.uuid]=n[c.uuid]}}return i}parseAnimations(e){const t={};if(e!==void 0)for(let n=0;n<e.length;n++){const i=e[n],s=M_.parse(i);t[s.uuid]=s}return t}parseImages(e,t){const n=this,i={};let s;function a(c){return n.manager.itemStart(c),s.load(c,function(){n.manager.itemEnd(c)},void 0,function(){n.manager.itemError(c),n.manager.itemEnd(c)})}function l(c){if(typeof c=="string"){const d=c,m=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(d)?d:n.resourcePath+d;return a(m)}else return c.data?{data:ug(c.type,c.data),width:c.width,height:c.height}:null}if(e!==void 0&&e.length>0){const c=new uR(t);s=new E_(c),s.setCrossOrigin(this.crossOrigin);for(let d=0,m=e.length;d<m;d++){const y=e[d],v=y.url;if(Array.isArray(v)){const x=[];for(let S=0,A=v.length;S<A;S++){const E=v[S],M=l(E);M!==null&&(M instanceof HTMLImageElement?x.push(M):x.push(new Fl(M.data,M.width,M.height)))}i[y.uuid]=new Jh(x)}else{const x=l(y.url);i[y.uuid]=new Jh(x)}}}return i}async parseImagesAsync(e){const t=this,n={};let i;async function s(a){if(typeof a=="string"){const l=a,c=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(l)?l:t.resourcePath+l;return await i.loadAsync(c)}else return a.data?{data:ug(a.type,a.data),width:a.width,height:a.height}:null}if(e!==void 0&&e.length>0){i=new E_(this.manager),i.setCrossOrigin(this.crossOrigin);for(let a=0,l=e.length;a<l;a++){const c=e[a],d=c.url;if(Array.isArray(d)){const m=[];for(let y=0,v=d.length;y<v;y++){const x=d[y],S=await s(x);S!==null&&(S instanceof HTMLImageElement?m.push(S):m.push(new Fl(S.data,S.width,S.height)))}n[c.uuid]=new Jh(m)}else{const m=await s(c.url);n[c.uuid]=new Jh(m)}}}return n}parseTextures(e,t){function n(s,a){return typeof s=="number"?s:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",s),a[s])}const i={};if(e!==void 0)for(let s=0,a=e.length;s<a;s++){const l=e[s];l.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',l.uuid),t[l.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",l.image);const c=t[l.image],d=c.data;let m;Array.isArray(d)?(m=new _p,d.length===6&&(m.needsUpdate=!0)):(d&&d.data?m=new Fl:m=new Li,d&&(m.needsUpdate=!0)),m.source=c,m.uuid=l.uuid,l.name!==void 0&&(m.name=l.name),l.mapping!==void 0&&(m.mapping=n(l.mapping,DV)),l.channel!==void 0&&(m.channel=l.channel),l.offset!==void 0&&m.offset.fromArray(l.offset),l.repeat!==void 0&&m.repeat.fromArray(l.repeat),l.center!==void 0&&m.center.fromArray(l.center),l.rotation!==void 0&&(m.rotation=l.rotation),l.wrap!==void 0&&(m.wrapS=n(l.wrap[0],Ew),m.wrapT=n(l.wrap[1],Ew)),l.format!==void 0&&(m.format=l.format),l.internalFormat!==void 0&&(m.internalFormat=l.internalFormat),l.type!==void 0&&(m.type=l.type),l.colorSpace!==void 0&&(m.colorSpace=l.colorSpace),l.minFilter!==void 0&&(m.minFilter=n(l.minFilter,Aw)),l.magFilter!==void 0&&(m.magFilter=n(l.magFilter,Aw)),l.anisotropy!==void 0&&(m.anisotropy=l.anisotropy),l.flipY!==void 0&&(m.flipY=l.flipY),l.generateMipmaps!==void 0&&(m.generateMipmaps=l.generateMipmaps),l.premultiplyAlpha!==void 0&&(m.premultiplyAlpha=l.premultiplyAlpha),l.unpackAlignment!==void 0&&(m.unpackAlignment=l.unpackAlignment),l.compareFunction!==void 0&&(m.compareFunction=l.compareFunction),l.userData!==void 0&&(m.userData=l.userData),i[l.uuid]=m}return i}parseObject(e,t,n,i,s){let a;function l(v){return t[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",v),t[v]}function c(v){if(v!==void 0){if(Array.isArray(v)){const x=[];for(let S=0,A=v.length;S<A;S++){const E=v[S];n[E]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",E),x.push(n[E])}return x}return n[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",v),n[v]}}function d(v){return i[v]===void 0&&console.warn("THREE.ObjectLoader: Undefined texture",v),i[v]}let m,y;switch(e.type){case"Scene":a=new ey,e.background!==void 0&&(Number.isInteger(e.background)?a.background=new ft(e.background):a.background=d(e.background)),e.environment!==void 0&&(a.environment=d(e.environment)),e.fog!==void 0&&(e.fog.type==="Fog"?a.fog=new cT(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(a.fog=new uT(e.fog.color,e.fog.density)),e.fog.name!==""&&(a.fog.name=e.fog.name)),e.backgroundBlurriness!==void 0&&(a.backgroundBlurriness=e.backgroundBlurriness),e.backgroundIntensity!==void 0&&(a.backgroundIntensity=e.backgroundIntensity),e.backgroundRotation!==void 0&&a.backgroundRotation.fromArray(e.backgroundRotation),e.environmentIntensity!==void 0&&(a.environmentIntensity=e.environmentIntensity),e.environmentRotation!==void 0&&a.environmentRotation.fromArray(e.environmentRotation);break;case"PerspectiveCamera":a=new us(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(a.focus=e.focus),e.zoom!==void 0&&(a.zoom=e.zoom),e.filmGauge!==void 0&&(a.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(a.filmOffset=e.filmOffset),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"OrthographicCamera":a=new Mp(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(a.zoom=e.zoom),e.view!==void 0&&(a.view=Object.assign({},e.view));break;case"AmbientLight":a=new pR(e.color,e.intensity);break;case"DirectionalLight":a=new dR(e.color,e.intensity),a.target=e.target||"";break;case"PointLight":a=new fR(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":a=new mR(e.color,e.intensity,e.width,e.height);break;case"SpotLight":a=new wT(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay),a.target=e.target||"";break;case"HemisphereLight":a=new cR(e.color,e.groundColor,e.intensity);break;case"LightProbe":a=new gR().fromJSON(e);break;case"SkinnedMesh":m=l(e.geometry),y=c(e.material),a=new NU(m,y),e.bindMode!==void 0&&(a.bindMode=e.bindMode),e.bindMatrix!==void 0&&a.bindMatrix.fromArray(e.bindMatrix),e.skeleton!==void 0&&(a.skeleton=e.skeleton);break;case"Mesh":m=l(e.geometry),y=c(e.material),a=new bi(m,y);break;case"InstancedMesh":m=l(e.geometry),y=c(e.material);const v=e.count,x=e.instanceMatrix,S=e.instanceColor;a=new CU(m,y,v),a.instanceMatrix=new Qo(new Float32Array(x.array),16),S!==void 0&&(a.instanceColor=new Qo(new Float32Array(S.array),S.itemSize));break;case"BatchedMesh":m=l(e.geometry),y=c(e.material),a=new wU(e.maxInstanceCount,e.maxVertexCount,e.maxIndexCount,y),a.geometry=m,a.perObjectFrustumCulled=e.perObjectFrustumCulled,a.sortObjects=e.sortObjects,a._drawRanges=e.drawRanges,a._reservedRanges=e.reservedRanges,a._visibility=e.visibility,a._active=e.active,a._bounds=e.bounds.map(A=>{const E=new ga;E.min.fromArray(A.boxMin),E.max.fromArray(A.boxMax);const M=new br;return M.radius=A.sphereRadius,M.center.fromArray(A.sphereCenter),{boxInitialized:A.boxInitialized,box:E,sphereInitialized:A.sphereInitialized,sphere:M}}),a._maxInstanceCount=e.maxInstanceCount,a._maxVertexCount=e.maxVertexCount,a._maxIndexCount=e.maxIndexCount,a._geometryInitialized=e.geometryInitialized,a._geometryCount=e.geometryCount,a._matricesTexture=d(e.matricesTexture.uuid),e.colorsTexture!==void 0&&(a._colorsTexture=d(e.colorsTexture.uuid));break;case"LOD":a=new RU;break;case"Line":a=new cf(l(e.geometry),c(e.material));break;case"LineLoop":a=new DU(l(e.geometry),c(e.material));break;case"LineSegments":a=new Xu(l(e.geometry),c(e.material));break;case"PointCloud":case"Points":a=new UU(l(e.geometry),c(e.material));break;case"Sprite":a=new AU(c(e.material));break;case"Group":a=new cg;break;case"Bone":a=new H1;break;default:a=new Hn}if(a.uuid=e.uuid,e.name!==void 0&&(a.name=e.name),e.matrix!==void 0?(a.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(a.matrixAutoUpdate=e.matrixAutoUpdate),a.matrixAutoUpdate&&a.matrix.decompose(a.position,a.quaternion,a.scale)):(e.position!==void 0&&a.position.fromArray(e.position),e.rotation!==void 0&&a.rotation.fromArray(e.rotation),e.quaternion!==void 0&&a.quaternion.fromArray(e.quaternion),e.scale!==void 0&&a.scale.fromArray(e.scale)),e.up!==void 0&&a.up.fromArray(e.up),e.castShadow!==void 0&&(a.castShadow=e.castShadow),e.receiveShadow!==void 0&&(a.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.intensity!==void 0&&(a.shadow.intensity=e.shadow.intensity),e.shadow.bias!==void 0&&(a.shadow.bias=e.shadow.bias),e.shadow.normalBias!==void 0&&(a.shadow.normalBias=e.shadow.normalBias),e.shadow.radius!==void 0&&(a.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&a.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(a.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(a.visible=e.visible),e.frustumCulled!==void 0&&(a.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(a.renderOrder=e.renderOrder),e.userData!==void 0&&(a.userData=e.userData),e.layers!==void 0&&(a.layers.mask=e.layers),e.children!==void 0){const v=e.children;for(let x=0;x<v.length;x++)a.add(this.parseObject(v[x],t,n,i,s))}if(e.animations!==void 0){const v=e.animations;for(let x=0;x<v.length;x++){const S=v[x];a.animations.push(s[S])}}if(e.type==="LOD"){e.autoUpdate!==void 0&&(a.autoUpdate=e.autoUpdate);const v=e.levels;for(let x=0;x<v.length;x++){const S=v[x],A=a.getObjectByProperty("uuid",S.object);A!==void 0&&a.addLevel(A,S.distance,S.hysteresis)}}return a}bindSkeletons(e,t){Object.keys(t).length!==0&&e.traverse(function(n){if(n.isSkinnedMesh===!0&&n.skeleton!==void 0){const i=t[n.skeleton];i===void 0?console.warn("THREE.ObjectLoader: No skeleton found with UUID:",n.skeleton):n.bind(i,n.bindMatrix)}})}bindLightTargets(e){e.traverse(function(t){if(t.isDirectionalLight||t.isSpotLight){const n=t.target,i=e.getObjectByProperty("uuid",n);i!==void 0?t.target=i:t.target=new Hn}})}}const DV={UVMapping:z_,CubeReflectionMapping:va,CubeRefractionMapping:Wa,EquirectangularReflectionMapping:Pu,EquirectangularRefractionMapping:Iu,CubeUVReflectionMapping:Ic},Ew={RepeatWrapping:zl,ClampToEdgeWrapping:da,MirroredRepeatWrapping:Fc},Aw={NearestFilter:Si,NearestMipmapNearestFilter:V_,NearestMipmapLinearFilter:Ol,LinearFilter:Zn,LinearMipmapNearestFilter:ef,LinearMipmapLinearFilter:xr};class UV extends ja{constructor(e){super(e),this.isImageBitmapLoader=!0,typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),this.options={premultiplyAlpha:"none"}}setOptions(e){return this.options=e,this}load(e,t,n,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);const s=this,a=Cc.get(e);if(a!==void 0){if(s.manager.itemStart(e),a.then){a.then(d=>{t&&t(d),s.manager.itemEnd(e)}).catch(d=>{i&&i(d)});return}return setTimeout(function(){t&&t(a),s.manager.itemEnd(e)},0),a}const l={};l.credentials=this.crossOrigin==="anonymous"?"same-origin":"include",l.headers=this.requestHeader;const c=fetch(e,l).then(function(d){return d.blob()}).then(function(d){return createImageBitmap(d,Object.assign(s.options,{colorSpaceConversion:"none"}))}).then(function(d){return Cc.add(e,d),t&&t(d),s.manager.itemEnd(e),d}).catch(function(d){i&&i(d),Cc.remove(e),s.manager.itemError(e),s.manager.itemEnd(e)});Cc.add(e,c),s.manager.itemStart(e)}}let MS;class yR{static getContext(){return MS===void 0&&(MS=new(window.AudioContext||window.webkitAudioContext)),MS}static setContext(e){MS=e}}class LV extends ja{constructor(e){super(e)}load(e,t,n,i){const s=this,a=new zc(this.manager);a.setResponseType("arraybuffer"),a.setPath(this.path),a.setRequestHeader(this.requestHeader),a.setWithCredentials(this.withCredentials),a.load(e,function(c){try{const d=c.slice(0);yR.getContext().decodeAudioData(d,function(y){t(y)}).catch(l)}catch(d){l(d)}},n,i);function l(c){i?i(c):console.error(c),s.manager.itemError(e)}}}const Rw=new Mt,Nw=new Mt,gd=new Mt;class BV{constructor(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new us,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new us,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}update(e){const t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep,gd.copy(e.projectionMatrix);const i=t.eyeSep/2,s=i*t.near/t.focus,a=t.near*Math.tan(Gd*t.fov*.5)/t.zoom;let l,c;Nw.elements[12]=-i,Rw.elements[12]=i,l=-a*t.aspect+s,c=a*t.aspect+s,gd.elements[0]=2*t.near/(c-l),gd.elements[8]=(c+l)/(c-l),this.cameraL.projectionMatrix.copy(gd),l=-a*t.aspect-s,c=a*t.aspect-s,gd.elements[0]=2*t.near/(c-l),gd.elements[8]=(c+l)/(c-l),this.cameraR.projectionMatrix.copy(gd)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Nw),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Rw)}}class vR extends us{constructor(e=[]){super(),this.isArrayCamera=!0,this.cameras=e,this.index=0}}class _R{constructor(e=!0){this.autoStart=e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}start(){this.startTime=Cw(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}stop(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}getElapsedTime(){return this.getDelta(),this.elapsedTime}getDelta(){let e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){const t=Cw();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}}function Cw(){return performance.now()}const yd=new Y,ww=new ma,OV=new Y,vd=new Y;class PV extends Hn{constructor(){super(),this.type="AudioListener",this.context=yR.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new _R}getInput(){return this.gain}removeFilter(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this}getFilter(){return this.filter}setFilter(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this}getMasterVolume(){return this.gain.gain.value}setMasterVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}updateMatrixWorld(e){super.updateMatrixWorld(e);const t=this.context.listener,n=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(yd,ww,OV),vd.set(0,0,-1).applyQuaternion(ww),t.positionX){const i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(yd.x,i),t.positionY.linearRampToValueAtTime(yd.y,i),t.positionZ.linearRampToValueAtTime(yd.z,i),t.forwardX.linearRampToValueAtTime(vd.x,i),t.forwardY.linearRampToValueAtTime(vd.y,i),t.forwardZ.linearRampToValueAtTime(vd.z,i),t.upX.linearRampToValueAtTime(n.x,i),t.upY.linearRampToValueAtTime(n.y,i),t.upZ.linearRampToValueAtTime(n.z,i)}else t.setPosition(yd.x,yd.y,yd.z),t.setOrientation(vd.x,vd.y,vd.z,n.x,n.y,n.z)}}class t3 extends Hn{constructor(e){super(),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.source=null,this.sourceType="empty",this._startedAt=0,this._progress=0,this._connected=!1,this.filters=[]}getOutput(){return this.gain}setNodeSource(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this}setMediaElementSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this}setMediaStreamSource(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this}setBuffer(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this}play(e=0){if(this.isPlaying===!0){console.warn("THREE.Audio: Audio is already playing.");return}if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}this._startedAt=this.context.currentTime+e;const t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._progress+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}pause(){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.isPlaying===!0&&(this._progress+=Math.max(this.context.currentTime-this._startedAt,0)*this.playbackRate,this.loop===!0&&(this._progress=this._progress%(this.duration||this.buffer.duration)),this.source.stop(),this.source.onended=null,this.isPlaying=!1),this}stop(e=0){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this._progress=0,this.source!==null&&(this.source.stop(this.context.currentTime+e),this.source.onended=null),this.isPlaying=!1,this}connect(){if(this.filters.length>0){this.source.connect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this._connected=!0,this}disconnect(){if(this._connected!==!1){if(this.filters.length>0){this.source.disconnect(this.filters[0]);for(let e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this._connected=!1,this}}getFilters(){return this.filters}setFilters(e){return e||(e=[]),this._connected===!0?(this.disconnect(),this.filters=e.slice(),this.connect()):this.filters=e.slice(),this}setDetune(e){return this.detune=e,this.isPlaying===!0&&this.source.detune!==void 0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this}getDetune(){return this.detune}getFilter(){return this.getFilters()[0]}setFilter(e){return this.setFilters(e?[e]:[])}setPlaybackRate(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this}getPlaybackRate(){return this.playbackRate}onEnded(){this.isPlaying=!1,this._progress=0}getLoop(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop}setLoop(e){if(this.hasPlaybackControl===!1){console.warn("THREE.Audio: this Audio has no playback control.");return}return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this}setLoopStart(e){return this.loopStart=e,this}setLoopEnd(e){return this.loopEnd=e,this}getVolume(){return this.gain.gain.value}setVolume(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}copy(e,t){return super.copy(e,t),e.sourceType!=="buffer"?(console.warn("THREE.Audio: Audio source type cannot be copied."),this):(this.autoplay=e.autoplay,this.buffer=e.buffer,this.detune=e.detune,this.loop=e.loop,this.loopStart=e.loopStart,this.loopEnd=e.loopEnd,this.offset=e.offset,this.duration=e.duration,this.playbackRate=e.playbackRate,this.hasPlaybackControl=e.hasPlaybackControl,this.sourceType=e.sourceType,this.filters=e.filters.slice(),this)}clone(e){return new this.constructor(this.listener).copy(this,e)}}const _d=new Y,Dw=new ma,IV=new Y,xd=new Y;class FV extends t3{constructor(e){super(e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}connect(){return super.connect(),this.panner.connect(this.gain),this}disconnect(){return super.disconnect(),this.panner.disconnect(this.gain),this}getOutput(){return this.panner}getRefDistance(){return this.panner.refDistance}setRefDistance(e){return this.panner.refDistance=e,this}getRolloffFactor(){return this.panner.rolloffFactor}setRolloffFactor(e){return this.panner.rolloffFactor=e,this}getDistanceModel(){return this.panner.distanceModel}setDistanceModel(e){return this.panner.distanceModel=e,this}getMaxDistance(){return this.panner.maxDistance}setMaxDistance(e){return this.panner.maxDistance=e,this}setDirectionalCone(e,t,n){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=n,this}updateMatrixWorld(e){if(super.updateMatrixWorld(e),this.hasPlaybackControl===!0&&this.isPlaying===!1)return;this.matrixWorld.decompose(_d,Dw,IV),xd.set(0,0,1).applyQuaternion(Dw);const t=this.panner;if(t.positionX){const n=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(_d.x,n),t.positionY.linearRampToValueAtTime(_d.y,n),t.positionZ.linearRampToValueAtTime(_d.z,n),t.orientationX.linearRampToValueAtTime(xd.x,n),t.orientationY.linearRampToValueAtTime(xd.y,n),t.orientationZ.linearRampToValueAtTime(xd.z,n)}else t.setPosition(_d.x,_d.y,_d.z),t.setOrientation(xd.x,xd.y,xd.z)}}class zV{constructor(e,t=2048){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}getFrequencyData(){return this.analyser.getByteFrequencyData(this.data),this.data}getAverageFrequency(){let e=0;const t=this.getFrequencyData();for(let n=0;n<t.length;n++)e+=t[n];return e/t.length}}class n3{constructor(e,t,n){this.binding=e,this.valueSize=n;let i,s,a;switch(t){case"quaternion":i=this._slerp,s=this._slerpAdditive,a=this._setAdditiveIdentityQuaternion,this.buffer=new Float64Array(n*6),this._workIndex=5;break;case"string":case"bool":i=this._select,s=this._select,a=this._setAdditiveIdentityOther,this.buffer=new Array(n*5);break;default:i=this._lerp,s=this._lerpAdditive,a=this._setAdditiveIdentityNumeric,this.buffer=new Float64Array(n*5)}this._mixBufferRegion=i,this._mixBufferRegionAdditive=s,this._setIdentity=a,this._origIndex=3,this._addIndex=4,this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,this.useCount=0,this.referenceCount=0}accumulate(e,t){const n=this.buffer,i=this.valueSize,s=e*i+i;let a=this.cumulativeWeight;if(a===0){for(let l=0;l!==i;++l)n[s+l]=n[l];a=t}else{a+=t;const l=t/a;this._mixBufferRegion(n,s,0,l,i)}this.cumulativeWeight=a}accumulateAdditive(e){const t=this.buffer,n=this.valueSize,i=n*this._addIndex;this.cumulativeWeightAdditive===0&&this._setIdentity(),this._mixBufferRegionAdditive(t,i,0,e,n),this.cumulativeWeightAdditive+=e}apply(e){const t=this.valueSize,n=this.buffer,i=e*t+t,s=this.cumulativeWeight,a=this.cumulativeWeightAdditive,l=this.binding;if(this.cumulativeWeight=0,this.cumulativeWeightAdditive=0,s<1){const c=t*this._origIndex;this._mixBufferRegion(n,i,c,1-s,t)}a>0&&this._mixBufferRegionAdditive(n,i,this._addIndex*t,1,t);for(let c=t,d=t+t;c!==d;++c)if(n[c]!==n[c+t]){l.setValue(n,i);break}}saveOriginalState(){const e=this.binding,t=this.buffer,n=this.valueSize,i=n*this._origIndex;e.getValue(t,i);for(let s=n,a=i;s!==a;++s)t[s]=t[i+s%n];this._setIdentity(),this.cumulativeWeight=0,this.cumulativeWeightAdditive=0}restoreOriginalState(){const e=this.valueSize*3;this.binding.setValue(this.buffer,e)}_setAdditiveIdentityNumeric(){const e=this._addIndex*this.valueSize,t=e+this.valueSize;for(let n=e;n<t;n++)this.buffer[n]=0}_setAdditiveIdentityQuaternion(){this._setAdditiveIdentityNumeric(),this.buffer[this._addIndex*this.valueSize+3]=1}_setAdditiveIdentityOther(){const e=this._origIndex*this.valueSize,t=this._addIndex*this.valueSize;for(let n=0;n<this.valueSize;n++)this.buffer[t+n]=this.buffer[e+n]}_select(e,t,n,i,s){if(i>=.5)for(let a=0;a!==s;++a)e[t+a]=e[n+a]}_slerp(e,t,n,i){ma.slerpFlat(e,t,e,t,e,n,i)}_slerpAdditive(e,t,n,i,s){const a=this._workIndex*s;ma.multiplyQuaternionsFlat(e,a,e,t,e,n),ma.slerpFlat(e,t,e,t,e,a,i)}_lerp(e,t,n,i,s){const a=1-i;for(let l=0;l!==s;++l){const c=t+l;e[c]=e[c]*a+e[n+l]*i}}_lerpAdditive(e,t,n,i,s){for(let a=0;a!==s;++a){const l=t+a;e[l]=e[l]+e[n+a]*i}}}const xR="\\[\\]\\.:\\/",VV=new RegExp("["+xR+"]","g"),SR="[^"+xR+"]",GV="[^"+xR.replace("\\.","")+"]",HV=/((?:WC+[\/:])*)/.source.replace("WC",SR),kV=/(WCOD+)?/.source.replace("WCOD",GV),qV=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",SR),WV=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",SR),XV=new RegExp("^"+HV+kV+qV+WV+"$"),YV=["material","materials","bones","map"];class jV{constructor(e,t,n){const i=n||kn.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}getValue(e,t){this.bind();const n=this._targetGroup.nCachedObjects_,i=this._bindings[n];i!==void 0&&i.getValue(e,t)}setValue(e,t){const n=this._bindings;for(let i=this._targetGroup.nCachedObjects_,s=n.length;i!==s;++i)n[i].setValue(e,t)}bind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].bind()}unbind(){const e=this._bindings;for(let t=this._targetGroup.nCachedObjects_,n=e.length;t!==n;++t)e[t].unbind()}}class kn{constructor(e,t,n){this.path=t,this.parsedPath=n||kn.parseTrackName(t),this.node=kn.findNode(e,this.parsedPath.nodeName),this.rootNode=e,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}static create(e,t,n){return e&&e.isAnimationObjectGroup?new kn.Composite(e,t,n):new kn(e,t,n)}static sanitizeNodeName(e){return e.replace(/\s/g,"_").replace(VV,"")}static parseTrackName(e){const t=XV.exec(e);if(t===null)throw new Error("PropertyBinding: Cannot parse trackName: "+e);const n={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=n.nodeName&&n.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){const s=n.nodeName.substring(i+1);YV.indexOf(s)!==-1&&(n.nodeName=n.nodeName.substring(0,i),n.objectName=s)}if(n.propertyName===null||n.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return n}static findNode(e,t){if(t===void 0||t===""||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){const n=e.skeleton.getBoneByName(t);if(n!==void 0)return n}if(e.children){const n=function(s){for(let a=0;a<s.length;a++){const l=s[a];if(l.name===t||l.uuid===t)return l;const c=n(l.children);if(c)return c}return null},i=n(e.children);if(i)return i}return null}_getValue_unavailable(){}_setValue_unavailable(){}_getValue_direct(e,t){e[t]=this.targetObject[this.propertyName]}_getValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)e[t++]=n[i]}_getValue_arrayElement(e,t){e[t]=this.resolvedProperty[this.propertyIndex]}_getValue_toArray(e,t){this.resolvedProperty.toArray(e,t)}_setValue_direct(e,t){this.targetObject[this.propertyName]=e[t]}_setValue_direct_setNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0}_setValue_direct_setMatrixWorldNeedsUpdate(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_array(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++]}_setValue_array_setNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.needsUpdate=!0}_setValue_array_setMatrixWorldNeedsUpdate(e,t){const n=this.resolvedProperty;for(let i=0,s=n.length;i!==s;++i)n[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_arrayElement(e,t){this.resolvedProperty[this.propertyIndex]=e[t]}_setValue_arrayElement_setNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0}_setValue_arrayElement_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}_setValue_fromArray(e,t){this.resolvedProperty.fromArray(e,t)}_setValue_fromArray_setNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0}_setValue_fromArray_setMatrixWorldNeedsUpdate(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}_getValue_unbound(e,t){this.bind(),this.getValue(e,t)}_setValue_unbound(e,t){this.bind(),this.setValue(e,t)}bind(){let e=this.node;const t=this.parsedPath,n=t.objectName,i=t.propertyName;let s=t.propertyIndex;if(e||(e=kn.findNode(this.rootNode,t.nodeName),this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,!e){console.warn("THREE.PropertyBinding: No target node found for track: "+this.path+".");return}if(n){let d=t.objectIndex;switch(n){case"materials":if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.materials){console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);return}e=e.material.materials;break;case"bones":if(!e.skeleton){console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);return}e=e.skeleton.bones;for(let m=0;m<e.length;m++)if(e[m].name===d){d=m;break}break;case"map":if("map"in e){e=e.map;break}if(!e.material){console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);return}if(!e.material.map){console.error("THREE.PropertyBinding: Can not bind to material.map as node.material does not have a map.",this);return}e=e.material.map;break;default:if(e[n]===void 0){console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);return}e=e[n]}if(d!==void 0){if(e[d]===void 0){console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);return}e=e[d]}}const a=e[i];if(a===void 0){const d=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+d+"."+i+" but it wasn't found.",e);return}let l=this.Versioning.None;this.targetObject=e,e.isMaterial===!0?l=this.Versioning.NeedsUpdate:e.isObject3D===!0&&(l=this.Versioning.MatrixWorldNeedsUpdate);let c=this.BindingType.Direct;if(s!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);return}if(!e.geometry.morphAttributes){console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);return}e.morphTargetDictionary[s]!==void 0&&(s=e.morphTargetDictionary[s])}c=this.BindingType.ArrayElement,this.resolvedProperty=a,this.propertyIndex=s}else a.fromArray!==void 0&&a.toArray!==void 0?(c=this.BindingType.HasFromToArray,this.resolvedProperty=a):Array.isArray(a)?(c=this.BindingType.EntireArray,this.resolvedProperty=a):this.propertyName=i;this.getValue=this.GetterByBindingType[c],this.setValue=this.SetterByBindingTypeAndVersioning[c][l]}unbind(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}kn.Composite=jV;kn.prototype.BindingType={Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3};kn.prototype.Versioning={None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2};kn.prototype.GetterByBindingType=[kn.prototype._getValue_direct,kn.prototype._getValue_array,kn.prototype._getValue_arrayElement,kn.prototype._getValue_toArray];kn.prototype.SetterByBindingTypeAndVersioning=[[kn.prototype._setValue_direct,kn.prototype._setValue_direct_setNeedsUpdate,kn.prototype._setValue_direct_setMatrixWorldNeedsUpdate],[kn.prototype._setValue_array,kn.prototype._setValue_array_setNeedsUpdate,kn.prototype._setValue_array_setMatrixWorldNeedsUpdate],[kn.prototype._setValue_arrayElement,kn.prototype._setValue_arrayElement_setNeedsUpdate,kn.prototype._setValue_arrayElement_setMatrixWorldNeedsUpdate],[kn.prototype._setValue_fromArray,kn.prototype._setValue_fromArray_setNeedsUpdate,kn.prototype._setValue_fromArray_setMatrixWorldNeedsUpdate]];class ZV{constructor(){this.isAnimationObjectGroup=!0,this.uuid=So(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;const e={};this._indicesByUUID=e;for(let n=0,i=arguments.length;n!==i;++n)e[arguments[n].uuid]=n;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};const t=this;this.stats={objects:{get total(){return t._objects.length},get inUse(){return this.total-t.nCachedObjects_}},get bindingsPerObject(){return t._bindings.length}}}add(){const e=this._objects,t=this._indicesByUUID,n=this._paths,i=this._parsedPaths,s=this._bindings,a=s.length;let l,c=e.length,d=this.nCachedObjects_;for(let m=0,y=arguments.length;m!==y;++m){const v=arguments[m],x=v.uuid;let S=t[x];if(S===void 0){S=c++,t[x]=S,e.push(v);for(let A=0,E=a;A!==E;++A)s[A].push(new kn(v,n[A],i[A]))}else if(S<d){l=e[S];const A=--d,E=e[A];t[E.uuid]=S,e[S]=E,t[x]=A,e[A]=v;for(let M=0,C=a;M!==C;++M){const w=s[M],D=w[A];let z=w[S];w[S]=D,z===void 0&&(z=new kn(v,n[M],i[M])),w[A]=z}}else e[S]!==l&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=d}remove(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_;for(let a=0,l=arguments.length;a!==l;++a){const c=arguments[a],d=c.uuid,m=t[d];if(m!==void 0&&m>=s){const y=s++,v=e[y];t[v.uuid]=m,e[m]=v,t[d]=y,e[y]=c;for(let x=0,S=i;x!==S;++x){const A=n[x],E=A[y],M=A[m];A[m]=E,A[y]=M}}}this.nCachedObjects_=s}uncache(){const e=this._objects,t=this._indicesByUUID,n=this._bindings,i=n.length;let s=this.nCachedObjects_,a=e.length;for(let l=0,c=arguments.length;l!==c;++l){const d=arguments[l],m=d.uuid,y=t[m];if(y!==void 0)if(delete t[m],y<s){const v=--s,x=e[v],S=--a,A=e[S];t[x.uuid]=y,e[y]=x,t[A.uuid]=v,e[v]=A,e.pop();for(let E=0,M=i;E!==M;++E){const C=n[E],w=C[v],D=C[S];C[y]=w,C[v]=D,C.pop()}}else{const v=--a,x=e[v];v>0&&(t[x.uuid]=y),e[y]=x,e.pop();for(let S=0,A=i;S!==A;++S){const E=n[S];E[y]=E[v],E.pop()}}}this.nCachedObjects_=s}subscribe_(e,t){const n=this._bindingsIndicesByPath;let i=n[e];const s=this._bindings;if(i!==void 0)return s[i];const a=this._paths,l=this._parsedPaths,c=this._objects,d=c.length,m=this.nCachedObjects_,y=new Array(d);i=s.length,n[e]=i,a.push(e),l.push(t),s.push(y);for(let v=m,x=c.length;v!==x;++v){const S=c[v];y[v]=new kn(S,e,t)}return y}unsubscribe_(e){const t=this._bindingsIndicesByPath,n=t[e];if(n!==void 0){const i=this._paths,s=this._parsedPaths,a=this._bindings,l=a.length-1,c=a[l],d=e[l];t[d]=n,a[n]=c,a.pop(),s[n]=s[l],s.pop(),i[n]=i[l],i.pop()}}}class i3{constructor(e,t,n=null,i=t.blendMode){this._mixer=e,this._clip=t,this._localRoot=n,this.blendMode=i;const s=t.tracks,a=s.length,l=new Array(a),c={endingStart:Ld,endingEnd:Ld};for(let d=0;d!==a;++d){const m=s[d].createInterpolant(null);l[d]=m,m.settings=c}this._interpolantSettings=c,this._interpolants=l,this._propertyBindings=new Array(a),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=iU,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}play(){return this._mixer._activateAction(this),this}stop(){return this._mixer._deactivateAction(this),this.reset()}reset(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()}isRunning(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)}isScheduled(){return this._mixer._isActiveAction(this)}startAt(e){return this._startTime=e,this}setLoop(e,t){return this.loop=e,this.repetitions=t,this}setEffectiveWeight(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()}getEffectiveWeight(){return this._effectiveWeight}fadeIn(e){return this._scheduleFading(e,0,1)}fadeOut(e){return this._scheduleFading(e,1,0)}crossFadeFrom(e,t,n=!1){if(e.fadeOut(t),this.fadeIn(t),n===!0){const i=this._clip.duration,s=e._clip.duration,a=s/i,l=i/s;e.warp(1,a,t),this.warp(l,1,t)}return this}crossFadeTo(e,t,n=!1){return e.crossFadeFrom(this,t,n)}stopFading(){const e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}setEffectiveTimeScale(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()}getEffectiveTimeScale(){return this._effectiveTimeScale}setDuration(e){return this.timeScale=this._clip.duration/e,this.stopWarping()}syncWith(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()}halt(e){return this.warp(this._effectiveTimeScale,0,e)}warp(e,t,n){const i=this._mixer,s=i.time,a=this.timeScale;let l=this._timeScaleInterpolant;l===null&&(l=i._lendControlInterpolant(),this._timeScaleInterpolant=l);const c=l.parameterPositions,d=l.sampleValues;return c[0]=s,c[1]=s+n,d[0]=e/a,d[1]=t/a,this}stopWarping(){const e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this}getMixer(){return this._mixer}getClip(){return this._clip}getRoot(){return this._localRoot||this._mixer._root}_update(e,t,n,i){if(!this.enabled){this._updateWeight(e);return}const s=this._startTime;if(s!==null){const c=(e-s)*n;c<0||n===0?t=0:(this._startTime=null,t=n*c)}t*=this._updateTimeScale(e);const a=this._updateTime(t),l=this._updateWeight(e);if(l>0){const c=this._interpolants,d=this._propertyBindings;switch(this.blendMode){case L1:for(let m=0,y=c.length;m!==y;++m)c[m].evaluate(a),d[m].accumulateAdditive(l);break;case $b:default:for(let m=0,y=c.length;m!==y;++m)c[m].evaluate(a),d[m].accumulate(i,l)}}}_updateWeight(e){let t=0;if(this.enabled){t=this.weight;const n=this._weightInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t,t}_updateTimeScale(e){let t=0;if(!this.paused){t=this.timeScale;const n=this._timeScaleInterpolant;if(n!==null){const i=n.evaluate(e)[0];t*=i,e>n.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t)}}return this._effectiveTimeScale=t,t}_updateTime(e){const t=this._clip.duration,n=this.loop;let i=this.time+e,s=this._loopCount;const a=n===sU;if(e===0)return s===-1?i:a&&(s&1)===1?t-i:i;if(n===nU){s===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(i>=t)i=t;else if(i<0)i=0;else{this.time=i;break e}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(s===-1&&(e>=0?(s=0,this._setEndings(!0,this.repetitions===0,a)):this._setEndings(this.repetitions===0,!0,a)),i>=t||i<0){const l=Math.floor(i/t);i-=t*l,s+=Math.abs(l);const c=this.repetitions-s;if(c<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,i=e>0?t:0,this.time=i,this._mixer.dispatchEvent({type:"finished",action:this,direction:e>0?1:-1});else{if(c===1){const d=e<0;this._setEndings(d,!d,a)}else this._setEndings(!1,!1,a);this._loopCount=s,this.time=i,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:l})}}else this.time=i;if(a&&(s&1)===1)return t-i}return i}_setEndings(e,t,n){const i=this._interpolantSettings;n?(i.endingStart=Bd,i.endingEnd=Bd):(e?i.endingStart=this.zeroSlopeAtStart?Bd:Ld:i.endingStart=m_,t?i.endingEnd=this.zeroSlopeAtEnd?Bd:Ld:i.endingEnd=m_)}_scheduleFading(e,t,n){const i=this._mixer,s=i.time;let a=this._weightInterpolant;a===null&&(a=i._lendControlInterpolant(),this._weightInterpolant=a);const l=a.parameterPositions,c=a.sampleValues;return l[0]=s,c[0]=t,l[1]=s+e,c[1]=n,this}}const KV=new Float32Array(1);class QV extends bo{constructor(e){super(),this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}_bindAction(e,t){const n=e._localRoot||this._root,i=e._clip.tracks,s=i.length,a=e._propertyBindings,l=e._interpolants,c=n.uuid,d=this._bindingsByRootAndName;let m=d[c];m===void 0&&(m={},d[c]=m);for(let y=0;y!==s;++y){const v=i[y],x=v.name;let S=m[x];if(S!==void 0)++S.referenceCount,a[y]=S;else{if(S=a[y],S!==void 0){S._cacheIndex===null&&(++S.referenceCount,this._addInactiveBinding(S,c,x));continue}const A=t&&t._propertyBindings[y].binding.parsedPath;S=new n3(kn.create(n,x,A),v.ValueTypeName,v.getValueSize()),++S.referenceCount,this._addInactiveBinding(S,c,x),a[y]=S}l[y].resultBuffer=S.buffer}}_activateAction(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){const n=(e._localRoot||this._root).uuid,i=e._clip.uuid,s=this._actionsByClip[i];this._bindAction(e,s&&s.knownActions[0]),this._addInactiveAction(e,i,n)}const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];s.useCount++===0&&(this._lendBinding(s),s.saveOriginalState())}this._lendAction(e)}}_deactivateAction(e){if(this._isActiveAction(e)){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];--s.useCount===0&&(s.restoreOriginalState(),this._takeBackBinding(s))}this._takeBackAction(e)}}_initMemoryManager(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;const e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}}_isActiveAction(e){const t=e._cacheIndex;return t!==null&&t<this._nActiveActions}_addInactiveAction(e,t,n){const i=this._actions,s=this._actionsByClip;let a=s[t];if(a===void 0)a={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,s[t]=a;else{const l=a.knownActions;e._byClipCacheIndex=l.length,l.push(e)}e._cacheIndex=i.length,i.push(e),a.actionByRoot[n]=e}_removeInactiveAction(e){const t=this._actions,n=t[t.length-1],i=e._cacheIndex;n._cacheIndex=i,t[i]=n,t.pop(),e._cacheIndex=null;const s=e._clip.uuid,a=this._actionsByClip,l=a[s],c=l.knownActions,d=c[c.length-1],m=e._byClipCacheIndex;d._byClipCacheIndex=m,c[m]=d,c.pop(),e._byClipCacheIndex=null;const y=l.actionByRoot,v=(e._localRoot||this._root).uuid;delete y[v],c.length===0&&delete a[s],this._removeInactiveBindingsForAction(e)}_removeInactiveBindingsForAction(e){const t=e._propertyBindings;for(let n=0,i=t.length;n!==i;++n){const s=t[n];--s.referenceCount===0&&this._removeInactiveBinding(s)}}_lendAction(e){const t=this._actions,n=e._cacheIndex,i=this._nActiveActions++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackAction(e){const t=this._actions,n=e._cacheIndex,i=--this._nActiveActions,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_addInactiveBinding(e,t,n){const i=this._bindingsByRootAndName,s=this._bindings;let a=i[t];a===void 0&&(a={},i[t]=a),a[n]=e,e._cacheIndex=s.length,s.push(e)}_removeInactiveBinding(e){const t=this._bindings,n=e.binding,i=n.rootNode.uuid,s=n.path,a=this._bindingsByRootAndName,l=a[i],c=t[t.length-1],d=e._cacheIndex;c._cacheIndex=d,t[d]=c,t.pop(),delete l[s],Object.keys(l).length===0&&delete a[i]}_lendBinding(e){const t=this._bindings,n=e._cacheIndex,i=this._nActiveBindings++,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_takeBackBinding(e){const t=this._bindings,n=e._cacheIndex,i=--this._nActiveBindings,s=t[i];e._cacheIndex=i,t[i]=e,s._cacheIndex=n,t[n]=s}_lendControlInterpolant(){const e=this._controlInterpolants,t=this._nActiveControlInterpolants++;let n=e[t];return n===void 0&&(n=new oR(new Float32Array(2),new Float32Array(2),1,KV),n.__cacheIndex=t,e[t]=n),n}_takeBackControlInterpolant(e){const t=this._controlInterpolants,n=e.__cacheIndex,i=--this._nActiveControlInterpolants,s=t[i];e.__cacheIndex=i,t[i]=e,s.__cacheIndex=n,t[n]=s}clipAction(e,t,n){const i=t||this._root,s=i.uuid;let a=typeof e=="string"?M_.findByName(i,e):e;const l=a!==null?a.uuid:e,c=this._actionsByClip[l];let d=null;if(n===void 0&&(a!==null?n=a.blendMode:n=$b),c!==void 0){const y=c.actionByRoot[s];if(y!==void 0&&y.blendMode===n)return y;d=c.knownActions[0],a===null&&(a=d._clip)}if(a===null)return null;const m=new i3(this,a,t,n);return this._bindAction(m,d),this._addInactiveAction(m,l,s),m}existingAction(e,t){const n=t||this._root,i=n.uuid,s=typeof e=="string"?M_.findByName(n,e):e,a=s?s.uuid:e,l=this._actionsByClip[a];return l!==void 0&&l.actionByRoot[i]||null}stopAllAction(){const e=this._actions,t=this._nActiveActions;for(let n=t-1;n>=0;--n)e[n].stop();return this}update(e){e*=this.timeScale;const t=this._actions,n=this._nActiveActions,i=this.time+=e,s=Math.sign(e),a=this._accuIndex^=1;for(let d=0;d!==n;++d)t[d]._update(i,e,s,a);const l=this._bindings,c=this._nActiveBindings;for(let d=0;d!==c;++d)l[d].apply(a);return this}setTime(e){this.time=0;for(let t=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)}getRoot(){return this._root}uncacheClip(e){const t=this._actions,n=e.uuid,i=this._actionsByClip,s=i[n];if(s!==void 0){const a=s.knownActions;for(let l=0,c=a.length;l!==c;++l){const d=a[l];this._deactivateAction(d);const m=d._cacheIndex,y=t[t.length-1];d._cacheIndex=null,d._byClipCacheIndex=null,y._cacheIndex=m,t[m]=y,t.pop(),this._removeInactiveBindingsForAction(d)}delete i[n]}}uncacheRoot(e){const t=e.uuid,n=this._actionsByClip;for(const a in n){const l=n[a].actionByRoot,c=l[t];c!==void 0&&(this._deactivateAction(c),this._removeInactiveAction(c))}const i=this._bindingsByRootAndName,s=i[t];if(s!==void 0)for(const a in s){const l=s[a];l.restoreOriginalState(),this._removeInactiveBinding(l)}}uncacheAction(e,t){const n=this.existingAction(e,t);n!==null&&(this._deactivateAction(n),this._removeInactiveAction(n))}}class JV extends tl{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isRenderTarget3D=!0,this.depth=n,this.texture=new aT(null,e,t,n),this.texture.isRenderTargetTexture=!0}}class $V extends tl{constructor(e=1,t=1,n=1,i={}){super(e,t,i),this.isRenderTargetArray=!0,this.depth=n,this.texture=new Jg(null,e,t,n),this.texture.isRenderTargetTexture=!0}}let e4=class s3{constructor(e){this.value=e}clone(){return new s3(this.value.clone===void 0?this.value:this.value.clone())}},t4=0,n4=class extends bo{constructor(){super(),this.isUniformsGroup=!0,Object.defineProperty(this,"id",{value:t4++}),this.name="",this.usage=Fg,this.uniforms=[]}add(e){return this.uniforms.push(e),this}remove(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}setName(e){return this.name=e,this}setUsage(e){return this.usage=e,this}dispose(){this.dispatchEvent({type:"dispose"})}copy(e){this.name=e.name,this.usage=e.usage;const t=e.uniforms;this.uniforms.length=0;for(let n=0,i=t.length;n<i;n++){const s=Array.isArray(t[n])?t[n]:[t[n]];for(let a=0;a<s.length;a++)this.uniforms.push(s[a].clone())}return this}clone(){return new this.constructor().copy(this)}};class r3 extends Y_{constructor(e,t,n=1){super(e,t),this.isInstancedInterleavedBuffer=!0,this.meshPerAttribute=n}copy(e){return super.copy(e),this.meshPerAttribute=e.meshPerAttribute,this}clone(e){const t=super.clone(e);return t.meshPerAttribute=this.meshPerAttribute,t}toJSON(e){const t=super.toJSON(e);return t.isInstancedInterleavedBuffer=!0,t.meshPerAttribute=this.meshPerAttribute,t}}class i4{constructor(e,t,n,i,s){this.isGLBufferAttribute=!0,this.name="",this.buffer=e,this.type=t,this.itemSize=n,this.elementSize=i,this.count=s,this.version=0}set needsUpdate(e){e===!0&&this.version++}setBuffer(e){return this.buffer=e,this}setType(e,t){return this.type=e,this.elementSize=t,this}setItemSize(e){return this.itemSize=e,this}setCount(e){return this.count=e,this}}const Uw=new Mt;class a3{constructor(e,t,n=0,i=1/0){this.ray=new $g(e,t),this.near=n,this.far=i,this.camera=null,this.layers=new zg,this.params={Mesh:{},Line:{threshold:1},LOD:{},Points:{threshold:1},Sprite:{}}}set(e,t){this.ray.set(e,t)}setFromCamera(e,t){t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type: "+t.type)}setFromXRController(e){return Uw.identity().extractRotation(e.matrixWorld),this.ray.origin.setFromMatrixPosition(e.matrixWorld),this.ray.direction.set(0,0,-1).applyMatrix4(Uw),this}intersectObject(e,t=!0,n=[]){return HA(e,this,n,t),n.sort(Lw),n}intersectObjects(e,t=!0,n=[]){for(let i=0,s=e.length;i<s;i++)HA(e[i],this,n,t);return n.sort(Lw),n}}function Lw(r,e){return r.distance-e.distance}function HA(r,e,t,n){let i=!0;if(r.layers.test(e.layers)&&r.raycast(e,t)===!1&&(i=!1),i===!0&&n===!0){const s=r.children;for(let a=0,l=s.length;a<l;a++)HA(s[a],e,t,!0)}}class s4{constructor(e=1,t=0,n=0){this.radius=e,this.phi=t,this.theta=n}set(e,t,n){return this.radius=e,this.phi=t,this.theta=n,this}copy(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this}makeSafe(){return this.phi=hn(this.phi,1e-6,Math.PI-1e-6),this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+t*t+n*n),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,n),this.phi=Math.acos(hn(t/this.radius,-1,1))),this}clone(){return new this.constructor().copy(this)}}class r4{constructor(e=1,t=0,n=0){this.radius=e,this.theta=t,this.y=n}set(e,t,n){return this.radius=e,this.theta=t,this.y=n,this}copy(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this}setFromVector3(e){return this.setFromCartesianCoords(e.x,e.y,e.z)}setFromCartesianCoords(e,t,n){return this.radius=Math.sqrt(e*e+n*n),this.theta=Math.atan2(e,n),this.y=t,this}clone(){return new this.constructor().copy(this)}}class J_{constructor(e,t,n,i){J_.prototype.isMatrix2=!0,this.elements=[1,0,0,1],e!==void 0&&this.set(e,t,n,i)}identity(){return this.set(1,0,0,1),this}fromArray(e,t=0){for(let n=0;n<4;n++)this.elements[n]=e[n+t];return this}set(e,t,n,i){const s=this.elements;return s[0]=e,s[2]=t,s[1]=n,s[3]=i,this}}const Bw=new Xe;class a4{constructor(e=new Xe(1/0,1/0),t=new Xe(-1/0,-1/0)){this.isBox2=!0,this.min=e,this.max=t}set(e,t){return this.min.copy(e),this.max.copy(t),this}setFromPoints(e){this.makeEmpty();for(let t=0,n=e.length;t<n;t++)this.expandByPoint(e[t]);return this}setFromCenterAndSize(e,t){const n=Bw.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(n),this.max.copy(e).add(n),this}clone(){return new this.constructor().copy(this)}copy(e){return this.min.copy(e.min),this.max.copy(e.max),this}makeEmpty(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y}getCenter(e){return this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(e){return this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)}expandByPoint(e){return this.min.min(e),this.max.max(e),this}expandByVector(e){return this.min.sub(e),this.max.add(e),this}expandByScalar(e){return this.min.addScalar(-e),this.max.addScalar(e),this}containsPoint(e){return e.x>=this.min.x&&e.x<=this.max.x&&e.y>=this.min.y&&e.y<=this.max.y}containsBox(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y}getParameter(e,t){return t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))}intersectsBox(e){return e.max.x>=this.min.x&&e.min.x<=this.max.x&&e.max.y>=this.min.y&&e.min.y<=this.max.y}clampPoint(e,t){return t.copy(e).clamp(this.min,this.max)}distanceToPoint(e){return this.clampPoint(e,Bw).distanceTo(e)}intersect(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this}union(e){return this.min.min(e.min),this.max.max(e.max),this}translate(e){return this.min.add(e),this.max.add(e),this}equals(e){return e.min.equals(this.min)&&e.max.equals(this.max)}}const Ow=new Y,ES=new Y;class o4{constructor(e=new Y,t=new Y){this.start=e,this.end=t}set(e,t){return this.start.copy(e),this.end.copy(t),this}copy(e){return this.start.copy(e.start),this.end.copy(e.end),this}getCenter(e){return e.addVectors(this.start,this.end).multiplyScalar(.5)}delta(e){return e.subVectors(this.end,this.start)}distanceSq(){return this.start.distanceToSquared(this.end)}distance(){return this.start.distanceTo(this.end)}at(e,t){return this.delta(t).multiplyScalar(e).add(this.start)}closestPointToPointParameter(e,t){Ow.subVectors(e,this.start),ES.subVectors(this.end,this.start);const n=ES.dot(ES);let s=ES.dot(Ow)/n;return t&&(s=hn(s,0,1)),s}closestPointToPoint(e,t,n){const i=this.closestPointToPointParameter(e,t);return this.delta(n).multiplyScalar(i).add(this.start)}applyMatrix4(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this}equals(e){return e.start.equals(this.start)&&e.end.equals(this.end)}clone(){return new this.constructor().copy(this)}}const Pw=new Y;class l4 extends Hn{constructor(e,t){super(),this.light=e,this.matrixAutoUpdate=!1,this.color=t,this.type="SpotLightHelper";const n=new fn,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1];for(let a=0,l=1,c=32;a<c;a++,l++){const d=a/c*Math.PI*2,m=l/c*Math.PI*2;i.push(Math.cos(d),Math.sin(d),1,Math.cos(m),Math.sin(m),1)}n.setAttribute("position",new Et(i,3));const s=new qr({fog:!1,toneMapped:!1});this.cone=new Xu(n,s),this.add(this.cone),this.update()}dispose(){this.cone.geometry.dispose(),this.cone.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),this.parent?(this.parent.updateWorldMatrix(!0),this.matrix.copy(this.parent.matrixWorld).invert().multiply(this.light.matrixWorld)):this.matrix.copy(this.light.matrixWorld),this.matrixWorld.copy(this.light.matrixWorld);const e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),Pw.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt(Pw),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)}}const kh=new Y,AS=new Mt,AE=new Mt;class u4 extends Xu{constructor(e){const t=o3(e),n=new fn,i=[],s=[],a=new ft(0,0,1),l=new ft(0,1,0);for(let d=0;d<t.length;d++){const m=t[d];m.parent&&m.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),s.push(a.r,a.g,a.b),s.push(l.r,l.g,l.b))}n.setAttribute("position",new Et(i,3)),n.setAttribute("color",new Et(s,3));const c=new qr({vertexColors:!0,depthTest:!1,depthWrite:!1,toneMapped:!1,transparent:!0});super(n,c),this.isSkeletonHelper=!0,this.type="SkeletonHelper",this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}updateMatrixWorld(e){const t=this.bones,n=this.geometry,i=n.getAttribute("position");AE.copy(this.root.matrixWorld).invert();for(let s=0,a=0;s<t.length;s++){const l=t[s];l.parent&&l.parent.isBone&&(AS.multiplyMatrices(AE,l.matrixWorld),kh.setFromMatrixPosition(AS),i.setXYZ(a,kh.x,kh.y,kh.z),AS.multiplyMatrices(AE,l.parent.matrixWorld),kh.setFromMatrixPosition(AS),i.setXYZ(a+1,kh.x,kh.y,kh.z),a+=2)}n.getAttribute("position").needsUpdate=!0,super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose()}}function o3(r){const e=[];r.isBone===!0&&e.push(r);for(let t=0;t<r.children.length;t++)e.push(...o3(r.children[t]));return e}class c4 extends bi{constructor(e,t,n){const i=new ny(t,4,2),s=new fa({wireframe:!0,fog:!1,toneMapped:!1});super(i,s),this.light=e,this.color=n,this.type="PointLightHelper",this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}dispose(){this.geometry.dispose(),this.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)}}const h4=new Y,Iw=new ft,Fw=new ft;class f4 extends Hn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="HemisphereLightHelper";const i=new Z_(t);i.rotateY(Math.PI*.5),this.material=new fa({wireframe:!0,fog:!1,toneMapped:!1}),this.color===void 0&&(this.material.vertexColors=!0);const s=i.getAttribute("position"),a=new Float32Array(s.count*3);i.setAttribute("color",new Kn(a,3)),this.add(new bi(i,this.material)),this.update()}dispose(){this.children[0].geometry.dispose(),this.children[0].material.dispose()}update(){const e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{const t=e.geometry.getAttribute("color");Iw.copy(this.light.color),Fw.copy(this.light.groundColor);for(let n=0,i=t.count;n<i;n++){const s=n<i/2?Iw:Fw;t.setXYZ(n,s.r,s.g,s.b)}t.needsUpdate=!0}this.light.updateWorldMatrix(!0,!1),e.lookAt(h4.setFromMatrixPosition(this.light.matrixWorld).negate())}}class d4 extends Xu{constructor(e=10,t=10,n=4473924,i=8947848){n=new ft(n),i=new ft(i);const s=t/2,a=e/t,l=e/2,c=[],d=[];for(let v=0,x=0,S=-l;v<=t;v++,S+=a){c.push(-l,0,S,l,0,S),c.push(S,0,-l,S,0,l);const A=v===s?n:i;A.toArray(d,x),x+=3,A.toArray(d,x),x+=3,A.toArray(d,x),x+=3,A.toArray(d,x),x+=3}const m=new fn;m.setAttribute("position",new Et(c,3)),m.setAttribute("color",new Et(d,3));const y=new qr({vertexColors:!0,toneMapped:!1});super(m,y),this.type="GridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}class p4 extends Xu{constructor(e=10,t=16,n=8,i=64,s=4473924,a=8947848){s=new ft(s),a=new ft(a);const l=[],c=[];if(t>1)for(let y=0;y<t;y++){const v=y/t*(Math.PI*2),x=Math.sin(v)*e,S=Math.cos(v)*e;l.push(0,0,0),l.push(x,0,S);const A=y&1?s:a;c.push(A.r,A.g,A.b),c.push(A.r,A.g,A.b)}for(let y=0;y<n;y++){const v=y&1?s:a,x=e-e/n*y;for(let S=0;S<i;S++){let A=S/i*(Math.PI*2),E=Math.sin(A)*x,M=Math.cos(A)*x;l.push(E,0,M),c.push(v.r,v.g,v.b),A=(S+1)/i*(Math.PI*2),E=Math.sin(A)*x,M=Math.cos(A)*x,l.push(E,0,M),c.push(v.r,v.g,v.b)}}const d=new fn;d.setAttribute("position",new Et(l,3)),d.setAttribute("color",new Et(c,3));const m=new qr({vertexColors:!0,toneMapped:!1});super(d,m),this.type="PolarGridHelper"}dispose(){this.geometry.dispose(),this.material.dispose()}}const zw=new Y,RS=new Y,Vw=new Y;class m4 extends Hn{constructor(e,t,n){super(),this.light=e,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=n,this.type="DirectionalLightHelper",t===void 0&&(t=1);let i=new fn;i.setAttribute("position",new Et([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));const s=new qr({fog:!1,toneMapped:!1});this.lightPlane=new cf(i,s),this.add(this.lightPlane),i=new fn,i.setAttribute("position",new Et([0,0,0,0,0,1],3)),this.targetLine=new cf(i,s),this.add(this.targetLine),this.update()}dispose(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()}update(){this.light.updateWorldMatrix(!0,!1),this.light.target.updateWorldMatrix(!0,!1),zw.setFromMatrixPosition(this.light.matrixWorld),RS.setFromMatrixPosition(this.light.target.matrixWorld),Vw.subVectors(RS,zw),this.lightPlane.lookAt(RS),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(RS),this.targetLine.scale.z=Vw.length()}}const NS=new Y,os=new X_;class g4 extends Xu{constructor(e){const t=new fn,n=new qr({color:16777215,vertexColors:!0,toneMapped:!1}),i=[],s=[],a={};l("n1","n2"),l("n2","n4"),l("n4","n3"),l("n3","n1"),l("f1","f2"),l("f2","f4"),l("f4","f3"),l("f3","f1"),l("n1","f1"),l("n2","f2"),l("n3","f3"),l("n4","f4"),l("p","n1"),l("p","n2"),l("p","n3"),l("p","n4"),l("u1","u2"),l("u2","u3"),l("u3","u1"),l("c","t"),l("p","c"),l("cn1","cn2"),l("cn3","cn4"),l("cf1","cf2"),l("cf3","cf4");function l(S,A){c(S),c(A)}function c(S){i.push(0,0,0),s.push(0,0,0),a[S]===void 0&&(a[S]=[]),a[S].push(i.length/3-1)}t.setAttribute("position",new Et(i,3)),t.setAttribute("color",new Et(s,3)),super(t,n),this.type="CameraHelper",this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=a,this.update();const d=new ft(16755200),m=new ft(16711680),y=new ft(43775),v=new ft(16777215),x=new ft(3355443);this.setColors(d,m,y,v,x)}setColors(e,t,n,i,s){const l=this.geometry.getAttribute("color");l.setXYZ(0,e.r,e.g,e.b),l.setXYZ(1,e.r,e.g,e.b),l.setXYZ(2,e.r,e.g,e.b),l.setXYZ(3,e.r,e.g,e.b),l.setXYZ(4,e.r,e.g,e.b),l.setXYZ(5,e.r,e.g,e.b),l.setXYZ(6,e.r,e.g,e.b),l.setXYZ(7,e.r,e.g,e.b),l.setXYZ(8,e.r,e.g,e.b),l.setXYZ(9,e.r,e.g,e.b),l.setXYZ(10,e.r,e.g,e.b),l.setXYZ(11,e.r,e.g,e.b),l.setXYZ(12,e.r,e.g,e.b),l.setXYZ(13,e.r,e.g,e.b),l.setXYZ(14,e.r,e.g,e.b),l.setXYZ(15,e.r,e.g,e.b),l.setXYZ(16,e.r,e.g,e.b),l.setXYZ(17,e.r,e.g,e.b),l.setXYZ(18,e.r,e.g,e.b),l.setXYZ(19,e.r,e.g,e.b),l.setXYZ(20,e.r,e.g,e.b),l.setXYZ(21,e.r,e.g,e.b),l.setXYZ(22,e.r,e.g,e.b),l.setXYZ(23,e.r,e.g,e.b),l.setXYZ(24,t.r,t.g,t.b),l.setXYZ(25,t.r,t.g,t.b),l.setXYZ(26,t.r,t.g,t.b),l.setXYZ(27,t.r,t.g,t.b),l.setXYZ(28,t.r,t.g,t.b),l.setXYZ(29,t.r,t.g,t.b),l.setXYZ(30,t.r,t.g,t.b),l.setXYZ(31,t.r,t.g,t.b),l.setXYZ(32,n.r,n.g,n.b),l.setXYZ(33,n.r,n.g,n.b),l.setXYZ(34,n.r,n.g,n.b),l.setXYZ(35,n.r,n.g,n.b),l.setXYZ(36,n.r,n.g,n.b),l.setXYZ(37,n.r,n.g,n.b),l.setXYZ(38,i.r,i.g,i.b),l.setXYZ(39,i.r,i.g,i.b),l.setXYZ(40,s.r,s.g,s.b),l.setXYZ(41,s.r,s.g,s.b),l.setXYZ(42,s.r,s.g,s.b),l.setXYZ(43,s.r,s.g,s.b),l.setXYZ(44,s.r,s.g,s.b),l.setXYZ(45,s.r,s.g,s.b),l.setXYZ(46,s.r,s.g,s.b),l.setXYZ(47,s.r,s.g,s.b),l.setXYZ(48,s.r,s.g,s.b),l.setXYZ(49,s.r,s.g,s.b),l.needsUpdate=!0}update(){const e=this.geometry,t=this.pointMap,n=1,i=1;os.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse);const s=this.camera.coordinateSystem===zr?-1:0;_s("c",t,e,os,0,0,s),_s("t",t,e,os,0,0,1),_s("n1",t,e,os,-1,-1,s),_s("n2",t,e,os,n,-1,s),_s("n3",t,e,os,-1,i,s),_s("n4",t,e,os,n,i,s),_s("f1",t,e,os,-1,-1,1),_s("f2",t,e,os,n,-1,1),_s("f3",t,e,os,-1,i,1),_s("f4",t,e,os,n,i,1),_s("u1",t,e,os,n*.7,i*1.1,s),_s("u2",t,e,os,-1*.7,i*1.1,s),_s("u3",t,e,os,0,i*2,s),_s("cf1",t,e,os,-1,0,1),_s("cf2",t,e,os,n,0,1),_s("cf3",t,e,os,0,-1,1),_s("cf4",t,e,os,0,i,1),_s("cn1",t,e,os,-1,0,s),_s("cn2",t,e,os,n,0,s),_s("cn3",t,e,os,0,-1,s),_s("cn4",t,e,os,0,i,s),e.getAttribute("position").needsUpdate=!0}dispose(){this.geometry.dispose(),this.material.dispose()}}function _s(r,e,t,n,i,s,a){NS.set(i,s,a).unproject(n);const l=e[r];if(l!==void 0){const c=t.getAttribute("position");for(let d=0,m=l.length;d<m;d++)c.setXYZ(l[d],NS.x,NS.y,NS.z)}}const CS=new ga;class y4 extends Xu{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(8*3),s=new fn;s.setIndex(new Kn(n,1)),s.setAttribute("position",new Kn(i,3)),super(s,new qr({color:t,toneMapped:!1})),this.object=e,this.type="BoxHelper",this.matrixAutoUpdate=!1,this.update()}update(){if(this.object!==void 0&&CS.setFromObject(this.object),CS.isEmpty())return;const e=CS.min,t=CS.max,n=this.geometry.attributes.position,i=n.array;i[0]=t.x,i[1]=t.y,i[2]=t.z,i[3]=e.x,i[4]=t.y,i[5]=t.z,i[6]=e.x,i[7]=e.y,i[8]=t.z,i[9]=t.x,i[10]=e.y,i[11]=t.z,i[12]=t.x,i[13]=t.y,i[14]=e.z,i[15]=e.x,i[16]=t.y,i[17]=e.z,i[18]=e.x,i[19]=e.y,i[20]=e.z,i[21]=t.x,i[22]=e.y,i[23]=e.z,n.needsUpdate=!0,this.geometry.computeBoundingSphere()}setFromObject(e){return this.object=e,this.update(),this}copy(e,t){return super.copy(e,t),this.object=e.object,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class v4 extends Xu{constructor(e,t=16776960){const n=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=[1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],s=new fn;s.setIndex(new Kn(n,1)),s.setAttribute("position",new Et(i,3)),super(s,new qr({color:t,toneMapped:!1})),this.box=e,this.type="Box3Helper",this.geometry.computeBoundingSphere()}updateMatrixWorld(e){const t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),super.updateMatrixWorld(e))}dispose(){this.geometry.dispose(),this.material.dispose()}}class _4 extends cf{constructor(e,t=1,n=16776960){const i=n,s=[1,-1,0,-1,1,0,-1,-1,0,1,1,0,-1,1,0,-1,-1,0,1,-1,0,1,1,0],a=new fn;a.setAttribute("position",new Et(s,3)),a.computeBoundingSphere(),super(a,new qr({color:i,toneMapped:!1})),this.type="PlaneHelper",this.plane=e,this.size=t;const l=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],c=new fn;c.setAttribute("position",new Et(l,3)),c.computeBoundingSphere(),this.add(new bi(c,new fa({color:i,opacity:.2,transparent:!0,depthWrite:!1,toneMapped:!1})))}updateMatrixWorld(e){this.position.set(0,0,0),this.scale.set(.5*this.size,.5*this.size,1),this.lookAt(this.plane.normal),this.translateZ(-this.plane.constant),super.updateMatrixWorld(e)}dispose(){this.geometry.dispose(),this.material.dispose(),this.children[0].geometry.dispose(),this.children[0].material.dispose()}}const Gw=new Y;let wS,RE;class x4 extends Hn{constructor(e=new Y(0,0,1),t=new Y(0,0,0),n=1,i=16776960,s=n*.2,a=s*.2){super(),this.type="ArrowHelper",wS===void 0&&(wS=new fn,wS.setAttribute("position",new Et([0,0,0,0,1,0],3)),RE=new xp(0,.5,1,5,1),RE.translate(0,-.5,0)),this.position.copy(t),this.line=new cf(wS,new qr({color:i,toneMapped:!1})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new bi(RE,new fa({color:i,toneMapped:!1})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(n,s,a)}setDirection(e){if(e.y>.99999)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{Gw.set(e.z,0,-e.x).normalize();const t=Math.acos(e.y);this.quaternion.setFromAxisAngle(Gw,t)}}setLength(e,t=e*.2,n=t*.2){this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(n,t,n),this.cone.position.y=e,this.cone.updateMatrix()}setColor(e){this.line.material.color.set(e),this.cone.material.color.set(e)}copy(e){return super.copy(e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this}dispose(){this.line.geometry.dispose(),this.line.material.dispose(),this.cone.geometry.dispose(),this.cone.material.dispose()}}class S4 extends Xu{constructor(e=1){const t=[0,0,0,e,0,0,0,0,0,0,e,0,0,0,0,0,0,e],n=[1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],i=new fn;i.setAttribute("position",new Et(t,3)),i.setAttribute("color",new Et(n,3));const s=new qr({vertexColors:!0,toneMapped:!1});super(i,s),this.type="AxesHelper"}setColors(e,t,n){const i=new ft,s=this.geometry.attributes.color.array;return i.set(e),i.toArray(s,0),i.toArray(s,3),i.set(t),i.toArray(s,6),i.toArray(s,9),i.set(n),i.toArray(s,12),i.toArray(s,15),this.geometry.attributes.color.needsUpdate=!0,this}dispose(){this.geometry.dispose(),this.material.dispose()}}class b4{constructor(){this.type="ShapePath",this.color=new ft,this.subPaths=[],this.currentPath=null}moveTo(e,t){return this.currentPath=new v_,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this}lineTo(e,t){return this.currentPath.lineTo(e,t),this}quadraticCurveTo(e,t,n,i){return this.currentPath.quadraticCurveTo(e,t,n,i),this}bezierCurveTo(e,t,n,i,s,a){return this.currentPath.bezierCurveTo(e,t,n,i,s,a),this}splineThru(e){return this.currentPath.splineThru(e),this}toShapes(e){function t(M){const C=[];for(let w=0,D=M.length;w<D;w++){const z=M[w],B=new Hd;B.curves=z.curves,C.push(B)}return C}function n(M,C){const w=C.length;let D=!1;for(let z=w-1,B=0;B<w;z=B++){let F=C[z],H=C[B],I=H.x-F.x,P=H.y-F.y;if(Math.abs(P)>Number.EPSILON){if(P<0&&(F=C[B],I=-I,H=C[z],P=-P),M.y<F.y||M.y>H.y)continue;if(M.y===F.y){if(M.x===F.x)return!0}else{const Z=P*(M.x-F.x)-I*(M.y-F.y);if(Z===0)return!0;if(Z<0)continue;D=!D}}else{if(M.y!==F.y)continue;if(H.x<=M.x&&M.x<=F.x||F.x<=M.x&&M.x<=H.x)return!0}}return D}const i=Uu.isClockWise,s=this.subPaths;if(s.length===0)return[];let a,l,c;const d=[];if(s.length===1)return l=s[0],c=new Hd,c.curves=l.curves,d.push(c),d;let m=!i(s[0].getPoints());m=e?!m:m;const y=[],v=[];let x=[],S=0,A;v[S]=void 0,x[S]=[];for(let M=0,C=s.length;M<C;M++)l=s[M],A=l.getPoints(),a=i(A),a=e?!a:a,a?(!m&&v[S]&&S++,v[S]={s:new Hd,p:A},v[S].s.curves=l.curves,m&&S++,x[S]=[]):x[S].push({h:l,p:A[0]});if(!v[0])return t(s);if(v.length>1){let M=!1,C=0;for(let w=0,D=v.length;w<D;w++)y[w]=[];for(let w=0,D=v.length;w<D;w++){const z=x[w];for(let B=0;B<z.length;B++){const F=z[B];let H=!0;for(let I=0;I<v.length;I++)n(F.p,v[I].p)&&(w!==I&&C++,H?(H=!1,y[I].push(F)):M=!0);H&&y[w].push(F)}}C>0&&M===!1&&(x=y)}let E;for(let M=0,C=v.length;M<C;M++){c=v[M].s,d.push(c),E=x[M];for(let w=0,D=E.length;w<D;w++)c.holes.push(E[w].h)}return d}}class T4 extends bo{constructor(e,t=null){super(),this.object=e,this.domElement=t,this.enabled=!0,this.state=-1,this.keys={},this.mouseButtons={LEFT:null,MIDDLE:null,RIGHT:null},this.touches={ONE:null,TWO:null}}connect(e){if(e===void 0){console.warn("THREE.Controls: connect() now requires an element.");return}this.domElement!==null&&this.disconnect(),this.domElement=e}disconnect(){}dispose(){}update(){}}function M4(r,e){const t=r.image&&r.image.width?r.image.width/r.image.height:1;return t>e?(r.repeat.x=1,r.repeat.y=t/e,r.offset.x=0,r.offset.y=(1-r.repeat.y)/2):(r.repeat.x=e/t,r.repeat.y=1,r.offset.x=(1-r.repeat.x)/2,r.offset.y=0),r}function E4(r,e){const t=r.image&&r.image.width?r.image.width/r.image.height:1;return t>e?(r.repeat.x=e/t,r.repeat.y=1,r.offset.x=(1-r.repeat.x)/2,r.offset.y=0):(r.repeat.x=1,r.repeat.y=t/e,r.offset.x=0,r.offset.y=(1-r.repeat.y)/2),r}function A4(r){return r.repeat.x=1,r.repeat.y=1,r.offset.x=0,r.offset.y=0,r}function kA(r,e,t,n){const i=R4(n);switch(t){case Zb:return r*e;case Kb:return r*e;case Qb:return r*e*2;case gp:return r*e/i.components*i.byteLength;case ff:return r*e/i.components*i.byteLength;case lf:return r*e*2/i.components*i.byteLength;case yp:return r*e*2/i.components*i.byteLength;case Qg:return r*e*3/i.components*i.byteLength;case Ni:return r*e*4/i.components*i.byteLength;case vp:return r*e*4/i.components*i.byteLength;case sf:case wc:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case Dc:case Uc:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case Dg:case Lg:return Math.max(r,16)*Math.max(e,8)/4;case wg:case Ug:return Math.max(r,8)*Math.max(e,8)/2;case Bg:case Kd:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*8;case Qd:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case Jd:return Math.floor((r+3)/4)*Math.floor((e+3)/4)*16;case $d:return Math.floor((r+4)/5)*Math.floor((e+3)/4)*16;case ep:return Math.floor((r+4)/5)*Math.floor((e+4)/5)*16;case tp:return Math.floor((r+5)/6)*Math.floor((e+4)/5)*16;case np:return Math.floor((r+5)/6)*Math.floor((e+5)/6)*16;case ip:return Math.floor((r+7)/8)*Math.floor((e+4)/5)*16;case sp:return Math.floor((r+7)/8)*Math.floor((e+5)/6)*16;case rp:return Math.floor((r+7)/8)*Math.floor((e+7)/8)*16;case ap:return Math.floor((r+9)/10)*Math.floor((e+4)/5)*16;case op:return Math.floor((r+9)/10)*Math.floor((e+5)/6)*16;case lp:return Math.floor((r+9)/10)*Math.floor((e+7)/8)*16;case up:return Math.floor((r+9)/10)*Math.floor((e+9)/10)*16;case cp:return Math.floor((r+11)/12)*Math.floor((e+9)/10)*16;case hp:return Math.floor((r+11)/12)*Math.floor((e+11)/12)*16;case rf:case db:case pb:return Math.ceil(r/4)*Math.ceil(e/4)*16;case Jb:case Og:return Math.ceil(r/4)*Math.ceil(e/4)*8;case Pg:case Ig:return Math.ceil(r/4)*Math.ceil(e/4)*16}throw new Error(`Unable to determine texture byte length for ${t} format.`)}function R4(r){switch(r){case Xi:case tf:return{byteLength:1,components:1};case jo:case nf:case Ys:return{byteLength:2,components:1};case G_:case H_:return{byteLength:2,components:4};case di:case Xs:case Ri:return{byteLength:4,components:1};case k_:return{byteLength:4,components:3}}throw new Error(`Unknown texture type ${r}.`)}class N4{static contain(e,t){return M4(e,t)}static cover(e,t){return E4(e,t)}static fill(e){return A4(e)}static getByteLength(e,t,n,i){return kA(e,t,n,i)}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:Zg}}));typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=Zg);/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const C4=["alphaMap","alphaTest","anisotropy","anisotropyMap","anisotropyRotation","aoMap","attenuationColor","attenuationDistance","bumpMap","clearcoat","clearcoatMap","clearcoatNormalMap","clearcoatNormalScale","clearcoatRoughness","color","dispersion","displacementMap","emissive","emissiveMap","envMap","gradientMap","ior","iridescence","iridescenceIOR","iridescenceMap","iridescenceThicknessMap","lightMap","map","matcap","metalness","metalnessMap","normalMap","normalScale","opacity","roughness","roughnessMap","sheen","sheenColor","sheenColorMap","sheenRoughnessMap","shininess","specular","specularColor","specularColorMap","specularIntensity","specularIntensityMap","specularMap","thickness","transmission","transmissionMap"];class w4{constructor(e){this.renderObjects=new WeakMap,this.hasNode=this.containsNode(e),this.hasAnimation=e.object.isSkinnedMesh===!0,this.refreshUniforms=C4,this.renderId=0}firstInitialization(e){return this.renderObjects.has(e)===!1?(this.getRenderObjectData(e),!0):!1}getRenderObjectData(e){let t=this.renderObjects.get(e);if(t===void 0){const{geometry:n,material:i,object:s}=e;if(t={material:this.getMaterialData(i),geometry:{id:n.id,attributes:this.getAttributesData(n.attributes),indexVersion:n.index?n.index.version:null,drawRange:{start:n.drawRange.start,count:n.drawRange.count}},worldMatrix:s.matrixWorld.clone()},s.center&&(t.center=s.center.clone()),s.morphTargetInfluences&&(t.morphTargetInfluences=s.morphTargetInfluences.slice()),e.bundle!==null&&(t.version=e.bundle.version),t.material.transmission>0){const{width:a,height:l}=e.context;t.bufferWidth=a,t.bufferHeight=l}this.renderObjects.set(e,t)}return t}getAttributesData(e){const t={};for(const n in e){const i=e[n];t[n]={version:i.version}}return t}containsNode(e){const t=e.material;for(const n in t)if(t[n]&&t[n].isNode)return!0;return e.renderer.nodes.modelViewMatrix!==null||e.renderer.nodes.modelNormalViewMatrix!==null}getMaterialData(e){const t={};for(const n of this.refreshUniforms){const i=e[n];i!=null&&(typeof i=="object"&&i.clone!==void 0?i.isTexture===!0?t[n]={id:i.id,version:i.version}:t[n]=i.clone():t[n]=i)}return t}equals(e){const{object:t,material:n,geometry:i}=e,s=this.getRenderObjectData(e);if(s.worldMatrix.equals(t.matrixWorld)!==!0)return s.worldMatrix.copy(t.matrixWorld),!1;const a=s.material;for(const A in a){const E=a[A],M=n[A];if(E.equals!==void 0){if(E.equals(M)===!1)return E.copy(M),!1}else if(M.isTexture===!0){if(E.id!==M.id||E.version!==M.version)return E.id=M.id,E.version=M.version,!1}else if(E!==M)return a[A]=M,!1}if(a.transmission>0){const{width:A,height:E}=e.context;if(s.bufferWidth!==A||s.bufferHeight!==E)return s.bufferWidth=A,s.bufferHeight=E,!1}const l=s.geometry,c=i.attributes,d=l.attributes,m=Object.keys(d),y=Object.keys(c);if(l.id!==i.id)return l.id=i.id,!1;if(m.length!==y.length)return s.geometry.attributes=this.getAttributesData(c),!1;for(const A of m){const E=d[A],M=c[A];if(M===void 0)return delete d[A],!1;if(E.version!==M.version)return E.version=M.version,!1}const v=i.index,x=l.indexVersion,S=v?v.version:null;if(x!==S)return l.indexVersion=S,!1;if(l.drawRange.start!==i.drawRange.start||l.drawRange.count!==i.drawRange.count)return l.drawRange.start=i.drawRange.start,l.drawRange.count=i.drawRange.count,!1;if(s.morphTargetInfluences){let A=!1;for(let E=0;E<s.morphTargetInfluences.length;E++)s.morphTargetInfluences[E]!==t.morphTargetInfluences[E]&&(A=!0);if(A)return!0}return s.center&&s.center.equals(t.center)===!1?(s.center.copy(t.center),!0):(e.bundle!==null&&(s.version=e.bundle.version),!0)}needsRefresh(e,t){if(this.hasNode||this.hasAnimation||this.firstInitialization(e))return!0;const{renderId:n}=t;if(this.renderId!==n)return this.renderId=n,!0;const i=e.object.static===!0,s=e.bundle!==null&&e.bundle.static===!0&&this.getRenderObjectData(e).version===e.bundle.version;return i||s?!1:this.equals(e)!==!0}}function A_(r,e=0){let t=3735928559^e,n=1103547991^e;if(r instanceof Array)for(let i=0,s;i<r.length;i++)s=r[i],t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);else for(let i=0,s;i<r.length;i++)s=r.charCodeAt(i),t=Math.imul(t^s,2654435761),n=Math.imul(n^s,1597334677);return t=Math.imul(t^t>>>16,2246822507),t^=Math.imul(n^n>>>13,3266489909),n=Math.imul(n^n>>>16,2246822507),n^=Math.imul(t^t>>>13,3266489909),4294967296*(2097151&n)+(t>>>0)}const l3=r=>A_(r),UT=r=>A_(r),R_=(...r)=>A_(r);function u3(r,e=!1){const t=[];r.isNode===!0&&(t.push(r.id),r=r.getSelf());for(const{property:n,childNode:i}of xb(r))t.push(A_(n.slice(0,-4)),i.getCacheKey(e));return A_(t)}function*xb(r,e=!1){for(const t in r){if(t.startsWith("_")===!0)continue;const n=r[t];if(Array.isArray(n)===!0)for(let i=0;i<n.length;i++){const s=n[i];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:i,childNode:s})}else if(n&&n.isNode===!0)yield{property:t,childNode:n};else if(typeof n=="object")for(const i in n){const s=n[i];s&&(s.isNode===!0||e&&typeof s.toJSON=="function")&&(yield{property:t,index:i,childNode:s})}}}const D4=new Map([[1,"float"],[2,"vec2"],[3,"vec3"],[4,"vec4"],[9,"mat3"],[16,"mat4"]]),Hw=new WeakMap;function c3(r){return D4.get(r)}function Sb(r){if(/[iu]?vec\d/.test(r))return r.startsWith("ivec")?Int32Array:r.startsWith("uvec")?Uint32Array:Float32Array;if(/mat\d/.test(r)||/float/.test(r))return Float32Array;if(/uint/.test(r))return Uint32Array;if(/int/.test(r))return Int32Array;throw new Error(`THREE.NodeUtils: Unsupported type: ${r}`)}function bR(r){if(/float|int|uint/.test(r))return 1;if(/vec2/.test(r))return 2;if(/vec3/.test(r))return 3;if(/vec4/.test(r)||/mat2/.test(r))return 4;if(/mat3/.test(r))return 9;if(/mat4/.test(r))return 16;console.error("THREE.TSL: Unsupported type:",r)}function $h(r){if(r==null)return null;const e=typeof r;return r.isNode===!0?"node":e==="number"?"float":e==="boolean"?"bool":e==="string"?"string":e==="function"?"shader":r.isVector2===!0?"vec2":r.isVector3===!0?"vec3":r.isVector4===!0?"vec4":r.isMatrix2===!0?"mat2":r.isMatrix3===!0?"mat3":r.isMatrix4===!0?"mat4":r.isColor===!0?"color":r instanceof ArrayBuffer?"ArrayBuffer":null}function h3(r,...e){const t=r?r.slice(-4):void 0;return e.length===1&&(t==="vec2"?e=[e[0],e[0]]:t==="vec3"?e=[e[0],e[0],e[0]]:t==="vec4"&&(e=[e[0],e[0],e[0],e[0]])),r==="color"?new ft(...e):t==="vec2"?new Xe(...e):t==="vec3"?new Y(...e):t==="vec4"?new Ot(...e):t==="mat2"?new J_(...e):t==="mat3"?new Qt(...e):t==="mat4"?new Mt(...e):r==="bool"?e[0]||!1:r==="float"||r==="int"||r==="uint"?e[0]||0:r==="string"?e[0]||"":r==="ArrayBuffer"?p3(e[0]):null}function f3(r){let e=Hw.get(r);return e===void 0&&(e={},Hw.set(r,e)),e}function d3(r){let e="";const t=new Uint8Array(r);for(let n=0;n<t.length;n++)e+=String.fromCharCode(t[n]);return btoa(e)}function p3(r){return Uint8Array.from(atob(r),e=>e.charCodeAt(0)).buffer}const qA={VERTEX:"vertex",FRAGMENT:"fragment"},en={NONE:"none",FRAME:"frame",RENDER:"render",OBJECT:"object"},U4={BOOLEAN:"bool",INTEGER:"int",FLOAT:"float",VECTOR2:"vec2",VECTOR3:"vec3",VECTOR4:"vec4",MATRIX2:"mat2",MATRIX3:"mat3",MATRIX4:"mat4"},Vr={READ_ONLY:"readOnly",WRITE_ONLY:"writeOnly",READ_WRITE:"readWrite"},m3=["fragment","vertex"],WA=["setup","analyze","generate"],XA=[...m3,"compute"],Ep=["x","y","z","w"];let L4=0;class Ft extends bo{static get type(){return"Node"}constructor(e=null){super(),this.nodeType=e,this.updateType=en.NONE,this.updateBeforeType=en.NONE,this.updateAfterType=en.NONE,this.uuid=P1.generateUUID(),this.version=0,this.global=!1,this.isNode=!0,this._cacheKey=null,this._cacheKeyVersion=0,Object.defineProperty(this,"id",{value:L4++})}set needsUpdate(e){e===!0&&this.version++}get type(){return this.constructor.type}onUpdate(e,t){return this.updateType=t,this.update=e.bind(this.getSelf()),this}onFrameUpdate(e){return this.onUpdate(e,en.FRAME)}onRenderUpdate(e){return this.onUpdate(e,en.RENDER)}onObjectUpdate(e){return this.onUpdate(e,en.OBJECT)}onReference(e){return this.updateReference=e.bind(this.getSelf()),this}getSelf(){return this.self||this}updateReference(){return this}isGlobal(){return this.global}*getChildren(){for(const{childNode:e}of xb(this))yield e}dispose(){this.dispatchEvent({type:"dispose"})}traverse(e){e(this);for(const t of this.getChildren())t.traverse(e)}getCacheKey(e=!1){return e=e||this.version!==this._cacheKeyVersion,(e===!0||this._cacheKey===null)&&(this._cacheKey=R_(u3(this,e),this.customCacheKey()),this._cacheKeyVersion=this.version),this._cacheKey}customCacheKey(){return 0}getScope(){return this}getHash(){return this.uuid}getUpdateType(){return this.updateType}getUpdateBeforeType(){return this.updateBeforeType}getUpdateAfterType(){return this.updateAfterType}getElementType(e){const t=this.getNodeType(e);return e.getElementType(t)}getMemberType(){return"void"}getNodeType(e){const t=e.getNodeProperties(this);return t.outputNode?t.outputNode.getNodeType(e):this.nodeType}getShared(e){const t=this.getHash(e);return e.getNodeFromHash(t)||this}setup(e){const t=e.getNodeProperties(this);let n=0;for(const i of this.getChildren())t["node"+n++]=i;return t.outputNode||null}analyze(e){if(e.increaseUsage(this)===1){const n=e.getNodeProperties(this);for(const i of Object.values(n))i&&i.isNode===!0&&i.build(e)}}generate(e,t){const{outputNode:n}=e.getNodeProperties(this);if(n&&n.isNode===!0)return n.build(e,t)}updateBefore(){console.warn("Abstract function.")}updateAfter(){console.warn("Abstract function.")}update(){console.warn("Abstract function.")}build(e,t=null){const n=this.getShared(e);if(this!==n)return n.build(e,t);e.addNode(this),e.addChain(this);let i=null;const s=e.getBuildStage();if(s==="setup"){this.updateReference(e);const a=e.getNodeProperties(this);if(a.initialized!==!0){a.initialized=!0;const l=this.setup(e),c=l&&l.isNode===!0;for(const d of Object.values(a))d&&d.isNode===!0&&d.build(e);c&&l.build(e),a.outputNode=l}}else if(s==="analyze")this.analyze(e);else if(s==="generate")if(this.generate.length===1){const l=this.getNodeType(e),c=e.getDataFromNode(this);i=c.snippet,i===void 0?c.generated===void 0?(c.generated=!0,i=this.generate(e)||"",c.snippet=i):(console.warn("THREE.Node: Recursion detected.",this),i=""):c.flowCodes!==void 0&&e.context.nodeBlock!==void 0&&e.addFlowCodeHierarchy(this,e.context.nodeBlock),i=e.format(i,l,t)}else i=this.generate(e,t)||"";return e.removeChain(this),e.addSequentialNode(this),i}getSerializeChildren(){return xb(this)}serialize(e){const t=this.getSerializeChildren(),n={};for(const{property:i,index:s,childNode:a}of t)s!==void 0?(n[i]===void 0&&(n[i]=Number.isInteger(s)?[]:{}),n[i][s]=a.toJSON(e.meta).uuid):n[i]=a.toJSON(e.meta).uuid;Object.keys(n).length>0&&(e.inputNodes=n)}deserialize(e){if(e.inputNodes!==void 0){const t=e.meta.nodes;for(const n in e.inputNodes)if(Array.isArray(e.inputNodes[n])){const i=[];for(const s of e.inputNodes[n])i.push(t[s]);this[n]=i}else if(typeof e.inputNodes[n]=="object"){const i={};for(const s in e.inputNodes[n]){const a=e.inputNodes[n][s];i[s]=t[a]}this[n]=i}else{const i=e.inputNodes[n];this[n]=t[i]}}}toJSON(e){const{uuid:t,type:n}=this,i=e===void 0||typeof e=="string";i&&(e={textures:{},images:{},nodes:{}});let s=e.nodes[t];s===void 0&&(s={uuid:t,type:n,meta:e,metadata:{version:4.6,type:"Node",generator:"Node.toJSON"}},i!==!0&&(e.nodes[s.uuid]=s),this.serialize(s),delete s.meta);function a(l){const c=[];for(const d in l){const m=l[d];delete m.metadata,c.push(m)}return c}if(i){const l=a(e.textures),c=a(e.images),d=a(e.nodes);l.length>0&&(s.textures=l),c.length>0&&(s.images=c),d.length>0&&(s.nodes=d)}return s}}class Ap extends Ft{static get type(){return"ArrayElementNode"}constructor(e,t){super(),this.node=e,this.indexNode=t,this.isArrayElementNode=!0}getNodeType(e){return this.node.getElementType(e)}generate(e){const t=this.indexNode.getNodeType(e),n=this.node.build(e),i=this.indexNode.build(e,!e.isVector(t)&&e.isInteger(t)?t:"uint");return`${n}[ ${i} ]`}}class g3 extends Ft{static get type(){return"ConvertNode"}constructor(e,t){super(),this.node=e,this.convertTo=t}getNodeType(e){const t=this.node.getNodeType(e);let n=null;for(const i of this.convertTo.split("|"))(n===null||e.getTypeLength(t)===e.getTypeLength(i))&&(n=i);return n}serialize(e){super.serialize(e),e.convertTo=this.convertTo}deserialize(e){super.deserialize(e),this.convertTo=e.convertTo}generate(e,t){const n=this.node,i=this.getNodeType(e),s=n.build(e,i);return e.format(s,i,t)}}class es extends Ft{static get type(){return"TempNode"}constructor(e=null){super(e),this.isTempNode=!0}hasDependencies(e){return e.getDataFromNode(this).usageCount>1}build(e,t){if(e.getBuildStage()==="generate"){const i=e.getVectorType(this.getNodeType(e,t)),s=e.getDataFromNode(this);if(s.propertyName!==void 0)return e.format(s.propertyName,i,t);if(i!=="void"&&t!=="void"&&this.hasDependencies(e)){const a=super.build(e,i),l=e.getVarFromNode(this,null,i),c=e.getPropertyName(l);return e.addLineFlowCode(`${c} = ${a}`,this),s.snippet=a,s.propertyName=c,e.format(s.propertyName,i,t)}}return super.build(e,t)}}class B4 extends es{static get type(){return"JoinNode"}constructor(e=[],t=null){super(t),this.nodes=e}getNodeType(e){return this.nodeType!==null?e.getVectorType(this.nodeType):e.getTypeFromLength(this.nodes.reduce((t,n)=>t+e.getTypeLength(n.getNodeType(e)),0))}generate(e,t){const n=this.getNodeType(e),i=e.getTypeLength(n),s=this.nodes,a=e.getComponentType(n),l=[];let c=0;for(const m of s){if(c>=i){console.error(`THREE.TSL: Length of parameters exceeds maximum length of function '${n}()' type.`);break}let y=m.getNodeType(e),v=e.getTypeLength(y),x;c+v>i&&(console.error(`THREE.TSL: Length of '${n}()' data exceeds maximum length of output type.`),v=i-c,y=e.getTypeFromLength(v)),c+=v,x=m.build(e,y);const S=e.getComponentType(y);S!==a&&(x=e.format(x,S,a)),l.push(x)}const d=`${e.getType(n)}( ${l.join(", ")} )`;return e.format(d,n,t)}}const O4=Ep.join("");class YA extends Ft{static get type(){return"SplitNode"}constructor(e,t="x"){super(),this.node=e,this.components=t,this.isSplitNode=!0}getVectorLength(){let e=this.components.length;for(const t of this.components)e=Math.max(Ep.indexOf(t)+1,e);return e}getComponentType(e){return e.getComponentType(this.node.getNodeType(e))}getNodeType(e){return e.getTypeFromLength(this.components.length,this.getComponentType(e))}generate(e,t){const n=this.node,i=e.getTypeLength(n.getNodeType(e));let s=null;if(i>1){let a=null;this.getVectorLength()>=i&&(a=e.getTypeFromLength(this.getVectorLength(),this.getComponentType(e)));const c=n.build(e,a);this.components.length===i&&this.components===O4.slice(0,this.components.length)?s=e.format(c,a,t):s=e.format(`${c}.${this.components}`,this.getNodeType(e),t)}else s=n.build(e,t);return s}serialize(e){super.serialize(e),e.components=this.components}deserialize(e){super.deserialize(e),this.components=e.components}}class P4 extends es{static get type(){return"SetNode"}constructor(e,t,n){super(),this.sourceNode=e,this.components=t,this.targetNode=n}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{sourceNode:t,components:n,targetNode:i}=this,s=this.getNodeType(e),a=e.getComponentType(i.getNodeType(e)),l=e.getTypeFromLength(n.length,a),c=i.build(e,l),d=t.build(e,s),m=e.getTypeLength(s),y=[];for(let v=0;v<m;v++){const x=Ep[v];x===n[0]?(y.push(c),v+=n.length-1):y.push(d+"."+x)}return`${e.getType(s)}( ${y.join(", ")} )`}}class I4 extends es{static get type(){return"FlipNode"}constructor(e,t){super(),this.sourceNode=e,this.components=t}getNodeType(e){return this.sourceNode.getNodeType(e)}generate(e){const{components:t,sourceNode:n}=this,i=this.getNodeType(e),s=n.build(e),a=e.getVarFromNode(this),l=e.getPropertyName(a);e.addLineFlowCode(l+" = "+s,this);const c=e.getTypeLength(i),d=[];let m=0;for(let y=0;y<c;y++){const v=Ep[y];v===t[m]?(d.push("1.0 - "+(l+"."+v)),m++):d.push(l+"."+v)}return`${e.getType(i)}( ${d.join(", ")} )`}}class TR extends Ft{static get type(){return"InputNode"}constructor(e,t=null){super(t),this.isInputNode=!0,this.value=e,this.precision=null}getNodeType(){return this.nodeType===null?$h(this.value):this.nodeType}getInputType(e){return this.getNodeType(e)}setPrecision(e){return this.precision=e,this}serialize(e){super.serialize(e),e.value=this.value,this.value&&this.value.toArray&&(e.value=this.value.toArray()),e.valueType=$h(this.value),e.nodeType=this.nodeType,e.valueType==="ArrayBuffer"&&(e.value=d3(e.value)),e.precision=this.precision}deserialize(e){super.deserialize(e),this.nodeType=e.nodeType,this.value=Array.isArray(e.value)?h3(e.valueType,...e.value):e.value,this.precision=e.precision||null,this.value&&this.value.fromArray&&(this.value=this.value.fromArray(e.value))}generate(){console.warn("Abstract function.")}}const kw=/float|u?int/;class Wl extends TR{static get type(){return"ConstNode"}constructor(e,t=null){super(e,t),this.isConstNode=!0}generateConst(e){return e.generateConst(this.getNodeType(e),this.value)}generate(e,t){const n=this.getNodeType(e);return kw.test(n)&&kw.test(t)?e.generateConst(t,this.value):e.format(this.generateConst(e),n,t)}}class F4 extends Ft{static get type(){return"MemberNode"}constructor(e,t){super(),this.node=e,this.property=t,this.isMemberNode=!0}getNodeType(e){return this.node.getMemberType(e,this.property)}generate(e){return this.node.build(e)+"."+this.property}}let Hg=null;const hg=new Map;function Pe(r,e){if(hg.has(r)){console.warn(`THREE.TSL: Redefinition of method chaining '${r}'.`);return}if(typeof e!="function")throw new Error(`THREE.TSL: Node element ${r} is not a function`);hg.set(r,e)}const y3=r=>r.replace(/r|s/g,"x").replace(/g|t/g,"y").replace(/b|p/g,"z").replace(/a|q/g,"w"),qw=r=>y3(r).split("").sort().join(""),v3={setup(r,e){const t=e.shift();return r($_(t),...e)},get(r,e,t){if(typeof e=="string"&&r[e]===void 0){if(r.isStackNode!==!0&&e==="assign")return(...n)=>(Hg.assign(t,...n),t);if(hg.has(e)){const n=hg.get(e);return r.isStackNode?(...i)=>t.add(n(...i)):(...i)=>n(t,...i)}else{if(e==="self")return r;if(e.endsWith("Assign")&&hg.has(e.slice(0,e.length-6))){const n=hg.get(e.slice(0,e.length-6));return r.isStackNode?(...i)=>t.assign(i[0],n(...i)):(...i)=>t.assign(n(t,...i))}else{if(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0)return e=y3(e),ze(new YA(t,e));if(/^set[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=qw(e.slice(3).toLowerCase()),n=>ze(new P4(r,e,n));if(/^flip[XYZWRGBASTPQ]{1,4}$/.test(e)===!0)return e=qw(e.slice(4).toLowerCase()),()=>ze(new I4(ze(r),e));if(e==="width"||e==="height"||e==="depth")return e==="width"?e="x":e==="height"?e="y":e==="depth"&&(e="z"),ze(new YA(r,e));if(/^\d+$/.test(e)===!0)return ze(new Ap(t,new Wl(Number(e),"uint")));if(/^get$/.test(e)===!0)return n=>ze(new F4(t,n))}}}return Reflect.get(r,e,t)},set(r,e,t,n){return typeof e=="string"&&r[e]===void 0&&(/^[xyzwrgbastpq]{1,4}$/.test(e)===!0||e==="width"||e==="height"||e==="depth"||/^\d+$/.test(e)===!0)?(n[e].assign(t),!0):Reflect.set(r,e,t,n)}},NE=new WeakMap,Ww=new WeakMap,z4=function(r,e=null){const t=$h(r);if(t==="node"){let n=NE.get(r);return n===void 0&&(n=new Proxy(r,v3),NE.set(r,n),NE.set(n,n)),n}else{if(e===null&&(t==="float"||t==="boolean")||t&&t!=="shader"&&t!=="string")return ze(jA(r,e));if(t==="shader")return ge(r)}return r},V4=function(r,e=null){for(const t in r)r[t]=ze(r[t],e);return r},G4=function(r,e=null){const t=r.length;for(let n=0;n<t;n++)r[n]=ze(r[n],e);return r},H4=function(r,e=null,t=null,n=null){const i=m=>ze(n!==null?Object.assign(m,n):m);let s,a=e,l,c;function d(m){let y;return a?y=/[a-z]/i.test(a)?a+"()":a:y=r.type,l!==void 0&&m.length<l?(console.error(`THREE.TSL: "${y}" parameter length is less than minimum required.`),m.concat(new Array(l-m.length).fill(0))):c!==void 0&&m.length>c?(console.error(`THREE.TSL: "${y}" parameter length exceeds limit.`),m.slice(0,c)):m}return e===null?s=(...m)=>i(new r(...kd(d(m)))):t!==null?(t=ze(t),s=(...m)=>i(new r(e,...kd(d(m)),t))):s=(...m)=>i(new r(e,...kd(d(m)))),s.setParameterLength=(...m)=>(m.length===1?l=c=m[0]:m.length===2&&([l,c]=m),s),s.setName=m=>(a=m,s),s},k4=function(r,...e){return ze(new r(...kd(e)))};class q4 extends Ft{constructor(e,t){super(),this.shaderNode=e,this.inputNodes=t}getNodeType(e){return this.shaderNode.nodeType||this.getOutputNode(e).getNodeType(e)}getMemberType(e,t){return this.getOutputNode(e).getMemberType(e,t)}call(e){const{shaderNode:t,inputNodes:n}=this,i=e.getNodeProperties(t);if(i.onceOutput)return i.onceOutput;let s=null;if(t.layout){let a=Ww.get(e.constructor);a===void 0&&(a=new WeakMap,Ww.set(e.constructor,a));let l=a.get(t);l===void 0&&(l=ze(e.buildFunctionNode(t)),a.set(t,l)),e.addInclude(l),s=ze(l.call(n))}else{const a=t.jsFunc,l=n!==null||a.length>1?a(n||[],e):a(e);s=ze(l)}return t.once&&(i.onceOutput=s),s}getOutputNode(e){const t=e.getNodeProperties(this);return t.outputNode===null&&(t.outputNode=this.setupOutput(e)),t.outputNode}setup(e){return this.getOutputNode(e)}setupOutput(e){return e.addStack(),e.stack.outputNode=this.call(e),e.removeStack()}generate(e,t){return this.getOutputNode(e).build(e,t)}}class W4 extends Ft{constructor(e,t){super(t),this.jsFunc=e,this.layout=null,this.global=!0,this.once=!1}setLayout(e){return this.layout=e,this}call(e=null){return $_(e),ze(new q4(this,e))}setup(){return this.call()}}const X4=[!1,!0],Y4=[0,1,2,3],j4=[-1,-2],_3=[.5,1.5,1/3,1e-6,1e6,Math.PI,Math.PI*2,1/Math.PI,2/Math.PI,1/(Math.PI*2),Math.PI/2],MR=new Map;for(const r of X4)MR.set(r,new Wl(r));const ER=new Map;for(const r of Y4)ER.set(r,new Wl(r,"uint"));const AR=new Map([...ER].map(r=>new Wl(r.value,"int")));for(const r of j4)AR.set(r,new Wl(r,"int"));const LT=new Map([...AR].map(r=>new Wl(r.value)));for(const r of _3)LT.set(r,new Wl(r));for(const r of _3)LT.set(-r,new Wl(-r));const BT={bool:MR,uint:ER,ints:AR,float:LT},Xw=new Map([...MR,...LT]),jA=(r,e)=>Xw.has(r)?Xw.get(r):r.isNode===!0?r:new Wl(r,e),Z4=r=>{try{return r.getNodeType()}catch{return}},Bs=function(r,e=null){return(...t)=>{if((t.length===0||!["bool","float","int","uint"].includes(r)&&t.every(i=>typeof i!="object"))&&(t=[h3(r,...t)]),t.length===1&&e!==null&&e.has(t[0]))return ze(e.get(t[0]));if(t.length===1){const i=jA(t[0],r);return Z4(i)===r?ze(i):ze(new g3(i,r))}const n=t.map(i=>jA(i));return ze(new B4(n,r))}},N_=r=>typeof r=="object"&&r!==null?r.value:r,x3=r=>r!=null?r.nodeType||r.convertTo||(typeof r=="string"?r:null):null;function a_(r,e){return new Proxy(new W4(r,e),v3)}const ze=(r,e=null)=>z4(r,e),$_=(r,e=null)=>new V4(r,e),kd=(r,e=null)=>new G4(r,e),Ve=(...r)=>new H4(...r),rt=(...r)=>new k4(...r);let K4=0;const ge=(r,e=null)=>{let t=null;e!==null&&(typeof e=="object"?t=e.return:(typeof e=="string"?t=e:console.error("THREE.TSL: Invalid layout type."),e=null));const n=new a_(r,t),i=(...s)=>{let a;return $_(s),s[0]&&s[0].isNode?a=[...s]:a=s[0],n.call(a)};if(i.shaderNode=n,i.setLayout=s=>(n.setLayout(s),i),i.once=()=>(n.once=!0,i),e!==null){if(typeof e.inputs!="object"){const s={name:"fn"+K4++,type:t,inputs:[]};for(const a in e)a!=="return"&&s.inputs.push({name:a,type:e[a]});e=s}i.setLayout(e)}return i},Q4=(...r)=>(console.warn("THREE.TSL: tslFn() has been renamed to Fn()."),ge(...r));Pe("toGlobal",r=>(r.global=!0,r));const C_=r=>{Hg=r},RR=()=>Hg,ln=(...r)=>Hg.If(...r);function S3(r){return Hg&&Hg.add(r),r}Pe("append",S3);const b3=new Bs("color"),K=new Bs("float",BT.float),ee=new Bs("int",BT.ints),pt=new Bs("uint",BT.uint),Vc=new Bs("bool",BT.bool),Qe=new Bs("vec2"),Ws=new Bs("ivec2"),T3=new Bs("uvec2"),M3=new Bs("bvec2"),ae=new Bs("vec3"),E3=new Bs("ivec3"),iy=new Bs("uvec3"),NR=new Bs("bvec3"),Dt=new Bs("vec4"),A3=new Bs("ivec4"),R3=new Bs("uvec4"),N3=new Bs("bvec4"),OT=new Bs("mat2"),kr=new Bs("mat3"),qd=new Bs("mat4"),J4=(r="")=>ze(new Wl(r,"string")),$4=r=>ze(new Wl(r,"ArrayBuffer"));Pe("toColor",b3);Pe("toFloat",K);Pe("toInt",ee);Pe("toUint",pt);Pe("toBool",Vc);Pe("toVec2",Qe);Pe("toIVec2",Ws);Pe("toUVec2",T3);Pe("toBVec2",M3);Pe("toVec3",ae);Pe("toIVec3",E3);Pe("toUVec3",iy);Pe("toBVec3",NR);Pe("toVec4",Dt);Pe("toIVec4",A3);Pe("toUVec4",R3);Pe("toBVec4",N3);Pe("toMat2",OT);Pe("toMat3",kr);Pe("toMat4",qd);const C3=Ve(Ap).setParameterLength(2),w3=(r,e)=>ze(new g3(ze(r),e)),eG=(r,e)=>ze(new YA(ze(r),e));Pe("element",C3);Pe("convert",w3);class Yw extends es{static get type(){return"ArrayNode"}constructor(e,t,n=null){super(e),this.count=t,this.values=n,this.isArrayNode=!0}getNodeType(e){return this.nodeType===null&&(this.nodeType=this.values[0].getNodeType(e)),this.nodeType}getElementType(e){return this.getNodeType(e)}generate(e){const t=this.getNodeType(e);return e.generateArray(t,this.count,this.values)}}const D3=(...r)=>{let e;if(r.length===1){const t=r[0];e=new Yw(null,t.length,t)}else{const t=r[0],n=r[1];e=new Yw(t,n)}return ze(e)};Pe("toArray",(r,e)=>D3(Array(e).fill(r)));class U3 extends Ft{static get type(){return"UniformGroupNode"}constructor(e,t=!1,n=1){super("string"),this.name=e,this.shared=t,this.order=n,this.isUniformGroup=!0}serialize(e){super.serialize(e),e.name=this.name,e.version=this.version,e.shared=this.shared}deserialize(e){super.deserialize(e),this.name=e.name,this.version=e.version,this.shared=e.shared}}const L3=r=>new U3(r),PT=(r,e=0)=>new U3(r,!0,e),B3=PT("frame"),Gt=PT("render"),CR=L3("object");class e0 extends TR{static get type(){return"UniformNode"}constructor(e,t=null){super(e,t),this.isUniformNode=!0,this.name="",this.groupNode=CR}label(e){return this.name=e,this}setGroup(e){return this.groupNode=e,this}getGroup(){return this.groupNode}getUniformHash(e){return this.getHash(e)}onUpdate(e,t){const n=this.getSelf();return e=e.bind(n),super.onUpdate(i=>{const s=e(i,n);s!==void 0&&(this.value=s)},t)}generate(e,t){const n=this.getNodeType(e),i=this.getUniformHash(e);let s=e.getNodeFromHash(i);s===void 0&&(e.setHashNode(this,i),s=this);const a=s.getInputType(e),l=e.getUniformFromNode(s,a,e.shaderStage,this.name||e.context.label),c=e.getPropertyName(l);return e.context.label!==void 0&&delete e.context.label,e.format(c,n,t)}}const Ct=(r,e)=>{const t=x3(e||r),n=r&&r.isNode===!0?r.node&&r.node.value||r.value:r;return ze(new e0(n,t))};class ni extends Ft{static get type(){return"PropertyNode"}constructor(e,t=null,n=!1){super(e),this.name=t,this.varying=n,this.isPropertyNode=!0}getHash(e){return this.name||super.getHash(e)}isGlobal(){return!0}generate(e){let t;return this.varying===!0?(t=e.getVaryingFromNode(this,this.name),t.needsInterpolation=!0):t=e.getVarFromNode(this,this.name),e.getPropertyName(t)}}const sy=(r,e)=>ze(new ni(r,e)),w_=(r,e)=>ze(new ni(r,e,!0)),jn=rt(ni,"vec4","DiffuseColor"),ZA=rt(ni,"vec3","EmissiveColor"),Du=rt(ni,"float","Roughness"),D_=rt(ni,"float","Metalness"),bb=rt(ni,"float","Clearcoat"),U_=rt(ni,"float","ClearcoatRoughness"),Id=rt(ni,"vec3","Sheen"),IT=rt(ni,"float","SheenRoughness"),FT=rt(ni,"float","Iridescence"),wR=rt(ni,"float","IridescenceIOR"),DR=rt(ni,"float","IridescenceThickness"),Tb=rt(ni,"float","AlphaT"),Yh=rt(ni,"float","Anisotropy"),o_=rt(ni,"vec3","AnisotropyT"),Wd=rt(ni,"vec3","AnisotropyB"),Oa=rt(ni,"color","SpecularColor"),L_=rt(ni,"float","SpecularF90"),Mb=rt(ni,"float","Shininess"),yg=rt(ni,"vec4","Output"),tb=rt(ni,"float","dashSize"),KA=rt(ni,"float","gapSize"),tG=rt(ni,"float","pointWidth"),l_=rt(ni,"float","IOR"),Eb=rt(ni,"float","Transmission"),UR=rt(ni,"float","Thickness"),LR=rt(ni,"float","AttenuationDistance"),BR=rt(ni,"color","AttenuationColor"),OR=rt(ni,"float","Dispersion");class nG extends es{static get type(){return"AssignNode"}constructor(e,t){super(),this.targetNode=e,this.sourceNode=t}hasDependencies(){return!1}getNodeType(e,t){return t!=="void"?this.targetNode.getNodeType(e):"void"}needsSplitAssign(e){const{targetNode:t}=this;if(e.isAvailable("swizzleAssign")===!1&&t.isSplitNode&&t.components.length>1){const n=e.getTypeLength(t.node.getNodeType(e));return Ep.join("").slice(0,n)!==t.components}return!1}generate(e,t){const{targetNode:n,sourceNode:i}=this,s=this.needsSplitAssign(e),a=n.getNodeType(e),l=n.context({assign:!0}).build(e),c=i.build(e,a),d=i.getNodeType(e),m=e.getDataFromNode(this);let y;if(m.initialized===!0)t!=="void"&&(y=l);else if(s){const v=e.getVarFromNode(this,null,a),x=e.getPropertyName(v);e.addLineFlowCode(`${x} = ${c}`,this);const S=n.node.context({assign:!0}).build(e);for(let A=0;A<n.components.length;A++){const E=n.components[A];e.addLineFlowCode(`${S}.${E} = ${x}[ ${A} ]`,this)}t!=="void"&&(y=l)}else y=`${l} = ${c}`,(t==="void"||d==="void")&&(e.addLineFlowCode(y,this),t!=="void"&&(y=l));return m.initialized=!0,e.format(y,a,t)}}const O3=Ve(nG).setParameterLength(2);Pe("assign",O3);class iG extends es{static get type(){return"FunctionCallNode"}constructor(e=null,t={}){super(),this.functionNode=e,this.parameters=t}setParameters(e){return this.parameters=e,this}getParameters(){return this.parameters}getNodeType(e){return this.functionNode.getNodeType(e)}generate(e){const t=[],n=this.functionNode,i=n.getInputs(e),s=this.parameters,a=(c,d)=>{const m=d.type,y=m==="pointer";let v;return y?v="&"+c.build(e):v=c.build(e,m),v};if(Array.isArray(s)){if(s.length>i.length)console.error("THREE.TSL: The number of provided parameters exceeds the expected number of inputs in 'Fn()'."),s.length=i.length;else if(s.length<i.length)for(console.error("THREE.TSL: The number of provided parameters is less than the expected number of inputs in 'Fn()'.");s.length<i.length;)s.push(K(0));for(let c=0;c<s.length;c++)t.push(a(s[c],i[c]))}else for(const c of i){const d=s[c.name];d!==void 0?t.push(a(d,c)):(console.error(`THREE.TSL: Input '${c.name}' not found in 'Fn()'.`),t.push(a(K(0),c)))}return`${n.build(e,"property")}( ${t.join(", ")} )`}}const P3=(r,...e)=>(e=e.length>1||e[0]&&e[0].isNode===!0?kd(e):$_(e[0]),ze(new iG(ze(r),e)));Pe("call",P3);class Yi extends es{static get type(){return"OperatorNode"}constructor(e,t,n,...i){if(super(),i.length>0){let s=new Yi(e,t,n);for(let a=0;a<i.length-1;a++)s=new Yi(e,s,i[a]);t=s,n=i[i.length-1]}this.op=e,this.aNode=t,this.bNode=n,this.isOperatorNode=!0}getNodeType(e,t){const n=this.op,i=this.aNode,s=this.bNode,a=i.getNodeType(e),l=typeof s<"u"?s.getNodeType(e):null;if(a==="void"||l==="void")return"void";if(n==="%")return a;if(n==="~"||n==="&"||n==="|"||n==="^"||n===">>"||n==="<<")return e.getIntegerType(a);if(n==="!"||n==="=="||n==="!="||n==="&&"||n==="||"||n==="^^")return"bool";if(n==="<"||n===">"||n==="<="||n===">="){const c=t?e.getTypeLength(t):Math.max(e.getTypeLength(a),e.getTypeLength(l));return c>1?`bvec${c}`:"bool"}else{if(e.isMatrix(a)){if(l==="float")return a;if(e.isVector(l))return e.getVectorFromMatrix(a);if(e.isMatrix(l))return a}else if(e.isMatrix(l)){if(a==="float")return l;if(e.isVector(a))return e.getVectorFromMatrix(l)}return e.getTypeLength(l)>e.getTypeLength(a)?l:a}}generate(e,t){const n=this.op,i=this.aNode,s=this.bNode,a=this.getNodeType(e,t);let l=null,c=null;a!=="void"?(l=i.getNodeType(e),c=typeof s<"u"?s.getNodeType(e):null,n==="<"||n===">"||n==="<="||n===">="||n==="=="||n==="!="?e.isVector(l)?c=l:l!==c&&(l=c="float"):n===">>"||n==="<<"?(l=a,c=e.changeComponentType(c,"uint")):n==="%"?(l=a,c=e.isInteger(l)&&e.isInteger(c)?c:l):e.isMatrix(l)?c==="float"?c="float":e.isVector(c)?c=e.getVectorFromMatrix(l):e.isMatrix(c)||(l=c=a):e.isMatrix(c)?l==="float"?l="float":e.isVector(l)?l=e.getVectorFromMatrix(c):l=c=a:l=c=a):l=c=a;const d=i.build(e,l),m=typeof s<"u"?s.build(e,c):null,y=e.getTypeLength(t),v=e.getFunctionOperator(n);if(t!=="void"){const x=e.renderer.coordinateSystem===zr;if(n==="==")return x?y>1?e.format(`${e.getMethod("equal",t)}( ${d}, ${m} )`,a,t):e.format(`( ${d} ${n} ${m} )`,a,t):y>1||!e.isVector(l)?e.format(`( ${d} == ${m} )`,a,t):e.format(`all( ${d} == ${m} )`,a,t);if(n==="<"&&y>1)return x?e.format(`${e.getMethod("lessThan",t)}( ${d}, ${m} )`,a,t):e.format(`( ${d} < ${m} )`,a,t);if(n==="<="&&y>1)return x?e.format(`${e.getMethod("lessThanEqual",t)}( ${d}, ${m} )`,a,t):e.format(`( ${d} <= ${m} )`,a,t);if(n===">"&&y>1)return x?e.format(`${e.getMethod("greaterThan",t)}( ${d}, ${m} )`,a,t):e.format(`( ${d} > ${m} )`,a,t);if(n===">="&&y>1)return x?e.format(`${e.getMethod("greaterThanEqual",t)}( ${d}, ${m} )`,a,t):e.format(`( ${d} >= ${m} )`,a,t);if(n==="%")return e.isInteger(c)?e.format(`( ${d} % ${m} )`,a,t):e.format(`${e.getMethod("mod",a)}( ${d}, ${m} )`,a,t);if(n==="!"||n==="~")return e.format(`(${n}${d})`,l,t);if(v)return e.format(`${v}( ${d}, ${m} )`,a,t);if(e.isMatrix(l)&&c==="float")return e.format(`( ${m} ${n} ${d} )`,a,t);if(l==="float"&&e.isMatrix(c))return e.format(`${d} ${n} ${m}`,a,t);{let S=`( ${d} ${n} ${m} )`;return!x&&a==="bool"&&e.isVector(l)&&e.isVector(c)&&(S=`all${S}`),e.format(S,a,t)}}else if(l!=="void")return v?e.format(`${v}( ${d}, ${m} )`,a,t):e.isMatrix(l)&&c==="float"?e.format(`${m} ${n} ${d}`,a,t):e.format(`${d} ${n} ${m}`,a,t)}serialize(e){super.serialize(e),e.op=this.op}deserialize(e){super.deserialize(e),this.op=e.op}}const bs=Ve(Yi,"+").setParameterLength(2,1/0).setName("add"),On=Ve(Yi,"-").setParameterLength(2,1/0).setName("sub"),tn=Ve(Yi,"*").setParameterLength(2,1/0).setName("mul"),kl=Ve(Yi,"/").setParameterLength(2,1/0).setName("div"),t0=Ve(Yi,"%").setParameterLength(2).setName("mod"),PR=Ve(Yi,"==").setParameterLength(2).setName("equal"),I3=Ve(Yi,"!=").setParameterLength(2).setName("notEqual"),F3=Ve(Yi,"<").setParameterLength(2).setName("lessThan"),IR=Ve(Yi,">").setParameterLength(2).setName("greaterThan"),z3=Ve(Yi,"<=").setParameterLength(2).setName("lessThanEqual"),V3=Ve(Yi,">=").setParameterLength(2).setName("greaterThanEqual"),G3=Ve(Yi,"&&").setParameterLength(2,1/0).setName("and"),H3=Ve(Yi,"||").setParameterLength(2,1/0).setName("or"),k3=Ve(Yi,"!").setParameterLength(1).setName("not"),q3=Ve(Yi,"^^").setParameterLength(2).setName("xor"),W3=Ve(Yi,"&").setParameterLength(2).setName("bitAnd"),X3=Ve(Yi,"~").setParameterLength(2).setName("bitNot"),Y3=Ve(Yi,"|").setParameterLength(2).setName("bitOr"),j3=Ve(Yi,"^").setParameterLength(2).setName("bitXor"),Z3=Ve(Yi,"<<").setParameterLength(2).setName("shiftLeft"),K3=Ve(Yi,">>").setParameterLength(2).setName("shiftRight");Pe("add",bs);Pe("sub",On);Pe("mul",tn);Pe("div",kl);Pe("mod",t0);Pe("equal",PR);Pe("notEqual",I3);Pe("lessThan",F3);Pe("greaterThan",IR);Pe("lessThanEqual",z3);Pe("greaterThanEqual",V3);Pe("and",G3);Pe("or",H3);Pe("not",k3);Pe("xor",q3);Pe("bitAnd",W3);Pe("bitNot",X3);Pe("bitOr",Y3);Pe("bitXor",j3);Pe("shiftLeft",Z3);Pe("shiftRight",K3);const Q3=(r,e)=>(console.warn('THREE.TSL: "remainder()" is deprecated. Use "mod( int( ... ) )" instead.'),t0(r,e)),J3=(r,e)=>(console.warn('THREE.TSL: "modInt()" is deprecated. Use "mod( int( ... ) )" instead.'),t0(ee(r),ee(e)));Pe("remainder",Q3);Pe("modInt",J3);class _e extends es{static get type(){return"MathNode"}constructor(e,t,n=null,i=null){if(super(),(e===_e.MAX||e===_e.MIN)&&arguments.length>3){let s=new _e(e,t,n);for(let a=2;a<arguments.length-1;a++)s=new _e(e,s,arguments[a]);t=s,n=arguments[arguments.length-1],i=null}this.method=e,this.aNode=t,this.bNode=n,this.cNode=i,this.isMathNode=!0}getInputType(e){const t=this.aNode.getNodeType(e),n=this.bNode?this.bNode.getNodeType(e):null,i=this.cNode?this.cNode.getNodeType(e):null,s=e.isMatrix(t)?0:e.getTypeLength(t),a=e.isMatrix(n)?0:e.getTypeLength(n),l=e.isMatrix(i)?0:e.getTypeLength(i);return s>a&&s>l?t:a>l?n:l>s?i:t}getNodeType(e){const t=this.method;return t===_e.LENGTH||t===_e.DISTANCE||t===_e.DOT?"float":t===_e.CROSS?"vec3":t===_e.ALL||t===_e.ANY?"bool":t===_e.EQUALS?e.changeComponentType(this.aNode.getNodeType(e),"bool"):this.getInputType(e)}generate(e,t){let n=this.method;const i=this.getNodeType(e),s=this.getInputType(e),a=this.aNode,l=this.bNode,c=this.cNode,d=e.renderer.coordinateSystem;if(n===_e.TRANSFORM_DIRECTION){let m=a,y=l;e.isMatrix(m.getNodeType(e))?y=Dt(ae(y),0):m=Dt(ae(m),0);const v=tn(m,y).xyz;return Gc(v).build(e,t)}else{if(n===_e.NEGATE)return e.format("( - "+a.build(e,s)+" )",i,t);if(n===_e.ONE_MINUS)return On(1,a).build(e,t);if(n===_e.RECIPROCAL)return kl(1,a).build(e,t);if(n===_e.DIFFERENCE)return Ai(On(a,l)).build(e,t);{const m=[];return n===_e.CROSS?m.push(a.build(e,i),l.build(e,i)):d===zr&&n===_e.STEP?m.push(a.build(e,e.getTypeLength(a.getNodeType(e))===1?"float":s),l.build(e,s)):d===zr&&(n===_e.MIN||n===_e.MAX)?m.push(a.build(e,s),l.build(e,e.getTypeLength(l.getNodeType(e))===1?"float":s)):n===_e.REFRACT?m.push(a.build(e,s),l.build(e,s),c.build(e,"float")):n===_e.MIX?m.push(a.build(e,s),l.build(e,s),c.build(e,e.getTypeLength(c.getNodeType(e))===1?"float":s)):(d===Vl&&n===_e.ATAN&&l!==null&&(n="atan2"),m.push(a.build(e,s)),l!==null&&m.push(l.build(e,s)),c!==null&&m.push(c.build(e,s))),e.format(`${e.getMethod(n,i)}( ${m.join(", ")} )`,i,t)}}}serialize(e){super.serialize(e),e.method=this.method}deserialize(e){super.deserialize(e),this.method=e.method}}_e.ALL="all";_e.ANY="any";_e.RADIANS="radians";_e.DEGREES="degrees";_e.EXP="exp";_e.EXP2="exp2";_e.LOG="log";_e.LOG2="log2";_e.SQRT="sqrt";_e.INVERSE_SQRT="inversesqrt";_e.FLOOR="floor";_e.CEIL="ceil";_e.NORMALIZE="normalize";_e.FRACT="fract";_e.SIN="sin";_e.COS="cos";_e.TAN="tan";_e.ASIN="asin";_e.ACOS="acos";_e.ATAN="atan";_e.ABS="abs";_e.SIGN="sign";_e.LENGTH="length";_e.NEGATE="negate";_e.ONE_MINUS="oneMinus";_e.DFDX="dFdx";_e.DFDY="dFdy";_e.ROUND="round";_e.RECIPROCAL="reciprocal";_e.TRUNC="trunc";_e.FWIDTH="fwidth";_e.TRANSPOSE="transpose";_e.BITCAST="bitcast";_e.EQUALS="equals";_e.MIN="min";_e.MAX="max";_e.STEP="step";_e.REFLECT="reflect";_e.DISTANCE="distance";_e.DIFFERENCE="difference";_e.DOT="dot";_e.CROSS="cross";_e.POW="pow";_e.TRANSFORM_DIRECTION="transformDirection";_e.MIX="mix";_e.CLAMP="clamp";_e.REFRACT="refract";_e.SMOOTHSTEP="smoothstep";_e.FACEFORWARD="faceforward";const $3=K(1e-6),sG=K(1e6),Ab=K(Math.PI),rG=K(Math.PI*2),eL=Ve(_e,_e.ALL).setParameterLength(1),tL=Ve(_e,_e.ANY).setParameterLength(1),nL=Ve(_e,_e.RADIANS).setParameterLength(1),iL=Ve(_e,_e.DEGREES).setParameterLength(1),FR=Ve(_e,_e.EXP).setParameterLength(1),kg=Ve(_e,_e.EXP2).setParameterLength(1),zT=Ve(_e,_e.LOG).setParameterLength(1),Lu=Ve(_e,_e.LOG2).setParameterLength(1),Yu=Ve(_e,_e.SQRT).setParameterLength(1),zR=Ve(_e,_e.INVERSE_SQRT).setParameterLength(1),Bu=Ve(_e,_e.FLOOR).setParameterLength(1),VT=Ve(_e,_e.CEIL).setParameterLength(1),Gc=Ve(_e,_e.NORMALIZE).setParameterLength(1),kc=Ve(_e,_e.FRACT).setParameterLength(1),vo=Ve(_e,_e.SIN).setParameterLength(1),Ec=Ve(_e,_e.COS).setParameterLength(1),sL=Ve(_e,_e.TAN).setParameterLength(1),rL=Ve(_e,_e.ASIN).setParameterLength(1),aL=Ve(_e,_e.ACOS).setParameterLength(1),VR=Ve(_e,_e.ATAN).setParameterLength(1,2),Ai=Ve(_e,_e.ABS).setParameterLength(1),B_=Ve(_e,_e.SIGN).setParameterLength(1),Bc=Ve(_e,_e.LENGTH).setParameterLength(1),oL=Ve(_e,_e.NEGATE).setParameterLength(1),lL=Ve(_e,_e.ONE_MINUS).setParameterLength(1),GR=Ve(_e,_e.DFDX).setParameterLength(1),HR=Ve(_e,_e.DFDY).setParameterLength(1),uL=Ve(_e,_e.ROUND).setParameterLength(1),cL=Ve(_e,_e.RECIPROCAL).setParameterLength(1),kR=Ve(_e,_e.TRUNC).setParameterLength(1),hL=Ve(_e,_e.FWIDTH).setParameterLength(1),fL=Ve(_e,_e.TRANSPOSE).setParameterLength(1),aG=Ve(_e,_e.BITCAST).setParameterLength(2),dL=(r,e)=>(console.warn('THREE.TSL: "equals" is deprecated. Use "equal" inside a vector instead, like: "bvec*( equal( ... ) )"'),PR(r,e)),Xa=Ve(_e,_e.MIN).setParameterLength(2,1/0),fs=Ve(_e,_e.MAX).setParameterLength(2,1/0),GT=Ve(_e,_e.STEP).setParameterLength(2),pL=Ve(_e,_e.REFLECT).setParameterLength(2),mL=Ve(_e,_e.DISTANCE).setParameterLength(2),gL=Ve(_e,_e.DIFFERENCE).setParameterLength(2),mf=Ve(_e,_e.DOT).setParameterLength(2),HT=Ve(_e,_e.CROSS).setParameterLength(2),Pl=Ve(_e,_e.POW).setParameterLength(2),qR=Ve(_e,_e.POW,2).setParameterLength(1),yL=Ve(_e,_e.POW,3).setParameterLength(1),vL=Ve(_e,_e.POW,4).setParameterLength(1),_L=Ve(_e,_e.TRANSFORM_DIRECTION).setParameterLength(2),xL=r=>tn(B_(r),Pl(Ai(r),1/3)),WR=r=>mf(r,r),ei=Ve(_e,_e.MIX).setParameterLength(3),zu=(r,e=0,t=1)=>ze(new _e(_e.CLAMP,ze(r),ze(e),ze(t))),SL=r=>zu(r),XR=Ve(_e,_e.REFRACT).setParameterLength(3),Vu=Ve(_e,_e.SMOOTHSTEP).setParameterLength(3),YR=Ve(_e,_e.FACEFORWARD).setParameterLength(3),bL=ge(([r])=>{const n=43758.5453,i=mf(r.xy,Qe(12.9898,78.233)),s=t0(i,Ab);return kc(vo(s).mul(n))}),TL=(r,e,t)=>ei(e,t,r),ML=(r,e,t)=>Vu(e,t,r),EL=(r,e)=>(console.warn('THREE.TSL: "atan2" is overloaded. Use "atan" instead.'),VR(r,e)),oG=YR,lG=zR;Pe("all",eL);Pe("any",tL);Pe("equals",dL);Pe("radians",nL);Pe("degrees",iL);Pe("exp",FR);Pe("exp2",kg);Pe("log",zT);Pe("log2",Lu);Pe("sqrt",Yu);Pe("inverseSqrt",zR);Pe("floor",Bu);Pe("ceil",VT);Pe("normalize",Gc);Pe("fract",kc);Pe("sin",vo);Pe("cos",Ec);Pe("tan",sL);Pe("asin",rL);Pe("acos",aL);Pe("atan",VR);Pe("abs",Ai);Pe("sign",B_);Pe("length",Bc);Pe("lengthSq",WR);Pe("negate",oL);Pe("oneMinus",lL);Pe("dFdx",GR);Pe("dFdy",HR);Pe("round",uL);Pe("reciprocal",cL);Pe("trunc",kR);Pe("fwidth",hL);Pe("atan2",EL);Pe("min",Xa);Pe("max",fs);Pe("step",GT);Pe("reflect",pL);Pe("distance",mL);Pe("dot",mf);Pe("cross",HT);Pe("pow",Pl);Pe("pow2",qR);Pe("pow3",yL);Pe("pow4",vL);Pe("transformDirection",_L);Pe("mix",TL);Pe("clamp",zu);Pe("refract",XR);Pe("smoothstep",ML);Pe("faceForward",YR);Pe("difference",gL);Pe("saturate",SL);Pe("cbrt",xL);Pe("transpose",fL);Pe("rand",bL);class uG extends Ft{static get type(){return"ConditionalNode"}constructor(e,t,n=null){super(),this.condNode=e,this.ifNode=t,this.elseNode=n}getNodeType(e){const{ifNode:t,elseNode:n}=e.getNodeProperties(this);if(t===void 0)return this.setup(e),this.getNodeType(e);const i=t.getNodeType(e);if(n!==null){const s=n.getNodeType(e);if(e.getTypeLength(s)>e.getTypeLength(i))return s}return i}setup(e){const t=this.condNode.cache(),n=this.ifNode.cache(),i=this.elseNode?this.elseNode.cache():null,s=e.context.nodeBlock;e.getDataFromNode(n).parentNodeBlock=s,i!==null&&(e.getDataFromNode(i).parentNodeBlock=s);const a=e.getNodeProperties(this);a.condNode=t,a.ifNode=n.context({nodeBlock:n}),a.elseNode=i?i.context({nodeBlock:i}):null}generate(e,t){const n=this.getNodeType(e),i=e.getDataFromNode(this);if(i.nodeProperty!==void 0)return i.nodeProperty;const{condNode:s,ifNode:a,elseNode:l}=e.getNodeProperties(this),c=e.currentFunctionNode,d=t!=="void",m=d?sy(n).build(e):"";i.nodeProperty=m;const y=s.build(e,"bool");e.addFlowCode(`
${e.tab}if ( ${y} ) {

`).addFlowTab();let v=a.build(e,n);if(v&&(d?v=m+" = "+v+";":(v="return "+v+";",c===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),v="// "+v))),e.removeFlowTab().addFlowCode(e.tab+"	"+v+`

`+e.tab+"}"),l!==null){e.addFlowCode(` else {

`).addFlowTab();let x=l.build(e,n);x&&(d?x=m+" = "+x+";":(x="return "+x+";",c===null&&(console.warn("THREE.TSL: Return statement used in an inline 'Fn()'. Define a layout struct to allow return values."),x="// "+x))),e.removeFlowTab().addFlowCode(e.tab+"	"+x+`

`+e.tab+`}

`)}else e.addFlowCode(`

`);return e.format(m,n,t)}}const Sr=Ve(uG).setParameterLength(2,3);Pe("select",Sr);const AL=(...r)=>(console.warn("THREE.TSL: cond() has been renamed to select()."),Sr(...r));Pe("cond",AL);class RL extends Ft{static get type(){return"ContextNode"}constructor(e,t={}){super(),this.isContextNode=!0,this.node=e,this.value=t}getScope(){return this.node.getScope()}getNodeType(e){return this.node.getNodeType(e)}analyze(e){this.node.build(e)}setup(e){const t=e.getContext();e.setContext({...e.context,...this.value});const n=this.node.build(e);return e.setContext(t),n}generate(e,t){const n=e.getContext();e.setContext({...e.context,...this.value});const i=this.node.build(e,t);return e.setContext(n),i}}const kT=Ve(RL).setParameterLength(1,2),NL=(r,e)=>kT(r,{label:e});Pe("context",kT);Pe("label",NL);class nb extends Ft{static get type(){return"VarNode"}constructor(e,t=null,n=!1){super(),this.node=e,this.name=t,this.global=!0,this.isVarNode=!0,this.readOnly=n}getMemberType(e,t){return this.node.getMemberType(e,t)}getElementType(e){return this.node.getElementType(e)}getNodeType(e){return this.node.getNodeType(e)}generate(e){const{node:t,name:n,readOnly:i}=this,{renderer:s}=e,a=s.backend.isWebGPUBackend===!0;let l=!1,c=!1;i&&(l=e.isDeterministic(t),c=a?i:l);const d=e.getVectorType(this.getNodeType(e)),m=t.build(e,d),y=e.getVarFromNode(this,n,d,void 0,c),v=e.getPropertyName(y);let x=v;if(c)if(a)x=l?`const ${v}`:`let ${v}`;else{const S=e.getArrayCount(t);x=`const ${e.getVar(y.type,v,S)}`}return e.addLineFlowCode(`${x} = ${m}`,this),v}}const jR=Ve(nb),CL=(r,e=null)=>jR(r,e).append(),wL=(r,e=null)=>jR(r,e,!0).append();Pe("toVar",CL);Pe("toConst",wL);const DL=r=>(console.warn('TSL: "temp( node )" is deprecated. Use "Var( node )" or "node.toVar()" instead.'),jR(r));Pe("temp",DL);class cG extends Ft{static get type(){return"VaryingNode"}constructor(e,t=null){super(),this.node=e,this.name=t,this.isVaryingNode=!0}isGlobal(){return!0}getHash(e){return this.name||super.getHash(e)}getNodeType(e){return this.node.getNodeType(e)}setupVarying(e){const t=e.getNodeProperties(this);let n=t.varying;if(n===void 0){const i=this.name,s=this.getNodeType(e);t.varying=n=e.getVaryingFromNode(this,i,s),t.node=this.node}return n.needsInterpolation||(n.needsInterpolation=e.shaderStage==="fragment"),n}setup(e){this.setupVarying(e)}analyze(e){return this.setupVarying(e),this.node.analyze(e)}generate(e){const t=e.getNodeProperties(this),n=this.setupVarying(e),i=e.shaderStage==="fragment"&&t.reassignPosition===!0&&e.context.needsPositionReassign;if(t.propertyName===void 0||i){const s=this.getNodeType(e),a=e.getPropertyName(n,qA.VERTEX);e.flowNodeFromShaderStage(qA.VERTEX,this.node,s,a),t.propertyName=a,i?t.reassignPosition=!1:t.reassignPosition===void 0&&e.context.isPositionNodeInput&&(t.reassignPosition=!0)}return e.getPropertyName(n)}}const Wr=Ve(cG).setParameterLength(1,2),UL=r=>Wr(r);Pe("toVarying",Wr);Pe("toVertexStage",UL);Pe("varying",(...r)=>(console.warn("THREE.TSL: .varying() has been renamed to .toVarying()."),Wr(...r)));Pe("vertexStage",(...r)=>(console.warn("THREE.TSL: .vertexStage() has been renamed to .toVertexStage()."),Wr(...r)));const LL=ge(([r])=>{const e=r.mul(.9478672986).add(.0521327014).pow(2.4),t=r.mul(.0773993808),n=r.lessThanEqual(.04045);return ei(e,t,n)}).setLayout({name:"sRGBTransferEOTF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),BL=ge(([r])=>{const e=r.pow(.41666).mul(1.055).sub(.055),t=r.mul(12.92),n=r.lessThanEqual(.0031308);return ei(e,t,n)}).setLayout({name:"sRGBTransferOETF",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),n0="WorkingColorSpace",ZR="OutputColorSpace";class i0 extends es{static get type(){return"ColorSpaceNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.source=t,this.target=n}resolveColorSpace(e,t){return t===n0?on.workingColorSpace:t===ZR?e.context.outputColorSpace||e.renderer.outputColorSpace:t}setup(e){const{colorNode:t}=this,n=this.resolveColorSpace(e,this.source),i=this.resolveColorSpace(e,this.target);let s=t;return on.enabled===!1||n===i||!n||!i||(on.getTransfer(n)===$n&&(s=Dt(LL(s.rgb),s.a)),on.getPrimaries(n)!==on.getPrimaries(i)&&(s=Dt(kr(on._getMatrix(new Qt,n,i)).mul(s.rgb),s.a)),on.getTransfer(i)===$n&&(s=Dt(BL(s.rgb),s.a))),s}}const OL=r=>ze(new i0(ze(r),n0,ZR)),PL=r=>ze(new i0(ze(r),ZR,n0)),IL=(r,e)=>ze(new i0(ze(r),n0,e)),qT=(r,e)=>ze(new i0(ze(r),e,n0)),hG=(r,e,t)=>ze(new i0(ze(r),e,t));Pe("toOutputColorSpace",OL);Pe("toWorkingColorSpace",PL);Pe("workingToColorSpace",IL);Pe("colorSpaceToWorking",qT);let fG=class extends Ap{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,n,i)}};class FL extends Ft{static get type(){return"ReferenceBaseNode"}constructor(e,t,n=null,i=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=i,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.updateType=en.OBJECT}setGroup(e){return this.group=e,this}element(e){return ze(new fG(this,ze(e)))}setNodeType(e){const t=Ct(null,e).getSelf();this.group!==null&&t.setGroup(this.group),this.node=t}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let i=1;i<t.length;i++)n=n[t[i]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const dG=(r,e,t)=>ze(new FL(r,e,t));class pG extends FL{static get type(){return"RendererReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.renderer=n,this.setGroup(Gt)}updateReference(e){return this.reference=this.renderer!==null?this.renderer:e.renderer,this.reference}}const zL=(r,e,t=null)=>ze(new pG(r,e,t));class mG extends es{static get type(){return"ToneMappingNode"}constructor(e,t=GL,n=null){super("vec3"),this.toneMapping=e,this.exposureNode=t,this.colorNode=n}customCacheKey(){return R_(this.toneMapping)}setup(e){const t=this.colorNode||e.context.color,n=this.toneMapping;if(n===Gr)return t;let i=null;const s=e.renderer.library.getToneMappingFunction(n);return s!==null?i=Dt(s(t.rgb,this.exposureNode),t.a):(console.error("ToneMappingNode: Unsupported Tone Mapping configuration.",n),i=t),i}}const VL=(r,e,t)=>ze(new mG(r,ze(e),ze(t))),GL=zL("toneMappingExposure","float");Pe("toneMapping",(r,e,t)=>VL(e,t,r));class gG extends TR{static get type(){return"BufferAttributeNode"}constructor(e,t=null,n=0,i=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferStride=n,this.bufferOffset=i,this.usage=Fg,this.instanced=!1,this.attribute=null,this.global=!0,e&&e.isBufferAttribute===!0&&(this.attribute=e,this.usage=e.usage,this.instanced=e.isInstancedBufferAttribute)}getHash(e){if(this.bufferStride===0&&this.bufferOffset===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getNodeType(e){return this.bufferType===null&&(this.bufferType=e.getTypeFromAttribute(this.attribute)),this.bufferType}setup(e){if(this.attribute!==null)return;const t=this.getNodeType(e),n=this.value,i=e.getTypeLength(t),s=this.bufferStride||i,a=this.bufferOffset,l=n.isInterleavedBuffer===!0?n:new Y_(n,s),c=new uf(l,i,a);l.setUsage(this.usage),this.attribute=c,this.attribute.isInstancedBufferAttribute=this.instanced}generate(e){const t=this.getNodeType(e),n=e.getBufferAttributeFromNode(this,t),i=e.getPropertyName(n);let s=null;return e.shaderStage==="vertex"||e.shaderStage==="compute"?(this.name=i,s=i):s=Wr(this).build(e,t),s}getInputType(){return"bufferAttribute"}setUsage(e){return this.usage=e,this.attribute&&this.attribute.isBufferAttribute===!0&&(this.attribute.usage=e),this}setInstanced(e){return this.instanced=e,this}}const s0=(r,e=null,t=0,n=0)=>ze(new gG(r,e,t,n)),HL=(r,e=null,t=0,n=0)=>s0(r,e,t,n).setUsage(Od),Rb=(r,e=null,t=0,n=0)=>s0(r,e,t,n).setInstanced(!0),QA=(r,e=null,t=0,n=0)=>HL(r,e,t,n).setInstanced(!0);Pe("toAttribute",r=>s0(r.value));class yG extends Ft{static get type(){return"ComputeNode"}constructor(e,t,n=[64]){super("void"),this.isComputeNode=!0,this.computeNode=e,this.count=t,this.workgroupSize=n,this.dispatchCount=0,this.version=1,this.name="",this.updateBeforeType=en.OBJECT,this.onInitFunction=null,this.updateDispatchCount()}dispose(){this.dispatchEvent({type:"dispose"})}label(e){return this.name=e,this}updateDispatchCount(){const{count:e,workgroupSize:t}=this;let n=t[0];for(let i=1;i<t.length;i++)n*=t[i];this.dispatchCount=Math.ceil(e/n)}onInit(e){return this.onInitFunction=e,this}updateBefore({renderer:e}){e.compute(this)}setup(e){const t=this.computeNode.setup(e);if(t){const n=e.getNodeProperties(this);n.outputComputeNode=t.outputNode,t.outputNode=null}return t}generate(e,t){const{shaderStage:n}=e;if(n==="compute"){const i=this.computeNode.build(e,"void");i!==""&&e.addLineFlowCode(i,this)}else{const s=e.getNodeProperties(this).outputComputeNode;if(s)return s.build(e,t)}}}const kL=(r,e,t)=>ze(new yG(ze(r),e,t));Pe("compute",kL);class vG extends Ft{static get type(){return"CacheNode"}constructor(e,t=!0){super(),this.node=e,this.parent=t,this.isCacheNode=!0}getNodeType(e){const t=e.getCache(),n=e.getCacheFromNode(this,this.parent);e.setCache(n);const i=this.node.getNodeType(e);return e.setCache(t),i}build(e,...t){const n=e.getCache(),i=e.getCacheFromNode(this,this.parent);e.setCache(i);const s=this.node.build(e,...t);return e.setCache(n),s}}const u_=(r,e)=>ze(new vG(ze(r),e));Pe("cache",u_);class _G extends Ft{static get type(){return"BypassNode"}constructor(e,t){super(),this.isBypassNode=!0,this.outputNode=e,this.callNode=t}getNodeType(e){return this.outputNode.getNodeType(e)}generate(e){const t=this.callNode.build(e,"void");return t!==""&&e.addLineFlowCode(t,this),this.outputNode.build(e)}}const qL=Ve(_G).setParameterLength(2);Pe("bypass",qL);class WL extends Ft{static get type(){return"RemapNode"}constructor(e,t,n,i=K(0),s=K(1)){super(),this.node=e,this.inLowNode=t,this.inHighNode=n,this.outLowNode=i,this.outHighNode=s,this.doClamp=!0}setup(){const{node:e,inLowNode:t,inHighNode:n,outLowNode:i,outHighNode:s,doClamp:a}=this;let l=e.sub(t).div(n.sub(t));return a===!0&&(l=l.clamp()),l.mul(s.sub(i)).add(i)}}const XL=Ve(WL,null,null,{doClamp:!1}).setParameterLength(3,5),YL=Ve(WL).setParameterLength(3,5);Pe("remap",XL);Pe("remapClamp",YL);class ib extends Ft{static get type(){return"ExpressionNode"}constructor(e="",t="void"){super(t),this.snippet=e}generate(e,t){const n=this.getNodeType(e),i=this.snippet;if(n==="void")e.addLineFlowCode(i,this);else return e.format(i,n,t)}}const hf=Ve(ib).setParameterLength(1,2),jL=r=>(r?Sr(r,hf("discard")):hf("discard")).append(),xG=()=>hf("return").append();Pe("discard",jL);class SG extends es{static get type(){return"RenderOutputNode"}constructor(e,t,n){super("vec4"),this.colorNode=e,this.toneMapping=t,this.outputColorSpace=n,this.isRenderOutputNode=!0}setup({context:e}){let t=this.colorNode||e.color;const n=(this.toneMapping!==null?this.toneMapping:e.toneMapping)||Gr,i=(this.outputColorSpace!==null?this.outputColorSpace:e.outputColorSpace)||Ia;return n!==Gr&&(t=t.toneMapping(n)),i!==Ia&&i!==on.workingColorSpace&&(t=t.workingToColorSpace(i)),t}}const ZL=(r,e=null,t=null)=>ze(new SG(ze(r),e,t));Pe("renderOutput",ZL);class bG extends es{static get type(){return"DebugNode"}constructor(e,t=null){super(),this.node=e,this.callback=t}getNodeType(e){return this.node.getNodeType(e)}setup(e){return this.node.build(e)}analyze(e){return this.node.build(e)}generate(e){const t=this.callback,n=this.node.build(e);let i="";return i+=`// #--- TSL Debug ---#
`,i+=e.flow.code.replace(/^\t/mg,"")+`
`,i+="/* ... */ "+n+` /* ... */
`,i+=`// #-----------------#
`,t!==null?t(i):console.log(i),n}}const KL=(r,e=null)=>ze(new bG(ze(r),e));Pe("debug",KL);function TG(r){console.warn("THREE.TSL: AddNodeElement has been removed in favor of tree-shaking. Trying add",r)}class QL extends Ft{static get type(){return"AttributeNode"}constructor(e,t=null){super(t),this.global=!0,this._attributeName=e}getHash(e){return this.getAttributeName(e)}getNodeType(e){let t=this.nodeType;if(t===null){const n=this.getAttributeName(e);if(e.hasGeometryAttribute(n)){const i=e.geometry.getAttribute(n);t=e.getTypeFromAttribute(i)}else t="float"}return t}setAttributeName(e){return this._attributeName=e,this}getAttributeName(){return this._attributeName}generate(e){const t=this.getAttributeName(e),n=this.getNodeType(e);if(e.hasGeometryAttribute(t)===!0){const s=e.geometry.getAttribute(t),a=e.getTypeFromAttribute(s),l=e.getAttribute(t,a);return e.shaderStage==="vertex"?e.format(l.name,a,n):Wr(this).build(e,n)}else return console.warn(`AttributeNode: Vertex attribute "${t}" not found on geometry.`),e.generateConst(n)}serialize(e){super.serialize(e),e.global=this.global,e._attributeName=this._attributeName}deserialize(e){super.deserialize(e),this.global=e.global,this._attributeName=e._attributeName}}const Gu=(r,e)=>ze(new QL(r,e)),Vi=(r=0)=>Gu("uv"+(r>0?r:""),"vec2");class MG extends Ft{static get type(){return"TextureSizeNode"}constructor(e,t=null){super("uvec2"),this.isTextureSizeNode=!0,this.textureNode=e,this.levelNode=t}generate(e,t){const n=this.textureNode.build(e,"property"),i=this.levelNode===null?"0":this.levelNode.build(e,"int");return e.format(`${e.getMethod("textureDimensions")}( ${n}, ${i} )`,this.getNodeType(e),t)}}const af=Ve(MG).setParameterLength(1,2);class EG extends e0{static get type(){return"MaxMipLevelNode"}constructor(e){super(0),this._textureNode=e,this.updateType=en.FRAME}get textureNode(){return this._textureNode}get texture(){return this._textureNode.value}update(){const e=this.texture,t=e.images,n=t&&t.length>0?t[0]&&t[0].image||t[0]:e.image;if(n&&n.width!==void 0){const{width:i,height:s}=n;this.value=Math.log2(Math.max(i,s))}}}const JL=Ve(EG).setParameterLength(1);class Hu extends e0{static get type(){return"TextureNode"}constructor(e,t=null,n=null,i=null){super(e),this.isTextureNode=!0,this.uvNode=t,this.levelNode=n,this.biasNode=i,this.compareNode=null,this.depthNode=null,this.gradNode=null,this.sampler=!0,this.updateMatrix=!1,this.updateType=en.NONE,this.referenceNode=null,this._value=e,this._matrixUniform=null,this.setUpdateMatrix(t===null)}set value(e){this.referenceNode?this.referenceNode.value=e:this._value=e}get value(){return this.referenceNode?this.referenceNode.value:this._value}getUniformHash(){return this.value.uuid}getNodeType(){return this.value.isDepthTexture===!0?"float":this.value.type===di?"uvec4":this.value.type===Xs?"ivec4":"vec4"}getInputType(){return"texture"}getDefaultUV(){return Vi(this.value.channel)}updateReference(){return this.value}getTransformedUV(e){return this._matrixUniform===null&&(this._matrixUniform=Ct(this.value.matrix)),this._matrixUniform.mul(ae(e,1)).xy}setUpdateMatrix(e){return this.updateMatrix=e,this.updateType=e?en.RENDER:en.NONE,this}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.image instanceof ImageBitmap&&n.flipY===!0||n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0||n.isDepthTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(ee(af(this,this.levelNode).y).sub(t.y).sub(1))),t}setup(e){const t=e.getNodeProperties(this);t.referenceNode=this.referenceNode;const n=this.value;if(!n||n.isTexture!==!0)throw new Error("THREE.TSL: `texture( value )` function expects a valid instance of THREE.Texture().");let i=this.uvNode;(i===null||e.context.forceUVContext===!0)&&e.context.getUV&&(i=e.context.getUV(this)),i||(i=this.getDefaultUV()),this.updateMatrix===!0&&(i=this.getTransformedUV(i)),i=this.setupUV(e,i);let s=this.levelNode;s===null&&e.context.getTextureLevel&&(s=e.context.getTextureLevel(this)),t.uvNode=i,t.levelNode=s,t.biasNode=this.biasNode,t.compareNode=this.compareNode,t.gradNode=this.gradNode,t.depthNode=this.depthNode}generateUV(e,t){return t.build(e,this.sampler===!0?"vec2":"ivec2")}generateSnippet(e,t,n,i,s,a,l,c){const d=this.value;let m;return i?m=e.generateTextureLevel(d,t,n,i,a):s?m=e.generateTextureBias(d,t,n,s,a):c?m=e.generateTextureGrad(d,t,n,c,a):l?m=e.generateTextureCompare(d,t,n,l,a):this.sampler===!1?m=e.generateTextureLoad(d,t,n,a):m=e.generateTexture(d,t,n,a),m}generate(e,t){const n=this.value,i=e.getNodeProperties(this),s=super.generate(e,"property");if(/^sampler/.test(t))return s+"_sampler";if(e.isReference(t))return s;{const a=e.getDataFromNode(this);let l=a.propertyName;if(l===void 0){const{uvNode:m,levelNode:y,biasNode:v,compareNode:x,depthNode:S,gradNode:A}=i,E=this.generateUV(e,m),M=y?y.build(e,"float"):null,C=v?v.build(e,"float"):null,w=S?S.build(e,"int"):null,D=x?x.build(e,"float"):null,z=A?[A[0].build(e,"vec2"),A[1].build(e,"vec2")]:null,B=e.getVarFromNode(this);l=e.getPropertyName(B);const F=this.generateSnippet(e,s,E,M,C,w,D,z);e.addLineFlowCode(`${l} = ${F}`,this),a.snippet=F,a.propertyName=l}let c=l;const d=this.getNodeType(e);return e.needsToWorkingColorSpace(n)&&(c=qT(hf(c,d),n.colorSpace).setup(e).build(e,d)),e.format(c,d,t)}}setSampler(e){return this.sampler=e,this}getSampler(){return this.sampler}uv(e){return console.warn("THREE.TextureNode: .uv() has been renamed. Use .sample() instead."),this.sample(e)}sample(e){const t=this.clone();return t.uvNode=ze(e),t.referenceNode=this.getSelf(),ze(t)}blur(e){const t=this.clone();t.biasNode=ze(e).mul(JL(t)),t.referenceNode=this.getSelf();const n=t.value;return(n&&n.generateMipmaps===!1||n.minFilter===Si||n.magFilter===Si)&&(console.warn("THREE.TSL: texture().blur() requires mipmaps and sampling. Use .generateMipmaps=true and .minFilter/.magFilter=THREE.LinearFilter in the Texture."),t.biasNode=null),ze(t)}level(e){const t=this.clone();return t.levelNode=ze(e),t.referenceNode=this.getSelf(),ze(t)}size(e){return af(this,e)}bias(e){const t=this.clone();return t.biasNode=ze(e),t.referenceNode=this.getSelf(),ze(t)}compare(e){const t=this.clone();return t.compareNode=ze(e),t.referenceNode=this.getSelf(),ze(t)}grad(e,t){const n=this.clone();return n.gradNode=[ze(e),ze(t)],n.referenceNode=this.getSelf(),ze(n)}depth(e){const t=this.clone();return t.depthNode=ze(e),t.referenceNode=this.getSelf(),ze(t)}serialize(e){super.serialize(e),e.value=this.value.toJSON(e.meta).uuid,e.sampler=this.sampler,e.updateMatrix=this.updateMatrix,e.updateType=this.updateType}deserialize(e){super.deserialize(e),this.value=e.meta.textures[e.value],this.sampler=e.sampler,this.updateMatrix=e.updateMatrix,this.updateType=e.updateType}update(){const e=this.value,t=this._matrixUniform;t!==null&&(t.value=e.matrix),e.matrixAutoUpdate===!0&&e.updateMatrix()}clone(){const e=new this.constructor(this.value,this.uvNode,this.levelNode,this.biasNode);return e.sampler=this.sampler,e}}const En=Ve(Hu).setParameterLength(1,4),ls=(...r)=>En(...r).setSampler(!1),AG=r=>(r.isNode===!0?r:En(r)).convert("sampler"),RG=r=>(r.isNode===!0?r:En(r)).convert("samplerComparison");class KR extends e0{static get type(){return"BufferNode"}constructor(e,t,n=0){super(e,t),this.isBufferNode=!0,this.bufferType=t,this.bufferCount=n}getElementType(e){return this.getNodeType(e)}getInputType(){return"buffer"}}const r0=(r,e,t)=>ze(new KR(r,e,t));class NG extends Ap{static get type(){return"UniformArrayElementNode"}constructor(e,t){super(e,t),this.isArrayBufferElementNode=!0}generate(e){const t=super.generate(e),n=this.getNodeType(),i=this.node.getPaddedType();return e.format(t,i,n)}}class $L extends KR{static get type(){return"UniformArrayNode"}constructor(e,t=null){super(null),this.array=e,this.elementType=t===null?$h(e[0]):t,this.paddedType=this.getPaddedType(),this.updateType=en.RENDER,this.isArrayBufferNode=!0}getNodeType(){return this.paddedType}getElementType(){return this.elementType}getPaddedType(){const e=this.elementType;let t="vec4";return e==="mat2"?t="mat2":/mat/.test(e)===!0?t="mat4":e.charAt(0)==="i"?t="ivec4":e.charAt(0)==="u"&&(t="uvec4"),t}update(){const{array:e,value:t}=this,n=this.elementType;if(n==="float"||n==="int"||n==="uint")for(let i=0;i<e.length;i++){const s=i*4;t[s]=e[i]}else if(n==="color")for(let i=0;i<e.length;i++){const s=i*4,a=e[i];t[s]=a.r,t[s+1]=a.g,t[s+2]=a.b||0}else if(n==="mat2")for(let i=0;i<e.length;i++){const s=i*4,a=e[i];t[s]=a.elements[0],t[s+1]=a.elements[1],t[s+2]=a.elements[2],t[s+3]=a.elements[3]}else if(n==="mat3")for(let i=0;i<e.length;i++){const s=i*16,a=e[i];t[s]=a.elements[0],t[s+1]=a.elements[1],t[s+2]=a.elements[2],t[s+4]=a.elements[3],t[s+5]=a.elements[4],t[s+6]=a.elements[5],t[s+8]=a.elements[6],t[s+9]=a.elements[7],t[s+10]=a.elements[8],t[s+15]=1}else if(n==="mat4")for(let i=0;i<e.length;i++){const s=i*16,a=e[i];for(let l=0;l<a.elements.length;l++)t[s+l]=a.elements[l]}else for(let i=0;i<e.length;i++){const s=i*4,a=e[i];t[s]=a.x,t[s+1]=a.y,t[s+2]=a.z||0,t[s+3]=a.w||0}}setup(e){const t=this.array.length,n=this.elementType;let i=Float32Array;const s=this.paddedType,a=e.getTypeLength(s);return n.charAt(0)==="i"&&(i=Int32Array),n.charAt(0)==="u"&&(i=Uint32Array),this.value=new i(t*a),this.bufferCount=t,this.bufferType=s,super.setup(e)}element(e){return ze(new NG(this,ze(e)))}}const Bl=(r,e)=>ze(new $L(r,e)),CG=(r,e)=>(console.warn("THREE.TSL: uniforms() has been renamed to uniformArray()."),ze(new $L(r,e))),QR=Ct(0,"uint").setGroup(PT("cameraIndex")).toVarying("v_cameraIndex"),jh=Ct("float").label("cameraNear").setGroup(Gt).onRenderUpdate(({camera:r})=>r.near),Zh=Ct("float").label("cameraFar").setGroup(Gt).onRenderUpdate(({camera:r})=>r.far),Rp=ge(({camera:r})=>{let e;if(r.isArrayCamera&&r.cameras.length>0){const t=[];for(const i of r.cameras)t.push(i.projectionMatrix);e=Bl(t).setGroup(Gt).label("cameraProjectionMatrices").element(QR).toVar("cameraProjectionMatrix")}else e=Ct("mat4").label("cameraProjectionMatrix").setGroup(Gt).onRenderUpdate(({camera:t})=>t.projectionMatrix);return e}).once()(),wG=Ct("mat4").label("cameraProjectionMatrixInverse").setGroup(Gt).onRenderUpdate(({camera:r})=>r.projectionMatrixInverse),Za=ge(({camera:r})=>{let e;if(r.isArrayCamera&&r.cameras.length>0){const t=[];for(const i of r.cameras)t.push(i.matrixWorldInverse);e=Bl(t).setGroup(Gt).label("cameraViewMatrices").element(QR).toVar("cameraViewMatrix")}else e=Ct("mat4").label("cameraViewMatrix").setGroup(Gt).onRenderUpdate(({camera:t})=>t.matrixWorldInverse);return e}).once()(),DG=Ct("mat4").label("cameraWorldMatrix").setGroup(Gt).onRenderUpdate(({camera:r})=>r.matrixWorld),UG=Ct("mat3").label("cameraNormalMatrix").setGroup(Gt).onRenderUpdate(({camera:r})=>r.normalMatrix),eB=Ct(new Y).label("cameraPosition").setGroup(Gt).onRenderUpdate(({camera:r},e)=>e.value.setFromMatrixPosition(r.matrixWorld)),jw=new br;class wn extends Ft{static get type(){return"Object3DNode"}constructor(e,t=null){super(),this.scope=e,this.object3d=t,this.updateType=en.OBJECT,this._uniformNode=new e0(null)}getNodeType(){const e=this.scope;if(e===wn.WORLD_MATRIX)return"mat4";if(e===wn.POSITION||e===wn.VIEW_POSITION||e===wn.DIRECTION||e===wn.SCALE)return"vec3";if(e===wn.RADIUS)return"float"}update(e){const t=this.object3d,n=this._uniformNode,i=this.scope;if(i===wn.WORLD_MATRIX)n.value=t.matrixWorld;else if(i===wn.POSITION)n.value=n.value||new Y,n.value.setFromMatrixPosition(t.matrixWorld);else if(i===wn.SCALE)n.value=n.value||new Y,n.value.setFromMatrixScale(t.matrixWorld);else if(i===wn.DIRECTION)n.value=n.value||new Y,t.getWorldDirection(n.value);else if(i===wn.VIEW_POSITION){const s=e.camera;n.value=n.value||new Y,n.value.setFromMatrixPosition(t.matrixWorld),n.value.applyMatrix4(s.matrixWorldInverse)}else if(i===wn.RADIUS){const s=e.object.geometry;s.boundingSphere===null&&s.computeBoundingSphere(),jw.copy(s.boundingSphere).applyMatrix4(t.matrixWorld),n.value=jw.radius}}generate(e){const t=this.scope;return t===wn.WORLD_MATRIX?this._uniformNode.nodeType="mat4":t===wn.POSITION||t===wn.VIEW_POSITION||t===wn.DIRECTION||t===wn.SCALE?this._uniformNode.nodeType="vec3":t===wn.RADIUS&&(this._uniformNode.nodeType="float"),this._uniformNode.build(e)}serialize(e){super.serialize(e),e.scope=this.scope}deserialize(e){super.deserialize(e),this.scope=e.scope}}wn.WORLD_MATRIX="worldMatrix";wn.POSITION="position";wn.SCALE="scale";wn.VIEW_POSITION="viewPosition";wn.DIRECTION="direction";wn.RADIUS="radius";const LG=Ve(wn,wn.DIRECTION).setParameterLength(1),BG=Ve(wn,wn.WORLD_MATRIX).setParameterLength(1),tB=Ve(wn,wn.POSITION).setParameterLength(1),OG=Ve(wn,wn.SCALE).setParameterLength(1),PG=Ve(wn,wn.VIEW_POSITION).setParameterLength(1),IG=Ve(wn,wn.RADIUS).setParameterLength(1);class $o extends wn{static get type(){return"ModelNode"}constructor(e){super(e)}update(e){this.object3d=e.object,super.update(e)}}const FG=rt($o,$o.DIRECTION),Zo=rt($o,$o.WORLD_MATRIX),zG=rt($o,$o.POSITION),VG=rt($o,$o.SCALE),GG=rt($o,$o.VIEW_POSITION),HG=rt($o,$o.RADIUS),nB=Ct(new Qt).onObjectUpdate(({object:r},e)=>e.value.getNormalMatrix(r.matrixWorld)),kG=Ct(new Mt).onObjectUpdate(({object:r},e)=>e.value.copy(r.matrixWorld).invert()),Np=ge(r=>r.renderer.nodes.modelViewMatrix||iB).once()().toVar("modelViewMatrix"),iB=Za.mul(Zo),qG=ge(r=>(r.context.isHighPrecisionModelViewMatrix=!0,Ct("mat4").onObjectUpdate(({object:e,camera:t})=>e.modelViewMatrix.multiplyMatrices(t.matrixWorldInverse,e.matrixWorld)))).once()().toVar("highpModelViewMatrix"),WG=ge(r=>{const e=r.context.isHighPrecisionModelViewMatrix;return Ct("mat3").onObjectUpdate(({object:t,camera:n})=>(e!==!0&&t.modelViewMatrix.multiplyMatrices(n.matrixWorldInverse,t.matrixWorld),t.normalMatrix.getNormalMatrix(t.modelViewMatrix)))}).once()().toVar("highpModelNormalViewMatrix"),a0=Gu("position","vec3"),hs=a0.toVarying("positionLocal"),Nb=a0.toVarying("positionPrevious"),Oc=Zo.mul(hs).xyz.toVarying("v_positionWorld").context({needsPositionReassign:!0}),JR=hs.transformDirection(Zo).toVarying("v_positionWorldDirection").normalize().toVar("positionWorldDirection").context({needsPositionReassign:!0}),xs=ge(r=>r.context.setupPositionView(),"vec3").once()().toVarying("v_positionView").context({needsPositionReassign:!0}),Ii=xs.negate().toVarying("v_positionViewDirection").normalize().toVar("positionViewDirection");class XG extends Ft{static get type(){return"FrontFacingNode"}constructor(){super("bool"),this.isFrontFacingNode=!0}generate(e){const{renderer:t,material:n}=e;return t.coordinateSystem===zr&&n.side===Ti?"false":e.getFrontFacing()}}const sB=rt(XG),o0=K(sB).mul(2).sub(1),WT=Gu("normal","vec3"),Ya=ge(r=>r.geometry.hasAttribute("normal")===!1?(console.warn('THREE.TSL: Vertex attribute "normal" not found on geometry.'),ae(0,1,0)):WT,"vec3").once()().toVar("normalLocal"),rB=xs.dFdx().cross(xs.dFdy()).normalize().toVar("normalFlat"),el=ge(r=>{let e;return r.material.flatShading===!0?e=rB:e=Wr($R(Ya),"v_normalView").normalize(),e},"vec3").once()().toVar("normalView"),XT=Wr(el.transformDirection(Za),"v_normalWorld").normalize().toVar("normalWorld"),cs=ge(r=>r.context.setupNormal().context({getUV:null}),"vec3").once()().mul(o0).toVar("transformedNormalView"),YT=cs.transformDirection(Za).toVar("transformedNormalWorld"),fg=ge(r=>r.context.setupClearcoatNormal().context({getUV:null}),"vec3").once()().mul(o0).toVar("transformedClearcoatNormalView"),aB=ge(([r,e=Zo])=>{const t=kr(e),n=r.div(ae(t[0].dot(t[0]),t[1].dot(t[1]),t[2].dot(t[2])));return t.mul(n).xyz}),$R=ge(([r],e)=>{const t=e.renderer.nodes.modelNormalViewMatrix;if(t!==null)return t.transformDirection(r);const n=nB.mul(r);return Za.transformDirection(n)}),Zw=new _a,CE=new Mt,oB=Ct(0).onReference(({material:r})=>r).onObjectUpdate(({material:r})=>r.refractionRatio),sb=Ct(1).onReference(({material:r})=>r).onObjectUpdate(function({material:r,scene:e}){return r.envMap?r.envMapIntensity:e.environmentIntensity}),eN=Ct(new Mt).onReference(function(r){return r.material}).onObjectUpdate(function({material:r,scene:e}){const t=e.environment!==null&&r.envMap===null?e.environmentRotation:r.envMapRotation;return t?(Zw.copy(t),CE.makeRotationFromEuler(Zw)):CE.identity(),CE}),lB=Ii.negate().reflect(cs),uB=Ii.negate().refract(cs,oB),cB=lB.transformDirection(Za).toVar("reflectVector"),hB=uB.transformDirection(Za).toVar("reflectVector");class YG extends Hu{static get type(){return"CubeTextureNode"}constructor(e,t=null,n=null,i=null){super(e,t,n,i),this.isCubeTextureNode=!0}getInputType(){return"cubeTexture"}getDefaultUV(){const e=this.value;return e.mapping===va?cB:e.mapping===Wa?hB:(console.error('THREE.CubeTextureNode: Mapping "%s" not supported.',e.mapping),ae(0,0,0))}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return(e.renderer.coordinateSystem===Vl||!n.isRenderTargetTexture)&&(t=ae(t.x.negate(),t.yz)),eN.mul(t)}generateUV(e,t){return t.build(e,"vec3")}}const qg=Ve(YG).setParameterLength(1,4).setName("cubeTexture");class jG extends Ap{static get type(){return"ReferenceElementNode"}constructor(e,t){super(e,t),this.referenceNode=e,this.isReferenceElementNode=!0}getNodeType(){return this.referenceNode.uniformType}generate(e){const t=super.generate(e),n=this.referenceNode.getNodeType(),i=this.getNodeType();return e.format(t,n,i)}}class jT extends Ft{static get type(){return"ReferenceNode"}constructor(e,t,n=null,i=null){super(),this.property=e,this.uniformType=t,this.object=n,this.count=i,this.properties=e.split("."),this.reference=n,this.node=null,this.group=null,this.name=null,this.updateType=en.OBJECT}element(e){return ze(new jG(this,ze(e)))}setGroup(e){return this.group=e,this}label(e){return this.name=e,this}setNodeType(e){let t=null;this.count!==null?t=r0(null,e,this.count):Array.isArray(this.getValueFromReference())?t=Bl(null,e):e==="texture"?t=En(null):e==="cubeTexture"?t=qg(null):t=Ct(null,e),this.group!==null&&t.setGroup(this.group),this.name!==null&&t.label(this.name),this.node=t.getSelf()}getNodeType(e){return this.node===null&&(this.updateReference(e),this.updateValue()),this.node.getNodeType(e)}getValueFromReference(e=this.reference){const{properties:t}=this;let n=e[t[0]];for(let i=1;i<t.length;i++)n=n[t[i]];return n}updateReference(e){return this.reference=this.object!==null?this.object:e.object,this.reference}setup(){return this.updateValue(),this.node}update(){this.updateValue()}updateValue(){this.node===null&&this.setNodeType(this.uniformType);const e=this.getValueFromReference();Array.isArray(e)?this.node.array=e:this.node.value=e}}const _i=(r,e,t)=>ze(new jT(r,e,t)),JA=(r,e,t,n)=>ze(new jT(r,e,n,t));class ZG extends jT{static get type(){return"MaterialReferenceNode"}constructor(e,t,n=null){super(e,t,n),this.material=n,this.isMaterialReferenceNode=!0}updateReference(e){return this.reference=this.material!==null?this.material:e.material,this.reference}}const Nc=(r,e,t=null)=>ze(new ZG(r,e,t)),ZT=ge(r=>(r.geometry.hasAttribute("tangent")===!1&&r.geometry.computeTangents(),Gu("tangent","vec4")))(),l0=ZT.xyz.toVar("tangentLocal"),u0=Np.mul(Dt(l0,0)).xyz.toVarying("v_tangentView").normalize().toVar("tangentView"),fB=u0.transformDirection(Za).toVarying("v_tangentWorld").normalize().toVar("tangentWorld"),tN=u0.toVar("transformedTangentView"),KG=tN.transformDirection(Za).normalize().toVar("transformedTangentWorld"),c0=r=>r.mul(ZT.w).xyz,QG=Wr(c0(WT.cross(ZT)),"v_bitangentGeometry").normalize().toVar("bitangentGeometry"),JG=Wr(c0(Ya.cross(l0)),"v_bitangentLocal").normalize().toVar("bitangentLocal"),dB=Wr(c0(el.cross(u0)),"v_bitangentView").normalize().toVar("bitangentView"),$G=Wr(c0(XT.cross(fB)),"v_bitangentWorld").normalize().toVar("bitangentWorld"),pB=c0(cs.cross(tN)).normalize().toVar("transformedBitangentView"),eH=pB.transformDirection(Za).normalize().toVar("transformedBitangentWorld"),Fd=kr(u0,dB,el),mB=Ii.mul(Fd),tH=(r,e)=>r.sub(mB.mul(e)),gB=(()=>{let r=Wd.cross(Ii);return r=r.cross(Wd).normalize(),r=ei(r,cs,Yh.mul(Du.oneMinus()).oneMinus().pow2().pow2()).normalize(),r})(),nH=ge(r=>{const{eye_pos:e,surf_norm:t,mapN:n,uv:i}=r,s=e.dFdx(),a=e.dFdy(),l=i.dFdx(),c=i.dFdy(),d=t,m=a.cross(d),y=d.cross(s),v=m.mul(l.x).add(y.mul(c.x)),x=m.mul(l.y).add(y.mul(c.y)),S=v.dot(v).max(x.dot(x)),A=o0.mul(S.inverseSqrt());return bs(v.mul(n.x,A),x.mul(n.y,A),d.mul(n.z)).normalize()});class iH extends es{static get type(){return"NormalMapNode"}constructor(e,t=null){super("vec3"),this.node=e,this.scaleNode=t,this.normalMapType=Fu}setup(e){const{normalMapType:t,scaleNode:n}=this;let i=this.node.mul(2).sub(1);n!==null&&(i=ae(i.xy.mul(n),i.z));let s=null;return t===B1?s=$R(i):t===Fu&&(e.hasGeometryAttribute("tangent")===!0?s=Fd.mul(i).normalize():s=nH({eye_pos:xs,surf_norm:el,mapN:i,uv:Vi()})),s}}const $A=Ve(iH).setParameterLength(1,2),sH=ge(({textureNode:r,bumpScale:e})=>{const t=i=>r.cache().context({getUV:s=>i(s.uvNode||Vi()),forceUVContext:!0}),n=K(t(i=>i));return Qe(K(t(i=>i.add(i.dFdx()))).sub(n),K(t(i=>i.add(i.dFdy()))).sub(n)).mul(e)}),rH=ge(r=>{const{surf_pos:e,surf_norm:t,dHdxy:n}=r,i=e.dFdx().normalize(),s=e.dFdy().normalize(),a=t,l=s.cross(a),c=a.cross(i),d=i.dot(l).mul(o0),m=d.sign().mul(n.x.mul(l).add(n.y.mul(c)));return d.abs().mul(t).sub(m).normalize()});class aH extends es{static get type(){return"BumpMapNode"}constructor(e,t=null){super("vec3"),this.textureNode=e,this.scaleNode=t}setup(){const e=this.scaleNode!==null?this.scaleNode:1,t=sH({textureNode:this.textureNode,bumpScale:e});return rH({surf_pos:xs,surf_norm:el,dHdxy:t})}}const yB=Ve(aH).setParameterLength(1,2),Kw=new Map;class Oe extends Ft{static get type(){return"MaterialNode"}constructor(e){super(),this.scope=e}getCache(e,t){let n=Kw.get(e);return n===void 0&&(n=Nc(e,t),Kw.set(e,n)),n}getFloat(e){return this.getCache(e,"float")}getColor(e){return this.getCache(e,"color")}getTexture(e){return this.getCache(e==="map"?"map":e+"Map","texture")}setup(e){const t=e.context.material,n=this.scope;let i=null;if(n===Oe.COLOR){const s=t.color!==void 0?this.getColor(n):ae();t.map&&t.map.isTexture===!0?i=s.mul(this.getTexture("map")):i=s}else if(n===Oe.OPACITY){const s=this.getFloat(n);t.alphaMap&&t.alphaMap.isTexture===!0?i=s.mul(this.getTexture("alpha")):i=s}else if(n===Oe.SPECULAR_STRENGTH)t.specularMap&&t.specularMap.isTexture===!0?i=this.getTexture("specular").r:i=K(1);else if(n===Oe.SPECULAR_INTENSITY){const s=this.getFloat(n);t.specularIntensityMap&&t.specularIntensityMap.isTexture===!0?i=s.mul(this.getTexture(n).a):i=s}else if(n===Oe.SPECULAR_COLOR){const s=this.getColor(n);t.specularColorMap&&t.specularColorMap.isTexture===!0?i=s.mul(this.getTexture(n).rgb):i=s}else if(n===Oe.ROUGHNESS){const s=this.getFloat(n);t.roughnessMap&&t.roughnessMap.isTexture===!0?i=s.mul(this.getTexture(n).g):i=s}else if(n===Oe.METALNESS){const s=this.getFloat(n);t.metalnessMap&&t.metalnessMap.isTexture===!0?i=s.mul(this.getTexture(n).b):i=s}else if(n===Oe.EMISSIVE){const s=this.getFloat("emissiveIntensity"),a=this.getColor(n).mul(s);t.emissiveMap&&t.emissiveMap.isTexture===!0?i=a.mul(this.getTexture(n)):i=a}else if(n===Oe.NORMAL)t.normalMap?(i=$A(this.getTexture("normal"),this.getCache("normalScale","vec2")),i.normalMapType=t.normalMapType):t.bumpMap?i=yB(this.getTexture("bump").r,this.getFloat("bumpScale")):i=el;else if(n===Oe.CLEARCOAT){const s=this.getFloat(n);t.clearcoatMap&&t.clearcoatMap.isTexture===!0?i=s.mul(this.getTexture(n).r):i=s}else if(n===Oe.CLEARCOAT_ROUGHNESS){const s=this.getFloat(n);t.clearcoatRoughnessMap&&t.clearcoatRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(n).r):i=s}else if(n===Oe.CLEARCOAT_NORMAL)t.clearcoatNormalMap?i=$A(this.getTexture(n),this.getCache(n+"Scale","vec2")):i=el;else if(n===Oe.SHEEN){const s=this.getColor("sheenColor").mul(this.getFloat("sheen"));t.sheenColorMap&&t.sheenColorMap.isTexture===!0?i=s.mul(this.getTexture("sheenColor").rgb):i=s}else if(n===Oe.SHEEN_ROUGHNESS){const s=this.getFloat(n);t.sheenRoughnessMap&&t.sheenRoughnessMap.isTexture===!0?i=s.mul(this.getTexture(n).a):i=s,i=i.clamp(.07,1)}else if(n===Oe.ANISOTROPY)if(t.anisotropyMap&&t.anisotropyMap.isTexture===!0){const s=this.getTexture(n);i=OT(og.x,og.y,og.y.negate(),og.x).mul(s.rg.mul(2).sub(Qe(1)).normalize().mul(s.b))}else i=og;else if(n===Oe.IRIDESCENCE_THICKNESS){const s=_i("1","float",t.iridescenceThicknessRange);if(t.iridescenceThicknessMap){const a=_i("0","float",t.iridescenceThicknessRange);i=s.sub(a).mul(this.getTexture(n).g).add(a)}else i=s}else if(n===Oe.TRANSMISSION){const s=this.getFloat(n);t.transmissionMap?i=s.mul(this.getTexture(n).r):i=s}else if(n===Oe.THICKNESS){const s=this.getFloat(n);t.thicknessMap?i=s.mul(this.getTexture(n).g):i=s}else if(n===Oe.IOR)i=this.getFloat(n);else if(n===Oe.LIGHT_MAP)i=this.getTexture(n).rgb.mul(this.getFloat("lightMapIntensity"));else if(n===Oe.AO)i=this.getTexture(n).r.sub(1).mul(this.getFloat("aoMapIntensity")).add(1);else{const s=this.getNodeType(e);i=this.getCache(n,s)}return i}}Oe.ALPHA_TEST="alphaTest";Oe.COLOR="color";Oe.OPACITY="opacity";Oe.SHININESS="shininess";Oe.SPECULAR="specular";Oe.SPECULAR_STRENGTH="specularStrength";Oe.SPECULAR_INTENSITY="specularIntensity";Oe.SPECULAR_COLOR="specularColor";Oe.REFLECTIVITY="reflectivity";Oe.ROUGHNESS="roughness";Oe.METALNESS="metalness";Oe.NORMAL="normal";Oe.CLEARCOAT="clearcoat";Oe.CLEARCOAT_ROUGHNESS="clearcoatRoughness";Oe.CLEARCOAT_NORMAL="clearcoatNormal";Oe.EMISSIVE="emissive";Oe.ROTATION="rotation";Oe.SHEEN="sheen";Oe.SHEEN_ROUGHNESS="sheenRoughness";Oe.ANISOTROPY="anisotropy";Oe.IRIDESCENCE="iridescence";Oe.IRIDESCENCE_IOR="iridescenceIOR";Oe.IRIDESCENCE_THICKNESS="iridescenceThickness";Oe.IOR="ior";Oe.TRANSMISSION="transmission";Oe.THICKNESS="thickness";Oe.ATTENUATION_DISTANCE="attenuationDistance";Oe.ATTENUATION_COLOR="attenuationColor";Oe.LINE_SCALE="scale";Oe.LINE_DASH_SIZE="dashSize";Oe.LINE_GAP_SIZE="gapSize";Oe.LINE_WIDTH="linewidth";Oe.LINE_DASH_OFFSET="dashOffset";Oe.POINT_SIZE="size";Oe.DISPERSION="dispersion";Oe.LIGHT_MAP="light";Oe.AO="ao";const vB=rt(Oe,Oe.ALPHA_TEST),_B=rt(Oe,Oe.COLOR),xB=rt(Oe,Oe.SHININESS),SB=rt(Oe,Oe.EMISSIVE),nN=rt(Oe,Oe.OPACITY),bB=rt(Oe,Oe.SPECULAR),e1=rt(Oe,Oe.SPECULAR_INTENSITY),TB=rt(Oe,Oe.SPECULAR_COLOR),c_=rt(Oe,Oe.SPECULAR_STRENGTH),rb=rt(Oe,Oe.REFLECTIVITY),MB=rt(Oe,Oe.ROUGHNESS),EB=rt(Oe,Oe.METALNESS),AB=rt(Oe,Oe.NORMAL),RB=rt(Oe,Oe.CLEARCOAT),NB=rt(Oe,Oe.CLEARCOAT_ROUGHNESS),CB=rt(Oe,Oe.CLEARCOAT_NORMAL),wB=rt(Oe,Oe.ROTATION),DB=rt(Oe,Oe.SHEEN),UB=rt(Oe,Oe.SHEEN_ROUGHNESS),LB=rt(Oe,Oe.ANISOTROPY),BB=rt(Oe,Oe.IRIDESCENCE),OB=rt(Oe,Oe.IRIDESCENCE_IOR),PB=rt(Oe,Oe.IRIDESCENCE_THICKNESS),IB=rt(Oe,Oe.TRANSMISSION),FB=rt(Oe,Oe.THICKNESS),zB=rt(Oe,Oe.IOR),VB=rt(Oe,Oe.ATTENUATION_DISTANCE),GB=rt(Oe,Oe.ATTENUATION_COLOR),HB=rt(Oe,Oe.LINE_SCALE),kB=rt(Oe,Oe.LINE_DASH_SIZE),qB=rt(Oe,Oe.LINE_GAP_SIZE),oH=rt(Oe,Oe.LINE_WIDTH),WB=rt(Oe,Oe.LINE_DASH_OFFSET),XB=rt(Oe,Oe.POINT_SIZE),YB=rt(Oe,Oe.DISPERSION),iN=rt(Oe,Oe.LIGHT_MAP),jB=rt(Oe,Oe.AO),og=Ct(new Xe).onReference(function(r){return r.material}).onRenderUpdate(function({material:r}){this.value.set(r.anisotropy*Math.cos(r.anisotropyRotation),r.anisotropy*Math.sin(r.anisotropyRotation))}),sN=ge(r=>r.context.setupModelViewProjection(),"vec4").once()().toVarying("v_modelViewProjection");class Fi extends Ft{static get type(){return"IndexNode"}constructor(e){super("uint"),this.scope=e,this.isIndexNode=!0}generate(e){const t=this.getNodeType(e),n=this.scope;let i;if(n===Fi.VERTEX)i=e.getVertexIndex();else if(n===Fi.INSTANCE)i=e.getInstanceIndex();else if(n===Fi.DRAW)i=e.getDrawIndex();else if(n===Fi.INVOCATION_LOCAL)i=e.getInvocationLocalIndex();else if(n===Fi.INVOCATION_SUBGROUP)i=e.getInvocationSubgroupIndex();else if(n===Fi.SUBGROUP)i=e.getSubgroupIndex();else throw new Error("THREE.IndexNode: Unknown scope: "+n);let s;return e.shaderStage==="vertex"||e.shaderStage==="compute"?s=i:s=Wr(this).build(e,t),s}}Fi.VERTEX="vertex";Fi.INSTANCE="instance";Fi.SUBGROUP="subgroup";Fi.INVOCATION_LOCAL="invocationLocal";Fi.INVOCATION_SUBGROUP="invocationSubgroup";Fi.DRAW="draw";const ZB=rt(Fi,Fi.VERTEX),of=rt(Fi,Fi.INSTANCE),lH=rt(Fi,Fi.SUBGROUP),uH=rt(Fi,Fi.INVOCATION_SUBGROUP),cH=rt(Fi,Fi.INVOCATION_LOCAL),KB=rt(Fi,Fi.DRAW);class QB extends Ft{static get type(){return"InstanceNode"}constructor(e,t,n){super("void"),this.count=e,this.instanceMatrix=t,this.instanceColor=n,this.instanceMatrixNode=null,this.instanceColorNode=null,this.updateType=en.FRAME,this.buffer=null,this.bufferColor=null}setup(e){const{count:t,instanceMatrix:n,instanceColor:i}=this;let{instanceMatrixNode:s,instanceColorNode:a}=this;if(s===null){if(t<=1e3)s=r0(n.array,"mat4",Math.max(t,1)).element(of);else{const c=new r3(n.array,16,1);this.buffer=c;const d=n.usage===Od?QA:Rb,m=[d(c,"vec4",16,0),d(c,"vec4",16,4),d(c,"vec4",16,8),d(c,"vec4",16,12)];s=qd(...m)}this.instanceMatrixNode=s}if(i&&a===null){const c=new Qo(i.array,3),d=i.usage===Od?QA:Rb;this.bufferColor=c,a=ae(d(c,"vec3",3,0)),this.instanceColorNode=a}const l=s.mul(hs).xyz;if(hs.assign(l),e.hasGeometryAttribute("normal")){const c=aB(Ya,s);Ya.assign(c)}this.instanceColorNode!==null&&w_("vec3","vInstanceColor").assign(this.instanceColorNode)}update(){this.instanceMatrix.usage!==Od&&this.buffer!==null&&this.instanceMatrix.version!==this.buffer.version&&(this.buffer.version=this.instanceMatrix.version),this.instanceColor&&this.instanceColor.usage!==Od&&this.bufferColor!==null&&this.instanceColor.version!==this.bufferColor.version&&(this.bufferColor.version=this.instanceColor.version)}}const hH=Ve(QB).setParameterLength(3);class fH extends QB{static get type(){return"InstancedMeshNode"}constructor(e){const{count:t,instanceMatrix:n,instanceColor:i}=e;super(t,n,i),this.instancedMesh=e}}const JB=Ve(fH).setParameterLength(1);class dH extends Ft{static get type(){return"BatchNode"}constructor(e){super("void"),this.batchMesh=e,this.batchingIdNode=null}setup(e){this.batchingIdNode===null&&(e.getDrawIndex()===null?this.batchingIdNode=of:this.batchingIdNode=KB);const n=ge(([S])=>{const A=ee(af(ls(this.batchMesh._indirectTexture),0).x),E=ee(S).mod(A),M=ee(S).div(A);return ls(this.batchMesh._indirectTexture,Ws(E,M)).x}).setLayout({name:"getIndirectIndex",type:"uint",inputs:[{name:"id",type:"int"}]})(ee(this.batchingIdNode)),i=this.batchMesh._matricesTexture,s=ee(af(ls(i),0).x),a=K(n).mul(4).toInt().toVar(),l=a.mod(s),c=a.div(s),d=qd(ls(i,Ws(l,c)),ls(i,Ws(l.add(1),c)),ls(i,Ws(l.add(2),c)),ls(i,Ws(l.add(3),c))),m=this.batchMesh._colorsTexture;if(m!==null){const A=ge(([E])=>{const M=ee(af(ls(m),0).x),C=E,w=C.mod(M),D=C.div(M);return ls(m,Ws(w,D)).rgb}).setLayout({name:"getBatchingColor",type:"vec3",inputs:[{name:"id",type:"int"}]})(n);w_("vec3","vBatchColor").assign(A)}const y=kr(d);hs.assign(d.mul(hs));const v=Ya.div(ae(y[0].dot(y[0]),y[1].dot(y[1]),y[2].dot(y[2]))),x=y.mul(v).xyz;Ya.assign(x),e.hasGeometryAttribute("tangent")&&l0.mulAssign(y)}}const $B=Ve(dH).setParameterLength(1);class pH extends Ap{static get type(){return"StorageArrayElementNode"}constructor(e,t){super(e,t),this.isStorageArrayElementNode=!0}set storageBufferNode(e){this.node=e}get storageBufferNode(){return this.node}getMemberType(e,t){const n=this.storageBufferNode.structTypeNode;return n?n.getMemberType(e,t):"void"}setup(e){return e.isAvailable("storageBuffer")===!1&&this.node.isPBO===!0&&e.setupPBO(this.node),super.setup(e)}generate(e,t){let n;const i=e.context.assign;if(e.isAvailable("storageBuffer")===!1?this.node.isPBO===!0&&i!==!0&&(this.node.value.isInstancedBufferAttribute||e.shaderStage!=="compute")?n=e.generatePBO(this):n=this.node.build(e):n=super.generate(e),i!==!0){const s=this.getNodeType(e);n=e.format(n,s,t)}return n}}const mH=Ve(pH).setParameterLength(2);class gH extends KR{static get type(){return"StorageBufferNode"}constructor(e,t=null,n=0){let i,s=null;t&&t.isStruct?(i="struct",s=t.layout):t===null&&(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute)?(i=c3(e.itemSize),n=e.count):i=t,super(e,i,n),this.isStorageBufferNode=!0,this.structTypeNode=s,this.access=Vr.READ_WRITE,this.isAtomic=!1,this.isPBO=!1,this._attribute=null,this._varying=null,this.global=!0,e.isStorageBufferAttribute!==!0&&e.isStorageInstancedBufferAttribute!==!0&&(e.isInstancedBufferAttribute?e.isStorageInstancedBufferAttribute=!0:e.isStorageBufferAttribute=!0)}getHash(e){if(this.bufferCount===0){let t=e.globalCache.getData(this.value);return t===void 0&&(t={node:this},e.globalCache.setData(this.value,t)),t.node.uuid}return this.uuid}getInputType(){return this.value.isIndirectStorageBufferAttribute?"indirectStorageBuffer":"storageBuffer"}element(e){return mH(this,e)}setPBO(e){return this.isPBO=e,this}getPBO(){return this.isPBO}setAccess(e){return this.access=e,this}toReadOnly(){return this.setAccess(Vr.READ_ONLY)}setAtomic(e){return this.isAtomic=e,this}toAtomic(){return this.setAtomic(!0)}getAttributeData(){return this._attribute===null&&(this._attribute=s0(this.value),this._varying=Wr(this._attribute)),{attribute:this._attribute,varying:this._varying}}getNodeType(e){if(this.structTypeNode!==null)return this.structTypeNode.getNodeType(e);if(e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.getNodeType(e);const{attribute:t}=this.getAttributeData();return t.getNodeType(e)}generate(e){if(this.structTypeNode!==null&&this.structTypeNode.build(e),e.isAvailable("storageBuffer")||e.isAvailable("indirectStorageBuffer"))return super.generate(e);const{attribute:t,varying:n}=this.getAttributeData(),i=n.build(e);return e.registerTransform(i,t),i}}const Xd=(r,e=null,t=0)=>ze(new gH(r,e,t)),yH=(r,e,t)=>(console.warn('THREE.TSL: "storageObject()" is deprecated. Use "storage().setPBO( true )" instead.'),Xd(r,e,t).setPBO(!0)),Qw=new WeakMap;class eO extends Ft{static get type(){return"SkinningNode"}constructor(e){super("void"),this.skinnedMesh=e,this.updateType=en.OBJECT,this.skinIndexNode=Gu("skinIndex","uvec4"),this.skinWeightNode=Gu("skinWeight","vec4"),this.bindMatrixNode=_i("bindMatrix","mat4"),this.bindMatrixInverseNode=_i("bindMatrixInverse","mat4"),this.boneMatricesNode=JA("skeleton.boneMatrices","mat4",e.skeleton.bones.length),this.positionNode=hs,this.toPositionNode=hs,this.previousBoneMatricesNode=null}getSkinnedPosition(e=this.boneMatricesNode,t=this.positionNode){const{skinIndexNode:n,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:a}=this,l=e.element(n.x),c=e.element(n.y),d=e.element(n.z),m=e.element(n.w),y=s.mul(t),v=bs(l.mul(i.x).mul(y),c.mul(i.y).mul(y),d.mul(i.z).mul(y),m.mul(i.w).mul(y));return a.mul(v).xyz}getSkinnedNormal(e=this.boneMatricesNode,t=Ya){const{skinIndexNode:n,skinWeightNode:i,bindMatrixNode:s,bindMatrixInverseNode:a}=this,l=e.element(n.x),c=e.element(n.y),d=e.element(n.z),m=e.element(n.w);let y=bs(i.x.mul(l),i.y.mul(c),i.z.mul(d),i.w.mul(m));return y=a.mul(y).mul(s),y.transformDirection(t).xyz}getPreviousSkinnedPosition(e){const t=e.object;return this.previousBoneMatricesNode===null&&(t.skeleton.previousBoneMatrices=new Float32Array(t.skeleton.boneMatrices),this.previousBoneMatricesNode=JA("skeleton.previousBoneMatrices","mat4",t.skeleton.bones.length)),this.getSkinnedPosition(this.previousBoneMatricesNode,Nb)}needsPreviousBoneMatrices(e){const t=e.renderer.getMRT();return t&&t.has("velocity")||f3(e.object).useVelocity===!0}setup(e){this.needsPreviousBoneMatrices(e)&&Nb.assign(this.getPreviousSkinnedPosition(e));const t=this.getSkinnedPosition();if(this.toPositionNode&&this.toPositionNode.assign(t),e.hasGeometryAttribute("normal")){const n=this.getSkinnedNormal();Ya.assign(n),e.hasGeometryAttribute("tangent")&&l0.assign(n)}return t}generate(e,t){if(t!=="void")return super.generate(e,t)}update(e){const t=e.object&&e.object.skeleton?e.object.skeleton:this.skinnedMesh.skeleton;Qw.get(t)!==e.frameId&&(Qw.set(t,e.frameId),this.previousBoneMatricesNode!==null&&t.previousBoneMatrices.set(t.boneMatrices),t.update())}}const tO=r=>ze(new eO(r)),vH=(r,e=null)=>{const t=new eO(r);return t.positionNode=Xd(new Qo(r.geometry.getAttribute("position").array,3),"vec3").setPBO(!0).toReadOnly().element(of).toVar(),t.skinIndexNode=Xd(new Qo(new Uint32Array(r.geometry.getAttribute("skinIndex").array),4),"uvec4").setPBO(!0).toReadOnly().element(of).toVar(),t.skinWeightNode=Xd(new Qo(r.geometry.getAttribute("skinWeight").array,4),"vec4").setPBO(!0).toReadOnly().element(of).toVar(),t.bindMatrixNode=Ct(r.bindMatrix,"mat4"),t.bindMatrixInverseNode=Ct(r.bindMatrixInverse,"mat4"),t.boneMatricesNode=r0(r.skeleton.boneMatrices,"mat4",r.skeleton.bones.length),t.toPositionNode=e,ze(t)};class _H extends Ft{static get type(){return"LoopNode"}constructor(e=[]){super(),this.params=e}getVarName(e){return String.fromCharCode(105+e)}getProperties(e){const t=e.getNodeProperties(this);if(t.stackNode!==void 0)return t;const n={};for(let s=0,a=this.params.length-1;s<a;s++){const l=this.params[s],c=l.isNode!==!0&&l.name||this.getVarName(s),d=l.isNode!==!0&&l.type||"int";n[c]=hf(c,d)}const i=e.addStack();return t.returnsNode=this.params[this.params.length-1](n,i,e),t.stackNode=i,e.removeStack(),t}getNodeType(e){const{returnsNode:t}=this.getProperties(e);return t?t.getNodeType(e):"void"}setup(e){this.getProperties(e)}generate(e){const t=this.getProperties(e),n=this.params,i=t.stackNode;for(let l=0,c=n.length-1;l<c;l++){const d=n[l];let m=!1,y=null,v=null,x=null,S=null,A=null,E=null;d.isNode?d.getNodeType(e)==="bool"?(m=!0,S="bool",v=d.build(e,S)):(S="int",x=this.getVarName(l),y="0",v=d.build(e,S),A="<"):(S=d.type||"int",x=d.name||this.getVarName(l),y=d.start,v=d.end,A=d.condition,E=d.update,typeof y=="number"?y=e.generateConst(S,y):y&&y.isNode&&(y=y.build(e,S)),typeof v=="number"?v=e.generateConst(S,v):v&&v.isNode&&(v=v.build(e,S)),y!==void 0&&v===void 0?(y=y+" - 1",v="0",A=">="):v!==void 0&&y===void 0&&(y="0",A="<"),A===void 0&&(Number(y)>Number(v)?A=">=":A="<"));let M;if(m)M=`while ( ${v} )`;else{const C={start:y,end:v},w=C.start,D=C.end;let z="",B="",F="";E||(S==="int"||S==="uint"?A.includes("<")?E="++":E="--":A.includes("<")?E="+= 1.":E="-= 1."),z+=e.getVar(S,x)+" = "+w,B+=x+" "+A+" "+D,F+=x+" "+E,M=`for ( ${z}; ${B}; ${F} )`}e.addFlowCode((l===0?`
`:"")+e.tab+M+` {

`).addFlowTab()}const s=i.build(e,"void"),a=t.returnsNode?t.returnsNode.build(e):"";e.removeFlowTab().addFlowCode(`
`+e.tab+s);for(let l=0,c=this.params.length-1;l<c;l++)e.addFlowCode((l===0?"":e.tab)+`}

`).removeFlowTab();return e.addFlowTab(),a}}const ti=(...r)=>ze(new _H(kd(r,"int"))).append(),xH=()=>hf("continue").append(),nO=()=>hf("break").append(),SH=(...r)=>(console.warn("THREE.TSL: loop() has been renamed to Loop()."),ti(...r)),wE=new WeakMap,go=new Ot,Jw=ge(({bufferMap:r,influence:e,stride:t,width:n,depth:i,offset:s})=>{const a=ee(ZB).mul(t).add(s),l=a.div(n),c=a.sub(l.mul(n));return ls(r,Ws(c,l)).depth(i).xyz.mul(e)});function bH(r){const e=r.morphAttributes.position!==void 0,t=r.morphAttributes.normal!==void 0,n=r.morphAttributes.color!==void 0,i=r.morphAttributes.position||r.morphAttributes.normal||r.morphAttributes.color,s=i!==void 0?i.length:0;let a=wE.get(r);if(a===void 0||a.count!==s){let C=function(){E.dispose(),wE.delete(r),r.removeEventListener("dispose",C)};var l=C;a!==void 0&&a.texture.dispose();const c=r.morphAttributes.position||[],d=r.morphAttributes.normal||[],m=r.morphAttributes.color||[];let y=0;e===!0&&(y=1),t===!0&&(y=2),n===!0&&(y=3);let v=r.attributes.position.count*y,x=1;const S=4096;v>S&&(x=Math.ceil(v/S),v=S);const A=new Float32Array(v*x*4*s),E=new Jg(A,v,x,s);E.type=Ri,E.needsUpdate=!0;const M=y*4;for(let w=0;w<s;w++){const D=c[w],z=d[w],B=m[w],F=v*x*4*w;for(let H=0;H<D.count;H++){const I=H*M;e===!0&&(go.fromBufferAttribute(D,H),A[F+I+0]=go.x,A[F+I+1]=go.y,A[F+I+2]=go.z,A[F+I+3]=0),t===!0&&(go.fromBufferAttribute(z,H),A[F+I+4]=go.x,A[F+I+5]=go.y,A[F+I+6]=go.z,A[F+I+7]=0),n===!0&&(go.fromBufferAttribute(B,H),A[F+I+8]=go.x,A[F+I+9]=go.y,A[F+I+10]=go.z,A[F+I+11]=B.itemSize===4?go.w:1)}}a={count:s,texture:E,stride:y,size:new Xe(v,x)},wE.set(r,a),r.addEventListener("dispose",C)}return a}class TH extends Ft{static get type(){return"MorphNode"}constructor(e){super("void"),this.mesh=e,this.morphBaseInfluence=Ct(1),this.updateType=en.OBJECT}setup(e){const{geometry:t}=e,n=t.morphAttributes.position!==void 0,i=t.hasAttribute("normal")&&t.morphAttributes.normal!==void 0,s=t.morphAttributes.position||t.morphAttributes.normal||t.morphAttributes.color,a=s!==void 0?s.length:0,{texture:l,stride:c,size:d}=bH(t);n===!0&&hs.mulAssign(this.morphBaseInfluence),i===!0&&Ya.mulAssign(this.morphBaseInfluence);const m=ee(d.width);ti(a,({i:y})=>{const v=K(0).toVar();this.mesh.count>1&&this.mesh.morphTexture!==null&&this.mesh.morphTexture!==void 0?v.assign(ls(this.mesh.morphTexture,Ws(ee(y).add(1),ee(of))).r):v.assign(_i("morphTargetInfluences","float").element(y).toVar()),ln(v.notEqual(0),()=>{n===!0&&hs.addAssign(Jw({bufferMap:l,influence:v,stride:c,width:m,depth:y,offset:ee(0)})),i===!0&&Ya.addAssign(Jw({bufferMap:l,influence:v,stride:c,width:m,depth:y,offset:ee(1)}))})})}update(){const e=this.morphBaseInfluence;this.mesh.geometry.morphTargetsRelative?e.value=1:e.value=1-this.mesh.morphTargetInfluences.reduce((t,n)=>t+n,0)}}const iO=Ve(TH).setParameterLength(1);class ry extends Ft{static get type(){return"LightingNode"}constructor(){super("vec3"),this.isLightingNode=!0}}class MH extends ry{static get type(){return"AONode"}constructor(e=null){super(),this.aoNode=e}setup(e){e.context.ambientOcclusion.mulAssign(this.aoNode)}}class EH extends RL{static get type(){return"LightingContextNode"}constructor(e,t=null,n=null,i=null){super(e),this.lightingModel=t,this.backdropNode=n,this.backdropAlphaNode=i,this._value=null}getContext(){const{backdropNode:e,backdropAlphaNode:t}=this,n=ae().toVar("directDiffuse"),i=ae().toVar("directSpecular"),s=ae().toVar("indirectDiffuse"),a=ae().toVar("indirectSpecular"),l={directDiffuse:n,directSpecular:i,indirectDiffuse:s,indirectSpecular:a};return{radiance:ae().toVar("radiance"),irradiance:ae().toVar("irradiance"),iblIrradiance:ae().toVar("iblIrradiance"),ambientOcclusion:K(1).toVar("ambientOcclusion"),reflectedLight:l,backdrop:e,backdropAlpha:t}}setup(e){return this.value=this._value||(this._value=this.getContext()),this.value.lightingModel=this.lightingModel||e.context.lightingModel,super.setup(e)}}const sO=Ve(EH);class AH extends ry{static get type(){return"IrradianceNode"}constructor(e){super(),this.node=e}setup(e){e.context.irradiance.addAssign(this.node)}}let Pv,Iv;class Ls extends Ft{static get type(){return"ScreenNode"}constructor(e){super(),this.scope=e,this.isViewportNode=!0}getNodeType(){return this.scope===Ls.VIEWPORT?"vec4":"vec2"}getUpdateType(){let e=en.NONE;return(this.scope===Ls.SIZE||this.scope===Ls.VIEWPORT)&&(e=en.RENDER),this.updateType=e,e}update({renderer:e}){const t=e.getRenderTarget();this.scope===Ls.VIEWPORT?t!==null?Iv.copy(t.viewport):(e.getViewport(Iv),Iv.multiplyScalar(e.getPixelRatio())):t!==null?(Pv.width=t.width,Pv.height=t.height):e.getDrawingBufferSize(Pv)}setup(){const e=this.scope;let t=null;return e===Ls.SIZE?t=Ct(Pv||(Pv=new Xe)):e===Ls.VIEWPORT?t=Ct(Iv||(Iv=new Ot)):t=Qe(h0.div(O_)),t}generate(e){if(this.scope===Ls.COORDINATE){let t=e.getFragCoord();if(e.isFlipY()){const n=e.getNodeProperties(O_).outputNode.build(e);t=`${e.getType("vec2")}( ${t}.x, ${n}.y - ${t}.y )`}return t}return super.generate(e)}}Ls.COORDINATE="coordinate";Ls.VIEWPORT="viewport";Ls.SIZE="size";Ls.UV="uv";const ku=rt(Ls,Ls.UV),O_=rt(Ls,Ls.SIZE),h0=rt(Ls,Ls.COORDINATE),vg=rt(Ls,Ls.VIEWPORT),rO=vg.zw,aO=h0.sub(vg.xy),RH=aO.div(rO),NH=ge(()=>(console.warn('THREE.TSL: "viewportResolution" is deprecated. Use "screenSize" instead.'),O_),"vec2").once()(),CH=ge(()=>(console.warn('THREE.TSL: "viewportTopLeft" is deprecated. Use "screenUV" instead.'),ku),"vec2").once()(),wH=ge(()=>(console.warn('THREE.TSL: "viewportBottomLeft" is deprecated. Use "screenUV.flipY()" instead.'),ku.flipY()),"vec2").once()(),Fv=new Xe;class KT extends Hu{static get type(){return"ViewportTextureNode"}constructor(e=ku,t=null,n=null){n===null&&(n=new k1,n.minFilter=xr),super(n,e,t),this.generateMipmaps=!1,this.isOutputTextureNode=!0,this.updateBeforeType=en.FRAME}updateBefore(e){const t=e.renderer;t.getDrawingBufferSize(Fv);const n=this.value;(n.image.width!==Fv.width||n.image.height!==Fv.height)&&(n.image.width=Fv.width,n.image.height=Fv.height,n.needsUpdate=!0);const i=n.generateMipmaps;n.generateMipmaps=this.generateMipmaps,t.copyFramebufferToTexture(n),n.generateMipmaps=i}clone(){const e=new this.constructor(this.uvNode,this.levelNode,this.value);return e.generateMipmaps=this.generateMipmaps,e}}const DH=Ve(KT).setParameterLength(0,3),rN=Ve(KT,null,null,{generateMipmaps:!0}).setParameterLength(0,3);let DE=null;class UH extends KT{static get type(){return"ViewportDepthTextureNode"}constructor(e=ku,t=null){DE===null&&(DE=new ya),super(e,t,DE)}}const aN=Ve(UH).setParameterLength(0,2);class za extends Ft{static get type(){return"ViewportDepthNode"}constructor(e,t=null){super("float"),this.scope=e,this.valueNode=t,this.isViewportDepthNode=!0}generate(e){const{scope:t}=this;return t===za.DEPTH_BASE?e.getFragDepth():super.generate(e)}setup({camera:e}){const{scope:t}=this,n=this.valueNode;let i=null;if(t===za.DEPTH_BASE)n!==null&&(i=lO().assign(n));else if(t===za.DEPTH)e.isPerspectiveCamera?i=oO(xs.z,jh,Zh):i=_g(xs.z,jh,Zh);else if(t===za.LINEAR_DEPTH)if(n!==null)if(e.isPerspectiveCamera){const s=oN(n,jh,Zh);i=_g(s,jh,Zh)}else i=n;else i=_g(xs.z,jh,Zh);return i}}za.DEPTH_BASE="depthBase";za.DEPTH="depth";za.LINEAR_DEPTH="linearDepth";const _g=(r,e,t)=>r.add(e).div(e.sub(t)),LH=(r,e,t)=>e.sub(t).mul(r).sub(e),oO=(r,e,t)=>e.add(r).mul(t).div(t.sub(e).mul(r)),oN=(r,e,t)=>e.mul(t).div(t.sub(e).mul(r).sub(t)),lN=(r,e,t)=>{e=e.max(1e-6).toVar();const n=Lu(r.negate().div(e)),i=Lu(t.div(e));return n.div(i)},BH=(r,e,t)=>{const n=r.mul(zT(t.div(e)));return K(Math.E).pow(n).mul(e).negate()},lO=Ve(za,za.DEPTH_BASE),uN=rt(za,za.DEPTH),Cb=Ve(za,za.LINEAR_DEPTH).setParameterLength(0,1),OH=Cb(aN());uN.assign=r=>lO(r);class PH extends Ft{constructor(e){super("float"),this.name=e,this.isBuiltinNode=!0}generate(){return this.name}}const IH=Ve(PH).setParameterLength(1);class Jo extends Ft{static get type(){return"ClippingNode"}constructor(e=Jo.DEFAULT){super(),this.scope=e}setup(e){super.setup(e);const t=e.clippingContext,{intersectionPlanes:n,unionPlanes:i}=t;return this.hardwareClipping=e.material.hardwareClipping,this.scope===Jo.ALPHA_TO_COVERAGE?this.setupAlphaToCoverage(n,i):this.scope===Jo.HARDWARE?this.setupHardwareClipping(i,e):this.setupDefault(n,i)}setupAlphaToCoverage(e,t){return ge(()=>{const n=K().toVar("distanceToPlane"),i=K().toVar("distanceToGradient"),s=K(1).toVar("clipOpacity"),a=t.length;if(this.hardwareClipping===!1&&a>0){const c=Bl(t);ti(a,({i:d})=>{const m=c.element(d);n.assign(xs.dot(m.xyz).negate().add(m.w)),i.assign(n.fwidth().div(2)),s.mulAssign(Vu(i.negate(),i,n))})}const l=e.length;if(l>0){const c=Bl(e),d=K(1).toVar("intersectionClipOpacity");ti(l,({i:m})=>{const y=c.element(m);n.assign(xs.dot(y.xyz).negate().add(y.w)),i.assign(n.fwidth().div(2)),d.mulAssign(Vu(i.negate(),i,n).oneMinus())}),s.mulAssign(d.oneMinus())}jn.a.mulAssign(s),jn.a.equal(0).discard()})()}setupDefault(e,t){return ge(()=>{const n=t.length;if(this.hardwareClipping===!1&&n>0){const s=Bl(t);ti(n,({i:a})=>{const l=s.element(a);xs.dot(l.xyz).greaterThan(l.w).discard()})}const i=e.length;if(i>0){const s=Bl(e),a=Vc(!0).toVar("clipped");ti(i,({i:l})=>{const c=s.element(l);a.assign(xs.dot(c.xyz).greaterThan(c.w).and(a))}),a.discard()}})()}setupHardwareClipping(e,t){const n=e.length;return t.enableHardwareClipping(n),ge(()=>{const i=Bl(e),s=IH(t.getClipDistance());ti(n,({i:a})=>{const l=i.element(a),c=xs.dot(l.xyz).sub(l.w).negate();s.element(a).assign(c)})})()}}Jo.ALPHA_TO_COVERAGE="alphaToCoverage";Jo.DEFAULT="default";Jo.HARDWARE="hardware";const FH=()=>ze(new Jo),zH=()=>ze(new Jo(Jo.ALPHA_TO_COVERAGE)),VH=()=>ze(new Jo(Jo.HARDWARE)),GH=.05,$w=ge(([r])=>kc(tn(1e4,vo(tn(17,r.x).add(tn(.1,r.y)))).mul(bs(.1,Ai(vo(tn(13,r.y).add(r.x))))))),e2=ge(([r])=>$w(Qe($w(r.xy),r.z))),HH=ge(([r])=>{const e=fs(Bc(GR(r.xyz)),Bc(HR(r.xyz))),t=K(1).div(K(GH).mul(e)).toVar("pixScale"),n=Qe(kg(Bu(Lu(t))),kg(VT(Lu(t)))),i=Qe(e2(Bu(n.x.mul(r.xyz))),e2(Bu(n.y.mul(r.xyz)))),s=kc(Lu(t)),a=bs(tn(s.oneMinus(),i.x),tn(s,i.y)),l=Xa(s,s.oneMinus()),c=ae(a.mul(a).div(tn(2,l).mul(On(1,l))),a.sub(tn(.5,l)).div(On(1,l)),On(1,On(1,a).mul(On(1,a)).div(tn(2,l).mul(On(1,l))))),d=a.lessThan(l.oneMinus()).select(a.lessThan(l).select(c.x,c.y),c.z);return zu(d,1e-6,1)}).setLayout({name:"getAlphaHashThreshold",type:"float",inputs:[{name:"position",type:"vec3"}]});class Ts extends ar{static get type(){return"NodeMaterial"}get type(){return this.constructor.type}set type(e){}constructor(){super(),this.isNodeMaterial=!0,this.fog=!0,this.lights=!1,this.hardwareClipping=!1,this.lightsNode=null,this.envNode=null,this.aoNode=null,this.colorNode=null,this.normalNode=null,this.opacityNode=null,this.backdropNode=null,this.backdropAlphaNode=null,this.alphaTestNode=null,this.positionNode=null,this.geometryNode=null,this.depthNode=null,this.shadowPositionNode=null,this.receivedShadowNode=null,this.castShadowNode=null,this.outputNode=null,this.mrtNode=null,this.fragmentNode=null,this.vertexNode=null}customProgramCacheKey(){return this.type+u3(this)}build(e){this.setup(e)}setupObserver(e){return new w4(e)}setup(e){e.context.setupNormal=()=>this.setupNormal(e),e.context.setupPositionView=()=>this.setupPositionView(e),e.context.setupModelViewProjection=()=>this.setupModelViewProjection(e);const t=e.renderer,n=t.getRenderTarget();e.addStack();const i=this.vertexNode||this.setupVertex(e);e.stack.outputNode=i,this.setupHardwareClipping(e),this.geometryNode!==null&&(e.stack.outputNode=e.stack.outputNode.bypass(this.geometryNode)),e.addFlow("vertex",e.removeStack()),e.addStack();let s;const a=this.setupClipping(e);if((this.depthWrite===!0||this.depthTest===!0)&&(n!==null?n.depthBuffer===!0&&this.setupDepth(e):t.depth===!0&&this.setupDepth(e)),this.fragmentNode===null){this.setupDiffuseColor(e),this.setupVariants(e);const l=this.setupLighting(e);a!==null&&e.stack.add(a);const c=Dt(l,jn.a).max(0);s=this.setupOutput(e,c),yg.assign(s);const d=this.outputNode!==null;if(d&&(s=this.outputNode),n!==null){const m=t.getMRT(),y=this.mrtNode;m!==null?(d&&yg.assign(s),s=m,y!==null&&(s=m.merge(y))):y!==null&&(s=y)}}else{let l=this.fragmentNode;l.isOutputStructNode!==!0&&(l=Dt(l)),s=this.setupOutput(e,l)}e.stack.outputNode=s,e.addFlow("fragment",e.removeStack()),e.observer=this.setupObserver(e)}setupClipping(e){if(e.clippingContext===null)return null;const{unionPlanes:t,intersectionPlanes:n}=e.clippingContext;let i=null;if(t.length>0||n.length>0){const s=e.renderer.samples;this.alphaToCoverage&&s>1?i=zH():e.stack.add(FH())}return i}setupHardwareClipping(e){if(this.hardwareClipping=!1,e.clippingContext===null)return;const t=e.clippingContext.unionPlanes.length;t>0&&t<=8&&e.isAvailable("clipDistance")&&(e.stack.add(VH()),this.hardwareClipping=!0)}setupDepth(e){const{renderer:t,camera:n}=e;let i=this.depthNode;if(i===null){const s=t.getMRT();s&&s.has("depth")?i=s.get("depth"):t.logarithmicDepthBuffer===!0&&(n.isPerspectiveCamera?i=lN(xs.z,jh,Zh):i=_g(xs.z,jh,Zh))}i!==null&&uN.assign(i).append()}setupPositionView(){return Np.mul(hs).xyz}setupModelViewProjection(){return Rp.mul(xs)}setupVertex(e){return e.addStack(),this.setupPosition(e),e.context.vertex=e.removeStack(),sN}setupPosition(e){const{object:t,geometry:n}=e;if((n.morphAttributes.position||n.morphAttributes.normal||n.morphAttributes.color)&&iO(t).append(),t.isSkinnedMesh===!0&&tO(t).append(),this.displacementMap){const i=Nc("displacementMap","texture"),s=Nc("displacementScale","float"),a=Nc("displacementBias","float");hs.addAssign(Ya.normalize().mul(i.x.mul(s).add(a)))}return t.isBatchedMesh&&$B(t).append(),t.isInstancedMesh&&t.instanceMatrix&&t.instanceMatrix.isInstancedBufferAttribute===!0&&JB(t).append(),this.positionNode!==null&&hs.assign(this.positionNode.context({isPositionNodeInput:!0})),hs}setupDiffuseColor({object:e,geometry:t}){let n=this.colorNode?Dt(this.colorNode):_B;this.vertexColors===!0&&t.hasAttribute("color")&&(n=Dt(n.xyz.mul(Gu("color","vec3")),n.a)),e.instanceColor&&(n=w_("vec3","vInstanceColor").mul(n)),e.isBatchedMesh&&e._colorsTexture&&(n=w_("vec3","vBatchColor").mul(n)),jn.assign(n);const i=this.opacityNode?K(this.opacityNode):nN;if(jn.a.assign(jn.a.mul(i)),this.alphaTestNode!==null||this.alphaTest>0){const s=this.alphaTestNode!==null?K(this.alphaTestNode):vB;jn.a.lessThanEqual(s).discard()}this.alphaHash===!0&&jn.a.lessThan(HH(hs)).discard(),this.transparent===!1&&this.blending===_o&&this.alphaToCoverage===!1&&jn.a.assign(1)}setupVariants(){}setupOutgoingLight(){return this.lights===!0?ae(0):jn.rgb}setupNormal(){return this.normalNode?ae(this.normalNode):AB}setupEnvironment(){let e=null;return this.envNode?e=this.envNode:this.envMap&&(e=this.envMap.isCubeTexture?Nc("envMap","cubeTexture"):Nc("envMap","texture")),e}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new AH(iN)),t}setupLights(e){const t=[],n=this.setupEnvironment(e);n&&n.isLightingNode&&t.push(n);const i=this.setupLightMap(e);if(i&&i.isLightingNode&&t.push(i),this.aoNode!==null||e.material.aoMap){const a=this.aoNode!==null?this.aoNode:jB;t.push(new MH(a))}let s=this.lightsNode||e.lightsNode;return t.length>0&&(s=e.renderer.lighting.createNode([...s.getLights(),...t])),s}setupLightingModel(){}setupLighting(e){const{material:t}=e,{backdropNode:n,backdropAlphaNode:i,emissiveNode:s}=this,l=this.lights===!0||this.lightsNode!==null?this.setupLights(e):null;let c=this.setupOutgoingLight(e);if(l&&l.getScope().hasLights){const d=this.setupLightingModel(e)||null;c=sO(l,d,n,i)}else n!==null&&(c=ae(i!==null?ei(c,n,i):n));return(s&&s.isNode===!0||t.emissive&&t.emissive.isColor===!0)&&(ZA.assign(ae(s||SB)),c=c.add(ZA)),c}setupFog(e,t){const n=e.fogNode;return n&&(yg.assign(t),t=Dt(n)),t}setupOutput(e,t){return this.fog===!0&&(t=this.setupFog(e,t)),t}setDefaultValues(e){for(const n in e){const i=e[n];this[n]===void 0&&(this[n]=i,i&&i.clone&&(this[n]=i.clone()))}const t=Object.getOwnPropertyDescriptors(e.constructor.prototype);for(const n in t)Object.getOwnPropertyDescriptor(this.constructor.prototype,n)===void 0&&t[n].get!==void 0&&Object.defineProperty(this.constructor.prototype,n,t[n])}toJSON(e){const t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{},nodes:{}});const n=ar.prototype.toJSON.call(this,e),i=xb(this);n.inputNodes={};for(const{property:a,childNode:l}of i)n.inputNodes[a]=l.toJSON(e).uuid;function s(a){const l=[];for(const c in a){const d=a[c];delete d.metadata,l.push(d)}return l}if(t){const a=s(e.textures),l=s(e.images),c=s(e.nodes);a.length>0&&(n.textures=a),l.length>0&&(n.images=l),c.length>0&&(n.nodes=c)}return n}copy(e){return this.lightsNode=e.lightsNode,this.envNode=e.envNode,this.colorNode=e.colorNode,this.normalNode=e.normalNode,this.opacityNode=e.opacityNode,this.backdropNode=e.backdropNode,this.backdropAlphaNode=e.backdropAlphaNode,this.alphaTestNode=e.alphaTestNode,this.positionNode=e.positionNode,this.geometryNode=e.geometryNode,this.depthNode=e.depthNode,this.shadowPositionNode=e.shadowPositionNode,this.receivedShadowNode=e.receivedShadowNode,this.castShadowNode=e.castShadowNode,this.outputNode=e.outputNode,this.mrtNode=e.mrtNode,this.fragmentNode=e.fragmentNode,this.vertexNode=e.vertexNode,super.copy(e)}}const kH=new qr;class qH extends Ts{static get type(){return"LineBasicNodeMaterial"}constructor(e){super(),this.isLineBasicNodeMaterial=!0,this.setDefaultValues(kH),this.setValues(e)}}const WH=new rR;class XH extends Ts{static get type(){return"LineDashedNodeMaterial"}constructor(e){super(),this.isLineDashedNodeMaterial=!0,this.setDefaultValues(WH),this.dashOffset=0,this.offsetNode=null,this.dashScaleNode=null,this.dashSizeNode=null,this.gapSizeNode=null,this.setValues(e)}setupVariants(){const e=this.offsetNode?K(this.offsetNode):WB,t=this.dashScaleNode?K(this.dashScaleNode):HB,n=this.dashSizeNode?K(this.dashSizeNode):kB,i=this.gapSizeNode?K(this.gapSizeNode):qB;tb.assign(n),KA.assign(i);const s=Wr(Gu("lineDistance").mul(t));(e?s.add(e):s).mod(tb.add(KA)).greaterThan(tb).discard()}}let UE=null;class YH extends KT{static get type(){return"ViewportSharedTextureNode"}constructor(e=ku,t=null){UE===null&&(UE=new k1),super(e,t,UE)}updateReference(){return this}}const jH=Ve(YH).setParameterLength(0,2),uO=r=>ze(r).mul(.5).add(.5),ZH=r=>ze(r).mul(2).sub(1),KH=new eR;class QH extends Ts{static get type(){return"MeshNormalNodeMaterial"}constructor(e){super(),this.isMeshNormalNodeMaterial=!0,this.setDefaultValues(KH),this.setValues(e)}setupDiffuseColor(){const e=this.opacityNode?K(this.opacityNode):nN;jn.assign(qT(Dt(uO(cs),e),wt))}}class JH extends es{static get type(){return"EquirectUVNode"}constructor(e=JR){super("vec2"),this.dirNode=e}setup(){const e=this.dirNode,t=e.z.atan(e.x).mul(1/(Math.PI*2)).add(.5),n=e.y.clamp(-1,1).asin().mul(1/Math.PI).add(.5);return Qe(t,n)}}const cN=Ve(JH).setParameterLength(0,1);class cO extends G1{constructor(e=1,t={}){super(e,t),this.isCubeRenderTarget=!0}fromEquirectangularTexture(e,t){const n=t.minFilter,i=t.generateMipmaps;t.generateMipmaps=!0,this.texture.type=t.type,this.texture.colorSpace=t.colorSpace,this.texture.generateMipmaps=t.generateMipmaps,this.texture.minFilter=t.minFilter,this.texture.magFilter=t.magFilter;const s=new Hc(5,5,5),a=cN(JR),l=new Ts;l.colorNode=En(t,a,0),l.side=Ti,l.blending=Ga;const c=new bi(s,l),d=new ey;d.add(c),t.minFilter===xr&&(t.minFilter=Zn);const m=new V1(1,10,this),y=e.getMRT();return e.setMRT(null),m.update(e,d),e.setMRT(y),t.minFilter=n,t.currentGenerateMipmaps=i,c.geometry.dispose(),c.material.dispose(),this}}const h_=new WeakMap;class $H extends es{static get type(){return"CubeMapNode"}constructor(e){super("vec3"),this.envNode=e,this._cubeTexture=null,this._cubeTextureNode=qg(null);const t=new _p;t.isRenderTargetTexture=!0,this._defaultTexture=t,this.updateBeforeType=en.RENDER}updateBefore(e){const{renderer:t,material:n}=e,i=this.envNode;if(i.isTextureNode||i.isMaterialReferenceNode){const s=i.isTextureNode?i.value:n[i.property];if(s&&s.isTexture){const a=s.mapping;if(a===Pu||a===Iu){if(h_.has(s)){const l=h_.get(s);t2(l,s.mapping),this._cubeTexture=l}else{const l=s.image;if(e5(l)){const c=new cO(l.height);c.fromEquirectangularTexture(t,s),t2(c.texture,s.mapping),this._cubeTexture=c.texture,h_.set(s,c.texture),s.addEventListener("dispose",hO)}else this._cubeTexture=this._defaultTexture}this._cubeTextureNode.value=this._cubeTexture}else this._cubeTextureNode=this.envNode}}}setup(e){return this.updateBefore(e),this._cubeTextureNode}}function e5(r){return r==null?!1:r.height>0}function hO(r){const e=r.target;e.removeEventListener("dispose",hO);const t=h_.get(e);t!==void 0&&(h_.delete(e),t.dispose())}function t2(r,e){e===Pu?r.mapping=va:e===Iu&&(r.mapping=Wa)}const fO=Ve($H).setParameterLength(1);class hN extends ry{static get type(){return"BasicEnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){e.context.environment=fO(this.envNode)}}class t5 extends ry{static get type(){return"BasicLightMapNode"}constructor(e=null){super(),this.lightMapNode=e}setup(e){const t=K(1/Math.PI);e.context.irradianceLightMap=this.lightMapNode.mul(t)}}class QT{start(e){e.lightsNode.setupLights(e,e.lightsNode.getLightNodes(e)),this.indirect(e)}finish(){}direct(){}directRectArea(){}indirect(){}ambientOcclusion(){}}class dO extends QT{constructor(){super()}indirect({context:e}){const t=e.ambientOcclusion,n=e.reflectedLight,i=e.irradianceLightMap;n.indirectDiffuse.assign(Dt(0)),i?n.indirectDiffuse.addAssign(i):n.indirectDiffuse.addAssign(Dt(1,1,1,0)),n.indirectDiffuse.mulAssign(t),n.indirectDiffuse.mulAssign(jn.rgb)}finish(e){const{material:t,context:n}=e,i=n.outgoingLight,s=e.context.environment;if(s)switch(t.combine){case Kg:i.rgb.assign(ei(i.rgb,i.rgb.mul(s.rgb),c_.mul(rb)));break;case A1:i.rgb.assign(ei(i.rgb,s.rgb,c_.mul(rb)));break;case R1:i.rgb.addAssign(s.rgb.mul(c_.mul(rb)));break;default:console.warn("THREE.BasicLightingModel: Unsupported .combine value:",t.combine);break}}}const n5=new fa;class i5 extends Ts{static get type(){return"MeshBasicNodeMaterial"}constructor(e){super(),this.isMeshBasicNodeMaterial=!0,this.lights=!0,this.setDefaultValues(n5),this.setValues(e)}setupNormal(){return el}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new hN(t):null}setupLightMap(e){let t=null;return e.material.lightMap&&(t=new t5(iN)),t}setupOutgoingLight(){return jn.rgb}setupLightingModel(){return new dO}}const Wg=ge(({f0:r,f90:e,dotVH:t})=>{const n=t.mul(-5.55473).sub(6.98316).mul(t).exp2();return r.mul(n.oneMinus()).add(e.mul(n))}),pp=ge(r=>r.diffuseColor.mul(1/Math.PI)),s5=()=>K(.25),r5=ge(({dotNH:r})=>Mb.mul(K(.5)).add(1).mul(K(1/Math.PI)).mul(r.pow(Mb))),a5=ge(({lightDirection:r})=>{const e=r.add(Ii).normalize(),t=cs.dot(e).clamp(),n=Ii.dot(e).clamp(),i=Wg({f0:Oa,f90:1,dotVH:n}),s=s5(),a=r5({dotNH:t});return i.mul(s).mul(a)});class pO extends dO{constructor(e=!0){super(),this.specular=e}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=cs.dot(e).clamp().mul(t);n.directDiffuse.addAssign(s.mul(pp({diffuseColor:jn.rgb}))),this.specular===!0&&n.directSpecular.addAssign(s.mul(a5({lightDirection:e})).mul(c_))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(n.mul(pp({diffuseColor:jn}))),i.indirectDiffuse.mulAssign(t)}}const o5=new tR;class l5 extends Ts{static get type(){return"MeshLambertNodeMaterial"}constructor(e){super(),this.isMeshLambertNodeMaterial=!0,this.lights=!0,this.setDefaultValues(o5),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new hN(t):null}setupLightingModel(){return new pO(!1)}}const u5=new J1;class c5 extends Ts{static get type(){return"MeshPhongNodeMaterial"}constructor(e){super(),this.isMeshPhongNodeMaterial=!0,this.lights=!0,this.shininessNode=null,this.specularNode=null,this.setDefaultValues(u5),this.setValues(e)}setupEnvironment(e){const t=super.setupEnvironment(e);return t?new hN(t):null}setupLightingModel(){return new pO}setupVariants(){const e=(this.shininessNode?K(this.shininessNode):xB).max(1e-4);Mb.assign(e);const t=this.specularNode||bB;Oa.assign(t)}copy(e){return this.shininessNode=e.shininessNode,this.specularNode=e.specularNode,super.copy(e)}}const mO=ge(r=>{if(r.geometry.hasAttribute("normal")===!1)return K(0);const e=el.dFdx().abs().max(el.dFdy().abs());return e.x.max(e.y).max(e.z)}),fN=ge(r=>{const{roughness:e}=r,t=mO();let n=e.max(.0525);return n=n.add(t),n=n.min(1),n}),gO=ge(({alpha:r,dotNL:e,dotNV:t})=>{const n=r.pow2(),i=e.mul(n.add(n.oneMinus().mul(t.pow2())).sqrt()),s=t.mul(n.add(n.oneMinus().mul(e.pow2())).sqrt());return kl(.5,i.add(s).max($3))}).setLayout({name:"V_GGX_SmithCorrelated",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNL",type:"float"},{name:"dotNV",type:"float"}]}),h5=ge(({alphaT:r,alphaB:e,dotTV:t,dotBV:n,dotTL:i,dotBL:s,dotNV:a,dotNL:l})=>{const c=l.mul(ae(r.mul(t),e.mul(n),a).length()),d=a.mul(ae(r.mul(i),e.mul(s),l).length());return kl(.5,c.add(d)).saturate()}).setLayout({name:"V_GGX_SmithCorrelated_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotTV",type:"float",qualifier:"in"},{name:"dotBV",type:"float",qualifier:"in"},{name:"dotTL",type:"float",qualifier:"in"},{name:"dotBL",type:"float",qualifier:"in"},{name:"dotNV",type:"float",qualifier:"in"},{name:"dotNL",type:"float",qualifier:"in"}]}),yO=ge(({alpha:r,dotNH:e})=>{const t=r.pow2(),n=e.pow2().mul(t.oneMinus()).oneMinus();return t.div(n.pow2()).mul(1/Math.PI)}).setLayout({name:"D_GGX",type:"float",inputs:[{name:"alpha",type:"float"},{name:"dotNH",type:"float"}]}),f5=K(1/Math.PI),d5=ge(({alphaT:r,alphaB:e,dotNH:t,dotTH:n,dotBH:i})=>{const s=r.mul(e),a=ae(e.mul(n),r.mul(i),s.mul(t)),l=a.dot(a),c=s.div(l);return f5.mul(s.mul(c.pow2()))}).setLayout({name:"D_GGX_Anisotropic",type:"float",inputs:[{name:"alphaT",type:"float",qualifier:"in"},{name:"alphaB",type:"float",qualifier:"in"},{name:"dotNH",type:"float",qualifier:"in"},{name:"dotTH",type:"float",qualifier:"in"},{name:"dotBH",type:"float",qualifier:"in"}]}),t1=ge(r=>{const{lightDirection:e,f0:t,f90:n,roughness:i,f:s,USE_IRIDESCENCE:a,USE_ANISOTROPY:l}=r,c=r.normalView||cs,d=i.pow2(),m=e.add(Ii).normalize(),y=c.dot(e).clamp(),v=c.dot(Ii).clamp(),x=c.dot(m).clamp(),S=Ii.dot(m).clamp();let A=Wg({f0:t,f90:n,dotVH:S}),E,M;if(N_(a)&&(A=FT.mix(A,s)),N_(l)){const C=o_.dot(e),w=o_.dot(Ii),D=o_.dot(m),z=Wd.dot(e),B=Wd.dot(Ii),F=Wd.dot(m);E=h5({alphaT:Tb,alphaB:d,dotTV:w,dotBV:B,dotTL:C,dotBL:z,dotNV:v,dotNL:y}),M=d5({alphaT:Tb,alphaB:d,dotNH:x,dotTH:D,dotBH:F})}else E=gO({alpha:d,dotNL:y,dotNV:v}),M=yO({alpha:d,dotNH:x});return A.mul(E).mul(M)}),dN=ge(({roughness:r,dotNV:e})=>{const t=Dt(-1,-.0275,-.572,.022),n=Dt(1,.0425,1.04,-.04),i=r.mul(t).add(n),s=i.x.mul(i.x).min(e.mul(-9.28).exp2()).mul(i.x).add(i.y);return Qe(-1.04,1.04).mul(s).add(i.zw)}).setLayout({name:"DFGApprox",type:"vec2",inputs:[{name:"roughness",type:"float"},{name:"dotNV",type:"vec3"}]}),vO=ge(r=>{const{dotNV:e,specularColor:t,specularF90:n,roughness:i}=r,s=dN({dotNV:e,roughness:i});return t.mul(s.x).add(n.mul(s.y))}),_O=ge(({f:r,f90:e,dotVH:t})=>{const n=t.oneMinus().saturate(),i=n.mul(n),s=n.mul(i,i).clamp(0,.9999);return r.sub(ae(e).mul(s)).div(s.oneMinus())}).setLayout({name:"Schlick_to_F0",type:"vec3",inputs:[{name:"f",type:"vec3"},{name:"f90",type:"float"},{name:"dotVH",type:"float"}]}),p5=ge(({roughness:r,dotNH:e})=>{const t=r.pow2(),n=K(1).div(t),s=e.pow2().oneMinus().max(.0078125);return K(2).add(n).mul(s.pow(n.mul(.5))).div(2*Math.PI)}).setLayout({name:"D_Charlie",type:"float",inputs:[{name:"roughness",type:"float"},{name:"dotNH",type:"float"}]}),m5=ge(({dotNV:r,dotNL:e})=>K(1).div(K(4).mul(e.add(r).sub(e.mul(r))))).setLayout({name:"V_Neubelt",type:"float",inputs:[{name:"dotNV",type:"float"},{name:"dotNL",type:"float"}]}),g5=ge(({lightDirection:r})=>{const e=r.add(Ii).normalize(),t=cs.dot(r).clamp(),n=cs.dot(Ii).clamp(),i=cs.dot(e).clamp(),s=p5({roughness:IT,dotNH:i}),a=m5({dotNV:n,dotNL:t});return Id.mul(s).mul(a)}),y5=ge(({N:r,V:e,roughness:t})=>{const s=.0078125,a=r.dot(e).saturate(),l=Qe(t,a.oneMinus().sqrt());return l.assign(l.mul(.984375).add(s)),l}).setLayout({name:"LTC_Uv",type:"vec2",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"roughness",type:"float"}]}),v5=ge(({f:r})=>{const e=r.length();return fs(e.mul(e).add(r.z).div(e.add(1)),0)}).setLayout({name:"LTC_ClippedSphereFormFactor",type:"float",inputs:[{name:"f",type:"vec3"}]}),DS=ge(({v1:r,v2:e})=>{const t=r.dot(e),n=t.abs().toVar(),i=n.mul(.0145206).add(.4965155).mul(n).add(.8543985).toVar(),s=n.add(4.1616724).mul(n).add(3.417594).toVar(),a=i.div(s),l=t.greaterThan(0).select(a,fs(t.mul(t).oneMinus(),1e-7).inverseSqrt().mul(.5).sub(a));return r.cross(e).mul(l)}).setLayout({name:"LTC_EdgeVectorFormFactor",type:"vec3",inputs:[{name:"v1",type:"vec3"},{name:"v2",type:"vec3"}]}),n2=ge(({N:r,V:e,P:t,mInv:n,p0:i,p1:s,p2:a,p3:l})=>{const c=s.sub(i).toVar(),d=l.sub(i).toVar(),m=c.cross(d),y=ae().toVar();return ln(m.dot(t.sub(i)).greaterThanEqual(0),()=>{const v=e.sub(r.mul(e.dot(r))).normalize(),x=r.cross(v).negate(),S=n.mul(kr(v,x,r).transpose()).toVar(),A=S.mul(i.sub(t)).normalize().toVar(),E=S.mul(s.sub(t)).normalize().toVar(),M=S.mul(a.sub(t)).normalize().toVar(),C=S.mul(l.sub(t)).normalize().toVar(),w=ae(0).toVar();w.addAssign(DS({v1:A,v2:E})),w.addAssign(DS({v1:E,v2:M})),w.addAssign(DS({v1:M,v2:C})),w.addAssign(DS({v1:C,v2:A})),y.assign(ae(v5({f:w})))}),y}).setLayout({name:"LTC_Evaluate",type:"vec3",inputs:[{name:"N",type:"vec3"},{name:"V",type:"vec3"},{name:"P",type:"vec3"},{name:"mInv",type:"mat3"},{name:"p0",type:"vec3"},{name:"p1",type:"vec3"},{name:"p2",type:"vec3"},{name:"p3",type:"vec3"}]}),JT=1/6,xO=r=>tn(JT,tn(r,tn(r,r.negate().add(3)).sub(3)).add(1)),n1=r=>tn(JT,tn(r,tn(r,tn(3,r).sub(6))).add(4)),SO=r=>tn(JT,tn(r,tn(r,tn(-3,r).add(3)).add(3)).add(1)),i1=r=>tn(JT,Pl(r,3)),i2=r=>xO(r).add(n1(r)),s2=r=>SO(r).add(i1(r)),r2=r=>bs(-1,n1(r).div(xO(r).add(n1(r)))),a2=r=>bs(1,i1(r).div(SO(r).add(i1(r)))),o2=(r,e,t)=>{const n=r.uvNode,i=tn(n,e.zw).add(.5),s=Bu(i),a=kc(i),l=i2(a.x),c=s2(a.x),d=r2(a.x),m=a2(a.x),y=r2(a.y),v=a2(a.y),x=Qe(s.x.add(d),s.y.add(y)).sub(.5).mul(e.xy),S=Qe(s.x.add(m),s.y.add(y)).sub(.5).mul(e.xy),A=Qe(s.x.add(d),s.y.add(v)).sub(.5).mul(e.xy),E=Qe(s.x.add(m),s.y.add(v)).sub(.5).mul(e.xy),M=i2(a.y).mul(bs(l.mul(r.sample(x).level(t)),c.mul(r.sample(S).level(t)))),C=s2(a.y).mul(bs(l.mul(r.sample(A).level(t)),c.mul(r.sample(E).level(t))));return M.add(C)},bO=ge(([r,e=K(3)])=>{const t=Qe(r.size(ee(e))),n=Qe(r.size(ee(e.add(1)))),i=kl(1,t),s=kl(1,n),a=o2(r,Dt(i,t),Bu(e)),l=o2(r,Dt(s,n),VT(e));return kc(e).mix(a,l)}),l2=ge(([r,e,t,n,i])=>{const s=ae(XR(e.negate(),Gc(r),kl(1,n))),a=ae(Bc(i[0].xyz),Bc(i[1].xyz),Bc(i[2].xyz));return Gc(s).mul(t.mul(a))}).setLayout({name:"getVolumeTransmissionRay",type:"vec3",inputs:[{name:"n",type:"vec3"},{name:"v",type:"vec3"},{name:"thickness",type:"float"},{name:"ior",type:"float"},{name:"modelMatrix",type:"mat4"}]}),_5=ge(([r,e])=>r.mul(zu(e.mul(2).sub(2),0,1))).setLayout({name:"applyIorToRoughness",type:"float",inputs:[{name:"roughness",type:"float"},{name:"ior",type:"float"}]}),x5=rN(),S5=rN(),u2=ge(([r,e,t],{material:n})=>{const s=(n.side===Ti?x5:S5).sample(r),a=Lu(O_.x).mul(_5(e,t));return bO(s,a)}),c2=ge(([r,e,t])=>(ln(t.notEqual(0),()=>{const n=zT(e).negate().div(t);return FR(n.negate().mul(r))}),ae(1))).setLayout({name:"volumeAttenuation",type:"vec3",inputs:[{name:"transmissionDistance",type:"float"},{name:"attenuationColor",type:"vec3"},{name:"attenuationDistance",type:"float"}]}),b5=ge(([r,e,t,n,i,s,a,l,c,d,m,y,v,x,S])=>{let A,E;if(S){A=Dt().toVar(),E=ae().toVar();const z=m.sub(1).mul(S.mul(.025)),B=ae(m.sub(z),m,m.add(z));ti({start:0,end:3},({i:F})=>{const H=B.element(F),I=l2(r,e,y,H,l),P=a.add(I),Z=d.mul(c.mul(Dt(P,1))),ue=Qe(Z.xy.div(Z.w)).toVar();ue.addAssign(1),ue.divAssign(2),ue.assign(Qe(ue.x,ue.y.oneMinus()));const se=u2(ue,t,H);A.element(F).assign(se.element(F)),A.a.addAssign(se.a),E.element(F).assign(n.element(F).mul(c2(Bc(I),v,x).element(F)))}),A.a.divAssign(3)}else{const z=l2(r,e,y,m,l),B=a.add(z),F=d.mul(c.mul(Dt(B,1))),H=Qe(F.xy.div(F.w)).toVar();H.addAssign(1),H.divAssign(2),H.assign(Qe(H.x,H.y.oneMinus())),A=u2(H,t,m),E=n.mul(c2(Bc(z),v,x))}const M=E.rgb.mul(A.rgb),C=r.dot(e).clamp(),w=ae(vO({dotNV:C,specularColor:i,specularF90:s,roughness:t})),D=E.r.add(E.g,E.b).div(3);return Dt(w.oneMinus().mul(M),A.a.oneMinus().mul(D).oneMinus())}),T5=kr(3.2404542,-.969266,.0556434,-1.5371385,1.8760108,-.2040259,-.4985314,.041556,1.0572252),M5=r=>{const e=r.sqrt();return ae(1).add(e).div(ae(1).sub(e))},h2=(r,e)=>r.sub(e).div(r.add(e)).pow2(),E5=(r,e)=>{const t=r.mul(2*Math.PI*1e-9),n=ae(54856e-17,44201e-17,52481e-17),i=ae(1681e3,1795300,2208400),s=ae(43278e5,93046e5,66121e5),a=K(9747e-17*Math.sqrt(2*Math.PI*45282e5)).mul(t.mul(2239900).add(e.x).cos()).mul(t.pow2().mul(-45282e5).exp());let l=n.mul(s.mul(2*Math.PI).sqrt()).mul(i.mul(t).add(e).cos()).mul(t.pow2().negate().mul(s).exp());return l=ae(l.x.add(a),l.y,l.z).div(10685e-11),T5.mul(l)},A5=ge(({outsideIOR:r,eta2:e,cosTheta1:t,thinFilmThickness:n,baseF0:i})=>{const s=ei(r,e,Vu(0,.03,n)),l=r.div(s).pow2().mul(t.pow2().oneMinus()).oneMinus();ln(l.lessThan(0),()=>ae(1));const c=l.sqrt(),d=h2(s,r),m=Wg({f0:d,f90:1,dotVH:t}),y=m.oneMinus(),v=s.lessThan(r).select(Math.PI,0),x=K(Math.PI).sub(v),S=M5(i.clamp(0,.9999)),A=h2(S,s.toVec3()),E=Wg({f0:A,f90:1,dotVH:c}),M=ae(S.x.lessThan(s).select(Math.PI,0),S.y.lessThan(s).select(Math.PI,0),S.z.lessThan(s).select(Math.PI,0)),C=s.mul(n,c,2),w=ae(x).add(M),D=m.mul(E).clamp(1e-5,.9999),z=D.sqrt(),B=y.pow2().mul(E).div(ae(1).sub(D)),H=m.add(B).toVar(),I=B.sub(y).toVar();return ti({start:1,end:2,condition:"<=",name:"m"},({m:P})=>{I.mulAssign(z);const Z=E5(K(P).mul(C),K(P).mul(w)).mul(2);H.addAssign(I.mul(Z))}),H.max(ae(0))}).setLayout({name:"evalIridescence",type:"vec3",inputs:[{name:"outsideIOR",type:"float"},{name:"eta2",type:"float"},{name:"cosTheta1",type:"float"},{name:"thinFilmThickness",type:"float"},{name:"baseF0",type:"vec3"}]}),R5=ge(({normal:r,viewDir:e,roughness:t})=>{const n=r.dot(e).saturate(),i=t.pow2(),s=Sr(t.lessThan(.25),K(-339.2).mul(i).add(K(161.4).mul(t)).sub(25.9),K(-8.48).mul(i).add(K(14.3).mul(t)).sub(9.95)),a=Sr(t.lessThan(.25),K(44).mul(i).sub(K(23.7).mul(t)).add(3.26),K(1.97).mul(i).sub(K(3.27).mul(t)).add(.72));return Sr(t.lessThan(.25),0,K(.1).mul(t).sub(.025)).add(s.mul(n).add(a).exp()).mul(1/Math.PI).saturate()}),LE=ae(.04),BE=K(1);class TO extends QT{constructor(e=!1,t=!1,n=!1,i=!1,s=!1,a=!1){super(),this.clearcoat=e,this.sheen=t,this.iridescence=n,this.anisotropy=i,this.transmission=s,this.dispersion=a,this.clearcoatRadiance=null,this.clearcoatSpecularDirect=null,this.clearcoatSpecularIndirect=null,this.sheenSpecularDirect=null,this.sheenSpecularIndirect=null,this.iridescenceFresnel=null,this.iridescenceF0=null}start(e){if(this.clearcoat===!0&&(this.clearcoatRadiance=ae().toVar("clearcoatRadiance"),this.clearcoatSpecularDirect=ae().toVar("clearcoatSpecularDirect"),this.clearcoatSpecularIndirect=ae().toVar("clearcoatSpecularIndirect")),this.sheen===!0&&(this.sheenSpecularDirect=ae().toVar("sheenSpecularDirect"),this.sheenSpecularIndirect=ae().toVar("sheenSpecularIndirect")),this.iridescence===!0){const t=cs.dot(Ii).clamp();this.iridescenceFresnel=A5({outsideIOR:K(1),eta2:wR,cosTheta1:t,thinFilmThickness:DR,baseF0:Oa}),this.iridescenceF0=_O({f:this.iridescenceFresnel,f90:1,dotVH:t})}if(this.transmission===!0){const t=Oc,n=eB.sub(Oc).normalize(),i=YT,s=e.context;s.backdrop=b5(i,n,Du,jn,Oa,L_,t,Zo,Za,Rp,l_,UR,BR,LR,this.dispersion?OR:null),s.backdropAlpha=Eb,jn.a.mulAssign(ei(1,s.backdrop.a,Eb))}super.start(e)}computeMultiscattering(e,t,n){const i=cs.dot(Ii).clamp(),s=dN({roughness:Du,dotNV:i}),l=(this.iridescenceF0?FT.mix(Oa,this.iridescenceF0):Oa).mul(s.x).add(n.mul(s.y)),d=s.x.add(s.y).oneMinus(),m=Oa.add(Oa.oneMinus().mul(.047619)),y=l.mul(m).div(d.mul(m).oneMinus());e.addAssign(l),t.addAssign(y.mul(d))}direct({lightDirection:e,lightColor:t,reflectedLight:n}){const s=cs.dot(e).clamp().mul(t);if(this.sheen===!0&&this.sheenSpecularDirect.addAssign(s.mul(g5({lightDirection:e}))),this.clearcoat===!0){const l=fg.dot(e).clamp().mul(t);this.clearcoatSpecularDirect.addAssign(l.mul(t1({lightDirection:e,f0:LE,f90:BE,roughness:U_,normalView:fg})))}n.directDiffuse.addAssign(s.mul(pp({diffuseColor:jn.rgb}))),n.directSpecular.addAssign(s.mul(t1({lightDirection:e,f0:Oa,f90:1,roughness:Du,iridescence:this.iridescence,f:this.iridescenceFresnel,USE_IRIDESCENCE:this.iridescence,USE_ANISOTROPY:this.anisotropy})))}directRectArea({lightColor:e,lightPosition:t,halfWidth:n,halfHeight:i,reflectedLight:s,ltc_1:a,ltc_2:l}){const c=t.add(n).sub(i),d=t.sub(n).sub(i),m=t.sub(n).add(i),y=t.add(n).add(i),v=cs,x=Ii,S=xs.toVar(),A=y5({N:v,V:x,roughness:Du}),E=a.sample(A).toVar(),M=l.sample(A).toVar(),C=kr(ae(E.x,0,E.y),ae(0,1,0),ae(E.z,0,E.w)).toVar(),w=Oa.mul(M.x).add(Oa.oneMinus().mul(M.y)).toVar();s.directSpecular.addAssign(e.mul(w).mul(n2({N:v,V:x,P:S,mInv:C,p0:c,p1:d,p2:m,p3:y}))),s.directDiffuse.addAssign(e.mul(jn).mul(n2({N:v,V:x,P:S,mInv:kr(1,0,0,0,1,0,0,0,1),p0:c,p1:d,p2:m,p3:y})))}indirect(e){this.indirectDiffuse(e),this.indirectSpecular(e),this.ambientOcclusion(e)}indirectDiffuse(e){const{irradiance:t,reflectedLight:n}=e.context;n.indirectDiffuse.addAssign(t.mul(pp({diffuseColor:jn})))}indirectSpecular(e){const{radiance:t,iblIrradiance:n,reflectedLight:i}=e.context;if(this.sheen===!0&&this.sheenSpecularIndirect.addAssign(n.mul(Id,R5({normal:cs,viewDir:Ii,roughness:IT}))),this.clearcoat===!0){const m=fg.dot(Ii).clamp(),y=vO({dotNV:m,specularColor:LE,specularF90:BE,roughness:U_});this.clearcoatSpecularIndirect.addAssign(this.clearcoatRadiance.mul(y))}const s=ae().toVar("singleScattering"),a=ae().toVar("multiScattering"),l=n.mul(1/Math.PI);this.computeMultiscattering(s,a,L_);const c=s.add(a),d=jn.mul(c.r.max(c.g).max(c.b).oneMinus());i.indirectSpecular.addAssign(t.mul(s)),i.indirectSpecular.addAssign(a.mul(l)),i.indirectDiffuse.addAssign(d.mul(l))}ambientOcclusion(e){const{ambientOcclusion:t,reflectedLight:n}=e.context,s=cs.dot(Ii).clamp().add(t),a=Du.mul(-16).oneMinus().negate().exp2(),l=t.sub(s.pow(a).oneMinus()).clamp();this.clearcoat===!0&&this.clearcoatSpecularIndirect.mulAssign(t),this.sheen===!0&&this.sheenSpecularIndirect.mulAssign(t),n.indirectDiffuse.mulAssign(t),n.indirectSpecular.mulAssign(l)}finish({context:e}){const{outgoingLight:t}=e;if(this.clearcoat===!0){const n=fg.dot(Ii).clamp(),i=Wg({dotVH:n,f0:LE,f90:BE}),s=t.mul(bb.mul(i).oneMinus()).add(this.clearcoatSpecularDirect.add(this.clearcoatSpecularIndirect).mul(bb));t.assign(s)}if(this.sheen===!0){const n=Id.r.max(Id.g).max(Id.b).mul(.157).oneMinus(),i=t.mul(n).add(this.sheenSpecularDirect,this.sheenSpecularIndirect);t.assign(i)}}}const f2=K(1),s1=K(-2),US=K(.8),OE=K(-1),LS=K(.4),PE=K(2),BS=K(.305),IE=K(3),d2=K(.21),N5=K(4),p2=K(4),C5=K(16),w5=ge(([r])=>{const e=ae(Ai(r)).toVar(),t=K(-1).toVar();return ln(e.x.greaterThan(e.z),()=>{ln(e.x.greaterThan(e.y),()=>{t.assign(Sr(r.x.greaterThan(0),0,3))}).Else(()=>{t.assign(Sr(r.y.greaterThan(0),1,4))})}).Else(()=>{ln(e.z.greaterThan(e.y),()=>{t.assign(Sr(r.z.greaterThan(0),2,5))}).Else(()=>{t.assign(Sr(r.y.greaterThan(0),1,4))})}),t}).setLayout({name:"getFace",type:"float",inputs:[{name:"direction",type:"vec3"}]}),D5=ge(([r,e])=>{const t=Qe().toVar();return ln(e.equal(0),()=>{t.assign(Qe(r.z,r.y).div(Ai(r.x)))}).ElseIf(e.equal(1),()=>{t.assign(Qe(r.x.negate(),r.z.negate()).div(Ai(r.y)))}).ElseIf(e.equal(2),()=>{t.assign(Qe(r.x.negate(),r.y).div(Ai(r.z)))}).ElseIf(e.equal(3),()=>{t.assign(Qe(r.z.negate(),r.y).div(Ai(r.x)))}).ElseIf(e.equal(4),()=>{t.assign(Qe(r.x.negate(),r.z).div(Ai(r.y)))}).Else(()=>{t.assign(Qe(r.x,r.y).div(Ai(r.z)))}),tn(.5,t.add(1))}).setLayout({name:"getUV",type:"vec2",inputs:[{name:"direction",type:"vec3"},{name:"face",type:"float"}]}),U5=ge(([r])=>{const e=K(0).toVar();return ln(r.greaterThanEqual(US),()=>{e.assign(f2.sub(r).mul(OE.sub(s1)).div(f2.sub(US)).add(s1))}).ElseIf(r.greaterThanEqual(LS),()=>{e.assign(US.sub(r).mul(PE.sub(OE)).div(US.sub(LS)).add(OE))}).ElseIf(r.greaterThanEqual(BS),()=>{e.assign(LS.sub(r).mul(IE.sub(PE)).div(LS.sub(BS)).add(PE))}).ElseIf(r.greaterThanEqual(d2),()=>{e.assign(BS.sub(r).mul(N5.sub(IE)).div(BS.sub(d2)).add(IE))}).Else(()=>{e.assign(K(-2).mul(Lu(tn(1.16,r))))}),e}).setLayout({name:"roughnessToMip",type:"float",inputs:[{name:"roughness",type:"float"}]}),MO=ge(([r,e])=>{const t=r.toVar();t.assign(tn(2,t).sub(1));const n=ae(t,1).toVar();return ln(e.equal(0),()=>{n.assign(n.zyx)}).ElseIf(e.equal(1),()=>{n.assign(n.xzy),n.xz.mulAssign(-1)}).ElseIf(e.equal(2),()=>{n.x.mulAssign(-1)}).ElseIf(e.equal(3),()=>{n.assign(n.zyx),n.xz.mulAssign(-1)}).ElseIf(e.equal(4),()=>{n.assign(n.xzy),n.xy.mulAssign(-1)}).ElseIf(e.equal(5),()=>{n.z.mulAssign(-1)}),n}).setLayout({name:"getDirection",type:"vec3",inputs:[{name:"uv",type:"vec2"},{name:"face",type:"float"}]}),EO=ge(([r,e,t,n,i,s])=>{const a=K(t),l=ae(e),c=zu(U5(a),s1,s),d=kc(c),m=Bu(c),y=ae(r1(r,l,m,n,i,s)).toVar();return ln(d.notEqual(0),()=>{const v=ae(r1(r,l,m.add(1),n,i,s)).toVar();y.assign(ei(y,v,d))}),y}),r1=ge(([r,e,t,n,i,s])=>{const a=K(t).toVar(),l=ae(e),c=K(w5(l)).toVar(),d=K(fs(p2.sub(a),0)).toVar();a.assign(fs(a,p2));const m=K(kg(a)).toVar(),y=Qe(D5(l,c).mul(m.sub(2)).add(1)).toVar();return ln(c.greaterThan(2),()=>{y.y.addAssign(m),c.subAssign(3)}),y.x.addAssign(c.mul(m)),y.x.addAssign(d.mul(tn(3,C5))),y.y.addAssign(tn(4,kg(s).sub(m))),y.x.mulAssign(n),y.y.mulAssign(i),r.sample(y).grad(Qe(),Qe())}),FE=ge(({envMap:r,mipInt:e,outputDirection:t,theta:n,axis:i,CUBEUV_TEXEL_WIDTH:s,CUBEUV_TEXEL_HEIGHT:a,CUBEUV_MAX_MIP:l})=>{const c=Ec(n),d=t.mul(c).add(i.cross(t).mul(vo(n))).add(i.mul(i.dot(t).mul(c.oneMinus())));return r1(r,d,e,s,a,l)}),AO=ge(({n:r,latitudinal:e,poleAxis:t,outputDirection:n,weights:i,samples:s,dTheta:a,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:m,CUBEUV_MAX_MIP:y})=>{const v=ae(Sr(e,t,HT(t,n))).toVar();ln(v.equal(ae(0)),()=>{v.assign(ae(n.z,0,n.x.negate()))}),v.assign(Gc(v));const x=ae().toVar();return x.addAssign(i.element(0).mul(FE({theta:0,axis:v,outputDirection:n,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:m,CUBEUV_MAX_MIP:y}))),ti({start:ee(1),end:r},({i:S})=>{ln(S.greaterThanEqual(s),()=>{nO()});const A=K(a.mul(K(S))).toVar();x.addAssign(i.element(S).mul(FE({theta:A.mul(-1),axis:v,outputDirection:n,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:m,CUBEUV_MAX_MIP:y}))),x.addAssign(i.element(S).mul(FE({theta:A,axis:v,outputDirection:n,mipInt:l,envMap:c,CUBEUV_TEXEL_WIDTH:d,CUBEUV_TEXEL_HEIGHT:m,CUBEUV_MAX_MIP:y})))}),Dt(x,1)}),dg=4,m2=[.125,.215,.35,.446,.526,.582],wd=20,zE=new Mp(-1,1,1,-1,0,1),L5=new us(90,1),g2=new ft;let VE=null,GE=0,HE=0;const Nd=(1+Math.sqrt(5))/2,Zm=1/Nd,y2=[new Y(-Nd,Zm,0),new Y(Nd,Zm,0),new Y(-Zm,0,Nd),new Y(Zm,0,Nd),new Y(0,Nd,-Zm),new Y(0,Nd,Zm),new Y(-1,1,-1),new Y(1,1,-1),new Y(-1,1,1),new Y(1,1,1)],B5=new Y,RO=new WeakMap,O5=[3,1,5,0,4,2],kE=MO(Vi(),Gu("faceIndex")).normalize(),pN=ae(kE.x,kE.y,kE.z);let P5=class{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._lodMeshes=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._backgroundBox=null}get _hasInitialized(){return this._renderer.hasInitialized()}fromScene(e,t=0,n=.1,i=100,s={}){const{size:a=256,position:l=B5,renderTarget:c=null}=s;if(this._setSize(a),this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromScene() called before the backend is initialized. Try using .fromSceneAsync() instead.");const m=c||this._allocateTargets();return s.renderTarget=m,this.fromSceneAsync(e,t,n,i,s),m}VE=this._renderer.getRenderTarget(),GE=this._renderer.getActiveCubeFace(),HE=this._renderer.getActiveMipmapLevel();const d=c||this._allocateTargets();return d.depthBuffer=!0,this._sceneToCubeUV(e,n,i,d,l),t>0&&this._blur(d,0,0,t),this._applyPMREM(d),this._cleanup(d),d}async fromSceneAsync(e,t=0,n=.1,i=100,s={}){return this._hasInitialized===!1&&await this._renderer.init(),this.fromScene(e,t,n,i,s)}fromEquirectangular(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromEquirectangular() called before the backend is initialized. Try using .fromEquirectangularAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTargets();return this.fromEquirectangularAsync(e,n),n}return this._fromTexture(e,t)}async fromEquirectangularAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}fromCubemap(e,t=null){if(this._hasInitialized===!1){console.warn("THREE.PMREMGenerator: .fromCubemap() called before the backend is initialized. Try using .fromCubemapAsync() instead."),this._setSizeFromTexture(e);const n=t||this._allocateTargets();return this.fromCubemapAsync(e,t),n}return this._fromTexture(e,t)}async fromCubemapAsync(e,t=null){return this._hasInitialized===!1&&await this._renderer.init(),this._fromTexture(e,t)}async compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=_2(),await this._compileMaterial(this._cubemapMaterial))}async compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=x2(),await this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose(),this._backgroundBox!==null&&(this._backgroundBox.geometry.dispose(),this._backgroundBox.material.dispose())}_setSizeFromTexture(e){e.mapping===va||e.mapping===Wa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4)}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(VE,GE,HE),e.scissorTest=!1,OS(e,0,0,e.width,e.height)}_fromTexture(e,t){this._setSizeFromTexture(e),VE=this._renderer.getRenderTarget(),GE=this._renderer.getActiveCubeFace(),HE=this._renderer.getActiveMipmapLevel();const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Zn,minFilter:Zn,generateMipmaps:!1,type:Ys,format:Ni,colorSpace:xo},i=v2(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=v2(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas,lodMeshes:this._lodMeshes}=I5(s)),this._blurMaterial=F5(s,e,t)}return i}async _compileMaterial(e){const t=new bi(this._lodPlanes[0],e);await this._renderer.compile(t,zE)}_sceneToCubeUV(e,t,n,i,s){const a=L5;a.near=t,a.far=n;const l=[1,1,1,1,-1,1],c=[1,-1,1,-1,1,-1],d=this._renderer,m=d.autoClear;d.getClearColor(g2),d.autoClear=!1;let y=this._backgroundBox;if(y===null){const S=new fa({name:"PMREM.Background",side:Ti,depthWrite:!1,depthTest:!1});y=new bi(new Hc,S)}let v=!1;const x=e.background;x?x.isColor&&(y.material.color.copy(x),e.background=null,v=!0):(y.material.color.copy(g2),v=!0),d.setRenderTarget(i),d.clear(),v&&d.render(y,a);for(let S=0;S<6;S++){const A=S%3;A===0?(a.up.set(0,l[S],0),a.position.set(s.x,s.y,s.z),a.lookAt(s.x+c[S],s.y,s.z)):A===1?(a.up.set(0,0,l[S]),a.position.set(s.x,s.y,s.z),a.lookAt(s.x,s.y+c[S],s.z)):(a.up.set(0,l[S],0),a.position.set(s.x,s.y,s.z),a.lookAt(s.x,s.y,s.z+c[S]));const E=this._cubeSize;OS(i,A*E,S>2?E:0,E,E),d.render(e,a)}d.autoClear=m,e.background=x}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===va||e.mapping===Wa;i?this._cubemapMaterial===null&&(this._cubemapMaterial=_2(e)):this._equirectMaterial===null&&(this._equirectMaterial=x2(e));const s=i?this._cubemapMaterial:this._equirectMaterial;s.fragmentNode.value=e;const a=this._lodMeshes[0];a.material=s;const l=this._cubeSize;OS(t,0,0,3*l,2*l),n.setRenderTarget(t),n.render(a,zE)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),l=y2[(i-s-1)%y2.length];this._blur(e,s-1,s,a,l)}t.autoClear=n}_blur(e,t,n,i,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",s),this._halfBlur(a,e,n,n,i,"longitudinal",s)}_halfBlur(e,t,n,i,s,a,l){const c=this._renderer,d=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const m=3,y=this._lodMeshes[i];y.material=d;const v=RO.get(d),x=this._sizeLods[n]-1,S=isFinite(s)?Math.PI/(2*x):2*Math.PI/(2*wd-1),A=s/S,E=isFinite(s)?1+Math.floor(m*A):wd;E>wd&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${E} samples when the maximum is set to ${wd}`);const M=[];let C=0;for(let F=0;F<wd;++F){const H=F/A,I=Math.exp(-H*H/2);M.push(I),F===0?C+=I:F<E&&(C+=2*I)}for(let F=0;F<M.length;F++)M[F]=M[F]/C;e.texture.frame=(e.texture.frame||0)+1,v.envMap.value=e.texture,v.samples.value=E,v.weights.array=M,v.latitudinal.value=a==="latitudinal"?1:0,l&&(v.poleAxis.value=l);const{_lodMax:w}=this;v.dTheta.value=S,v.mipInt.value=w-n;const D=this._sizeLods[i],z=3*D*(i>w-dg?i-w+dg:0),B=4*(this._cubeSize-D);OS(t,z,B,3*D,2*D),c.setRenderTarget(t),c.render(y,zE)}};function I5(r){const e=[],t=[],n=[],i=[];let s=r;const a=r-dg+1+m2.length;for(let l=0;l<a;l++){const c=Math.pow(2,s);t.push(c);let d=1/c;l>r-dg?d=m2[l-r+dg-1]:l===0&&(d=0),n.push(d);const m=1/(c-2),y=-m,v=1+m,x=[y,y,v,y,v,v,y,y,v,v,y,v],S=6,A=6,E=3,M=2,C=1,w=new Float32Array(E*A*S),D=new Float32Array(M*A*S),z=new Float32Array(C*A*S);for(let F=0;F<S;F++){const H=F%3*2/3-1,I=F>2?0:-1,P=[H,I,0,H+2/3,I,0,H+2/3,I+1,0,H,I,0,H+2/3,I+1,0,H,I+1,0],Z=O5[F];w.set(P,E*A*Z),D.set(x,M*A*Z);const ue=[Z,Z,Z,Z,Z,Z];z.set(ue,C*A*Z)}const B=new fn;B.setAttribute("position",new Kn(w,E)),B.setAttribute("uv",new Kn(D,M)),B.setAttribute("faceIndex",new Kn(z,C)),e.push(B),i.push(new bi(B,null)),s>dg&&s--}return{lodPlanes:e,sizeLods:t,sigmas:n,lodMeshes:i}}function v2(r,e,t){const n=new tl(r,e,t);return n.texture.mapping=Ic,n.texture.name="PMREM.cubeUv",n.texture.isPMREMTexture=!0,n.scissorTest=!0,n}function OS(r,e,t,n,i){r.viewport.set(e,t,n,i),r.scissor.set(e,t,n,i)}function mN(r){const e=new Ts;return e.depthTest=!1,e.depthWrite=!1,e.blending=Ga,e.name=`PMREM_${r}`,e}function F5(r,e,t){const n=Bl(new Array(wd).fill(0)),i=Ct(new Y(0,1,0)),s=Ct(0),a=K(wd),l=Ct(0),c=Ct(1),d=En(null),m=Ct(0),y=K(1/e),v=K(1/t),x=K(r),S={n:a,latitudinal:l,weights:n,poleAxis:i,outputDirection:pN,dTheta:s,samples:c,envMap:d,mipInt:m,CUBEUV_TEXEL_WIDTH:y,CUBEUV_TEXEL_HEIGHT:v,CUBEUV_MAX_MIP:x},A=mN("blur");return A.fragmentNode=AO({...S,latitudinal:l.equal(1)}),RO.set(A,S),A}function _2(r){const e=mN("cubemap");return e.fragmentNode=qg(r,pN),e}function x2(r){const e=mN("equirect");return e.fragmentNode=En(r,cN(pN),0),e}const S2=new WeakMap;function z5(r){const e=Math.log2(r)-2,t=1/r;return{texelWidth:1/(3*Math.max(Math.pow(2,e),7*16)),texelHeight:t,maxMip:e}}function V5(r,e,t){const n=G5(e);let i=n.get(r);if((i!==void 0?i.pmremVersion:-1)!==r.pmremVersion){const a=r.image;if(r.isCubeTexture)if(k5(a))i=t.fromCubemap(r,i);else return null;else if(q5(a))i=t.fromEquirectangular(r,i);else return null;i.pmremVersion=r.pmremVersion,n.set(r,i)}return i.texture}function G5(r){let e=S2.get(r);return e===void 0&&(e=new WeakMap,S2.set(r,e)),e}class H5 extends es{static get type(){return"PMREMNode"}constructor(e,t=null,n=null){super("vec3"),this._value=e,this._pmrem=null,this.uvNode=t,this.levelNode=n,this._generator=null;const i=new Li;i.isRenderTargetTexture=!0,this._texture=En(i),this._width=Ct(0),this._height=Ct(0),this._maxMip=Ct(0),this.updateBeforeType=en.RENDER}set value(e){this._value=e,this._pmrem=null}get value(){return this._value}updateFromTexture(e){const t=z5(e.image.height);this._texture.value=e,this._width.value=t.texelWidth,this._height.value=t.texelHeight,this._maxMip.value=t.maxMip}updateBefore(e){let t=this._pmrem;const n=t?t.pmremVersion:-1,i=this._value;n!==i.pmremVersion&&(i.isPMREMTexture===!0?t=i:t=V5(i,e.renderer,this._generator),t!==null&&(this._pmrem=t,this.updateFromTexture(t)))}setup(e){this._generator===null&&(this._generator=new P5(e.renderer)),this.updateBefore(e);let t=this.uvNode;t===null&&e.context.getUV&&(t=e.context.getUV(this)),t=eN.mul(ae(t.x,t.y.negate(),t.z));let n=this.levelNode;return n===null&&e.context.getTextureLevel&&(n=e.context.getTextureLevel(this)),EO(this._texture,t,n,this._width,this._height,this._maxMip)}dispose(){super.dispose(),this._generator!==null&&this._generator.dispose()}}function k5(r){if(r==null)return!1;let e=0;const t=6;for(let n=0;n<t;n++)r[n]!==void 0&&e++;return e===t}function q5(r){return r==null?!1:r.height>0}const gN=Ve(H5).setParameterLength(1,3),b2=new WeakMap;class W5 extends ry{static get type(){return"EnvironmentNode"}constructor(e=null){super(),this.envNode=e}setup(e){const{material:t}=e;let n=this.envNode;if(n.isTextureNode||n.isMaterialReferenceNode){const y=n.isTextureNode?n.value:t[n.property];let v=b2.get(y);v===void 0&&(v=gN(y),b2.set(y,v)),n=v}const s=t.useAnisotropy===!0||t.anisotropy>0?gB:cs,a=n.context(T2(Du,s)).mul(sb),l=n.context(X5(YT)).mul(Math.PI).mul(sb),c=u_(a),d=u_(l);e.context.radiance.addAssign(c),e.context.iblIrradiance.addAssign(d);const m=e.context.lightingModel.clearcoatRadiance;if(m){const y=n.context(T2(U_,fg)).mul(sb),v=u_(y);m.addAssign(v)}}}const T2=(r,e)=>{let t=null;return{getUV:()=>(t===null&&(t=Ii.negate().reflect(e),t=r.mul(r).mix(t,e).normalize(),t=t.transformDirection(Za)),t),getTextureLevel:()=>r}},X5=r=>({getUV:()=>r,getTextureLevel:()=>K(1)}),Y5=new NT;class NO extends Ts{static get type(){return"MeshStandardNodeMaterial"}constructor(e){super(),this.isMeshStandardNodeMaterial=!0,this.lights=!0,this.emissiveNode=null,this.metalnessNode=null,this.roughnessNode=null,this.setDefaultValues(Y5),this.setValues(e)}setupEnvironment(e){let t=super.setupEnvironment(e);return t===null&&e.environmentNode&&(t=e.environmentNode),t?new W5(t):null}setupLightingModel(){return new TO}setupSpecular(){const e=ei(ae(.04),jn.rgb,D_);Oa.assign(e),L_.assign(1)}setupVariants(){const e=this.metalnessNode?K(this.metalnessNode):EB;D_.assign(e);let t=this.roughnessNode?K(this.roughnessNode):MB;t=fN({roughness:t}),Du.assign(t),this.setupSpecular(),jn.assign(Dt(jn.rgb.mul(e.oneMinus()),jn.a))}copy(e){return this.emissiveNode=e.emissiveNode,this.metalnessNode=e.metalnessNode,this.roughnessNode=e.roughnessNode,super.copy(e)}}const j5=new Q1;class CO extends NO{static get type(){return"MeshPhysicalNodeMaterial"}constructor(e){super(),this.isMeshPhysicalNodeMaterial=!0,this.clearcoatNode=null,this.clearcoatRoughnessNode=null,this.clearcoatNormalNode=null,this.sheenNode=null,this.sheenRoughnessNode=null,this.iridescenceNode=null,this.iridescenceIORNode=null,this.iridescenceThicknessNode=null,this.specularIntensityNode=null,this.specularColorNode=null,this.iorNode=null,this.transmissionNode=null,this.thicknessNode=null,this.attenuationDistanceNode=null,this.attenuationColorNode=null,this.dispersionNode=null,this.anisotropyNode=null,this.setDefaultValues(j5),this.setValues(e)}get useClearcoat(){return this.clearcoat>0||this.clearcoatNode!==null}get useIridescence(){return this.iridescence>0||this.iridescenceNode!==null}get useSheen(){return this.sheen>0||this.sheenNode!==null}get useAnisotropy(){return this.anisotropy>0||this.anisotropyNode!==null}get useTransmission(){return this.transmission>0||this.transmissionNode!==null}get useDispersion(){return this.dispersion>0||this.dispersionNode!==null}setupSpecular(){const e=this.iorNode?K(this.iorNode):zB;l_.assign(e),Oa.assign(ei(Xa(qR(l_.sub(1).div(l_.add(1))).mul(TB),ae(1)).mul(e1),jn.rgb,D_)),L_.assign(ei(e1,1,D_))}setupLightingModel(){return new TO(this.useClearcoat,this.useSheen,this.useIridescence,this.useAnisotropy,this.useTransmission,this.useDispersion)}setupVariants(e){if(super.setupVariants(e),this.useClearcoat){const t=this.clearcoatNode?K(this.clearcoatNode):RB,n=this.clearcoatRoughnessNode?K(this.clearcoatRoughnessNode):NB;bb.assign(t),U_.assign(fN({roughness:n}))}if(this.useSheen){const t=this.sheenNode?ae(this.sheenNode):DB,n=this.sheenRoughnessNode?K(this.sheenRoughnessNode):UB;Id.assign(t),IT.assign(n)}if(this.useIridescence){const t=this.iridescenceNode?K(this.iridescenceNode):BB,n=this.iridescenceIORNode?K(this.iridescenceIORNode):OB,i=this.iridescenceThicknessNode?K(this.iridescenceThicknessNode):PB;FT.assign(t),wR.assign(n),DR.assign(i)}if(this.useAnisotropy){const t=(this.anisotropyNode?Qe(this.anisotropyNode):LB).toVar();Yh.assign(t.length()),ln(Yh.equal(0),()=>{t.assign(Qe(1,0))}).Else(()=>{t.divAssign(Qe(Yh)),Yh.assign(Yh.saturate())}),Tb.assign(Yh.pow2().mix(Du.pow2(),1)),o_.assign(Fd[0].mul(t.x).add(Fd[1].mul(t.y))),Wd.assign(Fd[1].mul(t.x).sub(Fd[0].mul(t.y)))}if(this.useTransmission){const t=this.transmissionNode?K(this.transmissionNode):IB,n=this.thicknessNode?K(this.thicknessNode):FB,i=this.attenuationDistanceNode?K(this.attenuationDistanceNode):VB,s=this.attenuationColorNode?ae(this.attenuationColorNode):GB;if(Eb.assign(t),UR.assign(n),LR.assign(i),BR.assign(s),this.useDispersion){const a=this.dispersionNode?K(this.dispersionNode):YB;OR.assign(a)}}}setupClearcoatNormal(){return this.clearcoatNormalNode?ae(this.clearcoatNormalNode):CB}setup(e){e.context.setupClearcoatNormal=()=>this.setupClearcoatNormal(e),super.setup(e)}copy(e){return this.clearcoatNode=e.clearcoatNode,this.clearcoatRoughnessNode=e.clearcoatRoughnessNode,this.clearcoatNormalNode=e.clearcoatNormalNode,this.sheenNode=e.sheenNode,this.sheenRoughnessNode=e.sheenRoughnessNode,this.iridescenceNode=e.iridescenceNode,this.iridescenceIORNode=e.iridescenceIORNode,this.iridescenceThicknessNode=e.iridescenceThicknessNode,this.specularIntensityNode=e.specularIntensityNode,this.specularColorNode=e.specularColorNode,this.transmissionNode=e.transmissionNode,this.thicknessNode=e.thicknessNode,this.attenuationDistanceNode=e.attenuationDistanceNode,this.attenuationColorNode=e.attenuationColorNode,this.dispersionNode=e.dispersionNode,this.anisotropyNode=e.anisotropyNode,super.copy(e)}}const Z5=ge(({normal:r,lightDirection:e,builder:t})=>{const n=r.dot(e),i=Qe(n.mul(.5).add(.5),0);if(t.material.gradientMap){const s=Nc("gradientMap","texture").context({getUV:()=>i});return ae(s.r)}else{const s=i.fwidth().mul(.5);return ei(ae(.7),ae(1),Vu(K(.7).sub(s.x),K(.7).add(s.x),i.x))}});class K5 extends QT{direct({lightDirection:e,lightColor:t,reflectedLight:n},i){const s=Z5({normal:WT,lightDirection:e,builder:i}).mul(t);n.directDiffuse.addAssign(s.mul(pp({diffuseColor:jn.rgb})))}indirect(e){const{ambientOcclusion:t,irradiance:n,reflectedLight:i}=e.context;i.indirectDiffuse.addAssign(n.mul(pp({diffuseColor:jn}))),i.indirectDiffuse.mulAssign(t)}}const Q5=new $1;class J5 extends Ts{static get type(){return"MeshToonNodeMaterial"}constructor(e){super(),this.isMeshToonNodeMaterial=!0,this.lights=!0,this.setDefaultValues(Q5),this.setValues(e)}setupLightingModel(){return new K5}}class $5 extends es{static get type(){return"MatcapUVNode"}constructor(){super("vec2")}setup(){const e=ae(Ii.z,0,Ii.x.negate()).normalize(),t=Ii.cross(e);return Qe(e.dot(cs),t.dot(cs)).mul(.495).add(.5)}}const wO=rt($5),e6=new sR;class t6 extends Ts{static get type(){return"MeshMatcapNodeMaterial"}constructor(e){super(),this.isMeshMatcapNodeMaterial=!0,this.setDefaultValues(e6),this.setValues(e)}setupVariants(e){const t=wO;let n;e.material.matcap?n=Nc("matcap","texture").context({getUV:()=>t}):n=ae(ei(.2,.8,t.y)),jn.rgb.mulAssign(n.rgb)}}class n6 extends es{static get type(){return"RotateNode"}constructor(e,t){super(),this.positionNode=e,this.rotationNode=t}getNodeType(e){return this.positionNode.getNodeType(e)}setup(e){const{rotationNode:t,positionNode:n}=this;if(this.getNodeType(e)==="vec2"){const s=t.cos(),a=t.sin();return OT(s,a,a.negate(),s).mul(n)}else{const s=t,a=qd(Dt(1,0,0,0),Dt(0,Ec(s.x),vo(s.x).negate(),0),Dt(0,vo(s.x),Ec(s.x),0),Dt(0,0,0,1)),l=qd(Dt(Ec(s.y),0,vo(s.y),0),Dt(0,1,0,0),Dt(vo(s.y).negate(),0,Ec(s.y),0),Dt(0,0,0,1)),c=qd(Dt(Ec(s.z),vo(s.z).negate(),0,0),Dt(vo(s.z),Ec(s.z),0,0),Dt(0,0,1,0),Dt(0,0,0,1));return a.mul(l).mul(c).mul(Dt(n,1)).xyz}}}const $T=Ve(n6).setParameterLength(2),i6=new hT;class DO extends Ts{static get type(){return"SpriteNodeMaterial"}constructor(e){super(),this.isSpriteNodeMaterial=!0,this._useSizeAttenuation=!0,this.positionNode=null,this.rotationNode=null,this.scaleNode=null,this.transparent=!0,this.setDefaultValues(i6),this.setValues(e)}setupPositionView(e){const{object:t,camera:n}=e,i=this.sizeAttenuation,{positionNode:s,rotationNode:a,scaleNode:l}=this,c=Np.mul(ae(s||0));let d=Qe(Zo[0].xyz.length(),Zo[1].xyz.length());if(l!==null&&(d=d.mul(Qe(l))),i===!1)if(n.isPerspectiveCamera)d=d.mul(c.z.negate());else{const x=K(2).div(Rp.element(1).element(1));d=d.mul(x.mul(2))}let m=a0.xy;if(t.center&&t.center.isVector2===!0){const x=dG("center","vec2",t);m=m.sub(x.sub(.5))}m=m.mul(d);const y=K(a||wB),v=$T(m,y);return Dt(c.xy.add(v),c.zw)}copy(e){return this.positionNode=e.positionNode,this.rotationNode=e.rotationNode,this.scaleNode=e.scaleNode,super.copy(e)}get sizeAttenuation(){return this._useSizeAttenuation}set sizeAttenuation(e){this._useSizeAttenuation!==e&&(this._useSizeAttenuation=e,this.needsUpdate=!0)}}const s6=new dT;class r6 extends DO{static get type(){return"PointsNodeMaterial"}constructor(e){super(),this.sizeNode=null,this.isPointsNodeMaterial=!0,this.setDefaultValues(s6),this.setValues(e)}setupPositionView(){const{positionNode:e}=this;return Np.mul(ae(e||hs)).xyz}setupVertex(e){const t=super.setupVertex(e);if(e.material.isNodeMaterial!==!0)return t;const{rotationNode:n,scaleNode:i,sizeNode:s}=this,a=a0.xy.toVar(),l=vg.z.div(vg.w);if(n&&n.isNode){const d=K(n);a.assign($T(a,d))}let c=s!==null?Qe(s):XB;return this.sizeAttenuation===!0&&(c=c.mul(c.div(xs.z.negate()))),i&&i.isNode&&(c=c.mul(Qe(i))),a.mulAssign(c.mul(2)),a.assign(a.div(vg.z)),a.y.assign(a.y.mul(l)),a.assign(a.mul(t.w)),t.addAssign(Dt(a,0,0)),t}get alphaToCoverage(){return this._useAlphaToCoverage}set alphaToCoverage(e){this._useAlphaToCoverage!==e&&(this._useAlphaToCoverage=e,this.needsUpdate=!0)}}class a6 extends QT{constructor(){super(),this.shadowNode=K(1).toVar("shadowMask")}direct({lightNode:e}){this.shadowNode.mulAssign(e.shadowNode)}finish({context:e}){jn.a.mulAssign(this.shadowNode.oneMinus()),e.outgoingLight.rgb.assign(jn.rgb)}}const o6=new K1;class l6 extends Ts{static get type(){return"ShadowNodeMaterial"}constructor(e){super(),this.isShadowNodeMaterial=!0,this.lights=!0,this.transparent=!0,this.setDefaultValues(o6),this.setValues(e)}setupLightingModel(){return new a6}}sy("vec3");sy("vec3");sy("vec3");class u6{constructor(e,t){this.nodes=e,this.info=t,this._context=self,this._animationLoop=null,this._requestId=null}start(){const e=(t,n)=>{this._requestId=this._context.requestAnimationFrame(e),this.info.autoReset===!0&&this.info.reset(),this.nodes.nodeFrame.update(),this.info.frame=this.nodes.nodeFrame.frameId,this._animationLoop!==null&&this._animationLoop(t,n)};e()}stop(){this._context.cancelAnimationFrame(this._requestId),this._requestId=null}getAnimationLoop(){return this._animationLoop}setAnimationLoop(e){this._animationLoop=e}getContext(){return this._context}setContext(e){this._context=e}dispose(){this.stop()}}class qu{constructor(){this.weakMap=new WeakMap}get(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return;return t.get(e[e.length-1])}set(e,t){let n=this.weakMap;for(let i=0;i<e.length-1;i++){const s=e[i];n.has(s)===!1&&n.set(s,new WeakMap),n=n.get(s)}return n.set(e[e.length-1],t),this}delete(e){let t=this.weakMap;for(let n=0;n<e.length-1;n++)if(t=t.get(e[n]),t===void 0)return!1;return t.delete(e[e.length-1])}}let c6=0;function h6(r){const e=Object.keys(r);let t=Object.getPrototypeOf(r);for(;t;){const n=Object.getOwnPropertyDescriptors(t);for(const i in n)if(n[i]!==void 0){const s=n[i];s&&typeof s.get=="function"&&e.push(i)}t=Object.getPrototypeOf(t)}return e}class f6{constructor(e,t,n,i,s,a,l,c,d,m){this.id=c6++,this._nodes=e,this._geometries=t,this.renderer=n,this.object=i,this.material=s,this.scene=a,this.camera=l,this.lightsNode=c,this.context=d,this.geometry=i.geometry,this.version=s.version,this.drawRange=null,this.attributes=null,this.pipeline=null,this.group=null,this.vertexBuffers=null,this.drawParams=null,this.bundle=null,this.clippingContext=m,this.clippingContextCacheKey=m!==null?m.cacheKey:"",this.initialNodesCacheKey=this.getDynamicCacheKey(),this.initialCacheKey=this.getCacheKey(),this._nodeBuilderState=null,this._bindings=null,this._monitor=null,this.onDispose=null,this.isRenderObject=!0,this.onMaterialDispose=()=>{this.dispose()},this.material.addEventListener("dispose",this.onMaterialDispose)}updateClipping(e){this.clippingContext=e}get clippingNeedsUpdate(){return this.clippingContext===null||this.clippingContext.cacheKey===this.clippingContextCacheKey?!1:(this.clippingContextCacheKey=this.clippingContext.cacheKey,!0)}get hardwareClippingPlanes(){return this.material.hardwareClipping===!0?this.clippingContext.unionClippingCount:0}getNodeBuilderState(){return this._nodeBuilderState||(this._nodeBuilderState=this._nodes.getForRender(this))}getMonitor(){return this._monitor||(this._monitor=this.getNodeBuilderState().observer)}getBindings(){return this._bindings||(this._bindings=this.getNodeBuilderState().createBindings())}getBindingGroup(e){for(const t of this.getBindings())if(t.name===e)return t}getIndex(){return this._geometries.getIndex(this)}getIndirect(){return this._geometries.getIndirect(this)}getChainArray(){return[this.object,this.material,this.context,this.lightsNode]}setGeometry(e){this.geometry=e,this.attributes=null}getAttributes(){if(this.attributes!==null)return this.attributes;const e=this.getNodeBuilderState().nodeAttributes,t=this.geometry,n=[],i=new Set;for(const s of e){const a=s.node&&s.node.attribute?s.node.attribute:t.getAttribute(s.name);if(a===void 0)continue;n.push(a);const l=a.isInterleavedBufferAttribute?a.data:a;i.add(l)}return this.attributes=n,this.vertexBuffers=Array.from(i.values()),n}getVertexBuffers(){return this.vertexBuffers===null&&this.getAttributes(),this.vertexBuffers}getDrawParameters(){const{object:e,material:t,geometry:n,group:i,drawRange:s}=this,a=this.drawParams||(this.drawParams={vertexCount:0,firstVertex:0,instanceCount:0,firstInstance:0}),l=this.getIndex(),c=l!==null,d=n.isInstancedBufferGeometry?n.instanceCount:e.count>1?e.count:1;if(d===0)return null;if(a.instanceCount=d,e.isBatchedMesh===!0)return a;let m=1;t.wireframe===!0&&!e.isPoints&&!e.isLineSegments&&!e.isLine&&!e.isLineLoop&&(m=2);let y=s.start*m,v=(s.start+s.count)*m;i!==null&&(y=Math.max(y,i.start*m),v=Math.min(v,(i.start+i.count)*m));const x=n.attributes.position;let S=1/0;c?S=l.count:x!=null&&(S=x.count),y=Math.max(y,0),v=Math.min(v,S);const A=v-y;return A<0||A===1/0?null:(a.vertexCount=A,a.firstVertex=y,a)}getGeometryCacheKey(){const{geometry:e}=this;let t="";for(const n of Object.keys(e.attributes).sort()){const i=e.attributes[n];t+=n+",",i.data&&(t+=i.data.stride+","),i.offset&&(t+=i.offset+","),i.itemSize&&(t+=i.itemSize+","),i.normalized&&(t+="n,")}for(const n of Object.keys(e.morphAttributes).sort()){const i=e.morphAttributes[n];t+="morph-"+n+",";for(let s=0,a=i.length;s<a;s++){const l=i[s];t+=l.id+","}}return e.index&&(t+="index,"),t}getMaterialCacheKey(){const{object:e,material:t}=this;let n=t.customProgramCacheKey();for(const i of h6(t)){if(/^(is[A-Z]|_)|^(visible|version|uuid|name|opacity|userData)$/.test(i))continue;const s=t[i];let a;if(s!==null){const l=typeof s;l==="number"?a=s!==0?"1":"0":l==="object"?(a="{",s.isTexture&&(a+=s.mapping),a+="}"):a=String(s)}else a=String(s);n+=a+","}return n+=this.clippingContextCacheKey+",",e.geometry&&(n+=this.getGeometryCacheKey()),e.skeleton&&(n+=e.skeleton.bones.length+","),e.isBatchedMesh&&(n+=e._matricesTexture.uuid+",",e._colorsTexture!==null&&(n+=e._colorsTexture.uuid+",")),e.count>1&&(n+=e.uuid+","),n+=e.receiveShadow+",",l3(n)}get needsGeometryUpdate(){return this.geometry.id!==this.object.geometry.id}get needsUpdate(){return this.initialNodesCacheKey!==this.getDynamicCacheKey()||this.clippingNeedsUpdate}getDynamicCacheKey(){let e=0;return this.material.isShadowPassMaterial!==!0&&(e=this._nodes.getCacheKey(this.scene,this.lightsNode)),this.camera.isArrayCamera&&(e=R_(e,this.camera.cameras.length)),this.object.receiveShadow&&(e=R_(e,1)),e}getCacheKey(){return this.getMaterialCacheKey()+this.getDynamicCacheKey()}dispose(){this.material.removeEventListener("dispose",this.onMaterialDispose),this.onDispose()}}const Sd=[];class d6{constructor(e,t,n,i,s,a){this.renderer=e,this.nodes=t,this.geometries=n,this.pipelines=i,this.bindings=s,this.info=a,this.chainMaps={}}get(e,t,n,i,s,a,l,c){const d=this.getChainMap(c);Sd[0]=e,Sd[1]=t,Sd[2]=a,Sd[3]=s;let m=d.get(Sd);return m===void 0?(m=this.createRenderObject(this.nodes,this.geometries,this.renderer,e,t,n,i,s,a,l,c),d.set(Sd,m)):(m.updateClipping(l),m.needsGeometryUpdate&&m.setGeometry(e.geometry),(m.version!==t.version||m.needsUpdate)&&(m.initialCacheKey!==m.getCacheKey()?(m.dispose(),m=this.get(e,t,n,i,s,a,l,c)):m.version=t.version)),Sd.length=0,m}getChainMap(e="default"){return this.chainMaps[e]||(this.chainMaps[e]=new qu)}dispose(){this.chainMaps={}}createRenderObject(e,t,n,i,s,a,l,c,d,m,y){const v=this.getChainMap(y),x=new f6(e,t,n,i,s,a,l,c,d,m);return x.onDispose=()=>{this.pipelines.delete(x),this.bindings.delete(x),this.nodes.delete(x),v.delete(x.getChainArray())},x}}class gf{constructor(){this.data=new WeakMap}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}delete(e){let t=null;return this.data.has(e)&&(t=this.data.get(e),this.data.delete(e)),t}has(e){return this.data.has(e)}dispose(){this.data=new WeakMap}}const Ko={VERTEX:1,INDEX:2,STORAGE:3,INDIRECT:4},Kh=16,p6=211,m6=212;class g6 extends gf{constructor(e){super(),this.backend=e}delete(e){const t=super.delete(e);return t!==null&&this.backend.destroyAttribute(e),t}update(e,t){const n=this.get(e);if(n.version===void 0)t===Ko.VERTEX?this.backend.createAttribute(e):t===Ko.INDEX?this.backend.createIndexAttribute(e):t===Ko.STORAGE?this.backend.createStorageAttribute(e):t===Ko.INDIRECT&&this.backend.createIndirectStorageAttribute(e),n.version=this._getBufferAttribute(e).version;else{const i=this._getBufferAttribute(e);(n.version<i.version||i.usage===Od)&&(this.backend.updateAttribute(e),n.version=i.version)}}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}function UO(r){return r.index!==null?r.index.version:r.attributes.position.version}function M2(r){const e=[],t=r.index,n=r.attributes.position;if(t!==null){const s=t.array;for(let a=0,l=s.length;a<l;a+=3){const c=s[a+0],d=s[a+1],m=s[a+2];e.push(c,d,d,m,m,c)}}else{const s=n.array;for(let a=0,l=s.length/3-1;a<l;a+=3){const c=a+0,d=a+1,m=a+2;e.push(c,d,d,m,m,c)}}const i=new(I1(e)?lT:oT)(e,1);return i.version=UO(r),i}class y6 extends gf{constructor(e,t){super(),this.attributes=e,this.info=t,this.wireframes=new WeakMap,this.attributeCall=new WeakMap}has(e){const t=e.geometry;return super.has(t)&&this.get(t).initialized===!0}updateForRender(e){this.has(e)===!1&&this.initGeometry(e),this.updateAttributes(e)}initGeometry(e){const t=e.geometry,n=this.get(t);n.initialized=!0,this.info.memory.geometries++;const i=()=>{this.info.memory.geometries--;const s=t.index,a=e.getAttributes();s!==null&&this.attributes.delete(s);for(const c of a)this.attributes.delete(c);const l=this.wireframes.get(t);l!==void 0&&this.attributes.delete(l),t.removeEventListener("dispose",i)};t.addEventListener("dispose",i)}updateAttributes(e){const t=e.getAttributes();for(const s of t)s.isStorageBufferAttribute||s.isStorageInstancedBufferAttribute?this.updateAttribute(s,Ko.STORAGE):this.updateAttribute(s,Ko.VERTEX);const n=this.getIndex(e);n!==null&&this.updateAttribute(n,Ko.INDEX);const i=e.geometry.indirect;i!==null&&this.updateAttribute(i,Ko.INDIRECT)}updateAttribute(e,t){const n=this.info.render.calls;e.isInterleavedBufferAttribute?this.attributeCall.get(e)===void 0?(this.attributes.update(e,t),this.attributeCall.set(e,n)):this.attributeCall.get(e.data)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e.data,n),this.attributeCall.set(e,n)):this.attributeCall.get(e)!==n&&(this.attributes.update(e,t),this.attributeCall.set(e,n))}getIndirect(e){return e.geometry.indirect}getIndex(e){const{geometry:t,material:n}=e;let i=t.index;if(n.wireframe===!0){const s=this.wireframes;let a=s.get(t);a===void 0?(a=M2(t),s.set(t,a)):a.version!==UO(t)&&(this.attributes.delete(a),a=M2(t),s.set(t,a)),i=a}return i}}class v6{constructor(){this.autoReset=!0,this.frame=0,this.calls=0,this.render={calls:0,frameCalls:0,drawCalls:0,triangles:0,points:0,lines:0,timestamp:0},this.compute={calls:0,frameCalls:0,timestamp:0},this.memory={geometries:0,textures:0}}update(e,t,n){this.render.drawCalls++,e.isMesh||e.isSprite?this.render.triangles+=n*(t/3):e.isPoints?this.render.points+=n*t:e.isLineSegments?this.render.lines+=n*(t/2):e.isLine?this.render.lines+=n*(t-1):console.error("THREE.WebGPUInfo: Unknown object type.")}reset(){this.render.drawCalls=0,this.render.frameCalls=0,this.compute.frameCalls=0,this.render.triangles=0,this.render.points=0,this.render.lines=0}dispose(){this.reset(),this.calls=0,this.render.calls=0,this.compute.calls=0,this.render.timestamp=0,this.compute.timestamp=0,this.memory.geometries=0,this.memory.textures=0}}class LO{constructor(e){this.cacheKey=e,this.usedTimes=0}}class _6 extends LO{constructor(e,t,n){super(e),this.vertexProgram=t,this.fragmentProgram=n}}class x6 extends LO{constructor(e,t){super(e),this.computeProgram=t,this.isComputePipeline=!0}}let S6=0;class qE{constructor(e,t,n,i=null,s=null){this.id=S6++,this.code=e,this.stage=t,this.name=n,this.transforms=i,this.attributes=s,this.usedTimes=0}}class b6 extends gf{constructor(e,t){super(),this.backend=e,this.nodes=t,this.bindings=null,this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}getForCompute(e,t){const{backend:n}=this,i=this.get(e);if(this._needsComputeUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.computeProgram.usedTimes--);const a=this.nodes.getForCompute(e);let l=this.programs.compute.get(a.computeShader);l===void 0&&(s&&s.computeProgram.usedTimes===0&&this._releaseProgram(s.computeProgram),l=new qE(a.computeShader,"compute",e.name,a.transforms,a.nodeAttributes),this.programs.compute.set(a.computeShader,l),n.createProgram(l));const c=this._getComputeCacheKey(e,l);let d=this.caches.get(c);d===void 0&&(s&&s.usedTimes===0&&this._releasePipeline(s),d=this._getComputePipeline(e,l,c,t)),d.usedTimes++,l.usedTimes++,i.version=e.version,i.pipeline=d}return i.pipeline}getForRender(e,t=null){const{backend:n}=this,i=this.get(e);if(this._needsRenderUpdate(e)){const s=i.pipeline;s&&(s.usedTimes--,s.vertexProgram.usedTimes--,s.fragmentProgram.usedTimes--);const a=e.getNodeBuilderState(),l=e.material?e.material.name:"";let c=this.programs.vertex.get(a.vertexShader);c===void 0&&(s&&s.vertexProgram.usedTimes===0&&this._releaseProgram(s.vertexProgram),c=new qE(a.vertexShader,"vertex",l),this.programs.vertex.set(a.vertexShader,c),n.createProgram(c));let d=this.programs.fragment.get(a.fragmentShader);d===void 0&&(s&&s.fragmentProgram.usedTimes===0&&this._releaseProgram(s.fragmentProgram),d=new qE(a.fragmentShader,"fragment",l),this.programs.fragment.set(a.fragmentShader,d),n.createProgram(d));const m=this._getRenderCacheKey(e,c,d);let y=this.caches.get(m);y===void 0?(s&&s.usedTimes===0&&this._releasePipeline(s),y=this._getRenderPipeline(e,c,d,m,t)):e.pipeline=y,y.usedTimes++,c.usedTimes++,d.usedTimes++,i.pipeline=y}return i.pipeline}delete(e){const t=this.get(e).pipeline;return t&&(t.usedTimes--,t.usedTimes===0&&this._releasePipeline(t),t.isComputePipeline?(t.computeProgram.usedTimes--,t.computeProgram.usedTimes===0&&this._releaseProgram(t.computeProgram)):(t.fragmentProgram.usedTimes--,t.vertexProgram.usedTimes--,t.vertexProgram.usedTimes===0&&this._releaseProgram(t.vertexProgram),t.fragmentProgram.usedTimes===0&&this._releaseProgram(t.fragmentProgram))),super.delete(e)}dispose(){super.dispose(),this.caches=new Map,this.programs={vertex:new Map,fragment:new Map,compute:new Map}}updateForRender(e){this.getForRender(e)}_getComputePipeline(e,t,n,i){n=n||this._getComputeCacheKey(e,t);let s=this.caches.get(n);return s===void 0&&(s=new x6(n,t),this.caches.set(n,s),this.backend.createComputePipeline(s,i)),s}_getRenderPipeline(e,t,n,i,s){i=i||this._getRenderCacheKey(e,t,n);let a=this.caches.get(i);return a===void 0&&(a=new _6(i,t,n),this.caches.set(i,a),e.pipeline=a,this.backend.createRenderPipeline(e,s)),a}_getComputeCacheKey(e,t){return e.id+","+t.id}_getRenderCacheKey(e,t,n){return t.id+","+n.id+","+this.backend.getRenderCacheKey(e)}_releasePipeline(e){this.caches.delete(e.cacheKey)}_releaseProgram(e){const t=e.code,n=e.stage;this.programs[n].delete(t)}_needsComputeUpdate(e){const t=this.get(e);return t.pipeline===void 0||t.version!==e.version}_needsRenderUpdate(e){return this.get(e).pipeline===void 0||this.backend.needsRenderUpdate(e)}}class T6 extends gf{constructor(e,t,n,i,s,a){super(),this.backend=e,this.textures=n,this.pipelines=s,this.attributes=i,this.nodes=t,this.info=a,this.pipelines.bindings=this}getForRender(e){const t=e.getBindings();for(const n of t){const i=this.get(n);i.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),i.bindGroup=n)}return t}getForCompute(e){const t=this.nodes.getForCompute(e).bindings;for(const n of t){const i=this.get(n);i.bindGroup===void 0&&(this._init(n),this.backend.createBindings(n,t,0),i.bindGroup=n)}return t}updateForCompute(e){this._updateBindings(this.getForCompute(e))}updateForRender(e){this._updateBindings(this.getForRender(e))}_updateBindings(e){for(const t of e)this._update(t,e)}_init(e){for(const t of e.bindings)if(t.isSampledTexture)this.textures.updateTexture(t.texture);else if(t.isStorageBuffer){const n=t.attribute,i=n.isIndirectStorageBufferAttribute?Ko.INDIRECT:Ko.STORAGE;this.attributes.update(n,i)}}_update(e,t){const{backend:n}=this;let i=!1,s=!0,a=0,l=0;for(const c of e.bindings)if(!(c.isNodeUniformsGroup&&this.nodes.updateGroup(c)===!1)){if(c.isStorageBuffer){const d=c.attribute,m=d.isIndirectStorageBufferAttribute?Ko.INDIRECT:Ko.STORAGE;this.attributes.update(d,m)}if(c.isUniformBuffer)c.update()&&n.updateBinding(c);else if(c.isSampler)c.update();else if(c.isSampledTexture){const d=this.textures.get(c.texture);c.needsBindingsUpdate(d.generation)&&(i=!0);const m=c.update(),y=c.texture;m&&this.textures.updateTexture(y);const v=n.get(y);if(v.externalTexture!==void 0||d.isDefaultTexture?s=!1:(a=a*10+y.id,l+=y.version),n.isWebGPUBackend===!0&&v.texture===void 0&&v.externalTexture===void 0&&(console.error("Bindings._update: binding should be available:",c,m,y,c.textureNode.value,i),this.textures.updateTexture(y),i=!0),y.isStorageTexture===!0){const x=this.get(y);c.store===!0?x.needsMipmap=!0:this.textures.needsMipmaps(y)&&x.needsMipmap===!0&&(this.backend.generateMipmaps(y),x.needsMipmap=!1)}}}i===!0&&this.backend.updateBindings(e,t,s?a:0,l)}}function M6(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function E2(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function A2(r){return(r.transmission>0||r.transmissionNode)&&r.side===Fr&&r.forceSinglePass===!1}class E6{constructor(e,t,n){this.renderItems=[],this.renderItemsIndex=0,this.opaque=[],this.transparentDoublePass=[],this.transparent=[],this.bundles=[],this.lightsNode=e.getNode(t,n),this.lightsArray=[],this.scene=t,this.camera=n,this.occlusionQueryCount=0}begin(){return this.renderItemsIndex=0,this.opaque.length=0,this.transparentDoublePass.length=0,this.transparent.length=0,this.bundles.length=0,this.lightsArray.length=0,this.occlusionQueryCount=0,this}getNextRenderItem(e,t,n,i,s,a,l){let c=this.renderItems[this.renderItemsIndex];return c===void 0?(c={id:e.id,object:e,geometry:t,material:n,groupOrder:i,renderOrder:e.renderOrder,z:s,group:a,clippingContext:l},this.renderItems[this.renderItemsIndex]=c):(c.id=e.id,c.object=e,c.geometry=t,c.material=n,c.groupOrder=i,c.renderOrder=e.renderOrder,c.z=s,c.group=a,c.clippingContext=l),this.renderItemsIndex++,c}push(e,t,n,i,s,a,l){const c=this.getNextRenderItem(e,t,n,i,s,a,l);e.occlusionTest===!0&&this.occlusionQueryCount++,n.transparent===!0||n.transmission>0?(A2(n)&&this.transparentDoublePass.push(c),this.transparent.push(c)):this.opaque.push(c)}unshift(e,t,n,i,s,a,l){const c=this.getNextRenderItem(e,t,n,i,s,a,l);n.transparent===!0||n.transmission>0?(A2(n)&&this.transparentDoublePass.unshift(c),this.transparent.unshift(c)):this.opaque.unshift(c)}pushBundle(e){this.bundles.push(e)}pushLight(e){this.lightsArray.push(e)}sort(e,t){this.opaque.length>1&&this.opaque.sort(e||M6),this.transparentDoublePass.length>1&&this.transparentDoublePass.sort(t||E2),this.transparent.length>1&&this.transparent.sort(t||E2)}finish(){this.lightsNode.setLights(this.lightsArray);for(let e=this.renderItemsIndex,t=this.renderItems.length;e<t;e++){const n=this.renderItems[e];if(n.id===null)break;n.id=null,n.object=null,n.geometry=null,n.material=null,n.groupOrder=null,n.renderOrder=null,n.z=null,n.group=null,n.clippingContext=null}}}const zv=[];class A6{constructor(e){this.lighting=e,this.lists=new qu}get(e,t){const n=this.lists;zv[0]=e,zv[1]=t;let i=n.get(zv);return i===void 0&&(i=new E6(this.lighting,e,t),n.set(zv,i)),zv.length=0,i}dispose(){this.lists=new qu}}let R6=0;class N6{constructor(){this.id=R6++,this.color=!0,this.clearColor=!0,this.clearColorValue={r:0,g:0,b:0,a:1},this.depth=!0,this.clearDepth=!0,this.clearDepthValue=1,this.stencil=!1,this.clearStencil=!0,this.clearStencilValue=1,this.viewport=!1,this.viewportValue=new Ot,this.scissor=!1,this.scissorValue=new Ot,this.renderTarget=null,this.textures=null,this.depthTexture=null,this.activeCubeFace=0,this.activeMipmapLevel=0,this.sampleCount=1,this.width=0,this.height=0,this.occlusionQueryCount=0,this.clippingContext=null,this.isRenderContext=!0}getCacheKey(){return BO(this)}}function BO(r){const{textures:e,activeCubeFace:t}=r,n=[t];for(const i of e)n.push(i.id);return UT(n)}const Vv=[],C6=new ey,w6=new X_;class D6{constructor(){this.chainMaps={}}get(e,t,n=null){Vv[0]=e,Vv[1]=t;let i;if(n===null)i="default";else{const l=n.texture.format;i=`${n.textures.length}:${l}:${n.samples}:${n.depthBuffer}:${n.stencilBuffer}`}const s=this._getChainMap(i);let a=s.get(Vv);return a===void 0&&(a=new N6,s.set(Vv,a)),Vv.length=0,n!==null&&(a.sampleCount=n.samples===0?1:n.samples),a}getForClear(e=null){return this.get(C6,w6,e)}_getChainMap(e){return this.chainMaps[e]||(this.chainMaps[e]=new qu)}dispose(){this.chainMaps={}}}const U6=new Y;class L6 extends gf{constructor(e,t,n){super(),this.renderer=e,this.backend=t,this.info=n}updateRenderTarget(e,t=0){const n=this.get(e),i=e.samples===0?1:e.samples,s=n.depthTextureMips||(n.depthTextureMips={}),a=e.textures,l=this.getSize(a[0]),c=l.width>>t,d=l.height>>t;let m=e.depthTexture||s[t];const y=e.depthBuffer===!0||e.stencilBuffer===!0;let v=!1;m===void 0&&y&&(m=new ya,m.format=e.stencilBuffer?qa:ka,m.type=e.stencilBuffer?Ha:di,m.image.width=c,m.image.height=d,s[t]=m),(n.width!==l.width||l.height!==n.height)&&(v=!0,m&&(m.needsUpdate=!0,m.image.width=c,m.image.height=d)),n.width=l.width,n.height=l.height,n.textures=a,n.depthTexture=m||null,n.depth=e.depthBuffer,n.stencil=e.stencilBuffer,n.renderTarget=e,n.sampleCount!==i&&(v=!0,m&&(m.needsUpdate=!0),n.sampleCount=i);const x={sampleCount:i};if(e.isXRRenderTarget!==!0){for(let S=0;S<a.length;S++){const A=a[S];v&&(A.needsUpdate=!0),this.updateTexture(A,x)}m&&this.updateTexture(m,x)}if(n.initialized!==!0){n.initialized=!0;const S=()=>{e.removeEventListener("dispose",S);for(let A=0;A<a.length;A++)this._destroyTexture(a[A]);m&&this._destroyTexture(m),this.delete(e)};e.addEventListener("dispose",S)}}updateTexture(e,t={}){const n=this.get(e);if(n.initialized===!0&&n.version===e.version)return;const i=e.isRenderTargetTexture||e.isDepthTexture||e.isFramebufferTexture,s=this.backend;if(i&&n.initialized===!0&&(s.destroySampler(e),s.destroyTexture(e)),e.isFramebufferTexture){const d=this.renderer.getRenderTarget();d?e.type=d.texture.type:e.type=Xi}const{width:a,height:l,depth:c}=this.getSize(e);if(t.width=a,t.height=l,t.depth=c,t.needsMipmaps=this.needsMipmaps(e),t.levels=t.needsMipmaps?this.getMipLevels(e,a,l):1,i||e.isStorageTexture===!0)s.createSampler(e),s.createTexture(e,t),n.generation=e.version;else if(n.initialized!==!0&&s.createSampler(e),e.version>0){const m=e.image;if(m===void 0)console.warn("THREE.Renderer: Texture marked for update but image is undefined.");else if(m.complete===!1)console.warn("THREE.Renderer: Texture marked for update but image is incomplete.");else{if(e.images){const y=[];for(const v of e.images)y.push(v);t.images=y}else t.image=m;(n.isDefaultTexture===void 0||n.isDefaultTexture===!0)&&(s.createTexture(e,t),n.isDefaultTexture=!1,n.generation=e.version),e.source.dataReady===!0&&s.updateTexture(e,t),t.needsMipmaps&&e.mipmaps.length===0&&s.generateMipmaps(e)}}else s.createDefaultTexture(e),n.isDefaultTexture=!0,n.generation=e.version;if(n.initialized!==!0){n.initialized=!0,n.generation=e.version,this.info.memory.textures++;const d=()=>{e.removeEventListener("dispose",d),this._destroyTexture(e),this.info.memory.textures--};e.addEventListener("dispose",d)}n.version=e.version}getSize(e,t=U6){let n=e.images?e.images[0]:e.image;return n?(n.image!==void 0&&(n=n.image),t.width=n.width||1,t.height=n.height||1,t.depth=e.isCubeTexture?6:n.depth||1):t.width=t.height=t.depth=1,t}getMipLevels(e,t,n){let i;return e.isCompressedTexture?e.mipmaps?i=e.mipmaps.length:i=1:i=Math.floor(Math.log2(Math.max(t,n)))+1,i}needsMipmaps(e){return this.isEnvironmentTexture(e)||e.isCompressedTexture===!0||e.generateMipmaps}isEnvironmentTexture(e){const t=e.mapping;return t===Pu||t===Iu||t===va||t===Wa}_destroyTexture(e){this.backend.destroySampler(e),this.backend.destroyTexture(e),this.delete(e)}}class yN extends ft{constructor(e,t,n,i=1){super(e,t,n),this.a=i}set(e,t,n,i=1){return this.a=i,super.set(e,t,n)}copy(e){return e.a!==void 0&&(this.a=e.a),super.copy(e)}clone(){return new this.constructor(this.r,this.g,this.b,this.a)}}class OO extends ni{static get type(){return"ParameterNode"}constructor(e,t=null){super(e,t),this.isParameterNode=!0}getHash(){return this.uuid}generate(){return this.name}}const B6=(r,e)=>ze(new OO(r,e));class O6 extends Ft{static get type(){return"StackNode"}constructor(e=null){super(),this.nodes=[],this.outputNode=null,this.parent=e,this._currentCond=null,this.isStackNode=!0}getNodeType(e){return this.outputNode?this.outputNode.getNodeType(e):"void"}getMemberType(e,t){return this.outputNode?this.outputNode.getMemberType(e,t):"void"}add(e){return this.nodes.push(e),this}If(e,t){const n=new a_(t);return this._currentCond=Sr(e,n),this.add(this._currentCond)}ElseIf(e,t){const n=new a_(t),i=Sr(e,n);return this._currentCond.elseNode=i,this._currentCond=i,this}Else(e){return this._currentCond.elseNode=new a_(e),this}build(e,...t){const n=RR();C_(this);for(const i of this.nodes)i.build(e,"void");return C_(n),this.outputNode?this.outputNode.build(e,...t):super.build(e,...t)}else(...e){return console.warn("THREE.TSL: .else() has been renamed to .Else()."),this.Else(...e)}elseif(...e){return console.warn("THREE.TSL: .elseif() has been renamed to .ElseIf()."),this.ElseIf(...e)}}const ab=Ve(O6).setParameterLength(0,1);function P6(r){return Object.entries(r).map(([e,t])=>typeof t=="string"?{name:e,type:t,atomic:!1}:{name:e,type:t.type,atomic:t.atomic||!1})}class I6 extends Ft{static get type(){return"StructTypeNode"}constructor(e,t=null){super("struct"),this.membersLayout=P6(e),this.name=t,this.isStructLayoutNode=!0}getLength(){let e=0;for(const t of this.membersLayout)e+=bR(t.type);return e}getMemberType(e,t){const n=this.membersLayout.find(i=>i.name===t);return n?n.type:"void"}getNodeType(e){return e.getStructTypeFromNode(this,this.membersLayout,this.name).name}setup(e){e.addInclude(this)}generate(e){return this.getNodeType(e)}}class F6 extends Ft{static get type(){return"StructNode"}constructor(e,t){super("vec3"),this.structLayoutNode=e,this.values=t,this.isStructNode=!0}getNodeType(e){return this.structLayoutNode.getNodeType(e)}getMemberType(e,t){return this.structLayoutNode.getMemberType(e,t)}generate(e){const t=e.getVarFromNode(this),n=t.type,i=e.getPropertyName(t);return e.addLineFlowCode(`${i} = ${e.generateStruct(n,this.structLayoutNode.membersLayout,this.values)}`,this),t.name}}const z6=(r,e=null)=>{const t=new I6(r,e),n=(...i)=>{let s=null;if(i.length>0)if(i[0].isNode){s={};const a=Object.keys(r);for(let l=0;l<i.length;l++)s[a[l]]=i[l]}else s=i[0];return ze(new F6(t,s))};return n.layout=t,n.isStruct=!0,n};class PO extends Ft{static get type(){return"OutputStructNode"}constructor(...e){super(),this.members=e,this.isOutputStructNode=!0}getNodeType(e){const t=e.getNodeProperties(this);if(t.membersLayout===void 0){const n=this.members,i=[];for(let s=0;s<n.length;s++){const a="m"+s,l=n[s].getNodeType(e);i.push({name:a,type:l,index:s})}t.membersLayout=i,t.structType=e.getOutputStructTypeFromNode(this,t.membersLayout)}return t.structType.name}generate(e){const t=e.getOutputStructName(),n=this.members,i=t!==""?t+".":"";for(let s=0;s<n.length;s++){const a=n[s].build(e);e.addLineFlowCode(`${i}m${s} = ${a}`,this)}return t}}const V6=Ve(PO);function IO(r,e){for(let t=0;t<r.length;t++)if(r[t].name===e)return t;return-1}class G6 extends PO{static get type(){return"MRTNode"}constructor(e){super(),this.outputNodes=e,this.isMRTNode=!0}has(e){return this.outputNodes[e]!==void 0}get(e){return this.outputNodes[e]}merge(e){const t={...this.outputNodes,...e.outputNodes};return FO(t)}setup(e){const t=this.outputNodes,n=e.renderer.getRenderTarget(),i=[],s=n.textures;for(const a in t){const l=IO(s,a);i[l]=Dt(t[a])}return this.members=i,super.setup(e)}}const FO=Ve(G6),H6=ge(([r])=>{const e=r.toUint().mul(747796405).add(2891336453),t=e.shiftRight(e.shiftRight(28).add(4)).bitXor(e).mul(277803737);return t.shiftRight(22).bitXor(t).toFloat().mul(1/2**32)}),a1=(r,e)=>Pl(tn(4,r.mul(On(1,r))),e),k6=(r,e)=>r.lessThan(.5)?a1(r.mul(2),e).div(2):On(1,a1(tn(On(1,r),2),e).div(2)),q6=(r,e,t)=>Pl(kl(Pl(r,e),bs(Pl(r,e),Pl(On(1,r),t))),1/e),W6=(r,e)=>vo(Ab.mul(e.mul(r).sub(1))).div(Ab.mul(e.mul(r).sub(1))),Ac=ge(([r])=>r.fract().sub(.5).abs()).setLayout({name:"tri",type:"float",inputs:[{name:"x",type:"float"}]}),X6=ge(([r])=>ae(Ac(r.z.add(Ac(r.y.mul(1)))),Ac(r.z.add(Ac(r.x.mul(1)))),Ac(r.y.add(Ac(r.x.mul(1)))))).setLayout({name:"tri3",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),Y6=ge(([r,e,t])=>{const n=ae(r).toVar(),i=K(1.4).toVar(),s=K(0).toVar(),a=ae(n).toVar();return ti({start:K(0),end:K(3),type:"float",condition:"<="},()=>{const l=ae(X6(a.mul(2))).toVar();n.addAssign(l.add(t.mul(K(.1).mul(e)))),a.mulAssign(1.8),i.mulAssign(1.5),n.mulAssign(1.2);const c=K(Ac(n.z.add(Ac(n.x.add(Ac(n.y)))))).toVar();s.addAssign(c.div(i)),a.addAssign(.14)}),s}).setLayout({name:"triNoise3D",type:"float",inputs:[{name:"position",type:"vec3"},{name:"speed",type:"float"},{name:"time",type:"float"}]});class j6 extends Ft{static get type(){return"FunctionOverloadingNode"}constructor(e=[],...t){super(),this.functionNodes=e,this.parametersNodes=t,this._candidateFnCall=null,this.global=!0}getNodeType(){return this.functionNodes[0].shaderNode.layout.type}setup(e){const t=this.parametersNodes;let n=this._candidateFnCall;if(n===null){let i=null,s=-1;for(const a of this.functionNodes){const c=a.shaderNode.layout;if(c===null)throw new Error("FunctionOverloadingNode: FunctionNode must be a layout.");const d=c.inputs;if(t.length===d.length){let m=0;for(let y=0;y<t.length;y++){const v=t[y],x=d[y];v.getNodeType(e)===x.type?m++:m=0}m>s&&(i=a,s=m)}}this._candidateFnCall=n=i(...t)}return n}}const Z6=Ve(j6),Tr=r=>(...e)=>Z6(r,...e),Cp=Ct(0).setGroup(Gt).onRenderUpdate(r=>r.time),zO=Ct(0).setGroup(Gt).onRenderUpdate(r=>r.deltaTime),K6=Ct(0,"uint").setGroup(Gt).onRenderUpdate(r=>r.frameId),Q6=(r=1)=>(console.warn('TSL: timerLocal() is deprecated. Use "time" instead.'),Cp.mul(r)),J6=(r=1)=>(console.warn('TSL: timerGlobal() is deprecated. Use "time" instead.'),Cp.mul(r)),$6=(r=1)=>(console.warn('TSL: timerDelta() is deprecated. Use "deltaTime" instead.'),zO.mul(r)),e8=(r=Cp)=>r.add(.75).mul(Math.PI*2).sin().mul(.5).add(.5),t8=(r=Cp)=>r.fract().round(),n8=(r=Cp)=>r.add(.5).fract().mul(2).sub(1).abs(),i8=(r=Cp)=>r.fract(),s8=ge(([r,e,t=Qe(.5)])=>$T(r.sub(t),e).add(t)),r8=ge(([r,e,t=Qe(.5)])=>{const n=r.sub(t),i=n.dot(n),a=i.mul(i).mul(e);return r.add(n.mul(a))}),a8=ge(({position:r=null,horizontal:e=!0,vertical:t=!1})=>{let n;r!==null?(n=Zo.toVar(),n[3][0]=r.x,n[3][1]=r.y,n[3][2]=r.z):n=Zo;const i=Za.mul(n);return N_(e)&&(i[0][0]=Zo[0].length(),i[0][1]=0,i[0][2]=0),N_(t)&&(i[1][0]=0,i[1][1]=Zo[1].length(),i[1][2]=0),i[2][0]=0,i[2][1]=0,i[2][2]=1,Rp.mul(i).mul(hs)}),o8=ge(([r=null])=>{const e=Cb();return Cb(aN(r)).sub(e).lessThan(0).select(ku,r)});class l8 extends Ft{static get type(){return"SpriteSheetUVNode"}constructor(e,t=Vi(),n=K(0)){super("vec2"),this.countNode=e,this.uvNode=t,this.frameNode=n}setup(){const{frameNode:e,uvNode:t,countNode:n}=this,{width:i,height:s}=n,a=e.mod(i.mul(s)).floor(),l=a.mod(i),c=s.sub(a.add(1).div(i).ceil()),d=n.reciprocal(),m=Qe(l,c);return t.add(m).mul(d)}}const u8=Ve(l8).setParameterLength(3);class c8 extends Ft{static get type(){return"TriplanarTexturesNode"}constructor(e,t=null,n=null,i=K(1),s=hs,a=Ya){super("vec4"),this.textureXNode=e,this.textureYNode=t,this.textureZNode=n,this.scaleNode=i,this.positionNode=s,this.normalNode=a}setup(){const{textureXNode:e,textureYNode:t,textureZNode:n,scaleNode:i,positionNode:s,normalNode:a}=this;let l=a.abs().normalize();l=l.div(l.dot(ae(1)));const c=s.yz.mul(i),d=s.zx.mul(i),m=s.xy.mul(i),y=e.value,v=t!==null?t.value:y,x=n!==null?n.value:y,S=En(y,c).mul(l.x),A=En(v,d).mul(l.y),E=En(x,m).mul(l.z);return bs(S,A,E)}}const VO=Ve(c8).setParameterLength(1,6),h8=(...r)=>VO(...r),Km=new wu,bd=new Y,Qm=new Y,WE=new Y,Gv=new Mt,PS=new Y(0,0,-1),Ru=new Ot,Hv=new Y,IS=new Y,kv=new Ot,FS=new Xe,wb=new tl,f8=ku.flipX();wb.depthTexture=new ya(1,1);let XE=!1;class vN extends Hu{static get type(){return"ReflectorNode"}constructor(e={}){super(e.defaultTexture||wb.texture,f8),this._reflectorBaseNode=e.reflector||new d8(this,e),this._depthNode=null,this.setUpdateMatrix(!1)}get reflector(){return this._reflectorBaseNode}get target(){return this._reflectorBaseNode.target}getDepthNode(){if(this._depthNode===null){if(this._reflectorBaseNode.depth!==!0)throw new Error("THREE.ReflectorNode: Depth node can only be requested when the reflector is created with { depth: true }. ");this._depthNode=ze(new vN({defaultTexture:wb.depthTexture,reflector:this._reflectorBaseNode}))}return this._depthNode}setup(e){return e.object.isQuadMesh||this._reflectorBaseNode.build(e),super.setup(e)}clone(){const e=new this.constructor(this.reflectorNode);return e._reflectorBaseNode=this._reflectorBaseNode,e}}class d8 extends Ft{static get type(){return"ReflectorBaseNode"}constructor(e,t={}){super();const{target:n=new Hn,resolution:i=1,generateMipmaps:s=!1,bounces:a=!0,depth:l=!1}=t;this.textureNode=e,this.target=n,this.resolution=i,this.generateMipmaps=s,this.bounces=a,this.depth=l,this.updateBeforeType=a?en.RENDER:en.FRAME,this.virtualCameras=new WeakMap,this.renderTargets=new WeakMap,this.forceUpdate=!1}_updateResolution(e,t){const n=this.resolution;t.getDrawingBufferSize(FS),e.setSize(Math.round(FS.width*n),Math.round(FS.height*n))}setup(e){return this._updateResolution(wb,e.renderer),super.setup(e)}getVirtualCamera(e){let t=this.virtualCameras.get(e);return t===void 0&&(t=e.clone(),this.virtualCameras.set(e,t)),t}getRenderTarget(e){let t=this.renderTargets.get(e);return t===void 0&&(t=new tl(0,0,{type:Ys}),this.generateMipmaps===!0&&(t.texture.minFilter=eU,t.texture.generateMipmaps=!0),this.depth===!0&&(t.depthTexture=new ya),this.renderTargets.set(e,t)),t}updateBefore(e){if(this.bounces===!1&&XE)return!1;XE=!0;const{scene:t,camera:n,renderer:i,material:s}=e,{target:a}=this,l=this.getVirtualCamera(n),c=this.getRenderTarget(l);if(i.getDrawingBufferSize(FS),this._updateResolution(c,i),Qm.setFromMatrixPosition(a.matrixWorld),WE.setFromMatrixPosition(n.matrixWorld),Gv.extractRotation(a.matrixWorld),bd.set(0,0,1),bd.applyMatrix4(Gv),Hv.subVectors(Qm,WE),Hv.dot(bd)>0===!0&&this.forceUpdate===!1)return;Hv.reflect(bd).negate(),Hv.add(Qm),Gv.extractRotation(n.matrixWorld),PS.set(0,0,-1),PS.applyMatrix4(Gv),PS.add(WE),IS.subVectors(Qm,PS),IS.reflect(bd).negate(),IS.add(Qm),l.coordinateSystem=n.coordinateSystem,l.position.copy(Hv),l.up.set(0,1,0),l.up.applyMatrix4(Gv),l.up.reflect(bd),l.lookAt(IS),l.near=n.near,l.far=n.far,l.updateMatrixWorld(),l.projectionMatrix.copy(n.projectionMatrix),Km.setFromNormalAndCoplanarPoint(bd,Qm),Km.applyMatrix4(l.matrixWorldInverse),Ru.set(Km.normal.x,Km.normal.y,Km.normal.z,Km.constant);const m=l.projectionMatrix;kv.x=(Math.sign(Ru.x)+m.elements[8])/m.elements[0],kv.y=(Math.sign(Ru.y)+m.elements[9])/m.elements[5],kv.z=-1,kv.w=(1+m.elements[10])/m.elements[14],Ru.multiplyScalar(1/Ru.dot(kv));const y=0;m.elements[2]=Ru.x,m.elements[6]=Ru.y,m.elements[10]=i.coordinateSystem===Vl?Ru.z-y:Ru.z+1-y,m.elements[14]=Ru.w,this.textureNode.value=c.texture,this.depth===!0&&(this.textureNode.getDepthNode().value=c.depthTexture),s.visible=!1;const v=i.getRenderTarget(),x=i.getMRT(),S=i.autoClear;i.setMRT(null),i.setRenderTarget(c),i.autoClear=!0,i.render(t,l),i.setMRT(x),i.setRenderTarget(v),i.autoClear=S,s.visible=!0,XE=!1,this.forceUpdate=!1}}const p8=r=>ze(new vN(r)),YE=new Mp(-1,1,1,-1,0,1);class m8 extends fn{constructor(e=!1){super();const t=e===!1?[0,-1,0,1,2,1]:[0,2,0,0,2,0];this.setAttribute("position",new Et([-1,3,0,-1,-1,0,3,-1,0],3)),this.setAttribute("uv",new Et(t,2))}}const g8=new m8;class _N extends bi{constructor(e=null){super(g8,e),this.camera=YE,this.isQuadMesh=!0}async renderAsync(e){return e.renderAsync(this,YE)}render(e){e.render(this,YE)}}const y8=new Xe;class v8 extends Hu{static get type(){return"RTTNode"}constructor(e,t=null,n=null,i={type:Ys}){const s=new tl(t,n,i);super(s.texture,Vi()),this.node=e,this.width=t,this.height=n,this.pixelRatio=1,this.renderTarget=s,this.textureNeedsUpdate=!0,this.autoUpdate=!0,this._rttNode=null,this._quadMesh=new _N(new Ts),this.updateBeforeType=en.RENDER}get autoSize(){return this.width===null}setup(e){return this._rttNode=this.node.context(e.getSharedContext()),this._quadMesh.material.name="RTT",this._quadMesh.material.needsUpdate=!0,super.setup(e)}setSize(e,t){this.width=e,this.height=t;const n=e*this.pixelRatio,i=t*this.pixelRatio;this.renderTarget.setSize(n,i),this.textureNeedsUpdate=!0}setPixelRatio(e){this.pixelRatio=e,this.setSize(this.width,this.height)}updateBefore({renderer:e}){if(this.textureNeedsUpdate===!1&&this.autoUpdate===!1)return;if(this.textureNeedsUpdate=!1,this.autoSize===!0){this.pixelRatio=e.getPixelRatio();const n=e.getSize(y8);this.setSize(n.width,n.height)}this._quadMesh.material.fragmentNode=this._rttNode;const t=e.getRenderTarget();e.setRenderTarget(this.renderTarget),this._quadMesh.render(e),e.setRenderTarget(t)}clone(){const e=new Hu(this.value,this.uvNode,this.levelNode);return e.sampler=this.sampler,e.referenceNode=this,e}}const GO=(r,...e)=>ze(new v8(ze(r),...e)),_8=(r,...e)=>r.isTextureNode?r:r.isPassNode?r.getTextureNode():GO(r,...e),lg=ge(([r,e,t],n)=>{let i;n.renderer.coordinateSystem===Vl?(r=Qe(r.x,r.y.oneMinus()).mul(2).sub(1),i=Dt(ae(r,e),1)):i=Dt(ae(r.x,r.y.oneMinus(),e).mul(2).sub(1),1);const s=Dt(t.mul(i));return s.xyz.div(s.w)}),x8=ge(([r,e])=>{const t=e.mul(Dt(r,1)),n=t.xy.div(t.w).mul(.5).add(.5).toVar();return Qe(n.x,n.y.oneMinus())}),S8=ge(([r,e,t])=>{const n=af(ls(e)),i=Ws(r.mul(n)).toVar(),s=ls(e,i).toVar(),a=ls(e,i.sub(Ws(2,0))).toVar(),l=ls(e,i.sub(Ws(1,0))).toVar(),c=ls(e,i.add(Ws(1,0))).toVar(),d=ls(e,i.add(Ws(2,0))).toVar(),m=ls(e,i.add(Ws(0,2))).toVar(),y=ls(e,i.add(Ws(0,1))).toVar(),v=ls(e,i.sub(Ws(0,1))).toVar(),x=ls(e,i.sub(Ws(0,2))).toVar(),S=Ai(On(K(2).mul(l).sub(a),s)).toVar(),A=Ai(On(K(2).mul(c).sub(d),s)).toVar(),E=Ai(On(K(2).mul(y).sub(m),s)).toVar(),M=Ai(On(K(2).mul(v).sub(x),s)).toVar(),C=lg(r,s,t).toVar(),w=S.lessThan(A).select(C.sub(lg(r.sub(Qe(K(1).div(n.x),0)),l,t)),C.negate().add(lg(r.add(Qe(K(1).div(n.x),0)),c,t))),D=E.lessThan(M).select(C.sub(lg(r.add(Qe(0,K(1).div(n.y))),y,t)),C.negate().add(lg(r.sub(Qe(0,K(1).div(n.y))),v,t)));return Gc(HT(w,D))});class b8 extends Qo{constructor(e,t,n=Float32Array){const i=ArrayBuffer.isView(e)?e:new n(e*t);super(i,t),this.isStorageInstancedBufferAttribute=!0}}class T8 extends Kn{constructor(e,t,n=Float32Array){const i=ArrayBuffer.isView(e)?e:new n(e*t);super(i,t),this.isStorageBufferAttribute=!0}}const M8=(r,e="float")=>{let t,n;e.isStruct===!0?(t=e.layout.getLength(),n=Sb("float")):(t=bR(e),n=Sb(e));const i=new T8(r,t,n);return Xd(i,e,r)},E8=(r,e="float")=>{let t,n;e.isStruct===!0?(t=e.layout.getLength(),n=Sb("float")):(t=bR(e),n=Sb(e));const i=new b8(r,t,n);return Xd(i,e,r)};class A8 extends QL{static get type(){return"VertexColorNode"}constructor(e=0){super(null,"vec4"),this.isVertexColorNode=!0,this.index=e}getAttributeName(){const e=this.index;return"color"+(e>0?e:"")}generate(e){const t=this.getAttributeName(e),n=e.hasGeometryAttribute(t);let i;return n===!0?i=super.generate(e):i=e.generateConst(this.nodeType,new Ot(1,1,1,1)),i}serialize(e){super.serialize(e),e.index=this.index}deserialize(e){super.deserialize(e),this.index=e.index}}const R8=r=>ze(new A8(r));class N8 extends Ft{static get type(){return"PointUVNode"}constructor(){super("vec2"),this.isPointUVNode=!0}generate(){return"vec2( gl_PointCoord.x, 1.0 - gl_PointCoord.y )"}}const C8=rt(N8),qv=new _a,jE=new Mt;class Va extends Ft{static get type(){return"SceneNode"}constructor(e=Va.BACKGROUND_BLURRINESS,t=null){super(),this.scope=e,this.scene=t}setup(e){const t=this.scope,n=this.scene!==null?this.scene:e.scene;let i;return t===Va.BACKGROUND_BLURRINESS?i=_i("backgroundBlurriness","float",n):t===Va.BACKGROUND_INTENSITY?i=_i("backgroundIntensity","float",n):t===Va.BACKGROUND_ROTATION?i=Ct("mat4").label("backgroundRotation").setGroup(Gt).onRenderUpdate(()=>{const s=n.background;return s!==null&&s.isTexture&&s.mapping!==z_?(qv.copy(n.backgroundRotation),qv.x*=-1,qv.y*=-1,qv.z*=-1,jE.makeRotationFromEuler(qv)):jE.identity(),jE}):console.error("THREE.SceneNode: Unknown scope:",t),i}}Va.BACKGROUND_BLURRINESS="backgroundBlurriness";Va.BACKGROUND_INTENSITY="backgroundIntensity";Va.BACKGROUND_ROTATION="backgroundRotation";const HO=rt(Va,Va.BACKGROUND_BLURRINESS),o1=rt(Va,Va.BACKGROUND_INTENSITY),kO=rt(Va,Va.BACKGROUND_ROTATION);class w8 extends Hu{static get type(){return"StorageTextureNode"}constructor(e,t,n=null){super(e,t),this.storeNode=n,this.isStorageTextureNode=!0,this.access=Vr.WRITE_ONLY}getInputType(){return"storageTexture"}setup(e){super.setup(e);const t=e.getNodeProperties(this);t.storeNode=this.storeNode}setAccess(e){return this.access=e,this}generate(e,t){let n;return this.storeNode!==null?n=this.generateStore(e):n=super.generate(e,t),n}toReadWrite(){return this.setAccess(Vr.READ_WRITE)}toReadOnly(){return this.setAccess(Vr.READ_ONLY)}toWriteOnly(){return this.setAccess(Vr.WRITE_ONLY)}generateStore(e){const t=e.getNodeProperties(this),{uvNode:n,storeNode:i}=t,s=super.generate(e,"property"),a=n.build(e,"uvec2"),l=i.build(e,"vec4"),c=e.generateTextureStore(e,s,a,l);e.addLineFlowCode(c,this)}}const qO=Ve(w8).setParameterLength(1,3),D8=(r,e,t)=>{const n=qO(r,e,t);return t!==null&&n.append(),n},U8=ge(({texture:r,uv:e})=>{const n=ae().toVar();return ln(e.x.lessThan(1e-4),()=>{n.assign(ae(1,0,0))}).ElseIf(e.y.lessThan(1e-4),()=>{n.assign(ae(0,1,0))}).ElseIf(e.z.lessThan(1e-4),()=>{n.assign(ae(0,0,1))}).ElseIf(e.x.greaterThan(1-1e-4),()=>{n.assign(ae(-1,0,0))}).ElseIf(e.y.greaterThan(1-1e-4),()=>{n.assign(ae(0,-1,0))}).ElseIf(e.z.greaterThan(1-1e-4),()=>{n.assign(ae(0,0,-1))}).Else(()=>{const s=r.sample(e.add(ae(-.01,0,0))).r.sub(r.sample(e.add(ae(.01,0,0))).r),a=r.sample(e.add(ae(0,-.01,0))).r.sub(r.sample(e.add(ae(0,.01,0))).r),l=r.sample(e.add(ae(0,0,-.01))).r.sub(r.sample(e.add(ae(0,0,.01))).r);n.assign(ae(s,a,l))}),n.normalize()});class L8 extends Hu{static get type(){return"Texture3DNode"}constructor(e,t=null,n=null){super(e,t,n),this.isTexture3DNode=!0}getInputType(){return"texture3D"}getDefaultUV(){return ae(.5,.5,.5)}setUpdateMatrix(){}setupUV(e,t){const n=this.value;return e.isFlipY()&&(n.isRenderTargetTexture===!0||n.isFramebufferTexture===!0)&&(this.sampler?t=t.flipY():t=t.setY(ee(af(this,this.levelNode).y).sub(t.y).sub(1))),t}generateUV(e,t){return t.build(e,"vec3")}normal(e){return U8({texture:this,uv:e})}}const B8=Ve(L8).setParameterLength(1,3);class O8 extends jT{static get type(){return"UserDataNode"}constructor(e,t,n=null){super(e,t,n),this.userData=n}updateReference(e){return this.reference=this.userData!==null?this.userData:e.object.userData,this.reference}}const P8=(r,e,t)=>ze(new O8(r,e,t)),R2=new WeakMap;class I8 extends es{static get type(){return"VelocityNode"}constructor(){super("vec2"),this.projectionMatrix=null,this.updateType=en.OBJECT,this.updateAfterType=en.OBJECT,this.previousModelWorldMatrix=Ct(new Mt),this.previousProjectionMatrix=Ct(new Mt).setGroup(Gt),this.previousCameraViewMatrix=Ct(new Mt)}setProjectionMatrix(e){this.projectionMatrix=e}update({frameId:e,camera:t,object:n}){const i=N2(n);this.previousModelWorldMatrix.value.copy(i);const s=WO(t);s.frameId!==e&&(s.frameId=e,s.previousProjectionMatrix===void 0?(s.previousProjectionMatrix=new Mt,s.previousCameraViewMatrix=new Mt,s.currentProjectionMatrix=new Mt,s.currentCameraViewMatrix=new Mt,s.previousProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),s.previousCameraViewMatrix.copy(t.matrixWorldInverse)):(s.previousProjectionMatrix.copy(s.currentProjectionMatrix),s.previousCameraViewMatrix.copy(s.currentCameraViewMatrix)),s.currentProjectionMatrix.copy(this.projectionMatrix||t.projectionMatrix),s.currentCameraViewMatrix.copy(t.matrixWorldInverse),this.previousProjectionMatrix.value.copy(s.previousProjectionMatrix),this.previousCameraViewMatrix.value.copy(s.previousCameraViewMatrix))}updateAfter({object:e}){N2(e).copy(e.matrixWorld)}setup(){const e=this.projectionMatrix===null?Rp:Ct(this.projectionMatrix),t=this.previousCameraViewMatrix.mul(this.previousModelWorldMatrix),n=e.mul(Np).mul(hs),i=this.previousProjectionMatrix.mul(t).mul(Nb),s=n.xy.div(n.w),a=i.xy.div(i.w);return On(s,a)}}function WO(r){let e=R2.get(r);return e===void 0&&(e={},R2.set(r,e)),e}function N2(r,e=0){const t=WO(r);let n=t[e];return n===void 0&&(t[e]=n=new Mt),n}const F8=rt(I8),XO=ge(([r,e])=>Xa(1,r.oneMinus().div(e)).oneMinus()).setLayout({name:"blendBurn",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),YO=ge(([r,e])=>Xa(r.div(e.oneMinus()),1)).setLayout({name:"blendDodge",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),jO=ge(([r,e])=>r.oneMinus().mul(e.oneMinus()).oneMinus()).setLayout({name:"blendScreen",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),ZO=ge(([r,e])=>ei(r.mul(2).mul(e),r.oneMinus().mul(2).mul(e.oneMinus()).oneMinus(),GT(.5,r))).setLayout({name:"blendOverlay",type:"vec3",inputs:[{name:"base",type:"vec3"},{name:"blend",type:"vec3"}]}),z8=ge(([r,e])=>{const t=e.a.add(r.a.mul(e.a.oneMinus()));return Dt(e.rgb.mul(e.a).add(r.rgb.mul(r.a).mul(e.a.oneMinus())).div(t),t)}).setLayout({name:"blendColor",type:"vec4",inputs:[{name:"base",type:"vec4"},{name:"blend",type:"vec4"}]}),V8=(...r)=>(console.warn('THREE.TSL: "burn" has been renamed. Use "blendBurn" instead.'),XO(r)),G8=(...r)=>(console.warn('THREE.TSL: "dodge" has been renamed. Use "blendDodge" instead.'),YO(r)),H8=(...r)=>(console.warn('THREE.TSL: "screen" has been renamed. Use "blendScreen" instead.'),jO(r)),k8=(...r)=>(console.warn('THREE.TSL: "overlay" has been renamed. Use "blendOverlay" instead.'),ZO(r)),q8=ge(([r])=>xN(r.rgb)),W8=ge(([r,e=K(1)])=>e.mix(xN(r.rgb),r.rgb)),X8=ge(([r,e=K(1)])=>{const t=bs(r.r,r.g,r.b).div(3),n=r.r.max(r.g.max(r.b)),i=n.sub(t).mul(e).mul(-3);return ei(r.rgb,n,i)}),Y8=ge(([r,e=K(1)])=>{const t=ae(.57735,.57735,.57735),n=e.cos();return ae(r.rgb.mul(n).add(t.cross(r.rgb).mul(e.sin()).add(t.mul(mf(t,r.rgb).mul(n.oneMinus())))))}),xN=(r,e=ae(on.getLuminanceCoefficients(new Y)))=>mf(r,e),j8=ge(([r,e=ae(1),t=ae(0),n=ae(1),i=K(1),s=ae(on.getLuminanceCoefficients(new Y,xo))])=>{const a=r.rgb.dot(ae(s)),l=fs(r.rgb.mul(e).add(t),0).toVar(),c=l.pow(n).toVar();return ln(l.r.greaterThan(0),()=>{l.r.assign(c.r)}),ln(l.g.greaterThan(0),()=>{l.g.assign(c.g)}),ln(l.b.greaterThan(0),()=>{l.b.assign(c.b)}),l.assign(a.add(l.sub(a).mul(i))),Dt(l.rgb,r.a)});class Z8 extends es{static get type(){return"PosterizeNode"}constructor(e,t){super(),this.sourceNode=e,this.stepsNode=t}setup(){const{sourceNode:e,stepsNode:t}=this;return e.mul(t).floor().div(t)}}const K8=Ve(Z8).setParameterLength(2),zS=new Xe;class KO extends Hu{static get type(){return"PassTextureNode"}constructor(e,t){super(t),this.passNode=e,this.setUpdateMatrix(!1)}setup(e){return e.object.isQuadMesh&&this.passNode.build(e),super.setup(e)}clone(){return new this.constructor(this.passNode,this.value)}}class C2 extends KO{static get type(){return"PassMultipleTextureNode"}constructor(e,t,n=!1){super(e,null),this.textureName=t,this.previousTexture=n}updateTexture(){this.value=this.previousTexture?this.passNode.getPreviousTexture(this.textureName):this.passNode.getTexture(this.textureName)}setup(e){return this.updateTexture(),super.setup(e)}clone(){return new this.constructor(this.passNode,this.textureName,this.previousTexture)}}class Wu extends es{static get type(){return"PassNode"}constructor(e,t,n,i={}){super("vec4"),this.scope=e,this.scene=t,this.camera=n,this.options=i,this._pixelRatio=1,this._width=1,this._height=1;const s=new ya;s.isRenderTargetTexture=!0,s.name="depth";const a=new tl(this._width*this._pixelRatio,this._height*this._pixelRatio,{type:Ys,...i});a.texture.name="output",a.depthTexture=s,this.renderTarget=a,this._textures={output:a.texture,depth:s},this._textureNodes={},this._linearDepthNodes={},this._viewZNodes={},this._previousTextures={},this._previousTextureNodes={},this._cameraNear=Ct(0),this._cameraFar=Ct(0),this._mrt=null,this._layers=null,this._resolution=1,this.isPassNode=!0,this.updateBeforeType=en.FRAME}setResolution(e){return this._resolution=e,this}getResolution(){return this._resolution}setLayers(e){return this._layers=e,this}getLayers(){return this._layers}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}isGlobal(){return!0}getTexture(e){let t=this._textures[e];return t===void 0&&(t=this.renderTarget.texture.clone(),t.name=e,this._textures[e]=t,this.renderTarget.textures.push(t)),t}getPreviousTexture(e){let t=this._previousTextures[e];return t===void 0&&(t=this.getTexture(e).clone(),this._previousTextures[e]=t),t}toggleTexture(e){const t=this._previousTextures[e];if(t!==void 0){const n=this._textures[e],i=this.renderTarget.textures.indexOf(n);this.renderTarget.textures[i]=t,this._textures[e]=t,this._previousTextures[e]=n,this._textureNodes[e].updateTexture(),this._previousTextureNodes[e].updateTexture()}}getTextureNode(e="output"){let t=this._textureNodes[e];return t===void 0&&(t=ze(new C2(this,e)),t.updateTexture(),this._textureNodes[e]=t),t}getPreviousTextureNode(e="output"){let t=this._previousTextureNodes[e];return t===void 0&&(this._textureNodes[e]===void 0&&this.getTextureNode(e),t=ze(new C2(this,e,!0)),t.updateTexture(),this._previousTextureNodes[e]=t),t}getViewZNode(e="depth"){let t=this._viewZNodes[e];if(t===void 0){const n=this._cameraNear,i=this._cameraFar;this._viewZNodes[e]=t=oN(this.getTextureNode(e),n,i)}return t}getLinearDepthNode(e="depth"){let t=this._linearDepthNodes[e];if(t===void 0){const n=this._cameraNear,i=this._cameraFar,s=this.getViewZNode(e);this._linearDepthNodes[e]=t=_g(s,n,i)}return t}setup({renderer:e}){return this.renderTarget.samples=this.options.samples===void 0?e.samples:this.options.samples,e.backend.isWebGLBackend===!0&&(this.renderTarget.samples=0),this.renderTarget.texture.type=e.getColorBufferType(),this.scope===Wu.COLOR?this.getTextureNode():this.getLinearDepthNode()}updateBefore(e){const{renderer:t}=e,{scene:n}=this;let i,s;const a=t.getOutputRenderTarget();a&&a.isXRRenderTarget===!0?(s=1,i=t.xr.getCamera(),t.xr.updateCamera(i),zS.set(a.width,a.height)):(i=this.camera,s=t.getPixelRatio(),t.getSize(zS)),this._pixelRatio=s,this.setSize(zS.width,zS.height);const l=t.getRenderTarget(),c=t.getMRT(),d=i.layers.mask;this._cameraNear.value=i.near,this._cameraFar.value=i.far,this._layers!==null&&(i.layers.mask=this._layers.mask);for(const m in this._previousTextures)this.toggleTexture(m);t.setRenderTarget(this.renderTarget),t.setMRT(this._mrt),t.render(n,i),t.setRenderTarget(l),t.setMRT(c),i.layers.mask=d}setSize(e,t){this._width=e,this._height=t;const n=this._width*this._pixelRatio*this._resolution,i=this._height*this._pixelRatio*this._resolution;this.renderTarget.setSize(n,i)}setPixelRatio(e){this._pixelRatio=e,this.setSize(this._width,this._height)}dispose(){this.renderTarget.dispose()}}Wu.COLOR="color";Wu.DEPTH="depth";const Q8=(r,e,t)=>ze(new Wu(Wu.COLOR,r,e,t)),J8=(r,e)=>ze(new KO(r,e)),$8=(r,e,t)=>ze(new Wu(Wu.DEPTH,r,e,t));class ek extends Wu{static get type(){return"ToonOutlinePassNode"}constructor(e,t,n,i,s){super(Wu.COLOR,e,t),this.colorNode=n,this.thicknessNode=i,this.alphaNode=s,this._materialCache=new WeakMap}updateBefore(e){const{renderer:t}=e,n=t.getRenderObjectFunction();t.setRenderObjectFunction((i,s,a,l,c,d,m,y)=>{if((c.isMeshToonMaterial||c.isMeshToonNodeMaterial)&&c.wireframe===!1){const v=this._getOutlineMaterial(c);t.renderObject(i,s,a,l,v,d,m,y)}t.renderObject(i,s,a,l,c,d,m,y)}),super.updateBefore(e),t.setRenderObjectFunction(n)}_createMaterial(){const e=new Ts;e.isMeshToonOutlineMaterial=!0,e.name="Toon_Outline",e.side=Ti;const t=Ya.negate(),n=Rp.mul(Np),i=K(1),s=n.mul(Dt(hs,1)),a=n.mul(Dt(hs.add(t),1)),l=Gc(s.sub(a));return e.vertexNode=s.add(l.mul(this.thicknessNode).mul(s.w).mul(i)),e.colorNode=Dt(this.colorNode,this.alphaNode),e}_getOutlineMaterial(e){let t=this._materialCache.get(e);return t===void 0&&(t=this._createMaterial(),this._materialCache.set(e,t)),t}}const tk=(r,e,t=new ft(0,0,0),n=.003,i=1)=>ze(new ek(r,e,ze(t),ze(n),ze(i))),QO=ge(([r,e])=>r.mul(e).clamp()).setLayout({name:"linearToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),JO=ge(([r,e])=>(r=r.mul(e),r.div(r.add(1)).clamp())).setLayout({name:"reinhardToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),$O=ge(([r,e])=>{r=r.mul(e),r=r.sub(.004).max(0);const t=r.mul(r.mul(6.2).add(.5)),n=r.mul(r.mul(6.2).add(1.7)).add(.06);return t.div(n).pow(2.2)}).setLayout({name:"cineonToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),nk=ge(([r])=>{const e=r.mul(r.add(.0245786)).sub(90537e-9),t=r.mul(r.add(.432951).mul(.983729)).add(.238081);return e.div(t)}),eP=ge(([r,e])=>{const t=kr(.59719,.35458,.04823,.076,.90834,.01566,.0284,.13383,.83777),n=kr(1.60475,-.53108,-.07367,-.10208,1.10813,-.00605,-.00327,-.07276,1.07602);return r=r.mul(e).div(.6),r=t.mul(r),r=nk(r),r=n.mul(r),r.clamp()}).setLayout({name:"acesFilmicToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),ik=kr(ae(1.6605,-.1246,-.0182),ae(-.5876,1.1329,-.1006),ae(-.0728,-.0083,1.1187)),sk=kr(ae(.6274,.0691,.0164),ae(.3293,.9195,.088),ae(.0433,.0113,.8956)),rk=ge(([r])=>{const e=ae(r).toVar(),t=ae(e.mul(e)).toVar(),n=ae(t.mul(t)).toVar();return K(15.5).mul(n.mul(t)).sub(tn(40.14,n.mul(e))).add(tn(31.96,n).sub(tn(6.868,t.mul(e))).add(tn(.4298,t).add(tn(.1191,e).sub(.00232))))}),tP=ge(([r,e])=>{const t=ae(r).toVar(),n=kr(ae(.856627153315983,.137318972929847,.11189821299995),ae(.0951212405381588,.761241990602591,.0767994186031903),ae(.0482516061458583,.101439036467562,.811302368396859)),i=kr(ae(1.1271005818144368,-.1413297634984383,-.14132976349843826),ae(-.11060664309660323,1.157823702216272,-.11060664309660294),ae(-.016493938717834573,-.016493938717834257,1.2519364065950405)),s=K(-12.47393),a=K(4.026069);return t.mulAssign(e),t.assign(sk.mul(t)),t.assign(n.mul(t)),t.assign(fs(t,1e-10)),t.assign(Lu(t)),t.assign(t.sub(s).div(a.sub(s))),t.assign(zu(t,0,1)),t.assign(rk(t)),t.assign(i.mul(t)),t.assign(Pl(fs(ae(0),t),ae(2.2))),t.assign(ik.mul(t)),t.assign(zu(t,0,1)),t}).setLayout({name:"agxToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]}),nP=ge(([r,e])=>{const t=K(.76),n=K(.15);r=r.mul(e);const i=Xa(r.r,Xa(r.g,r.b)),s=Sr(i.lessThan(.08),i.sub(tn(6.25,i.mul(i))),.04);r.subAssign(s);const a=fs(r.r,fs(r.g,r.b));ln(a.lessThan(t),()=>r);const l=On(1,t),c=On(1,l.mul(l).div(a.add(l.sub(t))));r.mulAssign(c.div(a));const d=On(1,kl(1,n.mul(a.sub(c)).add(1)));return ei(r,ae(c),d)}).setLayout({name:"neutralToneMapping",type:"vec3",inputs:[{name:"color",type:"vec3"},{name:"exposure",type:"float"}]});class Us extends Ft{static get type(){return"CodeNode"}constructor(e="",t=[],n=""){super("code"),this.isCodeNode=!0,this.code=e,this.includes=t,this.language=n}isGlobal(){return!0}setIncludes(e){return this.includes=e,this}getIncludes(){return this.includes}generate(e){const t=this.getIncludes(e);for(const i of t)i.build(e);const n=e.getCodeFromNode(this,this.getNodeType(e));return n.code=this.code,n.code}serialize(e){super.serialize(e),e.code=this.code,e.language=this.language}deserialize(e){super.deserialize(e),this.code=e.code,this.language=e.language}}const eM=Ve(Us).setParameterLength(1,3),ak=(r,e)=>eM(r,e,"js"),ok=(r,e)=>eM(r,e,"wgsl"),lk=(r,e)=>eM(r,e,"glsl");class iP extends Us{static get type(){return"FunctionNode"}constructor(e="",t=[],n=""){super(e,t,n)}getNodeType(e){return this.getNodeFunction(e).type}getInputs(e){return this.getNodeFunction(e).inputs}getNodeFunction(e){const t=e.getDataFromNode(this);let n=t.nodeFunction;return n===void 0&&(n=e.parser.parseFunction(this.code),t.nodeFunction=n),n}generate(e,t){super.generate(e);const n=this.getNodeFunction(e),i=n.name,s=n.type,a=e.getCodeFromNode(this,s);i!==""&&(a.name=i);const l=e.getPropertyName(a),c=this.getNodeFunction(e).getCode(l);return a.code=c+`
`,t==="property"?l:e.format(`${l}()`,s,t)}}const sP=(r,e=[],t="")=>{for(let s=0;s<e.length;s++){const a=e[s];typeof a=="function"&&(e[s]=a.functionNode)}const n=ze(new iP(r,e,t)),i=(...s)=>n.call(...s);return i.functionNode=n,i},uk=(r,e)=>sP(r,e,"glsl"),ck=(r,e)=>sP(r,e,"wgsl");class hk extends Ft{static get type(){return"ScriptableValueNode"}constructor(e=null){super(),this._value=e,this._cache=null,this.inputType=null,this.outputType=null,this.events=new bo,this.isScriptableValueNode=!0}get isScriptableOutputNode(){return this.outputType!==null}set value(e){this._value!==e&&(this._cache&&this.inputType==="URL"&&this.value.value instanceof ArrayBuffer&&(URL.revokeObjectURL(this._cache),this._cache=null),this._value=e,this.events.dispatchEvent({type:"change"}),this.refresh())}get value(){return this._value}refresh(){this.events.dispatchEvent({type:"refresh"})}getValue(){const e=this.value;if(e&&this._cache===null&&this.inputType==="URL"&&e.value instanceof ArrayBuffer)this._cache=URL.createObjectURL(new Blob([e.value]));else if(e&&e.value!==null&&e.value!==void 0&&((this.inputType==="URL"||this.inputType==="String")&&typeof e.value=="string"||this.inputType==="Number"&&typeof e.value=="number"||this.inputType==="Vector2"&&e.value.isVector2||this.inputType==="Vector3"&&e.value.isVector3||this.inputType==="Vector4"&&e.value.isVector4||this.inputType==="Color"&&e.value.isColor||this.inputType==="Matrix3"&&e.value.isMatrix3||this.inputType==="Matrix4"&&e.value.isMatrix4))return e.value;return this._cache||e}getNodeType(e){return this.value&&this.value.isNode?this.value.getNodeType(e):"float"}setup(){return this.value&&this.value.isNode?this.value:K()}serialize(e){super.serialize(e),this.value!==null?this.inputType==="ArrayBuffer"?e.value=d3(this.value):e.value=this.value?this.value.toJSON(e.meta).uuid:null:e.value=null,e.inputType=this.inputType,e.outputType=this.outputType}deserialize(e){super.deserialize(e);let t=null;e.value!==null&&(e.inputType==="ArrayBuffer"?t=p3(e.value):e.inputType==="Texture"?t=e.meta.textures[e.value]:t=e.meta.nodes[e.value]||null),this.value=t,this.inputType=e.inputType,this.outputType=e.outputType}}const ob=Ve(hk).setParameterLength(1);class rP extends Map{get(e,t=null,...n){if(this.has(e))return super.get(e);if(t!==null){const i=t(...n);return this.set(e,i),i}}}class fk{constructor(e){this.scriptableNode=e}get parameters(){return this.scriptableNode.parameters}get layout(){return this.scriptableNode.getLayout()}getInputLayout(e){return this.scriptableNode.getInputLayout(e)}get(e){const t=this.parameters[e];return t?t.getValue():null}}const lb=new rP;class dk extends Ft{static get type(){return"ScriptableNode"}constructor(e=null,t={}){super(),this.codeNode=e,this.parameters=t,this._local=new rP,this._output=ob(null),this._outputs={},this._source=this.source,this._method=null,this._object=null,this._value=null,this._needsOutputUpdate=!0,this.onRefresh=this.onRefresh.bind(this),this.isScriptableNode=!0}get source(){return this.codeNode?this.codeNode.code:""}setLocal(e,t){return this._local.set(e,t)}getLocal(e){return this._local.get(e)}onRefresh(){this._refresh()}getInputLayout(e){for(const t of this.getLayout())if(t.inputType&&(t.id===e||t.name===e))return t}getOutputLayout(e){for(const t of this.getLayout())if(t.outputType&&(t.id===e||t.name===e))return t}setOutput(e,t){const n=this._outputs;return n[e]===void 0?n[e]=ob(t):n[e].value=t,this}getOutput(e){return this._outputs[e]}getParameter(e){return this.parameters[e]}setParameter(e,t){const n=this.parameters;return t&&t.isScriptableNode?(this.deleteParameter(e),n[e]=t,n[e].getDefaultOutput().events.addEventListener("refresh",this.onRefresh)):t&&t.isScriptableValueNode?(this.deleteParameter(e),n[e]=t,n[e].events.addEventListener("refresh",this.onRefresh)):n[e]===void 0?(n[e]=ob(t),n[e].events.addEventListener("refresh",this.onRefresh)):n[e].value=t,this}getValue(){return this.getDefaultOutput().getValue()}deleteParameter(e){let t=this.parameters[e];return t&&(t.isScriptableNode&&(t=t.getDefaultOutput()),t.events.removeEventListener("refresh",this.onRefresh)),this}clearParameters(){for(const e of Object.keys(this.parameters))this.deleteParameter(e);return this.needsUpdate=!0,this}call(e,...t){const i=this.getObject()[e];if(typeof i=="function")return i(...t)}async callAsync(e,...t){const i=this.getObject()[e];if(typeof i=="function")return i.constructor.name==="AsyncFunction"?await i(...t):i(...t)}getNodeType(e){return this.getDefaultOutputNode().getNodeType(e)}refresh(e=null){e!==null?this.getOutput(e).refresh():this._refresh()}getObject(){if(this.needsUpdate&&this.dispose(),this._object!==null)return this._object;const e=()=>this.refresh(),t=(d,m)=>this.setOutput(d,m),n=new fk(this),i=lb.get("THREE"),s=lb.get("TSL"),a=this.getMethod(),l=[n,this._local,lb,e,t,i,s];this._object=a(...l);const c=this._object.layout;if(c&&(c.cache===!1&&this._local.clear(),this._output.outputType=c.outputType||null,Array.isArray(c.elements)))for(const d of c.elements){const m=d.id||d.name;d.inputType&&(this.getParameter(m)===void 0&&this.setParameter(m,null),this.getParameter(m).inputType=d.inputType),d.outputType&&(this.getOutput(m)===void 0&&this.setOutput(m,null),this.getOutput(m).outputType=d.outputType)}return this._object}deserialize(e){super.deserialize(e);for(const t in this.parameters){let n=this.parameters[t];n.isScriptableNode&&(n=n.getDefaultOutput()),n.events.addEventListener("refresh",this.onRefresh)}}getLayout(){return this.getObject().layout}getDefaultOutputNode(){const e=this.getDefaultOutput().value;return e&&e.isNode?e:K()}getDefaultOutput(){return this._exec()._output}getMethod(){if(this.needsUpdate&&this.dispose(),this._method!==null)return this._method;const e=["parameters","local","global","refresh","setOutput","THREE","TSL"],n=["layout","init","main","dispose"].join(", "),i="var "+n+`; var output = {};
`,s=`
return { ...output, `+n+" };",a=i+this.codeNode.code+s;return this._method=new Function(...e,a),this._method}dispose(){this._method!==null&&(this._object&&typeof this._object.dispose=="function"&&this._object.dispose(),this._method=null,this._object=null,this._source=null,this._value=null,this._needsOutputUpdate=!0,this._output.value=null,this._outputs={})}setup(){return this.getDefaultOutputNode()}getCacheKey(e){const t=[l3(this.source),this.getDefaultOutputNode().getCacheKey(e)];for(const n in this.parameters)t.push(this.parameters[n].getCacheKey(e));return UT(t)}set needsUpdate(e){e===!0&&this.dispose()}get needsUpdate(){return this.source!==this._source}_exec(){return this.codeNode===null?this:(this._needsOutputUpdate===!0&&(this._value=this.call("main"),this._needsOutputUpdate=!1),this._output.value=this._value,this)}_refresh(){this.needsUpdate=!0,this._exec(),this._output.refresh()}}const pk=Ve(dk).setParameterLength(1,2);function aP(r){let e;const t=r.context.getViewZ;return t!==void 0&&(e=t(this)),(e||xs.z).negate()}const SN=ge(([r,e],t)=>{const n=aP(t);return Vu(r,e,n)}),bN=ge(([r],e)=>{const t=aP(e);return r.mul(r,t,t).negate().exp().oneMinus()}),P_=ge(([r,e])=>Dt(e.toFloat().mix(yg.rgb,r.toVec3()),yg.a));function mk(r,e,t){return console.warn('THREE.TSL: "rangeFog( color, near, far )" is deprecated. Use "fog( color, rangeFogFactor( near, far ) )" instead.'),P_(r,SN(e,t))}function gk(r,e){return console.warn('THREE.TSL: "densityFog( color, density )" is deprecated. Use "fog( color, densityFogFactor( density ) )" instead.'),P_(r,bN(e))}let Td=null,Md=null;class yk extends Ft{static get type(){return"RangeNode"}constructor(e=K(),t=K()){super(),this.minNode=e,this.maxNode=t}getVectorLength(e){const t=e.getTypeLength($h(this.minNode.value)),n=e.getTypeLength($h(this.maxNode.value));return t>n?t:n}getNodeType(e){return e.object.count>1?e.getTypeFromLength(this.getVectorLength(e)):"float"}setup(e){const t=e.object;let n=null;if(t.count>1){const i=this.minNode.value,s=this.maxNode.value,a=e.getTypeLength($h(i)),l=e.getTypeLength($h(s));Td=Td||new Ot,Md=Md||new Ot,Td.setScalar(0),Md.setScalar(0),a===1?Td.setScalar(i):i.isColor?Td.set(i.r,i.g,i.b,1):Td.set(i.x,i.y,i.z||0,i.w||0),l===1?Md.setScalar(s):s.isColor?Md.set(s.r,s.g,s.b,1):Md.set(s.x,s.y,s.z||0,s.w||0);const c=4,d=c*t.count,m=new Float32Array(d);for(let v=0;v<d;v++){const x=v%c,S=Td.getComponent(x),A=Md.getComponent(x);m[v]=P1.lerp(S,A,Math.random())}const y=this.getNodeType(e);if(t.count<=4096)n=r0(m,"vec4",t.count).element(of).convert(y);else{const v=new Qo(m,4);e.geometry.setAttribute("__range"+this.id,v),n=Rb(v).convert(y)}}else n=K(0);return n}}const vk=Ve(yk).setParameterLength(2);class _k extends Ft{static get type(){return"ComputeBuiltinNode"}constructor(e,t){super(t),this._builtinName=e}getHash(e){return this.getBuiltinName(e)}getNodeType(){return this.nodeType}setBuiltinName(e){return this._builtinName=e,this}getBuiltinName(){return this._builtinName}hasBuiltin(e){return e.hasBuiltin(this._builtinName)}generate(e,t){const n=this.getBuiltinName(e),i=this.getNodeType(e);return e.shaderStage==="compute"?e.format(n,i,t):(console.warn(`ComputeBuiltinNode: Compute built-in value ${n} can not be accessed in the ${e.shaderStage} stage`),e.generateConst(i))}serialize(e){super.serialize(e),e.global=this.global,e._builtinName=this._builtinName}deserialize(e){super.deserialize(e),this.global=e.global,this._builtinName=e._builtinName}}const f0=(r,e)=>ze(new _k(r,e)),xk=f0("numWorkgroups","uvec3"),Sk=f0("workgroupId","uvec3"),bk=f0("globalId","uvec3"),Tk=f0("localId","uvec3"),Mk=f0("subgroupSize","uint");class Ek extends Ft{constructor(e){super(),this.scope=e}generate(e){const{scope:t}=this,{renderer:n}=e;n.backend.isWebGLBackend===!0?e.addFlowCode(`	// ${t}Barrier 
`):e.addLineFlowCode(`${t}Barrier()`,this)}}const TN=Ve(Ek),Ak=()=>TN("workgroup").append(),Rk=()=>TN("storage").append(),Nk=()=>TN("texture").append();class Ck extends Ap{constructor(e,t){super(e,t),this.isWorkgroupInfoElementNode=!0}generate(e,t){let n;const i=e.context.assign;if(n=super.generate(e),i!==!0){const s=this.getNodeType(e);n=e.format(n,s,t)}return n}}class wk extends Ft{constructor(e,t,n=0){super(t),this.bufferType=t,this.bufferCount=n,this.isWorkgroupInfoNode=!0,this.elementType=t,this.scope=e}label(e){return this.name=e,this}setScope(e){return this.scope=e,this}getElementType(){return this.elementType}getInputType(){return`${this.scope}Array`}element(e){return ze(new Ck(this,e))}generate(e){return e.getScopedArray(this.name||`${this.scope}Array_${this.id}`,this.scope.toLowerCase(),this.bufferType,this.bufferCount)}}const Dk=(r,e)=>ze(new wk("Workgroup",r,e));class Ks extends es{static get type(){return"AtomicFunctionNode"}constructor(e,t,n){super("uint"),this.method=e,this.pointerNode=t,this.valueNode=n}getInputType(e){return this.pointerNode.getNodeType(e)}getNodeType(e){return this.getInputType(e)}generate(e){const t=this.method,n=this.getNodeType(e),i=this.getInputType(e),s=this.pointerNode,a=this.valueNode,l=[];l.push(`&${s.build(e,i)}`),a!==null&&l.push(a.build(e,i));const c=`${e.getMethod(t,n)}( ${l.join(", ")} )`;return a!==null&&e.addLineFlowCode(c,this),c}}Ks.ATOMIC_LOAD="atomicLoad";Ks.ATOMIC_STORE="atomicStore";Ks.ATOMIC_ADD="atomicAdd";Ks.ATOMIC_SUB="atomicSub";Ks.ATOMIC_MAX="atomicMax";Ks.ATOMIC_MIN="atomicMin";Ks.ATOMIC_AND="atomicAnd";Ks.ATOMIC_OR="atomicOr";Ks.ATOMIC_XOR="atomicXor";const Uk=Ve(Ks),ju=(r,e,t)=>{const n=Uk(r,e,t);return n.append(),n},Lk=r=>ju(Ks.ATOMIC_LOAD,r,null),Bk=(r,e)=>ju(Ks.ATOMIC_STORE,r,e),Ok=(r,e)=>ju(Ks.ATOMIC_ADD,r,e),Pk=(r,e)=>ju(Ks.ATOMIC_SUB,r,e),Ik=(r,e)=>ju(Ks.ATOMIC_MAX,r,e),Fk=(r,e)=>ju(Ks.ATOMIC_MIN,r,e),zk=(r,e)=>ju(Ks.ATOMIC_AND,r,e),Vk=(r,e)=>ju(Ks.ATOMIC_OR,r,e),Gk=(r,e)=>ju(Ks.ATOMIC_XOR,r,e);let VS;function tM(r){VS=VS||new WeakMap;let e=VS.get(r);return e===void 0&&VS.set(r,e={}),e}function MN(r){const e=tM(r);return e.shadowMatrix||(e.shadowMatrix=Ct("mat4").setGroup(Gt).onRenderUpdate(()=>(r.castShadow!==!0&&r.shadow.updateMatrices(r),r.shadow.matrix)))}function oP(r,e=Oc){const t=MN(r).mul(e);return t.xyz.div(t.w)}function EN(r){const e=tM(r);return e.position||(e.position=Ct(new Y).setGroup(Gt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(r.matrixWorld)))}function lP(r){const e=tM(r);return e.targetPosition||(e.targetPosition=Ct(new Y).setGroup(Gt).onRenderUpdate((t,n)=>n.value.setFromMatrixPosition(r.target.matrixWorld)))}function AN(r){const e=tM(r);return e.viewPosition||(e.viewPosition=Ct(new Y).setGroup(Gt).onRenderUpdate(({camera:t},n)=>{n.value=n.value||new Y,n.value.setFromMatrixPosition(r.matrixWorld),n.value.applyMatrix4(t.matrixWorldInverse)}))}const RN=r=>Za.transformDirection(EN(r).sub(lP(r))),Hk=r=>r.sort((e,t)=>e.id-t.id),kk=(r,e)=>{for(const t of e)if(t.isAnalyticLightNode&&t.light.id===r)return t;return null},ZE=new WeakMap;class NN extends Ft{static get type(){return"LightsNode"}constructor(){super("vec3"),this.totalDiffuseNode=ae().toVar(),this.totalSpecularNode=ae().toVar(),this.outgoingLightNode=ae().toVar(),this._lights=[],this._lightNodes=null,this._lightNodesHash=null,this.global=!0}customCacheKey(){const e=[],t=this._lights;for(let n=0;n<t.length;n++)e.push(t[n].id);return UT(e)}getHash(e){if(this._lightNodesHash===null){this._lightNodes===null&&this.setupLightsNode(e);const t=[];for(const n of this._lightNodes)t.push(n.getSelf().getHash());this._lightNodesHash="lights-"+t.join(",")}return this._lightNodesHash}analyze(e){const t=e.getDataFromNode(this);for(const n of t.nodes)n.build(e)}setupLightsNode(e){const t=[],n=this._lightNodes,i=Hk(this._lights),s=e.renderer.library;for(const a of i)if(a.isNode)t.push(ze(a));else{let l=null;if(n!==null&&(l=kk(a.id,n)),l===null){const c=s.getLightNodeClass(a.constructor);if(c===null){console.warn(`LightsNode.setupNodeLights: Light node not found for ${a.constructor.name}`);continue}let d=null;ZE.has(a)?d=ZE.get(a):(d=ze(new c(a)),ZE.set(a,d)),t.push(d)}}this._lightNodes=t}setupDirectLight(e,t,n){const{lightingModel:i,reflectedLight:s}=e.context;i.direct({...n,lightNode:t,reflectedLight:s},e)}setupDirectRectAreaLight(e,t,n){const{lightingModel:i,reflectedLight:s}=e.context;i.directRectArea({...n,lightNode:t,reflectedLight:s},e)}setupLights(e,t){for(const n of t)n.build(e)}getLightNodes(e){return this._lightNodes===null&&this.setupLightsNode(e),this._lightNodes}setup(e){const t=e.lightsNode;e.lightsNode=this;let n=this.outgoingLightNode;const i=e.context,s=i.lightingModel,a=e.getDataFromNode(this);if(s){const{totalDiffuseNode:l,totalSpecularNode:c}=this;i.outgoingLight=n;const d=e.addStack();a.nodes=d.nodes,s.start(e);const{backdrop:m,backdropAlpha:y}=i,{directDiffuse:v,directSpecular:x,indirectDiffuse:S,indirectSpecular:A}=i.reflectedLight;let E=v.add(S);m!==null&&(y!==null?E=ae(y.mix(E,m)):E=ae(m),i.material.transparent=!0),l.assign(E),c.assign(x.add(A)),n.assign(l.add(c)),s.finish(e),n=n.bypass(e.removeStack())}else a.nodes=[];return e.lightsNode=t,n}setLights(e){return this._lights=e,this._lightNodes=null,this._lightNodesHash=null,this}getLights(){return this._lights}get hasLights(){return this._lights.length>0}}const qk=(r=[])=>ze(new NN).setLights(r);class Wk extends Ft{static get type(){return"ShadowBaseNode"}constructor(e){super(),this.light=e,this.updateBeforeType=en.RENDER,this.isShadowBaseNode=!0}setupShadowPosition({context:e,material:t}){CN.assign(t.shadowPositionNode||e.shadowPositionWorld||Oc)}dispose(){this.updateBeforeType=en.NONE}}const CN=sy("vec3","shadowPositionWorld");function Xk(r,e={}){return e.toneMapping=r.toneMapping,e.toneMappingExposure=r.toneMappingExposure,e.outputColorSpace=r.outputColorSpace,e.renderTarget=r.getRenderTarget(),e.activeCubeFace=r.getActiveCubeFace(),e.activeMipmapLevel=r.getActiveMipmapLevel(),e.renderObjectFunction=r.getRenderObjectFunction(),e.pixelRatio=r.getPixelRatio(),e.mrt=r.getMRT(),e.clearColor=r.getClearColor(e.clearColor||new ft),e.clearAlpha=r.getClearAlpha(),e.autoClear=r.autoClear,e.scissorTest=r.getScissorTest(),e}function Yk(r,e){return e=Xk(r,e),r.setMRT(null),r.setRenderObjectFunction(null),r.setClearColor(0,1),r.autoClear=!0,e}function jk(r,e){r.toneMapping=e.toneMapping,r.toneMappingExposure=e.toneMappingExposure,r.outputColorSpace=e.outputColorSpace,r.setRenderTarget(e.renderTarget,e.activeCubeFace,e.activeMipmapLevel),r.setRenderObjectFunction(e.renderObjectFunction),r.setPixelRatio(e.pixelRatio),r.setMRT(e.mrt),r.setClearColor(e.clearColor,e.clearAlpha),r.autoClear=e.autoClear,r.setScissorTest(e.scissorTest)}function Zk(r,e={}){return e.background=r.background,e.backgroundNode=r.backgroundNode,e.overrideMaterial=r.overrideMaterial,e}function Kk(r,e){return e=Zk(r,e),r.background=null,r.backgroundNode=null,r.overrideMaterial=null,e}function Qk(r,e){r.background=e.background,r.backgroundNode=e.backgroundNode,r.overrideMaterial=e.overrideMaterial}function Jk(r,e,t){return t=Yk(r,t),t=Kk(e,t),t}function $k(r,e,t){jk(r,t),Qk(e,t)}const w2=new WeakMap,eq=ge(([r,e,t])=>{let n=Oc.sub(r).length();return n=n.sub(e).div(t.sub(e)),n=n.saturate(),n}),tq=r=>{const e=r.shadow.camera,t=_i("near","float",e).setGroup(Gt),n=_i("far","float",e).setGroup(Gt),i=tB(r);return eq(i,t,n)},nq=r=>{let e=w2.get(r);if(e===void 0){const t=r.isPointLight?tq(r):null;e=new Ts,e.colorNode=Dt(0,0,0,1),e.depthNode=t,e.isShadowPassMaterial=!0,e.name="ShadowMaterial",e.fog=!1,w2.set(r,e)}return e},uP=ge(({depthTexture:r,shadowCoord:e})=>En(r,e.xy).compare(e.z)),cP=ge(({depthTexture:r,shadowCoord:e,shadow:t})=>{const n=(A,E)=>En(r,A).compare(E),i=_i("mapSize","vec2",t).setGroup(Gt),s=_i("radius","float",t).setGroup(Gt),a=Qe(1).div(i),l=a.x.negate().mul(s),c=a.y.negate().mul(s),d=a.x.mul(s),m=a.y.mul(s),y=l.div(2),v=c.div(2),x=d.div(2),S=m.div(2);return bs(n(e.xy.add(Qe(l,c)),e.z),n(e.xy.add(Qe(0,c)),e.z),n(e.xy.add(Qe(d,c)),e.z),n(e.xy.add(Qe(y,v)),e.z),n(e.xy.add(Qe(0,v)),e.z),n(e.xy.add(Qe(x,v)),e.z),n(e.xy.add(Qe(l,0)),e.z),n(e.xy.add(Qe(y,0)),e.z),n(e.xy,e.z),n(e.xy.add(Qe(x,0)),e.z),n(e.xy.add(Qe(d,0)),e.z),n(e.xy.add(Qe(y,S)),e.z),n(e.xy.add(Qe(0,S)),e.z),n(e.xy.add(Qe(x,S)),e.z),n(e.xy.add(Qe(l,m)),e.z),n(e.xy.add(Qe(0,m)),e.z),n(e.xy.add(Qe(d,m)),e.z)).mul(1/17)}),hP=ge(({depthTexture:r,shadowCoord:e,shadow:t})=>{const n=(m,y)=>En(r,m).compare(y),i=_i("mapSize","vec2",t).setGroup(Gt),s=Qe(1).div(i),a=s.x,l=s.y,c=e.xy,d=kc(c.mul(i).add(.5));return c.subAssign(d.mul(s)),bs(n(c,e.z),n(c.add(Qe(a,0)),e.z),n(c.add(Qe(0,l)),e.z),n(c.add(s),e.z),ei(n(c.add(Qe(a.negate(),0)),e.z),n(c.add(Qe(a.mul(2),0)),e.z),d.x),ei(n(c.add(Qe(a.negate(),l)),e.z),n(c.add(Qe(a.mul(2),l)),e.z),d.x),ei(n(c.add(Qe(0,l.negate())),e.z),n(c.add(Qe(0,l.mul(2))),e.z),d.y),ei(n(c.add(Qe(a,l.negate())),e.z),n(c.add(Qe(a,l.mul(2))),e.z),d.y),ei(ei(n(c.add(Qe(a.negate(),l.negate())),e.z),n(c.add(Qe(a.mul(2),l.negate())),e.z),d.x),ei(n(c.add(Qe(a.negate(),l.mul(2))),e.z),n(c.add(Qe(a.mul(2),l.mul(2))),e.z),d.x),d.y)).mul(1/9)}),fP=ge(({depthTexture:r,shadowCoord:e})=>{const t=K(1).toVar(),n=En(r).sample(e.xy).rg,i=GT(e.z,n.x);return ln(i.notEqual(K(1)),()=>{const s=e.z.sub(n.x),a=fs(0,n.y.mul(n.y));let l=a.div(a.add(s.mul(s)));l=zu(On(l,.3).div(.95-.3)),t.assign(zu(fs(i,l)))}),t}),iq=ge(({samples:r,radius:e,size:t,shadowPass:n})=>{const i=K(0).toVar(),s=K(0).toVar(),a=r.lessThanEqual(K(1)).select(K(0),K(2).div(r.sub(1))),l=r.lessThanEqual(K(1)).select(K(0),K(-1));ti({start:ee(0),end:ee(r),type:"int",condition:"<"},({i:d})=>{const m=l.add(K(d).mul(a)),y=n.sample(bs(h0.xy,Qe(0,m).mul(e)).div(t)).x;i.addAssign(y),s.addAssign(y.mul(y))}),i.divAssign(r),s.divAssign(r);const c=Yu(s.sub(i.mul(i)));return Qe(i,c)}),sq=ge(({samples:r,radius:e,size:t,shadowPass:n})=>{const i=K(0).toVar(),s=K(0).toVar(),a=r.lessThanEqual(K(1)).select(K(0),K(2).div(r.sub(1))),l=r.lessThanEqual(K(1)).select(K(0),K(-1));ti({start:ee(0),end:ee(r),type:"int",condition:"<"},({i:d})=>{const m=l.add(K(d).mul(a)),y=n.sample(bs(h0.xy,Qe(m,0).mul(e)).div(t));i.addAssign(y.x),s.addAssign(bs(y.y.mul(y.y),y.x.mul(y.x)))}),i.divAssign(r),s.divAssign(r);const c=Yu(s.sub(i.mul(i)));return Qe(i,c)}),rq=[uP,cP,hP,fP];let KE;const GS=new _N;class dP extends Wk{static get type(){return"ShadowNode"}constructor(e,t=null){super(e),this.shadow=t||e.shadow,this.shadowMap=null,this.vsmShadowMapVertical=null,this.vsmShadowMapHorizontal=null,this.vsmMaterialVertical=null,this.vsmMaterialHorizontal=null,this._node=null,this._cameraFrameId=new WeakMap,this.isShadowNode=!0}setupShadowFilter(e,{filterFn:t,depthTexture:n,shadowCoord:i,shadow:s}){const a=i.x.greaterThanEqual(0).and(i.x.lessThanEqual(1)).and(i.y.greaterThanEqual(0)).and(i.y.lessThanEqual(1)).and(i.z.lessThanEqual(1)),l=t({depthTexture:n,shadowCoord:i,shadow:s});return a.select(l,K(1))}setupShadowCoord(e,t){const{shadow:n}=this,{renderer:i}=e,s=_i("bias","float",n).setGroup(Gt);let a=t,l;if(n.camera.isOrthographicCamera||i.logarithmicDepthBuffer!==!0)a=a.xyz.div(a.w),l=a.z,i.coordinateSystem===Vl&&(l=l.mul(2).sub(1));else{const c=a.w;a=a.xy.div(c);const d=_i("near","float",n.camera).setGroup(Gt),m=_i("far","float",n.camera).setGroup(Gt);l=lN(c.negate(),d,m)}return a=ae(a.x,a.y.oneMinus(),l.add(s)),a}getShadowFilterFn(e){return rq[e]}setupShadow(e){const{renderer:t}=e,{light:n,shadow:i}=this,s=t.shadowMap.type,a=new ya(i.mapSize.width,i.mapSize.height);a.compareFunction=q_;const l=e.createRenderTarget(i.mapSize.width,i.mapSize.height);if(l.depthTexture=a,i.camera.updateProjectionMatrix(),s===ua){a.compareFunction=null,this.vsmShadowMapVertical=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:lf,type:Ys}),this.vsmShadowMapHorizontal=e.createRenderTarget(i.mapSize.width,i.mapSize.height,{format:lf,type:Ys});const M=En(a),C=En(this.vsmShadowMapVertical.texture),w=_i("blurSamples","float",i).setGroup(Gt),D=_i("radius","float",i).setGroup(Gt),z=_i("mapSize","vec2",i).setGroup(Gt);let B=this.vsmMaterialVertical||(this.vsmMaterialVertical=new Ts);B.fragmentNode=iq({samples:w,radius:D,size:z,shadowPass:M}).context(e.getSharedContext()),B.name="VSMVertical",B=this.vsmMaterialHorizontal||(this.vsmMaterialHorizontal=new Ts),B.fragmentNode=sq({samples:w,radius:D,size:z,shadowPass:C}).context(e.getSharedContext()),B.name="VSMHorizontal"}const c=_i("intensity","float",i).setGroup(Gt),d=_i("normalBias","float",i).setGroup(Gt),m=MN(n).mul(CN.add(YT.mul(d))),y=this.setupShadowCoord(e,m),v=i.filterNode||this.getShadowFilterFn(t.shadowMap.type)||null;if(v===null)throw new Error("THREE.WebGPURenderer: Shadow map type not supported yet.");const x=s===ua?this.vsmShadowMapHorizontal.texture:a,S=this.setupShadowFilter(e,{filterFn:v,shadowTexture:l.texture,depthTexture:x,shadowCoord:y,shadow:i}),A=En(l.texture,y),E=ei(1,S.rgb.mix(A,1),c.mul(A.a)).toVar();return this.shadowMap=l,this.shadow.map=l,E}setup(e){if(e.renderer.shadowMap.enabled!==!1)return ge(()=>{let t=this._node;return this.setupShadowPosition(e),t===null&&(this._node=t=this.setupShadow(e)),e.material.shadowNode&&console.warn('THREE.NodeMaterial: ".shadowNode" is deprecated. Use ".castShadowNode" instead.'),e.material.receivedShadowNode&&(t=e.material.receivedShadowNode(t)),t})()}renderShadow(e){const{shadow:t,shadowMap:n,light:i}=this,{renderer:s,scene:a}=e;t.updateMatrices(i),n.setSize(t.mapSize.width,t.mapSize.height),s.render(a,t.camera)}updateShadow(e){const{shadowMap:t,light:n,shadow:i}=this,{renderer:s,scene:a,camera:l}=e,c=s.shadowMap.type,d=t.depthTexture.version;this._depthVersionCached=d,i.camera.layers.mask=l.layers.mask;const m=s.getRenderObjectFunction(),y=s.getMRT(),v=y?y.has("velocity"):!1;KE=Jk(s,a,KE),a.overrideMaterial=nq(n),s.setRenderObjectFunction((x,S,A,E,M,C,...w)=>{(x.castShadow===!0||x.receiveShadow&&c===ua)&&(v&&(f3(x).useVelocity=!0),x.onBeforeShadow(s,x,l,i.camera,E,S.overrideMaterial,C),s.renderObject(x,S,A,E,M,C,...w),x.onAfterShadow(s,x,l,i.camera,E,S.overrideMaterial,C))}),s.setRenderTarget(t),this.renderShadow(e),s.setRenderObjectFunction(m),n.isPointLight!==!0&&c===ua&&this.vsmPass(s),$k(s,a,KE)}vsmPass(e){const{shadow:t}=this;this.vsmShadowMapVertical.setSize(t.mapSize.width,t.mapSize.height),this.vsmShadowMapHorizontal.setSize(t.mapSize.width,t.mapSize.height),e.setRenderTarget(this.vsmShadowMapVertical),GS.material=this.vsmMaterialVertical,GS.render(e),e.setRenderTarget(this.vsmShadowMapHorizontal),GS.material=this.vsmMaterialHorizontal,GS.render(e)}dispose(){this.shadowMap.dispose(),this.shadowMap=null,this.vsmShadowMapVertical!==null&&(this.vsmShadowMapVertical.dispose(),this.vsmShadowMapVertical=null,this.vsmMaterialVertical.dispose(),this.vsmMaterialVertical=null),this.vsmShadowMapHorizontal!==null&&(this.vsmShadowMapHorizontal.dispose(),this.vsmShadowMapHorizontal=null,this.vsmMaterialHorizontal.dispose(),this.vsmMaterialHorizontal=null),super.dispose()}updateBefore(e){const{shadow:t}=this;let n=t.needsUpdate||t.autoUpdate;n&&(this._cameraFrameId[e.camera]===e.frameId&&(n=!1),this._cameraFrameId[e.camera]=e.frameId),n&&(this.updateShadow(e),this.shadowMap.depthTexture.version===this._depthVersionCached&&(t.needsUpdate=!1))}}const pP=(r,e)=>ze(new dP(r,e)),aq=new ft,Ul=ge(([r,e])=>{const t=r.toVar(),n=Ai(t),i=kl(1,fs(n.x,fs(n.y,n.z)));n.mulAssign(i),t.mulAssign(i.mul(e.mul(2).oneMinus()));const s=Qe(t.xy).toVar(),l=e.mul(1.5).oneMinus();return ln(n.z.greaterThanEqual(l),()=>{ln(t.z.greaterThan(0),()=>{s.x.assign(On(4,t.x))})}).ElseIf(n.x.greaterThanEqual(l),()=>{const c=B_(t.x);s.x.assign(t.z.mul(c).add(c.mul(2)))}).ElseIf(n.y.greaterThanEqual(l),()=>{const c=B_(t.y);s.x.assign(t.x.add(c.mul(2)).add(2)),s.y.assign(t.z.mul(c).sub(2))}),Qe(.125,.25).mul(s).add(Qe(.375,.75)).flipY()}).setLayout({name:"cubeToUV",type:"vec2",inputs:[{name:"pos",type:"vec3"},{name:"texelSizeY",type:"float"}]}),mP=ge(({depthTexture:r,bd3D:e,dp:t,texelSize:n})=>En(r,Ul(e,n.y)).compare(t)),gP=ge(({depthTexture:r,bd3D:e,dp:t,texelSize:n,shadow:i})=>{const s=_i("radius","float",i).setGroup(Gt),a=Qe(-1,1).mul(s).mul(n.y);return En(r,Ul(e.add(a.xyy),n.y)).compare(t).add(En(r,Ul(e.add(a.yyy),n.y)).compare(t)).add(En(r,Ul(e.add(a.xyx),n.y)).compare(t)).add(En(r,Ul(e.add(a.yyx),n.y)).compare(t)).add(En(r,Ul(e,n.y)).compare(t)).add(En(r,Ul(e.add(a.xxy),n.y)).compare(t)).add(En(r,Ul(e.add(a.yxy),n.y)).compare(t)).add(En(r,Ul(e.add(a.xxx),n.y)).compare(t)).add(En(r,Ul(e.add(a.yxx),n.y)).compare(t)).mul(1/9)}),oq=ge(({filterFn:r,depthTexture:e,shadowCoord:t,shadow:n})=>{const i=t.xyz.toVar(),s=i.length(),a=Ct("float").setGroup(Gt).onRenderUpdate(()=>n.camera.near),l=Ct("float").setGroup(Gt).onRenderUpdate(()=>n.camera.far),c=_i("bias","float",n).setGroup(Gt),d=Ct(n.mapSize).setGroup(Gt),m=K(1).toVar();return ln(s.sub(l).lessThanEqual(0).and(s.sub(a).greaterThanEqual(0)),()=>{const y=s.sub(a).div(l.sub(a)).toVar();y.addAssign(c);const v=i.normalize(),x=Qe(1).div(d.mul(Qe(4,2)));m.assign(r({depthTexture:e,bd3D:v,dp:y,texelSize:x,shadow:n}))}),m}),D2=new Ot,Jm=new Xe,Wv=new Xe;class lq extends dP{static get type(){return"PointShadowNode"}constructor(e,t=null){super(e,t)}getShadowFilterFn(e){return e===T1?mP:gP}setupShadowCoord(e,t){return t}setupShadowFilter(e,{filterFn:t,shadowTexture:n,depthTexture:i,shadowCoord:s,shadow:a}){return oq({filterFn:t,shadowTexture:n,depthTexture:i,shadowCoord:s,shadow:a})}renderShadow(e){const{shadow:t,shadowMap:n,light:i}=this,{renderer:s,scene:a}=e,l=t.getFrameExtents();Wv.copy(t.mapSize),Wv.multiply(l),n.setSize(Wv.width,Wv.height),Jm.copy(t.mapSize);const c=s.autoClear,d=s.getClearColor(aq),m=s.getClearAlpha();s.autoClear=!1,s.setClearColor(t.clearColor,t.clearAlpha),s.clear();const y=t.getViewportCount();for(let v=0;v<y;v++){const x=t.getViewport(v),S=Jm.x*x.x,A=Wv.y-Jm.y-Jm.y*x.y;D2.set(S,A,Jm.x*x.z,Jm.y*x.w),n.viewport.copy(D2),t.updateMatrices(i,v),s.render(a,t.camera)}s.autoClear=c,s.setClearColor(d,m)}}const yP=(r,e)=>ze(new lq(r,e));class wp extends ry{static get type(){return"AnalyticLightNode"}constructor(e=null){super(),this.light=e,this.color=new ft,this.colorNode=e&&e.colorNode||Ct(this.color).setGroup(Gt),this.baseColorNode=null,this.shadowNode=null,this.shadowColorNode=null,this.isAnalyticLightNode=!0,this.updateType=en.FRAME}customCacheKey(){return R_(this.light.id,this.light.castShadow?1:0)}getHash(){return this.light.uuid}getLightVector(e){return AN(this.light).sub(e.context.positionView||xs)}setupDirect(){}setupDirectRectArea(){}setupShadowNode(){return pP(this.light)}setupShadow(e){const{renderer:t}=e;if(t.shadowMap.enabled===!1)return;let n=this.shadowColorNode;if(n===null){const i=this.light.shadow.shadowNode;let s;i!==void 0?s=ze(i):s=this.setupShadowNode(),this.shadowNode=s,this.shadowColorNode=n=this.colorNode.mul(s),this.baseColorNode=this.colorNode}this.colorNode=n}setup(e){this.colorNode=this.baseColorNode||this.colorNode,this.light.castShadow?e.object.receiveShadow&&this.setupShadow(e):this.shadowNode!==null&&(this.shadowNode.dispose(),this.shadowNode=null,this.shadowColorNode=null);const t=this.setupDirect(e),n=this.setupDirectRectArea(e);t&&e.lightsNode.setupDirectLight(e,this,t),n&&e.lightsNode.setupDirectRectAreaLight(e,this,n)}update(){const{light:e}=this;this.color.copy(e.color).multiplyScalar(e.intensity)}}const wN=ge(({lightDistance:r,cutoffDistance:e,decayExponent:t})=>{const n=r.pow(t).max(.01).reciprocal();return e.greaterThan(0).select(n.mul(r.div(e).pow4().oneMinus().clamp().pow2()),n)}),vP=({color:r,lightVector:e,cutoffDistance:t,decayExponent:n})=>{const i=e.normalize(),s=e.length(),a=wN({lightDistance:s,cutoffDistance:t,decayExponent:n}),l=r.mul(a);return{lightDirection:i,lightColor:l}};class uq extends wp{static get type(){return"PointLightNode"}constructor(e=null){super(e),this.cutoffDistanceNode=Ct(0).setGroup(Gt),this.decayExponentNode=Ct(2).setGroup(Gt)}update(e){const{light:t}=this;super.update(e),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}setupShadowNode(){return yP(this.light)}setupDirect(e){return vP({color:this.colorNode,lightVector:this.getLightVector(e),cutoffDistance:this.cutoffDistanceNode,decayExponent:this.decayExponentNode})}}const cq=ge(([r=Vi()])=>{const e=r.mul(2),t=e.x.floor(),n=e.y.floor();return t.add(n).mod(2).sign()}),hq=ge(([r=Vi()],{renderer:e,material:t})=>{const n=K(1).toVar(),i=WR(r.mul(2).sub(1));if(t.alphaToCoverage&&e.samples>1){const s=K(i.fwidth()).toVar();n.assign(Vu(s.oneMinus(),s.add(1),i).oneMinus())}else i.greaterThan(1).discard();return n}),f_=ge(([r,e,t])=>{const n=K(t).toVar(),i=K(e).toVar(),s=Vc(r).toVar();return Sr(s,i,n)}).setLayout({name:"mx_select",type:"float",inputs:[{name:"b",type:"bool"},{name:"t",type:"float"},{name:"f",type:"float"}]}),Db=ge(([r,e])=>{const t=Vc(e).toVar(),n=K(r).toVar();return Sr(t,n.negate(),n)}).setLayout({name:"mx_negate_if",type:"float",inputs:[{name:"val",type:"float"},{name:"b",type:"bool"}]}),Ss=ge(([r])=>{const e=K(r).toVar();return ee(Bu(e))}).setLayout({name:"mx_floor",type:"int",inputs:[{name:"x",type:"float"}]}),zi=ge(([r,e])=>{const t=K(r).toVar();return e.assign(Ss(t)),t.sub(K(e))}),fq=ge(([r,e,t,n,i,s])=>{const a=K(s).toVar(),l=K(i).toVar(),c=K(n).toVar(),d=K(t).toVar(),m=K(e).toVar(),y=K(r).toVar(),v=K(On(1,l)).toVar();return On(1,a).mul(y.mul(v).add(m.mul(l))).add(a.mul(d.mul(v).add(c.mul(l))))}).setLayout({name:"mx_bilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"}]}),dq=ge(([r,e,t,n,i,s])=>{const a=K(s).toVar(),l=K(i).toVar(),c=ae(n).toVar(),d=ae(t).toVar(),m=ae(e).toVar(),y=ae(r).toVar(),v=K(On(1,l)).toVar();return On(1,a).mul(y.mul(v).add(m.mul(l))).add(a.mul(d.mul(v).add(c.mul(l))))}).setLayout({name:"mx_bilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"}]}),_P=Tr([fq,dq]),pq=ge(([r,e,t,n,i,s,a,l,c,d,m])=>{const y=K(m).toVar(),v=K(d).toVar(),x=K(c).toVar(),S=K(l).toVar(),A=K(a).toVar(),E=K(s).toVar(),M=K(i).toVar(),C=K(n).toVar(),w=K(t).toVar(),D=K(e).toVar(),z=K(r).toVar(),B=K(On(1,x)).toVar(),F=K(On(1,v)).toVar();return K(On(1,y)).toVar().mul(F.mul(z.mul(B).add(D.mul(x))).add(v.mul(w.mul(B).add(C.mul(x))))).add(y.mul(F.mul(M.mul(B).add(E.mul(x))).add(v.mul(A.mul(B).add(S.mul(x))))))}).setLayout({name:"mx_trilerp_0",type:"float",inputs:[{name:"v0",type:"float"},{name:"v1",type:"float"},{name:"v2",type:"float"},{name:"v3",type:"float"},{name:"v4",type:"float"},{name:"v5",type:"float"},{name:"v6",type:"float"},{name:"v7",type:"float"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),mq=ge(([r,e,t,n,i,s,a,l,c,d,m])=>{const y=K(m).toVar(),v=K(d).toVar(),x=K(c).toVar(),S=ae(l).toVar(),A=ae(a).toVar(),E=ae(s).toVar(),M=ae(i).toVar(),C=ae(n).toVar(),w=ae(t).toVar(),D=ae(e).toVar(),z=ae(r).toVar(),B=K(On(1,x)).toVar(),F=K(On(1,v)).toVar();return K(On(1,y)).toVar().mul(F.mul(z.mul(B).add(D.mul(x))).add(v.mul(w.mul(B).add(C.mul(x))))).add(y.mul(F.mul(M.mul(B).add(E.mul(x))).add(v.mul(A.mul(B).add(S.mul(x))))))}).setLayout({name:"mx_trilerp_1",type:"vec3",inputs:[{name:"v0",type:"vec3"},{name:"v1",type:"vec3"},{name:"v2",type:"vec3"},{name:"v3",type:"vec3"},{name:"v4",type:"vec3"},{name:"v5",type:"vec3"},{name:"v6",type:"vec3"},{name:"v7",type:"vec3"},{name:"s",type:"float"},{name:"t",type:"float"},{name:"r",type:"float"}]}),xP=Tr([pq,mq]),gq=ge(([r,e,t])=>{const n=K(t).toVar(),i=K(e).toVar(),s=pt(r).toVar(),a=pt(s.bitAnd(pt(7))).toVar(),l=K(f_(a.lessThan(pt(4)),i,n)).toVar(),c=K(tn(2,f_(a.lessThan(pt(4)),n,i))).toVar();return Db(l,Vc(a.bitAnd(pt(1)))).add(Db(c,Vc(a.bitAnd(pt(2)))))}).setLayout({name:"mx_gradient_float_0",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"}]}),yq=ge(([r,e,t,n])=>{const i=K(n).toVar(),s=K(t).toVar(),a=K(e).toVar(),l=pt(r).toVar(),c=pt(l.bitAnd(pt(15))).toVar(),d=K(f_(c.lessThan(pt(8)),a,s)).toVar(),m=K(f_(c.lessThan(pt(4)),s,f_(c.equal(pt(12)).or(c.equal(pt(14))),a,i))).toVar();return Db(d,Vc(c.bitAnd(pt(1)))).add(Db(m,Vc(c.bitAnd(pt(2)))))}).setLayout({name:"mx_gradient_float_1",type:"float",inputs:[{name:"hash",type:"uint"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),rr=Tr([gq,yq]),vq=ge(([r,e,t])=>{const n=K(t).toVar(),i=K(e).toVar(),s=iy(r).toVar();return ae(rr(s.x,i,n),rr(s.y,i,n),rr(s.z,i,n))}).setLayout({name:"mx_gradient_vec3_0",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"}]}),_q=ge(([r,e,t,n])=>{const i=K(n).toVar(),s=K(t).toVar(),a=K(e).toVar(),l=iy(r).toVar();return ae(rr(l.x,a,s,i),rr(l.y,a,s,i),rr(l.z,a,s,i))}).setLayout({name:"mx_gradient_vec3_1",type:"vec3",inputs:[{name:"hash",type:"uvec3"},{name:"x",type:"float"},{name:"y",type:"float"},{name:"z",type:"float"}]}),Wo=Tr([vq,_q]),xq=ge(([r])=>{const e=K(r).toVar();return tn(.6616,e)}).setLayout({name:"mx_gradient_scale2d_0",type:"float",inputs:[{name:"v",type:"float"}]}),Sq=ge(([r])=>{const e=K(r).toVar();return tn(.982,e)}).setLayout({name:"mx_gradient_scale3d_0",type:"float",inputs:[{name:"v",type:"float"}]}),bq=ge(([r])=>{const e=ae(r).toVar();return tn(.6616,e)}).setLayout({name:"mx_gradient_scale2d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),SP=Tr([xq,bq]),Tq=ge(([r])=>{const e=ae(r).toVar();return tn(.982,e)}).setLayout({name:"mx_gradient_scale3d_1",type:"vec3",inputs:[{name:"v",type:"vec3"}]}),bP=Tr([Sq,Tq]),yo=ge(([r,e])=>{const t=ee(e).toVar(),n=pt(r).toVar();return n.shiftLeft(t).bitOr(n.shiftRight(ee(32).sub(t)))}).setLayout({name:"mx_rotl32",type:"uint",inputs:[{name:"x",type:"uint"},{name:"k",type:"int"}]}),TP=ge(([r,e,t])=>{r.subAssign(t),r.bitXorAssign(yo(t,ee(4))),t.addAssign(e),e.subAssign(r),e.bitXorAssign(yo(r,ee(6))),r.addAssign(t),t.subAssign(e),t.bitXorAssign(yo(e,ee(8))),e.addAssign(r),r.subAssign(t),r.bitXorAssign(yo(t,ee(16))),t.addAssign(e),e.subAssign(r),e.bitXorAssign(yo(r,ee(19))),r.addAssign(t),t.subAssign(e),t.bitXorAssign(yo(e,ee(4))),e.addAssign(r)}),d0=ge(([r,e,t])=>{const n=pt(t).toVar(),i=pt(e).toVar(),s=pt(r).toVar();return n.bitXorAssign(i),n.subAssign(yo(i,ee(14))),s.bitXorAssign(n),s.subAssign(yo(n,ee(11))),i.bitXorAssign(s),i.subAssign(yo(s,ee(25))),n.bitXorAssign(i),n.subAssign(yo(i,ee(16))),s.bitXorAssign(n),s.subAssign(yo(n,ee(4))),i.bitXorAssign(s),i.subAssign(yo(s,ee(14))),n.bitXorAssign(i),n.subAssign(yo(i,ee(24))),n}).setLayout({name:"mx_bjfinal",type:"uint",inputs:[{name:"a",type:"uint"},{name:"b",type:"uint"},{name:"c",type:"uint"}]}),Hr=ge(([r])=>{const e=pt(r).toVar();return K(e).div(K(pt(ee(4294967295))))}).setLayout({name:"mx_bits_to_01",type:"float",inputs:[{name:"bits",type:"uint"}]}),Ou=ge(([r])=>{const e=K(r).toVar();return e.mul(e).mul(e).mul(e.mul(e.mul(6).sub(15)).add(10))}).setLayout({name:"mx_fade",type:"float",inputs:[{name:"t",type:"float"}]}),Mq=ge(([r])=>{const e=ee(r).toVar(),t=pt(pt(1)).toVar(),n=pt(pt(ee(3735928559)).add(t.shiftLeft(pt(2))).add(pt(13))).toVar();return d0(n.add(pt(e)),n,n)}).setLayout({name:"mx_hash_int_0",type:"uint",inputs:[{name:"x",type:"int"}]}),Eq=ge(([r,e])=>{const t=ee(e).toVar(),n=ee(r).toVar(),i=pt(pt(2)).toVar(),s=pt().toVar(),a=pt().toVar(),l=pt().toVar();return s.assign(a.assign(l.assign(pt(ee(3735928559)).add(i.shiftLeft(pt(2))).add(pt(13))))),s.addAssign(pt(n)),a.addAssign(pt(t)),d0(s,a,l)}).setLayout({name:"mx_hash_int_1",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),Aq=ge(([r,e,t])=>{const n=ee(t).toVar(),i=ee(e).toVar(),s=ee(r).toVar(),a=pt(pt(3)).toVar(),l=pt().toVar(),c=pt().toVar(),d=pt().toVar();return l.assign(c.assign(d.assign(pt(ee(3735928559)).add(a.shiftLeft(pt(2))).add(pt(13))))),l.addAssign(pt(s)),c.addAssign(pt(i)),d.addAssign(pt(n)),d0(l,c,d)}).setLayout({name:"mx_hash_int_2",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Rq=ge(([r,e,t,n])=>{const i=ee(n).toVar(),s=ee(t).toVar(),a=ee(e).toVar(),l=ee(r).toVar(),c=pt(pt(4)).toVar(),d=pt().toVar(),m=pt().toVar(),y=pt().toVar();return d.assign(m.assign(y.assign(pt(ee(3735928559)).add(c.shiftLeft(pt(2))).add(pt(13))))),d.addAssign(pt(l)),m.addAssign(pt(a)),y.addAssign(pt(s)),TP(d,m,y),d.addAssign(pt(i)),d0(d,m,y)}).setLayout({name:"mx_hash_int_3",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"}]}),Nq=ge(([r,e,t,n,i])=>{const s=ee(i).toVar(),a=ee(n).toVar(),l=ee(t).toVar(),c=ee(e).toVar(),d=ee(r).toVar(),m=pt(pt(5)).toVar(),y=pt().toVar(),v=pt().toVar(),x=pt().toVar();return y.assign(v.assign(x.assign(pt(ee(3735928559)).add(m.shiftLeft(pt(2))).add(pt(13))))),y.addAssign(pt(d)),v.addAssign(pt(c)),x.addAssign(pt(l)),TP(y,v,x),y.addAssign(pt(a)),v.addAssign(pt(s)),d0(y,v,x)}).setLayout({name:"mx_hash_int_4",type:"uint",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xx",type:"int"},{name:"yy",type:"int"}]}),ai=Tr([Mq,Eq,Aq,Rq,Nq]),Cq=ge(([r,e])=>{const t=ee(e).toVar(),n=ee(r).toVar(),i=pt(ai(n,t)).toVar(),s=iy().toVar();return s.x.assign(i.bitAnd(ee(255))),s.y.assign(i.shiftRight(ee(8)).bitAnd(ee(255))),s.z.assign(i.shiftRight(ee(16)).bitAnd(ee(255))),s}).setLayout({name:"mx_hash_vec3_0",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"}]}),wq=ge(([r,e,t])=>{const n=ee(t).toVar(),i=ee(e).toVar(),s=ee(r).toVar(),a=pt(ai(s,i,n)).toVar(),l=iy().toVar();return l.x.assign(a.bitAnd(ee(255))),l.y.assign(a.shiftRight(ee(8)).bitAnd(ee(255))),l.z.assign(a.shiftRight(ee(16)).bitAnd(ee(255))),l}).setLayout({name:"mx_hash_vec3_1",type:"uvec3",inputs:[{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"}]}),Xo=Tr([Cq,wq]),Dq=ge(([r])=>{const e=Qe(r).toVar(),t=ee().toVar(),n=ee().toVar(),i=K(zi(e.x,t)).toVar(),s=K(zi(e.y,n)).toVar(),a=K(Ou(i)).toVar(),l=K(Ou(s)).toVar(),c=K(_P(rr(ai(t,n),i,s),rr(ai(t.add(ee(1)),n),i.sub(1),s),rr(ai(t,n.add(ee(1))),i,s.sub(1)),rr(ai(t.add(ee(1)),n.add(ee(1))),i.sub(1),s.sub(1)),a,l)).toVar();return SP(c)}).setLayout({name:"mx_perlin_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"}]}),Uq=ge(([r])=>{const e=ae(r).toVar(),t=ee().toVar(),n=ee().toVar(),i=ee().toVar(),s=K(zi(e.x,t)).toVar(),a=K(zi(e.y,n)).toVar(),l=K(zi(e.z,i)).toVar(),c=K(Ou(s)).toVar(),d=K(Ou(a)).toVar(),m=K(Ou(l)).toVar(),y=K(xP(rr(ai(t,n,i),s,a,l),rr(ai(t.add(ee(1)),n,i),s.sub(1),a,l),rr(ai(t,n.add(ee(1)),i),s,a.sub(1),l),rr(ai(t.add(ee(1)),n.add(ee(1)),i),s.sub(1),a.sub(1),l),rr(ai(t,n,i.add(ee(1))),s,a,l.sub(1)),rr(ai(t.add(ee(1)),n,i.add(ee(1))),s.sub(1),a,l.sub(1)),rr(ai(t,n.add(ee(1)),i.add(ee(1))),s,a.sub(1),l.sub(1)),rr(ai(t.add(ee(1)),n.add(ee(1)),i.add(ee(1))),s.sub(1),a.sub(1),l.sub(1)),c,d,m)).toVar();return bP(y)}).setLayout({name:"mx_perlin_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"}]}),DN=Tr([Dq,Uq]),Lq=ge(([r])=>{const e=Qe(r).toVar(),t=ee().toVar(),n=ee().toVar(),i=K(zi(e.x,t)).toVar(),s=K(zi(e.y,n)).toVar(),a=K(Ou(i)).toVar(),l=K(Ou(s)).toVar(),c=ae(_P(Wo(Xo(t,n),i,s),Wo(Xo(t.add(ee(1)),n),i.sub(1),s),Wo(Xo(t,n.add(ee(1))),i,s.sub(1)),Wo(Xo(t.add(ee(1)),n.add(ee(1))),i.sub(1),s.sub(1)),a,l)).toVar();return SP(c)}).setLayout({name:"mx_perlin_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Bq=ge(([r])=>{const e=ae(r).toVar(),t=ee().toVar(),n=ee().toVar(),i=ee().toVar(),s=K(zi(e.x,t)).toVar(),a=K(zi(e.y,n)).toVar(),l=K(zi(e.z,i)).toVar(),c=K(Ou(s)).toVar(),d=K(Ou(a)).toVar(),m=K(Ou(l)).toVar(),y=ae(xP(Wo(Xo(t,n,i),s,a,l),Wo(Xo(t.add(ee(1)),n,i),s.sub(1),a,l),Wo(Xo(t,n.add(ee(1)),i),s,a.sub(1),l),Wo(Xo(t.add(ee(1)),n.add(ee(1)),i),s.sub(1),a.sub(1),l),Wo(Xo(t,n,i.add(ee(1))),s,a,l.sub(1)),Wo(Xo(t.add(ee(1)),n,i.add(ee(1))),s.sub(1),a,l.sub(1)),Wo(Xo(t,n.add(ee(1)),i.add(ee(1))),s,a.sub(1),l.sub(1)),Wo(Xo(t.add(ee(1)),n.add(ee(1)),i.add(ee(1))),s.sub(1),a.sub(1),l.sub(1)),c,d,m)).toVar();return bP(y)}).setLayout({name:"mx_perlin_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),UN=Tr([Lq,Bq]),Oq=ge(([r])=>{const e=K(r).toVar(),t=ee(Ss(e)).toVar();return Hr(ai(t))}).setLayout({name:"mx_cell_noise_float_0",type:"float",inputs:[{name:"p",type:"float"}]}),Pq=ge(([r])=>{const e=Qe(r).toVar(),t=ee(Ss(e.x)).toVar(),n=ee(Ss(e.y)).toVar();return Hr(ai(t,n))}).setLayout({name:"mx_cell_noise_float_1",type:"float",inputs:[{name:"p",type:"vec2"}]}),Iq=ge(([r])=>{const e=ae(r).toVar(),t=ee(Ss(e.x)).toVar(),n=ee(Ss(e.y)).toVar(),i=ee(Ss(e.z)).toVar();return Hr(ai(t,n,i))}).setLayout({name:"mx_cell_noise_float_2",type:"float",inputs:[{name:"p",type:"vec3"}]}),Fq=ge(([r])=>{const e=Dt(r).toVar(),t=ee(Ss(e.x)).toVar(),n=ee(Ss(e.y)).toVar(),i=ee(Ss(e.z)).toVar(),s=ee(Ss(e.w)).toVar();return Hr(ai(t,n,i,s))}).setLayout({name:"mx_cell_noise_float_3",type:"float",inputs:[{name:"p",type:"vec4"}]}),zq=Tr([Oq,Pq,Iq,Fq]),Vq=ge(([r])=>{const e=K(r).toVar(),t=ee(Ss(e)).toVar();return ae(Hr(ai(t,ee(0))),Hr(ai(t,ee(1))),Hr(ai(t,ee(2))))}).setLayout({name:"mx_cell_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"float"}]}),Gq=ge(([r])=>{const e=Qe(r).toVar(),t=ee(Ss(e.x)).toVar(),n=ee(Ss(e.y)).toVar();return ae(Hr(ai(t,n,ee(0))),Hr(ai(t,n,ee(1))),Hr(ai(t,n,ee(2))))}).setLayout({name:"mx_cell_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec2"}]}),Hq=ge(([r])=>{const e=ae(r).toVar(),t=ee(Ss(e.x)).toVar(),n=ee(Ss(e.y)).toVar(),i=ee(Ss(e.z)).toVar();return ae(Hr(ai(t,n,i,ee(0))),Hr(ai(t,n,i,ee(1))),Hr(ai(t,n,i,ee(2))))}).setLayout({name:"mx_cell_noise_vec3_2",type:"vec3",inputs:[{name:"p",type:"vec3"}]}),kq=ge(([r])=>{const e=Dt(r).toVar(),t=ee(Ss(e.x)).toVar(),n=ee(Ss(e.y)).toVar(),i=ee(Ss(e.z)).toVar(),s=ee(Ss(e.w)).toVar();return ae(Hr(ai(t,n,i,s,ee(0))),Hr(ai(t,n,i,s,ee(1))),Hr(ai(t,n,i,s,ee(2))))}).setLayout({name:"mx_cell_noise_vec3_3",type:"vec3",inputs:[{name:"p",type:"vec4"}]}),MP=Tr([Vq,Gq,Hq,kq]),Ub=ge(([r,e,t,n])=>{const i=K(n).toVar(),s=K(t).toVar(),a=ee(e).toVar(),l=ae(r).toVar(),c=K(0).toVar(),d=K(1).toVar();return ti(a,()=>{c.addAssign(d.mul(DN(l))),d.mulAssign(i),l.mulAssign(s)}),c}).setLayout({name:"mx_fractal_noise_float",type:"float",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),EP=ge(([r,e,t,n])=>{const i=K(n).toVar(),s=K(t).toVar(),a=ee(e).toVar(),l=ae(r).toVar(),c=ae(0).toVar(),d=K(1).toVar();return ti(a,()=>{c.addAssign(d.mul(UN(l))),d.mulAssign(i),l.mulAssign(s)}),c}).setLayout({name:"mx_fractal_noise_vec3",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),qq=ge(([r,e,t,n])=>{const i=K(n).toVar(),s=K(t).toVar(),a=ee(e).toVar(),l=ae(r).toVar();return Qe(Ub(l,a,s,i),Ub(l.add(ae(ee(19),ee(193),ee(17))),a,s,i))}).setLayout({name:"mx_fractal_noise_vec2",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Wq=ge(([r,e,t,n])=>{const i=K(n).toVar(),s=K(t).toVar(),a=ee(e).toVar(),l=ae(r).toVar(),c=ae(EP(l,a,s,i)).toVar(),d=K(Ub(l.add(ae(ee(19),ee(193),ee(17))),a,s,i)).toVar();return Dt(c,d)}).setLayout({name:"mx_fractal_noise_vec4",type:"vec4",inputs:[{name:"p",type:"vec3"},{name:"octaves",type:"int"},{name:"lacunarity",type:"float"},{name:"diminish",type:"float"}]}),Xq=ge(([r,e,t,n,i,s,a])=>{const l=ee(a).toVar(),c=K(s).toVar(),d=ee(i).toVar(),m=ee(n).toVar(),y=ee(t).toVar(),v=ee(e).toVar(),x=Qe(r).toVar(),S=ae(MP(Qe(v.add(m),y.add(d)))).toVar(),A=Qe(S.x,S.y).toVar();A.subAssign(.5),A.mulAssign(c),A.addAssign(.5);const E=Qe(Qe(K(v),K(y)).add(A)).toVar(),M=Qe(E.sub(x)).toVar();return ln(l.equal(ee(2)),()=>Ai(M.x).add(Ai(M.y))),ln(l.equal(ee(3)),()=>fs(Ai(M.x),Ai(M.y))),mf(M,M)}).setLayout({name:"mx_worley_distance_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Yq=ge(([r,e,t,n,i,s,a,l,c])=>{const d=ee(c).toVar(),m=K(l).toVar(),y=ee(a).toVar(),v=ee(s).toVar(),x=ee(i).toVar(),S=ee(n).toVar(),A=ee(t).toVar(),E=ee(e).toVar(),M=ae(r).toVar(),C=ae(MP(ae(E.add(x),A.add(v),S.add(y)))).toVar();C.subAssign(.5),C.mulAssign(m),C.addAssign(.5);const w=ae(ae(K(E),K(A),K(S)).add(C)).toVar(),D=ae(w.sub(M)).toVar();return ln(d.equal(ee(2)),()=>Ai(D.x).add(Ai(D.y)).add(Ai(D.z))),ln(d.equal(ee(3)),()=>fs(fs(Ai(D.x),Ai(D.y)),Ai(D.z))),mf(D,D)}).setLayout({name:"mx_worley_distance_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"x",type:"int"},{name:"y",type:"int"},{name:"z",type:"int"},{name:"xoff",type:"int"},{name:"yoff",type:"int"},{name:"zoff",type:"int"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),ay=Tr([Xq,Yq]),jq=ge(([r,e,t])=>{const n=ee(t).toVar(),i=K(e).toVar(),s=Qe(r).toVar(),a=ee().toVar(),l=ee().toVar(),c=Qe(zi(s.x,a),zi(s.y,l)).toVar(),d=K(1e6).toVar();return ti({start:-1,end:ee(1),name:"x",condition:"<="},({x:m})=>{ti({start:-1,end:ee(1),name:"y",condition:"<="},({y})=>{const v=K(ay(c,m,y,a,l,i,n)).toVar();d.assign(Xa(d,v))})}),ln(n.equal(ee(0)),()=>{d.assign(Yu(d))}),d}).setLayout({name:"mx_worley_noise_float_0",type:"float",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Zq=ge(([r,e,t])=>{const n=ee(t).toVar(),i=K(e).toVar(),s=Qe(r).toVar(),a=ee().toVar(),l=ee().toVar(),c=Qe(zi(s.x,a),zi(s.y,l)).toVar(),d=Qe(1e6,1e6).toVar();return ti({start:-1,end:ee(1),name:"x",condition:"<="},({x:m})=>{ti({start:-1,end:ee(1),name:"y",condition:"<="},({y})=>{const v=K(ay(c,m,y,a,l,i,n)).toVar();ln(v.lessThan(d.x),()=>{d.y.assign(d.x),d.x.assign(v)}).ElseIf(v.lessThan(d.y),()=>{d.y.assign(v)})})}),ln(n.equal(ee(0)),()=>{d.assign(Yu(d))}),d}).setLayout({name:"mx_worley_noise_vec2_0",type:"vec2",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Kq=ge(([r,e,t])=>{const n=ee(t).toVar(),i=K(e).toVar(),s=Qe(r).toVar(),a=ee().toVar(),l=ee().toVar(),c=Qe(zi(s.x,a),zi(s.y,l)).toVar(),d=ae(1e6,1e6,1e6).toVar();return ti({start:-1,end:ee(1),name:"x",condition:"<="},({x:m})=>{ti({start:-1,end:ee(1),name:"y",condition:"<="},({y})=>{const v=K(ay(c,m,y,a,l,i,n)).toVar();ln(v.lessThan(d.x),()=>{d.z.assign(d.y),d.y.assign(d.x),d.x.assign(v)}).ElseIf(v.lessThan(d.y),()=>{d.z.assign(d.y),d.y.assign(v)}).ElseIf(v.lessThan(d.z),()=>{d.z.assign(v)})})}),ln(n.equal(ee(0)),()=>{d.assign(Yu(d))}),d}).setLayout({name:"mx_worley_noise_vec3_0",type:"vec3",inputs:[{name:"p",type:"vec2"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Qq=ge(([r,e,t])=>{const n=ee(t).toVar(),i=K(e).toVar(),s=ae(r).toVar(),a=ee().toVar(),l=ee().toVar(),c=ee().toVar(),d=ae(zi(s.x,a),zi(s.y,l),zi(s.z,c)).toVar(),m=K(1e6).toVar();return ti({start:-1,end:ee(1),name:"x",condition:"<="},({x:y})=>{ti({start:-1,end:ee(1),name:"y",condition:"<="},({y:v})=>{ti({start:-1,end:ee(1),name:"z",condition:"<="},({z:x})=>{const S=K(ay(d,y,v,x,a,l,c,i,n)).toVar();m.assign(Xa(m,S))})})}),ln(n.equal(ee(0)),()=>{m.assign(Yu(m))}),m}).setLayout({name:"mx_worley_noise_float_1",type:"float",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),Jq=Tr([jq,Qq]),$q=ge(([r,e,t])=>{const n=ee(t).toVar(),i=K(e).toVar(),s=ae(r).toVar(),a=ee().toVar(),l=ee().toVar(),c=ee().toVar(),d=ae(zi(s.x,a),zi(s.y,l),zi(s.z,c)).toVar(),m=Qe(1e6,1e6).toVar();return ti({start:-1,end:ee(1),name:"x",condition:"<="},({x:y})=>{ti({start:-1,end:ee(1),name:"y",condition:"<="},({y:v})=>{ti({start:-1,end:ee(1),name:"z",condition:"<="},({z:x})=>{const S=K(ay(d,y,v,x,a,l,c,i,n)).toVar();ln(S.lessThan(m.x),()=>{m.y.assign(m.x),m.x.assign(S)}).ElseIf(S.lessThan(m.y),()=>{m.y.assign(S)})})})}),ln(n.equal(ee(0)),()=>{m.assign(Yu(m))}),m}).setLayout({name:"mx_worley_noise_vec2_1",type:"vec2",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),e9=Tr([Zq,$q]),t9=ge(([r,e,t])=>{const n=ee(t).toVar(),i=K(e).toVar(),s=ae(r).toVar(),a=ee().toVar(),l=ee().toVar(),c=ee().toVar(),d=ae(zi(s.x,a),zi(s.y,l),zi(s.z,c)).toVar(),m=ae(1e6,1e6,1e6).toVar();return ti({start:-1,end:ee(1),name:"x",condition:"<="},({x:y})=>{ti({start:-1,end:ee(1),name:"y",condition:"<="},({y:v})=>{ti({start:-1,end:ee(1),name:"z",condition:"<="},({z:x})=>{const S=K(ay(d,y,v,x,a,l,c,i,n)).toVar();ln(S.lessThan(m.x),()=>{m.z.assign(m.y),m.y.assign(m.x),m.x.assign(S)}).ElseIf(S.lessThan(m.y),()=>{m.z.assign(m.y),m.y.assign(S)}).ElseIf(S.lessThan(m.z),()=>{m.z.assign(S)})})})}),ln(n.equal(ee(0)),()=>{m.assign(Yu(m))}),m}).setLayout({name:"mx_worley_noise_vec3_1",type:"vec3",inputs:[{name:"p",type:"vec3"},{name:"jitter",type:"float"},{name:"metric",type:"int"}]}),n9=Tr([Kq,t9]),i9=ge(([r])=>{const e=r.y,t=r.z,n=ae().toVar();return ln(e.lessThan(1e-4),()=>{n.assign(ae(t,t,t))}).Else(()=>{let i=r.x;i=i.sub(Bu(i)).mul(6).toVar();const s=ee(kR(i)),a=i.sub(K(s)),l=t.mul(e.oneMinus()),c=t.mul(e.mul(a).oneMinus()),d=t.mul(e.mul(a.oneMinus()).oneMinus());ln(s.equal(ee(0)),()=>{n.assign(ae(t,d,l))}).ElseIf(s.equal(ee(1)),()=>{n.assign(ae(c,t,l))}).ElseIf(s.equal(ee(2)),()=>{n.assign(ae(l,t,d))}).ElseIf(s.equal(ee(3)),()=>{n.assign(ae(l,c,t))}).ElseIf(s.equal(ee(4)),()=>{n.assign(ae(d,l,t))}).Else(()=>{n.assign(ae(t,l,c))})}),n}).setLayout({name:"mx_hsvtorgb",type:"vec3",inputs:[{name:"hsv",type:"vec3"}]}),s9=ge(([r])=>{const e=ae(r).toVar(),t=K(e.x).toVar(),n=K(e.y).toVar(),i=K(e.z).toVar(),s=K(Xa(t,Xa(n,i))).toVar(),a=K(fs(t,fs(n,i))).toVar(),l=K(a.sub(s)).toVar(),c=K().toVar(),d=K().toVar(),m=K().toVar();return m.assign(a),ln(a.greaterThan(0),()=>{d.assign(l.div(a))}).Else(()=>{d.assign(0)}),ln(d.lessThanEqual(0),()=>{c.assign(0)}).Else(()=>{ln(t.greaterThanEqual(a),()=>{c.assign(n.sub(i).div(l))}).ElseIf(n.greaterThanEqual(a),()=>{c.assign(bs(2,i.sub(t).div(l)))}).Else(()=>{c.assign(bs(4,t.sub(n).div(l)))}),c.mulAssign(1/6),ln(c.lessThan(0),()=>{c.addAssign(1)})}),ae(c,d,m)}).setLayout({name:"mx_rgbtohsv",type:"vec3",inputs:[{name:"c",type:"vec3"}]}),r9=ge(([r])=>{const e=ae(r).toVar(),t=NR(IR(e,ae(.04045))).toVar(),n=ae(e.div(12.92)).toVar(),i=ae(Pl(fs(e.add(ae(.055)),ae(0)).div(1.055),ae(2.4))).toVar();return ei(n,i,t)}).setLayout({name:"mx_srgb_texture_to_lin_rec709",type:"vec3",inputs:[{name:"color",type:"vec3"}]}),AP=(r,e)=>{r=K(r),e=K(e);const t=Qe(e.dFdx(),e.dFdy()).length().mul(.7071067811865476);return Vu(r.sub(t),r.add(t),e)},RP=(r,e,t,n)=>ei(r,e,t[n].clamp()),a9=(r,e,t=Vi())=>RP(r,e,t,"x"),o9=(r,e,t=Vi())=>RP(r,e,t,"y"),NP=(r,e,t,n,i)=>ei(r,e,AP(t,n[i])),l9=(r,e,t,n=Vi())=>NP(r,e,t,n,"x"),u9=(r,e,t,n=Vi())=>NP(r,e,t,n,"y"),c9=(r=1,e=0,t=Vi())=>t.mul(r).add(e),h9=(r,e=1)=>(r=K(r),r.abs().pow(e).mul(r.sign())),f9=(r,e=1,t=.5)=>K(r).sub(t).mul(e).add(t),d9=(r=Vi(),e=1,t=0)=>DN(r.convert("vec2|vec3")).mul(e).add(t),p9=(r=Vi(),e=1,t=0)=>UN(r.convert("vec2|vec3")).mul(e).add(t),m9=(r=Vi(),e=1,t=0)=>(r=r.convert("vec2|vec3"),Dt(UN(r),DN(r.add(Qe(19,73)))).mul(e).add(t)),g9=(r=Vi(),e=1)=>Jq(r.convert("vec2|vec3"),e,ee(1)),y9=(r=Vi(),e=1)=>e9(r.convert("vec2|vec3"),e,ee(1)),v9=(r=Vi(),e=1)=>n9(r.convert("vec2|vec3"),e,ee(1)),_9=(r=Vi())=>zq(r.convert("vec2|vec3")),x9=(r=Vi(),e=3,t=2,n=.5,i=1)=>Ub(r,ee(e),t,n).mul(i),S9=(r=Vi(),e=3,t=2,n=.5,i=1)=>qq(r,ee(e),t,n).mul(i),b9=(r=Vi(),e=3,t=2,n=.5,i=1)=>EP(r,ee(e),t,n).mul(i),T9=(r=Vi(),e=3,t=2,n=.5,i=1)=>Wq(r,ee(e),t,n).mul(i),M9=ge(([r,e,t])=>{const n=Gc(r).toVar(),i=On(K(.5).mul(e.sub(t)),Oc).div(n).toVar(),s=On(K(-.5).mul(e.sub(t)),Oc).div(n).toVar(),a=ae().toVar();a.x=n.x.greaterThan(K(0)).select(i.x,s.x),a.y=n.y.greaterThan(K(0)).select(i.y,s.y),a.z=n.z.greaterThan(K(0)).select(i.z,s.z);const l=Xa(Xa(a.x,a.y),a.z).toVar();return Oc.add(n.mul(l)).toVar().sub(t)}),CP=ge(([r,e])=>{const t=r.x,n=r.y,i=r.z;let s=e.element(0).mul(.886227);return s=s.add(e.element(1).mul(2*.511664).mul(n)),s=s.add(e.element(2).mul(2*.511664).mul(i)),s=s.add(e.element(3).mul(2*.511664).mul(t)),s=s.add(e.element(4).mul(2*.429043).mul(t).mul(n)),s=s.add(e.element(5).mul(2*.429043).mul(n).mul(i)),s=s.add(e.element(6).mul(i.mul(i).mul(.743125).sub(.247708))),s=s.add(e.element(7).mul(2*.429043).mul(t).mul(i)),s=s.add(e.element(8).mul(.429043).mul(tn(t,t).sub(tn(n,n)))),s});var L=Object.freeze({__proto__:null,BRDF_GGX:t1,BRDF_Lambert:pp,BasicPointShadowFilter:mP,BasicShadowFilter:uP,Break:nO,Const:wL,Continue:xH,DFGApprox:dN,D_GGX:yO,Discard:jL,EPSILON:$3,F_Schlick:Wg,Fn:ge,INFINITY:sG,If:ln,Loop:ti,NodeAccess:Vr,NodeShaderStage:qA,NodeType:U4,NodeUpdateType:en,PCFShadowFilter:cP,PCFSoftShadowFilter:hP,PI:Ab,PI2:rG,PointShadowFilter:gP,Return:xG,Schlick_to_F0:_O,ScriptableNodeResources:lb,ShaderNode:a_,TBNViewMatrix:Fd,VSMShadowFilter:fP,V_GGX_SmithCorrelated:gO,Var:CL,abs:Ai,acesFilmicToneMapping:eP,acos:aL,add:bs,addMethodChaining:Pe,addNodeElement:TG,agxToneMapping:tP,all:eL,alphaT:Tb,and:G3,anisotropy:Yh,anisotropyB:Wd,anisotropyT:o_,any:tL,append:S3,array:D3,arrayBuffer:$4,asin:rL,assign:O3,atan:VR,atan2:EL,atomicAdd:Ok,atomicAnd:zk,atomicFunc:ju,atomicLoad:Lk,atomicMax:Ik,atomicMin:Fk,atomicOr:Vk,atomicStore:Bk,atomicSub:Pk,atomicXor:Gk,attenuationColor:BR,attenuationDistance:LR,attribute:Gu,attributeArray:M8,backgroundBlurriness:HO,backgroundIntensity:o1,backgroundRotation:kO,batch:$B,billboarding:a8,bitAnd:W3,bitNot:X3,bitOr:Y3,bitXor:j3,bitangentGeometry:QG,bitangentLocal:JG,bitangentView:dB,bitangentWorld:$G,bitcast:aG,blendBurn:XO,blendColor:z8,blendDodge:YO,blendOverlay:ZO,blendScreen:jO,blur:AO,bool:Vc,buffer:r0,bufferAttribute:s0,bumpMap:yB,burn:V8,bvec2:M3,bvec3:NR,bvec4:N3,bypass:qL,cache:u_,call:P3,cameraFar:Zh,cameraIndex:QR,cameraNear:jh,cameraNormalMatrix:UG,cameraPosition:eB,cameraProjectionMatrix:Rp,cameraProjectionMatrixInverse:wG,cameraViewMatrix:Za,cameraWorldMatrix:DG,cbrt:xL,cdl:j8,ceil:VT,checker:cq,cineonToneMapping:$O,clamp:zu,clearcoat:bb,clearcoatRoughness:U_,code:eM,color:b3,colorSpaceToWorking:qT,colorToDirection:ZH,compute:kL,computeSkinning:vH,cond:AL,context:kT,convert:w3,convertColorSpace:hG,convertToTexture:_8,cos:Ec,cross:HT,cubeTexture:qg,cubeToUV:Ul,dFdx:GR,dFdy:HR,dashSize:tb,debug:KL,defaultBuildStages:WA,defaultShaderStages:m3,defined:N_,degrees:iL,deltaTime:zO,densityFog:gk,densityFogFactor:bN,depth:uN,depthPass:$8,difference:gL,diffuseColor:jn,directPointLight:vP,directionToColor:uO,dispersion:OR,distance:mL,div:kl,dodge:G8,dot:mf,drawIndex:KB,dynamicBufferAttribute:HL,element:C3,emissive:ZA,equal:PR,equals:dL,equirectUV:cN,exp:FR,exp2:kg,expression:hf,faceDirection:o0,faceForward:YR,faceforward:oG,float:K,floor:Bu,fog:P_,fract:kc,frameGroup:B3,frameId:K6,frontFacing:sB,fwidth:hL,gain:k6,gapSize:KA,getConstNodeType:x3,getCurrentStack:RR,getDirection:MO,getDistanceAttenuation:wN,getGeometryRoughness:mO,getNormalFromDepth:S8,getParallaxCorrectNormal:M9,getRoughness:fN,getScreenPosition:x8,getShIrradianceAt:CP,getTextureIndex:IO,getViewPosition:lg,globalId:bk,glsl:lk,glslFn:uk,grayscale:q8,greaterThan:IR,greaterThanEqual:V3,hash:H6,highpModelNormalViewMatrix:WG,highpModelViewMatrix:qG,hue:Y8,instance:hH,instanceIndex:of,instancedArray:E8,instancedBufferAttribute:Rb,instancedDynamicBufferAttribute:QA,instancedMesh:JB,int:ee,inverseSqrt:zR,inversesqrt:lG,invocationLocalIndex:cH,invocationSubgroupIndex:uH,ior:l_,iridescence:FT,iridescenceIOR:wR,iridescenceThickness:DR,ivec2:Ws,ivec3:E3,ivec4:A3,js:ak,label:NL,length:Bc,lengthSq:WR,lessThan:F3,lessThanEqual:z3,lightPosition:EN,lightProjectionUV:oP,lightShadowMatrix:MN,lightTargetDirection:RN,lightTargetPosition:lP,lightViewPosition:AN,lightingContext:sO,lights:qk,linearDepth:Cb,linearToneMapping:QO,localId:Tk,log:zT,log2:Lu,logarithmicDepthToViewZ:BH,loop:SH,luminance:xN,mat2:OT,mat3:kr,mat4:qd,matcapUV:wO,materialAO:jB,materialAlphaTest:vB,materialAnisotropy:LB,materialAnisotropyVector:og,materialAttenuationColor:GB,materialAttenuationDistance:VB,materialClearcoat:RB,materialClearcoatNormal:CB,materialClearcoatRoughness:NB,materialColor:_B,materialDispersion:YB,materialEmissive:SB,materialEnvIntensity:sb,materialEnvRotation:eN,materialIOR:zB,materialIridescence:BB,materialIridescenceIOR:OB,materialIridescenceThickness:PB,materialLightMap:iN,materialLineDashOffset:WB,materialLineDashSize:kB,materialLineGapSize:qB,materialLineScale:HB,materialLineWidth:oH,materialMetalness:EB,materialNormal:AB,materialOpacity:nN,materialPointSize:XB,materialReference:Nc,materialReflectivity:rb,materialRefractionRatio:oB,materialRotation:wB,materialRoughness:MB,materialSheen:DB,materialSheenRoughness:UB,materialShininess:xB,materialSpecular:bB,materialSpecularColor:TB,materialSpecularIntensity:e1,materialSpecularStrength:c_,materialThickness:FB,materialTransmission:IB,max:fs,maxMipLevel:JL,mediumpModelViewMatrix:iB,metalness:D_,min:Xa,mix:ei,mixElement:TL,mod:t0,modInt:J3,modelDirection:FG,modelNormalMatrix:nB,modelPosition:zG,modelRadius:HG,modelScale:VG,modelViewMatrix:Np,modelViewPosition:GG,modelViewProjection:sN,modelWorldMatrix:Zo,modelWorldMatrixInverse:kG,morphReference:iO,mrt:FO,mul:tn,mx_aastep:AP,mx_cell_noise_float:_9,mx_contrast:f9,mx_fractal_noise_float:x9,mx_fractal_noise_vec2:S9,mx_fractal_noise_vec3:b9,mx_fractal_noise_vec4:T9,mx_hsvtorgb:i9,mx_noise_float:d9,mx_noise_vec3:p9,mx_noise_vec4:m9,mx_ramplr:a9,mx_ramptb:o9,mx_rgbtohsv:s9,mx_safepower:h9,mx_splitlr:l9,mx_splittb:u9,mx_srgb_texture_to_lin_rec709:r9,mx_transform_uv:c9,mx_worley_noise_float:g9,mx_worley_noise_vec2:y9,mx_worley_noise_vec3:v9,negate:oL,neutralToneMapping:nP,nodeArray:kd,nodeImmutable:rt,nodeObject:ze,nodeObjects:$_,nodeProxy:Ve,normalFlat:rB,normalGeometry:WT,normalLocal:Ya,normalMap:$A,normalView:el,normalWorld:XT,normalize:Gc,not:k3,notEqual:I3,numWorkgroups:xk,objectDirection:LG,objectGroup:CR,objectPosition:tB,objectRadius:IG,objectScale:OG,objectViewPosition:PG,objectWorldMatrix:BG,oneMinus:lL,or:H3,orthographicDepthToViewZ:LH,oscSawtooth:i8,oscSine:e8,oscSquare:t8,oscTriangle:n8,output:yg,outputStruct:V6,overlay:k8,overloadingFn:Tr,parabola:a1,parallaxDirection:mB,parallaxUV:tH,parameter:B6,pass:Q8,passTexture:J8,pcurve:q6,perspectiveDepthToViewZ:oN,pmremTexture:gN,pointShadow:yP,pointUV:C8,pointWidth:tG,positionGeometry:a0,positionLocal:hs,positionPrevious:Nb,positionView:xs,positionViewDirection:Ii,positionWorld:Oc,positionWorldDirection:JR,posterize:K8,pow:Pl,pow2:qR,pow3:yL,pow4:vL,property:sy,radians:nL,rand:bL,range:vk,rangeFog:mk,rangeFogFactor:SN,reciprocal:cL,reference:_i,referenceBuffer:JA,reflect:pL,reflectVector:cB,reflectView:lB,reflector:p8,refract:XR,refractVector:hB,refractView:uB,reinhardToneMapping:JO,remainder:Q3,remap:XL,remapClamp:YL,renderGroup:Gt,renderOutput:ZL,rendererReference:zL,rotate:$T,rotateUV:s8,roughness:Du,round:uL,rtt:GO,sRGBTransferEOTF:LL,sRGBTransferOETF:BL,sampler:AG,samplerComparison:RG,saturate:SL,saturation:W8,screen:H8,screenCoordinate:h0,screenSize:O_,screenUV:ku,scriptable:pk,scriptableValue:ob,select:Sr,setCurrentStack:C_,shaderStages:XA,shadow:pP,shadowPositionWorld:CN,shapeCircle:hq,sharedUniformGroup:PT,sheen:Id,sheenRoughness:IT,shiftLeft:Z3,shiftRight:K3,shininess:Mb,sign:B_,sin:vo,sinc:W6,skinning:tO,smoothstep:Vu,smoothstepElement:ML,specularColor:Oa,specularF90:L_,spherizeUV:r8,split:eG,spritesheetUV:u8,sqrt:Yu,stack:ab,step:GT,storage:Xd,storageBarrier:Rk,storageObject:yH,storageTexture:qO,string:J4,struct:z6,sub:On,subgroupIndex:lH,subgroupSize:Mk,tan:sL,tangentGeometry:ZT,tangentLocal:l0,tangentView:u0,tangentWorld:fB,temp:DL,texture:En,texture3D:B8,textureBarrier:Nk,textureBicubic:bO,textureCubeUV:EO,textureLoad:ls,textureSize:af,textureStore:D8,thickness:UR,time:Cp,timerDelta:$6,timerGlobal:J6,timerLocal:Q6,toOutputColorSpace:OL,toWorkingColorSpace:PL,toneMapping:VL,toneMappingExposure:GL,toonOutlinePass:tk,transformDirection:_L,transformNormal:aB,transformNormalToView:$R,transformedBentNormalView:gB,transformedBitangentView:pB,transformedBitangentWorld:eH,transformedClearcoatNormalView:fg,transformedNormalView:cs,transformedNormalWorld:YT,transformedTangentView:tN,transformedTangentWorld:KG,transmission:Eb,transpose:fL,triNoise3D:Y6,triplanarTexture:h8,triplanarTextures:VO,trunc:kR,tslFn:Q4,uint:pt,uniform:Ct,uniformArray:Bl,uniformGroup:L3,uniforms:CG,userData:P8,uv:Vi,uvec2:T3,uvec3:iy,uvec4:R3,varying:Wr,varyingProperty:w_,vec2:Qe,vec3:ae,vec4:Dt,vectorComponents:Ep,velocity:F8,vertexColor:R8,vertexIndex:ZB,vertexStage:UL,vibrance:X8,viewZToLogarithmicDepth:lN,viewZToOrthographicDepth:_g,viewZToPerspectiveDepth:oO,viewport:vg,viewportBottomLeft:wH,viewportCoordinate:aO,viewportDepthTexture:aN,viewportLinearDepth:OH,viewportMipTexture:rN,viewportResolution:NH,viewportSafeUV:o8,viewportSharedTexture:jH,viewportSize:rO,viewportTexture:DH,viewportTopLeft:CH,viewportUV:RH,wgsl:ok,wgslFn:ck,workgroupArray:Dk,workgroupBarrier:Ak,workgroupId:Sk,workingToColorSpace:IL,xor:q3});const Dl=new yN;class E9 extends gf{constructor(e,t){super(),this.renderer=e,this.nodes=t}update(e,t,n){const i=this.renderer,s=this.nodes.getBackgroundNode(e)||e.background;let a=!1;if(s===null)i._clearColor.getRGB(Dl),Dl.a=i._clearColor.a;else if(s.isColor===!0)s.getRGB(Dl),Dl.a=1,a=!0;else if(s.isNode===!0){const c=this.get(e),d=s;Dl.copy(i._clearColor);let m=c.backgroundMesh;if(m===void 0){const v=kT(Dt(d).mul(o1),{getUV:()=>kO.mul(XT),getTextureLevel:()=>HO});let x=sN;x=x.setZ(x.w);const S=new Ts;S.name="Background.material",S.side=Ti,S.depthTest=!1,S.depthWrite=!1,S.allowOverride=!1,S.fog=!1,S.lights=!1,S.vertexNode=x,S.colorNode=v,c.backgroundMeshNode=v,c.backgroundMesh=m=new bi(new ny(1,32,32),S),m.frustumCulled=!1,m.name="Background.mesh",m.onBeforeRender=function(A,E,M){this.matrixWorld.copyPosition(M.matrixWorld)}}const y=d.getCacheKey();c.backgroundCacheKey!==y&&(c.backgroundMeshNode.node=Dt(d).mul(o1),c.backgroundMeshNode.needsUpdate=!0,m.material.needsUpdate=!0,c.backgroundCacheKey=y),t.unshift(m,m.geometry,m.material,0,0,null,null)}else console.error("THREE.Renderer: Unsupported background configuration.",s);const l=i.xr.getEnvironmentBlendMode();if(l==="additive"?Dl.set(0,0,0,1):l==="alpha-blend"&&Dl.set(0,0,0,0),i.autoClear===!0||a===!0){const c=n.clearColorValue;c.r=Dl.r,c.g=Dl.g,c.b=Dl.b,c.a=Dl.a,(i.backend.isWebGLBackend===!0||i.alpha===!0)&&(c.r*=c.a,c.g*=c.a,c.b*=c.a),n.depthClearValue=i._clearDepth,n.stencilClearValue=i._clearStencil,n.clearColor=i.autoClearColor===!0,n.clearDepth=i.autoClearDepth===!0,n.clearStencil=i.autoClearStencil===!0}else n.clearColor=!1,n.clearDepth=!1,n.clearStencil=!1}}let A9=0;class l1{constructor(e="",t=[],n=0,i=[]){this.name=e,this.bindings=t,this.index=n,this.bindingsReference=i,this.id=A9++}}class R9{constructor(e,t,n,i,s,a,l,c,d,m=[]){this.vertexShader=e,this.fragmentShader=t,this.computeShader=n,this.transforms=m,this.nodeAttributes=i,this.bindings=s,this.updateNodes=a,this.updateBeforeNodes=l,this.updateAfterNodes=c,this.observer=d,this.usedTimes=0}createBindings(){const e=[];for(const t of this.bindings)if(t.bindings[0].groupNode.shared!==!0){const i=new l1(t.name,[],t.index,t);e.push(i);for(const s of t.bindings)i.bindings.push(s.clone())}else e.push(t);return e}}class U2{constructor(e,t,n=null){this.isNodeAttribute=!0,this.name=e,this.type=t,this.node=n}}class N9{constructor(e,t,n){this.isNodeUniform=!0,this.name=e,this.type=t,this.node=n.getSelf()}get value(){return this.node.value}set value(e){this.node.value=e}get id(){return this.node.id}get groupNode(){return this.node.groupNode}}class wP{constructor(e,t,n=!1,i=null){this.isNodeVar=!0,this.name=e,this.type=t,this.readOnly=n,this.count=i}}class C9 extends wP{constructor(e,t){super(e,t),this.needsInterpolation=!1,this.isNodeVarying=!0}}class w9{constructor(e,t,n=""){this.name=e,this.type=t,this.code=n,Object.defineProperty(this,"isNodeCode",{value:!0})}}let D9=0;class QE{constructor(e=null){this.id=D9++,this.nodesData=new WeakMap,this.parent=e}getData(e){let t=this.nodesData.get(e);return t===void 0&&this.parent!==null&&(t=this.parent.getData(e)),t}setData(e,t){this.nodesData.set(e,t)}}class U9{constructor(e,t){this.name=e,this.members=t,this.output=!1}}class yf{constructor(e,t){this.name=e,this.value=t,this.boundary=0,this.itemSize=0,this.offset=0}setValue(e){this.value=e}getValue(){return this.value}}class L9 extends yf{constructor(e,t=0){super(e,t),this.isNumberUniform=!0,this.boundary=4,this.itemSize=1}}class B9 extends yf{constructor(e,t=new Xe){super(e,t),this.isVector2Uniform=!0,this.boundary=8,this.itemSize=2}}class O9 extends yf{constructor(e,t=new Y){super(e,t),this.isVector3Uniform=!0,this.boundary=16,this.itemSize=3}}class P9 extends yf{constructor(e,t=new Ot){super(e,t),this.isVector4Uniform=!0,this.boundary=16,this.itemSize=4}}class I9 extends yf{constructor(e,t=new ft){super(e,t),this.isColorUniform=!0,this.boundary=16,this.itemSize=3}}class F9 extends yf{constructor(e,t=new J_){super(e,t),this.isMatrix2Uniform=!0,this.boundary=16,this.itemSize=4}}class z9 extends yf{constructor(e,t=new Qt){super(e,t),this.isMatrix3Uniform=!0,this.boundary=48,this.itemSize=12}}class V9 extends yf{constructor(e,t=new Mt){super(e,t),this.isMatrix4Uniform=!0,this.boundary=64,this.itemSize=16}}class G9 extends L9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class H9 extends B9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class k9 extends O9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class q9 extends P9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class W9 extends I9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class X9 extends F9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class Y9 extends z9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}class j9 extends V9{constructor(e){super(e.name,e.value),this.nodeUniform=e}getValue(){return this.nodeUniform.value}getType(){return this.nodeUniform.type}}const L2=new WeakMap,Z9=new Map([[Int8Array,"int"],[Int16Array,"int"],[Int32Array,"int"],[Uint8Array,"uint"],[Uint16Array,"uint"],[Uint32Array,"uint"],[Float32Array,"float"]]),HS=r=>/e/g.test(r)?String(r).replace(/\+/g,""):(r=Number(r),r+(r%1?"":".0"));class DP{constructor(e,t,n){this.object=e,this.material=e&&e.material||null,this.geometry=e&&e.geometry||null,this.renderer=t,this.parser=n,this.scene=null,this.camera=null,this.nodes=[],this.sequentialNodes=[],this.updateNodes=[],this.updateBeforeNodes=[],this.updateAfterNodes=[],this.hashNodes={},this.observer=null,this.lightsNode=null,this.environmentNode=null,this.fogNode=null,this.clippingContext=null,this.vertexShader=null,this.fragmentShader=null,this.computeShader=null,this.flowNodes={vertex:[],fragment:[],compute:[]},this.flowCode={vertex:"",fragment:"",compute:""},this.uniforms={vertex:[],fragment:[],compute:[],index:0},this.structs={vertex:[],fragment:[],compute:[],index:0},this.bindings={vertex:{},fragment:{},compute:{}},this.bindingsIndexes={},this.bindGroups=null,this.attributes=[],this.bufferAttributes=[],this.varyings=[],this.codes={},this.vars={},this.declarations={},this.flow={code:""},this.chaining=[],this.stack=ab(),this.stacks=[],this.tab="	",this.currentFunctionNode=null,this.context={material:this.material},this.cache=new QE,this.globalCache=this.cache,this.flowsData=new WeakMap,this.shaderStage=null,this.buildStage=null}getBindGroupsCache(){let e=L2.get(this.renderer);return e===void 0&&(e=new qu,L2.set(this.renderer,e)),e}createRenderTarget(e,t,n){return new tl(e,t,n)}createCubeRenderTarget(e,t){return new cO(e,t)}includes(e){return this.nodes.includes(e)}getOutputStructName(){}_getBindGroup(e,t){const n=this.getBindGroupsCache(),i=[];let s=!0;for(const l of t)i.push(l),s=s&&l.groupNode.shared!==!0;let a;return s?(a=n.get(i),a===void 0&&(a=new l1(e,i,this.bindingsIndexes[e].group,i),n.set(i,a))):a=new l1(e,i,this.bindingsIndexes[e].group,i),a}getBindGroupArray(e,t){const n=this.bindings[t];let i=n[e];return i===void 0&&(this.bindingsIndexes[e]===void 0&&(this.bindingsIndexes[e]={binding:0,group:Object.keys(this.bindingsIndexes).length}),n[e]=i=[]),i}getBindings(){let e=this.bindGroups;if(e===null){const t={},n=this.bindings;for(const i of XA)for(const s in n[i]){const a=n[i][s];(t[s]||(t[s]=[])).push(...a)}e=[];for(const i in t){const s=t[i],a=this._getBindGroup(i,s);e.push(a)}this.bindGroups=e}return e}sortBindingGroups(){const e=this.getBindings();e.sort((t,n)=>t.bindings[0].groupNode.order-n.bindings[0].groupNode.order);for(let t=0;t<e.length;t++){const n=e[t];this.bindingsIndexes[n.name].group=t,n.index=t}}setHashNode(e,t){this.hashNodes[t]=e}addNode(e){this.nodes.includes(e)===!1&&(this.nodes.push(e),this.setHashNode(e,e.getHash(this)))}addSequentialNode(e){this.sequentialNodes.includes(e)===!1&&this.sequentialNodes.push(e)}buildUpdateNodes(){for(const e of this.nodes)e.getUpdateType()!==en.NONE&&this.updateNodes.push(e.getSelf());for(const e of this.sequentialNodes){const t=e.getUpdateBeforeType(),n=e.getUpdateAfterType();t!==en.NONE&&this.updateBeforeNodes.push(e.getSelf()),n!==en.NONE&&this.updateAfterNodes.push(e.getSelf())}}get currentNode(){return this.chaining[this.chaining.length-1]}isFilteredTexture(e){return e.magFilter===Zn||e.magFilter===ef||e.magFilter===Ol||e.magFilter===xr||e.minFilter===Zn||e.minFilter===ef||e.minFilter===Ol||e.minFilter===xr}addChain(e){this.chaining.push(e)}removeChain(e){if(this.chaining.pop()!==e)throw new Error("NodeBuilder: Invalid node chaining!")}getMethod(e){return e}getNodeFromHash(e){return this.hashNodes[e]}addFlow(e,t){return this.flowNodes[e].push(t),t}setContext(e){this.context=e}getContext(){return this.context}getSharedContext(){return{...this.context},this.context}setCache(e){this.cache=e}getCache(){return this.cache}getCacheFromNode(e,t=!0){const n=this.getDataFromNode(e);return n.cache===void 0&&(n.cache=new QE(t?this.getCache():null)),n.cache}isAvailable(){return!1}getVertexIndex(){console.warn("Abstract function.")}getInstanceIndex(){console.warn("Abstract function.")}getDrawIndex(){console.warn("Abstract function.")}getFrontFacing(){console.warn("Abstract function.")}getFragCoord(){console.warn("Abstract function.")}isFlipY(){return!1}increaseUsage(e){const t=this.getDataFromNode(e);return t.usageCount=t.usageCount===void 0?1:t.usageCount+1,t.usageCount}generateTexture(){console.warn("Abstract function.")}generateTextureLod(){console.warn("Abstract function.")}generateArrayDeclaration(e,t){return this.getType(e)+"[ "+t+" ]"}generateArray(e,t,n=null){let i=this.generateArrayDeclaration(e,t)+"( ";for(let s=0;s<t;s++){const a=n?n[s]:null;a!==null?i+=a.build(this,e):i+=this.generateConst(e),s<t-1&&(i+=", ")}return i+=" )",i}generateStruct(e,t,n=null){const i=[];for(const s of t){const{name:a,type:l}=s;n&&n[a]&&n[a].isNode?i.push(n[a].build(this,l)):i.push(this.generateConst(l))}return e+"( "+i.join(", ")+" )"}generateConst(e,t=null){if(t===null&&(e==="float"||e==="int"||e==="uint"?t=0:e==="bool"?t=!1:e==="color"?t=new ft:e==="vec2"?t=new Xe:e==="vec3"?t=new Y:e==="vec4"&&(t=new Ot)),e==="float")return HS(t);if(e==="int")return`${Math.round(t)}`;if(e==="uint")return t>=0?`${Math.round(t)}u`:"0u";if(e==="bool")return t?"true":"false";if(e==="color")return`${this.getType("vec3")}( ${HS(t.r)}, ${HS(t.g)}, ${HS(t.b)} )`;const n=this.getTypeLength(e),i=this.getComponentType(e),s=a=>this.generateConst(i,a);if(n===2)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)} )`;if(n===3)return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)} )`;if(n===4&&e!=="mat2")return`${this.getType(e)}( ${s(t.x)}, ${s(t.y)}, ${s(t.z)}, ${s(t.w)} )`;if(n>=4&&t&&(t.isMatrix2||t.isMatrix3||t.isMatrix4))return`${this.getType(e)}( ${t.elements.map(s).join(", ")} )`;if(n>4)return`${this.getType(e)}()`;throw new Error(`NodeBuilder: Type '${e}' not found in generate constant attempt.`)}getType(e){return e==="color"?"vec3":e}hasGeometryAttribute(e){return this.geometry&&this.geometry.getAttribute(e)!==void 0}getAttribute(e,t){const n=this.attributes;for(const s of n)if(s.name===e)return s;const i=new U2(e,t);return this.registerDeclaration(i),n.push(i),i}getPropertyName(e){return e.name}isVector(e){return/vec\d/.test(e)}isMatrix(e){return/mat\d/.test(e)}isReference(e){return e==="void"||e==="property"||e==="sampler"||e==="samplerComparison"||e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="depthTexture"||e==="texture3D"}needsToWorkingColorSpace(){return!1}getComponentTypeFromTexture(e){const t=e.type;if(e.isDataTexture){if(t===Xs)return"int";if(t===di)return"uint"}return"float"}getElementType(e){return e==="mat2"?"vec2":e==="mat3"?"vec3":e==="mat4"?"vec4":this.getComponentType(e)}getComponentType(e){if(e=this.getVectorType(e),e==="float"||e==="bool"||e==="int"||e==="uint")return e;const t=/(b|i|u|)(vec|mat)([2-4])/.exec(e);return t===null?null:t[1]==="b"?"bool":t[1]==="i"?"int":t[1]==="u"?"uint":"float"}getVectorType(e){return e==="color"?"vec3":e==="texture"||e==="cubeTexture"||e==="storageTexture"||e==="texture3D"?"vec4":e}getTypeFromLength(e,t="float"){if(e===1)return t;let n=c3(e);const i=t==="float"?"":t[0];return/mat2/.test(t)===!0&&(n=n.replace("vec","mat")),i+n}getTypeFromArray(e){return Z9.get(e.constructor)}isInteger(e){return/int|uint|(i|u)vec/.test(e)}getTypeFromAttribute(e){let t=e;e.isInterleavedBufferAttribute&&(t=e.data);const n=t.array,i=e.itemSize,s=e.normalized;let a;return!(e instanceof z1)&&s!==!0&&(a=this.getTypeFromArray(n)),this.getTypeFromLength(i,a)}getTypeLength(e){const t=this.getVectorType(e),n=/vec([2-4])/.exec(t);return n!==null?Number(n[1]):t==="float"||t==="bool"||t==="int"||t==="uint"?1:/mat2/.test(e)===!0?4:/mat3/.test(e)===!0?9:/mat4/.test(e)===!0?16:0}getVectorFromMatrix(e){return e.replace("mat","vec")}changeComponentType(e,t){return this.getTypeFromLength(this.getTypeLength(e),t)}getIntegerType(e){const t=this.getComponentType(e);return t==="int"||t==="uint"?e:this.changeComponentType(e,"int")}addStack(){return this.stack=ab(this.stack),this.stacks.push(RR()||this.stack),C_(this.stack),this.stack}removeStack(){const e=this.stack;return this.stack=e.parent,C_(this.stacks.pop()),e}getDataFromNode(e,t=this.shaderStage,n=null){n=n===null?e.isGlobal(this)?this.globalCache:this.cache:n;let i=n.getData(e);return i===void 0&&(i={},n.setData(e,i)),i[t]===void 0&&(i[t]={}),i[t]}getNodeProperties(e,t="any"){const n=this.getDataFromNode(e,t);return n.properties||(n.properties={outputNode:null})}getBufferAttributeFromNode(e,t){const n=this.getDataFromNode(e);let i=n.bufferAttribute;if(i===void 0){const s=this.uniforms.index++;i=new U2("nodeAttribute"+s,t,e),this.bufferAttributes.push(i),n.bufferAttribute=i}return i}getStructTypeFromNode(e,t,n=null,i=this.shaderStage){const s=this.getDataFromNode(e,i,this.globalCache);let a=s.structType;if(a===void 0){const l=this.structs.index++;n===null&&(n="StructType"+l),a=new U9(n,t),this.structs[i].push(a),s.structType=a}return a}getOutputStructTypeFromNode(e,t){const n=this.getStructTypeFromNode(e,t,"OutputType","fragment");return n.output=!0,n}getUniformFromNode(e,t,n=this.shaderStage,i=null){const s=this.getDataFromNode(e,n,this.globalCache);let a=s.uniform;if(a===void 0){const l=this.uniforms.index++;a=new N9(i||"nodeUniform"+l,t,e),this.uniforms[n].push(a),this.registerDeclaration(a),s.uniform=a}return a}getArrayCount(e){let t=null;return e.isArrayNode?t=e.count:e.isVarNode&&e.node.isArrayNode&&(t=e.node.count),t}getVarFromNode(e,t=null,n=e.getNodeType(this),i=this.shaderStage,s=!1){const a=this.getDataFromNode(e,i);let l=a.variable;if(l===void 0){const c=s?"_const":"_var",d=this.vars[i]||(this.vars[i]=[]),m=this.vars[c]||(this.vars[c]=0);t===null&&(t=(s?"nodeConst":"nodeVar")+m,this.vars[c]++);const y=this.getArrayCount(e);l=new wP(t,n,s,y),s||d.push(l),this.registerDeclaration(l),a.variable=l}return l}isDeterministic(e){if(e.isMathNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0)&&(e.cNode?this.isDeterministic(e.cNode):!0);if(e.isOperatorNode)return this.isDeterministic(e.aNode)&&(e.bNode?this.isDeterministic(e.bNode):!0);if(e.isArrayNode){if(e.values!==null){for(const t of e.values)if(!this.isDeterministic(t))return!1}return!0}else if(e.isConstNode)return!0;return!1}getVaryingFromNode(e,t=null,n=e.getNodeType(this)){const i=this.getDataFromNode(e,"any");let s=i.varying;if(s===void 0){const a=this.varyings,l=a.length;t===null&&(t="nodeVarying"+l),s=new C9(t,n),a.push(s),this.registerDeclaration(s),i.varying=s}return s}registerDeclaration(e){const t=this.shaderStage,n=this.declarations[t]||(this.declarations[t]={}),i=this.getPropertyName(e);let s=1,a=i;for(;n[a]!==void 0;)a=i+"_"+s++;n[a]=e,s>1&&(e.name=a,console.warn(`THREE.TSL: Declaration name '${i}' of '${e.type}' already in use. Renamed to '${a}'.`))}getCodeFromNode(e,t,n=this.shaderStage){const i=this.getDataFromNode(e);let s=i.code;if(s===void 0){const a=this.codes[n]||(this.codes[n]=[]),l=a.length;s=new w9("nodeCode"+l,t),a.push(s),i.code=s}return s}addFlowCodeHierarchy(e,t){const{flowCodes:n,flowCodeBlock:i}=this.getDataFromNode(e);let s=!0,a=t;for(;a;){if(i.get(a)===!0){s=!1;break}a=this.getDataFromNode(a).parentNodeBlock}if(s)for(const l of n)this.addLineFlowCode(l)}addLineFlowCodeBlock(e,t,n){const i=this.getDataFromNode(e),s=i.flowCodes||(i.flowCodes=[]),a=i.flowCodeBlock||(i.flowCodeBlock=new WeakMap);s.push(t),a.set(n,!0)}addLineFlowCode(e,t=null){return e===""?this:(t!==null&&this.context.nodeBlock&&this.addLineFlowCodeBlock(t,e,this.context.nodeBlock),e=this.tab+e,/;\s*$/.test(e)||(e=e+`;
`),this.flow.code+=e,this)}addFlowCode(e){return this.flow.code+=e,this}addFlowTab(){return this.tab+="	",this}removeFlowTab(){return this.tab=this.tab.slice(0,-1),this}getFlowData(e){return this.flowsData.get(e)}flowNode(e){const t=e.getNodeType(this),n=this.flowChildNode(e,t);return this.flowsData.set(e,n),n}addInclude(e){this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(e)}buildFunctionNode(e){const t=new iP,n=this.currentFunctionNode;return this.currentFunctionNode=t,t.code=this.buildFunctionCode(e),this.currentFunctionNode=n,t}flowShaderNode(e){const t=e.layout,n={[Symbol.iterator](){let a=0;const l=Object.values(this);return{next:()=>({value:l[a],done:a++>=l.length})}}};for(const a of t.inputs)n[a.name]=new OO(a.type,a.name);e.layout=null;const i=e.call(n),s=this.flowStagesNode(i,t.type);return e.layout=t,s}flowStagesNode(e,t=null){const n=this.flow,i=this.vars,s=this.declarations,a=this.cache,l=this.buildStage,c=this.stack,d={code:""};this.flow=d,this.vars={},this.declarations={},this.cache=new QE,this.stack=ab();for(const m of WA)this.setBuildStage(m),d.result=e.build(this,t);return d.vars=this.getVars(this.shaderStage),this.flow=n,this.vars=i,this.declarations=s,this.cache=a,this.stack=c,this.setBuildStage(l),d}getFunctionOperator(){return null}buildFunctionCode(){console.warn("Abstract function.")}flowChildNode(e,t=null){const n=this.flow,i={code:""};return this.flow=i,i.result=e.build(this,t),this.flow=n,i}flowNodeFromShaderStage(e,t,n=null,i=null){const s=this.shaderStage;this.setShaderStage(e);const a=this.flowChildNode(t,n);return i!==null&&(a.code+=`${this.tab+i} = ${a.result};
`),this.flowCode[e]=this.flowCode[e]+a.code,this.setShaderStage(s),a}getAttributesArray(){return this.attributes.concat(this.bufferAttributes)}getAttributes(){console.warn("Abstract function.")}getVaryings(){console.warn("Abstract function.")}getVar(e,t,n=null){return`${n!==null?this.generateArrayDeclaration(e,n):this.getType(e)} ${t}`}getVars(e){let t="";const n=this.vars[e];if(n!==void 0)for(const i of n)t+=`${this.getVar(i.type,i.name)}; `;return t}getUniforms(){console.warn("Abstract function.")}getCodes(e){const t=this.codes[e];let n="";if(t!==void 0)for(const i of t)n+=i.code+`
`;return n}getHash(){return this.vertexShader+this.fragmentShader+this.computeShader}setShaderStage(e){this.shaderStage=e}getShaderStage(){return this.shaderStage}setBuildStage(e){this.buildStage=e}getBuildStage(){return this.buildStage}buildCode(){console.warn("Abstract function.")}build(){const{object:e,material:t,renderer:n}=this;if(t!==null){let i=n.library.fromMaterial(t);i===null&&(console.error(`NodeMaterial: Material "${t.type}" is not compatible.`),i=new Ts),i.build(this)}else this.addFlow("compute",e);for(const i of WA){this.setBuildStage(i),this.context.vertex&&this.context.vertex.isNode&&this.flowNodeFromShaderStage("vertex",this.context.vertex);for(const s of XA){this.setShaderStage(s);const a=this.flowNodes[s];for(const l of a)i==="generate"?this.flowNode(l):l.build(this)}}return this.setBuildStage(null),this.setShaderStage(null),this.buildCode(),this.buildUpdateNodes(),this}getNodeUniform(e,t){if(t==="float"||t==="int"||t==="uint")return new G9(e);if(t==="vec2"||t==="ivec2"||t==="uvec2")return new H9(e);if(t==="vec3"||t==="ivec3"||t==="uvec3")return new k9(e);if(t==="vec4"||t==="ivec4"||t==="uvec4")return new q9(e);if(t==="color")return new W9(e);if(t==="mat2")return new X9(e);if(t==="mat3")return new Y9(e);if(t==="mat4")return new j9(e);throw new Error(`Uniform "${t}" not declared.`)}format(e,t,n){if(t=this.getVectorType(t),n=this.getVectorType(n),t===n||n===null||this.isReference(n))return e;const i=this.getTypeLength(t),s=this.getTypeLength(n);return i===16&&s===9?`${this.getType(n)}( ${e}[ 0 ].xyz, ${e}[ 1 ].xyz, ${e}[ 2 ].xyz )`:i===9&&s===4?`${this.getType(n)}( ${e}[ 0 ].xy, ${e}[ 1 ].xy )`:i>4||s>4||s===0?e:i===s?`${this.getType(n)}( ${e} )`:i>s?this.format(`${e}.${"xyz".slice(0,s)}`,this.getTypeFromLength(s,this.getComponentType(t)),n):s===4&&i>1?`${this.getType(n)}( ${this.format(e,t,"vec3")}, 1.0 )`:i===2?`${this.getType(n)}( ${this.format(e,t,"vec2")}, 0.0 )`:(i===1&&s>1&&t!==this.getComponentType(n)&&(e=`${this.getType(this.getComponentType(n))}( ${e} )`),`${this.getType(n)}( ${e} )`)}getSignature(){return`// Three.js r${Zg} - Node System
`}createNodeMaterial(e="NodeMaterial"){throw new Error(`THREE.NodeBuilder: createNodeMaterial() was deprecated. Use new ${e}() instead.`)}}class B2{constructor(){this.time=0,this.deltaTime=0,this.frameId=0,this.renderId=0,this.updateMap=new WeakMap,this.updateBeforeMap=new WeakMap,this.updateAfterMap=new WeakMap,this.renderer=null,this.material=null,this.camera=null,this.object=null,this.scene=null}_getMaps(e,t){let n=e.get(t);return n===void 0&&(n={renderMap:new WeakMap,frameMap:new WeakMap},e.set(t,n)),n}updateBeforeNode(e){const t=e.getUpdateBeforeType(),n=e.updateReference(this);if(t===en.FRAME){const{frameMap:i}=this._getMaps(this.updateBeforeMap,n);i.get(n)!==this.frameId&&e.updateBefore(this)!==!1&&i.set(n,this.frameId)}else if(t===en.RENDER){const{renderMap:i}=this._getMaps(this.updateBeforeMap,n);i.get(n)!==this.renderId&&e.updateBefore(this)!==!1&&i.set(n,this.renderId)}else t===en.OBJECT&&e.updateBefore(this)}updateAfterNode(e){const t=e.getUpdateAfterType(),n=e.updateReference(this);if(t===en.FRAME){const{frameMap:i}=this._getMaps(this.updateAfterMap,n);i.get(n)!==this.frameId&&e.updateAfter(this)!==!1&&i.set(n,this.frameId)}else if(t===en.RENDER){const{renderMap:i}=this._getMaps(this.updateAfterMap,n);i.get(n)!==this.renderId&&e.updateAfter(this)!==!1&&i.set(n,this.renderId)}else t===en.OBJECT&&e.updateAfter(this)}updateNode(e){const t=e.getUpdateType(),n=e.updateReference(this);if(t===en.FRAME){const{frameMap:i}=this._getMaps(this.updateMap,n);i.get(n)!==this.frameId&&e.update(this)!==!1&&i.set(n,this.frameId)}else if(t===en.RENDER){const{renderMap:i}=this._getMaps(this.updateMap,n);i.get(n)!==this.renderId&&e.update(this)!==!1&&i.set(n,this.renderId)}else t===en.OBJECT&&e.update(this)}update(){this.frameId++,this.lastTime===void 0&&(this.lastTime=performance.now()),this.deltaTime=(performance.now()-this.lastTime)/1e3,this.lastTime=performance.now(),this.time+=this.deltaTime}}class LN{constructor(e,t,n=null,i="",s=!1){this.type=e,this.name=t,this.count=n,this.qualifier=i,this.isConst=s}}LN.isNodeFunctionInput=!0;class K9 extends wp{static get type(){return"DirectionalLightNode"}constructor(e=null){super(e)}setupDirect(){const e=this.colorNode;return{lightDirection:RN(this.light),lightColor:e}}}const JE=new Mt,kS=new Mt;let Xv=null;class Q9 extends wp{static get type(){return"RectAreaLightNode"}constructor(e=null){super(e),this.halfHeight=Ct(new Y).setGroup(Gt),this.halfWidth=Ct(new Y).setGroup(Gt),this.updateType=en.RENDER}update(e){super.update(e);const{light:t}=this,n=e.camera.matrixWorldInverse;kS.identity(),JE.copy(t.matrixWorld),JE.premultiply(n),kS.extractRotation(JE),this.halfWidth.value.set(t.width*.5,0,0),this.halfHeight.value.set(0,t.height*.5,0),this.halfWidth.value.applyMatrix4(kS),this.halfHeight.value.applyMatrix4(kS)}setupDirectRectArea(e){let t,n;e.isAvailable("float32Filterable")?(t=En(Xv.LTC_FLOAT_1),n=En(Xv.LTC_FLOAT_2)):(t=En(Xv.LTC_HALF_1),n=En(Xv.LTC_HALF_2));const{colorNode:i,light:s}=this,a=AN(s);return{lightColor:i,lightPosition:a,halfWidth:this.halfWidth,halfHeight:this.halfHeight,ltc_1:t,ltc_2:n}}static setLTC(e){Xv=e}}class UP extends wp{static get type(){return"SpotLightNode"}constructor(e=null){super(e),this.coneCosNode=Ct(0).setGroup(Gt),this.penumbraCosNode=Ct(0).setGroup(Gt),this.cutoffDistanceNode=Ct(0).setGroup(Gt),this.decayExponentNode=Ct(0).setGroup(Gt)}update(e){super.update(e);const{light:t}=this;this.coneCosNode.value=Math.cos(t.angle),this.penumbraCosNode.value=Math.cos(t.angle*(1-t.penumbra)),this.cutoffDistanceNode.value=t.distance,this.decayExponentNode.value=t.decay}getSpotAttenuation(e){const{coneCosNode:t,penumbraCosNode:n}=this;return Vu(t,n,e)}setupDirect(e){const{colorNode:t,cutoffDistanceNode:n,decayExponentNode:i,light:s}=this,a=this.getLightVector(e),l=a.normalize(),c=l.dot(RN(s)),d=this.getSpotAttenuation(c),m=a.length(),y=wN({lightDistance:m,cutoffDistance:n,decayExponent:i});let v=t.mul(d).mul(y);if(s.map){const x=oP(s,e.context.positionWorld),S=En(s.map,x.xy).onRenderUpdate(()=>s.map);v=x.mul(2).sub(1).abs().lessThan(1).all().select(v.mul(S),v)}return{lightColor:v,lightDirection:l}}}class J9 extends UP{static get type(){return"IESSpotLightNode"}getSpotAttenuation(e){const t=this.light.iesMap;let n=null;if(t&&t.isTexture===!0){const i=e.acos().mul(1/Math.PI);n=En(t,Qe(i,0),0).r}else n=super.getSpotAttenuation(e);return n}}class $9 extends wp{static get type(){return"AmbientLightNode"}constructor(e=null){super(e)}setup({context:e}){e.irradiance.addAssign(this.colorNode)}}class e7 extends wp{static get type(){return"HemisphereLightNode"}constructor(e=null){super(e),this.lightPositionNode=EN(e),this.lightDirectionNode=this.lightPositionNode.normalize(),this.groundColorNode=Ct(new ft).setGroup(Gt)}update(e){const{light:t}=this;super.update(e),this.lightPositionNode.object3d=t,this.groundColorNode.value.copy(t.groundColor).multiplyScalar(t.intensity)}setup(e){const{colorNode:t,groundColorNode:n,lightDirectionNode:i}=this,a=el.dot(i).mul(.5).add(.5),l=ei(n,t,a);e.context.irradiance.addAssign(l)}}class t7 extends wp{static get type(){return"LightProbeNode"}constructor(e=null){super(e);const t=[];for(let n=0;n<9;n++)t.push(new Y);this.lightProbe=Bl(t)}update(e){const{light:t}=this;super.update(e);for(let n=0;n<9;n++)this.lightProbe.array[n].copy(t.sh.coefficients[n]).multiplyScalar(t.intensity)}setup(e){const t=CP(XT,this.lightProbe);e.context.irradiance.addAssign(t)}}class LP{parseFunction(){console.warn("Abstract function.")}}class BN{constructor(e,t,n="",i=""){this.type=e,this.inputs=t,this.name=n,this.precision=i}getCode(){console.warn("Abstract function.")}}BN.isNodeFunction=!0;const n7=/^\s*(highp|mediump|lowp)?\s*([a-z_0-9]+)\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)/i,i7=/[a-z_0-9]+/ig,O2="#pragma main",s7=r=>{r=r.trim();const e=r.indexOf(O2),t=e!==-1?r.slice(e+O2.length):r,n=t.match(n7);if(n!==null&&n.length===5){const i=n[4],s=[];let a=null;for(;(a=i7.exec(i))!==null;)s.push(a);const l=[];let c=0;for(;c<s.length;){const S=s[c][0]==="const";S===!0&&c++;let A=s[c][0];A==="in"||A==="out"||A==="inout"?c++:A="";const E=s[c++][0];let M=Number.parseInt(s[c][0]);Number.isNaN(M)===!1?c++:M=null;const C=s[c++][0];l.push(new LN(E,C,M,A,S))}const d=t.substring(n[0].length),m=n[3]!==void 0?n[3]:"",y=n[2],v=n[1]!==void 0?n[1]:"",x=e!==-1?r.slice(0,e):"";return{type:y,inputs:l,name:m,precision:v,inputsCode:i,blockCode:d,headerCode:x}}else throw new Error("FunctionNode: Function is not a GLSL code.")};class r7 extends BN{constructor(e){const{type:t,inputs:n,name:i,precision:s,inputsCode:a,blockCode:l,headerCode:c}=s7(e);super(t,n,i,s),this.inputsCode=a,this.blockCode=l,this.headerCode=c}getCode(e=this.name){let t;const n=this.blockCode;if(n!==""){const{type:i,inputsCode:s,headerCode:a,precision:l}=this;let c=`${i} ${e} ( ${s.trim()} )`;l!==""&&(c=`${l} ${c}`),t=a+c+n}else t="";return t}}class a7 extends LP{parseFunction(e){return new r7(e)}}const P2=new WeakMap,Nu=[],$m=[];class o7 extends gf{constructor(e,t){super(),this.renderer=e,this.backend=t,this.nodeFrame=new B2,this.nodeBuilderCache=new Map,this.callHashCache=new qu,this.groupsData=new qu,this.cacheLib={}}updateGroup(e){const t=e.groupNode,n=t.name;if(n===CR.name)return!0;if(n===Gt.name){const s=this.get(e),a=this.nodeFrame.renderId;return s.renderId!==a?(s.renderId=a,!0):!1}if(n===B3.name){const s=this.get(e),a=this.nodeFrame.frameId;return s.frameId!==a?(s.frameId=a,!0):!1}Nu[0]=t,Nu[1]=e;let i=this.groupsData.get(Nu);return i===void 0&&this.groupsData.set(Nu,i={}),Nu.length=0,i.version!==t.version?(i.version=t.version,!0):!1}getForRenderCacheKey(e){return e.initialCacheKey}getForRender(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const{nodeBuilderCache:i}=this,s=this.getForRenderCacheKey(e);if(n=i.get(s),n===void 0){const a=this.backend.createNodeBuilder(e.object,this.renderer);a.scene=e.scene,a.material=e.material,a.camera=e.camera,a.context.material=e.material,a.lightsNode=e.lightsNode,a.environmentNode=this.getEnvironmentNode(e.scene),a.fogNode=this.getFogNode(e.scene),a.clippingContext=e.clippingContext,a.build(),n=this._createNodeBuilderState(a),i.set(s,n)}n.usedTimes++,t.nodeBuilderState=n}return n}delete(e){if(e.isRenderObject){const t=this.get(e).nodeBuilderState;t.usedTimes--,t.usedTimes===0&&this.nodeBuilderCache.delete(this.getForRenderCacheKey(e))}return super.delete(e)}getForCompute(e){const t=this.get(e);let n=t.nodeBuilderState;if(n===void 0){const i=this.backend.createNodeBuilder(e,this.renderer);i.build(),n=this._createNodeBuilderState(i),t.nodeBuilderState=n}return n}_createNodeBuilderState(e){return new R9(e.vertexShader,e.fragmentShader,e.computeShader,e.getAttributesArray(),e.getBindings(),e.updateNodes,e.updateBeforeNodes,e.updateAfterNodes,e.observer,e.transforms)}getEnvironmentNode(e){this.updateEnvironment(e);let t=null;if(e.environmentNode&&e.environmentNode.isNode)t=e.environmentNode;else{const n=this.get(e);n.environmentNode&&(t=n.environmentNode)}return t}getBackgroundNode(e){this.updateBackground(e);let t=null;if(e.backgroundNode&&e.backgroundNode.isNode)t=e.backgroundNode;else{const n=this.get(e);n.backgroundNode&&(t=n.backgroundNode)}return t}getFogNode(e){return this.updateFog(e),e.fogNode||this.get(e).fogNode||null}getCacheKey(e,t){Nu[0]=e,Nu[1]=t;const n=this.renderer.info.calls,i=this.callHashCache.get(Nu)||{};if(i.callId!==n){const s=this.getEnvironmentNode(e),a=this.getFogNode(e);t&&$m.push(t.getCacheKey(!0)),s&&$m.push(s.getCacheKey()),a&&$m.push(a.getCacheKey()),$m.push(this.renderer.shadowMap.enabled?1:0),i.callId=n,i.cacheKey=UT($m),this.callHashCache.set(Nu,i),$m.length=0}return Nu.length=0,i.cacheKey}get isToneMappingState(){return!this.renderer.getRenderTarget()}updateBackground(e){const t=this.get(e),n=e.background;if(n){const i=e.backgroundBlurriness===0&&t.backgroundBlurriness>0||e.backgroundBlurriness>0&&t.backgroundBlurriness===0;if(t.background!==n||i){const s=this.getCacheNode("background",n,()=>{if(n.isCubeTexture===!0||n.mapping===Pu||n.mapping===Iu||n.mapping===Ic){if(e.backgroundBlurriness>0||n.mapping===Ic)return gN(n);{let a;return n.isCubeTexture===!0?a=qg(n):a=En(n),fO(a)}}else{if(n.isTexture===!0)return En(n,ku.flipY()).setUpdateMatrix(!0);n.isColor!==!0&&console.error("WebGPUNodes: Unsupported background configuration.",n)}},i);t.backgroundNode=s,t.background=n,t.backgroundBlurriness=e.backgroundBlurriness}}else t.backgroundNode&&(delete t.backgroundNode,delete t.background)}getCacheNode(e,t,n,i=!1){const s=this.cacheLib[e]||(this.cacheLib[e]=new WeakMap);let a=s.get(t);return(a===void 0||i)&&(a=n(),s.set(t,a)),a}updateFog(e){const t=this.get(e),n=e.fog;if(n){if(t.fog!==n){const i=this.getCacheNode("fog",n,()=>{if(n.isFogExp2){const s=_i("color","color",n).setGroup(Gt),a=_i("density","float",n).setGroup(Gt);return P_(s,bN(a))}else if(n.isFog){const s=_i("color","color",n).setGroup(Gt),a=_i("near","float",n).setGroup(Gt),l=_i("far","float",n).setGroup(Gt);return P_(s,SN(a,l))}else console.error("THREE.Renderer: Unsupported fog configuration.",n)});t.fogNode=i,t.fog=n}}else delete t.fogNode,delete t.fog}updateEnvironment(e){const t=this.get(e),n=e.environment;if(n){if(t.environment!==n){const i=this.getCacheNode("environment",n,()=>{if(n.isCubeTexture===!0)return qg(n);if(n.isTexture===!0)return En(n);console.error("Nodes: Unsupported environment configuration.",n)});t.environmentNode=i,t.environment=n}}else t.environmentNode&&(delete t.environmentNode,delete t.environment)}getNodeFrame(e=this.renderer,t=null,n=null,i=null,s=null){const a=this.nodeFrame;return a.renderer=e,a.scene=t,a.object=n,a.camera=i,a.material=s,a}getNodeFrameForRender(e){return this.getNodeFrame(e.renderer,e.scene,e.object,e.camera,e.material)}getOutputCacheKey(){const e=this.renderer;return e.toneMapping+","+e.currentColorSpace}hasOutputChange(e){return P2.get(e)!==this.getOutputCacheKey()}getOutputNode(e){const t=this.renderer,n=this.getOutputCacheKey(),i=En(e,ku).renderOutput(t.toneMapping,t.currentColorSpace);return P2.set(e,n),i}updateBefore(e){const t=e.getNodeBuilderState();for(const n of t.updateBeforeNodes)this.getNodeFrameForRender(e).updateBeforeNode(n)}updateAfter(e){const t=e.getNodeBuilderState();for(const n of t.updateAfterNodes)this.getNodeFrameForRender(e).updateAfterNode(n)}updateForCompute(e){const t=this.getNodeFrame(),n=this.getForCompute(e);for(const i of n.updateNodes)t.updateNode(i)}updateForRender(e){const t=this.getNodeFrameForRender(e),n=e.getNodeBuilderState();for(const i of n.updateNodes)t.updateNode(i)}needsRefresh(e){const t=this.getNodeFrameForRender(e);return e.getMonitor().needsRefresh(e,t)}dispose(){super.dispose(),this.nodeFrame=new B2,this.nodeBuilderCache=new Map,this.cacheLib={}}}const $E=new wu;class Lb{constructor(e=null){this.version=0,this.clipIntersection=null,this.cacheKey="",this.shadowPass=!1,this.viewNormalMatrix=new Qt,this.clippingGroupContexts=new WeakMap,this.intersectionPlanes=[],this.unionPlanes=[],this.parentVersion=null,e!==null&&(this.viewNormalMatrix=e.viewNormalMatrix,this.clippingGroupContexts=e.clippingGroupContexts,this.shadowPass=e.shadowPass,this.viewMatrix=e.viewMatrix)}projectPlanes(e,t,n){const i=e.length;for(let s=0;s<i;s++){$E.copy(e[s]).applyMatrix4(this.viewMatrix,this.viewNormalMatrix);const a=t[n+s],l=$E.normal;a.x=-l.x,a.y=-l.y,a.z=-l.z,a.w=$E.constant}}updateGlobal(e,t){this.shadowPass=e.overrideMaterial!==null&&e.overrideMaterial.isShadowPassMaterial,this.viewMatrix=t.matrixWorldInverse,this.viewNormalMatrix.getNormalMatrix(this.viewMatrix)}update(e,t){let n=!1;e.version!==this.parentVersion&&(this.intersectionPlanes=Array.from(e.intersectionPlanes),this.unionPlanes=Array.from(e.unionPlanes),this.parentVersion=e.version),this.clipIntersection!==t.clipIntersection&&(this.clipIntersection=t.clipIntersection,this.clipIntersection?this.unionPlanes.length=e.unionPlanes.length:this.intersectionPlanes.length=e.intersectionPlanes.length);const i=t.clippingPlanes,s=i.length;let a,l;if(this.clipIntersection?(a=this.intersectionPlanes,l=e.intersectionPlanes.length):(a=this.unionPlanes,l=e.unionPlanes.length),a.length!==l+s){a.length=l+s;for(let c=0;c<s;c++)a[l+c]=new Ot;n=!0}this.projectPlanes(i,a,l),n&&(this.version++,this.cacheKey=`${this.intersectionPlanes.length}:${this.unionPlanes.length}`)}getGroupContext(e){if(this.shadowPass&&!e.clipShadows)return this;let t=this.clippingGroupContexts.get(e);return t===void 0&&(t=new Lb(this),this.clippingGroupContexts.set(e,t)),t.update(this,e),t}get unionClippingCount(){return this.unionPlanes.length}}class l7{constructor(e,t){this.bundleGroup=e,this.camera=t}}const Yv=[];class u7{constructor(){this.bundles=new qu}get(e,t){const n=this.bundles;Yv[0]=e,Yv[1]=t;let i=n.get(Yv);return i===void 0&&(i=new l7(e,t),n.set(Yv,i)),Yv.length=0,i}dispose(){this.bundles=new qu}}class BP{constructor(){this.lightNodes=new WeakMap,this.materialNodes=new Map,this.toneMappingNodes=new Map}fromMaterial(e){if(e.isNodeMaterial)return e;let t=null;const n=this.getMaterialNodeClass(e.type);if(n!==null){t=new n;for(const i in e)t[i]=e[i]}return t}addToneMapping(e,t){this.addType(e,t,this.toneMappingNodes)}getToneMappingFunction(e){return this.toneMappingNodes.get(e)||null}getMaterialNodeClass(e){return this.materialNodes.get(e)||null}addMaterial(e,t){this.addType(e,t,this.materialNodes)}getLightNodeClass(e){return this.lightNodes.get(e)||null}addLight(e,t){this.addClass(e,t,this.lightNodes)}addType(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t=="function"||typeof t=="object")throw new Error(`Base class ${t} is not a class.`);n.set(t,e)}addClass(e,t,n){if(n.has(t)){console.warn(`Redefinition of node ${t.name}`);return}if(typeof e!="function")throw new Error(`Node class ${e.name} is not a class.`);if(typeof t!="function")throw new Error(`Base class ${t.name} is not a class.`);n.set(t,e)}}const c7=new NN,jv=[];class h7 extends qu{constructor(){super()}createNode(e=[]){return new NN().setLights(e)}getNode(e,t){if(e.isQuadMesh)return c7;jv[0]=e,jv[1]=t;let n=this.get(jv);return n===void 0&&(n=this.createNode(),this.set(jv,n)),jv.length=0,n}}class Jv extends tl{constructor(e=1,t=1,n={}){super(e,t,n),this.isXRRenderTarget=!0,this.hasExternalTextures=!1,this.autoAllocateDepthBuffer=!0}copy(e){return super.copy(e),this.hasExternalTextures=e.hasExternalTextures,this.autoAllocateDepthBuffer=e.autoAllocateDepthBuffer,this}}const I2=new Y,F2=new Y;class f7 extends bo{constructor(e){super(),this.enabled=!1,this.isPresenting=!1,this.cameraAutoUpdate=!0,this._renderer=e,this._cameraL=new us,this._cameraL.viewport=new Ot,this._cameraR=new us,this._cameraR.viewport=new Ot,this._cameras=[this._cameraL,this._cameraR],this._cameraXR=new vR,this._currentDepthNear=null,this._currentDepthFar=null,this._controllers=[],this._controllerInputSources=[],this._xrRenderTarget=null,this._layers=[],this._supportsLayers=!1,this._createXRLayer=v7.bind(this),this._gl=null,this._currentAnimationContext=null,this._currentAnimationLoop=null,this._currentPixelRatio=null,this._currentSize=new Xe,this._onSessionEvent=m7.bind(this),this._onSessionEnd=g7.bind(this),this._onInputSourcesChange=y7.bind(this),this._onAnimationFrame=_7.bind(this),this._referenceSpace=null,this._referenceSpaceType="local-floor",this._customReferenceSpace=null,this._framebufferScaleFactor=1,this._foveation=1,this._session=null,this._glBaseLayer=null,this._glBinding=null,this._glProjLayer=null,this._xrFrame=null,this._useLayers=typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype}getController(e){return this._getController(e).getTargetRaySpace()}getControllerGrip(e){return this._getController(e).getGripSpace()}getHand(e){return this._getController(e).getHandSpace()}getFoveation(){if(!(this._glProjLayer===null&&this._glBaseLayer===null))return this._foveation}setFoveation(e){this._foveation=e,this._glProjLayer!==null&&(this._glProjLayer.fixedFoveation=e),this._glBaseLayer!==null&&this._glBaseLayer.fixedFoveation!==void 0&&(this._glBaseLayer.fixedFoveation=e)}getFramebufferScaleFactor(){return this._framebufferScaleFactor}setFramebufferScaleFactor(e){this._framebufferScaleFactor=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change framebuffer scale while presenting.")}getReferenceSpaceType(){return this._referenceSpaceType}setReferenceSpaceType(e){this._referenceSpaceType=e,this.isPresenting===!0&&console.warn("THREE.XRManager: Cannot change reference space type while presenting.")}getReferenceSpace(){return this._customReferenceSpace||this._referenceSpace}setReferenceSpace(e){this._customReferenceSpace=e}getCamera(){return this._cameraXR}getEnvironmentBlendMode(){if(this._session!==null)return this._session.environmentBlendMode}getFrame(){return this._xrFrame}createQuadLayer(e,t,n,i,s,a,l,c=[]){const d=new Sp(e,t),m=new Jv(s,a,{format:Ni,type:Xi,depthTexture:new ya(s,a,c.stencil?Ha:di,void 0,void 0,void 0,void 0,void 0,void 0,c.stencil?qa:ka),stencilBuffer:c.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),y=new fa({color:16777215,side:pa});y.map=m.texture,y.map.offset.y=1,y.map.repeat.y=-1;const v=new bi(d,y);v.position.copy(n),v.quaternion.copy(i);const x={type:"quad",width:e,height:t,translation:n,quaternion:i,pixelwidth:s,pixelheight:a,plane:v,material:y,rendercall:l,renderTarget:m};if(this._layers.push(x),this._session!==null){x.plane.material=new fa({color:16777215,side:pa}),x.plane.material.blending=Vd,x.plane.material.blendEquation=_r,x.plane.material.blendSrc=Cu,x.plane.material.blendDst=Cu,x.xrlayer=this._createXRLayer(x);const S=this._session.renderState.layers;S.unshift(x.xrlayer),this._session.updateRenderState({layers:S})}else m.isXRRenderTarget=!1;return v}createCylinderLayer(e,t,n,i,s,a,l,c,d=[]){const m=new xp(e,e,e*t/n,64,64,!0,Math.PI-t/2,t),y=new Jv(a,l,{format:Ni,type:Xi,depthTexture:new ya(a,l,d.stencil?Ha:di,void 0,void 0,void 0,void 0,void 0,void 0,d.stencil?qa:ka),stencilBuffer:d.stencil,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),v=new fa({color:16777215,side:Ti});v.map=y.texture,v.map.offset.y=1,v.map.repeat.y=-1;const x=new bi(m,v);x.position.copy(i),x.quaternion.copy(s);const S={type:"cylinder",radius:e,centralAngle:t,aspectratio:n,translation:i,quaternion:s,pixelwidth:a,pixelheight:l,plane:x,material:v,rendercall:c,renderTarget:y};if(this._layers.push(S),this._session!==null){S.plane.material=new fa({color:16777215,side:Ti}),S.plane.material.blending=Vd,S.plane.material.blendEquation=_r,S.plane.material.blendSrc=Cu,S.plane.material.blendDst=Cu,S.xrlayer=this._createXRLayer(S);const A=this._session.renderState.layers;A.unshift(S.xrlayer),this._session.updateRenderState({layers:A})}else y.isXRRenderTarget=!1;return x}renderLayers(){const e=new Y,t=new ma,n=this.isPresenting;this.isPresenting=!1;for(const i of this._layers){if(i.renderTarget.isXRRenderTarget=this._session!==null,i.renderTarget.hasExternalTextures=i.renderTarget.isXRRenderTarget,i.renderTarget.autoAllocateDepthBuffer=!i.renderTarget.isXRRenderTarget,i.renderTarget.isXRRenderTarget&&this._supportsLayers){i.xrlayer.transform=new XRRigidTransform(i.plane.getWorldPosition(e),i.plane.getWorldQuaternion(t));const s=this._glBinding.getSubImage(i.xrlayer,this._xrFrame);this._renderer.backend.setXRRenderTargetTextures(i.renderTarget,s.colorTexture,s.depthStencilTexture)}this._renderer.setRenderTarget(i.renderTarget),i.rendercall()}this.isPresenting=n,this._renderer.setRenderTarget(null)}getSession(){return this._session}async setSession(e){const t=this._renderer,n=t.backend;this._gl=t.getContext();const i=this._gl,s=i.getContextAttributes();if(this._session=e,e!==null){if(n.isWebGPUBackend===!0)throw new Error('THREE.XRManager: XR is currently not supported with a WebGPU backend. Use WebGL by passing "{ forceWebGL: true }" to the constructor of the renderer.');if(e.addEventListener("select",this._onSessionEvent),e.addEventListener("selectstart",this._onSessionEvent),e.addEventListener("selectend",this._onSessionEvent),e.addEventListener("squeeze",this._onSessionEvent),e.addEventListener("squeezestart",this._onSessionEvent),e.addEventListener("squeezeend",this._onSessionEvent),e.addEventListener("end",this._onSessionEnd),e.addEventListener("inputsourceschange",this._onInputSourcesChange),await n.makeXRCompatible(),this._currentPixelRatio=t.getPixelRatio(),t.getSize(this._currentSize),this._currentAnimationContext=t._animation.getContext(),this._currentAnimationLoop=t._animation.getAnimationLoop(),t._animation.stop(),this._useLayers===!0){let a=null,l=null,c=null;t.depth&&(c=t.stencil?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24,a=t.stencil?qa:ka,l=t.stencil?Ha:di);const d={colorFormat:i.RGBA8,depthFormat:c,scaleFactor:this._framebufferScaleFactor},m=new XRWebGLBinding(e,i),y=m.createProjectionLayer(d),v=[y];if(this._glBinding=m,this._glProjLayer=y,t.setPixelRatio(1),t.setSize(y.textureWidth,y.textureHeight,!1),this._xrRenderTarget=new Jv(y.textureWidth,y.textureHeight,{format:Ni,type:Xi,colorSpace:t.outputColorSpace,depthTexture:new ya(y.textureWidth,y.textureHeight,l,void 0,void 0,void 0,void 0,void 0,void 0,a),stencilBuffer:t.stencil,samples:s.antialias?4:0,resolveDepthBuffer:y.ignoreDepthValues===!1,resolveStencilBuffer:y.ignoreDepthValues===!1}),this._xrRenderTarget.hasExternalTextures=!0,this._referenceSpace=await e.requestReferenceSpace(this.getReferenceSpaceType()),this._supportsLayers=e.enabledFeatures.includes("layers"),this._supportsLayers)for(const x of this._layers)x.plane.material=new fa({color:16777215,side:x.type==="cylinder"?Ti:pa}),x.plane.material.blending=Vd,x.plane.material.blendEquation=_r,x.plane.material.blendSrc=Cu,x.plane.material.blendDst=Cu,x.xrlayer=this._createXRLayer(x),v.unshift(x.xrlayer);e.updateRenderState({layers:v})}else{const a={antialias:t.samples>0,alpha:!0,depth:t.depth,stencil:t.stencil,framebufferScaleFactor:this.getFramebufferScaleFactor()},l=new XRWebGLLayer(e,i,a);this._glBaseLayer=l,e.updateRenderState({baseLayer:l}),t.setPixelRatio(1),t.setSize(l.framebufferWidth,l.framebufferHeight,!1),this._xrRenderTarget=new Jv(l.framebufferWidth,l.framebufferHeight,{format:Ni,type:Xi,colorSpace:t.outputColorSpace,stencilBuffer:t.stencil,resolveDepthBuffer:l.ignoreDepthValues===!1,resolveStencilBuffer:l.ignoreDepthValues===!1})}this.setFoveation(this.getFoveation()),t._animation.setAnimationLoop(this._onAnimationFrame),t._animation.setContext(e),t._animation.start(),this.isPresenting=!0,this.dispatchEvent({type:"sessionstart"})}}updateCamera(e){const t=this._session;if(t===null)return;const n=e.near,i=e.far,s=this._cameraXR,a=this._cameraL,l=this._cameraR;s.near=l.near=a.near=n,s.far=l.far=a.far=i,(this._currentDepthNear!==s.near||this._currentDepthFar!==s.far)&&(t.updateRenderState({depthNear:s.near,depthFar:s.far}),this._currentDepthNear=s.near,this._currentDepthFar=s.far),a.layers.mask=e.layers.mask|2,l.layers.mask=e.layers.mask|4,s.layers.mask=a.layers.mask|l.layers.mask;const c=e.parent,d=s.cameras;z2(s,c);for(let m=0;m<d.length;m++)z2(d[m],c);d.length===2?d7(s,a,l):s.projectionMatrix.copy(a.projectionMatrix),p7(e,s,c)}_getController(e){let t=this._controllers[e];return t===void 0&&(t=new i_,this._controllers[e]=t),t}}function d7(r,e,t){I2.setFromMatrixPosition(e.matrixWorld),F2.setFromMatrixPosition(t.matrixWorld);const n=I2.distanceTo(F2),i=e.projectionMatrix.elements,s=t.projectionMatrix.elements,a=i[14]/(i[10]-1),l=i[14]/(i[10]+1),c=(i[9]+1)/i[5],d=(i[9]-1)/i[5],m=(i[8]-1)/i[0],y=(s[8]+1)/s[0],v=a*m,x=a*y,S=n/(-m+y),A=S*-m;if(e.matrixWorld.decompose(r.position,r.quaternion,r.scale),r.translateX(A),r.translateZ(S),r.matrixWorld.compose(r.position,r.quaternion,r.scale),r.matrixWorldInverse.copy(r.matrixWorld).invert(),i[10]===-1)r.projectionMatrix.copy(e.projectionMatrix),r.projectionMatrixInverse.copy(e.projectionMatrixInverse);else{const E=a+S,M=l+S,C=v-A,w=x+(n-A),D=c*l/M*E,z=d*l/M*E;r.projectionMatrix.makePerspective(C,w,D,z,E,M),r.projectionMatrixInverse.copy(r.projectionMatrix).invert()}}function z2(r,e){e===null?r.matrixWorld.copy(r.matrix):r.matrixWorld.multiplyMatrices(e.matrixWorld,r.matrix),r.matrixWorldInverse.copy(r.matrixWorld).invert()}function p7(r,e,t){t===null?r.matrix.copy(e.matrixWorld):(r.matrix.copy(t.matrixWorld),r.matrix.invert(),r.matrix.multiply(e.matrixWorld)),r.matrix.decompose(r.position,r.quaternion,r.scale),r.updateMatrixWorld(!0),r.projectionMatrix.copy(e.projectionMatrix),r.projectionMatrixInverse.copy(e.projectionMatrixInverse),r.isPerspectiveCamera&&(r.fov=fp*2*Math.atan(1/r.projectionMatrix.elements[5]),r.zoom=1)}function m7(r){const e=this._controllerInputSources.indexOf(r.inputSource);if(e===-1)return;const t=this._controllers[e];if(t!==void 0){const n=this.getReferenceSpace();t.update(r.inputSource,r.frame,n),t.dispatchEvent({type:r.type,data:r.inputSource})}}function g7(){const r=this._session,e=this._renderer;r.removeEventListener("select",this._onSessionEvent),r.removeEventListener("selectstart",this._onSessionEvent),r.removeEventListener("selectend",this._onSessionEvent),r.removeEventListener("squeeze",this._onSessionEvent),r.removeEventListener("squeezestart",this._onSessionEvent),r.removeEventListener("squeezeend",this._onSessionEvent),r.removeEventListener("end",this._onSessionEnd),r.removeEventListener("inputsourceschange",this._onInputSourcesChange);for(let t=0;t<this._controllers.length;t++){const n=this._controllerInputSources[t];n!==null&&(this._controllerInputSources[t]=null,this._controllers[t].disconnect(n))}if(this._currentDepthNear=null,this._currentDepthFar=null,e.backend.setXRTarget(null),e.setOutputRenderTarget(null),e.setRenderTarget(null),this._session=null,this._xrRenderTarget=null,this._supportsLayers===!0)for(const t of this._layers)t.renderTarget=new Jv(t.pixelwidth,t.pixelheight,{format:Ni,type:Xi,depthTexture:new ya(t.pixelwidth,t.pixelheight,t.stencilBuffer?Ha:di,void 0,void 0,void 0,void 0,void 0,void 0,t.stencilBuffer?qa:ka),stencilBuffer:t.stencilBuffer,resolveDepthBuffer:!1,resolveStencilBuffer:!1}),t.renderTarget.isXRRenderTarget=!1,t.plane.material=t.material,t.material.map=t.renderTarget.texture,delete t.xrlayer;this.isPresenting=!1,e._animation.stop(),e._animation.setAnimationLoop(this._currentAnimationLoop),e._animation.setContext(this._currentAnimationContext),e._animation.start(),e.setPixelRatio(this._currentPixelRatio),e.setSize(this._currentSize.width,this._currentSize.height,!1),this.dispatchEvent({type:"sessionend"})}function y7(r){const e=this._controllers,t=this._controllerInputSources;for(let n=0;n<r.removed.length;n++){const i=r.removed[n],s=t.indexOf(i);s>=0&&(t[s]=null,e[s].disconnect(i))}for(let n=0;n<r.added.length;n++){const i=r.added[n];let s=t.indexOf(i);if(s===-1){for(let l=0;l<e.length;l++)if(l>=t.length){t.push(i),s=l;break}else if(t[l]===null){t[l]=i,s=l;break}if(s===-1)break}const a=e[s];a&&a.connect(i)}}function v7(r){return r.type==="quad"?this._glBinding.createQuadLayer({transform:new XRRigidTransform(r.translation,r.quaternion),depthFormat:this._gl.DEPTH_COMPONENT,width:r.width/2,height:r.height/2,space:this._referenceSpace,viewPixelWidth:r.pixelwidth,viewPixelHeight:r.pixelheight}):this._glBinding.createCylinderLayer({transform:new XRRigidTransform(r.translation,r.quaternion),depthFormat:this._gl.DEPTH_COMPONENT,radius:r.radius,centralAngle:r.centralAngle,aspectRatio:r.aspectRatio,space:this._referenceSpace,viewPixelWidth:r.pixelwidth,viewPixelHeight:r.pixelheight})}function _7(r,e){if(e===void 0)return;const t=this._cameraXR,n=this._renderer,i=n.backend,s=this._glBaseLayer,a=this.getReferenceSpace(),l=e.getViewerPose(a);if(this._xrFrame=e,l!==null){const c=l.views;this._glBaseLayer!==null&&i.setXRTarget(s.framebuffer);let d=!1;c.length!==t.cameras.length&&(t.cameras.length=0,d=!0);for(let m=0;m<c.length;m++){const y=c[m];let v;if(this._useLayers===!0){const S=this._glBinding.getViewSubImage(this._glProjLayer,y);v=S.viewport,m===0&&i.setXRRenderTargetTextures(this._xrRenderTarget,S.colorTexture,this._glProjLayer.ignoreDepthValues?void 0:S.depthStencilTexture)}else v=s.getViewport(y);let x=this._cameras[m];x===void 0&&(x=new us,x.layers.enable(m),x.viewport=new Ot,this._cameras[m]=x),x.matrix.fromArray(y.transform.matrix),x.matrix.decompose(x.position,x.quaternion,x.scale),x.projectionMatrix.fromArray(y.projectionMatrix),x.projectionMatrixInverse.copy(x.projectionMatrix).invert(),x.viewport.set(v.x,v.y,v.width,v.height),m===0&&(t.matrix.copy(x.matrix),t.matrix.decompose(t.position,t.quaternion,t.scale)),d===!0&&t.cameras.push(x)}n.setOutputRenderTarget(this._xrRenderTarget)}for(let c=0;c<this._controllers.length;c++){const d=this._controllerInputSources[c],m=this._controllers[c];d!==null&&m!==void 0&&m.update(d,e,a)}this._currentAnimationLoop&&this._currentAnimationLoop(r,e),e.detectedPlanes&&this.dispatchEvent({type:"planesdetected",data:e}),this._xrFrame=null}const V2=new ey,qS=new Xe,eA=new Ot,tA=new ty,WS=new Mt,qh=new Ot;class x7{constructor(e,t={}){this.isRenderer=!0;const{logarithmicDepthBuffer:n=!1,alpha:i=!0,depth:s=!0,stencil:a=!1,antialias:l=!1,samples:c=0,getFallback:d=null,colorBufferType:m=Ys}=t;this.domElement=e.getDomElement(),this.backend=e,this.samples=c||l===!0?4:0,this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.alpha=i,this.logarithmicDepthBuffer=n,this.outputColorSpace=wt,this.toneMapping=Gr,this.toneMappingExposure=1,this.sortObjects=!0,this.depth=s,this.stencil=a,this.info=new v6,this.nodes={modelViewMatrix:null,modelNormalViewMatrix:null},this.library=new BP,this.lighting=new h7,this._getFallback=d,this._pixelRatio=1,this._width=this.domElement.width,this._height=this.domElement.height,this._viewport=new Ot(0,0,this._width,this._height),this._scissor=new Ot(0,0,this._width,this._height),this._scissorTest=!1,this._attributes=null,this._geometries=null,this._nodes=null,this._animation=null,this._bindings=null,this._objects=null,this._pipelines=null,this._bundles=null,this._renderLists=null,this._renderContexts=null,this._textures=null,this._background=null,this._quad=new _N(new Ts),this._quad.material.name="Renderer_output",this._currentRenderContext=null,this._opaqueSort=null,this._transparentSort=null,this._frameBufferTarget=null;const y=this.alpha===!0?0:1;this._clearColor=new yN(0,0,0,y),this._clearDepth=1,this._clearStencil=0,this._renderTarget=null,this._activeCubeFace=0,this._activeMipmapLevel=0,this._outputRenderTarget=null,this._mrt=null,this._renderObjectFunction=null,this._currentRenderObjectFunction=null,this._currentRenderBundle=null,this._handleObjectFunction=this._renderObjectDirect,this._isDeviceLost=!1,this.onDeviceLost=this._onDeviceLost,this._colorBufferType=m,this._initialized=!1,this._initPromise=null,this._compilationPromises=null,this.transparent=!0,this.opaque=!0,this.shadowMap={enabled:!1,type:F_},this.xr=new f7(this),this.debug={checkShaderErrors:!0,onShaderError:null,getShaderAsync:async(v,x,S)=>{await this.compileAsync(v,x);const A=this._renderLists.get(v,x),E=this._renderContexts.get(v,x,this._renderTarget),M=v.overrideMaterial||S.material,C=this._objects.get(S,M,v,x,A.lightsNode,E,E.clippingContext),{fragmentShader:w,vertexShader:D}=C.getNodeBuilderState();return{fragmentShader:w,vertexShader:D}}}}async init(){if(this._initialized)throw new Error("Renderer: Backend has already been initialized.");return this._initPromise!==null?this._initPromise:(this._initPromise=new Promise(async(e,t)=>{let n=this.backend;try{await n.init(this)}catch(i){if(this._getFallback!==null)try{this.backend=n=this._getFallback(i),await n.init(this)}catch(s){t(s);return}else{t(i);return}}this._nodes=new o7(this,n),this._animation=new u6(this._nodes,this.info),this._attributes=new g6(n),this._background=new E9(this,this._nodes),this._geometries=new y6(this._attributes,this.info),this._textures=new L6(this,n,this.info),this._pipelines=new b6(n,this._nodes),this._bindings=new T6(n,this._nodes,this._textures,this._attributes,this._pipelines,this.info),this._objects=new d6(this,this._nodes,this._geometries,this._pipelines,this._bindings,this.info),this._renderLists=new A6(this.lighting),this._bundles=new u7,this._renderContexts=new D6,this._animation.start(),this._initialized=!0,e(this)}),this._initPromise)}get coordinateSystem(){return this.backend.coordinateSystem}async compileAsync(e,t,n=null){if(this._isDeviceLost===!0)return;this._initialized===!1&&await this.init();const i=this._nodes.nodeFrame,s=i.renderId,a=this._currentRenderContext,l=this._currentRenderObjectFunction,c=this._compilationPromises,d=e.isScene===!0?e:V2;n===null&&(n=e);const m=this._renderTarget,y=this._renderContexts.get(n,t,m),v=this._activeMipmapLevel,x=[];this._currentRenderContext=y,this._currentRenderObjectFunction=this.renderObject,this._handleObjectFunction=this._createObjectPipeline,this._compilationPromises=x,i.renderId++,i.update(),y.depth=this.depth,y.stencil=this.stencil,y.clippingContext||(y.clippingContext=new Lb),y.clippingContext.updateGlobal(d,t),d.onBeforeRender(this,e,t,m);const S=this._renderLists.get(e,t);if(S.begin(),this._projectObject(e,t,0,S,y.clippingContext),n!==e&&n.traverseVisible(function(w){w.isLight&&w.layers.test(t.layers)&&S.pushLight(w)}),S.finish(),m!==null){this._textures.updateRenderTarget(m,v);const w=this._textures.get(m);y.textures=w.textures,y.depthTexture=w.depthTexture}else y.textures=null,y.depthTexture=null;this._background.update(d,S,y);const A=S.opaque,E=S.transparent,M=S.transparentDoublePass,C=S.lightsNode;this.opaque===!0&&A.length>0&&this._renderObjects(A,t,d,C),this.transparent===!0&&E.length>0&&this._renderTransparents(E,M,t,d,C),i.renderId=s,this._currentRenderContext=a,this._currentRenderObjectFunction=l,this._compilationPromises=c,this._handleObjectFunction=this._renderObjectDirect,await Promise.all(x)}async renderAsync(e,t){this._initialized===!1&&await this.init(),this._renderScene(e,t)}async waitForGPU(){await this.backend.waitForGPU()}setMRT(e){return this._mrt=e,this}getMRT(){return this._mrt}getColorBufferType(){return this._colorBufferType}_onDeviceLost(e){let t=`THREE.WebGPURenderer: ${e.api} Device Lost:

Message: ${e.message}`;e.reason&&(t+=`
Reason: ${e.reason}`),console.error(t),this._isDeviceLost=!0}_renderBundle(e,t,n){const{bundleGroup:i,camera:s,renderList:a}=e,l=this._currentRenderContext,c=this._bundles.get(i,s),d=this.backend.get(c);d.renderContexts===void 0&&(d.renderContexts=new Set);const m=i.version!==d.version,y=d.renderContexts.has(l)===!1||m;if(d.renderContexts.add(l),y){this.backend.beginBundle(l),(d.renderObjects===void 0||m)&&(d.renderObjects=[]),this._currentRenderBundle=c;const{transparentDoublePass:v,transparent:x,opaque:S}=a;this.opaque===!0&&S.length>0&&this._renderObjects(S,s,t,n),this.transparent===!0&&x.length>0&&this._renderTransparents(x,v,s,t,n),this._currentRenderBundle=null,this.backend.finishBundle(l,c),d.version=i.version}else{const{renderObjects:v}=d;for(let x=0,S=v.length;x<S;x++){const A=v[x];this._nodes.needsRefresh(A)&&(this._nodes.updateBefore(A),this._nodes.updateForRender(A),this._bindings.updateForRender(A),this._nodes.updateAfter(A))}}this.backend.addBundle(l,c)}render(e,t){if(this._initialized===!1)return console.warn("THREE.Renderer: .render() called before the backend is initialized. Try using .renderAsync() instead."),this.renderAsync(e,t);this._renderScene(e,t)}_getFrameBufferTarget(){const{currentToneMapping:e,currentColorSpace:t}=this;if(e!==Gr===!1&&t!==xo===!1)return null;const{width:s,height:a}=this.getDrawingBufferSize(qS),{depth:l,stencil:c}=this;let d=this._frameBufferTarget;return d===null&&(d=new tl(s,a,{depthBuffer:l,stencilBuffer:c,type:this._colorBufferType,format:Ni,colorSpace:xo,generateMipmaps:!1,minFilter:Zn,magFilter:Zn,samples:this.samples}),d.isPostProcessingRenderTarget=!0,this._frameBufferTarget=d),d.depthBuffer=l,d.stencilBuffer=c,d.setSize(s,a),d.viewport.copy(this._viewport),d.scissor.copy(this._scissor),d.viewport.multiplyScalar(this._pixelRatio),d.scissor.multiplyScalar(this._pixelRatio),d.scissorTest=this._scissorTest,d}_renderScene(e,t,n=!0){if(this._isDeviceLost===!0)return;const i=n?this._getFrameBufferTarget():null,s=this._nodes.nodeFrame,a=s.renderId,l=this._currentRenderContext,c=this._currentRenderObjectFunction,d=e.isScene===!0?e:V2,m=this._renderTarget||this._outputRenderTarget,y=this._activeCubeFace,v=this._activeMipmapLevel;let x;i!==null?(x=i,this.setRenderTarget(x)):x=m;const S=this._renderContexts.get(e,t,x);this._currentRenderContext=S,this._currentRenderObjectFunction=this._renderObjectFunction||this.renderObject,this.info.calls++,this.info.render.calls++,this.info.render.frameCalls++,s.renderId=this.info.calls;const A=this.coordinateSystem,E=this.xr;if(t.coordinateSystem!==A&&E.isPresenting===!1&&(t.coordinateSystem=A,t.updateProjectionMatrix(),t.isArrayCamera))for(const ue of t.cameras)ue.coordinateSystem=A,ue.updateProjectionMatrix();e.matrixWorldAutoUpdate===!0&&e.updateMatrixWorld(),t.parent===null&&t.matrixWorldAutoUpdate===!0&&t.updateMatrixWorld(),E.enabled===!0&&E.isPresenting===!0&&(E.cameraAutoUpdate===!0&&E.updateCamera(t),t=E.getCamera());let M=this._viewport,C=this._scissor,w=this._pixelRatio;x!==null&&(M=x.viewport,C=x.scissor,w=1),this.getDrawingBufferSize(qS),eA.set(0,0,qS.width,qS.height);const D=M.minDepth===void 0?0:M.minDepth,z=M.maxDepth===void 0?1:M.maxDepth;S.viewportValue.copy(M).multiplyScalar(w).floor(),S.viewportValue.width>>=v,S.viewportValue.height>>=v,S.viewportValue.minDepth=D,S.viewportValue.maxDepth=z,S.viewport=S.viewportValue.equals(eA)===!1,S.scissorValue.copy(C).multiplyScalar(w).floor(),S.scissor=this._scissorTest&&S.scissorValue.equals(eA)===!1,S.scissorValue.width>>=v,S.scissorValue.height>>=v,S.clippingContext||(S.clippingContext=new Lb),S.clippingContext.updateGlobal(d,t),d.onBeforeRender(this,e,t,x),WS.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),tA.setFromProjectionMatrix(WS,A);const B=this._renderLists.get(e,t);if(B.begin(),this._projectObject(e,t,0,B,S.clippingContext),B.finish(),this.sortObjects===!0&&B.sort(this._opaqueSort,this._transparentSort),x!==null){this._textures.updateRenderTarget(x,v);const ue=this._textures.get(x);S.textures=ue.textures,S.depthTexture=ue.depthTexture,S.width=ue.width,S.height=ue.height,S.renderTarget=x,S.depth=x.depthBuffer,S.stencil=x.stencilBuffer}else S.textures=null,S.depthTexture=null,S.width=this.domElement.width,S.height=this.domElement.height,S.depth=this.depth,S.stencil=this.stencil;S.width>>=v,S.height>>=v,S.activeCubeFace=y,S.activeMipmapLevel=v,S.occlusionQueryCount=B.occlusionQueryCount,this._background.update(d,B,S),this.backend.beginRender(S);const{bundles:F,lightsNode:H,transparentDoublePass:I,transparent:P,opaque:Z}=B;return F.length>0&&this._renderBundles(F,d,H),this.opaque===!0&&Z.length>0&&this._renderObjects(Z,t,d,H),this.transparent===!0&&P.length>0&&this._renderTransparents(P,I,t,d,H),this.backend.finishRender(S),s.renderId=a,this._currentRenderContext=l,this._currentRenderObjectFunction=c,i!==null&&(this.setRenderTarget(m,y,v),this._renderOutput(x)),d.onAfterRender(this,e,t,x),S}_renderOutput(e){const t=this._quad;this._nodes.hasOutputChange(e.texture)&&(t.material.fragmentNode=this._nodes.getOutputNode(e.texture),t.material.needsUpdate=!0);const n=this.autoClear,i=this.xr.enabled;this.autoClear=!1,this.xr.enabled=!1,this._renderScene(t,t.camera,!1),this.autoClear=n,this.xr.enabled=i}getMaxAnisotropy(){return this.backend.getMaxAnisotropy()}getActiveCubeFace(){return this._activeCubeFace}getActiveMipmapLevel(){return this._activeMipmapLevel}async setAnimationLoop(e){this._initialized===!1&&await this.init(),this._animation.setAnimationLoop(e)}async getArrayBufferAsync(e){return await this.backend.getArrayBufferAsync(e)}getContext(){return this.backend.getContext()}getPixelRatio(){return this._pixelRatio}getDrawingBufferSize(e){return e.set(this._width*this._pixelRatio,this._height*this._pixelRatio).floor()}getSize(e){return e.set(this._width,this._height)}setPixelRatio(e=1){this._pixelRatio!==e&&(this._pixelRatio=e,this.setSize(this._width,this._height,!1))}setDrawingBufferSize(e,t,n){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this._pixelRatio=n,this.domElement.width=Math.floor(e*n),this.domElement.height=Math.floor(t*n),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setSize(e,t,n=!0){this.xr&&this.xr.isPresenting||(this._width=e,this._height=t,this.domElement.width=Math.floor(e*this._pixelRatio),this.domElement.height=Math.floor(t*this._pixelRatio),n===!0&&(this.domElement.style.width=e+"px",this.domElement.style.height=t+"px"),this.setViewport(0,0,e,t),this._initialized&&this.backend.updateSize())}setOpaqueSort(e){this._opaqueSort=e}setTransparentSort(e){this._transparentSort=e}getScissor(e){const t=this._scissor;return e.x=t.x,e.y=t.y,e.width=t.width,e.height=t.height,e}setScissor(e,t,n,i){const s=this._scissor;e.isVector4?s.copy(e):s.set(e,t,n,i)}getScissorTest(){return this._scissorTest}setScissorTest(e){this._scissorTest=e,this.backend.setScissorTest(e)}getViewport(e){return e.copy(this._viewport)}setViewport(e,t,n,i,s=0,a=1){const l=this._viewport;e.isVector4?l.copy(e):l.set(e,t,n,i),l.minDepth=s,l.maxDepth=a}getClearColor(e){return e.copy(this._clearColor)}setClearColor(e,t=1){this._clearColor.set(e),this._clearColor.a=t}getClearAlpha(){return this._clearColor.a}setClearAlpha(e){this._clearColor.a=e}getClearDepth(){return this._clearDepth}setClearDepth(e){this._clearDepth=e}getClearStencil(){return this._clearStencil}setClearStencil(e){this._clearStencil=e}isOccluded(e){const t=this._currentRenderContext;return t&&this.backend.isOccluded(t,e)}clear(e=!0,t=!0,n=!0){if(this._initialized===!1)return console.warn("THREE.Renderer: .clear() called before the backend is initialized. Try using .clearAsync() instead."),this.clearAsync(e,t,n);const i=this._renderTarget||this._getFrameBufferTarget();let s=null;if(i!==null){this._textures.updateRenderTarget(i);const a=this._textures.get(i);s=this._renderContexts.getForClear(i),s.textures=a.textures,s.depthTexture=a.depthTexture,s.width=a.width,s.height=a.height,s.renderTarget=i,s.depth=i.depthBuffer,s.stencil=i.stencilBuffer,s.clearColorValue=this.backend.getClearColor(),s.activeCubeFace=this.getActiveCubeFace(),s.activeMipmapLevel=this.getActiveMipmapLevel()}this.backend.clear(e,t,n,s),i!==null&&this._renderTarget===null&&this._renderOutput(i)}clearColor(){return this.clear(!0,!1,!1)}clearDepth(){return this.clear(!1,!0,!1)}clearStencil(){return this.clear(!1,!1,!0)}async clearAsync(e=!0,t=!0,n=!0){this._initialized===!1&&await this.init(),this.clear(e,t,n)}async clearColorAsync(){this.clearAsync(!0,!1,!1)}async clearDepthAsync(){this.clearAsync(!1,!0,!1)}async clearStencilAsync(){this.clearAsync(!1,!1,!0)}get currentToneMapping(){return this.isOutputTarget?this.toneMapping:Gr}get currentColorSpace(){return this.isOutputTarget?this.outputColorSpace:xo}get isOutputTarget(){return this._renderTarget===this._outputRenderTarget||this._renderTarget===null}dispose(){this.info.dispose(),this.backend.dispose(),this._animation.dispose(),this._objects.dispose(),this._pipelines.dispose(),this._nodes.dispose(),this._bindings.dispose(),this._renderLists.dispose(),this._renderContexts.dispose(),this._textures.dispose(),this._frameBufferTarget!==null&&this._frameBufferTarget.dispose(),Object.values(this.backend.timestampQueryPool).forEach(e=>{e!==null&&e.dispose()}),this.setRenderTarget(null),this.setAnimationLoop(null)}setRenderTarget(e,t=0,n=0){this._renderTarget=e,this._activeCubeFace=t,this._activeMipmapLevel=n}getRenderTarget(){return this._renderTarget}setOutputRenderTarget(e){this._outputRenderTarget=e}getOutputRenderTarget(){return this._outputRenderTarget}setRenderObjectFunction(e){this._renderObjectFunction=e}getRenderObjectFunction(){return this._renderObjectFunction}compute(e){if(this._isDeviceLost===!0)return;if(this._initialized===!1)return console.warn("THREE.Renderer: .compute() called before the backend is initialized. Try using .computeAsync() instead."),this.computeAsync(e);const t=this._nodes.nodeFrame,n=t.renderId;this.info.calls++,this.info.compute.calls++,this.info.compute.frameCalls++,t.renderId=this.info.calls;const i=this.backend,s=this._pipelines,a=this._bindings,l=this._nodes,c=Array.isArray(e)?e:[e];if(c[0]===void 0||c[0].isComputeNode!==!0)throw new Error("THREE.Renderer: .compute() expects a ComputeNode.");i.beginCompute(e);for(const d of c){if(s.has(d)===!1){const v=()=>{d.removeEventListener("dispose",v),s.delete(d),a.delete(d),l.delete(d)};d.addEventListener("dispose",v);const x=d.onInitFunction;x!==null&&x.call(d,{renderer:this})}l.updateForCompute(d),a.updateForCompute(d);const m=a.getForCompute(d),y=s.getForCompute(d,m);i.compute(e,d,m,y)}i.finishCompute(e),t.renderId=n}async computeAsync(e){this._initialized===!1&&await this.init(),this.compute(e)}async hasFeatureAsync(e){return this._initialized===!1&&await this.init(),this.backend.hasFeature(e)}async resolveTimestampsAsync(e="render"){return this._initialized===!1&&await this.init(),this.backend.resolveTimestampsAsync(e)}hasFeature(e){return this._initialized===!1?(console.warn("THREE.Renderer: .hasFeature() called before the backend is initialized. Try using .hasFeatureAsync() instead."),!1):this.backend.hasFeature(e)}hasInitialized(){return this._initialized}async initTextureAsync(e){this._initialized===!1&&await this.init(),this._textures.updateTexture(e)}initTexture(e){this._initialized===!1&&console.warn("THREE.Renderer: .initTexture() called before the backend is initialized. Try using .initTextureAsync() instead."),this._textures.updateTexture(e)}copyFramebufferToTexture(e,t=null){if(t!==null)if(t.isVector2)t=qh.set(t.x,t.y,e.image.width,e.image.height).floor();else if(t.isVector4)t=qh.copy(t).floor();else{console.error("THREE.Renderer.copyFramebufferToTexture: Invalid rectangle.");return}else t=qh.set(0,0,e.image.width,e.image.height);let n=this._currentRenderContext,i;n!==null?i=n.renderTarget:(i=this._renderTarget||this._getFrameBufferTarget(),i!==null&&(this._textures.updateRenderTarget(i),n=this._textures.get(i))),this._textures.updateTexture(e,{renderTarget:i}),this.backend.copyFramebufferToTexture(e,n,t)}copyTextureToTexture(e,t,n=null,i=null,s=0,a=0){this._textures.updateTexture(e),this._textures.updateTexture(t),this.backend.copyTextureToTexture(e,t,n,i,s,a)}async readRenderTargetPixelsAsync(e,t,n,i,s,a=0,l=0){return this.backend.copyTextureToBuffer(e.textures[a],t,n,i,s,l)}_projectObject(e,t,n,i,s){if(e.visible===!1)return;if(e.layers.test(t.layers)){if(e.isGroup)n=e.renderOrder,e.isClippingGroup&&e.enabled&&(s=s.getGroupContext(e));else if(e.isLOD)e.autoUpdate===!0&&e.update(t);else if(e.isLight)i.pushLight(e);else if(e.isSprite){if(!e.frustumCulled||tA.intersectsSprite(e)){this.sortObjects===!0&&qh.setFromMatrixPosition(e.matrixWorld).applyMatrix4(WS);const{geometry:c,material:d}=e;d.visible&&i.push(e,c,d,n,qh.z,null,s)}}else if(e.isLineLoop)console.error("THREE.Renderer: Objects of type THREE.LineLoop are not supported. Please use THREE.Line or THREE.LineSegments.");else if((e.isMesh||e.isLine||e.isPoints)&&(!e.frustumCulled||tA.intersectsObject(e))){const{geometry:c,material:d}=e;if(this.sortObjects===!0&&(c.boundingSphere===null&&c.computeBoundingSphere(),qh.copy(c.boundingSphere.center).applyMatrix4(e.matrixWorld).applyMatrix4(WS)),Array.isArray(d)){const m=c.groups;for(let y=0,v=m.length;y<v;y++){const x=m[y],S=d[x.materialIndex];S&&S.visible&&i.push(e,c,S,n,qh.z,x,s)}}else d.visible&&i.push(e,c,d,n,qh.z,null,s)}}if(e.isBundleGroup===!0&&this.backend.beginBundle!==void 0){const c=i;i=this._renderLists.get(e,t),i.begin(),c.pushBundle({bundleGroup:e,camera:t,renderList:i}),i.finish()}const l=e.children;for(let c=0,d=l.length;c<d;c++)this._projectObject(l[c],t,n,i,s)}_renderBundles(e,t,n){for(const i of e)this._renderBundle(i,t,n)}_renderTransparents(e,t,n,i,s){if(t.length>0){for(const{material:a}of t)a.side=Ti;this._renderObjects(t,n,i,s,"backSide");for(const{material:a}of t)a.side=pa;this._renderObjects(e,n,i,s);for(const{material:a}of t)a.side=Fr}else this._renderObjects(e,n,i,s)}_renderObjects(e,t,n,i,s=null){for(let a=0,l=e.length;a<l;a++){const{object:c,geometry:d,material:m,group:y,clippingContext:v}=e[a];this._currentRenderObjectFunction(c,n,t,d,m,y,i,v,s)}}renderObject(e,t,n,i,s,a,l,c=null,d=null){let m,y,v;if(e.onBeforeRender(this,t,n,i,s,a),s.allowOverride===!0&&t.overrideMaterial!==null){const x=t.overrideMaterial;s.positionNode&&s.positionNode.isNode&&(m=x.positionNode,x.positionNode=s.positionNode),x.alphaTest=s.alphaTest,x.alphaMap=s.alphaMap,x.transparent=s.transparent||s.transmission>0,x.isShadowPassMaterial&&(x.side=s.shadowSide===null?s.side:s.shadowSide,s.depthNode&&s.depthNode.isNode&&(v=x.depthNode,x.depthNode=s.depthNode),s.castShadowNode&&s.castShadowNode.isNode&&(y=x.colorNode,x.colorNode=s.castShadowNode)),s=x}s.transparent===!0&&s.side===Fr&&s.forceSinglePass===!1?(s.side=Ti,this._handleObjectFunction(e,s,t,n,l,a,c,"backSide"),s.side=pa,this._handleObjectFunction(e,s,t,n,l,a,c,d),s.side=Fr):this._handleObjectFunction(e,s,t,n,l,a,c,d),m!==void 0&&(t.overrideMaterial.positionNode=m),v!==void 0&&(t.overrideMaterial.depthNode=v),y!==void 0&&(t.overrideMaterial.colorNode=y),e.onAfterRender(this,t,n,i,s,a)}_renderObjectDirect(e,t,n,i,s,a,l,c){const d=this._objects.get(e,t,n,i,s,this._currentRenderContext,l,c);d.drawRange=e.geometry.drawRange,d.group=a;const m=this._nodes.needsRefresh(d);m&&(this._nodes.updateBefore(d),this._geometries.updateForRender(d),this._nodes.updateForRender(d),this._bindings.updateForRender(d)),this._pipelines.updateForRender(d),this._currentRenderBundle!==null&&(this.backend.get(this._currentRenderBundle).renderObjects.push(d),d.bundle=this._currentRenderBundle.bundleGroup),this.backend.draw(d,this.info),m&&this._nodes.updateAfter(d)}_createObjectPipeline(e,t,n,i,s,a,l,c){const d=this._objects.get(e,t,n,i,s,this._currentRenderContext,l,c);d.drawRange=e.geometry.drawRange,d.group=a,this._nodes.updateBefore(d),this._geometries.updateForRender(d),this._nodes.updateForRender(d),this._bindings.updateForRender(d),this._pipelines.getForRender(d,this._compilationPromises),this._nodes.updateAfter(d)}get compile(){return this.compileAsync}}class ON{constructor(e=""){this.name=e,this.visibility=0}setVisibility(e){this.visibility|=e}clone(){return Object.assign(new this.constructor,this)}}function S7(r){return r+(Kh-r%Kh)%Kh}class OP extends ON{constructor(e,t=null){super(e),this.isBuffer=!0,this.bytesPerElement=Float32Array.BYTES_PER_ELEMENT,this._buffer=t}get byteLength(){return S7(this._buffer.byteLength)}get buffer(){return this._buffer}update(){return!0}}class PP extends OP{constructor(e,t=null){super(e,t),this.isUniformBuffer=!0}}let b7=0;class IP extends PP{constructor(e,t){super("UniformBuffer_"+b7++,e?e.value:null),this.nodeUniform=e,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class T7 extends PP{constructor(e){super(e),this.isUniformsGroup=!0,this._values=null,this.uniforms=[]}addUniform(e){return this.uniforms.push(e),this}removeUniform(e){const t=this.uniforms.indexOf(e);return t!==-1&&this.uniforms.splice(t,1),this}get values(){return this._values===null&&(this._values=Array.from(this.buffer)),this._values}get buffer(){let e=this._buffer;if(e===null){const t=this.byteLength;e=new Float32Array(new ArrayBuffer(t)),this._buffer=e}return e}get byteLength(){let e=0;for(let t=0,n=this.uniforms.length;t<n;t++){const i=this.uniforms[t],{boundary:s,itemSize:a}=i,l=e%Kh,c=Kh-l;l!==0&&c-s<0?e+=Kh-l:l%s!==0&&(e+=l%s),i.offset=e/this.bytesPerElement,e+=a*this.bytesPerElement}return Math.ceil(e/Kh)*Kh}update(){let e=!1;for(const t of this.uniforms)this.updateByType(t)===!0&&(e=!0);return e}updateByType(e){if(e.isNumberUniform)return this.updateNumber(e);if(e.isVector2Uniform)return this.updateVector2(e);if(e.isVector3Uniform)return this.updateVector3(e);if(e.isVector4Uniform)return this.updateVector4(e);if(e.isColorUniform)return this.updateColor(e);if(e.isMatrix3Uniform)return this.updateMatrix3(e);if(e.isMatrix4Uniform)return this.updateMatrix4(e);console.error("THREE.WebGPUUniformsGroup: Unsupported uniform type.",e)}updateNumber(e){let t=!1;const n=this.values,i=e.getValue(),s=e.offset,a=e.getType();if(n[s]!==i){const l=this._getBufferForType(a);l[s]=n[s]=i,t=!0}return t}updateVector2(e){let t=!1;const n=this.values,i=e.getValue(),s=e.offset,a=e.getType();if(n[s+0]!==i.x||n[s+1]!==i.y){const l=this._getBufferForType(a);l[s+0]=n[s+0]=i.x,l[s+1]=n[s+1]=i.y,t=!0}return t}updateVector3(e){let t=!1;const n=this.values,i=e.getValue(),s=e.offset,a=e.getType();if(n[s+0]!==i.x||n[s+1]!==i.y||n[s+2]!==i.z){const l=this._getBufferForType(a);l[s+0]=n[s+0]=i.x,l[s+1]=n[s+1]=i.y,l[s+2]=n[s+2]=i.z,t=!0}return t}updateVector4(e){let t=!1;const n=this.values,i=e.getValue(),s=e.offset,a=e.getType();if(n[s+0]!==i.x||n[s+1]!==i.y||n[s+2]!==i.z||n[s+4]!==i.w){const l=this._getBufferForType(a);l[s+0]=n[s+0]=i.x,l[s+1]=n[s+1]=i.y,l[s+2]=n[s+2]=i.z,l[s+3]=n[s+3]=i.w,t=!0}return t}updateColor(e){let t=!1;const n=this.values,i=e.getValue(),s=e.offset;if(n[s+0]!==i.r||n[s+1]!==i.g||n[s+2]!==i.b){const a=this.buffer;a[s+0]=n[s+0]=i.r,a[s+1]=n[s+1]=i.g,a[s+2]=n[s+2]=i.b,t=!0}return t}updateMatrix3(e){let t=!1;const n=this.values,i=e.getValue().elements,s=e.offset;if(n[s+0]!==i[0]||n[s+1]!==i[1]||n[s+2]!==i[2]||n[s+4]!==i[3]||n[s+5]!==i[4]||n[s+6]!==i[5]||n[s+8]!==i[6]||n[s+9]!==i[7]||n[s+10]!==i[8]){const a=this.buffer;a[s+0]=n[s+0]=i[0],a[s+1]=n[s+1]=i[1],a[s+2]=n[s+2]=i[2],a[s+4]=n[s+4]=i[3],a[s+5]=n[s+5]=i[4],a[s+6]=n[s+6]=i[5],a[s+8]=n[s+8]=i[6],a[s+9]=n[s+9]=i[7],a[s+10]=n[s+10]=i[8],t=!0}return t}updateMatrix4(e){let t=!1;const n=this.values,i=e.getValue().elements,s=e.offset;return E7(n,i,s)===!1&&(this.buffer.set(i,s),M7(n,i,s),t=!0),t}_getBufferForType(e){return e==="int"||e==="ivec2"||e==="ivec3"||e==="ivec4"?new Int32Array(this.buffer.buffer):e==="uint"||e==="uvec2"||e==="uvec3"||e==="uvec4"?new Uint32Array(this.buffer.buffer):this.buffer}}function M7(r,e,t){for(let n=0,i=e.length;n<i;n++)r[t+n]=e[n]}function E7(r,e,t){for(let n=0,i=e.length;n<i;n++)if(r[t+n]!==e[n])return!1;return!0}let A7=0;class FP extends T7{constructor(e,t){super(e),this.id=A7++,this.groupNode=t,this.isNodeUniformsGroup=!0}}let R7=0;class N7 extends ON{constructor(e,t){super(e),this.id=R7++,this.texture=t,this.version=t?t.version:0,this.store=!1,this.generation=null,this.isSampledTexture=!0}needsBindingsUpdate(e){const{texture:t}=this;return e!==this.generation?(this.generation=e,!0):t.isVideoTexture}update(){const{texture:e,version:t}=this;return t!==e.version?(this.version=e.version,!0):!1}}class nM extends N7{constructor(e,t,n,i=null){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n,this.access=i}needsBindingsUpdate(e){return this.textureNode.value!==this.texture||super.needsBindingsUpdate(e)}update(){const{textureNode:e}=this;return this.texture!==e.value?(this.texture=e.value,!0):super.update()}}class zP extends nM{constructor(e,t,n,i=null){super(e,t,n,i),this.isSampledCubeTexture=!0}}class VP extends nM{constructor(e,t,n,i=null){super(e,t,n,i),this.isSampledTexture3D=!0}}const C7={textureDimensions:"textureSize",equals:"equal"},w7={low:"lowp",medium:"mediump",high:"highp"},G2={swizzleAssign:!0,storageBuffer:!1},H2=`
precision highp float;
precision highp int;
precision highp sampler2D;
precision highp sampler3D;
precision highp samplerCube;
precision highp sampler2DArray;

precision highp usampler2D;
precision highp usampler3D;
precision highp usamplerCube;
precision highp usampler2DArray;

precision highp isampler2D;
precision highp isampler3D;
precision highp isamplerCube;
precision highp isampler2DArray;

precision lowp sampler2DShadow;
`;class D7 extends DP{constructor(e,t){super(e,t,new a7),this.uniformGroups={},this.transforms=[],this.extensions={},this.builtins={vertex:[],fragment:[],compute:[]}}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Ia}getMethod(e){return C7[e]||e}getOutputStructName(){return""}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),i=[];for(const a of t.inputs)i.push(this.getType(a.type)+" "+a.name);return`${this.getType(t.type)} ${t.name}( ${i.join(", ")} ) {

	${n.vars}

${n.code}
	return ${n.result};

}`}setupPBO(e){const t=e.value;if(t.pbo===void 0){const n=t.array,i=t.count*t.itemSize,{itemSize:s}=t,a=t.array.constructor.name.toLowerCase().includes("int");let l=a?ff:gp;s===2?l=a?yp:lf:s===3?l=a?tU:Qg:s===4&&(l=a?vp:Ni);const c={Float32Array:Ri,Uint8Array:Xi,Uint16Array:jo,Uint32Array:di,Int8Array:tf,Int16Array:nf,Int32Array:Xs,Uint8ClampedArray:Xi},d=Math.pow(2,Math.ceil(Math.log2(Math.sqrt(i/s))));let m=Math.ceil(i/s/d);d*m*s<i&&m++;const y=d*m*s,v=new n.constructor(y);v.set(n,0),t.array=v;const x=new Fl(t.array,d,m,l,c[t.array.constructor.name]||Ri);x.needsUpdate=!0,x.isPBOTexture=!0;const S=new Hu(x,null,null);S.setPrecision("high"),t.pboNode=S,t.pbo=S.value,this.getUniformFromNode(t.pboNode,"texture",this.shaderStage,this.context.label)}}getPropertyName(e,t=this.shaderStage){return e.isNodeUniform&&e.node.isTextureNode!==!0&&e.node.isBufferNode!==!0?t.charAt(0)+"_"+e.name:super.getPropertyName(e,t)}generatePBO(e){const{node:t,indexNode:n}=e,i=t.value;if(this.renderer.backend.has(i)){const m=this.renderer.backend.get(i);m.pbo=i.pbo}const s=this.getUniformFromNode(i.pboNode,"texture",this.shaderStage,this.context.label),a=this.getPropertyName(s);this.increaseUsage(n);const l=n.build(this,"uint"),c=this.getDataFromNode(e);let d=c.propertyName;if(d===void 0){const m=this.getVarFromNode(e);d=this.getPropertyName(m);const y=this.getDataFromNode(t);let v=y.propertySizeName;v===void 0&&(v=d+"Size",this.getVarFromNode(t,v,"uint"),this.addLineFlowCode(`${v} = uint( textureSize( ${a}, 0 ).x )`,e),y.propertySizeName=v);const{itemSize:x}=i,S="."+Ep.join("").slice(0,x),A=`ivec2(${l} % ${v}, ${l} / ${v})`,E=this.generateTextureLoad(null,a,A,null,"0");let M="vec4";i.pbo.type===di?M="uvec4":i.pbo.type===Xs&&(M="ivec4"),this.addLineFlowCode(`${d} = ${M}(${E})${S}`,e),c.propertyName=d}return d}generateTextureLoad(e,t,n,i,s="0"){return i?`texelFetch( ${t}, ivec3( ${n}, ${i} ), ${s} )`:`texelFetch( ${t}, ${n}, ${s} )`}generateTexture(e,t,n,i){return e.isDepthTexture?`texture( ${t}, ${n} ).x`:(i&&(n=`vec3( ${n}, ${i} )`),`texture( ${t}, ${n} )`)}generateTextureLevel(e,t,n,i){return`textureLod( ${t}, ${n}, ${i} )`}generateTextureBias(e,t,n,i){return`texture( ${t}, ${n}, ${i} )`}generateTextureGrad(e,t,n,i){return`textureGrad( ${t}, ${n}, ${i[0]}, ${i[1]} )`}generateTextureCompare(e,t,n,i,s,a=this.shaderStage){if(a==="fragment")return`texture( ${t}, vec3( ${n}, ${i} ) )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const i of n)t.push(`${this.getVar(i.type,i.name,i.count)};`);return t.join(`
	`)}getUniforms(e){const t=this.uniforms[e],n=[],i={};for(const a of t){let l=null,c=!1;if(a.type==="texture"||a.type==="texture3D"){const m=a.node.value;let y="";(m.isDataTexture===!0||m.isData3DTexture===!0)&&(m.type===di?y="u":m.type===Xs&&(y="i")),a.type==="texture3D"?l=`${y}sampler3D ${a.name};`:m.compareFunction?l=`sampler2DShadow ${a.name};`:m.isDataArrayTexture===!0||m.isCompressedArrayTexture===!0?l=`${y}sampler2DArray ${a.name};`:l=`${y}sampler2D ${a.name};`}else if(a.type==="cubeTexture")l=`samplerCube ${a.name};`;else if(a.type==="buffer"){const m=a.node,y=this.getType(m.bufferType),v=m.bufferCount,x=v>0?v:"";l=`${m.name} {
	${y} ${a.name}[${x}];
};
`}else l=`${this.getVectorType(a.type)} ${this.getPropertyName(a,e)};`,c=!0;const d=a.node.precision;if(d!==null&&(l=w7[d]+" "+l),c){l="	"+l;const m=a.groupNode.name;(i[m]||(i[m]=[])).push(l)}else l="uniform "+l,n.push(l)}let s="";for(const a in i){const l=i[a];s+=this._getGLSLUniformStruct(e+"_"+a,l.join(`
`))+`
`}return s+=n.join(`
`),s}getTypeFromAttribute(e){let t=super.getTypeFromAttribute(e);if(/^[iu]/.test(t)&&e.gpuType!==Xs){let n=e;e.isInterleavedBufferAttribute&&(n=e.data);const i=n.array;i instanceof Uint32Array||i instanceof Int32Array||(t=t.slice(1))}return t}getAttributes(e){let t="";if(e==="vertex"||e==="compute"){const n=this.getAttributesArray();let i=0;for(const s of n)t+=`layout( location = ${i++} ) in ${s.type} ${s.name};
`}return t}getStructMembers(e){const t=[];for(const n of e.members)t.push(`	${n.type} ${n.name};`);return t.join(`
`)}getStructs(e){const t=[],n=this.structs[e],i=[];for(const s of n)if(s.output)for(const a of s.members)i.push(`layout( location = ${a.index} ) out ${a.type} ${a.name};`);else{let a="struct "+s.name+` {
`;a+=this.getStructMembers(s),a+=`
};
`,t.push(a)}return i.length===0&&i.push("layout( location = 0 ) out vec4 fragColor;"),`
`+i.join(`
`)+`

`+t.join(`
`)}getVaryings(e){let t="";const n=this.varyings;if(e==="vertex"||e==="compute")for(const i of n){e==="compute"&&(i.needsInterpolation=!0);const s=this.getType(i.type);if(i.needsInterpolation){const a=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${a}out ${s} ${i.name};
`}else t+=`${s} ${i.name};
`}else if(e==="fragment"){for(const i of n)if(i.needsInterpolation){const s=this.getType(i.type),a=s.includes("int")||s.includes("uv")||s.includes("iv")?"flat ":"";t+=`${a}in ${s} ${i.name};
`}}for(const i of this.builtins[e])t+=`${i};
`;return t}getVertexIndex(){return"uint( gl_VertexID )"}getInstanceIndex(){return"uint( gl_InstanceID )"}getInvocationLocalIndex(){return`uint( gl_InstanceID ) % ${this.object.workgroupSize.reduce((n,i)=>n*i,1)}u`}getDrawIndex(){return this.renderer.backend.extensions.has("WEBGL_multi_draw")?"uint( gl_DrawID )":null}getFrontFacing(){return"gl_FrontFacing"}getFragCoord(){return"gl_FragCoord.xy"}getFragDepth(){return"gl_FragDepth"}enableExtension(e,t,n=this.shaderStage){const i=this.extensions[n]||(this.extensions[n]=new Map);i.has(e)===!1&&i.set(e,{name:e,behavior:t})}getExtensions(e){const t=[];if(e==="vertex"){const i=this.renderer.backend.extensions;this.object.isBatchedMesh&&i.has("WEBGL_multi_draw")&&this.enableExtension("GL_ANGLE_multi_draw","require",e)}const n=this.extensions[e];if(n!==void 0)for(const{name:i,behavior:s}of n.values())t.push(`#extension ${i} : ${s}`);return t.join(`
`)}getClipDistance(){return"gl_ClipDistance"}isAvailable(e){let t=G2[e];if(t===void 0){let n;switch(t=!1,e){case"float32Filterable":n="OES_texture_float_linear";break;case"clipDistance":n="WEBGL_clip_cull_distance";break}if(n!==void 0){const i=this.renderer.backend.extensions;i.has(n)&&(i.get(n),t=!0)}G2[e]=t}return t}isFlipY(){return!0}enableHardwareClipping(e){this.enableExtension("GL_ANGLE_clip_cull_distance","require"),this.builtins.vertex.push(`out float gl_ClipDistance[ ${e} ]`)}registerTransform(e,t){this.transforms.push({varyingName:e,attributeNode:t})}getTransforms(){const e=this.transforms;let t="";for(let n=0;n<e.length;n++){const i=e[n],s=this.getPropertyName(i.attributeNode);s&&(t+=`${i.varyingName} = ${s};
	`)}return t}_getGLSLUniformStruct(e,t){return`
layout( std140 ) uniform ${e} {
${t}
};`}_getGLSLVertexCode(e){return`#version 300 es

${this.getSignature()}

// extensions
${e.extensions}

// precision
${H2}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// attributes
${e.attributes}

// codes
${e.codes}

void main() {

	// vars
	${e.vars}

	// transforms
	${e.transforms}

	// flow
	${e.flow}

	gl_PointSize = 1.0;

}
`}_getGLSLFragmentCode(e){return`#version 300 es

${this.getSignature()}

// precision
${H2}

// uniforms
${e.uniforms}

// varyings
${e.varyings}

// codes
${e.codes}

// structs
${e.structs}

void main() {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){let n=`// code

`;n+=this.flowCode[t];const i=this.flowNodes[t],s=i[i.length-1];for(const l of i){const c=this.getFlowData(l),d=l.name;d&&(n.length>0&&(n+=`
`),n+=`	// flow -> ${d}
	`),n+=`${c.code}
	`,l===s&&t!=="compute"&&(n+=`// result
	`,t==="vertex"?(n+="gl_Position = ",n+=`${c.result};`):t==="fragment"&&(l.outputNode.isOutputStructNode||(n+="fragColor = ",n+=`${c.result};`)))}const a=e[t];a.extensions=this.getExtensions(t),a.uniforms=this.getUniforms(t),a.attributes=this.getAttributes(t),a.varyings=this.getVaryings(t),a.vars=this.getVars(t),a.structs=this.getStructs(t),a.codes=this.getCodes(t),a.transforms=this.getTransforms(t),a.flow=n}this.material!==null?(this.vertexShader=this._getGLSLVertexCode(e.vertex),this.fragmentShader=this._getGLSLFragmentCode(e.fragment)):this.computeShader=this._getGLSLVertexCode(e.compute)}getUniformFromNode(e,t,n,i=null){const s=super.getUniformFromNode(e,t,n,i),a=this.getDataFromNode(e,n,this.globalCache);let l=a.uniformGPU;if(l===void 0){const c=e.groupNode,d=c.name,m=this.getBindGroupArray(d,n);if(t==="texture")l=new nM(s.name,s.node,c),m.push(l);else if(t==="cubeTexture")l=new zP(s.name,s.node,c),m.push(l);else if(t==="texture3D")l=new VP(s.name,s.node,c),m.push(l);else if(t==="buffer"){e.name=`NodeBuffer_${e.id}`,s.name=`buffer${e.id}`;const y=new IP(e,c);y.name=e.name,m.push(y),l=y}else{const y=this.uniformGroups[n]||(this.uniformGroups[n]={});let v=y[d];v===void 0&&(v=new FP(n+"_"+d,c),y[d]=v,m.push(v)),l=this.getNodeUniform(s,t),v.addUniform(l)}a.uniformGPU=l}return s}}let nA=null,eg=null;class GP{constructor(e={}){this.parameters=Object.assign({},e),this.data=new WeakMap,this.renderer=null,this.domElement=null,this.timestampQueryPool={render:null,compute:null},this.trackTimestamp=e.trackTimestamp===!0}async init(e){this.renderer=e}get coordinateSystem(){}beginRender(){}finishRender(){}beginCompute(){}finishCompute(){}draw(){}compute(){}createProgram(){}destroyProgram(){}createBindings(){}updateBindings(){}updateBinding(){}createRenderPipeline(){}createComputePipeline(){}needsRenderUpdate(){}getRenderCacheKey(){}createNodeBuilder(){}createSampler(){}destroySampler(){}createDefaultTexture(){}createTexture(){}updateTexture(){}generateMipmaps(){}destroyTexture(){}async copyTextureToBuffer(){}copyTextureToTexture(){}copyFramebufferToTexture(){}createAttribute(){}createIndexAttribute(){}createStorageAttribute(){}updateAttribute(){}destroyAttribute(){}getContext(){}updateSize(){}updateViewport(){}isOccluded(){}async resolveTimestampsAsync(e="render"){if(!this.trackTimestamp){Il("WebGPURenderer: Timestamp tracking is disabled.");return}const t=this.timestampQueryPool[e];if(!t){Il(`WebGPURenderer: No timestamp query pool for type '${e}' found.`);return}const n=await t.resolveQueriesAsync();return this.renderer.info[e].timestamp=n,n}async waitForGPU(){}async getArrayBufferAsync(){}async hasFeatureAsync(){}hasFeature(){}getMaxAnisotropy(){}getDrawingBufferSize(){return nA=nA||new Xe,this.renderer.getDrawingBufferSize(nA)}setScissorTest(){}getClearColor(){const e=this.renderer;return eg=eg||new yN,e.getClearColor(eg),eg.getRGB(eg),eg}getDomElement(){let e=this.domElement;return e===null&&(e=this.parameters.canvas!==void 0?this.parameters.canvas:F1(),"setAttribute"in e&&e.setAttribute("data-engine",`three.js r${Zg} webgpu`),this.domElement=e),e}set(e,t){this.data.set(e,t)}get(e){let t=this.data.get(e);return t===void 0&&(t={},this.data.set(e,t)),t}has(e){return this.data.has(e)}delete(e){this.data.delete(e)}dispose(){}}let U7=0;class L7{constructor(e,t){this.buffers=[e.bufferGPU,t],this.type=e.type,this.bufferType=e.bufferType,this.pbo=e.pbo,this.byteLength=e.byteLength,this.bytesPerElement=e.BYTES_PER_ELEMENT,this.version=e.version,this.isInteger=e.isInteger,this.activeBufferIndex=0,this.baseId=e.id}get id(){return`${this.baseId}|${this.activeBufferIndex}`}get bufferGPU(){return this.buffers[this.activeBufferIndex]}get transformBuffer(){return this.buffers[this.activeBufferIndex^1]}switchBuffers(){this.activeBufferIndex^=1}}class B7{constructor(e){this.backend=e}createAttribute(e,t){const n=this.backend,{gl:i}=n,s=e.array,a=e.usage||i.STATIC_DRAW,l=e.isInterleavedBufferAttribute?e.data:e,c=n.get(l);let d=c.bufferGPU;d===void 0&&(d=this._createBuffer(i,t,s,a),c.bufferGPU=d,c.bufferType=t,c.version=l.version);let m;if(s instanceof Float32Array)m=i.FLOAT;else if(s instanceof Uint16Array)e.isFloat16BufferAttribute?m=i.HALF_FLOAT:m=i.UNSIGNED_SHORT;else if(s instanceof Int16Array)m=i.SHORT;else if(s instanceof Uint32Array)m=i.UNSIGNED_INT;else if(s instanceof Int32Array)m=i.INT;else if(s instanceof Int8Array)m=i.BYTE;else if(s instanceof Uint8Array)m=i.UNSIGNED_BYTE;else if(s instanceof Uint8ClampedArray)m=i.UNSIGNED_BYTE;else throw new Error("THREE.WebGLBackend: Unsupported buffer data format: "+s);let y={bufferGPU:d,bufferType:t,type:m,byteLength:s.byteLength,bytesPerElement:s.BYTES_PER_ELEMENT,version:e.version,pbo:e.pbo,isInteger:m===i.INT||m===i.UNSIGNED_INT||e.gpuType===Xs,id:U7++};if(e.isStorageBufferAttribute||e.isStorageInstancedBufferAttribute){const v=this._createBuffer(i,t,s,a);y=new L7(y,v)}n.set(e,y)}updateAttribute(e){const t=this.backend,{gl:n}=t,i=e.array,s=e.isInterleavedBufferAttribute?e.data:e,a=t.get(s),l=a.bufferType,c=e.isInterleavedBufferAttribute?e.data.updateRanges:e.updateRanges;if(n.bindBuffer(l,a.bufferGPU),c.length===0)n.bufferSubData(l,0,i);else{for(let d=0,m=c.length;d<m;d++){const y=c[d];n.bufferSubData(l,y.start*i.BYTES_PER_ELEMENT,i,y.start,y.count)}s.clearUpdateRanges()}n.bindBuffer(l,null),a.version=s.version}destroyAttribute(e){const t=this.backend,{gl:n}=t;e.isInterleavedBufferAttribute&&t.delete(e.data);const i=t.get(e);n.deleteBuffer(i.bufferGPU),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,{gl:n}=t,i=e.isInterleavedBufferAttribute?e.data:e,{bufferGPU:s}=t.get(i),a=e.array,l=a.byteLength;n.bindBuffer(n.COPY_READ_BUFFER,s);const c=n.createBuffer();n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.bufferData(n.COPY_WRITE_BUFFER,l,n.STREAM_READ),n.copyBufferSubData(n.COPY_READ_BUFFER,n.COPY_WRITE_BUFFER,0,0,l),await t.utils._clientWaitAsync();const d=new e.array.constructor(a.length);return n.bindBuffer(n.COPY_WRITE_BUFFER,c),n.getBufferSubData(n.COPY_WRITE_BUFFER,0,d),n.deleteBuffer(c),n.bindBuffer(n.COPY_READ_BUFFER,null),n.bindBuffer(n.COPY_WRITE_BUFFER,null),d.buffer}_createBuffer(e,t,n,i){const s=e.createBuffer();return e.bindBuffer(t,s),e.bufferData(t,n,i),e.bindBuffer(t,null),s}}let iA,Zv,O7=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.enabled={},this.currentFlipSided=null,this.currentCullFace=null,this.currentProgram=null,this.currentBlendingEnabled=!1,this.currentBlending=null,this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentPremultipledAlpha=null,this.currentPolygonOffsetFactor=null,this.currentPolygonOffsetUnits=null,this.currentColorMask=null,this.currentDepthFunc=null,this.currentDepthMask=null,this.currentStencilFunc=null,this.currentStencilRef=null,this.currentStencilFuncMask=null,this.currentStencilFail=null,this.currentStencilZFail=null,this.currentStencilZPass=null,this.currentStencilMask=null,this.currentLineWidth=null,this.currentClippingPlanes=0,this.currentVAO=null,this.currentIndex=null,this.currentBoundFramebuffers={},this.currentDrawbuffers=new WeakMap,this.maxTextures=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS),this.currentTextureSlot=null,this.currentBoundTextures={},this.currentBoundBufferBases={},this._init()}_init(){const e=this.gl;iA={[_r]:e.FUNC_ADD,[Fb]:e.FUNC_SUBTRACT,[zb]:e.FUNC_REVERSE_SUBTRACT},Zv={[Cu]:e.ZERO,[Vb]:e.ONE,[Gb]:e.SRC_COLOR,[Sg]:e.SRC_ALPHA,[Yb]:e.SRC_ALPHA_SATURATE,[Wb]:e.DST_COLOR,[kb]:e.DST_ALPHA,[Hb]:e.ONE_MINUS_SRC_COLOR,[bg]:e.ONE_MINUS_SRC_ALPHA,[Xb]:e.ONE_MINUS_DST_COLOR,[qb]:e.ONE_MINUS_DST_ALPHA};const t=e.getParameter(e.SCISSOR_BOX),n=e.getParameter(e.VIEWPORT);this.currentScissor=new Ot().fromArray(t),this.currentViewport=new Ot().fromArray(n),this._tempVec4=new Ot}enable(e){const{enabled:t}=this;t[e]!==!0&&(this.gl.enable(e),t[e]=!0)}disable(e){const{enabled:t}=this;t[e]!==!1&&(this.gl.disable(e),t[e]=!1)}setFlipSided(e){if(this.currentFlipSided!==e){const{gl:t}=this;e?t.frontFace(t.CW):t.frontFace(t.CCW),this.currentFlipSided=e}}setCullFace(e){const{gl:t}=this;e!==S1?(this.enable(t.CULL_FACE),e!==this.currentCullFace&&(e===fb?t.cullFace(t.BACK):e===b1?t.cullFace(t.FRONT):t.cullFace(t.FRONT_AND_BACK))):this.disable(t.CULL_FACE),this.currentCullFace=e}setLineWidth(e){const{currentLineWidth:t,gl:n}=this;e!==t&&(n.lineWidth(e),this.currentLineWidth=e)}setBlending(e,t,n,i,s,a,l,c){const{gl:d}=this;if(e===Ga){this.currentBlendingEnabled===!0&&(this.disable(d.BLEND),this.currentBlendingEnabled=!1);return}if(this.currentBlendingEnabled===!1&&(this.enable(d.BLEND),this.currentBlendingEnabled=!0),e!==Vd){if(e!==this.currentBlending||c!==this.currentPremultipledAlpha){if((this.currentBlendEquation!==_r||this.currentBlendEquationAlpha!==_r)&&(d.blendEquation(d.FUNC_ADD),this.currentBlendEquation=_r,this.currentBlendEquationAlpha=_r),c)switch(e){case _o:d.blendFuncSeparate(d.ONE,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case Yd:d.blendFunc(d.ONE,d.ONE);break;case jd:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case Zd:d.blendFuncSeparate(d.ZERO,d.SRC_COLOR,d.ZERO,d.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}else switch(e){case _o:d.blendFuncSeparate(d.SRC_ALPHA,d.ONE_MINUS_SRC_ALPHA,d.ONE,d.ONE_MINUS_SRC_ALPHA);break;case Yd:d.blendFunc(d.SRC_ALPHA,d.ONE);break;case jd:d.blendFuncSeparate(d.ZERO,d.ONE_MINUS_SRC_COLOR,d.ZERO,d.ONE);break;case Zd:d.blendFunc(d.ZERO,d.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",e);break}this.currentBlendSrc=null,this.currentBlendDst=null,this.currentBlendSrcAlpha=null,this.currentBlendDstAlpha=null,this.currentBlending=e,this.currentPremultipledAlpha=c}return}s=s||t,a=a||n,l=l||i,(t!==this.currentBlendEquation||s!==this.currentBlendEquationAlpha)&&(d.blendEquationSeparate(iA[t],iA[s]),this.currentBlendEquation=t,this.currentBlendEquationAlpha=s),(n!==this.currentBlendSrc||i!==this.currentBlendDst||a!==this.currentBlendSrcAlpha||l!==this.currentBlendDstAlpha)&&(d.blendFuncSeparate(Zv[n],Zv[i],Zv[a],Zv[l]),this.currentBlendSrc=n,this.currentBlendDst=i,this.currentBlendSrcAlpha=a,this.currentBlendDstAlpha=l),this.currentBlending=e,this.currentPremultipledAlpha=!1}setColorMask(e){this.currentColorMask!==e&&(this.gl.colorMask(e,e,e,e),this.currentColorMask=e)}setDepthTest(e){const{gl:t}=this;e?this.enable(t.DEPTH_TEST):this.disable(t.DEPTH_TEST)}setDepthMask(e){this.currentDepthMask!==e&&(this.gl.depthMask(e),this.currentDepthMask=e)}setDepthFunc(e){if(this.currentDepthFunc!==e){const{gl:t}=this;switch(e){case Tg:t.depthFunc(t.NEVER);break;case Mg:t.depthFunc(t.ALWAYS);break;case Eg:t.depthFunc(t.LESS);break;case Pc:t.depthFunc(t.LEQUAL);break;case Ag:t.depthFunc(t.EQUAL);break;case Rg:t.depthFunc(t.GEQUAL);break;case Ng:t.depthFunc(t.GREATER);break;case Cg:t.depthFunc(t.NOTEQUAL);break;default:t.depthFunc(t.LEQUAL)}this.currentDepthFunc=e}}scissor(e,t,n,i){const s=this._tempVec4.set(e,t,n,i);if(this.currentScissor.equals(s)===!1){const{gl:a}=this;a.scissor(s.x,s.y,s.z,s.w),this.currentScissor.copy(s)}}viewport(e,t,n,i){const s=this._tempVec4.set(e,t,n,i);if(this.currentViewport.equals(s)===!1){const{gl:a}=this;a.viewport(s.x,s.y,s.z,s.w),this.currentViewport.copy(s)}}setScissorTest(e){const t=this.gl;e?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST)}setStencilTest(e){const{gl:t}=this;e?this.enable(t.STENCIL_TEST):this.disable(t.STENCIL_TEST)}setStencilMask(e){this.currentStencilMask!==e&&(this.gl.stencilMask(e),this.currentStencilMask=e)}setStencilFunc(e,t,n){(this.currentStencilFunc!==e||this.currentStencilRef!==t||this.currentStencilFuncMask!==n)&&(this.gl.stencilFunc(e,t,n),this.currentStencilFunc=e,this.currentStencilRef=t,this.currentStencilFuncMask=n)}setStencilOp(e,t,n){(this.currentStencilFail!==e||this.currentStencilZFail!==t||this.currentStencilZPass!==n)&&(this.gl.stencilOp(e,t,n),this.currentStencilFail=e,this.currentStencilZFail=t,this.currentStencilZPass=n)}setMaterial(e,t,n){const{gl:i}=this;e.side===Fr?this.disable(i.CULL_FACE):this.enable(i.CULL_FACE);let s=e.side===Ti;t&&(s=!s),this.setFlipSided(s),e.blending===_o&&e.transparent===!1?this.setBlending(Ga):this.setBlending(e.blending,e.blendEquation,e.blendSrc,e.blendDst,e.blendEquationAlpha,e.blendSrcAlpha,e.blendDstAlpha,e.premultipliedAlpha),this.setDepthFunc(e.depthFunc),this.setDepthTest(e.depthTest),this.setDepthMask(e.depthWrite),this.setColorMask(e.colorWrite);const a=e.stencilWrite;if(this.setStencilTest(a),a&&(this.setStencilMask(e.stencilWriteMask),this.setStencilFunc(e.stencilFunc,e.stencilRef,e.stencilFuncMask),this.setStencilOp(e.stencilFail,e.stencilZFail,e.stencilZPass)),this.setPolygonOffset(e.polygonOffset,e.polygonOffsetFactor,e.polygonOffsetUnits),e.alphaToCoverage===!0&&this.backend.renderer.samples>1?this.enable(i.SAMPLE_ALPHA_TO_COVERAGE):this.disable(i.SAMPLE_ALPHA_TO_COVERAGE),n>0&&this.currentClippingPlanes!==n)for(let c=0;c<8;c++)c<n?this.enable(12288+c):this.disable(12288+c)}setPolygonOffset(e,t,n){const{gl:i}=this;e?(this.enable(i.POLYGON_OFFSET_FILL),(this.currentPolygonOffsetFactor!==t||this.currentPolygonOffsetUnits!==n)&&(i.polygonOffset(t,n),this.currentPolygonOffsetFactor=t,this.currentPolygonOffsetUnits=n)):this.disable(i.POLYGON_OFFSET_FILL)}useProgram(e){return this.currentProgram!==e?(this.gl.useProgram(e),this.currentProgram=e,!0):!1}setVertexState(e,t=null){const n=this.gl;return this.currentVAO!==e||this.currentIndex!==t?(n.bindVertexArray(e),t!==null&&n.bindBuffer(n.ELEMENT_ARRAY_BUFFER,t),this.currentVAO=e,this.currentIndex=t,!0):!1}resetVertexState(){const e=this.gl;e.bindVertexArray(null),e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,null),this.currentVAO=null,this.currentIndex=null}bindFramebuffer(e,t){const{gl:n,currentBoundFramebuffers:i}=this;return i[e]!==t?(n.bindFramebuffer(e,t),i[e]=t,e===n.DRAW_FRAMEBUFFER&&(i[n.FRAMEBUFFER]=t),e===n.FRAMEBUFFER&&(i[n.DRAW_FRAMEBUFFER]=t),!0):!1}drawBuffers(e,t){const{gl:n}=this;let i=[],s=!1;if(e.textures!==null){i=this.currentDrawbuffers.get(t),i===void 0&&(i=[],this.currentDrawbuffers.set(t,i));const a=e.textures;if(i.length!==a.length||i[0]!==n.COLOR_ATTACHMENT0){for(let l=0,c=a.length;l<c;l++)i[l]=n.COLOR_ATTACHMENT0+l;i.length=a.length,s=!0}}else i[0]!==n.BACK&&(i[0]=n.BACK,s=!0);s&&n.drawBuffers(i)}activeTexture(e){const{gl:t,currentTextureSlot:n,maxTextures:i}=this;e===void 0&&(e=t.TEXTURE0+i-1),n!==e&&(t.activeTexture(e),this.currentTextureSlot=e)}bindTexture(e,t,n){const{gl:i,currentTextureSlot:s,currentBoundTextures:a,maxTextures:l}=this;n===void 0&&(s===null?n=i.TEXTURE0+l-1:n=s);let c=a[n];c===void 0&&(c={type:void 0,texture:void 0},a[n]=c),(c.type!==e||c.texture!==t)&&(s!==n&&(i.activeTexture(n),this.currentTextureSlot=n),i.bindTexture(e,t),c.type=e,c.texture=t)}bindBufferBase(e,t,n){const{gl:i}=this,s=`${e}-${t}`;return this.currentBoundBufferBases[s]!==n?(i.bindBufferBase(e,t,n),this.currentBoundBufferBases[s]=n,!0):!1}unbindTexture(){const{gl:e,currentTextureSlot:t,currentBoundTextures:n}=this,i=n[t];i!==void 0&&i.type!==void 0&&(e.bindTexture(i.type,null),i.type=void 0,i.texture=void 0)}},P7=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.extensions=e.extensions}convert(e,t=Ia){const{gl:n,extensions:i}=this;let s;if(e===Xi)return n.UNSIGNED_BYTE;if(e===G_)return n.UNSIGNED_SHORT_4_4_4_4;if(e===H_)return n.UNSIGNED_SHORT_5_5_5_1;if(e===k_)return n.UNSIGNED_INT_5_9_9_9_REV;if(e===tf)return n.BYTE;if(e===nf)return n.SHORT;if(e===jo)return n.UNSIGNED_SHORT;if(e===Xs)return n.INT;if(e===di)return n.UNSIGNED_INT;if(e===Ri)return n.FLOAT;if(e===Ys)return n.HALF_FLOAT;if(e===Zb)return n.ALPHA;if(e===Qg)return n.RGB;if(e===Ni)return n.RGBA;if(e===Kb)return n.LUMINANCE;if(e===Qb)return n.LUMINANCE_ALPHA;if(e===ka)return n.DEPTH_COMPONENT;if(e===qa)return n.DEPTH_STENCIL;if(e===gp)return n.RED;if(e===ff)return n.RED_INTEGER;if(e===lf)return n.RG;if(e===yp)return n.RG_INTEGER;if(e===vp)return n.RGBA_INTEGER;if(e===sf||e===wc||e===Dc||e===Uc)if(t===wt)if(s=i.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(e===sf)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(e===wc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(e===Dc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(e===Uc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=i.get("WEBGL_compressed_texture_s3tc"),s!==null){if(e===sf)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(e===wc)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(e===Dc)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(e===Uc)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(e===wg||e===Dg||e===Ug||e===Lg)if(s=i.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(e===wg)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(e===Dg)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(e===Ug)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(e===Lg)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(e===Bg||e===Kd||e===Qd)if(s=i.get("WEBGL_compressed_texture_etc"),s!==null){if(e===Bg||e===Kd)return t===wt?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(e===Qd)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(e===Jd||e===$d||e===ep||e===tp||e===np||e===ip||e===sp||e===rp||e===ap||e===op||e===lp||e===up||e===cp||e===hp)if(s=i.get("WEBGL_compressed_texture_astc"),s!==null){if(e===Jd)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(e===$d)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(e===ep)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(e===tp)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(e===np)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(e===ip)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(e===sp)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(e===rp)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(e===ap)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(e===op)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(e===lp)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(e===up)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(e===cp)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(e===hp)return t===wt?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(e===rf)if(s=i.get("EXT_texture_compression_bptc"),s!==null){if(e===rf)return t===wt?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT}else return null;if(e===Jb||e===Og||e===Pg||e===Ig)if(s=i.get("EXT_texture_compression_rgtc"),s!==null){if(e===rf)return s.COMPRESSED_RED_RGTC1_EXT;if(e===Og)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(e===Pg)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(e===Ig)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return e===Ha?n.UNSIGNED_INT_24_8:n[e]!==void 0?n[e]:null}_clientWaitAsync(){const{gl:e}=this,t=e.fenceSync(e.SYNC_GPU_COMMANDS_COMPLETE,0);return e.flush(),new Promise((n,i)=>{function s(){const a=e.clientWaitSync(t,e.SYNC_FLUSH_COMMANDS_BIT,0);if(a===e.WAIT_FAILED){e.deleteSync(t),i();return}if(a===e.TIMEOUT_EXPIRED){requestAnimationFrame(s);return}e.deleteSync(t),n()}s()})}},k2=!1,XS,sA,q2;class I7{constructor(e){this.backend=e,this.gl=e.gl,this.extensions=e.extensions,this.defaultTextures={},k2===!1&&(this._init(),k2=!0)}_init(){const e=this.gl;XS={[zl]:e.REPEAT,[da]:e.CLAMP_TO_EDGE,[Fc]:e.MIRRORED_REPEAT},sA={[Si]:e.NEAREST,[V_]:e.NEAREST_MIPMAP_NEAREST,[Ol]:e.NEAREST_MIPMAP_LINEAR,[Zn]:e.LINEAR,[ef]:e.LINEAR_MIPMAP_NEAREST,[xr]:e.LINEAR_MIPMAP_LINEAR},q2={[eT]:e.NEVER,[rT]:e.ALWAYS,[q_]:e.LESS,[W_]:e.LEQUAL,[tT]:e.EQUAL,[sT]:e.GEQUAL,[nT]:e.GREATER,[iT]:e.NOTEQUAL}}getGLTextureType(e){const{gl:t}=this;let n;return e.isCubeTexture===!0?n=t.TEXTURE_CUBE_MAP:e.isDataArrayTexture===!0||e.isCompressedArrayTexture===!0?n=t.TEXTURE_2D_ARRAY:e.isData3DTexture===!0?n=t.TEXTURE_3D:n=t.TEXTURE_2D,n}getInternalFormat(e,t,n,i,s=!1){const{gl:a,extensions:l}=this;if(e!==null){if(a[e]!==void 0)return a[e];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+e+"'")}let c=t;return t===a.RED&&(n===a.FLOAT&&(c=a.R32F),n===a.HALF_FLOAT&&(c=a.R16F),n===a.UNSIGNED_BYTE&&(c=a.R8),n===a.UNSIGNED_SHORT&&(c=a.R16),n===a.UNSIGNED_INT&&(c=a.R32UI),n===a.BYTE&&(c=a.R8I),n===a.SHORT&&(c=a.R16I),n===a.INT&&(c=a.R32I)),t===a.RED_INTEGER&&(n===a.UNSIGNED_BYTE&&(c=a.R8UI),n===a.UNSIGNED_SHORT&&(c=a.R16UI),n===a.UNSIGNED_INT&&(c=a.R32UI),n===a.BYTE&&(c=a.R8I),n===a.SHORT&&(c=a.R16I),n===a.INT&&(c=a.R32I)),t===a.RG&&(n===a.FLOAT&&(c=a.RG32F),n===a.HALF_FLOAT&&(c=a.RG16F),n===a.UNSIGNED_BYTE&&(c=a.RG8),n===a.UNSIGNED_SHORT&&(c=a.RG16),n===a.UNSIGNED_INT&&(c=a.RG32UI),n===a.BYTE&&(c=a.RG8I),n===a.SHORT&&(c=a.RG16I),n===a.INT&&(c=a.RG32I)),t===a.RG_INTEGER&&(n===a.UNSIGNED_BYTE&&(c=a.RG8UI),n===a.UNSIGNED_SHORT&&(c=a.RG16UI),n===a.UNSIGNED_INT&&(c=a.RG32UI),n===a.BYTE&&(c=a.RG8I),n===a.SHORT&&(c=a.RG16I),n===a.INT&&(c=a.RG32I)),t===a.RGB&&(n===a.FLOAT&&(c=a.RGB32F),n===a.HALF_FLOAT&&(c=a.RGB16F),n===a.UNSIGNED_BYTE&&(c=a.RGB8),n===a.UNSIGNED_SHORT&&(c=a.RGB16),n===a.UNSIGNED_INT&&(c=a.RGB32UI),n===a.BYTE&&(c=a.RGB8I),n===a.SHORT&&(c=a.RGB16I),n===a.INT&&(c=a.RGB32I),n===a.UNSIGNED_BYTE&&(c=i===wt&&s===!1?a.SRGB8:a.RGB8),n===a.UNSIGNED_SHORT_5_6_5&&(c=a.RGB565),n===a.UNSIGNED_SHORT_5_5_5_1&&(c=a.RGB5_A1),n===a.UNSIGNED_SHORT_4_4_4_4&&(c=a.RGB4),n===a.UNSIGNED_INT_5_9_9_9_REV&&(c=a.RGB9_E5)),t===a.RGB_INTEGER&&(n===a.UNSIGNED_BYTE&&(c=a.RGB8UI),n===a.UNSIGNED_SHORT&&(c=a.RGB16UI),n===a.UNSIGNED_INT&&(c=a.RGB32UI),n===a.BYTE&&(c=a.RGB8I),n===a.SHORT&&(c=a.RGB16I),n===a.INT&&(c=a.RGB32I)),t===a.RGBA&&(n===a.FLOAT&&(c=a.RGBA32F),n===a.HALF_FLOAT&&(c=a.RGBA16F),n===a.UNSIGNED_BYTE&&(c=a.RGBA8),n===a.UNSIGNED_SHORT&&(c=a.RGBA16),n===a.UNSIGNED_INT&&(c=a.RGBA32UI),n===a.BYTE&&(c=a.RGBA8I),n===a.SHORT&&(c=a.RGBA16I),n===a.INT&&(c=a.RGBA32I),n===a.UNSIGNED_BYTE&&(c=i===wt&&s===!1?a.SRGB8_ALPHA8:a.RGBA8),n===a.UNSIGNED_SHORT_4_4_4_4&&(c=a.RGBA4),n===a.UNSIGNED_SHORT_5_5_5_1&&(c=a.RGB5_A1)),t===a.RGBA_INTEGER&&(n===a.UNSIGNED_BYTE&&(c=a.RGBA8UI),n===a.UNSIGNED_SHORT&&(c=a.RGBA16UI),n===a.UNSIGNED_INT&&(c=a.RGBA32UI),n===a.BYTE&&(c=a.RGBA8I),n===a.SHORT&&(c=a.RGBA16I),n===a.INT&&(c=a.RGBA32I)),t===a.DEPTH_COMPONENT&&(n===a.UNSIGNED_SHORT&&(c=a.DEPTH_COMPONENT16),n===a.UNSIGNED_INT&&(c=a.DEPTH_COMPONENT24),n===a.FLOAT&&(c=a.DEPTH_COMPONENT32F)),t===a.DEPTH_STENCIL&&n===a.UNSIGNED_INT_24_8&&(c=a.DEPTH24_STENCIL8),(c===a.R16F||c===a.R32F||c===a.RG16F||c===a.RG32F||c===a.RGBA16F||c===a.RGBA32F)&&l.get("EXT_color_buffer_float"),c}setTextureParameters(e,t){const{gl:n,extensions:i,backend:s}=this;n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,t.flipY),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),n.pixelStorei(n.UNPACK_ALIGNMENT,t.unpackAlignment),n.pixelStorei(n.UNPACK_COLORSPACE_CONVERSION_WEBGL,n.NONE),n.texParameteri(e,n.TEXTURE_WRAP_S,XS[t.wrapS]),n.texParameteri(e,n.TEXTURE_WRAP_T,XS[t.wrapT]),(e===n.TEXTURE_3D||e===n.TEXTURE_2D_ARRAY)&&n.texParameteri(e,n.TEXTURE_WRAP_R,XS[t.wrapR]),n.texParameteri(e,n.TEXTURE_MAG_FILTER,sA[t.magFilter]);const a=t.mipmaps!==void 0&&t.mipmaps.length>0,l=t.minFilter===Zn&&a?xr:t.minFilter;if(n.texParameteri(e,n.TEXTURE_MIN_FILTER,sA[l]),t.compareFunction&&(n.texParameteri(e,n.TEXTURE_COMPARE_MODE,n.COMPARE_REF_TO_TEXTURE),n.texParameteri(e,n.TEXTURE_COMPARE_FUNC,q2[t.compareFunction])),i.has("EXT_texture_filter_anisotropic")===!0){if(t.magFilter===Si||t.minFilter!==Ol&&t.minFilter!==xr||t.type===Ri&&i.has("OES_texture_float_linear")===!1)return;if(t.anisotropy>1){const c=i.get("EXT_texture_filter_anisotropic");n.texParameterf(e,c.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(t.anisotropy,s.getMaxAnisotropy()))}}}createDefaultTexture(e){const{gl:t,backend:n,defaultTextures:i}=this,s=this.getGLTextureType(e);let a=i[s];a===void 0&&(a=t.createTexture(),n.state.bindTexture(s,a),t.texParameteri(s,t.TEXTURE_MIN_FILTER,t.NEAREST),t.texParameteri(s,t.TEXTURE_MAG_FILTER,t.NEAREST),i[s]=a),n.set(e,{textureGPU:a,glTextureType:s,isDefault:!0})}createTexture(e,t){const{gl:n,backend:i}=this,{levels:s,width:a,height:l,depth:c}=t,d=i.utils.convert(e.format,e.colorSpace),m=i.utils.convert(e.type),y=this.getInternalFormat(e.internalFormat,d,m,e.colorSpace,e.isVideoTexture),v=n.createTexture(),x=this.getGLTextureType(e);i.state.bindTexture(x,v),this.setTextureParameters(x,e),e.isDataArrayTexture||e.isCompressedArrayTexture?n.texStorage3D(n.TEXTURE_2D_ARRAY,s,y,a,l,c):e.isData3DTexture?n.texStorage3D(n.TEXTURE_3D,s,y,a,l,c):e.isVideoTexture||n.texStorage2D(x,s,y,a,l),i.set(e,{textureGPU:v,glTextureType:x,glFormat:d,glType:m,glInternalFormat:y})}copyBufferToTexture(e,t){const{gl:n,backend:i}=this,{textureGPU:s,glTextureType:a,glFormat:l,glType:c}=i.get(t),{width:d,height:m}=t.source.data;n.bindBuffer(n.PIXEL_UNPACK_BUFFER,e),i.state.bindTexture(a,s),n.pixelStorei(n.UNPACK_FLIP_Y_WEBGL,!1),n.pixelStorei(n.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),n.texSubImage2D(a,0,0,0,d,m,l,c,0),n.bindBuffer(n.PIXEL_UNPACK_BUFFER,null),i.state.unbindTexture()}updateTexture(e,t){const{gl:n}=this,{width:i,height:s}=t,{textureGPU:a,glTextureType:l,glFormat:c,glType:d,glInternalFormat:m}=this.backend.get(e);if(e.isRenderTargetTexture||a===void 0)return;const y=v=>v.isDataTexture?v.image.data:typeof HTMLImageElement<"u"&&v instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&v instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&v instanceof ImageBitmap||v instanceof OffscreenCanvas?v:v.data;if(this.backend.state.bindTexture(l,a),this.setTextureParameters(l,e),e.isCompressedTexture){const v=e.mipmaps,x=t.image;for(let S=0;S<v.length;S++){const A=v[S];e.isCompressedArrayTexture?e.format!==n.RGBA?c!==null?n.compressedTexSubImage3D(n.TEXTURE_2D_ARRAY,S,0,0,0,A.width,A.height,x.depth,c,A.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):n.texSubImage3D(n.TEXTURE_2D_ARRAY,S,0,0,0,A.width,A.height,x.depth,c,d,A.data):c!==null?n.compressedTexSubImage2D(n.TEXTURE_2D,S,0,0,A.width,A.height,c,A.data):console.warn("Unsupported compressed texture format")}}else if(e.isCubeTexture){const v=t.images;for(let x=0;x<6;x++){const S=y(v[x]);n.texSubImage2D(n.TEXTURE_CUBE_MAP_POSITIVE_X+x,0,0,0,i,s,c,d,S)}}else if(e.isDataArrayTexture){const v=t.image;n.texSubImage3D(n.TEXTURE_2D_ARRAY,0,0,0,0,v.width,v.height,v.depth,c,d,v.data)}else if(e.isData3DTexture){const v=t.image;n.texSubImage3D(n.TEXTURE_3D,0,0,0,0,v.width,v.height,v.depth,c,d,v.data)}else if(e.isVideoTexture)e.update(),n.texImage2D(l,0,m,c,d,t.image);else{const v=y(t.image);n.texSubImage2D(l,0,0,0,i,s,c,d,v)}}generateMipmaps(e){const{gl:t,backend:n}=this,{textureGPU:i,glTextureType:s}=n.get(e);n.state.bindTexture(s,i),t.generateMipmap(s)}deallocateRenderBuffers(e){const{gl:t,backend:n}=this;if(e){const i=n.get(e);if(i.renderBufferStorageSetup=void 0,i.framebuffers){for(const s in i.framebuffers)t.deleteFramebuffer(i.framebuffers[s]);delete i.framebuffers}if(i.depthRenderbuffer&&(t.deleteRenderbuffer(i.depthRenderbuffer),delete i.depthRenderbuffer),i.stencilRenderbuffer&&(t.deleteRenderbuffer(i.stencilRenderbuffer),delete i.stencilRenderbuffer),i.msaaFrameBuffer&&(t.deleteFramebuffer(i.msaaFrameBuffer),delete i.msaaFrameBuffer),i.msaaRenderbuffers){for(let s=0;s<i.msaaRenderbuffers.length;s++)t.deleteRenderbuffer(i.msaaRenderbuffers[s]);delete i.msaaRenderbuffers}}}destroyTexture(e){const{gl:t,backend:n}=this,{textureGPU:i,renderTarget:s}=n.get(e);this.deallocateRenderBuffers(s),t.deleteTexture(i),n.delete(e)}copyTextureToTexture(e,t,n=null,i=null,s=0,a=0){const{gl:l,backend:c}=this,{state:d}=this.backend,{textureGPU:m,glTextureType:y,glType:v,glFormat:x}=c.get(t);d.bindTexture(y,m);let S,A,E,M,C,w,D,z,B;const F=e.isCompressedTexture?e.mipmaps[a]:e.image;if(n!==null)S=n.max.x-n.min.x,A=n.max.y-n.min.y,E=n.isBox3?n.max.z-n.min.z:1,M=n.min.x,C=n.min.y,w=n.isBox3?n.min.z:0;else{const pe=Math.pow(2,-s);S=Math.floor(F.width*pe),A=Math.floor(F.height*pe),e.isDataArrayTexture?E=F.depth:e.isData3DTexture?E=Math.floor(F.depth*pe):E=1,M=0,C=0,w=0}i!==null?(D=i.x,z=i.y,B=i.z):(D=0,z=0,B=0),l.pixelStorei(l.UNPACK_FLIP_Y_WEBGL,t.flipY),l.pixelStorei(l.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t.premultiplyAlpha),l.pixelStorei(l.UNPACK_ALIGNMENT,t.unpackAlignment);const H=l.getParameter(l.UNPACK_ROW_LENGTH),I=l.getParameter(l.UNPACK_IMAGE_HEIGHT),P=l.getParameter(l.UNPACK_SKIP_PIXELS),Z=l.getParameter(l.UNPACK_SKIP_ROWS),ue=l.getParameter(l.UNPACK_SKIP_IMAGES);l.pixelStorei(l.UNPACK_ROW_LENGTH,F.width),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,F.height),l.pixelStorei(l.UNPACK_SKIP_PIXELS,M),l.pixelStorei(l.UNPACK_SKIP_ROWS,C),l.pixelStorei(l.UNPACK_SKIP_IMAGES,w);const se=t.isDataArrayTexture||t.isData3DTexture;if(e.isRenderTargetTexture||e.isDepthTexture){const pe=c.get(e),Se=c.get(t),V=c.get(pe.renderTarget),Q=c.get(Se.renderTarget),J=V.framebuffers[pe.cacheKey],ve=Q.framebuffers[Se.cacheKey];d.bindFramebuffer(l.READ_FRAMEBUFFER,J),d.bindFramebuffer(l.DRAW_FRAMEBUFFER,ve);let X=l.COLOR_BUFFER_BIT;e.isDepthTexture&&(X=l.DEPTH_BUFFER_BIT),l.blitFramebuffer(M,C,S,A,D,z,S,A,X,l.NEAREST),d.bindFramebuffer(l.READ_FRAMEBUFFER,null),d.bindFramebuffer(l.DRAW_FRAMEBUFFER,null)}else se?e.isDataTexture||e.isData3DTexture?l.texSubImage3D(y,a,D,z,B,S,A,E,x,v,F.data):t.isCompressedArrayTexture?l.compressedTexSubImage3D(y,a,D,z,B,S,A,E,x,F.data):l.texSubImage3D(y,a,D,z,B,S,A,E,x,v,F):e.isDataTexture?l.texSubImage2D(y,a,D,z,S,A,x,v,F.data):e.isCompressedTexture?l.compressedTexSubImage2D(y,a,D,z,F.width,F.height,x,F.data):l.texSubImage2D(y,a,D,z,S,A,x,v,F);l.pixelStorei(l.UNPACK_ROW_LENGTH,H),l.pixelStorei(l.UNPACK_IMAGE_HEIGHT,I),l.pixelStorei(l.UNPACK_SKIP_PIXELS,P),l.pixelStorei(l.UNPACK_SKIP_ROWS,Z),l.pixelStorei(l.UNPACK_SKIP_IMAGES,ue),a===0&&t.generateMipmaps&&l.generateMipmap(y),d.unbindTexture()}copyFramebufferToTexture(e,t,n){const{gl:i}=this,{state:s}=this.backend,{textureGPU:a}=this.backend.get(e),{x:l,y:c,z:d,w:m}=n,y=e.isDepthTexture===!0||t.renderTarget&&t.renderTarget.samples>0,v=t.renderTarget?t.renderTarget.height:this.backend.getDrawingBufferSize().y;if(y){const x=l!==0||c!==0;let S,A;if(e.isDepthTexture===!0?(S=i.DEPTH_BUFFER_BIT,A=i.DEPTH_ATTACHMENT,t.stencil&&(S|=i.STENCIL_BUFFER_BIT)):(S=i.COLOR_BUFFER_BIT,A=i.COLOR_ATTACHMENT0),x){const E=this.backend.get(t.renderTarget),M=E.framebuffers[t.getCacheKey()],C=E.msaaFrameBuffer;s.bindFramebuffer(i.DRAW_FRAMEBUFFER,M),s.bindFramebuffer(i.READ_FRAMEBUFFER,C);const w=v-c-m;i.blitFramebuffer(l,w,l+d,w+m,l,w,l+d,w+m,S,i.NEAREST),s.bindFramebuffer(i.READ_FRAMEBUFFER,M),s.bindTexture(i.TEXTURE_2D,a),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,l,w,d,m),s.unbindTexture()}else{const E=i.createFramebuffer();s.bindFramebuffer(i.DRAW_FRAMEBUFFER,E),i.framebufferTexture2D(i.DRAW_FRAMEBUFFER,A,i.TEXTURE_2D,a,0),i.blitFramebuffer(0,0,d,m,0,0,d,m,S,i.NEAREST),i.deleteFramebuffer(E)}}else s.bindTexture(i.TEXTURE_2D,a),i.copyTexSubImage2D(i.TEXTURE_2D,0,0,0,l,v-m-c,d,m),s.unbindTexture();e.generateMipmaps&&this.generateMipmaps(e),this.backend._setFramebuffer(t)}setupRenderBufferStorage(e,t,n,i=!1){const{gl:s}=this,a=t.renderTarget,{depthTexture:l,depthBuffer:c,stencilBuffer:d,width:m,height:y}=a;if(s.bindRenderbuffer(s.RENDERBUFFER,e),c&&!d){let v=s.DEPTH_COMPONENT24;i===!0?this.extensions.get("WEBGL_multisampled_render_to_texture").renderbufferStorageMultisampleEXT(s.RENDERBUFFER,a.samples,v,m,y):n>0?(l&&l.isDepthTexture&&l.type===s.FLOAT&&(v=s.DEPTH_COMPONENT32F),s.renderbufferStorageMultisample(s.RENDERBUFFER,n,v,m,y)):s.renderbufferStorage(s.RENDERBUFFER,v,m,y),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_ATTACHMENT,s.RENDERBUFFER,e)}else c&&d&&(n>0?s.renderbufferStorageMultisample(s.RENDERBUFFER,n,s.DEPTH24_STENCIL8,m,y):s.renderbufferStorage(s.RENDERBUFFER,s.DEPTH_STENCIL,m,y),s.framebufferRenderbuffer(s.FRAMEBUFFER,s.DEPTH_STENCIL_ATTACHMENT,s.RENDERBUFFER,e))}async copyTextureToBuffer(e,t,n,i,s,a){const{backend:l,gl:c}=this,{textureGPU:d,glFormat:m,glType:y}=this.backend.get(e),v=c.createFramebuffer();c.bindFramebuffer(c.READ_FRAMEBUFFER,v);const x=e.isCubeTexture?c.TEXTURE_CUBE_MAP_POSITIVE_X+a:c.TEXTURE_2D;c.framebufferTexture2D(c.READ_FRAMEBUFFER,c.COLOR_ATTACHMENT0,x,d,0);const S=this._getTypedArrayType(y),A=this._getBytesPerTexel(y,m),M=i*s*A,C=c.createBuffer();c.bindBuffer(c.PIXEL_PACK_BUFFER,C),c.bufferData(c.PIXEL_PACK_BUFFER,M,c.STREAM_READ),c.readPixels(t,n,i,s,m,y,0),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),await l.utils._clientWaitAsync();const w=new S(M/S.BYTES_PER_ELEMENT);return c.bindBuffer(c.PIXEL_PACK_BUFFER,C),c.getBufferSubData(c.PIXEL_PACK_BUFFER,0,w),c.bindBuffer(c.PIXEL_PACK_BUFFER,null),c.deleteFramebuffer(v),w}_getTypedArrayType(e){const{gl:t}=this;if(e===t.UNSIGNED_BYTE)return Uint8Array;if(e===t.UNSIGNED_SHORT_4_4_4_4||e===t.UNSIGNED_SHORT_5_5_5_1||e===t.UNSIGNED_SHORT_5_6_5||e===t.UNSIGNED_SHORT)return Uint16Array;if(e===t.UNSIGNED_INT)return Uint32Array;if(e===t.HALF_FLOAT)return Uint16Array;if(e===t.FLOAT)return Float32Array;throw new Error(`Unsupported WebGL type: ${e}`)}_getBytesPerTexel(e,t){const{gl:n}=this;let i=0;if(e===n.UNSIGNED_BYTE&&(i=1),(e===n.UNSIGNED_SHORT_4_4_4_4||e===n.UNSIGNED_SHORT_5_5_5_1||e===n.UNSIGNED_SHORT_5_6_5||e===n.UNSIGNED_SHORT||e===n.HALF_FLOAT)&&(i=2),(e===n.UNSIGNED_INT||e===n.FLOAT)&&(i=4),t===n.RGBA)return i*4;if(t===n.RGB)return i*3;if(t===n.ALPHA)return i}}let F7=class{constructor(e){this.backend=e,this.gl=this.backend.gl,this.availableExtensions=this.gl.getSupportedExtensions(),this.extensions={}}get(e){let t=this.extensions[e];return t===void 0&&(t=this.gl.getExtension(e),this.extensions[e]=t),t}has(e){return this.availableExtensions.includes(e)}},z7=class{constructor(e){this.backend=e,this.maxAnisotropy=null}getMaxAnisotropy(){if(this.maxAnisotropy!==null)return this.maxAnisotropy;const e=this.backend.gl,t=this.backend.extensions;if(t.has("EXT_texture_filter_anisotropic")===!0){const n=t.get("EXT_texture_filter_anisotropic");this.maxAnisotropy=e.getParameter(n.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else this.maxAnisotropy=0;return this.maxAnisotropy}};const W2={WEBGL_multi_draw:"WEBGL_multi_draw",WEBGL_compressed_texture_astc:"texture-compression-astc",WEBGL_compressed_texture_etc:"texture-compression-etc2",WEBGL_compressed_texture_etc1:"texture-compression-etc1",WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBKIT_WEBGL_compressed_texture_pvrtc:"texture-compression-pvrtc",WEBGL_compressed_texture_s3tc:"texture-compression-bc",EXT_texture_compression_bptc:"texture-compression-bptc",EXT_disjoint_timer_query_webgl2:"timestamp-query"};let V7=class{constructor(e){this.gl=e.gl,this.extensions=e.extensions,this.info=e.renderer.info,this.mode=null,this.index=0,this.type=null,this.object=null}render(e,t){const{gl:n,mode:i,object:s,type:a,info:l,index:c}=this;c!==0?n.drawElements(i,t,a,e):n.drawArrays(i,e,t),l.update(s,t,1)}renderInstances(e,t,n){const{gl:i,mode:s,type:a,index:l,object:c,info:d}=this;n!==0&&(l!==0?i.drawElementsInstanced(s,t,a,e,n):i.drawArraysInstanced(s,e,t,n),d.update(c,t,n))}renderMultiDraw(e,t,n){const{extensions:i,mode:s,object:a,info:l}=this;if(n===0)return;const c=i.get("WEBGL_multi_draw");if(c===null)for(let d=0;d<n;d++)this.render(e[d],t[d]);else{this.index!==0?c.multiDrawElementsWEBGL(s,t,0,this.type,e,0,n):c.multiDrawArraysWEBGL(s,e,0,t,0,n);let d=0;for(let m=0;m<n;m++)d+=t[m];l.update(a,d,1)}}renderMultiDrawInstances(e,t,n,i){const{extensions:s,mode:a,object:l,info:c}=this;if(n===0)return;const d=s.get("WEBGL_multi_draw");if(d===null)for(let m=0;m<n;m++)this.renderInstances(e[m],t[m],i[m]);else{this.index!==0?d.multiDrawElementsInstancedWEBGL(a,t,0,this.type,e,0,i,0,n):d.multiDrawArraysInstancedWEBGL(a,e,0,t,0,i,0,n);let m=0;for(let y=0;y<n;y++)m+=t[y]*i[y];c.update(l,m,1)}}};class HP{constructor(e=256){this.trackTimestamp=!0,this.maxQueries=e,this.currentQueryIndex=0,this.queryOffsets=new Map,this.isDisposed=!1,this.lastValue=0,this.pendingResolve=!1}allocateQueriesForContext(){}async resolveQueriesAsync(){}dispose(){}}class G7 extends HP{constructor(e,t,n=2048){if(super(n),this.gl=e,this.type=t,this.ext=e.getExtension("EXT_disjoint_timer_query_webgl2")||e.getExtension("EXT_disjoint_timer_query"),!this.ext){console.warn("EXT_disjoint_timer_query not supported; timestamps will be disabled."),this.trackTimestamp=!1;return}this.queries=[];for(let i=0;i<this.maxQueries;i++)this.queries.push(e.createQuery());this.activeQuery=null,this.queryStates=new Map}allocateQueriesForContext(e){if(!this.trackTimestamp)return null;if(this.currentQueryIndex+2>this.maxQueries)return Il(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryStates.set(t,"inactive"),this.queryOffsets.set(e.id,t),t}beginQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t==null||this.activeQuery!==null)return;const n=this.queries[t];if(n)try{this.queryStates.get(t)==="inactive"&&(this.gl.beginQuery(this.ext.TIME_ELAPSED_EXT,n),this.activeQuery=t,this.queryStates.set(t,"started"))}catch(i){console.error("Error in beginQuery:",i),this.activeQuery=null,this.queryStates.set(t,"inactive")}}endQuery(e){if(!this.trackTimestamp||this.isDisposed)return;const t=this.queryOffsets.get(e.id);if(t!=null&&this.activeQuery===t)try{this.gl.endQuery(this.ext.TIME_ELAPSED_EXT),this.queryStates.set(t,"ended"),this.activeQuery=null}catch(n){console.error("Error in endQuery:",n),this.queryStates.set(t,"inactive"),this.activeQuery=null}}async resolveQueriesAsync(){if(!this.trackTimestamp||this.pendingResolve)return this.lastValue;this.pendingResolve=!0;try{const e=[];for(const[i,s]of this.queryStates)if(s==="ended"){const a=this.queries[i];e.push(this.resolveQuery(a))}if(e.length===0)return this.lastValue;const n=(await Promise.all(e)).reduce((i,s)=>i+s,0);return this.lastValue=n,this.currentQueryIndex=0,this.queryOffsets.clear(),this.queryStates.clear(),this.activeQuery=null,n}catch(e){return console.error("Error resolving queries:",e),this.lastValue}finally{this.pendingResolve=!1}}async resolveQuery(e){return new Promise(t=>{if(this.isDisposed){t(this.lastValue);return}let n,i=!1;const s=()=>{n&&(clearTimeout(n),n=null)},a=c=>{i||(i=!0,s(),t(c))},l=()=>{if(this.isDisposed){a(this.lastValue);return}try{if(this.gl.getParameter(this.ext.GPU_DISJOINT_EXT)){a(this.lastValue);return}if(!this.gl.getQueryParameter(e,this.gl.QUERY_RESULT_AVAILABLE)){n=setTimeout(l,1);return}const m=this.gl.getQueryParameter(e,this.gl.QUERY_RESULT);t(Number(m)/1e6)}catch(c){console.error("Error checking query:",c),t(this.lastValue)}};l()})}dispose(){if(!this.isDisposed&&(this.isDisposed=!0,!!this.trackTimestamp)){for(const e of this.queries)this.gl.deleteQuery(e);this.queries=[],this.queryStates.clear(),this.queryOffsets.clear(),this.lastValue=0,this.activeQuery=null}}}class X2 extends GP{constructor(e={}){super(e),this.isWebGLBackend=!0,this.attributeUtils=null,this.extensions=null,this.capabilities=null,this.textureUtils=null,this.bufferRenderer=null,this.gl=null,this.state=null,this.utils=null,this.vaoCache={},this.transformFeedbackCache={},this.discard=!1,this.disjoint=null,this.parallel=null,this._currentContext=null,this._knownBindings=new WeakSet,this._supportsInvalidateFramebuffer=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),this._xrFramebuffer=null}init(e){super.init(e);const t=this.parameters,n={antialias:e.samples>0,alpha:!0,depth:e.depth,stencil:e.stencil},i=t.context!==void 0?t.context:e.domElement.getContext("webgl2",n);function s(a){a.preventDefault();const l={api:"WebGL",message:a.statusMessage||"Unknown reason",reason:null,originalEvent:a};e.onDeviceLost(l)}this._onContextLost=s,e.domElement.addEventListener("webglcontextlost",s,!1),this.gl=i,this.extensions=new F7(this),this.capabilities=new z7(this),this.attributeUtils=new B7(this),this.textureUtils=new I7(this),this.bufferRenderer=new V7(this),this.state=new O7(this),this.utils=new P7(this),this.extensions.get("EXT_color_buffer_float"),this.extensions.get("WEBGL_clip_cull_distance"),this.extensions.get("OES_texture_float_linear"),this.extensions.get("EXT_color_buffer_half_float"),this.extensions.get("WEBGL_multisampled_render_to_texture"),this.extensions.get("WEBGL_render_shared_exponent"),this.extensions.get("WEBGL_multi_draw"),this.disjoint=this.extensions.get("EXT_disjoint_timer_query_webgl2"),this.parallel=this.extensions.get("KHR_parallel_shader_compile")}get coordinateSystem(){return zr}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}async waitForGPU(){await this.utils._clientWaitAsync()}async makeXRCompatible(){this.gl.getContextAttributes().xrCompatible!==!0&&await this.gl.makeXRCompatible()}setXRTarget(e){this._xrFramebuffer=e}setXRRenderTargetTextures(e,t,n=null){const i=this.gl;if(this.set(e.texture,{textureGPU:t,glInternalFormat:i.RGBA8}),n!==null){const s=e.stencilBuffer?i.DEPTH24_STENCIL8:i.DEPTH_COMPONENT24;this.set(e.depthTexture,{textureGPU:n,glInternalFormat:s}),this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer&&console.warn("THREE.WebGLBackend: Render-to-texture extension was disabled because an external texture was provided"),e.autoAllocateDepthBuffer=!1}}initTimestampQuery(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t]||(this.timestampQueryPool[t]=new G7(this.gl,t,2048));const n=this.timestampQueryPool[t];n.allocateQueriesForContext(e)!==null&&n.beginQuery(e)}prepareTimestampBuffer(e){if(!this.disjoint||!this.trackTimestamp)return;const t=e.isComputeNode?"compute":"render";this.timestampQueryPool[t].endQuery(e)}getContext(){return this.gl}beginRender(e){const{state:t,gl:n}=this,i=this.get(e);if(e.viewport?this.updateViewport(e):t.viewport(0,0,n.drawingBufferWidth,n.drawingBufferHeight),e.scissor){const{x:a,y:l,width:c,height:d}=e.scissorValue;t.scissor(a,e.height-d-l,c,d)}this.initTimestampQuery(e),i.previousContext=this._currentContext,this._currentContext=e,this._setFramebuffer(e),this.clear(e.clearColor,e.clearDepth,e.clearStencil,e,!1);const s=e.occlusionQueryCount;s>0&&(i.currentOcclusionQueries=i.occlusionQueries,i.currentOcclusionQueryObjects=i.occlusionQueryObjects,i.lastOcclusionObject=null,i.occlusionQueries=new Array(s),i.occlusionQueryObjects=new Array(s),i.occlusionQueryIndex=0)}finishRender(e){const{gl:t,state:n}=this,i=this.get(e),s=i.previousContext;n.resetVertexState();const a=e.occlusionQueryCount;a>0&&(a>i.occlusionQueryIndex&&t.endQuery(t.ANY_SAMPLES_PASSED),this.resolveOccludedAsync(e));const l=e.textures;if(l!==null)for(let c=0;c<l.length;c++){const d=l[c];d.generateMipmaps&&this.generateMipmaps(d)}if(this._currentContext=s,e.textures!==null&&e.renderTarget){const c=this.get(e.renderTarget),{samples:d}=e.renderTarget;if(d>0&&this._useMultisampledRTT(e.renderTarget)===!1){const m=c.framebuffers[e.getCacheKey()],y=t.COLOR_BUFFER_BIT,v=c.msaaFrameBuffer,x=e.textures;n.bindFramebuffer(t.READ_FRAMEBUFFER,v),n.bindFramebuffer(t.DRAW_FRAMEBUFFER,m);for(let S=0;S<x.length;S++)if(e.scissor){const{x:A,y:E,width:M,height:C}=e.scissorValue,w=e.height-C-E;t.blitFramebuffer(A,w,A+M,w+C,A,w,A+M,w+C,y,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateSubFramebuffer(t.READ_FRAMEBUFFER,c.invalidationArray,A,w,M,C)}else t.blitFramebuffer(0,0,e.width,e.height,0,0,e.width,e.height,y,t.NEAREST),this._supportsInvalidateFramebuffer===!0&&t.invalidateFramebuffer(t.READ_FRAMEBUFFER,c.invalidationArray)}}s!==null&&(this._setFramebuffer(s),s.viewport?this.updateViewport(s):n.viewport(0,0,t.drawingBufferWidth,t.drawingBufferHeight)),this.prepareTimestampBuffer(e)}resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueries:n,currentOcclusionQueryObjects:i}=t;if(n&&i){const s=new WeakSet,{gl:a}=this;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueries=null;const l=()=>{let c=0;for(let d=0;d<n.length;d++){const m=n[d];m!==null&&a.getQueryParameter(m,a.QUERY_RESULT_AVAILABLE)&&(a.getQueryParameter(m,a.QUERY_RESULT)===0&&s.add(i[d]),n[d]=null,a.deleteQuery(m),c++)}c<n.length?requestAnimationFrame(l):t.occluded=s};l()}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}updateViewport(e){const{state:t}=this,{x:n,y:i,width:s,height:a}=e.viewportValue;t.viewport(n,e.height-a-i,s,a)}setScissorTest(e){this.state.setScissorTest(e)}getClearColor(){const e=super.getClearColor();return e.r*=e.a,e.g*=e.a,e.b*=e.a,e}clear(e,t,n,i=null,s=!0){const{gl:a,renderer:l}=this;i===null&&(i={textures:null,clearColorValue:this.getClearColor()});let c=0;if(e&&(c|=a.COLOR_BUFFER_BIT),t&&(c|=a.DEPTH_BUFFER_BIT),n&&(c|=a.STENCIL_BUFFER_BIT),c!==0){let d;i.clearColorValue?d=i.clearColorValue:d=this.getClearColor();const m=l.getClearDepth(),y=l.getClearStencil();if(t&&this.state.setDepthMask(!0),i.textures===null)a.clearColor(d.r,d.g,d.b,d.a),a.clear(c);else{if(s&&this._setFramebuffer(i),e)for(let v=0;v<i.textures.length;v++)v===0?a.clearBufferfv(a.COLOR,v,[d.r,d.g,d.b,d.a]):a.clearBufferfv(a.COLOR,v,[0,0,0,1]);t&&n?a.clearBufferfi(a.DEPTH_STENCIL,0,m,y):t?a.clearBufferfv(a.DEPTH,0,[m]):n&&a.clearBufferiv(a.STENCIL,0,[y])}}}beginCompute(e){const{state:t,gl:n}=this;t.bindFramebuffer(n.FRAMEBUFFER,null),this.initTimestampQuery(e)}compute(e,t,n,i){const{state:s,gl:a}=this;this.discard===!1&&(a.enable(a.RASTERIZER_DISCARD),this.discard=!0);const{programGPU:l,transformBuffers:c,attributes:d}=this.get(i),m=this._getVaoKey(d),y=this.vaoCache[m];y===void 0?this._createVao(d):s.setVertexState(y),s.useProgram(l),this._bindUniforms(n);const v=this._getTransformFeedback(c);a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,v),a.beginTransformFeedback(a.POINTS),d[0].isStorageInstancedBufferAttribute?a.drawArraysInstanced(a.POINTS,0,1,t.count):a.drawArrays(a.POINTS,0,t.count),a.endTransformFeedback(),a.bindTransformFeedback(a.TRANSFORM_FEEDBACK,null);for(let x=0;x<c.length;x++){const S=c[x];S.pbo&&this.textureUtils.copyBufferToTexture(S.transformBuffer,S.pbo),S.switchBuffers()}}finishCompute(e){const t=this.gl;this.discard=!1,t.disable(t.RASTERIZER_DISCARD),this.prepareTimestampBuffer(e),this._currentContext&&this._setFramebuffer(this._currentContext)}draw(e){const{object:t,pipeline:n,material:i,context:s,hardwareClippingPlanes:a}=e,{programGPU:l}=this.get(n),{gl:c,state:d}=this,m=this.get(s),y=e.getDrawParameters();if(y===null)return;this._bindUniforms(e.getBindings());const v=t.isMesh&&t.matrixWorld.determinant()<0;d.setMaterial(i,v,a),d.useProgram(l);const x=this.get(e);let S=x.staticVao;if(S===void 0||x.geometryId!==e.geometry.id){const F=this._getVaoKey(e.getAttributes());if(S=this.vaoCache[F],S===void 0){let H;({vaoGPU:S,staticVao:H}=this._createVao(e.getAttributes())),H&&(x.staticVao=S,x.geometryId=e.geometry.id)}}const A=e.getIndex(),E=A!==null?this.get(A).bufferGPU:null;d.setVertexState(S,E);const M=m.lastOcclusionObject;if(M!==t&&M!==void 0){if(M!==null&&M.occlusionTest===!0&&(c.endQuery(c.ANY_SAMPLES_PASSED),m.occlusionQueryIndex++),t.occlusionTest===!0){const F=c.createQuery();c.beginQuery(c.ANY_SAMPLES_PASSED,F),m.occlusionQueries[m.occlusionQueryIndex]=F,m.occlusionQueryObjects[m.occlusionQueryIndex]=t}m.lastOcclusionObject=t}const C=this.bufferRenderer;t.isPoints?C.mode=c.POINTS:t.isLineSegments?C.mode=c.LINES:t.isLine?C.mode=c.LINE_STRIP:t.isLineLoop?C.mode=c.LINE_LOOP:i.wireframe===!0?(d.setLineWidth(i.wireframeLinewidth*this.renderer.getPixelRatio()),C.mode=c.LINES):C.mode=c.TRIANGLES;const{vertexCount:w,instanceCount:D}=y;let{firstVertex:z}=y;if(C.object=t,A!==null){z*=A.array.BYTES_PER_ELEMENT;const F=this.get(A);C.index=A.count,C.type=F.type}else C.index=0;const B=()=>{t.isBatchedMesh?t._multiDrawInstances!==null?(Il("THREE.WebGLBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),C.renderMultiDrawInstances(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount,t._multiDrawInstances)):this.hasFeature("WEBGL_multi_draw")?C.renderMultiDraw(t._multiDrawStarts,t._multiDrawCounts,t._multiDrawCount):Il("THREE.WebGLRenderer: WEBGL_multi_draw not supported."):D>1?C.renderInstances(z,w,D):C.render(z,w)};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const F=this.get(e.camera),H=e.camera.cameras,I=e.getBindingGroup("cameraIndex").bindings[0];if(F.indexesGPU===void 0||F.indexesGPU.length!==H.length){const ue=new Uint32Array([0,0,0,0]),se=[];for(let pe=0,Se=H.length;pe<Se;pe++){const V=c.createBuffer();ue[0]=pe,c.bindBuffer(c.UNIFORM_BUFFER,V),c.bufferData(c.UNIFORM_BUFFER,ue,c.STATIC_DRAW),se.push(V)}F.indexesGPU=se}const P=this.get(I),Z=this.renderer.getPixelRatio();for(let ue=0,se=H.length;ue<se;ue++){const pe=H[ue];if(t.layers.test(pe.layers)){const Se=pe.viewport,V=Se.x*Z,Q=Se.y*Z,J=Se.width*Z,ve=Se.height*Z;d.viewport(Math.floor(V),Math.floor(e.context.height-ve-Q),Math.floor(J),Math.floor(ve)),d.bindBufferBase(c.UNIFORM_BUFFER,P.index,F.indexesGPU[ue]),B()}}}else B()}needsRenderUpdate(){return!1}getRenderCacheKey(){return""}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,i,s,a){return this.textureUtils.copyTextureToBuffer(e,t,n,i,s,a)}createSampler(){}destroySampler(){}createNodeBuilder(e,t){return new D7(e,t)}createProgram(e){const t=this.gl,{stage:n,code:i}=e,s=n==="fragment"?t.createShader(t.FRAGMENT_SHADER):t.createShader(t.VERTEX_SHADER);t.shaderSource(s,i),t.compileShader(s),this.set(e,{shaderGPU:s})}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){const n=this.gl,i=e.pipeline,{fragmentProgram:s,vertexProgram:a}=i,l=n.createProgram(),c=this.get(s).shaderGPU,d=this.get(a).shaderGPU;if(n.attachShader(l,c),n.attachShader(l,d),n.linkProgram(l),this.set(i,{programGPU:l,fragmentShader:c,vertexShader:d}),t!==null&&this.parallel){const m=new Promise(y=>{const v=this.parallel,x=()=>{n.getProgramParameter(l,v.COMPLETION_STATUS_KHR)?(this._completeCompile(e,i),y()):requestAnimationFrame(x)};x()});t.push(m);return}this._completeCompile(e,i)}_handleSource(e,t){const n=e.split(`
`),i=[],s=Math.max(t-6,0),a=Math.min(t+6,n.length);for(let l=s;l<a;l++){const c=l+1;i.push(`${c===t?">":" "} ${c}: ${n[l]}`)}return i.join(`
`)}_getShaderErrors(e,t,n){const i=e.getShaderParameter(t,e.COMPILE_STATUS),s=e.getShaderInfoLog(t).trim();if(i&&s==="")return"";const a=/ERROR: 0:(\d+)/.exec(s);if(a){const l=parseInt(a[1]);return n.toUpperCase()+`

`+s+`

`+this._handleSource(e.getShaderSource(t),l)}else return s}_logProgramError(e,t,n){if(this.renderer.debug.checkShaderErrors){const i=this.gl,s=i.getProgramInfoLog(e).trim();if(i.getProgramParameter(e,i.LINK_STATUS)===!1)if(typeof this.renderer.debug.onShaderError=="function")this.renderer.debug.onShaderError(i,e,n,t);else{const a=this._getShaderErrors(i,n,"vertex"),l=this._getShaderErrors(i,t,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(e,i.VALIDATE_STATUS)+`

Program Info Log: `+s+`
`+a+`
`+l)}else s!==""&&console.warn("THREE.WebGLProgram: Program Info Log:",s)}}_completeCompile(e,t){const{state:n,gl:i}=this,s=this.get(t),{programGPU:a,fragmentShader:l,vertexShader:c}=s;i.getProgramParameter(a,i.LINK_STATUS)===!1&&this._logProgramError(a,l,c),n.useProgram(a);const d=e.getBindings();this._setupBindings(d,a),this.set(t,{programGPU:a})}createComputePipeline(e,t){const{state:n,gl:i}=this,s={stage:"fragment",code:`#version 300 es
precision highp float;
void main() {}`};this.createProgram(s);const{computeProgram:a}=e,l=i.createProgram(),c=this.get(s).shaderGPU,d=this.get(a).shaderGPU,m=a.transforms,y=[],v=[];for(let E=0;E<m.length;E++){const M=m[E];y.push(M.varyingName),v.push(M.attributeNode)}i.attachShader(l,c),i.attachShader(l,d),i.transformFeedbackVaryings(l,y,i.SEPARATE_ATTRIBS),i.linkProgram(l),i.getProgramParameter(l,i.LINK_STATUS)===!1&&this._logProgramError(l,c,d),n.useProgram(l),this._setupBindings(t,l);const x=a.attributes,S=[],A=[];for(let E=0;E<x.length;E++){const M=x[E].node.attribute;S.push(M),this.has(M)||this.attributeUtils.createAttribute(M,i.ARRAY_BUFFER)}for(let E=0;E<v.length;E++){const M=v[E].attribute;this.has(M)||this.attributeUtils.createAttribute(M,i.ARRAY_BUFFER);const C=this.get(M);A.push(C)}this.set(e,{programGPU:l,transformBuffers:A,attributes:S})}createBindings(e,t){if(this._knownBindings.has(t)===!1){this._knownBindings.add(t);let n=0,i=0;for(const s of t){this.set(s,{textures:i,uniformBuffers:n});for(const a of s.bindings)a.isUniformBuffer&&n++,a.isSampledTexture&&i++}}this.updateBindings(e,t)}updateBindings(e){const{gl:t}=this,n=this.get(e);let i=n.uniformBuffers,s=n.textures;for(const a of e.bindings)if(a.isUniformsGroup||a.isUniformBuffer){const l=a.buffer,c=t.createBuffer();t.bindBuffer(t.UNIFORM_BUFFER,c),t.bufferData(t.UNIFORM_BUFFER,l,t.DYNAMIC_DRAW),this.set(a,{index:i++,bufferGPU:c})}else if(a.isSampledTexture){const{textureGPU:l,glTextureType:c}=this.get(a.texture);this.set(a,{index:s++,textureGPU:l,glTextureType:c})}}updateBinding(e){const t=this.gl;if(e.isUniformsGroup||e.isUniformBuffer){const i=this.get(e).bufferGPU,s=e.buffer;t.bindBuffer(t.UNIFORM_BUFFER,i),t.bufferData(t.UNIFORM_BUFFER,s,t.DYNAMIC_DRAW)}}createIndexAttribute(e){const t=this.gl;this.attributeUtils.createAttribute(e,t.ELEMENT_ARRAY_BUFFER)}createAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}createStorageAttribute(e){if(this.has(e))return;const t=this.gl;this.attributeUtils.createAttribute(e,t.ARRAY_BUFFER)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}hasFeature(e){const t=Object.keys(W2).filter(i=>W2[i]===e),n=this.extensions;for(let i=0;i<t.length;i++)if(n.has(t[i]))return!0;return!1}getMaxAnisotropy(){return this.capabilities.getMaxAnisotropy()}copyTextureToTexture(e,t,n=null,i=null,s=0,a=0){this.textureUtils.copyTextureToTexture(e,t,n,i,s,a)}copyFramebufferToTexture(e,t,n){this.textureUtils.copyFramebufferToTexture(e,t,n)}_setFramebuffer(e){const{gl:t,state:n}=this;let i=null;if(e.textures!==null){const s=e.renderTarget,a=this.get(s),{samples:l,depthBuffer:c,stencilBuffer:d}=s,m=s.isWebGLCubeRenderTarget===!0,y=s.isRenderTarget3D===!0,v=s.isRenderTargetArray===!0,x=s.isXRRenderTarget===!0,S=x===!0&&s.hasExternalTextures===!0;let A=a.msaaFrameBuffer,E=a.depthRenderbuffer;const M=this.extensions.get("WEBGL_multisampled_render_to_texture"),C=this._useMultisampledRTT(s),w=BO(e);let D;if(m?(a.cubeFramebuffers||(a.cubeFramebuffers={}),D=a.cubeFramebuffers[w]):x&&S===!1?D=this._xrFramebuffer:(a.framebuffers||(a.framebuffers={}),D=a.framebuffers[w]),D===void 0){D=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,D);const z=e.textures;if(m){a.cubeFramebuffers[w]=D;const{textureGPU:B}=this.get(z[0]),F=this.renderer._activeCubeFace;t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_CUBE_MAP_POSITIVE_X+F,B,0)}else{a.framebuffers[w]=D;for(let B=0;B<z.length;B++){const F=z[B],H=this.get(F);H.renderTarget=e.renderTarget,H.cacheKey=w;const I=t.COLOR_ATTACHMENT0+B;if(y||v){const P=this.renderer._activeCubeFace;t.framebufferTextureLayer(t.FRAMEBUFFER,I,H.textureGPU,0,P)}else S&&C?M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,I,t.TEXTURE_2D,H.textureGPU,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,I,t.TEXTURE_2D,H.textureGPU,0)}n.drawBuffers(e,D)}if(s.isXRRenderTarget&&s.autoAllocateDepthBuffer===!0){const B=t.createRenderbuffer();this.textureUtils.setupRenderBufferStorage(B,e,0,C),a.xrDepthRenderbuffer=B}else if(e.depthTexture!==null){const B=this.get(e.depthTexture),F=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;B.renderTarget=e.renderTarget,B.cacheKey=w,S&&C?M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,F,t.TEXTURE_2D,B.textureGPU,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,F,t.TEXTURE_2D,B.textureGPU,0)}}else if(x&&S){n.bindFramebuffer(t.FRAMEBUFFER,D);const z=this.get(e.textures[0]);C?M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,z.textureGPU,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,z.textureGPU,0);const B=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;if(s.autoAllocateDepthBuffer===!0){const F=a.xrDepthRenderbuffer;t.bindRenderbuffer(t.RENDERBUFFER,F),t.framebufferRenderbuffer(t.FRAMEBUFFER,B,t.RENDERBUFFER,F)}else{const F=this.get(e.depthTexture);C?M.framebufferTexture2DMultisampleEXT(t.FRAMEBUFFER,B,t.TEXTURE_2D,F.textureGPU,0,l):t.framebufferTexture2D(t.FRAMEBUFFER,B,t.TEXTURE_2D,F.textureGPU,0)}}if(l>0&&C===!1){if(A===void 0){const z=[];A=t.createFramebuffer(),n.bindFramebuffer(t.FRAMEBUFFER,A);const B=[],F=e.textures;for(let H=0;H<F.length;H++){if(B[H]=t.createRenderbuffer(),t.bindRenderbuffer(t.RENDERBUFFER,B[H]),z.push(t.COLOR_ATTACHMENT0+H),c){const Z=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;z.push(Z)}const I=e.textures[H],P=this.get(I);t.renderbufferStorageMultisample(t.RENDERBUFFER,l,P.glInternalFormat,e.width,e.height),t.framebufferRenderbuffer(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0+H,t.RENDERBUFFER,B[H])}if(a.msaaFrameBuffer=A,a.msaaRenderbuffers=B,E===void 0){E=t.createRenderbuffer(),this.textureUtils.setupRenderBufferStorage(E,e,l),a.depthRenderbuffer=E;const H=d?t.DEPTH_STENCIL_ATTACHMENT:t.DEPTH_ATTACHMENT;z.push(H)}a.invalidationArray=z}i=a.msaaFrameBuffer}else i=D}n.bindFramebuffer(t.FRAMEBUFFER,i)}_getVaoKey(e){let t="";for(let n=0;n<e.length;n++){const i=this.get(e[n]);t+=":"+i.id}return t}_createVao(e){const{gl:t}=this,n=t.createVertexArray();let i="",s=!0;t.bindVertexArray(n);for(let a=0;a<e.length;a++){const l=e[a],c=this.get(l);i+=":"+c.id,t.bindBuffer(t.ARRAY_BUFFER,c.bufferGPU),t.enableVertexAttribArray(a),(l.isStorageBufferAttribute||l.isStorageInstancedBufferAttribute)&&(s=!1);let d,m;l.isInterleavedBufferAttribute===!0?(d=l.data.stride*c.bytesPerElement,m=l.offset*c.bytesPerElement):(d=0,m=0),c.isInteger?t.vertexAttribIPointer(a,l.itemSize,c.type,d,m):t.vertexAttribPointer(a,l.itemSize,c.type,l.normalized,d,m),l.isInstancedBufferAttribute&&!l.isInterleavedBufferAttribute?t.vertexAttribDivisor(a,l.meshPerAttribute):l.isInterleavedBufferAttribute&&l.data.isInstancedInterleavedBuffer&&t.vertexAttribDivisor(a,l.data.meshPerAttribute)}return t.bindBuffer(t.ARRAY_BUFFER,null),this.vaoCache[i]=n,{vaoGPU:n,staticVao:s}}_getTransformFeedback(e){let t="";for(let s=0;s<e.length;s++)t+=":"+e[s].id;let n=this.transformFeedbackCache[t];if(n!==void 0)return n;const{gl:i}=this;n=i.createTransformFeedback(),i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,n);for(let s=0;s<e.length;s++){const a=e[s];i.bindBufferBase(i.TRANSFORM_FEEDBACK_BUFFER,s,a.transformBuffer)}return i.bindTransformFeedback(i.TRANSFORM_FEEDBACK,null),this.transformFeedbackCache[t]=n,n}_setupBindings(e,t){const n=this.gl;for(const i of e)for(const s of i.bindings){const l=this.get(s).index;if(s.isUniformsGroup||s.isUniformBuffer){const c=n.getUniformBlockIndex(t,s.name);n.uniformBlockBinding(t,c,l)}else if(s.isSampledTexture){const c=n.getUniformLocation(t,s.name);n.uniform1i(c,l)}}}_bindUniforms(e){const{gl:t,state:n}=this;for(const i of e)for(const s of i.bindings){const a=this.get(s),l=a.index;s.isUniformsGroup||s.isUniformBuffer?n.bindBufferBase(t.UNIFORM_BUFFER,l,a.bufferGPU):s.isSampledTexture&&n.bindTexture(a.glTextureType,a.textureGPU,t.TEXTURE0+l)}}_useMultisampledRTT(e){return e.samples>0&&this.extensions.has("WEBGL_multisampled_render_to_texture")===!0&&e.autoAllocateDepthBuffer!==!1}dispose(){const e=this.extensions.get("WEBGL_lose_context");e&&e.loseContext(),this.renderer.domElement.removeEventListener("webglcontextlost",this._onContextLost)}}const pg={PointList:"point-list",LineList:"line-list",LineStrip:"line-strip",TriangleList:"triangle-list",TriangleStrip:"triangle-strip"},vr={Never:"never",Less:"less",Equal:"equal",LessEqual:"less-equal",Greater:"greater",NotEqual:"not-equal",GreaterEqual:"greater-equal",Always:"always"},sr={Store:"store"},Ui={Load:"load",Clear:"clear"},rA={CCW:"ccw"},aA={None:"none",Front:"front",Back:"back"},Xg={Uint16:"uint16",Uint32:"uint32"},ie={R8Unorm:"r8unorm",R8Snorm:"r8snorm",R8Uint:"r8uint",R8Sint:"r8sint",R16Uint:"r16uint",R16Sint:"r16sint",R16Float:"r16float",RG8Unorm:"rg8unorm",RG8Snorm:"rg8snorm",RG8Uint:"rg8uint",RG8Sint:"rg8sint",R32Uint:"r32uint",R32Sint:"r32sint",R32Float:"r32float",RG16Uint:"rg16uint",RG16Sint:"rg16sint",RG16Float:"rg16float",RGBA8Unorm:"rgba8unorm",RGBA8UnormSRGB:"rgba8unorm-srgb",RGBA8Snorm:"rgba8snorm",RGBA8Uint:"rgba8uint",RGBA8Sint:"rgba8sint",BGRA8Unorm:"bgra8unorm",BGRA8UnormSRGB:"bgra8unorm-srgb",RGB9E5UFloat:"rgb9e5ufloat",RGB10A2Unorm:"rgb10a2unorm",RG11B10UFloat:"rgb10a2unorm",RG32Uint:"rg32uint",RG32Sint:"rg32sint",RG32Float:"rg32float",RGBA16Uint:"rgba16uint",RGBA16Sint:"rgba16sint",RGBA16Float:"rgba16float",RGBA32Uint:"rgba32uint",RGBA32Sint:"rgba32sint",RGBA32Float:"rgba32float",Depth16Unorm:"depth16unorm",Depth24Plus:"depth24plus",Depth24PlusStencil8:"depth24plus-stencil8",Depth32Float:"depth32float",Depth32FloatStencil8:"depth32float-stencil8",BC1RGBAUnorm:"bc1-rgba-unorm",BC1RGBAUnormSRGB:"bc1-rgba-unorm-srgb",BC2RGBAUnorm:"bc2-rgba-unorm",BC2RGBAUnormSRGB:"bc2-rgba-unorm-srgb",BC3RGBAUnorm:"bc3-rgba-unorm",BC3RGBAUnormSRGB:"bc3-rgba-unorm-srgb",BC4RUnorm:"bc4-r-unorm",BC4RSnorm:"bc4-r-snorm",BC5RGUnorm:"bc5-rg-unorm",BC5RGSnorm:"bc5-rg-snorm",BC6HRGBUFloat:"bc6h-rgb-ufloat",BC6HRGBFloat:"bc6h-rgb-float",BC7RGBAUnorm:"bc7-rgba-unorm",BC7RGBAUnormSRGB:"bc7-rgba-srgb",ETC2RGB8Unorm:"etc2-rgb8unorm",ETC2RGB8UnormSRGB:"etc2-rgb8unorm-srgb",ETC2RGB8A1Unorm:"etc2-rgb8a1unorm",ETC2RGB8A1UnormSRGB:"etc2-rgb8a1unorm-srgb",ETC2RGBA8Unorm:"etc2-rgba8unorm",ETC2RGBA8UnormSRGB:"etc2-rgba8unorm-srgb",EACR11Unorm:"eac-r11unorm",EACR11Snorm:"eac-r11snorm",EACRG11Unorm:"eac-rg11unorm",EACRG11Snorm:"eac-rg11snorm",ASTC4x4Unorm:"astc-4x4-unorm",ASTC4x4UnormSRGB:"astc-4x4-unorm-srgb",ASTC5x4Unorm:"astc-5x4-unorm",ASTC5x4UnormSRGB:"astc-5x4-unorm-srgb",ASTC5x5Unorm:"astc-5x5-unorm",ASTC5x5UnormSRGB:"astc-5x5-unorm-srgb",ASTC6x5Unorm:"astc-6x5-unorm",ASTC6x5UnormSRGB:"astc-6x5-unorm-srgb",ASTC6x6Unorm:"astc-6x6-unorm",ASTC6x6UnormSRGB:"astc-6x6-unorm-srgb",ASTC8x5Unorm:"astc-8x5-unorm",ASTC8x5UnormSRGB:"astc-8x5-unorm-srgb",ASTC8x6Unorm:"astc-8x6-unorm",ASTC8x6UnormSRGB:"astc-8x6-unorm-srgb",ASTC8x8Unorm:"astc-8x8-unorm",ASTC8x8UnormSRGB:"astc-8x8-unorm-srgb",ASTC10x5Unorm:"astc-10x5-unorm",ASTC10x5UnormSRGB:"astc-10x5-unorm-srgb",ASTC10x6Unorm:"astc-10x6-unorm",ASTC10x6UnormSRGB:"astc-10x6-unorm-srgb",ASTC10x8Unorm:"astc-10x8-unorm",ASTC10x8UnormSRGB:"astc-10x8-unorm-srgb",ASTC10x10Unorm:"astc-10x10-unorm",ASTC10x10UnormSRGB:"astc-10x10-unorm-srgb",ASTC12x10Unorm:"astc-12x10-unorm",ASTC12x10UnormSRGB:"astc-12x10-unorm-srgb",ASTC12x12Unorm:"astc-12x12-unorm",ASTC12x12UnormSRGB:"astc-12x12-unorm-srgb"},oA={ClampToEdge:"clamp-to-edge",Repeat:"repeat",MirrorRepeat:"mirror-repeat"},Dd={Linear:"linear",Nearest:"nearest"},an={Zero:"zero",One:"one",Src:"src",OneMinusSrc:"one-minus-src",SrcAlpha:"src-alpha",OneMinusSrcAlpha:"one-minus-src-alpha",Dst:"dst",OneMinusDstColor:"one-minus-dst",DstAlpha:"dst-alpha",OneMinusDstAlpha:"one-minus-dst-alpha",SrcAlphaSaturated:"src-alpha-saturated",Constant:"constant",OneMinusConstant:"one-minus-constant"},Ed={Add:"add",Subtract:"subtract",ReverseSubtract:"reverse-subtract",Min:"min",Max:"max"},Y2={None:0,All:15},Wh={Keep:"keep",Zero:"zero",Replace:"replace",Invert:"invert",IncrementClamp:"increment-clamp",DecrementClamp:"decrement-clamp",IncrementWrap:"increment-wrap",DecrementWrap:"decrement-wrap"},lA={Storage:"storage",ReadOnlyStorage:"read-only-storage"},uA={WriteOnly:"write-only",ReadOnly:"read-only",ReadWrite:"read-write"},tg={Float:"float",UnfilterableFloat:"unfilterable-float",Depth:"depth",SInt:"sint",UInt:"uint"},j2={TwoD:"2d",ThreeD:"3d"},Pa={TwoD:"2d",TwoDArray:"2d-array",Cube:"cube",ThreeD:"3d"},H7={All:"all"},YS={Vertex:"vertex",Instance:"instance"},u1={DepthClipControl:"depth-clip-control",Depth32FloatStencil8:"depth32float-stencil8",TextureCompressionBC:"texture-compression-bc",TextureCompressionETC2:"texture-compression-etc2",TextureCompressionASTC:"texture-compression-astc",TimestampQuery:"timestamp-query",IndirectFirstInstance:"indirect-first-instance",ShaderF16:"shader-f16",RG11B10UFloat:"rg11b10ufloat-renderable",BGRA8UNormStorage:"bgra8unorm-storage",Float32Filterable:"float32-filterable",ClipDistances:"clip-distances",DualSourceBlending:"dual-source-blending",Subgroups:"subgroups"};class k7 extends ON{constructor(e,t){super(e),this.texture=t,this.version=t?t.version:0,this.isSampler=!0}}class q7 extends k7{constructor(e,t,n){super(e,t?t.value:null),this.textureNode=t,this.groupNode=n}update(){this.texture=this.textureNode.value}}class W7 extends OP{constructor(e,t){super(e,t?t.array:null),this.attribute=t,this.isStorageBuffer=!0}}let X7=0;class Y7 extends W7{constructor(e,t){super("StorageBuffer_"+X7++,e?e.value:null),this.nodeUniform=e,this.access=e?e.access:Vr.READ_WRITE,this.groupNode=t}get buffer(){return this.nodeUniform.value}}class j7 extends gf{constructor(e){super(),this.device=e;const t=`
struct VarysStruct {
	@builtin( position ) Position: vec4<f32>,
	@location( 0 ) vTex : vec2<f32>
};

@vertex
fn main( @builtin( vertex_index ) vertexIndex : u32 ) -> VarysStruct {

	var Varys : VarysStruct;

	var pos = array< vec2<f32>, 4 >(
		vec2<f32>( -1.0,  1.0 ),
		vec2<f32>(  1.0,  1.0 ),
		vec2<f32>( -1.0, -1.0 ),
		vec2<f32>(  1.0, -1.0 )
	);

	var tex = array< vec2<f32>, 4 >(
		vec2<f32>( 0.0, 0.0 ),
		vec2<f32>( 1.0, 0.0 ),
		vec2<f32>( 0.0, 1.0 ),
		vec2<f32>( 1.0, 1.0 )
	);

	Varys.vTex = tex[ vertexIndex ];
	Varys.Position = vec4<f32>( pos[ vertexIndex ], 0.0, 1.0 );

	return Varys;

}
`,n=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vTex );

}
`,i=`
@group( 0 ) @binding( 0 )
var imgSampler : sampler;

@group( 0 ) @binding( 1 )
var img : texture_2d<f32>;

@fragment
fn main( @location( 0 ) vTex : vec2<f32> ) -> @location( 0 ) vec4<f32> {

	return textureSample( img, imgSampler, vec2( vTex.x, 1.0 - vTex.y ) );

}
`;this.mipmapSampler=e.createSampler({minFilter:Dd.Linear}),this.flipYSampler=e.createSampler({minFilter:Dd.Nearest}),this.transferPipelines={},this.flipYPipelines={},this.mipmapVertexShaderModule=e.createShaderModule({label:"mipmapVertex",code:t}),this.mipmapFragmentShaderModule=e.createShaderModule({label:"mipmapFragment",code:n}),this.flipYFragmentShaderModule=e.createShaderModule({label:"flipYFragment",code:i})}getTransferPipeline(e){let t=this.transferPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`mipmap-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.mipmapFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:pg.TriangleStrip,stripIndexFormat:Xg.Uint32},layout:"auto"}),this.transferPipelines[e]=t),t}getFlipYPipeline(e){let t=this.flipYPipelines[e];return t===void 0&&(t=this.device.createRenderPipeline({label:`flipY-${e}`,vertex:{module:this.mipmapVertexShaderModule,entryPoint:"main"},fragment:{module:this.flipYFragmentShaderModule,entryPoint:"main",targets:[{format:e}]},primitive:{topology:pg.TriangleStrip,stripIndexFormat:Xg.Uint32},layout:"auto"}),this.flipYPipelines[e]=t),t}flipY(e,t,n=0){const i=t.format,{width:s,height:a}=t.size,l=this.getTransferPipeline(i),c=this.getFlipYPipeline(i),d=this.device.createTexture({size:{width:s,height:a,depthOrArrayLayers:1},format:i,usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.TEXTURE_BINDING}),m=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Pa.TwoD,baseArrayLayer:n}),y=d.createView({baseMipLevel:0,mipLevelCount:1,dimension:Pa.TwoD,baseArrayLayer:0}),v=this.device.createCommandEncoder({}),x=(S,A,E)=>{const M=S.getBindGroupLayout(0),C=this.device.createBindGroup({layout:M,entries:[{binding:0,resource:this.flipYSampler},{binding:1,resource:A}]}),w=v.beginRenderPass({colorAttachments:[{view:E,loadOp:Ui.Clear,storeOp:sr.Store,clearValue:[0,0,0,0]}]});w.setPipeline(S),w.setBindGroup(0,C),w.draw(4,1,0,0),w.end()};x(l,m,y),x(c,y,m),this.device.queue.submit([v.finish()]),d.destroy()}generateMipmaps(e,t,n=0){const i=this.get(e);i.useCount===void 0&&(i.useCount=0,i.layers=[]);const s=i.layers[n]||this._mipmapCreateBundles(e,t,n),a=this.device.createCommandEncoder({});this._mipmapRunBundles(a,s),this.device.queue.submit([a.finish()]),i.useCount!==0&&(i.layers[n]=s),i.useCount++}_mipmapCreateBundles(e,t,n){const i=this.getTransferPipeline(t.format),s=i.getBindGroupLayout(0);let a=e.createView({baseMipLevel:0,mipLevelCount:1,dimension:Pa.TwoD,baseArrayLayer:n});const l=[];for(let c=1;c<t.mipLevelCount;c++){const d=this.device.createBindGroup({layout:s,entries:[{binding:0,resource:this.mipmapSampler},{binding:1,resource:a}]}),m=e.createView({baseMipLevel:c,mipLevelCount:1,dimension:Pa.TwoD,baseArrayLayer:n}),y={colorAttachments:[{view:m,loadOp:Ui.Clear,storeOp:sr.Store,clearValue:[0,0,0,0]}]},v=this.device.createRenderBundleEncoder({colorFormats:[t.format]});v.setPipeline(i),v.setBindGroup(0,d),v.draw(4,1,0,0),l.push({renderBundles:[v.finish()],passDescriptor:y}),a=m}return l}_mipmapRunBundles(e,t){const n=t.length;for(let i=0;i<n;i++){const s=t[i],a=e.beginRenderPass(s.passDescriptor);a.executeBundles(s.renderBundles),a.end()}}}const Z7={[eT]:"never",[q_]:"less",[tT]:"equal",[W_]:"less-equal",[nT]:"greater",[sT]:"greater-equal",[rT]:"always",[iT]:"not-equal"},K7=[0,1,3,2,4,5];class Q7{constructor(e){this.backend=e,this._passUtils=null,this.defaultTexture={},this.defaultCubeTexture={},this.defaultVideoFrame=null,this.colorBuffer=null,this.depthTexture=new ya,this.depthTexture.name="depthBuffer"}createSampler(e){const t=this.backend,n=t.device,i=t.get(e),s={addressModeU:this._convertAddressMode(e.wrapS),addressModeV:this._convertAddressMode(e.wrapT),addressModeW:this._convertAddressMode(e.wrapR),magFilter:this._convertFilterMode(e.magFilter),minFilter:this._convertFilterMode(e.minFilter),mipmapFilter:this._convertFilterMode(e.minFilter),maxAnisotropy:1};s.magFilter===Dd.Linear&&s.minFilter===Dd.Linear&&s.mipmapFilter===Dd.Linear&&(s.maxAnisotropy=e.anisotropy),e.isDepthTexture&&e.compareFunction!==null&&(s.compare=Z7[e.compareFunction]),i.sampler=n.createSampler(s)}createDefaultTexture(e){let t;const n=c1(e);e.isCubeTexture?t=this._getDefaultCubeTextureGPU(n):e.isVideoTexture?this.backend.get(e).externalTexture=this._getDefaultVideoFrame():t=this._getDefaultTextureGPU(n),this.backend.get(e).texture=t}createTexture(e,t={}){const n=this.backend,i=n.get(e);if(i.initialized)throw new Error("WebGPUTextureUtils: Texture already initialized.");t.needsMipmaps===void 0&&(t.needsMipmaps=!1),t.levels===void 0&&(t.levels=1),t.depth===void 0&&(t.depth=1);const{width:s,height:a,depth:l,levels:c}=t;e.isFramebufferTexture&&(t.renderTarget?t.format=this.backend.utils.getCurrentColorFormat(t.renderTarget):t.format=this.backend.utils.getPreferredCanvasFormat());const d=this._getDimension(e),m=e.internalFormat||t.format||c1(e,n.device);i.format=m;const{samples:y,primarySamples:v,isMSAA:x}=n.utils.getTextureSampleData(e);let S=GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.COPY_SRC;e.isStorageTexture===!0&&(S|=GPUTextureUsage.STORAGE_BINDING),e.isCompressedTexture!==!0&&e.isCompressedArrayTexture!==!0&&(S|=GPUTextureUsage.RENDER_ATTACHMENT);const A={label:e.name,size:{width:s,height:a,depthOrArrayLayers:l},mipLevelCount:c,sampleCount:v,dimension:d,format:m,usage:S};if(e.isVideoTexture){const E=e.source.data,M=new VideoFrame(E);A.size.width=M.displayWidth,A.size.height=M.displayHeight,M.close(),i.externalTexture=E}else{if(m===void 0){console.warn("WebGPURenderer: Texture format not supported."),this.createDefaultTexture(e);return}i.texture=n.device.createTexture(A)}if(x){const E=Object.assign({},A);E.label=E.label+"-msaa",E.sampleCount=y,i.msaaTexture=n.device.createTexture(E)}i.initialized=!0,i.textureDescriptorGPU=A}destroyTexture(e){const t=this.backend,n=t.get(e);n.texture!==void 0&&n.texture.destroy(),n.msaaTexture!==void 0&&n.msaaTexture.destroy(),t.delete(e)}destroySampler(e){const n=this.backend.get(e);delete n.sampler}generateMipmaps(e){const t=this.backend.get(e);if(e.isCubeTexture)for(let n=0;n<6;n++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,n);else{const n=e.image.depth||1;for(let i=0;i<n;i++)this._generateMipmaps(t.texture,t.textureDescriptorGPU,i)}}getColorBuffer(){this.colorBuffer&&this.colorBuffer.destroy();const e=this.backend,{width:t,height:n}=e.getDrawingBufferSize();return this.colorBuffer=e.device.createTexture({label:"colorBuffer",size:{width:t,height:n,depthOrArrayLayers:1},sampleCount:e.utils.getSampleCount(e.renderer.samples),format:e.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC}),this.colorBuffer}getDepthBuffer(e=!0,t=!1){const n=this.backend,{width:i,height:s}=n.getDrawingBufferSize(),a=this.depthTexture,l=n.get(a).texture;let c,d;if(t?(c=qa,d=Ha):e&&(c=ka,d=di),l!==void 0){if(a.image.width===i&&a.image.height===s&&a.format===c&&a.type===d)return l;this.destroyTexture(a)}return a.name="depthBuffer",a.format=c,a.type=d,a.image.width=i,a.image.height=s,this.createTexture(a,{width:i,height:s}),n.get(a).texture}updateTexture(e,t){const n=this.backend.get(e),{textureDescriptorGPU:i}=n;if(!(e.isRenderTargetTexture||i===void 0)){if(e.isDataTexture)this._copyBufferToTexture(t.image,n.texture,i,0,e.flipY);else if(e.isDataArrayTexture||e.isData3DTexture)for(let s=0;s<t.image.depth;s++)this._copyBufferToTexture(t.image,n.texture,i,s,e.flipY,s);else if(e.isCompressedTexture||e.isCompressedArrayTexture)this._copyCompressedBufferToTexture(e.mipmaps,n.texture,i);else if(e.isCubeTexture)this._copyCubeMapToTexture(t.images,n.texture,i,e.flipY);else if(e.isVideoTexture){const s=e.source.data;n.externalTexture=s}else this._copyImageToTexture(t.image,n.texture,i,0,e.flipY);n.version=e.version,e.onUpdate&&e.onUpdate(e)}}async copyTextureToBuffer(e,t,n,i,s,a){const l=this.backend.device,c=this.backend.get(e),d=c.texture,m=c.textureDescriptorGPU.format,y=this._getBytesPerTexel(m);let v=i*y;v=Math.ceil(v/256)*256;const x=l.createBuffer({size:i*s*y,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),S=l.createCommandEncoder();S.copyTextureToBuffer({texture:d,origin:{x:t,y:n,z:a}},{buffer:x,bytesPerRow:v},{width:i,height:s});const A=this._getTypedArrayType(m);l.queue.submit([S.finish()]),await x.mapAsync(GPUMapMode.READ);const E=x.getMappedRange();return new A(E)}_isEnvironmentTexture(e){const t=e.mapping;return t===Pu||t===Iu||t===va||t===Wa}_getDefaultTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new Li;n.minFilter=Si,n.magFilter=Si,this.createTexture(n,{width:1,height:1,format:e}),this.defaultTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultCubeTextureGPU(e){let t=this.defaultTexture[e];if(t===void 0){const n=new _p;n.minFilter=Si,n.magFilter=Si,this.createTexture(n,{width:1,height:1,depth:6}),this.defaultCubeTexture[e]=t=n}return this.backend.get(t).texture}_getDefaultVideoFrame(){let e=this.defaultVideoFrame;if(e===null){const t={timestamp:0,codedWidth:1,codedHeight:1,format:"RGBA"};this.defaultVideoFrame=e=new VideoFrame(new Uint8Array([0,0,0,255]),t)}return e}_copyCubeMapToTexture(e,t,n,i){for(let s=0;s<6;s++){const a=e[s],l=i===!0?K7[s]:s;a.isDataTexture?this._copyBufferToTexture(a.image,t,n,l,i):this._copyImageToTexture(a,t,n,l,i)}}_copyImageToTexture(e,t,n,i,s){this.backend.device.queue.copyExternalImageToTexture({source:e,flipY:s},{texture:t,mipLevel:0,origin:{x:0,y:0,z:i}},{width:e.width,height:e.height,depthOrArrayLayers:1})}_getPassUtils(){let e=this._passUtils;return e===null&&(this._passUtils=e=new j7(this.backend.device)),e}_generateMipmaps(e,t,n=0){this._getPassUtils().generateMipmaps(e,t,n)}_flipY(e,t,n=0){this._getPassUtils().flipY(e,t,n)}_copyBufferToTexture(e,t,n,i,s,a=0){const l=this.backend.device,c=e.data,d=this._getBytesPerTexel(n.format),m=e.width*d;l.queue.writeTexture({texture:t,mipLevel:0,origin:{x:0,y:0,z:i}},c,{offset:e.width*e.height*d*a,bytesPerRow:m},{width:e.width,height:e.height,depthOrArrayLayers:1}),s===!0&&this._flipY(t,n,i)}_copyCompressedBufferToTexture(e,t,n){const i=this.backend.device,s=this._getBlockData(n.format),a=n.size.depthOrArrayLayers>1;for(let l=0;l<e.length;l++){const c=e[l],d=c.width,m=c.height,y=a?n.size.depthOrArrayLayers:1,v=Math.ceil(d/s.width)*s.byteLength,x=v*Math.ceil(m/s.height);for(let S=0;S<y;S++)i.queue.writeTexture({texture:t,mipLevel:l,origin:{x:0,y:0,z:S}},c.data,{offset:S*x,bytesPerRow:v,rowsPerImage:Math.ceil(m/s.height)},{width:Math.ceil(d/s.width)*s.width,height:Math.ceil(m/s.height)*s.height,depthOrArrayLayers:1})}}_getBlockData(e){if(e===ie.BC1RGBAUnorm||e===ie.BC1RGBAUnormSRGB)return{byteLength:8,width:4,height:4};if(e===ie.BC2RGBAUnorm||e===ie.BC2RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ie.BC3RGBAUnorm||e===ie.BC3RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ie.BC4RUnorm||e===ie.BC4RSnorm)return{byteLength:8,width:4,height:4};if(e===ie.BC5RGUnorm||e===ie.BC5RGSnorm)return{byteLength:16,width:4,height:4};if(e===ie.BC6HRGBUFloat||e===ie.BC6HRGBFloat)return{byteLength:16,width:4,height:4};if(e===ie.BC7RGBAUnorm||e===ie.BC7RGBAUnormSRGB)return{byteLength:16,width:4,height:4};if(e===ie.ETC2RGB8Unorm||e===ie.ETC2RGB8UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ie.ETC2RGB8A1Unorm||e===ie.ETC2RGB8A1UnormSRGB)return{byteLength:8,width:4,height:4};if(e===ie.ETC2RGBA8Unorm||e===ie.ETC2RGBA8UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ie.EACR11Unorm)return{byteLength:8,width:4,height:4};if(e===ie.EACR11Snorm)return{byteLength:8,width:4,height:4};if(e===ie.EACRG11Unorm)return{byteLength:16,width:4,height:4};if(e===ie.EACRG11Snorm)return{byteLength:16,width:4,height:4};if(e===ie.ASTC4x4Unorm||e===ie.ASTC4x4UnormSRGB)return{byteLength:16,width:4,height:4};if(e===ie.ASTC5x4Unorm||e===ie.ASTC5x4UnormSRGB)return{byteLength:16,width:5,height:4};if(e===ie.ASTC5x5Unorm||e===ie.ASTC5x5UnormSRGB)return{byteLength:16,width:5,height:5};if(e===ie.ASTC6x5Unorm||e===ie.ASTC6x5UnormSRGB)return{byteLength:16,width:6,height:5};if(e===ie.ASTC6x6Unorm||e===ie.ASTC6x6UnormSRGB)return{byteLength:16,width:6,height:6};if(e===ie.ASTC8x5Unorm||e===ie.ASTC8x5UnormSRGB)return{byteLength:16,width:8,height:5};if(e===ie.ASTC8x6Unorm||e===ie.ASTC8x6UnormSRGB)return{byteLength:16,width:8,height:6};if(e===ie.ASTC8x8Unorm||e===ie.ASTC8x8UnormSRGB)return{byteLength:16,width:8,height:8};if(e===ie.ASTC10x5Unorm||e===ie.ASTC10x5UnormSRGB)return{byteLength:16,width:10,height:5};if(e===ie.ASTC10x6Unorm||e===ie.ASTC10x6UnormSRGB)return{byteLength:16,width:10,height:6};if(e===ie.ASTC10x8Unorm||e===ie.ASTC10x8UnormSRGB)return{byteLength:16,width:10,height:8};if(e===ie.ASTC10x10Unorm||e===ie.ASTC10x10UnormSRGB)return{byteLength:16,width:10,height:10};if(e===ie.ASTC12x10Unorm||e===ie.ASTC12x10UnormSRGB)return{byteLength:16,width:12,height:10};if(e===ie.ASTC12x12Unorm||e===ie.ASTC12x12UnormSRGB)return{byteLength:16,width:12,height:12}}_convertAddressMode(e){let t=oA.ClampToEdge;return e===zl?t=oA.Repeat:e===Fc&&(t=oA.MirrorRepeat),t}_convertFilterMode(e){let t=Dd.Linear;return(e===Si||e===V_||e===Ol)&&(t=Dd.Nearest),t}_getBytesPerTexel(e){if(e===ie.R8Unorm||e===ie.R8Snorm||e===ie.R8Uint||e===ie.R8Sint)return 1;if(e===ie.R16Uint||e===ie.R16Sint||e===ie.R16Float||e===ie.RG8Unorm||e===ie.RG8Snorm||e===ie.RG8Uint||e===ie.RG8Sint)return 2;if(e===ie.R32Uint||e===ie.R32Sint||e===ie.R32Float||e===ie.RG16Uint||e===ie.RG16Sint||e===ie.RG16Float||e===ie.RGBA8Unorm||e===ie.RGBA8UnormSRGB||e===ie.RGBA8Snorm||e===ie.RGBA8Uint||e===ie.RGBA8Sint||e===ie.BGRA8Unorm||e===ie.BGRA8UnormSRGB||e===ie.RGB9E5UFloat||e===ie.RGB10A2Unorm||e===ie.RG11B10UFloat||e===ie.Depth32Float||e===ie.Depth24Plus||e===ie.Depth24PlusStencil8||e===ie.Depth32FloatStencil8)return 4;if(e===ie.RG32Uint||e===ie.RG32Sint||e===ie.RG32Float||e===ie.RGBA16Uint||e===ie.RGBA16Sint||e===ie.RGBA16Float)return 8;if(e===ie.RGBA32Uint||e===ie.RGBA32Sint||e===ie.RGBA32Float)return 16}_getTypedArrayType(e){if(e===ie.R8Uint)return Uint8Array;if(e===ie.R8Sint)return Int8Array;if(e===ie.R8Unorm)return Uint8Array;if(e===ie.R8Snorm)return Int8Array;if(e===ie.RG8Uint)return Uint8Array;if(e===ie.RG8Sint)return Int8Array;if(e===ie.RG8Unorm)return Uint8Array;if(e===ie.RG8Snorm)return Int8Array;if(e===ie.RGBA8Uint)return Uint8Array;if(e===ie.RGBA8Sint)return Int8Array;if(e===ie.RGBA8Unorm)return Uint8Array;if(e===ie.RGBA8Snorm)return Int8Array;if(e===ie.R16Uint)return Uint16Array;if(e===ie.R16Sint)return Int16Array;if(e===ie.RG16Uint)return Uint16Array;if(e===ie.RG16Sint)return Int16Array;if(e===ie.RGBA16Uint)return Uint16Array;if(e===ie.RGBA16Sint)return Int16Array;if(e===ie.R16Float||e===ie.RG16Float||e===ie.RGBA16Float)return Uint16Array;if(e===ie.R32Uint)return Uint32Array;if(e===ie.R32Sint)return Int32Array;if(e===ie.R32Float)return Float32Array;if(e===ie.RG32Uint)return Uint32Array;if(e===ie.RG32Sint)return Int32Array;if(e===ie.RG32Float)return Float32Array;if(e===ie.RGBA32Uint)return Uint32Array;if(e===ie.RGBA32Sint)return Int32Array;if(e===ie.RGBA32Float)return Float32Array;if(e===ie.BGRA8Unorm||e===ie.BGRA8UnormSRGB)return Uint8Array;if(e===ie.RGB10A2Unorm||e===ie.RGB9E5UFloat||e===ie.RG11B10UFloat)return Uint32Array;if(e===ie.Depth32Float)return Float32Array;if(e===ie.Depth24Plus||e===ie.Depth24PlusStencil8)return Uint32Array;if(e===ie.Depth32FloatStencil8)return Float32Array}_getDimension(e){let t;return e.isData3DTexture?t=j2.ThreeD:t=j2.TwoD,t}}function c1(r,e=null){const t=r.format,n=r.type,i=r.colorSpace;let s;if(r.isCompressedTexture===!0||r.isCompressedArrayTexture===!0)switch(t){case wc:s=i===wt?ie.BC1RGBAUnormSRGB:ie.BC1RGBAUnorm;break;case Dc:s=i===wt?ie.BC2RGBAUnormSRGB:ie.BC2RGBAUnorm;break;case Uc:s=i===wt?ie.BC3RGBAUnormSRGB:ie.BC3RGBAUnorm;break;case Kd:s=i===wt?ie.ETC2RGB8UnormSRGB:ie.ETC2RGB8Unorm;break;case Qd:s=i===wt?ie.ETC2RGBA8UnormSRGB:ie.ETC2RGBA8Unorm;break;case Jd:s=i===wt?ie.ASTC4x4UnormSRGB:ie.ASTC4x4Unorm;break;case $d:s=i===wt?ie.ASTC5x4UnormSRGB:ie.ASTC5x4Unorm;break;case ep:s=i===wt?ie.ASTC5x5UnormSRGB:ie.ASTC5x5Unorm;break;case tp:s=i===wt?ie.ASTC6x5UnormSRGB:ie.ASTC6x5Unorm;break;case np:s=i===wt?ie.ASTC6x6UnormSRGB:ie.ASTC6x6Unorm;break;case ip:s=i===wt?ie.ASTC8x5UnormSRGB:ie.ASTC8x5Unorm;break;case sp:s=i===wt?ie.ASTC8x6UnormSRGB:ie.ASTC8x6Unorm;break;case rp:s=i===wt?ie.ASTC8x8UnormSRGB:ie.ASTC8x8Unorm;break;case ap:s=i===wt?ie.ASTC10x5UnormSRGB:ie.ASTC10x5Unorm;break;case op:s=i===wt?ie.ASTC10x6UnormSRGB:ie.ASTC10x6Unorm;break;case lp:s=i===wt?ie.ASTC10x8UnormSRGB:ie.ASTC10x8Unorm;break;case up:s=i===wt?ie.ASTC10x10UnormSRGB:ie.ASTC10x10Unorm;break;case cp:s=i===wt?ie.ASTC12x10UnormSRGB:ie.ASTC12x10Unorm;break;case hp:s=i===wt?ie.ASTC12x12UnormSRGB:ie.ASTC12x12Unorm;break;case Ni:s=i===wt?ie.RGBA8UnormSRGB:ie.RGBA8Unorm;break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}else switch(t){case Ni:switch(n){case tf:s=ie.RGBA8Snorm;break;case nf:s=ie.RGBA16Sint;break;case jo:s=ie.RGBA16Uint;break;case di:s=ie.RGBA32Uint;break;case Xs:s=ie.RGBA32Sint;break;case Xi:s=i===wt?ie.RGBA8UnormSRGB:ie.RGBA8Unorm;break;case Ys:s=ie.RGBA16Float;break;case Ri:s=ie.RGBA32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAFormat.",n)}break;case Qg:switch(n){case k_:s=ie.RGB9E5UFloat;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBFormat.",n)}break;case gp:switch(n){case tf:s=ie.R8Snorm;break;case nf:s=ie.R16Sint;break;case jo:s=ie.R16Uint;break;case di:s=ie.R32Uint;break;case Xs:s=ie.R32Sint;break;case Xi:s=ie.R8Unorm;break;case Ys:s=ie.R16Float;break;case Ri:s=ie.R32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RedFormat.",n)}break;case lf:switch(n){case tf:s=ie.RG8Snorm;break;case nf:s=ie.RG16Sint;break;case jo:s=ie.RG16Uint;break;case di:s=ie.RG32Uint;break;case Xs:s=ie.RG32Sint;break;case Xi:s=ie.RG8Unorm;break;case Ys:s=ie.RG16Float;break;case Ri:s=ie.RG32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with RGFormat.",n)}break;case ka:switch(n){case jo:s=ie.Depth16Unorm;break;case di:s=ie.Depth24Plus;break;case Ri:s=ie.Depth32Float;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthFormat.",n)}break;case qa:switch(n){case Ha:s=ie.Depth24PlusStencil8;break;case Ri:e&&e.features.has(u1.Depth32FloatStencil8)===!1&&console.error('WebGPURenderer: Depth textures with DepthStencilFormat + FloatType can only be used with the "depth32float-stencil8" GPU feature.'),s=ie.Depth32FloatStencil8;break;default:console.error("WebGPURenderer: Unsupported texture type with DepthStencilFormat.",n)}break;case ff:switch(n){case Xs:s=ie.R32Sint;break;case di:s=ie.R32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RedIntegerFormat.",n)}break;case yp:switch(n){case Xs:s=ie.RG32Sint;break;case di:s=ie.RG32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGIntegerFormat.",n)}break;case vp:switch(n){case Xs:s=ie.RGBA32Sint;break;case di:s=ie.RGBA32Uint;break;default:console.error("WebGPURenderer: Unsupported texture type with RGBAIntegerFormat.",n)}break;default:console.error("WebGPURenderer: Unsupported texture format.",t)}return s}const J7=/^[fn]*\s*([a-z_0-9]+)?\s*\(([\s\S]*?)\)\s*[\-\>]*\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/i,$7=/([a-z_0-9]+)\s*:\s*([a-z_0-9]+(?:<[\s\S]+?>)?)/ig,Z2={f32:"float",i32:"int",u32:"uint",bool:"bool","vec2<f32>":"vec2","vec2<i32>":"ivec2","vec2<u32>":"uvec2","vec2<bool>":"bvec2",vec2f:"vec2",vec2i:"ivec2",vec2u:"uvec2",vec2b:"bvec2","vec3<f32>":"vec3","vec3<i32>":"ivec3","vec3<u32>":"uvec3","vec3<bool>":"bvec3",vec3f:"vec3",vec3i:"ivec3",vec3u:"uvec3",vec3b:"bvec3","vec4<f32>":"vec4","vec4<i32>":"ivec4","vec4<u32>":"uvec4","vec4<bool>":"bvec4",vec4f:"vec4",vec4i:"ivec4",vec4u:"uvec4",vec4b:"bvec4","mat2x2<f32>":"mat2",mat2x2f:"mat2","mat3x3<f32>":"mat3",mat3x3f:"mat3","mat4x4<f32>":"mat4",mat4x4f:"mat4",sampler:"sampler",texture_1d:"texture",texture_2d:"texture",texture_2d_array:"texture",texture_multisampled_2d:"cubeTexture",texture_depth_2d:"depthTexture",texture_depth_multisampled_2d:"depthTexture",texture_3d:"texture3D",texture_cube:"cubeTexture",texture_cube_array:"cubeTexture",texture_storage_1d:"storageTexture",texture_storage_2d:"storageTexture",texture_storage_2d_array:"storageTexture",texture_storage_3d:"storageTexture"},eW=r=>{r=r.trim();const e=r.match(J7);if(e!==null&&e.length===4){const t=e[2],n=[];let i=null;for(;(i=$7.exec(t))!==null;)n.push({name:i[1],type:i[2]});const s=[];for(let m=0;m<n.length;m++){const{name:y,type:v}=n[m];let x=v;x.startsWith("ptr")?x="pointer":(x.startsWith("texture")&&(x=v.split("<")[0]),x=Z2[x]),s.push(new LN(x,y))}const a=r.substring(e[0].length),l=e[3]||"void",c=e[1]!==void 0?e[1]:"";return{type:Z2[l]||l,inputs:s,name:c,inputsCode:t,blockCode:a,outputType:l}}else throw new Error("FunctionNode: Function is not a WGSL code.")};class tW extends BN{constructor(e){const{type:t,inputs:n,name:i,inputsCode:s,blockCode:a,outputType:l}=eW(e);super(t,n,i),this.inputsCode=s,this.blockCode=a,this.outputType=l}getCode(e=this.name){const t=this.outputType!=="void"?"-> "+this.outputType:"";return`fn ${e} ( ${this.inputsCode.trim()} ) ${t}`+this.blockCode}}class nW extends LP{parseFunction(e){return new tW(e)}}const ng=typeof self<"u"?self.GPUShaderStage:{VERTEX:1,FRAGMENT:2,COMPUTE:4},iW={[Vr.READ_ONLY]:"read",[Vr.WRITE_ONLY]:"write",[Vr.READ_WRITE]:"read_write"},K2={[zl]:"repeat",[da]:"clamp",[Fc]:"mirror"},jS={vertex:ng?ng.VERTEX:1,fragment:ng?ng.FRAGMENT:2,compute:ng?ng.COMPUTE:4},Q2={instance:!0,swizzleAssign:!1,storageBuffer:!0},sW={"^^":"tsl_xor"},rW={float:"f32",int:"i32",uint:"u32",bool:"bool",color:"vec3<f32>",vec2:"vec2<f32>",ivec2:"vec2<i32>",uvec2:"vec2<u32>",bvec2:"vec2<bool>",vec3:"vec3<f32>",ivec3:"vec3<i32>",uvec3:"vec3<u32>",bvec3:"vec3<bool>",vec4:"vec4<f32>",ivec4:"vec4<i32>",uvec4:"vec4<u32>",bvec4:"vec4<bool>",mat2:"mat2x2<f32>",mat3:"mat3x3<f32>",mat4:"mat4x4<f32>"},J2={},Yo={tsl_xor:new Us("fn tsl_xor( a : bool, b : bool ) -> bool { return ( a || b ) && !( a && b ); }"),mod_float:new Us("fn tsl_mod_float( x : f32, y : f32 ) -> f32 { return x - y * floor( x / y ); }"),mod_vec2:new Us("fn tsl_mod_vec2( x : vec2f, y : vec2f ) -> vec2f { return x - y * floor( x / y ); }"),mod_vec3:new Us("fn tsl_mod_vec3( x : vec3f, y : vec3f ) -> vec3f { return x - y * floor( x / y ); }"),mod_vec4:new Us("fn tsl_mod_vec4( x : vec4f, y : vec4f ) -> vec4f { return x - y * floor( x / y ); }"),equals_bool:new Us("fn tsl_equals_bool( a : bool, b : bool ) -> bool { return a == b; }"),equals_bvec2:new Us("fn tsl_equals_bvec2( a : vec2f, b : vec2f ) -> vec2<bool> { return vec2<bool>( a.x == b.x, a.y == b.y ); }"),equals_bvec3:new Us("fn tsl_equals_bvec3( a : vec3f, b : vec3f ) -> vec3<bool> { return vec3<bool>( a.x == b.x, a.y == b.y, a.z == b.z ); }"),equals_bvec4:new Us("fn tsl_equals_bvec4( a : vec4f, b : vec4f ) -> vec4<bool> { return vec4<bool>( a.x == b.x, a.y == b.y, a.z == b.z, a.w == b.w ); }"),repeatWrapping_float:new Us("fn tsl_repeatWrapping_float( coord: f32 ) -> f32 { return fract( coord ); }"),mirrorWrapping_float:new Us("fn tsl_mirrorWrapping_float( coord: f32 ) -> f32 { let mirrored = fract( coord * 0.5 ) * 2.0; return 1.0 - abs( 1.0 - mirrored ); }"),clampWrapping_float:new Us("fn tsl_clampWrapping_float( coord: f32 ) -> f32 { return clamp( coord, 0.0, 1.0 ); }"),biquadraticTexture:new Us(`
fn tsl_biquadraticTexture( map : texture_2d<f32>, coord : vec2f, iRes : vec2u, level : u32 ) -> vec4f {

	let res = vec2f( iRes );

	let uvScaled = coord * res;
	let uvWrapping = ( ( uvScaled % res ) + res ) % res;

	// https://www.shadertoy.com/view/WtyXRy

	let uv = uvWrapping - 0.5;
	let iuv = floor( uv );
	let f = fract( uv );

	let rg1 = textureLoad( map, vec2u( iuv + vec2( 0.5, 0.5 ) ) % iRes, level );
	let rg2 = textureLoad( map, vec2u( iuv + vec2( 1.5, 0.5 ) ) % iRes, level );
	let rg3 = textureLoad( map, vec2u( iuv + vec2( 0.5, 1.5 ) ) % iRes, level );
	let rg4 = textureLoad( map, vec2u( iuv + vec2( 1.5, 1.5 ) ) % iRes, level );

	return mix( mix( rg1, rg2, f.x ), mix( rg3, rg4, f.x ), f.y );

}
`)},$v={dFdx:"dpdx",dFdy:"- dpdy",mod_float:"tsl_mod_float",mod_vec2:"tsl_mod_vec2",mod_vec3:"tsl_mod_vec3",mod_vec4:"tsl_mod_vec4",equals_bool:"tsl_equals_bool",equals_bvec2:"tsl_equals_bvec2",equals_bvec3:"tsl_equals_bvec3",equals_bvec4:"tsl_equals_bvec4",inversesqrt:"inverseSqrt",bitcast:"bitcast<f32>"};typeof navigator<"u"&&/Windows/g.test(navigator.userAgent)&&(Yo.pow_float=new Us("fn tsl_pow_float( a : f32, b : f32 ) -> f32 { return select( -pow( -a, b ), pow( a, b ), a > 0.0 ); }"),Yo.pow_vec2=new Us("fn tsl_pow_vec2( a : vec2f, b : vec2f ) -> vec2f { return vec2f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ) ); }",[Yo.pow_float]),Yo.pow_vec3=new Us("fn tsl_pow_vec3( a : vec3f, b : vec3f ) -> vec3f { return vec3f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ) ); }",[Yo.pow_float]),Yo.pow_vec4=new Us("fn tsl_pow_vec4( a : vec4f, b : vec4f ) -> vec4f { return vec4f( tsl_pow_float( a.x, b.x ), tsl_pow_float( a.y, b.y ), tsl_pow_float( a.z, b.z ), tsl_pow_float( a.w, b.w ) ); }",[Yo.pow_float]),$v.pow_float="tsl_pow_float",$v.pow_vec2="tsl_pow_vec2",$v.pow_vec3="tsl_pow_vec3",$v.pow_vec4="tsl_pow_vec4");let kP="";(typeof navigator<"u"&&/Firefox|Deno/g.test(navigator.userAgent))!==!0&&(kP+=`diagnostic( off, derivative_uniformity );
`);class aW extends DP{constructor(e,t){super(e,t,new nW),this.uniformGroups={},this.builtins={},this.directives={},this.scopedArrays=new Map}needsToWorkingColorSpace(e){return e.isVideoTexture===!0&&e.colorSpace!==Ia}_generateTextureSample(e,t,n,i,s=this.shaderStage){return s==="fragment"?i?`textureSample( ${t}, ${t}_sampler, ${n}, ${i} )`:`textureSample( ${t}, ${t}_sampler, ${n} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n):this.generateTextureLod(e,t,n,i,"0")}_generateVideoSample(e,t,n=this.shaderStage){if(n==="fragment")return`textureSampleBaseClampToEdge( ${e}, ${e}_sampler, vec2<f32>( ${t}.x, 1.0 - ${t}.y ) )`;console.error(`WebGPURenderer: THREE.VideoTexture does not support ${n} shader.`)}_generateTextureSampleLevel(e,t,n,i,s,a=this.shaderStage){return(a==="fragment"||a==="compute")&&this.isUnfilterable(e)===!1?`textureSampleLevel( ${t}, ${t}_sampler, ${n}, ${i} )`:this.isFilteredTexture(e)?this.generateFilteredTexture(e,t,n,i):this.generateTextureLod(e,t,n,s,i)}generateWrapFunction(e){const t=`tsl_coord_${K2[e.wrapS]}S_${K2[e.wrapT]}_${e.isData3DTexture?"3d":"2d"}T`;let n=J2[t];if(n===void 0){const i=[],s=e.isData3DTexture?"vec3f":"vec2f";let a=`fn ${t}( coord : ${s} ) -> ${s} {

	return ${s}(
`;const l=(c,d)=>{c===zl?(i.push(Yo.repeatWrapping_float),a+=`		tsl_repeatWrapping_float( coord.${d} )`):c===da?(i.push(Yo.clampWrapping_float),a+=`		tsl_clampWrapping_float( coord.${d} )`):c===Fc?(i.push(Yo.mirrorWrapping_float),a+=`		tsl_mirrorWrapping_float( coord.${d} )`):(a+=`		coord.${d}`,console.warn(`WebGPURenderer: Unsupported texture wrap type "${c}" for vertex shader.`))};l(e.wrapS,"x"),a+=`,
`,l(e.wrapT,"y"),e.isData3DTexture&&(a+=`,
`,l(e.wrapR,"z")),a+=`
	);

}
`,J2[t]=n=new Us(a,i)}return n.build(this),t}generateArrayDeclaration(e,t){return`array< ${this.getType(e)}, ${t} >`}generateTextureDimension(e,t,n){const i=this.getDataFromNode(e,this.shaderStage,this.globalCache);i.dimensionsSnippet===void 0&&(i.dimensionsSnippet={});let s=i.dimensionsSnippet[n];if(i.dimensionsSnippet[n]===void 0){let a,l;const{primarySamples:c}=this.renderer.backend.utils.getTextureSampleData(e),d=c>1;e.isData3DTexture?l="vec3<u32>":l="vec2<u32>",d||e.isVideoTexture||e.isStorageTexture?a=t:a=`${t}${n?`, u32( ${n} )`:""}`,s=new nb(new ib(`textureDimensions( ${a} )`,l)),i.dimensionsSnippet[n]=s,(e.isDataArrayTexture||e.isData3DTexture)&&(i.arrayLayerCount=new nb(new ib(`textureNumLayers(${t})`,"u32"))),e.isTextureCube&&(i.cubeFaceCount=new nb(new ib("6u","u32")))}return s.build(this)}generateFilteredTexture(e,t,n,i="0u"){this._include("biquadraticTexture");const s=this.generateWrapFunction(e),a=this.generateTextureDimension(e,t,i);return`tsl_biquadraticTexture( ${t}, ${s}( ${n} ), ${a}, u32( ${i} ) )`}generateTextureLod(e,t,n,i,s="0u"){const a=this.generateWrapFunction(e),l=this.generateTextureDimension(e,t,s),c=e.isData3DTexture?"vec3":"vec2",d=`${c}<u32>(${a}(${n}) * ${c}<f32>(${l}))`;return this.generateTextureLoad(e,t,d,i,s)}generateTextureLoad(e,t,n,i,s="0u"){return e.isVideoTexture===!0||e.isStorageTexture===!0?`textureLoad( ${t}, ${n} )`:i?`textureLoad( ${t}, ${n}, ${i}, u32( ${s} ) )`:`textureLoad( ${t}, ${n}, u32( ${s} ) )`}generateTextureStore(e,t,n,i){return`textureStore( ${t}, ${n}, ${i} )`}isSampleCompare(e){return e.isDepthTexture===!0&&e.compareFunction!==null}isUnfilterable(e){return this.getComponentTypeFromTexture(e)!=="float"||!this.isAvailable("float32Filterable")&&e.isDataTexture===!0&&e.type===Ri||this.isSampleCompare(e)===!1&&e.minFilter===Si&&e.magFilter===Si||this.renderer.backend.utils.getTextureSampleData(e).primarySamples>1}generateTexture(e,t,n,i,s=this.shaderStage){let a=null;return e.isVideoTexture===!0?a=this._generateVideoSample(t,n,s):this.isUnfilterable(e)?a=this.generateTextureLod(e,t,n,i,"0",s):a=this._generateTextureSample(e,t,n,i,s),a}generateTextureGrad(e,t,n,i,s,a=this.shaderStage){if(a==="fragment")return`textureSampleGrad( ${t}, ${t}_sampler, ${n},  ${i[0]}, ${i[1]} )`;console.error(`WebGPURenderer: THREE.TextureNode.gradient() does not support ${a} shader.`)}generateTextureCompare(e,t,n,i,s,a=this.shaderStage){if(a==="fragment")return`textureSampleCompare( ${t}, ${t}_sampler, ${n}, ${i} )`;console.error(`WebGPURenderer: THREE.DepthTexture.compareFunction() does not support ${a} shader.`)}generateTextureLevel(e,t,n,i,s,a=this.shaderStage){let l=null;return e.isVideoTexture===!0?l=this._generateVideoSample(t,n,a):l=this._generateTextureSampleLevel(e,t,n,i,s,a),l}generateTextureBias(e,t,n,i,s,a=this.shaderStage){if(a==="fragment")return`textureSampleBias( ${t}, ${t}_sampler, ${n}, ${i} )`;console.error(`WebGPURenderer: THREE.TextureNode.biasNode does not support ${a} shader.`)}getPropertyName(e,t=this.shaderStage){if(e.isNodeVarying===!0&&e.needsInterpolation===!0){if(t==="vertex")return`varyings.${e.name}`}else if(e.isNodeUniform===!0){const n=e.name,i=e.type;return i==="texture"||i==="cubeTexture"||i==="storageTexture"||i==="texture3D"?n:i==="buffer"||i==="storageBuffer"||i==="indirectStorageBuffer"?this.isCustomStruct(e)?n:n+".value":e.groupNode.name+"."+n}return super.getPropertyName(e)}getOutputStructName(){return"output"}getFunctionOperator(e){const t=sW[e];return t!==void 0?(this._include(t),t):null}getNodeAccess(e,t){return t!=="compute"?Vr.READ_ONLY:e.access}getStorageAccess(e,t){return iW[this.getNodeAccess(e,t)]}getUniformFromNode(e,t,n,i=null){const s=super.getUniformFromNode(e,t,n,i),a=this.getDataFromNode(e,n,this.globalCache);if(a.uniformGPU===void 0){let l;const c=e.groupNode,d=c.name,m=this.getBindGroupArray(d,n);if(t==="texture"||t==="cubeTexture"||t==="storageTexture"||t==="texture3D"){let y=null;const v=this.getNodeAccess(e,n);if(t==="texture"||t==="storageTexture"?y=new nM(s.name,s.node,c,v):t==="cubeTexture"?y=new zP(s.name,s.node,c,v):t==="texture3D"&&(y=new VP(s.name,s.node,c,v)),y.store=e.isStorageTextureNode===!0,y.setVisibility(jS[n]),(n==="fragment"||n==="compute")&&this.isUnfilterable(e.value)===!1&&y.store===!1){const x=new q7(`${s.name}_sampler`,s.node,c);x.setVisibility(jS[n]),m.push(x,y),l=[x,y]}else m.push(y),l=[y]}else if(t==="buffer"||t==="storageBuffer"||t==="indirectStorageBuffer"){const y=t==="buffer"?IP:Y7,v=new y(e,c);v.setVisibility(jS[n]),m.push(v),l=v,s.name=i||"NodeBuffer_"+s.id}else{const y=this.uniformGroups[n]||(this.uniformGroups[n]={});let v=y[d];v===void 0&&(v=new FP(d,c),v.setVisibility(jS[n]),y[d]=v,m.push(v)),l=this.getNodeUniform(s,t),v.addUniform(l)}a.uniformGPU=l}return s}getBuiltin(e,t,n,i=this.shaderStage){const s=this.builtins[i]||(this.builtins[i]=new Map);return s.has(e)===!1&&s.set(e,{name:e,property:t,type:n}),t}hasBuiltin(e,t=this.shaderStage){return this.builtins[t]!==void 0&&this.builtins[t].has(e)}getVertexIndex(){return this.shaderStage==="vertex"?this.getBuiltin("vertex_index","vertexIndex","u32","attribute"):"vertexIndex"}buildFunctionCode(e){const t=e.layout,n=this.flowShaderNode(e),i=[];for(const a of t.inputs)i.push(a.name+" : "+this.getType(a.type));let s=`fn ${t.name}( ${i.join(", ")} ) -> ${this.getType(t.type)} {
${n.vars}
${n.code}
`;return n.result&&(s+=`	return ${n.result};
`),s+=`
}
`,s}getInstanceIndex(){return this.shaderStage==="vertex"?this.getBuiltin("instance_index","instanceIndex","u32","attribute"):"instanceIndex"}getInvocationLocalIndex(){return this.getBuiltin("local_invocation_index","invocationLocalIndex","u32","attribute")}getSubgroupSize(){return this.enableSubGroups(),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute")}getInvocationSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_invocation_id","invocationSubgroupIndex","u32","attribute")}getSubgroupIndex(){return this.enableSubGroups(),this.getBuiltin("subgroup_id","subgroupIndex","u32","attribute")}getDrawIndex(){return null}getFrontFacing(){return this.getBuiltin("front_facing","isFront","bool")}getFragCoord(){return this.getBuiltin("position","fragCoord","vec4<f32>")+".xy"}getFragDepth(){return"output."+this.getBuiltin("frag_depth","depth","f32","output")}getClipDistance(){return"varyings.hw_clip_distances"}isFlipY(){return!1}enableDirective(e,t=this.shaderStage){(this.directives[t]||(this.directives[t]=new Set)).add(e)}getDirectives(e){const t=[],n=this.directives[e];if(n!==void 0)for(const i of n)t.push(`enable ${i};`);return t.join(`
`)}enableSubGroups(){this.enableDirective("subgroups")}enableSubgroupsF16(){this.enableDirective("subgroups-f16")}enableClipDistances(){this.enableDirective("clip_distances")}enableShaderF16(){this.enableDirective("f16")}enableDualSourceBlending(){this.enableDirective("dual_source_blending")}enableHardwareClipping(e){this.enableClipDistances(),this.getBuiltin("clip_distances","hw_clip_distances",`array<f32, ${e} >`,"vertex")}getBuiltins(e){const t=[],n=this.builtins[e];if(n!==void 0)for(const{name:i,property:s,type:a}of n.values())t.push(`@builtin( ${i} ) ${s} : ${a}`);return t.join(`,
	`)}getScopedArray(e,t,n,i){return this.scopedArrays.has(e)===!1&&this.scopedArrays.set(e,{name:e,scope:t,bufferType:n,bufferCount:i}),e}getScopedArrays(e){if(e!=="compute")return;const t=[];for(const{name:n,scope:i,bufferType:s,bufferCount:a}of this.scopedArrays.values()){const l=this.getType(s);t.push(`var<${i}> ${n}: array< ${l}, ${a} >;`)}return t.join(`
`)}getAttributes(e){const t=[];if(e==="compute"&&(this.getBuiltin("global_invocation_id","globalId","vec3<u32>","attribute"),this.getBuiltin("workgroup_id","workgroupId","vec3<u32>","attribute"),this.getBuiltin("local_invocation_id","localId","vec3<u32>","attribute"),this.getBuiltin("num_workgroups","numWorkgroups","vec3<u32>","attribute"),this.renderer.hasFeature("subgroups")&&(this.enableDirective("subgroups",e),this.getBuiltin("subgroup_size","subgroupSize","u32","attribute"))),e==="vertex"||e==="compute"){const n=this.getBuiltins("attribute");n&&t.push(n);const i=this.getAttributesArray();for(let s=0,a=i.length;s<a;s++){const l=i[s],c=l.name,d=this.getType(l.type);t.push(`@location( ${s} ) ${c} : ${d}`)}}return t.join(`,
	`)}getStructMembers(e){const t=[];for(const n of e.members){const i=e.output?"@location( "+n.index+" ) ":"";let s=this.getType(n.type);n.atomic&&(s="atomic< "+s+" >"),t.push(`	${i+n.name} : ${s}`)}return e.output&&t.push(`	${this.getBuiltins("output")}`),t.join(`,
`)}getStructs(e){let t="";const n=this.structs[e];if(n.length>0){const i=[];for(const s of n){let a=`struct ${s.name} {
`;a+=this.getStructMembers(s),a+=`
};`,i.push(a)}t=`
`+i.join(`

`)+`
`}return t}getVar(e,t,n=null){let i=`var ${t} : `;return n!==null?i+=this.generateArrayDeclaration(e,n):i+=this.getType(e),i}getVars(e){const t=[],n=this.vars[e];if(n!==void 0)for(const i of n)t.push(`	${this.getVar(i.type,i.name,i.count)};`);return`
${t.join(`
`)}
`}getVaryings(e){const t=[];if(e==="vertex"&&this.getBuiltin("position","Vertex","vec4<f32>","vertex"),e==="vertex"||e==="fragment"){const s=this.varyings,a=this.vars[e];for(let l=0;l<s.length;l++){const c=s[l];if(c.needsInterpolation){let d=`@location( ${l} )`;/^(int|uint|ivec|uvec)/.test(c.type)&&(d+=" @interpolate( flat )"),t.push(`${d} ${c.name} : ${this.getType(c.type)}`)}else e==="vertex"&&a.includes(c)===!1&&a.push(c)}}const n=this.getBuiltins(e);n&&t.push(n);const i=t.join(`,
	`);return e==="vertex"?this._getWGSLStruct("VaryingsStruct","	"+i):i}isCustomStruct(e){return e.value.isStorageBufferAttribute&&e.node.structTypeNode!==null}getUniforms(e){const t=this.uniforms[e],n=[],i=[],s=[],a={};for(const c of t){const d=c.groupNode.name,m=this.bindingsIndexes[d];if(c.type==="texture"||c.type==="cubeTexture"||c.type==="storageTexture"||c.type==="texture3D"){const y=c.node.value;(e==="fragment"||e==="compute")&&this.isUnfilterable(y)===!1&&c.node.isStorageTextureNode!==!0&&(this.isSampleCompare(y)?n.push(`@binding( ${m.binding++} ) @group( ${m.group} ) var ${c.name}_sampler : sampler_comparison;`):n.push(`@binding( ${m.binding++} ) @group( ${m.group} ) var ${c.name}_sampler : sampler;`));let v,x="";const{primarySamples:S}=this.renderer.backend.utils.getTextureSampleData(y);if(S>1&&(x="_multisampled"),y.isCubeTexture===!0)v="texture_cube<f32>";else if(y.isDataArrayTexture===!0||y.isCompressedArrayTexture===!0)v="texture_2d_array<f32>";else if(y.isDepthTexture===!0)v=`texture_depth${x}_2d`;else if(y.isVideoTexture===!0)v="texture_external";else if(y.isData3DTexture===!0)v="texture_3d<f32>";else if(c.node.isStorageTextureNode===!0){const A=c1(y),E=this.getStorageAccess(c.node,e);v=`texture_storage_2d<${A}, ${E}>`}else{const A=this.getComponentTypeFromTexture(y).charAt(0);v=`texture${x}_2d<${A}32>`}n.push(`@binding( ${m.binding++} ) @group( ${m.group} ) var ${c.name} : ${v};`)}else if(c.type==="buffer"||c.type==="storageBuffer"||c.type==="indirectStorageBuffer"){const y=c.node,v=this.getType(y.getNodeType(this)),x=y.bufferCount,S=x>0&&c.type==="buffer"?", "+x:"",A=y.isStorageBufferNode?`storage, ${this.getStorageAccess(y,e)}`:"uniform";if(this.isCustomStruct(c))i.push(`@binding( ${m.binding++} ) @group( ${m.group} ) var<${A}> ${c.name} : ${v};`);else{const M=`	value : array< ${y.isAtomic?`atomic<${v}>`:`${v}`}${S} >`;i.push(this._getWGSLStructBinding(c.name,M,A,m.binding++,m.group))}}else{const y=this.getType(this.getVectorType(c.type)),v=c.groupNode.name;(a[v]||(a[v]={index:m.binding++,id:m.group,snippets:[]})).snippets.push(`	${c.name} : ${y}`)}}for(const c in a){const d=a[c];s.push(this._getWGSLStructBinding(c,d.snippets.join(`,
`),"uniform",d.index,d.id))}let l=n.join(`
`);return l+=i.join(`
`),l+=s.join(`
`),l}buildCode(){const e=this.material!==null?{fragment:{},vertex:{}}:{compute:{}};this.sortBindingGroups();for(const t in e){this.shaderStage=t;const n=e[t];n.uniforms=this.getUniforms(t),n.attributes=this.getAttributes(t),n.varyings=this.getVaryings(t),n.structs=this.getStructs(t),n.vars=this.getVars(t),n.codes=this.getCodes(t),n.directives=this.getDirectives(t),n.scopedArrays=this.getScopedArrays(t);let i=`// code

`;i+=this.flowCode[t];const s=this.flowNodes[t],a=s[s.length-1],l=a.outputNode,c=l!==void 0&&l.isOutputStructNode===!0;for(const d of s){const m=this.getFlowData(d),y=d.name;if(y&&(i.length>0&&(i+=`
`),i+=`	// flow -> ${y}
`),i+=`${m.code}
	`,d===a&&t!=="compute"){if(i+=`// result

	`,t==="vertex")i+=`varyings.Vertex = ${m.result};`;else if(t==="fragment")if(c)n.returnType=l.getNodeType(this),n.structs+="var<private> output : "+n.returnType+";",i+=`return ${m.result};`;else{let v="	@location(0) color: vec4<f32>";const x=this.getBuiltins("output");x&&(v+=`,
	`+x),n.returnType="OutputStruct",n.structs+=this._getWGSLStruct("OutputStruct",v),n.structs+=`
var<private> output : OutputStruct;`,i+=`output.color = ${m.result};

	return output;`}}}n.flow=i}this.shaderStage=null,this.material!==null?(this.vertexShader=this._getWGSLVertexCode(e.vertex),this.fragmentShader=this._getWGSLFragmentCode(e.fragment)):this.computeShader=this._getWGSLComputeCode(e.compute,(this.object.workgroupSize||[64]).join(", "))}getMethod(e,t=null){let n;return t!==null&&(n=this._getWGSLMethod(e+"_"+t)),n===void 0&&(n=this._getWGSLMethod(e)),n||e}getType(e){return rW[e]||e}isAvailable(e){let t=Q2[e];return t===void 0&&(e==="float32Filterable"?t=this.renderer.hasFeature("float32-filterable"):e==="clipDistance"&&(t=this.renderer.hasFeature("clip-distances")),Q2[e]=t),t}_getWGSLMethod(e){return Yo[e]!==void 0&&this._include(e),$v[e]}_include(e){const t=Yo[e];return t.build(this),this.currentFunctionNode!==null&&this.currentFunctionNode.includes.push(t),t}_getWGSLVertexCode(e){return`${this.getSignature()}
// directives
${e.directives}

// structs
${e.structs}

// uniforms
${e.uniforms}

// varyings
${e.varyings}
var<private> varyings : VaryingsStruct;

// codes
${e.codes}

@vertex
fn main( ${e.attributes} ) -> VaryingsStruct {

	// vars
	${e.vars}

	// flow
	${e.flow}

	return varyings;

}
`}_getWGSLFragmentCode(e){return`${this.getSignature()}
// global
${kP}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@fragment
fn main( ${e.varyings} ) -> ${e.returnType} {

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLComputeCode(e,t){return`${this.getSignature()}
// directives
${e.directives}

// system
var<private> instanceIndex : u32;

// locals
${e.scopedArrays}

// structs
${e.structs}

// uniforms
${e.uniforms}

// codes
${e.codes}

@compute @workgroup_size( ${t} )
fn main( ${e.attributes} ) {

	// system
	instanceIndex = globalId.x + globalId.y * numWorkgroups.x * u32(${t}) + globalId.z * numWorkgroups.x * numWorkgroups.y * u32(${t});

	// vars
	${e.vars}

	// flow
	${e.flow}

}
`}_getWGSLStruct(e,t){return`
struct ${e} {
${t}
};`}_getWGSLStructBinding(e,t,n,i=0,s=0){const a=e+"Struct";return`${this._getWGSLStruct(a,t)}
@binding( ${i} ) @group( ${s} )
var<${n}> ${e} : ${a};`}}class oW{constructor(e){this.backend=e}getCurrentDepthStencilFormat(e){let t;return e.depthTexture!==null?t=this.getTextureFormatGPU(e.depthTexture):e.depth&&e.stencil?t=ie.Depth24PlusStencil8:e.depth&&(t=ie.Depth24Plus),t}getTextureFormatGPU(e){return this.backend.get(e).format}getTextureSampleData(e){let t;if(e.isFramebufferTexture)t=1;else if(e.isDepthTexture&&!e.renderTarget){const s=this.backend.renderer,a=s.getRenderTarget();t=a?a.samples:s.samples}else e.renderTarget&&(t=e.renderTarget.samples);t=t||1;const n=t>1&&e.renderTarget!==null&&e.isDepthTexture!==!0&&e.isFramebufferTexture!==!0;return{samples:t,primarySamples:n?1:t,isMSAA:n}}getCurrentColorFormat(e){let t;return e.textures!==null?t=this.getTextureFormatGPU(e.textures[0]):t=this.getPreferredCanvasFormat(),t}getCurrentColorSpace(e){return e.textures!==null?e.textures[0].colorSpace:this.backend.renderer.outputColorSpace}getPrimitiveTopology(e,t){if(e.isPoints)return pg.PointList;if(e.isLineSegments||e.isMesh&&t.wireframe===!0)return pg.LineList;if(e.isLine)return pg.LineStrip;if(e.isMesh)return pg.TriangleList}getSampleCount(e){let t=1;return e>1&&(t=Math.pow(2,Math.floor(Math.log2(e))),t===2&&(t=4)),t}getSampleCountRenderContext(e){return e.textures!==null?this.getSampleCount(e.sampleCount):this.getSampleCount(this.backend.renderer.samples)}getPreferredCanvasFormat(){const e=this.backend.parameters.outputType;if(e===void 0)return navigator.gpu.getPreferredCanvasFormat();if(e===Xi)return ie.BGRA8Unorm;if(e===Ys)return ie.RGBA16Float;throw new Error("Unsupported outputType")}}const lW=new Map([[Int8Array,["sint8","snorm8"]],[Uint8Array,["uint8","unorm8"]],[Int16Array,["sint16","snorm16"]],[Uint16Array,["uint16","unorm16"]],[Int32Array,["sint32","snorm32"]],[Uint32Array,["uint32","unorm32"]],[Float32Array,["float32"]]]),uW=new Map([[z1,["float16"]]]),cW=new Map([[Int32Array,"sint32"],[Int16Array,"sint32"],[Uint32Array,"uint32"],[Uint16Array,"uint32"],[Float32Array,"float32"]]);class hW{constructor(e){this.backend=e}createAttribute(e,t){const n=this._getBufferAttribute(e),i=this.backend,s=i.get(n);let a=s.buffer;if(a===void 0){const l=i.device;let c=n.array;if(e.normalized===!1){if(c.constructor===Int16Array||c.constructor===Int8Array)c=new Int32Array(c);else if((c.constructor===Uint16Array||c.constructor===Uint8Array)&&(c=new Uint32Array(c),t&GPUBufferUsage.INDEX))for(let m=0;m<c.length;m++)c[m]===65535&&(c[m]=4294967295)}if(n.array=c,(n.isStorageBufferAttribute||n.isStorageInstancedBufferAttribute)&&n.itemSize===3){c=new c.constructor(n.count*4);for(let m=0;m<n.count;m++)c.set(n.array.subarray(m*3,m*3+3),m*4);n.itemSize=4,n.array=c,s._force3to4BytesAlignment=!0}const d=c.byteLength+(4-c.byteLength%4)%4;a=l.createBuffer({label:n.name,size:d,usage:t,mappedAtCreation:!0}),new c.constructor(a.getMappedRange()).set(c),a.unmap(),s.buffer=a}}updateAttribute(e){const t=this._getBufferAttribute(e),n=this.backend,i=n.device,s=n.get(t),a=n.get(t).buffer;let l=t.array;if(s._force3to4BytesAlignment===!0){l=new l.constructor(t.count*4);for(let m=0;m<t.count;m++)l.set(t.array.subarray(m*3,m*3+3),m*4);t.array=l}const c=this._isTypedArray(l),d=t.updateRanges;if(d.length===0)i.queue.writeBuffer(a,0,l,0);else{const m=c?1:l.BYTES_PER_ELEMENT;for(let y=0,v=d.length;y<v;y++){const x=d[y];let S,A;if(s._force3to4BytesAlignment===!0){const M=Math.floor(x.start/3),C=Math.ceil(x.count/3);S=M*4*m,A=C*4*m}else S=x.start*m,A=x.count*m;const E=S*(c?l.BYTES_PER_ELEMENT:1);i.queue.writeBuffer(a,E,l,S,A)}t.clearUpdateRanges()}}createShaderVertexBuffers(e){const t=e.getAttributes(),n=new Map;for(let i=0;i<t.length;i++){const s=t[i],a=s.array.BYTES_PER_ELEMENT,l=this._getBufferAttribute(s);let c=n.get(l);if(c===void 0){let y,v;s.isInterleavedBufferAttribute===!0?(y=s.data.stride*a,v=s.data.isInstancedInterleavedBuffer?YS.Instance:YS.Vertex):(y=s.itemSize*a,v=s.isInstancedBufferAttribute?YS.Instance:YS.Vertex),s.normalized===!1&&(s.array.constructor===Int16Array||s.array.constructor===Uint16Array)&&(y=4),c={arrayStride:y,attributes:[],stepMode:v},n.set(l,c)}const d=this._getVertexFormat(s),m=s.isInterleavedBufferAttribute===!0?s.offset*a:0;c.attributes.push({shaderLocation:i,offset:m,format:d})}return Array.from(n.values())}destroyAttribute(e){const t=this.backend;t.get(this._getBufferAttribute(e)).buffer.destroy(),t.delete(e)}async getArrayBufferAsync(e){const t=this.backend,n=t.device,s=t.get(this._getBufferAttribute(e)).buffer,a=s.size,l=n.createBuffer({label:`${e.name}_readback`,size:a,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),c=n.createCommandEncoder({label:`readback_encoder_${e.name}`});c.copyBufferToBuffer(s,0,l,0,a);const d=c.finish();n.queue.submit([d]),await l.mapAsync(GPUMapMode.READ);const m=l.getMappedRange(),y=new e.array.constructor(m.slice(0));return l.unmap(),y.buffer}_getVertexFormat(e){const{itemSize:t,normalized:n}=e,i=e.array.constructor,s=e.constructor;let a;if(t===1)a=cW.get(i);else{const c=(uW.get(s)||lW.get(i))[n?1:0];if(c){const d=i.BYTES_PER_ELEMENT*t,y=Math.floor((d+3)/4)*4/i.BYTES_PER_ELEMENT;if(y%1)throw new Error("THREE.WebGPUAttributeUtils: Bad vertex format item size.");a=`${c}x${y}`}}return a||console.error("THREE.WebGPUAttributeUtils: Vertex format not supported yet."),a}_isTypedArray(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}_getBufferAttribute(e){return e.isInterleavedBufferAttribute&&(e=e.data),e}}class fW{constructor(e){this.backend=e,this.bindGroupLayoutCache=new WeakMap}createBindingsLayout(e){const t=this.backend,n=t.device,i=[];let s=0;for(const a of e.bindings){const l={binding:s++,visibility:a.visibility};if(a.isUniformBuffer||a.isStorageBuffer){const c={};a.isStorageBuffer&&(a.visibility&4&&(a.access===Vr.READ_WRITE||a.access===Vr.WRITE_ONLY)?c.type=lA.Storage:c.type=lA.ReadOnlyStorage),l.buffer=c}else if(a.isSampler){const c={};a.texture.isDepthTexture&&a.texture.compareFunction!==null&&(c.type="comparison"),l.sampler=c}else if(a.isSampledTexture&&a.texture.isVideoTexture)l.externalTexture={};else if(a.isSampledTexture&&a.store){const c={};c.format=this.backend.get(a.texture).texture.format;const d=a.access;d===Vr.READ_WRITE?c.access=uA.ReadWrite:d===Vr.WRITE_ONLY?c.access=uA.WriteOnly:c.access=uA.ReadOnly,l.storageTexture=c}else if(a.isSampledTexture){const c={},{primarySamples:d}=t.utils.getTextureSampleData(a.texture);if(d>1&&(c.multisampled=!0,a.texture.isDepthTexture||(c.sampleType=tg.UnfilterableFloat)),a.texture.isDepthTexture)c.sampleType=tg.Depth;else if(a.texture.isDataTexture||a.texture.isDataArrayTexture||a.texture.isData3DTexture){const m=a.texture.type;m===Xs?c.sampleType=tg.SInt:m===di?c.sampleType=tg.UInt:m===Ri&&(this.backend.hasFeature("float32-filterable")?c.sampleType=tg.Float:c.sampleType=tg.UnfilterableFloat)}a.isSampledCubeTexture?c.viewDimension=Pa.Cube:a.texture.isDataArrayTexture||a.texture.isCompressedArrayTexture?c.viewDimension=Pa.TwoDArray:a.isSampledTexture3D&&(c.viewDimension=Pa.ThreeD),l.texture=c}else console.error(`WebGPUBindingUtils: Unsupported binding "${a}".`);i.push(l)}return n.createBindGroupLayout({entries:i})}createBindings(e,t,n,i=0){const{backend:s,bindGroupLayoutCache:a}=this,l=s.get(e);let c=a.get(e.bindingsReference);c===void 0&&(c=this.createBindingsLayout(e),a.set(e.bindingsReference,c));let d;n>0&&(l.groups===void 0&&(l.groups=[],l.versions=[]),l.versions[n]===i&&(d=l.groups[n])),d===void 0&&(d=this.createBindGroup(e,c),n>0&&(l.groups[n]=d,l.versions[n]=i)),l.group=d,l.layout=c}updateBinding(e){const t=this.backend,n=t.device,i=e.buffer,s=t.get(e).buffer;n.queue.writeBuffer(s,0,i,0)}createBindGroupIndex(e,t){const i=this.backend.device,s=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,a=e[0],l=i.createBuffer({label:"bindingCameraIndex_"+a,size:16,usage:s});i.queue.writeBuffer(l,0,e,0);const c=[{binding:0,resource:{buffer:l}}];return i.createBindGroup({label:"bindGroupCameraIndex_"+a,layout:t,entries:c})}createBindGroup(e,t){const n=this.backend,i=n.device;let s=0;const a=[];for(const l of e.bindings){if(l.isUniformBuffer){const c=n.get(l);if(c.buffer===void 0){const d=l.byteLength,m=GPUBufferUsage.UNIFORM|GPUBufferUsage.COPY_DST,y=i.createBuffer({label:"bindingBuffer_"+l.name,size:d,usage:m});c.buffer=y}a.push({binding:s,resource:{buffer:c.buffer}})}else if(l.isStorageBuffer){const c=n.get(l);if(c.buffer===void 0){const d=l.attribute;c.buffer=n.get(d).buffer}a.push({binding:s,resource:{buffer:c.buffer}})}else if(l.isSampler){const c=n.get(l.texture);a.push({binding:s,resource:c.sampler})}else if(l.isSampledTexture){const c=n.get(l.texture);let d;if(c.externalTexture!==void 0)d=i.importExternalTexture({source:c.externalTexture});else{const m=l.store?1:c.texture.mipLevelCount,y=`view-${c.texture.width}-${c.texture.height}-${m}`;if(d=c[y],d===void 0){const v=H7.All;let x;l.isSampledCubeTexture?x=Pa.Cube:l.isSampledTexture3D?x=Pa.ThreeD:l.texture.isDataArrayTexture||l.texture.isCompressedArrayTexture?x=Pa.TwoDArray:x=Pa.TwoD,d=c[y]=c.texture.createView({aspect:v,dimension:x,mipLevelCount:m})}}a.push({binding:s,resource:d})}s++}return i.createBindGroup({label:"bindGroup_"+e.name,layout:t,entries:a})}}class dW{constructor(e){this.backend=e}_getSampleCount(e){return this.backend.utils.getSampleCountRenderContext(e)}createRenderPipeline(e,t){const{object:n,material:i,geometry:s,pipeline:a}=e,{vertexProgram:l,fragmentProgram:c}=a,d=this.backend,m=d.device,y=d.utils,v=d.get(a),x=[];for(const se of e.getBindings()){const pe=d.get(se);x.push(pe.layout)}const S=d.attributeUtils.createShaderVertexBuffers(e);let A;i.transparent===!0&&i.blending!==Ga&&(A=this._getBlending(i));let E={};i.stencilWrite===!0&&(E={compare:this._getStencilCompare(i),failOp:this._getStencilOperation(i.stencilFail),depthFailOp:this._getStencilOperation(i.stencilZFail),passOp:this._getStencilOperation(i.stencilZPass)});const M=this._getColorWriteMask(i),C=[];if(e.context.textures!==null){const se=e.context.textures;for(let pe=0;pe<se.length;pe++){const Se=y.getTextureFormatGPU(se[pe]);C.push({format:Se,blend:A,writeMask:M})}}else{const se=y.getCurrentColorFormat(e.context);C.push({format:se,blend:A,writeMask:M})}const w=d.get(l).module,D=d.get(c).module,z=this._getPrimitiveState(n,s,i),B=this._getDepthCompare(i),F=y.getCurrentDepthStencilFormat(e.context),H=this._getSampleCount(e.context),I={label:`renderPipeline_${i.name||i.type}_${i.id}`,vertex:Object.assign({},w,{buffers:S}),fragment:Object.assign({},D,{targets:C}),primitive:z,multisample:{count:H,alphaToCoverageEnabled:i.alphaToCoverage&&H>1},layout:m.createPipelineLayout({bindGroupLayouts:x})},P={},Z=e.context.depth,ue=e.context.stencil;if((Z===!0||ue===!0)&&(Z===!0&&(P.format=F,P.depthWriteEnabled=i.depthWrite,P.depthCompare=B),ue===!0&&(P.stencilFront=E,P.stencilBack={},P.stencilReadMask=i.stencilFuncMask,P.stencilWriteMask=i.stencilWriteMask),i.polygonOffset===!0&&(P.depthBias=i.polygonOffsetUnits,P.depthBiasSlopeScale=i.polygonOffsetFactor,P.depthBiasClamp=0),I.depthStencil=P),t===null)v.pipeline=m.createRenderPipeline(I);else{const se=new Promise(pe=>{m.createRenderPipelineAsync(I).then(Se=>{v.pipeline=Se,pe()})});t.push(se)}}createBundleEncoder(e){const t=this.backend,{utils:n,device:i}=t,s=n.getCurrentDepthStencilFormat(e),a=n.getCurrentColorFormat(e),l=this._getSampleCount(e),c={label:"renderBundleEncoder",colorFormats:[a],depthStencilFormat:s,sampleCount:l};return i.createRenderBundleEncoder(c)}createComputePipeline(e,t){const n=this.backend,i=n.device,s=n.get(e.computeProgram).module,a=n.get(e),l=[];for(const c of t){const d=n.get(c);l.push(d.layout)}a.pipeline=i.createComputePipeline({compute:s,layout:i.createPipelineLayout({bindGroupLayouts:l})})}_getBlending(e){let t,n;const i=e.blending,s=e.blendSrc,a=e.blendDst,l=e.blendEquation;if(i===Vd){const c=e.blendSrcAlpha!==null?e.blendSrcAlpha:s,d=e.blendDstAlpha!==null?e.blendDstAlpha:a,m=e.blendEquationAlpha!==null?e.blendEquationAlpha:l;t={srcFactor:this._getBlendFactor(s),dstFactor:this._getBlendFactor(a),operation:this._getBlendOperation(l)},n={srcFactor:this._getBlendFactor(c),dstFactor:this._getBlendFactor(d),operation:this._getBlendOperation(m)}}else{const c=e.premultipliedAlpha,d=(m,y,v,x)=>{t={srcFactor:m,dstFactor:y,operation:Ed.Add},n={srcFactor:v,dstFactor:x,operation:Ed.Add}};if(c)switch(i){case _o:d(an.One,an.OneMinusSrcAlpha,an.One,an.OneMinusSrcAlpha);break;case Yd:d(an.One,an.One,an.One,an.One);break;case jd:d(an.Zero,an.OneMinusSrc,an.Zero,an.One);break;case Zd:d(an.Zero,an.Src,an.Zero,an.SrcAlpha);break}else switch(i){case _o:d(an.SrcAlpha,an.OneMinusSrcAlpha,an.One,an.OneMinusSrcAlpha);break;case Yd:d(an.SrcAlpha,an.One,an.SrcAlpha,an.One);break;case jd:d(an.Zero,an.OneMinusSrc,an.Zero,an.One);break;case Zd:d(an.Zero,an.Src,an.Zero,an.Src);break}}if(t!==void 0&&n!==void 0)return{color:t,alpha:n};console.error("THREE.WebGPURenderer: Invalid blending: ",i)}_getBlendFactor(e){let t;switch(e){case Cu:t=an.Zero;break;case Vb:t=an.One;break;case Gb:t=an.Src;break;case Hb:t=an.OneMinusSrc;break;case Sg:t=an.SrcAlpha;break;case bg:t=an.OneMinusSrcAlpha;break;case Wb:t=an.Dst;break;case Xb:t=an.OneMinusDstColor;break;case kb:t=an.DstAlpha;break;case qb:t=an.OneMinusDstAlpha;break;case Yb:t=an.SrcAlphaSaturated;break;case p6:t=an.Constant;break;case m6:t=an.OneMinusConstant;break;default:console.error("THREE.WebGPURenderer: Blend factor not supported.",e)}return t}_getStencilCompare(e){let t;const n=e.stencilFunc;switch(n){case pU:t=vr.Never;break;case gb:t=vr.Always;break;case mU:t=vr.Less;break;case yU:t=vr.LessEqual;break;case gU:t=vr.Equal;break;case xU:t=vr.GreaterEqual;break;case vU:t=vr.Greater;break;case _U:t=vr.NotEqual;break;default:console.error("THREE.WebGPURenderer: Invalid stencil function.",n)}return t}_getStencilOperation(e){let t;switch(e){case Xh:t=Wh.Keep;break;case oU:t=Wh.Zero;break;case lU:t=Wh.Replace;break;case dU:t=Wh.Invert;break;case uU:t=Wh.IncrementClamp;break;case cU:t=Wh.DecrementClamp;break;case hU:t=Wh.IncrementWrap;break;case fU:t=Wh.DecrementWrap;break;default:console.error("THREE.WebGPURenderer: Invalid stencil operation.",t)}return t}_getBlendOperation(e){let t;switch(e){case _r:t=Ed.Add;break;case Fb:t=Ed.Subtract;break;case zb:t=Ed.ReverseSubtract;break;case M1:t=Ed.Min;break;case E1:t=Ed.Max;break;default:console.error("THREE.WebGPUPipelineUtils: Blend equation not supported.",e)}return t}_getPrimitiveState(e,t,n){const i={},s=this.backend.utils;switch(i.topology=s.getPrimitiveTopology(e,n),t.index!==null&&e.isLine===!0&&e.isLineSegments!==!0&&(i.stripIndexFormat=t.index.array instanceof Uint16Array?Xg.Uint16:Xg.Uint32),n.side){case pa:i.frontFace=rA.CCW,i.cullMode=aA.Back;break;case Ti:i.frontFace=rA.CCW,i.cullMode=aA.Front;break;case Fr:i.frontFace=rA.CCW,i.cullMode=aA.None;break;default:console.error("THREE.WebGPUPipelineUtils: Unknown material.side value.",n.side);break}return i}_getColorWriteMask(e){return e.colorWrite===!0?Y2.All:Y2.None}_getDepthCompare(e){let t;if(e.depthTest===!1)t=vr.Always;else{const n=e.depthFunc;switch(n){case Tg:t=vr.Never;break;case Mg:t=vr.Always;break;case Eg:t=vr.Less;break;case Pc:t=vr.LessEqual;break;case Ag:t=vr.Equal;break;case Rg:t=vr.GreaterEqual;break;case Ng:t=vr.Greater;break;case Cg:t=vr.NotEqual;break;default:console.error("THREE.WebGPUPipelineUtils: Invalid depth function.",n)}}return t}}class pW extends HP{constructor(e,t,n=2048){super(n),this.device=e,this.type=t,this.querySet=this.device.createQuerySet({type:"timestamp",count:this.maxQueries,label:`queryset_global_timestamp_${t}`});const i=this.maxQueries*8;this.resolveBuffer=this.device.createBuffer({label:`buffer_timestamp_resolve_${t}`,size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.resultBuffer=this.device.createBuffer({label:`buffer_timestamp_result_${t}`,size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ})}allocateQueriesForContext(e){if(!this.trackTimestamp||this.isDisposed)return null;if(this.currentQueryIndex+2>this.maxQueries)return Il(`WebGPUTimestampQueryPool [${this.type}]: Maximum number of queries exceeded, when using trackTimestamp it is necessary to resolves the queries via renderer.resolveTimestampsAsync( THREE.TimestampQuery.${this.type.toUpperCase()} ).`),null;const t=this.currentQueryIndex;return this.currentQueryIndex+=2,this.queryOffsets.set(e.id,t),t}async resolveQueriesAsync(){if(!this.trackTimestamp||this.currentQueryIndex===0||this.isDisposed)return this.lastValue;if(this.pendingResolve)return this.pendingResolve;this.pendingResolve=this._resolveQueries();try{return await this.pendingResolve}finally{this.pendingResolve=null}}async _resolveQueries(){if(this.isDisposed)return this.lastValue;try{if(this.resultBuffer.mapState!=="unmapped")return this.lastValue;const e=new Map(this.queryOffsets),t=this.currentQueryIndex,n=t*8;this.currentQueryIndex=0,this.queryOffsets.clear();const i=this.device.createCommandEncoder();i.resolveQuerySet(this.querySet,0,t,this.resolveBuffer,0),i.copyBufferToBuffer(this.resolveBuffer,0,this.resultBuffer,0,n);const s=i.finish();if(this.device.queue.submit([s]),this.resultBuffer.mapState!=="unmapped")return this.lastValue;if(await this.resultBuffer.mapAsync(GPUMapMode.READ,0,n),this.isDisposed)return this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue;const a=new BigUint64Array(this.resultBuffer.getMappedRange(0,n));let l=0;for(const[,c]of e){const d=a[c],m=a[c+1],y=Number(m-d)/1e6;l+=y}return this.resultBuffer.unmap(),this.lastValue=l,l}catch(e){return console.error("Error resolving queries:",e),this.resultBuffer.mapState==="mapped"&&this.resultBuffer.unmap(),this.lastValue}}async dispose(){if(!this.isDisposed){if(this.isDisposed=!0,this.pendingResolve)try{await this.pendingResolve}catch(e){console.error("Error waiting for pending resolve:",e)}if(this.resultBuffer&&this.resultBuffer.mapState==="mapped")try{this.resultBuffer.unmap()}catch(e){console.error("Error unmapping buffer:",e)}this.querySet&&(this.querySet.destroy(),this.querySet=null),this.resolveBuffer&&(this.resolveBuffer.destroy(),this.resolveBuffer=null),this.resultBuffer&&(this.resultBuffer.destroy(),this.resultBuffer=null),this.queryOffsets.clear(),this.pendingResolve=null}}}class mW extends GP{constructor(e={}){super(e),this.isWebGPUBackend=!0,this.parameters.alpha=e.alpha===void 0?!0:e.alpha,this.parameters.requiredLimits=e.requiredLimits===void 0?{}:e.requiredLimits,this.device=null,this.context=null,this.colorBuffer=null,this.defaultRenderPassdescriptor=null,this.utils=new oW(this),this.attributeUtils=new hW(this),this.bindingUtils=new fW(this),this.pipelineUtils=new dW(this),this.textureUtils=new Q7(this),this.occludedResolveCache=new Map}async init(e){await super.init(e);const t=this.parameters;let n;if(t.device===void 0){const a={powerPreference:t.powerPreference},l=typeof navigator<"u"?await navigator.gpu.requestAdapter(a):null;if(l===null)throw new Error("WebGPUBackend: Unable to create WebGPU adapter.");const c=Object.values(u1),d=[];for(const y of c)l.features.has(y)&&d.push(y);const m={requiredFeatures:d,requiredLimits:t.requiredLimits};n=await l.requestDevice(m)}else n=t.device;n.lost.then(a=>{const l={api:"WebGPU",message:a.message||"Unknown reason",reason:a.reason||null,originalEvent:a};e.onDeviceLost(l)});const i=t.context!==void 0?t.context:e.domElement.getContext("webgpu");this.device=n,this.context=i;const s=t.alpha?"premultiplied":"opaque";this.trackTimestamp=this.trackTimestamp&&this.hasFeature(u1.TimestampQuery),this.context.configure({device:this.device,format:this.utils.getPreferredCanvasFormat(),usage:GPUTextureUsage.RENDER_ATTACHMENT|GPUTextureUsage.COPY_SRC,alphaMode:s}),this.updateSize()}get coordinateSystem(){return Vl}async getArrayBufferAsync(e){return await this.attributeUtils.getArrayBufferAsync(e)}getContext(){return this.context}_getDefaultRenderPassDescriptor(){let e=this.defaultRenderPassdescriptor;if(e===null){const n=this.renderer;e={colorAttachments:[{view:null}]},(this.renderer.depth===!0||this.renderer.stencil===!0)&&(e.depthStencilAttachment={view:this.textureUtils.getDepthBuffer(n.depth,n.stencil).createView()});const i=e.colorAttachments[0];this.renderer.samples>0?i.view=this.colorBuffer.createView():i.resolveTarget=void 0,this.defaultRenderPassdescriptor=e}const t=e.colorAttachments[0];return this.renderer.samples>0?t.resolveTarget=this.context.getCurrentTexture().createView():t.view=this.context.getCurrentTexture().createView(),e}_getRenderPassDescriptor(e,t={}){const n=e.renderTarget,i=this.get(n);let s=i.descriptors;if(s===void 0||i.width!==n.width||i.height!==n.height||i.dimensions!==n.dimensions||i.activeMipmapLevel!==e.activeMipmapLevel||i.activeCubeFace!==e.activeCubeFace||i.samples!==n.samples){s={},i.descriptors=s;const d=()=>{n.removeEventListener("dispose",d),this.delete(n)};n.hasEventListener("dispose",d)===!1&&n.addEventListener("dispose",d)}const a=e.getCacheKey();let l=s[a];if(l===void 0){const d=e.textures,m=[];let y;for(let v=0;v<d.length;v++){const x=this.get(d[v]),S={label:`colorAttachment_${v}`,baseMipLevel:e.activeMipmapLevel,mipLevelCount:1,baseArrayLayer:e.activeCubeFace,arrayLayerCount:1,dimension:Pa.TwoD};n.isRenderTarget3D?(y=e.activeCubeFace,S.baseArrayLayer=0,S.dimension=Pa.ThreeD,S.depthOrArrayLayers=d[v].image.depth):n.isRenderTargetArray&&(S.dimension=Pa.TwoDArray,S.depthOrArrayLayers=d[v].image.depth);const A=x.texture.createView(S);let E,M;x.msaaTexture!==void 0?(E=x.msaaTexture.createView(),M=A):(E=A,M=void 0),m.push({view:E,resolveTarget:M,depthSlice:y})}if(l={textureViews:m},e.depth){const v=this.get(e.depthTexture);l.depthStencilView=v.texture.createView()}s[a]=l,i.width=n.width,i.height=n.height,i.samples=n.samples,i.activeMipmapLevel=e.activeMipmapLevel,i.activeCubeFace=e.activeCubeFace,i.dimensions=n.dimensions}const c={colorAttachments:[]};for(let d=0;d<l.textureViews.length;d++){const m=l.textureViews[d];let y={r:0,g:0,b:0,a:1};d===0&&t.clearValue&&(y=t.clearValue),c.colorAttachments.push({view:m.view,depthSlice:m.depthSlice,resolveTarget:m.resolveTarget,loadOp:t.loadOp||Ui.Load,storeOp:t.storeOp||sr.Store,clearValue:y})}return l.depthStencilView&&(c.depthStencilAttachment={view:l.depthStencilView}),c}beginRender(e){const t=this.get(e),n=this.device,i=e.occlusionQueryCount;let s;i>0&&(t.currentOcclusionQuerySet&&t.currentOcclusionQuerySet.destroy(),t.currentOcclusionQueryBuffer&&t.currentOcclusionQueryBuffer.destroy(),t.currentOcclusionQuerySet=t.occlusionQuerySet,t.currentOcclusionQueryBuffer=t.occlusionQueryBuffer,t.currentOcclusionQueryObjects=t.occlusionQueryObjects,s=n.createQuerySet({type:"occlusion",count:i,label:`occlusionQuerySet_${e.id}`}),t.occlusionQuerySet=s,t.occlusionQueryIndex=0,t.occlusionQueryObjects=new Array(i),t.lastOcclusionObject=null);let a;e.textures===null?a=this._getDefaultRenderPassDescriptor():a=this._getRenderPassDescriptor(e,{loadOp:Ui.Load}),this.initTimestampQuery(e,a),a.occlusionQuerySet=s;const l=a.depthStencilAttachment;if(e.textures!==null){const m=a.colorAttachments;for(let y=0;y<m.length;y++){const v=m[y];e.clearColor?(v.clearValue=y===0?e.clearColorValue:{r:0,g:0,b:0,a:1},v.loadOp=Ui.Clear,v.storeOp=sr.Store):(v.loadOp=Ui.Load,v.storeOp=sr.Store)}}else{const m=a.colorAttachments[0];e.clearColor?(m.clearValue=e.clearColorValue,m.loadOp=Ui.Clear,m.storeOp=sr.Store):(m.loadOp=Ui.Load,m.storeOp=sr.Store)}e.depth&&(e.clearDepth?(l.depthClearValue=e.clearDepthValue,l.depthLoadOp=Ui.Clear,l.depthStoreOp=sr.Store):(l.depthLoadOp=Ui.Load,l.depthStoreOp=sr.Store)),e.stencil&&(e.clearStencil?(l.stencilClearValue=e.clearStencilValue,l.stencilLoadOp=Ui.Clear,l.stencilStoreOp=sr.Store):(l.stencilLoadOp=Ui.Load,l.stencilStoreOp=sr.Store));const c=n.createCommandEncoder({label:"renderContext_"+e.id}),d=c.beginRenderPass(a);if(t.descriptor=a,t.encoder=c,t.currentPass=d,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.renderBundles=[],e.viewport&&this.updateViewport(e),e.scissor){const{x:m,y,width:v,height:x}=e.scissorValue;d.setScissorRect(m,y,v,x)}}finishRender(e){const t=this.get(e),n=e.occlusionQueryCount;if(t.renderBundles.length>0&&t.currentPass.executeBundles(t.renderBundles),n>t.occlusionQueryIndex&&t.currentPass.endOcclusionQuery(),t.currentPass.end(),n>0){const i=n*8;let s=this.occludedResolveCache.get(i);s===void 0&&(s=this.device.createBuffer({size:i,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),this.occludedResolveCache.set(i,s));const a=this.device.createBuffer({size:i,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ});t.encoder.resolveQuerySet(t.occlusionQuerySet,0,n,s,0),t.encoder.copyBufferToBuffer(s,0,a,0,i),t.occlusionQueryBuffer=a,this.resolveOccludedAsync(e)}if(this.device.queue.submit([t.encoder.finish()]),e.textures!==null){const i=e.textures;for(let s=0;s<i.length;s++){const a=i[s];a.generateMipmaps===!0&&this.textureUtils.generateMipmaps(a)}}}isOccluded(e,t){const n=this.get(e);return n.occluded&&n.occluded.has(t)}async resolveOccludedAsync(e){const t=this.get(e),{currentOcclusionQueryBuffer:n,currentOcclusionQueryObjects:i}=t;if(n&&i){const s=new WeakSet;t.currentOcclusionQueryObjects=null,t.currentOcclusionQueryBuffer=null,await n.mapAsync(GPUMapMode.READ);const a=n.getMappedRange(),l=new BigUint64Array(a);for(let c=0;c<i.length;c++)l[c]===BigInt(0)&&s.add(i[c]);n.destroy(),t.occluded=s}}updateViewport(e){const{currentPass:t}=this.get(e),{x:n,y:i,width:s,height:a,minDepth:l,maxDepth:c}=e.viewportValue;t.setViewport(n,i,s,a,l,c)}getClearColor(){const e=super.getClearColor();return this.renderer.alpha===!0&&(e.r*=e.a,e.g*=e.a,e.b*=e.a),e}clear(e,t,n,i=null){const s=this.device,a=this.renderer;let l=[],c,d,m,y;if(e){const S=this.getClearColor();d={r:S.r,g:S.g,b:S.b,a:S.a}}if(i===null){m=a.depth,y=a.stencil;const S=this._getDefaultRenderPassDescriptor();if(e){l=S.colorAttachments;const A=l[0];A.clearValue=d,A.loadOp=Ui.Clear,A.storeOp=sr.Store}(m||y)&&(c=S.depthStencilAttachment)}else{m=i.depth,y=i.stencil;const S={loadOp:e?Ui.Clear:Ui.Load,clearValue:e?d:void 0};m&&(S.depthLoadOp=t?Ui.Clear:Ui.Load,S.depthClearValue=t?a.getClearDepth():void 0,S.depthStoreOp=sr.Store),y&&(S.stencilLoadOp=n?Ui.Clear:Ui.Load,S.stencilClearValue=n?a.getClearStencil():void 0,S.stencilStoreOp=sr.Store);const A=this._getRenderPassDescriptor(i,S);l=A.colorAttachments,c=A.depthStencilAttachment}m&&c&&c.depthLoadOp===void 0&&(t?(c.depthLoadOp=Ui.Clear,c.depthClearValue=a.getClearDepth(),c.depthStoreOp=sr.Store):(c.depthLoadOp=Ui.Load,c.depthStoreOp=sr.Store)),y&&c&&c.stencilLoadOp===void 0&&(n?(c.stencilLoadOp=Ui.Clear,c.stencilClearValue=a.getClearStencil(),c.stencilStoreOp=sr.Store):(c.stencilLoadOp=Ui.Load,c.stencilStoreOp=sr.Store));const v=s.createCommandEncoder({label:"clear"});v.beginRenderPass({colorAttachments:l,depthStencilAttachment:c}).end(),s.queue.submit([v.finish()])}beginCompute(e){const t=this.get(e),n={label:"computeGroup_"+e.id};this.initTimestampQuery(e,n),t.cmdEncoderGPU=this.device.createCommandEncoder({label:"computeGroup_"+e.id}),t.passEncoderGPU=t.cmdEncoderGPU.beginComputePass(n)}compute(e,t,n,i){const{passEncoderGPU:s}=this.get(e),a=this.get(i).pipeline;s.setPipeline(a);for(let m=0,y=n.length;m<y;m++){const v=n[m],x=this.get(v);s.setBindGroup(m,x.group)}const l=this.device.limits.maxComputeWorkgroupsPerDimension,c=this.get(t);c.dispatchSize===void 0&&(c.dispatchSize={x:0,y:1,z:1});const{dispatchSize:d}=c;t.dispatchCount>l?(d.x=Math.min(t.dispatchCount,l),d.y=Math.ceil(t.dispatchCount/l)):d.x=t.dispatchCount,s.dispatchWorkgroups(d.x,d.y,d.z)}finishCompute(e){const t=this.get(e);t.passEncoderGPU.end(),this.device.queue.submit([t.cmdEncoderGPU.finish()])}async waitForGPU(){await this.device.queue.onSubmittedWorkDone()}draw(e,t){const{object:n,material:i,context:s,pipeline:a}=e,l=e.getBindings(),c=this.get(s),d=this.get(a).pipeline,m=c.currentSets,y=c.currentPass,v=e.getDrawParameters();if(v===null)return;m.pipeline!==d&&(y.setPipeline(d),m.pipeline=d);const x=m.bindingGroups;for(let C=0,w=l.length;C<w;C++){const D=l[C],z=this.get(D);x[D.index]!==D.id&&(y.setBindGroup(D.index,z.group),x[D.index]=D.id)}const S=e.getIndex(),A=S!==null;if(A===!0&&m.index!==S){const C=this.get(S).buffer,w=S.array instanceof Uint16Array?Xg.Uint16:Xg.Uint32;y.setIndexBuffer(C,w),m.index=S}const E=e.getVertexBuffers();for(let C=0,w=E.length;C<w;C++){const D=E[C];if(m.attributes[C]!==D){const z=this.get(D).buffer;y.setVertexBuffer(C,z),m.attributes[C]=D}}if(c.occlusionQuerySet!==void 0){const C=c.lastOcclusionObject;C!==n&&(C!==null&&C.occlusionTest===!0&&(y.endOcclusionQuery(),c.occlusionQueryIndex++),n.occlusionTest===!0&&(y.beginOcclusionQuery(c.occlusionQueryIndex),c.occlusionQueryObjects[c.occlusionQueryIndex]=n),c.lastOcclusionObject=n)}s.stencil===!0&&i.stencilWrite===!0&&c.currentStencilRef!==i.stencilRef&&(y.setStencilReference(i.stencilRef),c.currentStencilRef=i.stencilRef);const M=()=>{if(n.isBatchedMesh===!0){const C=n._multiDrawStarts,w=n._multiDrawCounts,D=n._multiDrawCount,z=n._multiDrawInstances;z!==null&&Il("THREE.WebGPUBackend: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection.");for(let B=0;B<D;B++){const F=z?z[B]:1,H=F>1?0:B;A===!0?y.drawIndexed(w[B],F,C[B]/S.array.BYTES_PER_ELEMENT,0,H):y.draw(w[B],F,C[B],H),t.update(n,w[B],F)}}else if(A===!0){const{vertexCount:C,instanceCount:w,firstVertex:D}=v,z=e.getIndirect();if(z!==null){const B=this.get(z).buffer;y.drawIndexedIndirect(B,0)}else y.drawIndexed(C,w,D,0,0);t.update(n,C,w)}else{const{vertexCount:C,instanceCount:w,firstVertex:D}=v,z=e.getIndirect();if(z!==null){const B=this.get(z).buffer;y.drawIndirect(B,0)}else y.draw(C,w,D,0);t.update(n,C,w)}};if(e.camera.isArrayCamera&&e.camera.cameras.length>0){const C=this.get(e.camera),w=e.camera.cameras,D=e.getBindingGroup("cameraIndex");if(C.indexesGPU===void 0||C.indexesGPU.length!==w.length){const B=this.get(D),F=[],H=new Uint32Array([0,0,0,0]);for(let I=0,P=w.length;I<P;I++){H[0]=I;const Z=this.bindingUtils.createBindGroupIndex(H,B.layout);F.push(Z)}C.indexesGPU=F}const z=this.renderer.getPixelRatio();for(let B=0,F=w.length;B<F;B++){const H=w[B];if(n.layers.test(H.layers)){const I=H.viewport;y.setViewport(Math.floor(I.x*z),Math.floor(I.y*z),Math.floor(I.width*z),Math.floor(I.height*z),s.viewportValue.minDepth,s.viewportValue.maxDepth),y.setBindGroup(D.index,C.indexesGPU[B]),M()}}}else M()}needsRenderUpdate(e){const t=this.get(e),{object:n,material:i}=e,s=this.utils,a=s.getSampleCountRenderContext(e.context),l=s.getCurrentColorSpace(e.context),c=s.getCurrentColorFormat(e.context),d=s.getCurrentDepthStencilFormat(e.context),m=s.getPrimitiveTopology(n,i);let y=!1;return(t.material!==i||t.materialVersion!==i.version||t.transparent!==i.transparent||t.blending!==i.blending||t.premultipliedAlpha!==i.premultipliedAlpha||t.blendSrc!==i.blendSrc||t.blendDst!==i.blendDst||t.blendEquation!==i.blendEquation||t.blendSrcAlpha!==i.blendSrcAlpha||t.blendDstAlpha!==i.blendDstAlpha||t.blendEquationAlpha!==i.blendEquationAlpha||t.colorWrite!==i.colorWrite||t.depthWrite!==i.depthWrite||t.depthTest!==i.depthTest||t.depthFunc!==i.depthFunc||t.stencilWrite!==i.stencilWrite||t.stencilFunc!==i.stencilFunc||t.stencilFail!==i.stencilFail||t.stencilZFail!==i.stencilZFail||t.stencilZPass!==i.stencilZPass||t.stencilFuncMask!==i.stencilFuncMask||t.stencilWriteMask!==i.stencilWriteMask||t.side!==i.side||t.alphaToCoverage!==i.alphaToCoverage||t.sampleCount!==a||t.colorSpace!==l||t.colorFormat!==c||t.depthStencilFormat!==d||t.primitiveTopology!==m||t.clippingContextCacheKey!==e.clippingContextCacheKey)&&(t.material=i,t.materialVersion=i.version,t.transparent=i.transparent,t.blending=i.blending,t.premultipliedAlpha=i.premultipliedAlpha,t.blendSrc=i.blendSrc,t.blendDst=i.blendDst,t.blendEquation=i.blendEquation,t.blendSrcAlpha=i.blendSrcAlpha,t.blendDstAlpha=i.blendDstAlpha,t.blendEquationAlpha=i.blendEquationAlpha,t.colorWrite=i.colorWrite,t.depthWrite=i.depthWrite,t.depthTest=i.depthTest,t.depthFunc=i.depthFunc,t.stencilWrite=i.stencilWrite,t.stencilFunc=i.stencilFunc,t.stencilFail=i.stencilFail,t.stencilZFail=i.stencilZFail,t.stencilZPass=i.stencilZPass,t.stencilFuncMask=i.stencilFuncMask,t.stencilWriteMask=i.stencilWriteMask,t.side=i.side,t.alphaToCoverage=i.alphaToCoverage,t.sampleCount=a,t.colorSpace=l,t.colorFormat=c,t.depthStencilFormat=d,t.primitiveTopology=m,t.clippingContextCacheKey=e.clippingContextCacheKey,y=!0),y}getRenderCacheKey(e){const{object:t,material:n}=e,i=this.utils,s=e.context;return[n.transparent,n.blending,n.premultipliedAlpha,n.blendSrc,n.blendDst,n.blendEquation,n.blendSrcAlpha,n.blendDstAlpha,n.blendEquationAlpha,n.colorWrite,n.depthWrite,n.depthTest,n.depthFunc,n.stencilWrite,n.stencilFunc,n.stencilFail,n.stencilZFail,n.stencilZPass,n.stencilFuncMask,n.stencilWriteMask,n.side,i.getSampleCountRenderContext(s),i.getCurrentColorSpace(s),i.getCurrentColorFormat(s),i.getCurrentDepthStencilFormat(s),i.getPrimitiveTopology(t,n),e.getGeometryCacheKey(),e.clippingContextCacheKey].join()}createSampler(e){this.textureUtils.createSampler(e)}destroySampler(e){this.textureUtils.destroySampler(e)}createDefaultTexture(e){this.textureUtils.createDefaultTexture(e)}createTexture(e,t){this.textureUtils.createTexture(e,t)}updateTexture(e,t){this.textureUtils.updateTexture(e,t)}generateMipmaps(e){this.textureUtils.generateMipmaps(e)}destroyTexture(e){this.textureUtils.destroyTexture(e)}async copyTextureToBuffer(e,t,n,i,s,a){return this.textureUtils.copyTextureToBuffer(e,t,n,i,s,a)}initTimestampQuery(e,t){if(!this.trackTimestamp)return;const n=e.isComputeNode?"compute":"render";this.timestampQueryPool[n]||(this.timestampQueryPool[n]=new pW(this.device,n,2048));const i=this.timestampQueryPool[n],s=i.allocateQueriesForContext(e);t.timestampWrites={querySet:i.querySet,beginningOfPassWriteIndex:s,endOfPassWriteIndex:s+1}}createNodeBuilder(e,t){return new aW(e,t)}createProgram(e){const t=this.get(e);t.module={module:this.device.createShaderModule({code:e.code,label:e.stage+(e.name!==""?`_${e.name}`:"")}),entryPoint:"main"}}destroyProgram(e){this.delete(e)}createRenderPipeline(e,t){this.pipelineUtils.createRenderPipeline(e,t)}createComputePipeline(e,t){this.pipelineUtils.createComputePipeline(e,t)}beginBundle(e){const t=this.get(e);t._currentPass=t.currentPass,t._currentSets=t.currentSets,t.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.currentPass=this.pipelineUtils.createBundleEncoder(e)}finishBundle(e,t){const n=this.get(e),s=n.currentPass.finish();this.get(t).bundleGPU=s,n.currentSets=n._currentSets,n.currentPass=n._currentPass}addBundle(e,t){this.get(e).renderBundles.push(this.get(t).bundleGPU)}createBindings(e,t,n,i){this.bindingUtils.createBindings(e,t,n,i)}updateBindings(e,t,n,i){this.bindingUtils.createBindings(e,t,n,i)}updateBinding(e){this.bindingUtils.updateBinding(e)}createIndexAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.INDEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.VERTEX|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}createIndirectStorageAttribute(e){this.attributeUtils.createAttribute(e,GPUBufferUsage.STORAGE|GPUBufferUsage.INDIRECT|GPUBufferUsage.COPY_SRC|GPUBufferUsage.COPY_DST)}updateAttribute(e){this.attributeUtils.updateAttribute(e)}destroyAttribute(e){this.attributeUtils.destroyAttribute(e)}updateSize(){this.colorBuffer=this.textureUtils.getColorBuffer(),this.defaultRenderPassdescriptor=null}getMaxAnisotropy(){return 16}hasFeature(e){return this.device.features.has(e)}copyTextureToTexture(e,t,n=null,i=null,s=0,a=0){let l=0,c=0,d=0,m=0,y=0,v=0,x=e.image.width,S=e.image.height,A=1;n!==null&&(n.isBox3===!0?(m=n.min.x,y=n.min.y,v=n.min.z,x=n.max.x-n.min.x,S=n.max.y-n.min.y,A=n.max.z-n.min.z):(m=n.min.x,y=n.min.y,x=n.max.x-n.min.x,S=n.max.y-n.min.y,A=1)),i!==null&&(l=i.x,c=i.y,d=i.z||0);const E=this.device.createCommandEncoder({label:"copyTextureToTexture_"+e.id+"_"+t.id}),M=this.get(e).texture,C=this.get(t).texture;E.copyTextureToTexture({texture:M,mipLevel:s,origin:{x:m,y,z:v}},{texture:C,mipLevel:a,origin:{x:l,y:c,z:d}},[x,S,A]),this.device.queue.submit([E.finish()]),a===0&&t.generateMipmaps&&this.textureUtils.generateMipmaps(t)}copyFramebufferToTexture(e,t,n){const i=this.get(t);let s=null;t.renderTarget?e.isDepthTexture?s=this.get(t.depthTexture).texture:s=this.get(t.textures[0]).texture:e.isDepthTexture?s=this.textureUtils.getDepthBuffer(t.depth,t.stencil):s=this.context.getCurrentTexture();const a=this.get(e).texture;if(s.format!==a.format){console.error("WebGPUBackend: copyFramebufferToTexture: Source and destination formats do not match.",s.format,a.format);return}let l;if(i.currentPass?(i.currentPass.end(),l=i.encoder):l=this.device.createCommandEncoder({label:"copyFramebufferToTexture_"+e.id}),l.copyTextureToTexture({texture:s,origin:[n.x,n.y,0]},{texture:a},[n.z,n.w]),e.generateMipmaps&&this.textureUtils.generateMipmaps(e),i.currentPass){const{descriptor:c}=i;for(let d=0;d<c.colorAttachments.length;d++)c.colorAttachments[d].loadOp=Ui.Load;if(t.depth&&(c.depthStencilAttachment.depthLoadOp=Ui.Load),t.stencil&&(c.depthStencilAttachment.stencilLoadOp=Ui.Load),i.currentPass=l.beginRenderPass(c),i.currentSets={attributes:{},bindingGroups:[],pipeline:null,index:null},t.viewport&&this.updateViewport(t),t.scissor){const{x:d,y:m,width:y,height:v}=t.scissorValue;i.currentPass.setScissorRect(d,m,y,v)}}else this.device.queue.submit([l.finish()])}}class gW extends wT{constructor(e,t,n,i,s,a){super(e,t,n,i,s,a),this.iesMap=null}copy(e,t){return super.copy(e,t),this.iesMap=e.iesMap,this}}class yW extends BP{constructor(){super(),this.addMaterial(c5,"MeshPhongMaterial"),this.addMaterial(NO,"MeshStandardMaterial"),this.addMaterial(CO,"MeshPhysicalMaterial"),this.addMaterial(J5,"MeshToonMaterial"),this.addMaterial(i5,"MeshBasicMaterial"),this.addMaterial(l5,"MeshLambertMaterial"),this.addMaterial(QH,"MeshNormalMaterial"),this.addMaterial(t6,"MeshMatcapMaterial"),this.addMaterial(qH,"LineBasicMaterial"),this.addMaterial(XH,"LineDashedMaterial"),this.addMaterial(r6,"PointsMaterial"),this.addMaterial(DO,"SpriteMaterial"),this.addMaterial(l6,"ShadowMaterial"),this.addLight(uq,fR),this.addLight(K9,dR),this.addLight(Q9,mR),this.addLight(UP,wT),this.addLight($9,pR),this.addLight(e7,cR),this.addLight(t7,gR),this.addLight(J9,gW),this.addToneMapping(QO,N1),this.addToneMapping(JO,C1),this.addToneMapping($O,w1),this.addToneMapping(eP,jb),this.addToneMapping(tP,D1),this.addToneMapping(nP,U1)}}class vW extends x7{constructor(e={}){let t;e.forceWebGL?t=X2:(t=mW,e.getFallback=()=>(console.warn("THREE.WebGPURenderer: WebGPU is not available, running under WebGL2 backend."),new X2(e)));const n=new t(e);super(n,e),this.library=new yW,this.isWebGPURenderer=!0}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */function qP(){let r=null,e=!1,t=null,n=null;function i(s,a){t(s,a),n=r.requestAnimationFrame(i)}return{start:function(){e!==!0&&t!==null&&(n=r.requestAnimationFrame(i),e=!0)},stop:function(){r.cancelAnimationFrame(n),e=!1},setAnimationLoop:function(s){t=s},setContext:function(s){r=s}}}function _W(r){const e=new WeakMap;function t(l,c){const d=l.array,m=l.usage,y=d.byteLength,v=r.createBuffer();r.bindBuffer(c,v),r.bufferData(c,d,m),l.onUploadCallback();let x;if(d instanceof Float32Array)x=r.FLOAT;else if(d instanceof Uint16Array)l.isFloat16BufferAttribute?x=r.HALF_FLOAT:x=r.UNSIGNED_SHORT;else if(d instanceof Int16Array)x=r.SHORT;else if(d instanceof Uint32Array)x=r.UNSIGNED_INT;else if(d instanceof Int32Array)x=r.INT;else if(d instanceof Int8Array)x=r.BYTE;else if(d instanceof Uint8Array)x=r.UNSIGNED_BYTE;else if(d instanceof Uint8ClampedArray)x=r.UNSIGNED_BYTE;else throw new Error("THREE.WebGLAttributes: Unsupported buffer data format: "+d);return{buffer:v,type:x,bytesPerElement:d.BYTES_PER_ELEMENT,version:l.version,size:y}}function n(l,c,d){const m=c.array,y=c.updateRanges;if(r.bindBuffer(d,l),y.length===0)r.bufferSubData(d,0,m);else{y.sort((x,S)=>x.start-S.start);let v=0;for(let x=1;x<y.length;x++){const S=y[v],A=y[x];A.start<=S.start+S.count+1?S.count=Math.max(S.count,A.start+A.count-S.start):(++v,y[v]=A)}y.length=v+1;for(let x=0,S=y.length;x<S;x++){const A=y[x];r.bufferSubData(d,A.start*m.BYTES_PER_ELEMENT,m,A.start,A.count)}c.clearUpdateRanges()}c.onUploadCallback()}function i(l){return l.isInterleavedBufferAttribute&&(l=l.data),e.get(l)}function s(l){l.isInterleavedBufferAttribute&&(l=l.data);const c=e.get(l);c&&(r.deleteBuffer(c.buffer),e.delete(l))}function a(l,c){if(l.isInterleavedBufferAttribute&&(l=l.data),l.isGLBufferAttribute){const m=e.get(l);(!m||m.version<l.version)&&e.set(l,{buffer:l.buffer,type:l.type,bytesPerElement:l.elementSize,version:l.version});return}const d=e.get(l);if(d===void 0)e.set(l,t(l,c));else if(d.version<l.version){if(d.size!==l.array.byteLength)throw new Error("THREE.WebGLAttributes: The size of the buffer attribute's array buffer does not match the original size. Resizing buffer attributes is not supported.");n(d.buffer,l,c),d.version=l.version}}return{get:i,remove:s,update:a}}var xW=`#ifdef USE_ALPHAHASH
	if ( diffuseColor.a < getAlphaHashThreshold( vPosition ) ) discard;
#endif`,SW=`#ifdef USE_ALPHAHASH
	const float ALPHA_HASH_SCALE = 0.05;
	float hash2D( vec2 value ) {
		return fract( 1.0e4 * sin( 17.0 * value.x + 0.1 * value.y ) * ( 0.1 + abs( sin( 13.0 * value.y + value.x ) ) ) );
	}
	float hash3D( vec3 value ) {
		return hash2D( vec2( hash2D( value.xy ), value.z ) );
	}
	float getAlphaHashThreshold( vec3 position ) {
		float maxDeriv = max(
			length( dFdx( position.xyz ) ),
			length( dFdy( position.xyz ) )
		);
		float pixScale = 1.0 / ( ALPHA_HASH_SCALE * maxDeriv );
		vec2 pixScales = vec2(
			exp2( floor( log2( pixScale ) ) ),
			exp2( ceil( log2( pixScale ) ) )
		);
		vec2 alpha = vec2(
			hash3D( floor( pixScales.x * position.xyz ) ),
			hash3D( floor( pixScales.y * position.xyz ) )
		);
		float lerpFactor = fract( log2( pixScale ) );
		float x = ( 1.0 - lerpFactor ) * alpha.x + lerpFactor * alpha.y;
		float a = min( lerpFactor, 1.0 - lerpFactor );
		vec3 cases = vec3(
			x * x / ( 2.0 * a * ( 1.0 - a ) ),
			( x - 0.5 * a ) / ( 1.0 - a ),
			1.0 - ( ( 1.0 - x ) * ( 1.0 - x ) / ( 2.0 * a * ( 1.0 - a ) ) )
		);
		float threshold = ( x < ( 1.0 - a ) )
			? ( ( x < a ) ? cases.x : cases.y )
			: cases.z;
		return clamp( threshold , 1.0e-6, 1.0 );
	}
#endif`,bW=`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vAlphaMapUv ).g;
#endif`,TW=`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,MW=`#ifdef USE_ALPHATEST
	#ifdef ALPHA_TO_COVERAGE
	diffuseColor.a = smoothstep( alphaTest, alphaTest + fwidth( diffuseColor.a ), diffuseColor.a );
	if ( diffuseColor.a == 0.0 ) discard;
	#else
	if ( diffuseColor.a < alphaTest ) discard;
	#endif
#endif`,EW=`#ifdef USE_ALPHATEST
	uniform float alphaTest;
#endif`,AW=`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vAoMapUv ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_CLEARCOAT ) 
		clearcoatSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_SHEEN ) 
		sheenSpecularIndirect *= ambientOcclusion;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometryNormal, geometryViewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.roughness );
	#endif
#endif`,RW=`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,NW=`#ifdef USE_BATCHING
	#if ! defined( GL_ANGLE_multi_draw )
	#define gl_DrawID _gl_DrawID
	uniform int _gl_DrawID;
	#endif
	uniform highp sampler2D batchingTexture;
	uniform highp usampler2D batchingIdTexture;
	mat4 getBatchingMatrix( const in float i ) {
		int size = textureSize( batchingTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( batchingTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( batchingTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( batchingTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( batchingTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
	float getIndirectIndex( const in int i ) {
		int size = textureSize( batchingIdTexture, 0 ).x;
		int x = i % size;
		int y = i / size;
		return float( texelFetch( batchingIdTexture, ivec2( x, y ), 0 ).r );
	}
#endif
#ifdef USE_BATCHING_COLOR
	uniform sampler2D batchingColorTexture;
	vec3 getBatchingColor( const in float i ) {
		int size = textureSize( batchingColorTexture, 0 ).x;
		int j = int( i );
		int x = j % size;
		int y = j / size;
		return texelFetch( batchingColorTexture, ivec2( x, y ), 0 ).rgb;
	}
#endif`,CW=`#ifdef USE_BATCHING
	mat4 batchingMatrix = getBatchingMatrix( getIndirectIndex( gl_DrawID ) );
#endif`,wW=`vec3 transformed = vec3( position );
#ifdef USE_ALPHAHASH
	vPosition = vec3( position );
#endif`,DW=`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,UW=`float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_BlinnPhong( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( specularColor, 1.0, dotVH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
} // validated`,LW=`#ifdef USE_IRIDESCENCE
	const mat3 XYZ_TO_REC709 = mat3(
		 3.2404542, -0.9692660,  0.0556434,
		-1.5371385,  1.8760108, -0.2040259,
		-0.4985314,  0.0415560,  1.0572252
	);
	vec3 Fresnel0ToIor( vec3 fresnel0 ) {
		vec3 sqrtF0 = sqrt( fresnel0 );
		return ( vec3( 1.0 ) + sqrtF0 ) / ( vec3( 1.0 ) - sqrtF0 );
	}
	vec3 IorToFresnel0( vec3 transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - vec3( incidentIor ) ) / ( transmittedIor + vec3( incidentIor ) ) );
	}
	float IorToFresnel0( float transmittedIor, float incidentIor ) {
		return pow2( ( transmittedIor - incidentIor ) / ( transmittedIor + incidentIor ));
	}
	vec3 evalSensitivity( float OPD, vec3 shift ) {
		float phase = 2.0 * PI * OPD * 1.0e-9;
		vec3 val = vec3( 5.4856e-13, 4.4201e-13, 5.2481e-13 );
		vec3 pos = vec3( 1.6810e+06, 1.7953e+06, 2.2084e+06 );
		vec3 var = vec3( 4.3278e+09, 9.3046e+09, 6.6121e+09 );
		vec3 xyz = val * sqrt( 2.0 * PI * var ) * cos( pos * phase + shift ) * exp( - pow2( phase ) * var );
		xyz.x += 9.7470e-14 * sqrt( 2.0 * PI * 4.5282e+09 ) * cos( 2.2399e+06 * phase + shift[ 0 ] ) * exp( - 4.5282e+09 * pow2( phase ) );
		xyz /= 1.0685e-7;
		vec3 rgb = XYZ_TO_REC709 * xyz;
		return rgb;
	}
	vec3 evalIridescence( float outsideIOR, float eta2, float cosTheta1, float thinFilmThickness, vec3 baseF0 ) {
		vec3 I;
		float iridescenceIOR = mix( outsideIOR, eta2, smoothstep( 0.0, 0.03, thinFilmThickness ) );
		float sinTheta2Sq = pow2( outsideIOR / iridescenceIOR ) * ( 1.0 - pow2( cosTheta1 ) );
		float cosTheta2Sq = 1.0 - sinTheta2Sq;
		if ( cosTheta2Sq < 0.0 ) {
			return vec3( 1.0 );
		}
		float cosTheta2 = sqrt( cosTheta2Sq );
		float R0 = IorToFresnel0( iridescenceIOR, outsideIOR );
		float R12 = F_Schlick( R0, 1.0, cosTheta1 );
		float T121 = 1.0 - R12;
		float phi12 = 0.0;
		if ( iridescenceIOR < outsideIOR ) phi12 = PI;
		float phi21 = PI - phi12;
		vec3 baseIOR = Fresnel0ToIor( clamp( baseF0, 0.0, 0.9999 ) );		vec3 R1 = IorToFresnel0( baseIOR, iridescenceIOR );
		vec3 R23 = F_Schlick( R1, 1.0, cosTheta2 );
		vec3 phi23 = vec3( 0.0 );
		if ( baseIOR[ 0 ] < iridescenceIOR ) phi23[ 0 ] = PI;
		if ( baseIOR[ 1 ] < iridescenceIOR ) phi23[ 1 ] = PI;
		if ( baseIOR[ 2 ] < iridescenceIOR ) phi23[ 2 ] = PI;
		float OPD = 2.0 * iridescenceIOR * thinFilmThickness * cosTheta2;
		vec3 phi = vec3( phi21 ) + phi23;
		vec3 R123 = clamp( R12 * R23, 1e-5, 0.9999 );
		vec3 r123 = sqrt( R123 );
		vec3 Rs = pow2( T121 ) * R23 / ( vec3( 1.0 ) - R123 );
		vec3 C0 = R12 + Rs;
		I = C0;
		vec3 Cm = Rs - T121;
		for ( int m = 1; m <= 2; ++ m ) {
			Cm *= r123;
			vec3 Sm = 2.0 * evalSensitivity( float( m ) * OPD, float( m ) * phi );
			I += Cm * Sm;
		}
		return max( I, vec3( 0.0 ) );
	}
#endif`,BW=`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vBumpMapUv );
		vec2 dSTdy = dFdy( vBumpMapUv );
		float Hll = bumpScale * texture2D( bumpMap, vBumpMapUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vBumpMapUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy, float faceDirection ) {
		vec3 vSigmaX = normalize( dFdx( surf_pos.xyz ) );
		vec3 vSigmaY = normalize( dFdy( surf_pos.xyz ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 ) * faceDirection;
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,OW=`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#ifdef ALPHA_TO_COVERAGE
		float distanceToPlane, distanceGradient;
		float clipOpacity = 1.0;
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
			distanceGradient = fwidth( distanceToPlane ) / 2.0;
			clipOpacity *= smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			if ( clipOpacity == 0.0 ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			float unionClipOpacity = 1.0;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				distanceToPlane = - dot( vClipPosition, plane.xyz ) + plane.w;
				distanceGradient = fwidth( distanceToPlane ) / 2.0;
				unionClipOpacity *= 1.0 - smoothstep( - distanceGradient, distanceGradient, distanceToPlane );
			}
			#pragma unroll_loop_end
			clipOpacity *= 1.0 - unionClipOpacity;
		#endif
		diffuseColor.a *= clipOpacity;
		if ( diffuseColor.a == 0.0 ) discard;
	#else
		#pragma unroll_loop_start
		for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			if ( dot( vClipPosition, plane.xyz ) > plane.w ) discard;
		}
		#pragma unroll_loop_end
		#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
			bool clipped = true;
			#pragma unroll_loop_start
			for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
				plane = clippingPlanes[ i ];
				clipped = ( dot( vClipPosition, plane.xyz ) > plane.w ) && clipped;
			}
			#pragma unroll_loop_end
			if ( clipped ) discard;
		#endif
	#endif
#endif`,PW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,IW=`#if NUM_CLIPPING_PLANES > 0
	varying vec3 vClipPosition;
#endif`,FW=`#if NUM_CLIPPING_PLANES > 0
	vClipPosition = - mvPosition.xyz;
#endif`,zW=`#if defined( USE_COLOR_ALPHA )
	diffuseColor *= vColor;
#elif defined( USE_COLOR )
	diffuseColor.rgb *= vColor;
#endif`,VW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR )
	varying vec3 vColor;
#endif`,GW=`#if defined( USE_COLOR_ALPHA )
	varying vec4 vColor;
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	varying vec3 vColor;
#endif`,HW=`#if defined( USE_COLOR_ALPHA )
	vColor = vec4( 1.0 );
#elif defined( USE_COLOR ) || defined( USE_INSTANCING_COLOR ) || defined( USE_BATCHING_COLOR )
	vColor = vec3( 1.0 );
#endif
#ifdef USE_COLOR
	vColor *= color;
#endif
#ifdef USE_INSTANCING_COLOR
	vColor.xyz *= instanceColor.xyz;
#endif
#ifdef USE_BATCHING_COLOR
	vec3 batchingColor = getBatchingColor( getIndirectIndex( gl_DrawID ) );
	vColor.xyz *= batchingColor.xyz;
#endif`,kW=`#define PI 3.141592653589793
#define PI2 6.283185307179586
#define PI_HALF 1.5707963267948966
#define RECIPROCAL_PI 0.3183098861837907
#define RECIPROCAL_PI2 0.15915494309189535
#define EPSILON 1e-6
#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement( a ) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
vec3 pow2( const in vec3 x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float max3( const in vec3 v ) { return max( max( v.x, v.y ), v.z ); }
float average( const in vec3 v ) { return dot( v, vec3( 0.3333333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract( sin( sn ) * c );
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
#ifdef USE_ALPHAHASH
	varying vec3 vPosition;
#endif
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
bool isPerspectiveMatrix( mat4 m ) {
	return m[ 2 ][ 3 ] == - 1.0;
}
vec2 equirectUv( in vec3 dir ) {
	float u = atan( dir.z, dir.x ) * RECIPROCAL_PI2 + 0.5;
	float v = asin( clamp( dir.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	return vec2( u, v );
}
vec3 BRDF_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
}
float F_Schlick( const in float f0, const in float f90, const in float dotVH ) {
	float fresnel = exp2( ( - 5.55473 * dotVH - 6.98316 ) * dotVH );
	return f0 * ( 1.0 - fresnel ) + ( f90 * fresnel );
} // validated`,qW=`#ifdef ENVMAP_TYPE_CUBE_UV
	#define cubeUV_minMipLevel 4.0
	#define cubeUV_minTileSize 16.0
	float getFace( vec3 direction ) {
		vec3 absDirection = abs( direction );
		float face = - 1.0;
		if ( absDirection.x > absDirection.z ) {
			if ( absDirection.x > absDirection.y )
				face = direction.x > 0.0 ? 0.0 : 3.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		} else {
			if ( absDirection.z > absDirection.y )
				face = direction.z > 0.0 ? 2.0 : 5.0;
			else
				face = direction.y > 0.0 ? 1.0 : 4.0;
		}
		return face;
	}
	vec2 getUV( vec3 direction, float face ) {
		vec2 uv;
		if ( face == 0.0 ) {
			uv = vec2( direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 1.0 ) {
			uv = vec2( - direction.x, - direction.z ) / abs( direction.y );
		} else if ( face == 2.0 ) {
			uv = vec2( - direction.x, direction.y ) / abs( direction.z );
		} else if ( face == 3.0 ) {
			uv = vec2( - direction.z, direction.y ) / abs( direction.x );
		} else if ( face == 4.0 ) {
			uv = vec2( - direction.x, direction.z ) / abs( direction.y );
		} else {
			uv = vec2( direction.x, direction.y ) / abs( direction.z );
		}
		return 0.5 * ( uv + 1.0 );
	}
	vec3 bilinearCubeUV( sampler2D envMap, vec3 direction, float mipInt ) {
		float face = getFace( direction );
		float filterInt = max( cubeUV_minMipLevel - mipInt, 0.0 );
		mipInt = max( mipInt, cubeUV_minMipLevel );
		float faceSize = exp2( mipInt );
		highp vec2 uv = getUV( direction, face ) * ( faceSize - 2.0 ) + 1.0;
		if ( face > 2.0 ) {
			uv.y += faceSize;
			face -= 3.0;
		}
		uv.x += face * faceSize;
		uv.x += filterInt * 3.0 * cubeUV_minTileSize;
		uv.y += 4.0 * ( exp2( CUBEUV_MAX_MIP ) - faceSize );
		uv.x *= CUBEUV_TEXEL_WIDTH;
		uv.y *= CUBEUV_TEXEL_HEIGHT;
		#ifdef texture2DGradEXT
			return texture2DGradEXT( envMap, uv, vec2( 0.0 ), vec2( 0.0 ) ).rgb;
		#else
			return texture2D( envMap, uv ).rgb;
		#endif
	}
	#define cubeUV_r0 1.0
	#define cubeUV_m0 - 2.0
	#define cubeUV_r1 0.8
	#define cubeUV_m1 - 1.0
	#define cubeUV_r4 0.4
	#define cubeUV_m4 2.0
	#define cubeUV_r5 0.305
	#define cubeUV_m5 3.0
	#define cubeUV_r6 0.21
	#define cubeUV_m6 4.0
	float roughnessToMip( float roughness ) {
		float mip = 0.0;
		if ( roughness >= cubeUV_r1 ) {
			mip = ( cubeUV_r0 - roughness ) * ( cubeUV_m1 - cubeUV_m0 ) / ( cubeUV_r0 - cubeUV_r1 ) + cubeUV_m0;
		} else if ( roughness >= cubeUV_r4 ) {
			mip = ( cubeUV_r1 - roughness ) * ( cubeUV_m4 - cubeUV_m1 ) / ( cubeUV_r1 - cubeUV_r4 ) + cubeUV_m1;
		} else if ( roughness >= cubeUV_r5 ) {
			mip = ( cubeUV_r4 - roughness ) * ( cubeUV_m5 - cubeUV_m4 ) / ( cubeUV_r4 - cubeUV_r5 ) + cubeUV_m4;
		} else if ( roughness >= cubeUV_r6 ) {
			mip = ( cubeUV_r5 - roughness ) * ( cubeUV_m6 - cubeUV_m5 ) / ( cubeUV_r5 - cubeUV_r6 ) + cubeUV_m5;
		} else {
			mip = - 2.0 * log2( 1.16 * roughness );		}
		return mip;
	}
	vec4 textureCubeUV( sampler2D envMap, vec3 sampleDir, float roughness ) {
		float mip = clamp( roughnessToMip( roughness ), cubeUV_m0, CUBEUV_MAX_MIP );
		float mipF = fract( mip );
		float mipInt = floor( mip );
		vec3 color0 = bilinearCubeUV( envMap, sampleDir, mipInt );
		if ( mipF == 0.0 ) {
			return vec4( color0, 1.0 );
		} else {
			vec3 color1 = bilinearCubeUV( envMap, sampleDir, mipInt + 1.0 );
			return vec4( mix( color0, color1, mipF ), 1.0 );
		}
	}
#endif`,WW=`vec3 transformedNormal = objectNormal;
#ifdef USE_TANGENT
	vec3 transformedTangent = objectTangent;
#endif
#ifdef USE_BATCHING
	mat3 bm = mat3( batchingMatrix );
	transformedNormal /= vec3( dot( bm[ 0 ], bm[ 0 ] ), dot( bm[ 1 ], bm[ 1 ] ), dot( bm[ 2 ], bm[ 2 ] ) );
	transformedNormal = bm * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = bm * transformedTangent;
	#endif
#endif
#ifdef USE_INSTANCING
	mat3 im = mat3( instanceMatrix );
	transformedNormal /= vec3( dot( im[ 0 ], im[ 0 ] ), dot( im[ 1 ], im[ 1 ] ), dot( im[ 2 ], im[ 2 ] ) );
	transformedNormal = im * transformedNormal;
	#ifdef USE_TANGENT
		transformedTangent = im * transformedTangent;
	#endif
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	transformedTangent = ( modelViewMatrix * vec4( transformedTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,XW=`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,YW=`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vDisplacementMapUv ).x * displacementScale + displacementBias );
#endif`,jW=`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vEmissiveMapUv );
	#ifdef DECODE_VIDEO_TEXTURE_EMISSIVE
		emissiveColor = sRGBTransferEOTF( emissiveColor );
	#endif
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,ZW=`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,KW="gl_FragColor = linearToOutputTexel( gl_FragColor );",QW=`vec4 LinearTransferOETF( in vec4 value ) {
	return value;
}
vec4 sRGBTransferEOTF( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 sRGBTransferOETF( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}`,JW=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, envMapRotation * vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,$W=`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform mat3 envMapRotation;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,eX=`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,tX=`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG ) || defined( LAMBERT )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,nX=`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) {
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,iX=`#ifdef USE_FOG
	vFogDepth = - mvPosition.z;
#endif`,sX=`#ifdef USE_FOG
	varying float vFogDepth;
#endif`,rX=`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * vFogDepth * vFogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, vFogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,aX=`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float vFogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,oX=`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return vec3( texture2D( gradientMap, coord ).r );
	#else
		vec2 fw = fwidth( coord ) * 0.5;
		return mix( vec3( 0.7 ), vec3( 1.0 ), smoothstep( 0.7 - fw.x, 0.7 + fw.x, coord.x ) );
	#endif
}`,lX=`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,uX=`LambertMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularStrength = specularStrength;`,cX=`varying vec3 vViewPosition;
struct LambertMaterial {
	vec3 diffuseColor;
	float specularStrength;
};
void RE_Direct_Lambert( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Lambert( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in LambertMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Lambert
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Lambert`,hX=`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
#if defined( USE_LIGHT_PROBES )
	uniform vec3 lightProbe[ 9 ];
#endif
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in vec3 normal ) {
	vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	return irradiance;
}
float getDistanceAttenuation( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if ( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
}
float getSpotAttenuation( const in float coneCosine, const in float penumbraCosine, const in float angleCosine ) {
	return smoothstep( coneCosine, penumbraCosine, angleCosine );
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalLightInfo( const in DirectionalLight directionalLight, out IncidentLight light ) {
		light.color = directionalLight.color;
		light.direction = directionalLight.direction;
		light.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointLightInfo( const in PointLight pointLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = pointLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float lightDistance = length( lVector );
		light.color = pointLight.color;
		light.color *= getDistanceAttenuation( lightDistance, pointLight.distance, pointLight.decay );
		light.visible = ( light.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotLightInfo( const in SpotLight spotLight, const in vec3 geometryPosition, out IncidentLight light ) {
		vec3 lVector = spotLight.position - geometryPosition;
		light.direction = normalize( lVector );
		float angleCos = dot( light.direction, spotLight.direction );
		float spotAttenuation = getSpotAttenuation( spotLight.coneCos, spotLight.penumbraCos, angleCos );
		if ( spotAttenuation > 0.0 ) {
			float lightDistance = length( lVector );
			light.color = spotLight.color * spotAttenuation;
			light.color *= getDistanceAttenuation( lightDistance, spotLight.distance, spotLight.decay );
			light.visible = ( light.color != vec3( 0.0 ) );
		} else {
			light.color = vec3( 0.0 );
			light.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in vec3 normal ) {
		float dotNL = dot( normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		return irradiance;
	}
#endif`,fX=`#ifdef USE_ENVMAP
	vec3 getIBLIrradiance( const in vec3 normal ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * worldNormal, 1.0 );
			return PI * envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	vec3 getIBLRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness ) {
		#ifdef ENVMAP_TYPE_CUBE_UV
			vec3 reflectVec = reflect( - viewDir, normal );
			reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
			reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
			vec4 envMapColor = textureCubeUV( envMap, envMapRotation * reflectVec, roughness );
			return envMapColor.rgb * envMapIntensity;
		#else
			return vec3( 0.0 );
		#endif
	}
	#ifdef USE_ANISOTROPY
		vec3 getIBLAnisotropyRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in vec3 bitangent, const in float anisotropy ) {
			#ifdef ENVMAP_TYPE_CUBE_UV
				vec3 bentNormal = cross( bitangent, viewDir );
				bentNormal = normalize( cross( bentNormal, bitangent ) );
				bentNormal = normalize( mix( bentNormal, normal, pow2( pow2( 1.0 - anisotropy * ( 1.0 - roughness ) ) ) ) );
				return getIBLRadiance( viewDir, bentNormal, roughness );
			#else
				return vec3( 0.0 );
			#endif
		}
	#endif
#endif`,dX=`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;`,pX=`varying vec3 vViewPosition;
struct ToonMaterial {
	vec3 diffuseColor;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometryNormal, directLight.direction ) * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon`,mX=`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,gX=`varying vec3 vViewPosition;
struct BlinnPhongMaterial {
	vec3 diffuseColor;
	vec3 specularColor;
	float specularShininess;
	float specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_BlinnPhong( directLight.direction, geometryViewDir, geometryNormal, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong`,yX=`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( nonPerturbedNormal ) ), abs( dFdy( nonPerturbedNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.roughness = max( roughnessFactor, 0.0525 );material.roughness += geometryRoughness;
material.roughness = min( material.roughness, 1.0 );
#ifdef IOR
	material.ior = ior;
	#ifdef USE_SPECULAR
		float specularIntensityFactor = specularIntensity;
		vec3 specularColorFactor = specularColor;
		#ifdef USE_SPECULAR_COLORMAP
			specularColorFactor *= texture2D( specularColorMap, vSpecularColorMapUv ).rgb;
		#endif
		#ifdef USE_SPECULAR_INTENSITYMAP
			specularIntensityFactor *= texture2D( specularIntensityMap, vSpecularIntensityMapUv ).a;
		#endif
		material.specularF90 = mix( specularIntensityFactor, 1.0, metalnessFactor );
	#else
		float specularIntensityFactor = 1.0;
		vec3 specularColorFactor = vec3( 1.0 );
		material.specularF90 = 1.0;
	#endif
	material.specularColor = mix( min( pow2( ( material.ior - 1.0 ) / ( material.ior + 1.0 ) ) * specularColorFactor, vec3( 1.0 ) ) * specularIntensityFactor, diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( 0.04 ), diffuseColor.rgb, metalnessFactor );
	material.specularF90 = 1.0;
#endif
#ifdef USE_CLEARCOAT
	material.clearcoat = clearcoat;
	material.clearcoatRoughness = clearcoatRoughness;
	material.clearcoatF0 = vec3( 0.04 );
	material.clearcoatF90 = 1.0;
	#ifdef USE_CLEARCOATMAP
		material.clearcoat *= texture2D( clearcoatMap, vClearcoatMapUv ).x;
	#endif
	#ifdef USE_CLEARCOAT_ROUGHNESSMAP
		material.clearcoatRoughness *= texture2D( clearcoatRoughnessMap, vClearcoatRoughnessMapUv ).y;
	#endif
	material.clearcoat = saturate( material.clearcoat );	material.clearcoatRoughness = max( material.clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_DISPERSION
	material.dispersion = dispersion;
#endif
#ifdef USE_IRIDESCENCE
	material.iridescence = iridescence;
	material.iridescenceIOR = iridescenceIOR;
	#ifdef USE_IRIDESCENCEMAP
		material.iridescence *= texture2D( iridescenceMap, vIridescenceMapUv ).r;
	#endif
	#ifdef USE_IRIDESCENCE_THICKNESSMAP
		material.iridescenceThickness = (iridescenceThicknessMaximum - iridescenceThicknessMinimum) * texture2D( iridescenceThicknessMap, vIridescenceThicknessMapUv ).g + iridescenceThicknessMinimum;
	#else
		material.iridescenceThickness = iridescenceThicknessMaximum;
	#endif
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheenColor;
	#ifdef USE_SHEEN_COLORMAP
		material.sheenColor *= texture2D( sheenColorMap, vSheenColorMapUv ).rgb;
	#endif
	material.sheenRoughness = clamp( sheenRoughness, 0.07, 1.0 );
	#ifdef USE_SHEEN_ROUGHNESSMAP
		material.sheenRoughness *= texture2D( sheenRoughnessMap, vSheenRoughnessMapUv ).a;
	#endif
#endif
#ifdef USE_ANISOTROPY
	#ifdef USE_ANISOTROPYMAP
		mat2 anisotropyMat = mat2( anisotropyVector.x, anisotropyVector.y, - anisotropyVector.y, anisotropyVector.x );
		vec3 anisotropyPolar = texture2D( anisotropyMap, vAnisotropyMapUv ).rgb;
		vec2 anisotropyV = anisotropyMat * normalize( 2.0 * anisotropyPolar.rg - vec2( 1.0 ) ) * anisotropyPolar.b;
	#else
		vec2 anisotropyV = anisotropyVector;
	#endif
	material.anisotropy = length( anisotropyV );
	if( material.anisotropy == 0.0 ) {
		anisotropyV = vec2( 1.0, 0.0 );
	} else {
		anisotropyV /= material.anisotropy;
		material.anisotropy = saturate( material.anisotropy );
	}
	material.alphaT = mix( pow2( material.roughness ), 1.0, pow2( material.anisotropy ) );
	material.anisotropyT = tbn[ 0 ] * anisotropyV.x + tbn[ 1 ] * anisotropyV.y;
	material.anisotropyB = tbn[ 1 ] * anisotropyV.x - tbn[ 0 ] * anisotropyV.y;
#endif`,vX=`struct PhysicalMaterial {
	vec3 diffuseColor;
	float roughness;
	vec3 specularColor;
	float specularF90;
	float dispersion;
	#ifdef USE_CLEARCOAT
		float clearcoat;
		float clearcoatRoughness;
		vec3 clearcoatF0;
		float clearcoatF90;
	#endif
	#ifdef USE_IRIDESCENCE
		float iridescence;
		float iridescenceIOR;
		float iridescenceThickness;
		vec3 iridescenceFresnel;
		vec3 iridescenceF0;
	#endif
	#ifdef USE_SHEEN
		vec3 sheenColor;
		float sheenRoughness;
	#endif
	#ifdef IOR
		float ior;
	#endif
	#ifdef USE_TRANSMISSION
		float transmission;
		float transmissionAlpha;
		float thickness;
		float attenuationDistance;
		vec3 attenuationColor;
	#endif
	#ifdef USE_ANISOTROPY
		float anisotropy;
		float alphaT;
		vec3 anisotropyT;
		vec3 anisotropyB;
	#endif
};
vec3 clearcoatSpecularDirect = vec3( 0.0 );
vec3 clearcoatSpecularIndirect = vec3( 0.0 );
vec3 sheenSpecularDirect = vec3( 0.0 );
vec3 sheenSpecularIndirect = vec3(0.0 );
vec3 Schlick_to_F0( const in vec3 f, const in float f90, const in float dotVH ) {
    float x = clamp( 1.0 - dotVH, 0.0, 1.0 );
    float x2 = x * x;
    float x5 = clamp( x * x2 * x2, 0.0, 0.9999 );
    return ( f - vec3( f90 ) * x5 ) / ( 1.0 - x5 );
}
float V_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
#ifdef USE_ANISOTROPY
	float V_GGX_SmithCorrelated_Anisotropic( const in float alphaT, const in float alphaB, const in float dotTV, const in float dotBV, const in float dotTL, const in float dotBL, const in float dotNV, const in float dotNL ) {
		float gv = dotNL * length( vec3( alphaT * dotTV, alphaB * dotBV, dotNV ) );
		float gl = dotNV * length( vec3( alphaT * dotTL, alphaB * dotBL, dotNL ) );
		float v = 0.5 / ( gv + gl );
		return saturate(v);
	}
	float D_GGX_Anisotropic( const in float alphaT, const in float alphaB, const in float dotNH, const in float dotTH, const in float dotBH ) {
		float a2 = alphaT * alphaB;
		highp vec3 v = vec3( alphaB * dotTH, alphaT * dotBH, a2 * dotNH );
		highp float v2 = dot( v, v );
		float w2 = a2 / v2;
		return RECIPROCAL_PI * a2 * pow2 ( w2 );
	}
#endif
#ifdef USE_CLEARCOAT
	vec3 BRDF_GGX_Clearcoat( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material) {
		vec3 f0 = material.clearcoatF0;
		float f90 = material.clearcoatF90;
		float roughness = material.clearcoatRoughness;
		float alpha = pow2( roughness );
		vec3 halfDir = normalize( lightDir + viewDir );
		float dotNL = saturate( dot( normal, lightDir ) );
		float dotNV = saturate( dot( normal, viewDir ) );
		float dotNH = saturate( dot( normal, halfDir ) );
		float dotVH = saturate( dot( viewDir, halfDir ) );
		vec3 F = F_Schlick( f0, f90, dotVH );
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
		return F * ( V * D );
	}
#endif
vec3 BRDF_GGX( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, const in PhysicalMaterial material ) {
	vec3 f0 = material.specularColor;
	float f90 = material.specularF90;
	float roughness = material.roughness;
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotVH = saturate( dot( viewDir, halfDir ) );
	vec3 F = F_Schlick( f0, f90, dotVH );
	#ifdef USE_IRIDESCENCE
		F = mix( F, material.iridescenceFresnel, material.iridescence );
	#endif
	#ifdef USE_ANISOTROPY
		float dotTL = dot( material.anisotropyT, lightDir );
		float dotTV = dot( material.anisotropyT, viewDir );
		float dotTH = dot( material.anisotropyT, halfDir );
		float dotBL = dot( material.anisotropyB, lightDir );
		float dotBV = dot( material.anisotropyB, viewDir );
		float dotBH = dot( material.anisotropyB, halfDir );
		float V = V_GGX_SmithCorrelated_Anisotropic( material.alphaT, alpha, dotTV, dotBV, dotTL, dotBL, dotNV, dotNL );
		float D = D_GGX_Anisotropic( material.alphaT, alpha, dotNH, dotTH, dotBH );
	#else
		float V = V_GGX_SmithCorrelated( alpha, dotNL, dotNV );
		float D = D_GGX( alpha, dotNH );
	#endif
	return F * ( V * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
#if defined( USE_SHEEN )
float D_Charlie( float roughness, float dotNH ) {
	float alpha = pow2( roughness );
	float invAlpha = 1.0 / alpha;
	float cos2h = dotNH * dotNH;
	float sin2h = max( 1.0 - cos2h, 0.0078125 );
	return ( 2.0 + invAlpha ) * pow( sin2h, invAlpha * 0.5 ) / ( 2.0 * PI );
}
float V_Neubelt( float dotNV, float dotNL ) {
	return saturate( 1.0 / ( 4.0 * ( dotNL + dotNV - dotNL * dotNV ) ) );
}
vec3 BRDF_Sheen( const in vec3 lightDir, const in vec3 viewDir, const in vec3 normal, vec3 sheenColor, const in float sheenRoughness ) {
	vec3 halfDir = normalize( lightDir + viewDir );
	float dotNL = saturate( dot( normal, lightDir ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float D = D_Charlie( sheenRoughness, dotNH );
	float V = V_Neubelt( dotNV, dotNL );
	return sheenColor * ( D * V );
}
#endif
float IBLSheenBRDF( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	float r2 = roughness * roughness;
	float a = roughness < 0.25 ? -339.2 * r2 + 161.4 * roughness - 25.9 : -8.48 * r2 + 14.3 * roughness - 9.95;
	float b = roughness < 0.25 ? 44.0 * r2 - 23.7 * roughness + 3.26 : 1.97 * r2 - 3.27 * roughness + 0.72;
	float DG = exp( a * dotNV + b ) + ( roughness < 0.25 ? 0.0 : 0.1 * ( roughness - 0.25 ) );
	return saturate( DG * RECIPROCAL_PI );
}
vec2 DFGApprox( const in vec3 normal, const in vec3 viewDir, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	vec2 fab = vec2( - 1.04, 1.04 ) * a004 + r.zw;
	return fab;
}
vec3 EnvironmentBRDF( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness ) {
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	return specularColor * fab.x + specularF90 * fab.y;
}
#ifdef USE_IRIDESCENCE
void computeMultiscatteringIridescence( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float iridescence, const in vec3 iridescenceF0, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#else
void computeMultiscattering( const in vec3 normal, const in vec3 viewDir, const in vec3 specularColor, const in float specularF90, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
#endif
	vec2 fab = DFGApprox( normal, viewDir, roughness );
	#ifdef USE_IRIDESCENCE
		vec3 Fr = mix( specularColor, iridescenceF0, iridescence );
	#else
		vec3 Fr = specularColor;
	#endif
	vec3 FssEss = Fr * fab.x + specularF90 * fab.y;
	float Ess = fab.x + fab.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = Fr + ( 1.0 - Fr ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometryNormal;
		vec3 viewDir = geometryViewDir;
		vec3 position = geometryPosition;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.roughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometryNormal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifdef USE_CLEARCOAT
		float dotNLcc = saturate( dot( geometryClearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = dotNLcc * directLight.color;
		clearcoatSpecularDirect += ccIrradiance * BRDF_GGX_Clearcoat( directLight.direction, geometryViewDir, geometryClearcoatNormal, material );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularDirect += irradiance * BRDF_Sheen( directLight.direction, geometryViewDir, geometryNormal, material.sheenColor, material.sheenRoughness );
	#endif
	reflectedLight.directSpecular += irradiance * BRDF_GGX( directLight.direction, geometryViewDir, geometryNormal, material );
	reflectedLight.directDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in vec3 geometryPosition, const in vec3 geometryNormal, const in vec3 geometryViewDir, const in vec3 geometryClearcoatNormal, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef USE_CLEARCOAT
		clearcoatSpecularIndirect += clearcoatRadiance * EnvironmentBRDF( geometryClearcoatNormal, geometryViewDir, material.clearcoatF0, material.clearcoatF90, material.clearcoatRoughness );
	#endif
	#ifdef USE_SHEEN
		sheenSpecularIndirect += irradiance * material.sheenColor * IBLSheenBRDF( geometryNormal, geometryViewDir, material.sheenRoughness );
	#endif
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	#ifdef USE_IRIDESCENCE
		computeMultiscatteringIridescence( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.iridescence, material.iridescenceFresnel, material.roughness, singleScattering, multiScattering );
	#else
		computeMultiscattering( geometryNormal, geometryViewDir, material.specularColor, material.specularF90, material.roughness, singleScattering, multiScattering );
	#endif
	vec3 totalScattering = singleScattering + multiScattering;
	vec3 diffuse = material.diffuseColor * ( 1.0 - max( max( totalScattering.r, totalScattering.g ), totalScattering.b ) );
	reflectedLight.indirectSpecular += radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,_X=`
vec3 geometryPosition = - vViewPosition;
vec3 geometryNormal = normal;
vec3 geometryViewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
vec3 geometryClearcoatNormal = vec3( 0.0 );
#ifdef USE_CLEARCOAT
	geometryClearcoatNormal = clearcoatNormal;
#endif
#ifdef USE_IRIDESCENCE
	float dotNVi = saturate( dot( normal, geometryViewDir ) );
	if ( material.iridescenceThickness == 0.0 ) {
		material.iridescence = 0.0;
	} else {
		material.iridescence = saturate( material.iridescence );
	}
	if ( material.iridescence > 0.0 ) {
		material.iridescenceFresnel = evalIridescence( 1.0, material.iridescenceIOR, dotNVi, material.iridescenceThickness, material.specularColor );
		material.iridescenceF0 = Schlick_to_F0( material.iridescenceFresnel, 1.0, dotNVi );
	}
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#if defined( USE_SHADOWMAP ) && NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointLightInfo( pointLight, geometryPosition, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		pointLightShadow = pointLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getPointShadow( pointShadowMap[ i ], pointLightShadow.shadowMapSize, pointLightShadow.shadowIntensity, pointLightShadow.shadowBias, pointLightShadow.shadowRadius, vPointShadowCoord[ i ], pointLightShadow.shadowCameraNear, pointLightShadow.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	vec4 spotColor;
	vec3 spotLightCoord;
	bool inSpotLightMap;
	#if defined( USE_SHADOWMAP ) && NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotLightInfo( spotLight, geometryPosition, directLight );
		#if ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#define SPOT_LIGHT_MAP_INDEX UNROLLED_LOOP_INDEX
		#elif ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		#define SPOT_LIGHT_MAP_INDEX NUM_SPOT_LIGHT_MAPS
		#else
		#define SPOT_LIGHT_MAP_INDEX ( UNROLLED_LOOP_INDEX - NUM_SPOT_LIGHT_SHADOWS + NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS )
		#endif
		#if ( SPOT_LIGHT_MAP_INDEX < NUM_SPOT_LIGHT_MAPS )
			spotLightCoord = vSpotLightCoord[ i ].xyz / vSpotLightCoord[ i ].w;
			inSpotLightMap = all( lessThan( abs( spotLightCoord * 2. - 1. ), vec3( 1.0 ) ) );
			spotColor = texture2D( spotLightMap[ SPOT_LIGHT_MAP_INDEX ], spotLightCoord.xy );
			directLight.color = inSpotLightMap ? directLight.color * spotColor.rgb : directLight.color;
		#endif
		#undef SPOT_LIGHT_MAP_INDEX
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		spotLightShadow = spotLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( spotShadowMap[ i ], spotLightShadow.shadowMapSize, spotLightShadow.shadowIntensity, spotLightShadow.shadowBias, spotLightShadow.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#if defined( USE_SHADOWMAP ) && NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLightShadow;
	#endif
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalLightInfo( directionalLight, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directionalLightShadow = directionalLightShadows[ i ];
		directLight.color *= ( directLight.visible && receiveShadow ) ? getShadow( directionalShadowMap[ i ], directionalLightShadow.shadowMapSize, directionalLightShadow.shadowIntensity, directionalLightShadow.shadowBias, directionalLightShadow.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
	}
	#pragma unroll_loop_end
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	#if defined( USE_LIGHT_PROBES )
		irradiance += getLightProbeIrradiance( lightProbe, geometryNormal );
	#endif
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometryNormal );
		}
		#pragma unroll_loop_end
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,xX=`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		vec3 lightMapIrradiance = lightMapTexel.rgb * lightMapIntensity;
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getIBLIrradiance( geometryNormal );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	#ifdef USE_ANISOTROPY
		radiance += getIBLAnisotropyRadiance( geometryViewDir, geometryNormal, material.roughness, material.anisotropyB, material.anisotropy );
	#else
		radiance += getIBLRadiance( geometryViewDir, geometryNormal, material.roughness );
	#endif
	#ifdef USE_CLEARCOAT
		clearcoatRadiance += getIBLRadiance( geometryViewDir, geometryClearcoatNormal, material.clearcoatRoughness );
	#endif
#endif`,SX=`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometryPosition, geometryNormal, geometryViewDir, geometryClearcoatNormal, material, reflectedLight );
#endif`,bX=`#if defined( USE_LOGDEPTHBUF )
	gl_FragDepth = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,TX=`#if defined( USE_LOGDEPTHBUF )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,MX=`#ifdef USE_LOGDEPTHBUF
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,EX=`#ifdef USE_LOGDEPTHBUF
	vFragDepth = 1.0 + gl_Position.w;
	vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
#endif`,AX=`#ifdef USE_MAP
	vec4 sampledDiffuseColor = texture2D( map, vMapUv );
	#ifdef DECODE_VIDEO_TEXTURE
		sampledDiffuseColor = sRGBTransferEOTF( sampledDiffuseColor );
	#endif
	diffuseColor *= sampledDiffuseColor;
#endif`,RX=`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,NX=`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	#if defined( USE_POINTS_UV )
		vec2 uv = vUv;
	#else
		vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
	#endif
#endif
#ifdef USE_MAP
	diffuseColor *= texture2D( map, uv );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,CX=`#if defined( USE_POINTS_UV )
	varying vec2 vUv;
#else
	#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
		uniform mat3 uvTransform;
	#endif
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,wX=`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vMetalnessMapUv );
	metalnessFactor *= texelMetalness.b;
#endif`,DX=`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,UX=`#ifdef USE_INSTANCING_MORPH
	float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	float morphTargetBaseInfluence = texelFetch( morphTexture, ivec2( 0, gl_InstanceID ), 0 ).r;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		morphTargetInfluences[i] =  texelFetch( morphTexture, ivec2( i + 1, gl_InstanceID ), 0 ).r;
	}
#endif`,LX=`#if defined( USE_MORPHCOLORS )
	vColor *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		#if defined( USE_COLOR_ALPHA )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ) * morphTargetInfluences[ i ];
		#elif defined( USE_COLOR )
			if ( morphTargetInfluences[ i ] != 0.0 ) vColor += getMorph( gl_VertexID, i, 2 ).rgb * morphTargetInfluences[ i ];
		#endif
	}
#endif`,BX=`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) objectNormal += getMorph( gl_VertexID, i, 1 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,OX=`#ifdef USE_MORPHTARGETS
	#ifndef USE_INSTANCING_MORPH
		uniform float morphTargetBaseInfluence;
		uniform float morphTargetInfluences[ MORPHTARGETS_COUNT ];
	#endif
	uniform sampler2DArray morphTargetsTexture;
	uniform ivec2 morphTargetsTextureSize;
	vec4 getMorph( const in int vertexIndex, const in int morphTargetIndex, const in int offset ) {
		int texelIndex = vertexIndex * MORPHTARGETS_TEXTURE_STRIDE + offset;
		int y = texelIndex / morphTargetsTextureSize.x;
		int x = texelIndex - y * morphTargetsTextureSize.x;
		ivec3 morphUV = ivec3( x, y, morphTargetIndex );
		return texelFetch( morphTargetsTexture, morphUV, 0 );
	}
#endif`,PX=`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	for ( int i = 0; i < MORPHTARGETS_COUNT; i ++ ) {
		if ( morphTargetInfluences[ i ] != 0.0 ) transformed += getMorph( gl_VertexID, i, 0 ).xyz * morphTargetInfluences[ i ];
	}
#endif`,IX=`float faceDirection = gl_FrontFacing ? 1.0 : - 1.0;
#ifdef FLAT_SHADED
	vec3 fdx = dFdx( vViewPosition );
	vec3 fdy = dFdy( vViewPosition );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal *= faceDirection;
	#endif
#endif
#if defined( USE_NORMALMAP_TANGENTSPACE ) || defined( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY )
	#ifdef USE_TANGENT
		mat3 tbn = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn = getTangentFrame( - vViewPosition, normal,
		#if defined( USE_NORMALMAP )
			vNormalMapUv
		#elif defined( USE_CLEARCOAT_NORMALMAP )
			vClearcoatNormalMapUv
		#else
			vUv
		#endif
		);
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn[0] *= faceDirection;
		tbn[1] *= faceDirection;
	#endif
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	#ifdef USE_TANGENT
		mat3 tbn2 = mat3( normalize( vTangent ), normalize( vBitangent ), normal );
	#else
		mat3 tbn2 = getTangentFrame( - vViewPosition, normal, vClearcoatNormalMapUv );
	#endif
	#if defined( DOUBLE_SIDED ) && ! defined( FLAT_SHADED )
		tbn2[0] *= faceDirection;
		tbn2[1] *= faceDirection;
	#endif
#endif
vec3 nonPerturbedNormal = normal;`,FX=`#ifdef USE_NORMALMAP_OBJECTSPACE
	normal = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * faceDirection;
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( USE_NORMALMAP_TANGENTSPACE )
	vec3 mapN = texture2D( normalMap, vNormalMapUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	normal = normalize( tbn * mapN );
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( - vViewPosition, normal, dHdxy_fwd(), faceDirection );
#endif`,zX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,VX=`#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif`,GX=`#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif`,HX=`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef USE_NORMALMAP_OBJECTSPACE
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( USE_NORMALMAP_TANGENTSPACE ) || defined ( USE_CLEARCOAT_NORMALMAP ) || defined( USE_ANISOTROPY ) )
	mat3 getTangentFrame( vec3 eye_pos, vec3 surf_norm, vec2 uv ) {
		vec3 q0 = dFdx( eye_pos.xyz );
		vec3 q1 = dFdy( eye_pos.xyz );
		vec2 st0 = dFdx( uv.st );
		vec2 st1 = dFdy( uv.st );
		vec3 N = surf_norm;
		vec3 q1perp = cross( q1, N );
		vec3 q0perp = cross( N, q0 );
		vec3 T = q1perp * st0.x + q0perp * st1.x;
		vec3 B = q1perp * st0.y + q0perp * st1.y;
		float det = max( dot( T, T ), dot( B, B ) );
		float scale = ( det == 0.0 ) ? 0.0 : inversesqrt( det );
		return mat3( T * scale, B * scale, N );
	}
#endif`,kX=`#ifdef USE_CLEARCOAT
	vec3 clearcoatNormal = nonPerturbedNormal;
#endif`,qX=`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vClearcoatNormalMapUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	clearcoatNormal = normalize( tbn2 * clearcoatMapN );
#endif`,WX=`#ifdef USE_CLEARCOATMAP
	uniform sampler2D clearcoatMap;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform sampler2D clearcoatRoughnessMap;
#endif`,XX=`#ifdef USE_IRIDESCENCEMAP
	uniform sampler2D iridescenceMap;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform sampler2D iridescenceThicknessMap;
#endif`,YX=`#ifdef OPAQUE
diffuseColor.a = 1.0;
#endif
#ifdef USE_TRANSMISSION
diffuseColor.a *= material.transmissionAlpha;
#endif
gl_FragColor = vec4( outgoingLight, diffuseColor.a );`,jX=`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;const float ShiftRight8 = 1. / 256.;
const float Inv255 = 1. / 255.;
const vec4 PackFactors = vec4( 1.0, 256.0, 256.0 * 256.0, 256.0 * 256.0 * 256.0 );
const vec2 UnpackFactors2 = vec2( UnpackDownscale, 1.0 / PackFactors.g );
const vec3 UnpackFactors3 = vec3( UnpackDownscale / PackFactors.rg, 1.0 / PackFactors.b );
const vec4 UnpackFactors4 = vec4( UnpackDownscale / PackFactors.rgb, 1.0 / PackFactors.a );
vec4 packDepthToRGBA( const in float v ) {
	if( v <= 0.0 )
		return vec4( 0., 0., 0., 0. );
	if( v >= 1.0 )
		return vec4( 1., 1., 1., 1. );
	float vuf;
	float af = modf( v * PackFactors.a, vuf );
	float bf = modf( vuf * ShiftRight8, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec4( vuf * Inv255, gf * PackUpscale, bf * PackUpscale, af );
}
vec3 packDepthToRGB( const in float v ) {
	if( v <= 0.0 )
		return vec3( 0., 0., 0. );
	if( v >= 1.0 )
		return vec3( 1., 1., 1. );
	float vuf;
	float bf = modf( v * PackFactors.b, vuf );
	float gf = modf( vuf * ShiftRight8, vuf );
	return vec3( vuf * Inv255, gf * PackUpscale, bf );
}
vec2 packDepthToRG( const in float v ) {
	if( v <= 0.0 )
		return vec2( 0., 0. );
	if( v >= 1.0 )
		return vec2( 1., 1. );
	float vuf;
	float gf = modf( v * 256., vuf );
	return vec2( vuf * Inv255, gf );
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors4 );
}
float unpackRGBToDepth( const in vec3 v ) {
	return dot( v, UnpackFactors3 );
}
float unpackRGToDepth( const in vec2 v ) {
	return v.r * UnpackFactors2.r + v.g * UnpackFactors2.g;
}
vec4 pack2HalfToRGBA( const in vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ) );
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w );
}
vec2 unpackRGBATo2Half( const in vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return depth * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return ( ( near + viewZ ) * far ) / ( ( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float depth, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * depth - far );
}`,ZX=`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,KX=`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_BATCHING
	mvPosition = batchingMatrix * mvPosition;
#endif
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,QX=`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,JX=`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,$X=`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vRoughnessMapUv );
	roughnessFactor *= texelRoughness.g;
#endif`,eY=`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,tY=`#if NUM_SPOT_LIGHT_COORDS > 0
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#if NUM_SPOT_LIGHT_MAPS > 0
	uniform sampler2D spotLightMap[ NUM_SPOT_LIGHT_MAPS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bool inFrustum = shadowCoord.x >= 0.0 && shadowCoord.x <= 1.0 && shadowCoord.y >= 0.0 && shadowCoord.y <= 1.0;
		bool frustumTest = inFrustum && shadowCoord.z <= 1.0;
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ),
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ),
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowIntensity, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		float shadow = 1.0;
		vec3 lightToPosition = shadowCoord.xyz;
		
		float lightToPositionLength = length( lightToPosition );
		if ( lightToPositionLength - shadowCameraFar <= 0.0 && lightToPositionLength - shadowCameraNear >= 0.0 ) {
			float dp = ( lightToPositionLength - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );			dp += shadowBias;
			vec3 bd3D = normalize( lightToPosition );
			vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
			#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
				vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
				shadow = (
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
					texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
				) * ( 1.0 / 9.0 );
			#else
				shadow = texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
			#endif
		}
		return mix( 1.0, shadow, shadowIntensity );
	}
#endif`,nY=`#if NUM_SPOT_LIGHT_COORDS > 0
	uniform mat4 spotLightMatrix[ NUM_SPOT_LIGHT_COORDS ];
	varying vec4 vSpotLightCoord[ NUM_SPOT_LIGHT_COORDS ];
#endif
#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
		struct DirectionalLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform DirectionalLightShadow directionalLightShadows[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		struct SpotLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
		};
		uniform SpotLightShadow spotLightShadows[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
		struct PointLightShadow {
			float shadowIntensity;
			float shadowBias;
			float shadowNormalBias;
			float shadowRadius;
			vec2 shadowMapSize;
			float shadowCameraNear;
			float shadowCameraFar;
		};
		uniform PointLightShadow pointLightShadows[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,iY=`#if ( defined( USE_SHADOWMAP ) && ( NUM_DIR_LIGHT_SHADOWS > 0 || NUM_POINT_LIGHT_SHADOWS > 0 ) ) || ( NUM_SPOT_LIGHT_COORDS > 0 )
	vec3 shadowWorldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
	vec4 shadowWorldPosition;
#endif
#if defined( USE_SHADOWMAP )
	#if NUM_DIR_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * directionalLightShadows[ i ].shadowNormalBias, 0 );
			vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		#pragma unroll_loop_start
		for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
			shadowWorldPosition = worldPosition + vec4( shadowWorldNormal * pointLightShadows[ i ].shadowNormalBias, 0 );
			vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * shadowWorldPosition;
		}
		#pragma unroll_loop_end
	#endif
#endif
#if NUM_SPOT_LIGHT_COORDS > 0
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_COORDS; i ++ ) {
		shadowWorldPosition = worldPosition;
		#if ( defined( USE_SHADOWMAP ) && UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
			shadowWorldPosition.xyz += shadowWorldNormal * spotLightShadows[ i ].shadowNormalBias;
		#endif
		vSpotLightCoord[ i ] = spotLightMatrix[ i ] * shadowWorldPosition;
	}
	#pragma unroll_loop_end
#endif`,sY=`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLightShadow directionalLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowIntensity, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLightShadow spotLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLightShadows[ i ];
		shadow *= receiveShadow ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowIntensity, spotLight.shadowBias, spotLight.shadowRadius, vSpotLightCoord[ i ] ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLightShadow pointLight;
	#pragma unroll_loop_start
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLightShadows[ i ];
		shadow *= receiveShadow ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowIntensity, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#pragma unroll_loop_end
	#endif
	#endif
	return shadow;
}`,rY=`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,aY=`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	uniform highp sampler2D boneTexture;
	mat4 getBoneMatrix( const in float i ) {
		int size = textureSize( boneTexture, 0 ).x;
		int j = int( i ) * 4;
		int x = j % size;
		int y = j / size;
		vec4 v1 = texelFetch( boneTexture, ivec2( x, y ), 0 );
		vec4 v2 = texelFetch( boneTexture, ivec2( x + 1, y ), 0 );
		vec4 v3 = texelFetch( boneTexture, ivec2( x + 2, y ), 0 );
		vec4 v4 = texelFetch( boneTexture, ivec2( x + 3, y ), 0 );
		return mat4( v1, v2, v3, v4 );
	}
#endif`,oY=`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,lY=`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,uY=`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vSpecularMapUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,cY=`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,hY=`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,fY=`#ifndef saturate
#define saturate( a ) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
vec3 LinearToneMapping( vec3 color ) {
	return saturate( toneMappingExposure * color );
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
vec3 CineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 RRTAndODTFit( vec3 v ) {
	vec3 a = v * ( v + 0.0245786 ) - 0.000090537;
	vec3 b = v * ( 0.983729 * v + 0.4329510 ) + 0.238081;
	return a / b;
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	const mat3 ACESInputMat = mat3(
		vec3( 0.59719, 0.07600, 0.02840 ),		vec3( 0.35458, 0.90834, 0.13383 ),
		vec3( 0.04823, 0.01566, 0.83777 )
	);
	const mat3 ACESOutputMat = mat3(
		vec3(  1.60475, -0.10208, -0.00327 ),		vec3( -0.53108,  1.10813, -0.07276 ),
		vec3( -0.07367, -0.00605,  1.07602 )
	);
	color *= toneMappingExposure / 0.6;
	color = ACESInputMat * color;
	color = RRTAndODTFit( color );
	color = ACESOutputMat * color;
	return saturate( color );
}
const mat3 LINEAR_REC2020_TO_LINEAR_SRGB = mat3(
	vec3( 1.6605, - 0.1246, - 0.0182 ),
	vec3( - 0.5876, 1.1329, - 0.1006 ),
	vec3( - 0.0728, - 0.0083, 1.1187 )
);
const mat3 LINEAR_SRGB_TO_LINEAR_REC2020 = mat3(
	vec3( 0.6274, 0.0691, 0.0164 ),
	vec3( 0.3293, 0.9195, 0.0880 ),
	vec3( 0.0433, 0.0113, 0.8956 )
);
vec3 agxDefaultContrastApprox( vec3 x ) {
	vec3 x2 = x * x;
	vec3 x4 = x2 * x2;
	return + 15.5 * x4 * x2
		- 40.14 * x4 * x
		+ 31.96 * x4
		- 6.868 * x2 * x
		+ 0.4298 * x2
		+ 0.1191 * x
		- 0.00232;
}
vec3 AgXToneMapping( vec3 color ) {
	const mat3 AgXInsetMatrix = mat3(
		vec3( 0.856627153315983, 0.137318972929847, 0.11189821299995 ),
		vec3( 0.0951212405381588, 0.761241990602591, 0.0767994186031903 ),
		vec3( 0.0482516061458583, 0.101439036467562, 0.811302368396859 )
	);
	const mat3 AgXOutsetMatrix = mat3(
		vec3( 1.1271005818144368, - 0.1413297634984383, - 0.14132976349843826 ),
		vec3( - 0.11060664309660323, 1.157823702216272, - 0.11060664309660294 ),
		vec3( - 0.016493938717834573, - 0.016493938717834257, 1.2519364065950405 )
	);
	const float AgxMinEv = - 12.47393;	const float AgxMaxEv = 4.026069;
	color *= toneMappingExposure;
	color = LINEAR_SRGB_TO_LINEAR_REC2020 * color;
	color = AgXInsetMatrix * color;
	color = max( color, 1e-10 );	color = log2( color );
	color = ( color - AgxMinEv ) / ( AgxMaxEv - AgxMinEv );
	color = clamp( color, 0.0, 1.0 );
	color = agxDefaultContrastApprox( color );
	color = AgXOutsetMatrix * color;
	color = pow( max( vec3( 0.0 ), color ), vec3( 2.2 ) );
	color = LINEAR_REC2020_TO_LINEAR_SRGB * color;
	color = clamp( color, 0.0, 1.0 );
	return color;
}
vec3 NeutralToneMapping( vec3 color ) {
	const float StartCompression = 0.8 - 0.04;
	const float Desaturation = 0.15;
	color *= toneMappingExposure;
	float x = min( color.r, min( color.g, color.b ) );
	float offset = x < 0.08 ? x - 6.25 * x * x : 0.04;
	color -= offset;
	float peak = max( color.r, max( color.g, color.b ) );
	if ( peak < StartCompression ) return color;
	float d = 1. - StartCompression;
	float newPeak = 1. - d * d / ( peak + d - StartCompression );
	color *= newPeak / peak;
	float g = 1. - 1. / ( Desaturation * ( peak - newPeak ) + 1. );
	return mix( color, vec3( newPeak ), g );
}
vec3 CustomToneMapping( vec3 color ) { return color; }`,dY=`#ifdef USE_TRANSMISSION
	material.transmission = transmission;
	material.transmissionAlpha = 1.0;
	material.thickness = thickness;
	material.attenuationDistance = attenuationDistance;
	material.attenuationColor = attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		material.transmission *= texture2D( transmissionMap, vTransmissionMapUv ).r;
	#endif
	#ifdef USE_THICKNESSMAP
		material.thickness *= texture2D( thicknessMap, vThicknessMapUv ).g;
	#endif
	vec3 pos = vWorldPosition;
	vec3 v = normalize( cameraPosition - pos );
	vec3 n = inverseTransformDirection( normal, viewMatrix );
	vec4 transmitted = getIBLVolumeRefraction(
		n, v, material.roughness, material.diffuseColor, material.specularColor, material.specularF90,
		pos, modelMatrix, viewMatrix, projectionMatrix, material.dispersion, material.ior, material.thickness,
		material.attenuationColor, material.attenuationDistance );
	material.transmissionAlpha = mix( material.transmissionAlpha, transmitted.a, material.transmission );
	totalDiffuse = mix( totalDiffuse, transmitted.rgb, material.transmission );
#endif`,pY=`#ifdef USE_TRANSMISSION
	uniform float transmission;
	uniform float thickness;
	uniform float attenuationDistance;
	uniform vec3 attenuationColor;
	#ifdef USE_TRANSMISSIONMAP
		uniform sampler2D transmissionMap;
	#endif
	#ifdef USE_THICKNESSMAP
		uniform sampler2D thicknessMap;
	#endif
	uniform vec2 transmissionSamplerSize;
	uniform sampler2D transmissionSamplerMap;
	uniform mat4 modelMatrix;
	uniform mat4 projectionMatrix;
	varying vec3 vWorldPosition;
	float w0( float a ) {
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - a + 3.0 ) - 3.0 ) + 1.0 );
	}
	float w1( float a ) {
		return ( 1.0 / 6.0 ) * ( a *  a * ( 3.0 * a - 6.0 ) + 4.0 );
	}
	float w2( float a ){
		return ( 1.0 / 6.0 ) * ( a * ( a * ( - 3.0 * a + 3.0 ) + 3.0 ) + 1.0 );
	}
	float w3( float a ) {
		return ( 1.0 / 6.0 ) * ( a * a * a );
	}
	float g0( float a ) {
		return w0( a ) + w1( a );
	}
	float g1( float a ) {
		return w2( a ) + w3( a );
	}
	float h0( float a ) {
		return - 1.0 + w1( a ) / ( w0( a ) + w1( a ) );
	}
	float h1( float a ) {
		return 1.0 + w3( a ) / ( w2( a ) + w3( a ) );
	}
	vec4 bicubic( sampler2D tex, vec2 uv, vec4 texelSize, float lod ) {
		uv = uv * texelSize.zw + 0.5;
		vec2 iuv = floor( uv );
		vec2 fuv = fract( uv );
		float g0x = g0( fuv.x );
		float g1x = g1( fuv.x );
		float h0x = h0( fuv.x );
		float h1x = h1( fuv.x );
		float h0y = h0( fuv.y );
		float h1y = h1( fuv.y );
		vec2 p0 = ( vec2( iuv.x + h0x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p1 = ( vec2( iuv.x + h1x, iuv.y + h0y ) - 0.5 ) * texelSize.xy;
		vec2 p2 = ( vec2( iuv.x + h0x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		vec2 p3 = ( vec2( iuv.x + h1x, iuv.y + h1y ) - 0.5 ) * texelSize.xy;
		return g0( fuv.y ) * ( g0x * textureLod( tex, p0, lod ) + g1x * textureLod( tex, p1, lod ) ) +
			g1( fuv.y ) * ( g0x * textureLod( tex, p2, lod ) + g1x * textureLod( tex, p3, lod ) );
	}
	vec4 textureBicubic( sampler2D sampler, vec2 uv, float lod ) {
		vec2 fLodSize = vec2( textureSize( sampler, int( lod ) ) );
		vec2 cLodSize = vec2( textureSize( sampler, int( lod + 1.0 ) ) );
		vec2 fLodSizeInv = 1.0 / fLodSize;
		vec2 cLodSizeInv = 1.0 / cLodSize;
		vec4 fSample = bicubic( sampler, uv, vec4( fLodSizeInv, fLodSize ), floor( lod ) );
		vec4 cSample = bicubic( sampler, uv, vec4( cLodSizeInv, cLodSize ), ceil( lod ) );
		return mix( fSample, cSample, fract( lod ) );
	}
	vec3 getVolumeTransmissionRay( const in vec3 n, const in vec3 v, const in float thickness, const in float ior, const in mat4 modelMatrix ) {
		vec3 refractionVector = refract( - v, normalize( n ), 1.0 / ior );
		vec3 modelScale;
		modelScale.x = length( vec3( modelMatrix[ 0 ].xyz ) );
		modelScale.y = length( vec3( modelMatrix[ 1 ].xyz ) );
		modelScale.z = length( vec3( modelMatrix[ 2 ].xyz ) );
		return normalize( refractionVector ) * thickness * modelScale;
	}
	float applyIorToRoughness( const in float roughness, const in float ior ) {
		return roughness * clamp( ior * 2.0 - 2.0, 0.0, 1.0 );
	}
	vec4 getTransmissionSample( const in vec2 fragCoord, const in float roughness, const in float ior ) {
		float lod = log2( transmissionSamplerSize.x ) * applyIorToRoughness( roughness, ior );
		return textureBicubic( transmissionSamplerMap, fragCoord.xy, lod );
	}
	vec3 volumeAttenuation( const in float transmissionDistance, const in vec3 attenuationColor, const in float attenuationDistance ) {
		if ( isinf( attenuationDistance ) ) {
			return vec3( 1.0 );
		} else {
			vec3 attenuationCoefficient = -log( attenuationColor ) / attenuationDistance;
			vec3 transmittance = exp( - attenuationCoefficient * transmissionDistance );			return transmittance;
		}
	}
	vec4 getIBLVolumeRefraction( const in vec3 n, const in vec3 v, const in float roughness, const in vec3 diffuseColor,
		const in vec3 specularColor, const in float specularF90, const in vec3 position, const in mat4 modelMatrix,
		const in mat4 viewMatrix, const in mat4 projMatrix, const in float dispersion, const in float ior, const in float thickness,
		const in vec3 attenuationColor, const in float attenuationDistance ) {
		vec4 transmittedLight;
		vec3 transmittance;
		#ifdef USE_DISPERSION
			float halfSpread = ( ior - 1.0 ) * 0.025 * dispersion;
			vec3 iors = vec3( ior - halfSpread, ior, ior + halfSpread );
			for ( int i = 0; i < 3; i ++ ) {
				vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, iors[ i ], modelMatrix );
				vec3 refractedRayExit = position + transmissionRay;
				vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
				vec2 refractionCoords = ndcPos.xy / ndcPos.w;
				refractionCoords += 1.0;
				refractionCoords /= 2.0;
				vec4 transmissionSample = getTransmissionSample( refractionCoords, roughness, iors[ i ] );
				transmittedLight[ i ] = transmissionSample[ i ];
				transmittedLight.a += transmissionSample.a;
				transmittance[ i ] = diffuseColor[ i ] * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance )[ i ];
			}
			transmittedLight.a /= 3.0;
		#else
			vec3 transmissionRay = getVolumeTransmissionRay( n, v, thickness, ior, modelMatrix );
			vec3 refractedRayExit = position + transmissionRay;
			vec4 ndcPos = projMatrix * viewMatrix * vec4( refractedRayExit, 1.0 );
			vec2 refractionCoords = ndcPos.xy / ndcPos.w;
			refractionCoords += 1.0;
			refractionCoords /= 2.0;
			transmittedLight = getTransmissionSample( refractionCoords, roughness, ior );
			transmittance = diffuseColor * volumeAttenuation( length( transmissionRay ), attenuationColor, attenuationDistance );
		#endif
		vec3 attenuatedColor = transmittance * transmittedLight.rgb;
		vec3 F = EnvironmentBRDF( n, v, specularColor, specularF90, roughness );
		float transmittanceFactor = ( transmittance.r + transmittance.g + transmittance.b ) / 3.0;
		return vec4( ( 1.0 - F ) * attenuatedColor, 1.0 - ( 1.0 - transmittedLight.a ) * transmittanceFactor );
	}
#endif`,mY=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_SPECULARMAP
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,gY=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	varying vec2 vUv;
#endif
#ifdef USE_MAP
	uniform mat3 mapTransform;
	varying vec2 vMapUv;
#endif
#ifdef USE_ALPHAMAP
	uniform mat3 alphaMapTransform;
	varying vec2 vAlphaMapUv;
#endif
#ifdef USE_LIGHTMAP
	uniform mat3 lightMapTransform;
	varying vec2 vLightMapUv;
#endif
#ifdef USE_AOMAP
	uniform mat3 aoMapTransform;
	varying vec2 vAoMapUv;
#endif
#ifdef USE_BUMPMAP
	uniform mat3 bumpMapTransform;
	varying vec2 vBumpMapUv;
#endif
#ifdef USE_NORMALMAP
	uniform mat3 normalMapTransform;
	varying vec2 vNormalMapUv;
#endif
#ifdef USE_DISPLACEMENTMAP
	uniform mat3 displacementMapTransform;
	varying vec2 vDisplacementMapUv;
#endif
#ifdef USE_EMISSIVEMAP
	uniform mat3 emissiveMapTransform;
	varying vec2 vEmissiveMapUv;
#endif
#ifdef USE_METALNESSMAP
	uniform mat3 metalnessMapTransform;
	varying vec2 vMetalnessMapUv;
#endif
#ifdef USE_ROUGHNESSMAP
	uniform mat3 roughnessMapTransform;
	varying vec2 vRoughnessMapUv;
#endif
#ifdef USE_ANISOTROPYMAP
	uniform mat3 anisotropyMapTransform;
	varying vec2 vAnisotropyMapUv;
#endif
#ifdef USE_CLEARCOATMAP
	uniform mat3 clearcoatMapTransform;
	varying vec2 vClearcoatMapUv;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	uniform mat3 clearcoatNormalMapTransform;
	varying vec2 vClearcoatNormalMapUv;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	uniform mat3 clearcoatRoughnessMapTransform;
	varying vec2 vClearcoatRoughnessMapUv;
#endif
#ifdef USE_SHEEN_COLORMAP
	uniform mat3 sheenColorMapTransform;
	varying vec2 vSheenColorMapUv;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	uniform mat3 sheenRoughnessMapTransform;
	varying vec2 vSheenRoughnessMapUv;
#endif
#ifdef USE_IRIDESCENCEMAP
	uniform mat3 iridescenceMapTransform;
	varying vec2 vIridescenceMapUv;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	uniform mat3 iridescenceThicknessMapTransform;
	varying vec2 vIridescenceThicknessMapUv;
#endif
#ifdef USE_SPECULARMAP
	uniform mat3 specularMapTransform;
	varying vec2 vSpecularMapUv;
#endif
#ifdef USE_SPECULAR_COLORMAP
	uniform mat3 specularColorMapTransform;
	varying vec2 vSpecularColorMapUv;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	uniform mat3 specularIntensityMapTransform;
	varying vec2 vSpecularIntensityMapUv;
#endif
#ifdef USE_TRANSMISSIONMAP
	uniform mat3 transmissionMapTransform;
	varying vec2 vTransmissionMapUv;
#endif
#ifdef USE_THICKNESSMAP
	uniform mat3 thicknessMapTransform;
	varying vec2 vThicknessMapUv;
#endif`,yY=`#if defined( USE_UV ) || defined( USE_ANISOTROPY )
	vUv = vec3( uv, 1 ).xy;
#endif
#ifdef USE_MAP
	vMapUv = ( mapTransform * vec3( MAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ALPHAMAP
	vAlphaMapUv = ( alphaMapTransform * vec3( ALPHAMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_LIGHTMAP
	vLightMapUv = ( lightMapTransform * vec3( LIGHTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_AOMAP
	vAoMapUv = ( aoMapTransform * vec3( AOMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_BUMPMAP
	vBumpMapUv = ( bumpMapTransform * vec3( BUMPMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_NORMALMAP
	vNormalMapUv = ( normalMapTransform * vec3( NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_DISPLACEMENTMAP
	vDisplacementMapUv = ( displacementMapTransform * vec3( DISPLACEMENTMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_EMISSIVEMAP
	vEmissiveMapUv = ( emissiveMapTransform * vec3( EMISSIVEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_METALNESSMAP
	vMetalnessMapUv = ( metalnessMapTransform * vec3( METALNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ROUGHNESSMAP
	vRoughnessMapUv = ( roughnessMapTransform * vec3( ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_ANISOTROPYMAP
	vAnisotropyMapUv = ( anisotropyMapTransform * vec3( ANISOTROPYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOATMAP
	vClearcoatMapUv = ( clearcoatMapTransform * vec3( CLEARCOATMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_NORMALMAP
	vClearcoatNormalMapUv = ( clearcoatNormalMapTransform * vec3( CLEARCOAT_NORMALMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_CLEARCOAT_ROUGHNESSMAP
	vClearcoatRoughnessMapUv = ( clearcoatRoughnessMapTransform * vec3( CLEARCOAT_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCEMAP
	vIridescenceMapUv = ( iridescenceMapTransform * vec3( IRIDESCENCEMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_IRIDESCENCE_THICKNESSMAP
	vIridescenceThicknessMapUv = ( iridescenceThicknessMapTransform * vec3( IRIDESCENCE_THICKNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_COLORMAP
	vSheenColorMapUv = ( sheenColorMapTransform * vec3( SHEEN_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SHEEN_ROUGHNESSMAP
	vSheenRoughnessMapUv = ( sheenRoughnessMapTransform * vec3( SHEEN_ROUGHNESSMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULARMAP
	vSpecularMapUv = ( specularMapTransform * vec3( SPECULARMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_COLORMAP
	vSpecularColorMapUv = ( specularColorMapTransform * vec3( SPECULAR_COLORMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_SPECULAR_INTENSITYMAP
	vSpecularIntensityMapUv = ( specularIntensityMapTransform * vec3( SPECULAR_INTENSITYMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_TRANSMISSIONMAP
	vTransmissionMapUv = ( transmissionMapTransform * vec3( TRANSMISSIONMAP_UV, 1 ) ).xy;
#endif
#ifdef USE_THICKNESSMAP
	vThicknessMapUv = ( thicknessMapTransform * vec3( THICKNESSMAP_UV, 1 ) ).xy;
#endif`,vY=`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP ) || defined ( USE_TRANSMISSION ) || NUM_SPOT_LIGHT_COORDS > 0
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_BATCHING
		worldPosition = batchingMatrix * worldPosition;
	#endif
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`;const _Y=`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,xY=`uniform sampler2D t2D;
uniform float backgroundIntensity;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	#ifdef DECODE_VIDEO_TEXTURE
		texColor = vec4( mix( pow( texColor.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), texColor.rgb * 0.0773993808, vec3( lessThanEqual( texColor.rgb, vec3( 0.04045 ) ) ) ), texColor.w );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,SY=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,bY=`#ifdef ENVMAP_TYPE_CUBE
	uniform samplerCube envMap;
#elif defined( ENVMAP_TYPE_CUBE_UV )
	uniform sampler2D envMap;
#endif
uniform float flipEnvMap;
uniform float backgroundBlurriness;
uniform float backgroundIntensity;
uniform mat3 backgroundRotation;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	#ifdef ENVMAP_TYPE_CUBE
		vec4 texColor = textureCube( envMap, backgroundRotation * vec3( flipEnvMap * vWorldDirection.x, vWorldDirection.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 texColor = textureCubeUV( envMap, backgroundRotation * vWorldDirection, backgroundBlurriness );
	#else
		vec4 texColor = vec4( 0.0, 0.0, 0.0, 1.0 );
	#endif
	texColor.rgb *= backgroundIntensity;
	gl_FragColor = texColor;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,TY=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,MY=`uniform samplerCube tCube;
uniform float tFlip;
uniform float opacity;
varying vec3 vWorldDirection;
void main() {
	vec4 texColor = textureCube( tCube, vec3( tFlip * vWorldDirection.x, vWorldDirection.yz ) );
	gl_FragColor = texColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,EY=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
varying vec2 vHighPrecisionZW;
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vHighPrecisionZW = gl_Position.zw;
}`,AY=`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
varying vec2 vHighPrecisionZW;
void main() {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <logdepthbuf_fragment>
	float fragCoordZ = 0.5 * vHighPrecisionZW[0] / vHighPrecisionZW[1] + 0.5;
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - fragCoordZ ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( fragCoordZ );
	#elif DEPTH_PACKING == 3202
		gl_FragColor = vec4( packDepthToRGB( fragCoordZ ), 1.0 );
	#elif DEPTH_PACKING == 3203
		gl_FragColor = vec4( packDepthToRG( fragCoordZ ), 0.0, 1.0 );
	#endif
}`,RY=`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <skinbase_vertex>
	#include <morphinstance_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,NY=`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	vec4 diffuseColor = vec4( 1.0 );
	#include <clipping_planes_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,CY=`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,wY=`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV = equirectUv( direction );
	gl_FragColor = texture2D( tEquirect, sampleUV );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
}`,DY=`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	vLineDistance = scale * lineDistance;
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,UY=`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,LY=`#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#if defined ( USE_ENVMAP ) || defined ( USE_SKINNING )
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinbase_vertex>
		#include <skinnormal_vertex>
		#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,BY=`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel = texture2D( lightMap, vLightMapUv );
		reflectedLight.indirectDiffuse += lightMapTexel.rgb * lightMapIntensity * RECIPROCAL_PI;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,OY=`#define LAMBERT
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,PY=`#define LAMBERT
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_lambert_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_lambert_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,IY=`#define MATCAP
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <color_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,FY=`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#include <common>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
	#else
		vec4 matcapColor = vec4( vec3( mix( 0.2, 0.8, uv.y ) ), 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,zY=`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	vViewPosition = - mvPosition.xyz;
#endif
}`,VY=`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( USE_NORMALMAP_TANGENTSPACE )
	varying vec3 vViewPosition;
#endif
#include <packing>
#include <uv_pars_fragment>
#include <normal_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( 0.0, 0.0, 0.0, opacity );
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), diffuseColor.a );
	#ifdef OPAQUE
		gl_FragColor.a = 1.0;
	#endif
}`,GY=`#define PHONG
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,HY=`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,kY=`#define STANDARD
varying vec3 vViewPosition;
#ifdef USE_TRANSMISSION
	varying vec3 vWorldPosition;
#endif
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
#ifdef USE_TRANSMISSION
	vWorldPosition = worldPosition.xyz;
#endif
}`,qY=`#define STANDARD
#ifdef PHYSICAL
	#define IOR
	#define USE_SPECULAR
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef IOR
	uniform float ior;
#endif
#ifdef USE_SPECULAR
	uniform float specularIntensity;
	uniform vec3 specularColor;
	#ifdef USE_SPECULAR_COLORMAP
		uniform sampler2D specularColorMap;
	#endif
	#ifdef USE_SPECULAR_INTENSITYMAP
		uniform sampler2D specularIntensityMap;
	#endif
#endif
#ifdef USE_CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_DISPERSION
	uniform float dispersion;
#endif
#ifdef USE_IRIDESCENCE
	uniform float iridescence;
	uniform float iridescenceIOR;
	uniform float iridescenceThicknessMinimum;
	uniform float iridescenceThicknessMaximum;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheenColor;
	uniform float sheenRoughness;
	#ifdef USE_SHEEN_COLORMAP
		uniform sampler2D sheenColorMap;
	#endif
	#ifdef USE_SHEEN_ROUGHNESSMAP
		uniform sampler2D sheenRoughnessMap;
	#endif
#endif
#ifdef USE_ANISOTROPY
	uniform vec2 anisotropyVector;
	#ifdef USE_ANISOTROPYMAP
		uniform sampler2D anisotropyMap;
	#endif
#endif
varying vec3 vViewPosition;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <iridescence_fragment>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_physical_pars_fragment>
#include <transmission_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_pars_fragment>
#include <iridescence_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 totalDiffuse = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse;
	vec3 totalSpecular = reflectedLight.directSpecular + reflectedLight.indirectSpecular;
	#include <transmission_fragment>
	vec3 outgoingLight = totalDiffuse + totalSpecular + totalEmissiveRadiance;
	#ifdef USE_SHEEN
		float sheenEnergyComp = 1.0 - 0.157 * max3( material.sheenColor );
		outgoingLight = outgoingLight * sheenEnergyComp + sheenSpecularDirect + sheenSpecularIndirect;
	#endif
	#ifdef USE_CLEARCOAT
		float dotNVcc = saturate( dot( geometryClearcoatNormal, geometryViewDir ) );
		vec3 Fcc = F_Schlick( material.clearcoatF0, material.clearcoatF90, dotNVcc );
		outgoingLight = outgoingLight * ( 1.0 - material.clearcoat * Fcc ) + ( clearcoatSpecularDirect + clearcoatSpecularIndirect ) * material.clearcoat;
	#endif
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,WY=`#define TOON
varying vec3 vViewPosition;
#include <common>
#include <batching_pars_vertex>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <normal_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <normal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,XY=`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <normal_pars_fragment>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,YY=`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
#ifdef USE_POINTS_UV
	varying vec2 vUv;
	uniform mat3 uvTransform;
#endif
void main() {
	#ifdef USE_POINTS_UV
		vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	#endif
	#include <color_vertex>
	#include <morphinstance_vertex>
	#include <morphcolor_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,jY=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,ZY=`#include <common>
#include <batching_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <batching_vertex>
	#include <beginnormal_vertex>
	#include <morphinstance_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,KY=`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <logdepthbuf_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	#include <logdepthbuf_fragment>
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,QY=`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix[ 3 ];
	vec2 scale = vec2( length( modelMatrix[ 0 ].xyz ), length( modelMatrix[ 1 ].xyz ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,JY=`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <alphatest_pars_fragment>
#include <alphahash_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <alphahash_fragment>
	outgoingLight = diffuseColor.rgb;
	#include <opaque_fragment>
	#include <tonemapping_fragment>
	#include <colorspace_fragment>
	#include <fog_fragment>
}`,_n={alphahash_fragment:xW,alphahash_pars_fragment:SW,alphamap_fragment:bW,alphamap_pars_fragment:TW,alphatest_fragment:MW,alphatest_pars_fragment:EW,aomap_fragment:AW,aomap_pars_fragment:RW,batching_pars_vertex:NW,batching_vertex:CW,begin_vertex:wW,beginnormal_vertex:DW,bsdfs:UW,iridescence_fragment:LW,bumpmap_pars_fragment:BW,clipping_planes_fragment:OW,clipping_planes_pars_fragment:PW,clipping_planes_pars_vertex:IW,clipping_planes_vertex:FW,color_fragment:zW,color_pars_fragment:VW,color_pars_vertex:GW,color_vertex:HW,common:kW,cube_uv_reflection_fragment:qW,defaultnormal_vertex:WW,displacementmap_pars_vertex:XW,displacementmap_vertex:YW,emissivemap_fragment:jW,emissivemap_pars_fragment:ZW,colorspace_fragment:KW,colorspace_pars_fragment:QW,envmap_fragment:JW,envmap_common_pars_fragment:$W,envmap_pars_fragment:eX,envmap_pars_vertex:tX,envmap_physical_pars_fragment:fX,envmap_vertex:nX,fog_vertex:iX,fog_pars_vertex:sX,fog_fragment:rX,fog_pars_fragment:aX,gradientmap_pars_fragment:oX,lightmap_pars_fragment:lX,lights_lambert_fragment:uX,lights_lambert_pars_fragment:cX,lights_pars_begin:hX,lights_toon_fragment:dX,lights_toon_pars_fragment:pX,lights_phong_fragment:mX,lights_phong_pars_fragment:gX,lights_physical_fragment:yX,lights_physical_pars_fragment:vX,lights_fragment_begin:_X,lights_fragment_maps:xX,lights_fragment_end:SX,logdepthbuf_fragment:bX,logdepthbuf_pars_fragment:TX,logdepthbuf_pars_vertex:MX,logdepthbuf_vertex:EX,map_fragment:AX,map_pars_fragment:RX,map_particle_fragment:NX,map_particle_pars_fragment:CX,metalnessmap_fragment:wX,metalnessmap_pars_fragment:DX,morphinstance_vertex:UX,morphcolor_vertex:LX,morphnormal_vertex:BX,morphtarget_pars_vertex:OX,morphtarget_vertex:PX,normal_fragment_begin:IX,normal_fragment_maps:FX,normal_pars_fragment:zX,normal_pars_vertex:VX,normal_vertex:GX,normalmap_pars_fragment:HX,clearcoat_normal_fragment_begin:kX,clearcoat_normal_fragment_maps:qX,clearcoat_pars_fragment:WX,iridescence_pars_fragment:XX,opaque_fragment:YX,packing:jX,premultiplied_alpha_fragment:ZX,project_vertex:KX,dithering_fragment:QX,dithering_pars_fragment:JX,roughnessmap_fragment:$X,roughnessmap_pars_fragment:eY,shadowmap_pars_fragment:tY,shadowmap_pars_vertex:nY,shadowmap_vertex:iY,shadowmask_pars_fragment:sY,skinbase_vertex:rY,skinning_pars_vertex:aY,skinning_vertex:oY,skinnormal_vertex:lY,specularmap_fragment:uY,specularmap_pars_fragment:cY,tonemapping_fragment:hY,tonemapping_pars_fragment:fY,transmission_fragment:dY,transmission_pars_fragment:pY,uv_pars_fragment:mY,uv_pars_vertex:gY,uv_vertex:yY,worldpos_vertex:vY,background_vert:_Y,background_frag:xY,backgroundCube_vert:SY,backgroundCube_frag:bY,cube_vert:TY,cube_frag:MY,depth_vert:EY,depth_frag:AY,distanceRGBA_vert:RY,distanceRGBA_frag:NY,equirect_vert:CY,equirect_frag:wY,linedashed_vert:DY,linedashed_frag:UY,meshbasic_vert:LY,meshbasic_frag:BY,meshlambert_vert:OY,meshlambert_frag:PY,meshmatcap_vert:IY,meshmatcap_frag:FY,meshnormal_vert:zY,meshnormal_frag:VY,meshphong_vert:GY,meshphong_frag:HY,meshphysical_vert:kY,meshphysical_frag:qY,meshtoon_vert:WY,meshtoon_frag:XY,points_vert:YY,points_frag:jY,shadow_vert:ZY,shadow_frag:KY,sprite_vert:QY,sprite_frag:JY},_t={common:{diffuse:{value:new ft(16777215)},opacity:{value:1},map:{value:null},mapTransform:{value:new Qt},alphaMap:{value:null},alphaMapTransform:{value:new Qt},alphaTest:{value:0}},specularmap:{specularMap:{value:null},specularMapTransform:{value:new Qt}},envmap:{envMap:{value:null},envMapRotation:{value:new Qt},flipEnvMap:{value:-1},reflectivity:{value:1},ior:{value:1.5},refractionRatio:{value:.98}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1},aoMapTransform:{value:new Qt}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1},lightMapTransform:{value:new Qt}},bumpmap:{bumpMap:{value:null},bumpMapTransform:{value:new Qt},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalMapTransform:{value:new Qt},normalScale:{value:new Xe(1,1)}},displacementmap:{displacementMap:{value:null},displacementMapTransform:{value:new Qt},displacementScale:{value:1},displacementBias:{value:0}},emissivemap:{emissiveMap:{value:null},emissiveMapTransform:{value:new Qt}},metalnessmap:{metalnessMap:{value:null},metalnessMapTransform:{value:new Qt}},roughnessmap:{roughnessMap:{value:null},roughnessMapTransform:{value:new Qt}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new ft(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{}}},directionalLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{}}},spotLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{}}},spotLightMap:{value:[]},spotShadowMap:{value:[]},spotLightMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{}}},pointLightShadows:{value:[],properties:{shadowIntensity:1,shadowBias:{},shadowNormalBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}},ltc_1:{value:null},ltc_2:{value:null}},points:{diffuse:{value:new ft(16777215)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},alphaMapTransform:{value:new Qt},alphaTest:{value:0},uvTransform:{value:new Qt}},sprite:{diffuse:{value:new ft(16777215)},opacity:{value:1},center:{value:new Xe(.5,.5)},rotation:{value:0},map:{value:null},mapTransform:{value:new Qt},alphaMap:{value:null},alphaMapTransform:{value:new Qt},alphaTest:{value:0}}},Ll={basic:{uniforms:la([_t.common,_t.specularmap,_t.envmap,_t.aomap,_t.lightmap,_t.fog]),vertexShader:_n.meshbasic_vert,fragmentShader:_n.meshbasic_frag},lambert:{uniforms:la([_t.common,_t.specularmap,_t.envmap,_t.aomap,_t.lightmap,_t.emissivemap,_t.bumpmap,_t.normalmap,_t.displacementmap,_t.fog,_t.lights,{emissive:{value:new ft(0)}}]),vertexShader:_n.meshlambert_vert,fragmentShader:_n.meshlambert_frag},phong:{uniforms:la([_t.common,_t.specularmap,_t.envmap,_t.aomap,_t.lightmap,_t.emissivemap,_t.bumpmap,_t.normalmap,_t.displacementmap,_t.fog,_t.lights,{emissive:{value:new ft(0)},specular:{value:new ft(1118481)},shininess:{value:30}}]),vertexShader:_n.meshphong_vert,fragmentShader:_n.meshphong_frag},standard:{uniforms:la([_t.common,_t.envmap,_t.aomap,_t.lightmap,_t.emissivemap,_t.bumpmap,_t.normalmap,_t.displacementmap,_t.roughnessmap,_t.metalnessmap,_t.fog,_t.lights,{emissive:{value:new ft(0)},roughness:{value:1},metalness:{value:0},envMapIntensity:{value:1}}]),vertexShader:_n.meshphysical_vert,fragmentShader:_n.meshphysical_frag},toon:{uniforms:la([_t.common,_t.aomap,_t.lightmap,_t.emissivemap,_t.bumpmap,_t.normalmap,_t.displacementmap,_t.gradientmap,_t.fog,_t.lights,{emissive:{value:new ft(0)}}]),vertexShader:_n.meshtoon_vert,fragmentShader:_n.meshtoon_frag},matcap:{uniforms:la([_t.common,_t.bumpmap,_t.normalmap,_t.displacementmap,_t.fog,{matcap:{value:null}}]),vertexShader:_n.meshmatcap_vert,fragmentShader:_n.meshmatcap_frag},points:{uniforms:la([_t.points,_t.fog]),vertexShader:_n.points_vert,fragmentShader:_n.points_frag},dashed:{uniforms:la([_t.common,_t.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:_n.linedashed_vert,fragmentShader:_n.linedashed_frag},depth:{uniforms:la([_t.common,_t.displacementmap]),vertexShader:_n.depth_vert,fragmentShader:_n.depth_frag},normal:{uniforms:la([_t.common,_t.bumpmap,_t.normalmap,_t.displacementmap,{opacity:{value:1}}]),vertexShader:_n.meshnormal_vert,fragmentShader:_n.meshnormal_frag},sprite:{uniforms:la([_t.sprite,_t.fog]),vertexShader:_n.sprite_vert,fragmentShader:_n.sprite_frag},background:{uniforms:{uvTransform:{value:new Qt},t2D:{value:null},backgroundIntensity:{value:1}},vertexShader:_n.background_vert,fragmentShader:_n.background_frag},backgroundCube:{uniforms:{envMap:{value:null},flipEnvMap:{value:-1},backgroundBlurriness:{value:0},backgroundIntensity:{value:1},backgroundRotation:{value:new Qt}},vertexShader:_n.backgroundCube_vert,fragmentShader:_n.backgroundCube_frag},cube:{uniforms:{tCube:{value:null},tFlip:{value:-1},opacity:{value:1}},vertexShader:_n.cube_vert,fragmentShader:_n.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:_n.equirect_vert,fragmentShader:_n.equirect_frag},distanceRGBA:{uniforms:la([_t.common,_t.displacementmap,{referencePosition:{value:new Y},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:_n.distanceRGBA_vert,fragmentShader:_n.distanceRGBA_frag},shadow:{uniforms:la([_t.lights,_t.fog,{color:{value:new ft(0)},opacity:{value:1}}]),vertexShader:_n.shadow_vert,fragmentShader:_n.shadow_frag}};Ll.physical={uniforms:la([Ll.standard.uniforms,{clearcoat:{value:0},clearcoatMap:{value:null},clearcoatMapTransform:{value:new Qt},clearcoatNormalMap:{value:null},clearcoatNormalMapTransform:{value:new Qt},clearcoatNormalScale:{value:new Xe(1,1)},clearcoatRoughness:{value:0},clearcoatRoughnessMap:{value:null},clearcoatRoughnessMapTransform:{value:new Qt},dispersion:{value:0},iridescence:{value:0},iridescenceMap:{value:null},iridescenceMapTransform:{value:new Qt},iridescenceIOR:{value:1.3},iridescenceThicknessMinimum:{value:100},iridescenceThicknessMaximum:{value:400},iridescenceThicknessMap:{value:null},iridescenceThicknessMapTransform:{value:new Qt},sheen:{value:0},sheenColor:{value:new ft(0)},sheenColorMap:{value:null},sheenColorMapTransform:{value:new Qt},sheenRoughness:{value:1},sheenRoughnessMap:{value:null},sheenRoughnessMapTransform:{value:new Qt},transmission:{value:0},transmissionMap:{value:null},transmissionMapTransform:{value:new Qt},transmissionSamplerSize:{value:new Xe},transmissionSamplerMap:{value:null},thickness:{value:0},thicknessMap:{value:null},thicknessMapTransform:{value:new Qt},attenuationDistance:{value:0},attenuationColor:{value:new ft(0)},specularColor:{value:new ft(1,1,1)},specularColorMap:{value:null},specularColorMapTransform:{value:new Qt},specularIntensity:{value:1},specularIntensityMap:{value:null},specularIntensityMapTransform:{value:new Qt},anisotropyVector:{value:new Xe},anisotropyMap:{value:null},anisotropyMapTransform:{value:new Qt}}]),vertexShader:_n.meshphysical_vert,fragmentShader:_n.meshphysical_frag};const ZS={r:0,b:0,g:0},Ad=new _a,$Y=new Mt;function ej(r,e,t,n,i,s,a){const l=new ft(0);let c=s===!0?0:1,d,m,y=null,v=0,x=null;function S(w){let D=w.isScene===!0?w.background:null;return D&&D.isTexture&&(D=(w.backgroundBlurriness>0?t:e).get(D)),D}function A(w){let D=!1;const z=S(w);z===null?M(l,c):z&&z.isColor&&(M(z,1),D=!0);const B=r.xr.getEnvironmentBlendMode();B==="additive"?n.buffers.color.setClear(0,0,0,1,a):B==="alpha-blend"&&n.buffers.color.setClear(0,0,0,0,a),(r.autoClear||D)&&(n.buffers.depth.setTest(!0),n.buffers.depth.setMask(!0),n.buffers.color.setMask(!0),r.clear(r.autoClearColor,r.autoClearDepth,r.autoClearStencil))}function E(w,D){const z=S(D);z&&(z.isCubeTexture||z.mapping===Ic)?(m===void 0&&(m=new bi(new Hc(1,1,1),new Hl({name:"BackgroundCubeMaterial",uniforms:Vg(Ll.backgroundCube.uniforms),vertexShader:Ll.backgroundCube.vertexShader,fragmentShader:Ll.backgroundCube.fragmentShader,side:Ti,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),m.geometry.deleteAttribute("normal"),m.geometry.deleteAttribute("uv"),m.onBeforeRender=function(B,F,H){this.matrixWorld.copyPosition(H.matrixWorld)},Object.defineProperty(m.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),i.update(m)),Ad.copy(D.backgroundRotation),Ad.x*=-1,Ad.y*=-1,Ad.z*=-1,z.isCubeTexture&&z.isRenderTargetTexture===!1&&(Ad.y*=-1,Ad.z*=-1),m.material.uniforms.envMap.value=z,m.material.uniforms.flipEnvMap.value=z.isCubeTexture&&z.isRenderTargetTexture===!1?-1:1,m.material.uniforms.backgroundBlurriness.value=D.backgroundBlurriness,m.material.uniforms.backgroundIntensity.value=D.backgroundIntensity,m.material.uniforms.backgroundRotation.value.setFromMatrix4($Y.makeRotationFromEuler(Ad)),m.material.toneMapped=on.getTransfer(z.colorSpace)!==$n,(y!==z||v!==z.version||x!==r.toneMapping)&&(m.material.needsUpdate=!0,y=z,v=z.version,x=r.toneMapping),m.layers.enableAll(),w.unshift(m,m.geometry,m.material,0,0,null)):z&&z.isTexture&&(d===void 0&&(d=new bi(new Sp(2,2),new Hl({name:"BackgroundMaterial",uniforms:Vg(Ll.background.uniforms),vertexShader:Ll.background.vertexShader,fragmentShader:Ll.background.fragmentShader,side:pa,depthTest:!1,depthWrite:!1,fog:!1,allowOverride:!1})),d.geometry.deleteAttribute("normal"),Object.defineProperty(d.material,"map",{get:function(){return this.uniforms.t2D.value}}),i.update(d)),d.material.uniforms.t2D.value=z,d.material.uniforms.backgroundIntensity.value=D.backgroundIntensity,d.material.toneMapped=on.getTransfer(z.colorSpace)!==$n,z.matrixAutoUpdate===!0&&z.updateMatrix(),d.material.uniforms.uvTransform.value.copy(z.matrix),(y!==z||v!==z.version||x!==r.toneMapping)&&(d.material.needsUpdate=!0,y=z,v=z.version,x=r.toneMapping),d.layers.enableAll(),w.unshift(d,d.geometry,d.material,0,0,null))}function M(w,D){w.getRGB(ZS,TU(r)),n.buffers.color.setClear(ZS.r,ZS.g,ZS.b,D,a)}function C(){m!==void 0&&(m.geometry.dispose(),m.material.dispose(),m=void 0),d!==void 0&&(d.geometry.dispose(),d.material.dispose(),d=void 0)}return{getClearColor:function(){return l},setClearColor:function(w,D=1){l.set(w),c=D,M(l,c)},getClearAlpha:function(){return c},setClearAlpha:function(w){c=w,M(l,c)},render:A,addToRenderList:E,dispose:C}}function tj(r,e){const t=r.getParameter(r.MAX_VERTEX_ATTRIBS),n={},i=v(null);let s=i,a=!1;function l(P,Z,ue,se,pe){let Se=!1;const V=y(se,ue,Z);s!==V&&(s=V,d(s.object)),Se=x(P,se,ue,pe),Se&&S(P,se,ue,pe),pe!==null&&e.update(pe,r.ELEMENT_ARRAY_BUFFER),(Se||a)&&(a=!1,D(P,Z,ue,se),pe!==null&&r.bindBuffer(r.ELEMENT_ARRAY_BUFFER,e.get(pe).buffer))}function c(){return r.createVertexArray()}function d(P){return r.bindVertexArray(P)}function m(P){return r.deleteVertexArray(P)}function y(P,Z,ue){const se=ue.wireframe===!0;let pe=n[P.id];pe===void 0&&(pe={},n[P.id]=pe);let Se=pe[Z.id];Se===void 0&&(Se={},pe[Z.id]=Se);let V=Se[se];return V===void 0&&(V=v(c()),Se[se]=V),V}function v(P){const Z=[],ue=[],se=[];for(let pe=0;pe<t;pe++)Z[pe]=0,ue[pe]=0,se[pe]=0;return{geometry:null,program:null,wireframe:!1,newAttributes:Z,enabledAttributes:ue,attributeDivisors:se,object:P,attributes:{},index:null}}function x(P,Z,ue,se){const pe=s.attributes,Se=Z.attributes;let V=0;const Q=ue.getAttributes();for(const J in Q)if(Q[J].location>=0){const X=pe[J];let re=Se[J];if(re===void 0&&(J==="instanceMatrix"&&P.instanceMatrix&&(re=P.instanceMatrix),J==="instanceColor"&&P.instanceColor&&(re=P.instanceColor)),X===void 0||X.attribute!==re||re&&X.data!==re.data)return!0;V++}return s.attributesNum!==V||s.index!==se}function S(P,Z,ue,se){const pe={},Se=Z.attributes;let V=0;const Q=ue.getAttributes();for(const J in Q)if(Q[J].location>=0){let X=Se[J];X===void 0&&(J==="instanceMatrix"&&P.instanceMatrix&&(X=P.instanceMatrix),J==="instanceColor"&&P.instanceColor&&(X=P.instanceColor));const re={};re.attribute=X,X&&X.data&&(re.data=X.data),pe[J]=re,V++}s.attributes=pe,s.attributesNum=V,s.index=se}function A(){const P=s.newAttributes;for(let Z=0,ue=P.length;Z<ue;Z++)P[Z]=0}function E(P){M(P,0)}function M(P,Z){const ue=s.newAttributes,se=s.enabledAttributes,pe=s.attributeDivisors;ue[P]=1,se[P]===0&&(r.enableVertexAttribArray(P),se[P]=1),pe[P]!==Z&&(r.vertexAttribDivisor(P,Z),pe[P]=Z)}function C(){const P=s.newAttributes,Z=s.enabledAttributes;for(let ue=0,se=Z.length;ue<se;ue++)Z[ue]!==P[ue]&&(r.disableVertexAttribArray(ue),Z[ue]=0)}function w(P,Z,ue,se,pe,Se,V){V===!0?r.vertexAttribIPointer(P,Z,ue,pe,Se):r.vertexAttribPointer(P,Z,ue,se,pe,Se)}function D(P,Z,ue,se){A();const pe=se.attributes,Se=ue.getAttributes(),V=Z.defaultAttributeValues;for(const Q in Se){const J=Se[Q];if(J.location>=0){let ve=pe[Q];if(ve===void 0&&(Q==="instanceMatrix"&&P.instanceMatrix&&(ve=P.instanceMatrix),Q==="instanceColor"&&P.instanceColor&&(ve=P.instanceColor)),ve!==void 0){const X=ve.normalized,re=ve.itemSize,we=e.get(ve);if(we===void 0)continue;const Fe=we.buffer,oe=we.type,De=we.bytesPerElement,je=oe===r.INT||oe===r.UNSIGNED_INT||ve.gpuType===Xs;if(ve.isInterleavedBufferAttribute){const nt=ve.data,lt=nt.stride,nn=ve.offset;if(nt.isInstancedInterleavedBuffer){for(let Pt=0;Pt<J.locationSize;Pt++)M(J.location+Pt,nt.meshPerAttribute);P.isInstancedMesh!==!0&&se._maxInstanceCount===void 0&&(se._maxInstanceCount=nt.meshPerAttribute*nt.count)}else for(let Pt=0;Pt<J.locationSize;Pt++)E(J.location+Pt);r.bindBuffer(r.ARRAY_BUFFER,Fe);for(let Pt=0;Pt<J.locationSize;Pt++)w(J.location+Pt,re/J.locationSize,oe,X,lt*De,(nn+re/J.locationSize*Pt)*De,je)}else{if(ve.isInstancedBufferAttribute){for(let nt=0;nt<J.locationSize;nt++)M(J.location+nt,ve.meshPerAttribute);P.isInstancedMesh!==!0&&se._maxInstanceCount===void 0&&(se._maxInstanceCount=ve.meshPerAttribute*ve.count)}else for(let nt=0;nt<J.locationSize;nt++)E(J.location+nt);r.bindBuffer(r.ARRAY_BUFFER,Fe);for(let nt=0;nt<J.locationSize;nt++)w(J.location+nt,re/J.locationSize,oe,X,re*De,re/J.locationSize*nt*De,je)}}else if(V!==void 0){const X=V[Q];if(X!==void 0)switch(X.length){case 2:r.vertexAttrib2fv(J.location,X);break;case 3:r.vertexAttrib3fv(J.location,X);break;case 4:r.vertexAttrib4fv(J.location,X);break;default:r.vertexAttrib1fv(J.location,X)}}}}C()}function z(){H();for(const P in n){const Z=n[P];for(const ue in Z){const se=Z[ue];for(const pe in se)m(se[pe].object),delete se[pe];delete Z[ue]}delete n[P]}}function B(P){if(n[P.id]===void 0)return;const Z=n[P.id];for(const ue in Z){const se=Z[ue];for(const pe in se)m(se[pe].object),delete se[pe];delete Z[ue]}delete n[P.id]}function F(P){for(const Z in n){const ue=n[Z];if(ue[P.id]===void 0)continue;const se=ue[P.id];for(const pe in se)m(se[pe].object),delete se[pe];delete ue[P.id]}}function H(){I(),a=!0,s!==i&&(s=i,d(s.object))}function I(){i.geometry=null,i.program=null,i.wireframe=!1}return{setup:l,reset:H,resetDefaultState:I,dispose:z,releaseStatesOfGeometry:B,releaseStatesOfProgram:F,initAttributes:A,enableAttribute:E,disableUnusedAttributes:C}}function nj(r,e,t){let n;function i(d){n=d}function s(d,m){r.drawArrays(n,d,m),t.update(m,n,1)}function a(d,m,y){y!==0&&(r.drawArraysInstanced(n,d,m,y),t.update(m,n,y))}function l(d,m,y){if(y===0)return;e.get("WEBGL_multi_draw").multiDrawArraysWEBGL(n,d,0,m,0,y);let x=0;for(let S=0;S<y;S++)x+=m[S];t.update(x,n,1)}function c(d,m,y,v){if(y===0)return;const x=e.get("WEBGL_multi_draw");if(x===null)for(let S=0;S<d.length;S++)a(d[S],m[S],v[S]);else{x.multiDrawArraysInstancedWEBGL(n,d,0,m,0,v,0,y);let S=0;for(let A=0;A<y;A++)S+=m[A]*v[A];t.update(S,n,1)}}this.setMode=i,this.render=s,this.renderInstances=a,this.renderMultiDraw=l,this.renderMultiDrawInstances=c}function ij(r,e,t,n){let i;function s(){if(i!==void 0)return i;if(e.has("EXT_texture_filter_anisotropic")===!0){const F=e.get("EXT_texture_filter_anisotropic");i=r.getParameter(F.MAX_TEXTURE_MAX_ANISOTROPY_EXT)}else i=0;return i}function a(F){return!(F!==Ni&&n.convert(F)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_FORMAT))}function l(F){const H=F===Ys&&(e.has("EXT_color_buffer_half_float")||e.has("EXT_color_buffer_float"));return!(F!==Xi&&n.convert(F)!==r.getParameter(r.IMPLEMENTATION_COLOR_READ_TYPE)&&F!==Ri&&!H)}function c(F){if(F==="highp"){if(r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.HIGH_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.HIGH_FLOAT).precision>0)return"highp";F="mediump"}return F==="mediump"&&r.getShaderPrecisionFormat(r.VERTEX_SHADER,r.MEDIUM_FLOAT).precision>0&&r.getShaderPrecisionFormat(r.FRAGMENT_SHADER,r.MEDIUM_FLOAT).precision>0?"mediump":"lowp"}let d=t.precision!==void 0?t.precision:"highp";const m=c(d);m!==d&&(console.warn("THREE.WebGLRenderer:",d,"not supported, using",m,"instead."),d=m);const y=t.logarithmicDepthBuffer===!0,v=t.reverseDepthBuffer===!0&&e.has("EXT_clip_control"),x=r.getParameter(r.MAX_TEXTURE_IMAGE_UNITS),S=r.getParameter(r.MAX_VERTEX_TEXTURE_IMAGE_UNITS),A=r.getParameter(r.MAX_TEXTURE_SIZE),E=r.getParameter(r.MAX_CUBE_MAP_TEXTURE_SIZE),M=r.getParameter(r.MAX_VERTEX_ATTRIBS),C=r.getParameter(r.MAX_VERTEX_UNIFORM_VECTORS),w=r.getParameter(r.MAX_VARYING_VECTORS),D=r.getParameter(r.MAX_FRAGMENT_UNIFORM_VECTORS),z=S>0,B=r.getParameter(r.MAX_SAMPLES);return{isWebGL2:!0,getMaxAnisotropy:s,getMaxPrecision:c,textureFormatReadable:a,textureTypeReadable:l,precision:d,logarithmicDepthBuffer:y,reverseDepthBuffer:v,maxTextures:x,maxVertexTextures:S,maxTextureSize:A,maxCubemapSize:E,maxAttributes:M,maxVertexUniforms:C,maxVaryings:w,maxFragmentUniforms:D,vertexTextures:z,maxSamples:B}}function sj(r){const e=this;let t=null,n=0,i=!1,s=!1;const a=new wu,l=new Qt,c={value:null,needsUpdate:!1};this.uniform=c,this.numPlanes=0,this.numIntersection=0,this.init=function(y,v){const x=y.length!==0||v||n!==0||i;return i=v,n=y.length,x},this.beginShadows=function(){s=!0,m(null)},this.endShadows=function(){s=!1},this.setGlobalState=function(y,v){t=m(y,v,0)},this.setState=function(y,v,x){const S=y.clippingPlanes,A=y.clipIntersection,E=y.clipShadows,M=r.get(y);if(!i||S===null||S.length===0||s&&!E)s?m(null):d();else{const C=s?0:n,w=C*4;let D=M.clippingState||null;c.value=D,D=m(S,v,w,x);for(let z=0;z!==w;++z)D[z]=t[z];M.clippingState=D,this.numIntersection=A?this.numPlanes:0,this.numPlanes+=C}};function d(){c.value!==t&&(c.value=t,c.needsUpdate=n>0),e.numPlanes=n,e.numIntersection=0}function m(y,v,x,S){const A=y!==null?y.length:0;let E=null;if(A!==0){if(E=c.value,S!==!0||E===null){const M=x+A*4,C=v.matrixWorldInverse;l.getNormalMatrix(C),(E===null||E.length<M)&&(E=new Float32Array(M));for(let w=0,D=x;w!==A;++w,D+=4)a.copy(y[w]).applyMatrix4(C,l),a.normal.toArray(E,D),E[D+3]=a.constant}c.value=E,c.needsUpdate=!0}return e.numPlanes=A,e.numIntersection=0,E}}function rj(r){let e=new WeakMap;function t(a,l){return l===Pu?a.mapping=va:l===Iu&&(a.mapping=Wa),a}function n(a){if(a&&a.isTexture){const l=a.mapping;if(l===Pu||l===Iu)if(e.has(a)){const c=e.get(a).texture;return t(c,a.mapping)}else{const c=a.image;if(c&&c.height>0){const d=new G1(c.height);return d.fromEquirectangularTexture(r,a),e.set(a,d),a.addEventListener("dispose",i),t(d.texture,a.mapping)}else return null}}return a}function i(a){const l=a.target;l.removeEventListener("dispose",i);const c=e.get(l);c!==void 0&&(e.delete(l),c.dispose())}function s(){e=new WeakMap}return{get:n,dispose:s}}const mg=4,$2=[.125,.215,.35,.446,.526,.582],Ud=20,cA=new Mp,eD=new ft;let hA=null,fA=0,dA=0,pA=!1;const Cd=(1+Math.sqrt(5))/2,ig=1/Cd,tD=[new Y(-Cd,ig,0),new Y(Cd,ig,0),new Y(-ig,0,Cd),new Y(ig,0,Cd),new Y(0,Cd,-ig),new Y(0,Cd,ig),new Y(-1,1,-1),new Y(1,1,-1),new Y(-1,1,1),new Y(1,1,1)],aj=new Y;class h1{constructor(e){this._renderer=e,this._pingPongRenderTarget=null,this._lodMax=0,this._cubeSize=0,this._lodPlanes=[],this._sizeLods=[],this._sigmas=[],this._blurMaterial=null,this._cubemapMaterial=null,this._equirectMaterial=null,this._compileMaterial(this._blurMaterial)}fromScene(e,t=0,n=.1,i=100,s={}){const{size:a=256,position:l=aj}=s;hA=this._renderer.getRenderTarget(),fA=this._renderer.getActiveCubeFace(),dA=this._renderer.getActiveMipmapLevel(),pA=this._renderer.xr.enabled,this._renderer.xr.enabled=!1,this._setSize(a);const c=this._allocateTargets();return c.depthBuffer=!0,this._sceneToCubeUV(e,n,i,c,l),t>0&&this._blur(c,0,0,t),this._applyPMREM(c),this._cleanup(c),c}fromEquirectangular(e,t=null){return this._fromTexture(e,t)}fromCubemap(e,t=null){return this._fromTexture(e,t)}compileCubemapShader(){this._cubemapMaterial===null&&(this._cubemapMaterial=sD(),this._compileMaterial(this._cubemapMaterial))}compileEquirectangularShader(){this._equirectMaterial===null&&(this._equirectMaterial=iD(),this._compileMaterial(this._equirectMaterial))}dispose(){this._dispose(),this._cubemapMaterial!==null&&this._cubemapMaterial.dispose(),this._equirectMaterial!==null&&this._equirectMaterial.dispose()}_setSize(e){this._lodMax=Math.floor(Math.log2(e)),this._cubeSize=Math.pow(2,this._lodMax)}_dispose(){this._blurMaterial!==null&&this._blurMaterial.dispose(),this._pingPongRenderTarget!==null&&this._pingPongRenderTarget.dispose();for(let e=0;e<this._lodPlanes.length;e++)this._lodPlanes[e].dispose()}_cleanup(e){this._renderer.setRenderTarget(hA,fA,dA),this._renderer.xr.enabled=pA,e.scissorTest=!1,KS(e,0,0,e.width,e.height)}_fromTexture(e,t){e.mapping===va||e.mapping===Wa?this._setSize(e.image.length===0?16:e.image[0].width||e.image[0].image.width):this._setSize(e.image.width/4),hA=this._renderer.getRenderTarget(),fA=this._renderer.getActiveCubeFace(),dA=this._renderer.getActiveMipmapLevel(),pA=this._renderer.xr.enabled,this._renderer.xr.enabled=!1;const n=t||this._allocateTargets();return this._textureToCubeUV(e,n),this._applyPMREM(n),this._cleanup(n),n}_allocateTargets(){const e=3*Math.max(this._cubeSize,112),t=4*this._cubeSize,n={magFilter:Zn,minFilter:Zn,generateMipmaps:!1,type:Ys,format:Ni,colorSpace:xo,depthBuffer:!1},i=nD(e,t,n);if(this._pingPongRenderTarget===null||this._pingPongRenderTarget.width!==e||this._pingPongRenderTarget.height!==t){this._pingPongRenderTarget!==null&&this._dispose(),this._pingPongRenderTarget=nD(e,t,n);const{_lodMax:s}=this;({sizeLods:this._sizeLods,lodPlanes:this._lodPlanes,sigmas:this._sigmas}=oj(s)),this._blurMaterial=lj(s,e,t)}return i}_compileMaterial(e){const t=new bi(this._lodPlanes[0],e);this._renderer.compile(t,cA)}_sceneToCubeUV(e,t,n,i,s){const c=new us(90,1,t,n),d=[1,-1,1,1,1,1],m=[1,1,1,-1,-1,-1],y=this._renderer,v=y.autoClear,x=y.toneMapping;y.getClearColor(eD),y.toneMapping=Gr,y.autoClear=!1;const S=new fa({name:"PMREM.Background",side:Ti,depthWrite:!1,depthTest:!1}),A=new bi(new Hc,S);let E=!1;const M=e.background;M?M.isColor&&(S.color.copy(M),e.background=null,E=!0):(S.color.copy(eD),E=!0);for(let C=0;C<6;C++){const w=C%3;w===0?(c.up.set(0,d[C],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x+m[C],s.y,s.z)):w===1?(c.up.set(0,0,d[C]),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y+m[C],s.z)):(c.up.set(0,d[C],0),c.position.set(s.x,s.y,s.z),c.lookAt(s.x,s.y,s.z+m[C]));const D=this._cubeSize;KS(i,w*D,C>2?D:0,D,D),y.setRenderTarget(i),E&&y.render(A,c),y.render(e,c)}A.geometry.dispose(),A.material.dispose(),y.toneMapping=x,y.autoClear=v,e.background=M}_textureToCubeUV(e,t){const n=this._renderer,i=e.mapping===va||e.mapping===Wa;i?(this._cubemapMaterial===null&&(this._cubemapMaterial=sD()),this._cubemapMaterial.uniforms.flipEnvMap.value=e.isRenderTargetTexture===!1?-1:1):this._equirectMaterial===null&&(this._equirectMaterial=iD());const s=i?this._cubemapMaterial:this._equirectMaterial,a=new bi(this._lodPlanes[0],s),l=s.uniforms;l.envMap.value=e;const c=this._cubeSize;KS(t,0,0,3*c,2*c),n.setRenderTarget(t),n.render(a,cA)}_applyPMREM(e){const t=this._renderer,n=t.autoClear;t.autoClear=!1;const i=this._lodPlanes.length;for(let s=1;s<i;s++){const a=Math.sqrt(this._sigmas[s]*this._sigmas[s]-this._sigmas[s-1]*this._sigmas[s-1]),l=tD[(i-s-1)%tD.length];this._blur(e,s-1,s,a,l)}t.autoClear=n}_blur(e,t,n,i,s){const a=this._pingPongRenderTarget;this._halfBlur(e,a,t,n,i,"latitudinal",s),this._halfBlur(a,e,n,n,i,"longitudinal",s)}_halfBlur(e,t,n,i,s,a,l){const c=this._renderer,d=this._blurMaterial;a!=="latitudinal"&&a!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");const m=3,y=new bi(this._lodPlanes[i],d),v=d.uniforms,x=this._sizeLods[n]-1,S=isFinite(s)?Math.PI/(2*x):2*Math.PI/(2*Ud-1),A=s/S,E=isFinite(s)?1+Math.floor(m*A):Ud;E>Ud&&console.warn(`sigmaRadians, ${s}, is too large and will clip, as it requested ${E} samples when the maximum is set to ${Ud}`);const M=[];let C=0;for(let F=0;F<Ud;++F){const H=F/A,I=Math.exp(-H*H/2);M.push(I),F===0?C+=I:F<E&&(C+=2*I)}for(let F=0;F<M.length;F++)M[F]=M[F]/C;v.envMap.value=e.texture,v.samples.value=E,v.weights.value=M,v.latitudinal.value=a==="latitudinal",l&&(v.poleAxis.value=l);const{_lodMax:w}=this;v.dTheta.value=S,v.mipInt.value=w-n;const D=this._sizeLods[i],z=3*D*(i>w-mg?i-w+mg:0),B=4*(this._cubeSize-D);KS(t,z,B,3*D,2*D),c.setRenderTarget(t),c.render(y,cA)}}function oj(r){const e=[],t=[],n=[];let i=r;const s=r-mg+1+$2.length;for(let a=0;a<s;a++){const l=Math.pow(2,i);t.push(l);let c=1/l;a>r-mg?c=$2[a-r+mg-1]:a===0&&(c=0),n.push(c);const d=1/(l-2),m=-d,y=1+d,v=[m,m,y,m,y,y,m,m,y,y,m,y],x=6,S=6,A=3,E=2,M=1,C=new Float32Array(A*S*x),w=new Float32Array(E*S*x),D=new Float32Array(M*S*x);for(let B=0;B<x;B++){const F=B%3*2/3-1,H=B>2?0:-1,I=[F,H,0,F+2/3,H,0,F+2/3,H+1,0,F,H,0,F+2/3,H+1,0,F,H+1,0];C.set(I,A*S*B),w.set(v,E*S*B);const P=[B,B,B,B,B,B];D.set(P,M*S*B)}const z=new fn;z.setAttribute("position",new Kn(C,A)),z.setAttribute("uv",new Kn(w,E)),z.setAttribute("faceIndex",new Kn(D,M)),e.push(z),i>mg&&i--}return{lodPlanes:e,sizeLods:t,sigmas:n}}function nD(r,e,t){const n=new Gl(r,e,t);return n.texture.mapping=Ic,n.texture.name="PMREM.cubeUv",n.scissorTest=!0,n}function KS(r,e,t,n,i){r.viewport.set(e,t,n,i),r.scissor.set(e,t,n,i)}function lj(r,e,t){const n=new Float32Array(Ud),i=new Y(0,1,0);return new Hl({name:"SphericalGaussianBlur",defines:{n:Ud,CUBEUV_TEXEL_WIDTH:1/e,CUBEUV_TEXEL_HEIGHT:1/t,CUBEUV_MAX_MIP:`${r}.0`},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:n},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:i}},vertexShader:PN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;
			uniform int samples;
			uniform float weights[ n ];
			uniform bool latitudinal;
			uniform float dTheta;
			uniform float mipInt;
			uniform vec3 poleAxis;

			#define ENVMAP_TYPE_CUBE_UV
			#include <cube_uv_reflection_fragment>

			vec3 getSample( float theta, vec3 axis ) {

				float cosTheta = cos( theta );
				// Rodrigues' axis-angle rotation
				vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross( axis, vOutputDirection ) * sin( theta )
					+ axis * dot( axis, vOutputDirection ) * ( 1.0 - cosTheta );

				return bilinearCubeUV( envMap, sampleDirection, mipInt );

			}

			void main() {

				vec3 axis = latitudinal ? poleAxis : cross( poleAxis, vOutputDirection );

				if ( all( equal( axis, vec3( 0.0 ) ) ) ) {

					axis = vec3( vOutputDirection.z, 0.0, - vOutputDirection.x );

				}

				axis = normalize( axis );

				gl_FragColor = vec4( 0.0, 0.0, 0.0, 1.0 );
				gl_FragColor.rgb += weights[ 0 ] * getSample( 0.0, axis );

				for ( int i = 1; i < n; i++ ) {

					if ( i >= samples ) {

						break;

					}

					float theta = dTheta * float( i );
					gl_FragColor.rgb += weights[ i ] * getSample( -1.0 * theta, axis );
					gl_FragColor.rgb += weights[ i ] * getSample( theta, axis );

				}

			}
		`,blending:Ga,depthTest:!1,depthWrite:!1})}function iD(){return new Hl({name:"EquirectangularToCubeUV",uniforms:{envMap:{value:null}},vertexShader:PN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			varying vec3 vOutputDirection;

			uniform sampler2D envMap;

			#include <common>

			void main() {

				vec3 outputDirection = normalize( vOutputDirection );
				vec2 uv = equirectUv( outputDirection );

				gl_FragColor = vec4( texture2D ( envMap, uv ).rgb, 1.0 );

			}
		`,blending:Ga,depthTest:!1,depthWrite:!1})}function sD(){return new Hl({name:"CubemapToCubeUV",uniforms:{envMap:{value:null},flipEnvMap:{value:-1}},vertexShader:PN(),fragmentShader:`

			precision mediump float;
			precision mediump int;

			uniform float flipEnvMap;

			varying vec3 vOutputDirection;

			uniform samplerCube envMap;

			void main() {

				gl_FragColor = textureCube( envMap, vec3( flipEnvMap * vOutputDirection.x, vOutputDirection.yz ) );

			}
		`,blending:Ga,depthTest:!1,depthWrite:!1})}function PN(){return`

		precision mediump float;
		precision mediump int;

		attribute float faceIndex;

		varying vec3 vOutputDirection;

		// RH coordinate system; PMREM face-indexing convention
		vec3 getDirection( vec2 uv, float face ) {

			uv = 2.0 * uv - 1.0;

			vec3 direction = vec3( uv, 1.0 );

			if ( face == 0.0 ) {

				direction = direction.zyx; // ( 1, v, u ) pos x

			} else if ( face == 1.0 ) {

				direction = direction.xzy;
				direction.xz *= -1.0; // ( -u, 1, -v ) pos y

			} else if ( face == 2.0 ) {

				direction.x *= -1.0; // ( -u, v, 1 ) pos z

			} else if ( face == 3.0 ) {

				direction = direction.zyx;
				direction.xz *= -1.0; // ( -1, v, -u ) neg x

			} else if ( face == 4.0 ) {

				direction = direction.xzy;
				direction.xy *= -1.0; // ( -u, -1, v ) neg y

			} else if ( face == 5.0 ) {

				direction.z *= -1.0; // ( u, v, -1 ) neg z

			}

			return direction;

		}

		void main() {

			vOutputDirection = getDirection( uv, faceIndex );
			gl_Position = vec4( position, 1.0 );

		}
	`}function uj(r){let e=new WeakMap,t=null;function n(l){if(l&&l.isTexture){const c=l.mapping,d=c===Pu||c===Iu,m=c===va||c===Wa;if(d||m){let y=e.get(l);const v=y!==void 0?y.texture.pmremVersion:0;if(l.isRenderTargetTexture&&l.pmremVersion!==v)return t===null&&(t=new h1(r)),y=d?t.fromEquirectangular(l,y):t.fromCubemap(l,y),y.texture.pmremVersion=l.pmremVersion,e.set(l,y),y.texture;if(y!==void 0)return y.texture;{const x=l.image;return d&&x&&x.height>0||m&&x&&i(x)?(t===null&&(t=new h1(r)),y=d?t.fromEquirectangular(l):t.fromCubemap(l),y.texture.pmremVersion=l.pmremVersion,e.set(l,y),l.addEventListener("dispose",s),y.texture):null}}}return l}function i(l){let c=0;const d=6;for(let m=0;m<d;m++)l[m]!==void 0&&c++;return c===d}function s(l){const c=l.target;c.removeEventListener("dispose",s);const d=e.get(c);d!==void 0&&(e.delete(c),d.dispose())}function a(){e=new WeakMap,t!==null&&(t.dispose(),t=null)}return{get:n,dispose:a}}function cj(r){const e={};function t(n){if(e[n]!==void 0)return e[n];let i;switch(n){case"WEBGL_depth_texture":i=r.getExtension("WEBGL_depth_texture")||r.getExtension("MOZ_WEBGL_depth_texture")||r.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":i=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":i=r.getExtension("WEBGL_compressed_texture_s3tc")||r.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":i=r.getExtension("WEBGL_compressed_texture_pvrtc")||r.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:i=r.getExtension(n)}return e[n]=i,i}return{has:function(n){return t(n)!==null},init:function(){t("EXT_color_buffer_float"),t("WEBGL_clip_cull_distance"),t("OES_texture_float_linear"),t("EXT_color_buffer_half_float"),t("WEBGL_multisampled_render_to_texture"),t("WEBGL_render_shared_exponent")},get:function(n){const i=t(n);return i===null&&Il("THREE.WebGLRenderer: "+n+" extension not supported."),i}}}function hj(r,e,t,n){const i={},s=new WeakMap;function a(y){const v=y.target;v.index!==null&&e.remove(v.index);for(const S in v.attributes)e.remove(v.attributes[S]);v.removeEventListener("dispose",a),delete i[v.id];const x=s.get(v);x&&(e.remove(x),s.delete(v)),n.releaseStatesOfGeometry(v),v.isInstancedBufferGeometry===!0&&delete v._maxInstanceCount,t.memory.geometries--}function l(y,v){return i[v.id]===!0||(v.addEventListener("dispose",a),i[v.id]=!0,t.memory.geometries++),v}function c(y){const v=y.attributes;for(const x in v)e.update(v[x],r.ARRAY_BUFFER)}function d(y){const v=[],x=y.index,S=y.attributes.position;let A=0;if(x!==null){const C=x.array;A=x.version;for(let w=0,D=C.length;w<D;w+=3){const z=C[w+0],B=C[w+1],F=C[w+2];v.push(z,B,B,F,F,z)}}else if(S!==void 0){const C=S.array;A=S.version;for(let w=0,D=C.length/3-1;w<D;w+=3){const z=w+0,B=w+1,F=w+2;v.push(z,B,B,F,F,z)}}else return;const E=new(I1(v)?lT:oT)(v,1);E.version=A;const M=s.get(y);M&&e.remove(M),s.set(y,E)}function m(y){const v=s.get(y);if(v){const x=y.index;x!==null&&v.version<x.version&&d(y)}else d(y);return s.get(y)}return{get:l,update:c,getWireframeAttribute:m}}function fj(r,e,t){let n;function i(v){n=v}let s,a;function l(v){s=v.type,a=v.bytesPerElement}function c(v,x){r.drawElements(n,x,s,v*a),t.update(x,n,1)}function d(v,x,S){S!==0&&(r.drawElementsInstanced(n,x,s,v*a,S),t.update(x,n,S))}function m(v,x,S){if(S===0)return;e.get("WEBGL_multi_draw").multiDrawElementsWEBGL(n,x,0,s,v,0,S);let E=0;for(let M=0;M<S;M++)E+=x[M];t.update(E,n,1)}function y(v,x,S,A){if(S===0)return;const E=e.get("WEBGL_multi_draw");if(E===null)for(let M=0;M<v.length;M++)d(v[M]/a,x[M],A[M]);else{E.multiDrawElementsInstancedWEBGL(n,x,0,s,v,0,A,0,S);let M=0;for(let C=0;C<S;C++)M+=x[C]*A[C];t.update(M,n,1)}}this.setMode=i,this.setIndex=l,this.render=c,this.renderInstances=d,this.renderMultiDraw=m,this.renderMultiDrawInstances=y}function dj(r){const e={geometries:0,textures:0},t={frame:0,calls:0,triangles:0,points:0,lines:0};function n(s,a,l){switch(t.calls++,a){case r.TRIANGLES:t.triangles+=l*(s/3);break;case r.LINES:t.lines+=l*(s/2);break;case r.LINE_STRIP:t.lines+=l*(s-1);break;case r.LINE_LOOP:t.lines+=l*s;break;case r.POINTS:t.points+=l*s;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",a);break}}function i(){t.calls=0,t.triangles=0,t.points=0,t.lines=0}return{memory:e,render:t,programs:null,autoReset:!0,reset:i,update:n}}function pj(r,e,t){const n=new WeakMap,i=new Ot;function s(a,l,c){const d=a.morphTargetInfluences,m=l.morphAttributes.position||l.morphAttributes.normal||l.morphAttributes.color,y=m!==void 0?m.length:0;let v=n.get(l);if(v===void 0||v.count!==y){let P=function(){H.dispose(),n.delete(l),l.removeEventListener("dispose",P)};var x=P;v!==void 0&&v.texture.dispose();const S=l.morphAttributes.position!==void 0,A=l.morphAttributes.normal!==void 0,E=l.morphAttributes.color!==void 0,M=l.morphAttributes.position||[],C=l.morphAttributes.normal||[],w=l.morphAttributes.color||[];let D=0;S===!0&&(D=1),A===!0&&(D=2),E===!0&&(D=3);let z=l.attributes.position.count*D,B=1;z>e.maxTextureSize&&(B=Math.ceil(z/e.maxTextureSize),z=e.maxTextureSize);const F=new Float32Array(z*B*4*y),H=new Jg(F,z,B,y);H.type=Ri,H.needsUpdate=!0;const I=D*4;for(let Z=0;Z<y;Z++){const ue=M[Z],se=C[Z],pe=w[Z],Se=z*B*4*Z;for(let V=0;V<ue.count;V++){const Q=V*I;S===!0&&(i.fromBufferAttribute(ue,V),F[Se+Q+0]=i.x,F[Se+Q+1]=i.y,F[Se+Q+2]=i.z,F[Se+Q+3]=0),A===!0&&(i.fromBufferAttribute(se,V),F[Se+Q+4]=i.x,F[Se+Q+5]=i.y,F[Se+Q+6]=i.z,F[Se+Q+7]=0),E===!0&&(i.fromBufferAttribute(pe,V),F[Se+Q+8]=i.x,F[Se+Q+9]=i.y,F[Se+Q+10]=i.z,F[Se+Q+11]=pe.itemSize===4?i.w:1)}}v={count:y,texture:H,size:new Xe(z,B)},n.set(l,v),l.addEventListener("dispose",P)}if(a.isInstancedMesh===!0&&a.morphTexture!==null)c.getUniforms().setValue(r,"morphTexture",a.morphTexture,t);else{let S=0;for(let E=0;E<d.length;E++)S+=d[E];const A=l.morphTargetsRelative?1:1-S;c.getUniforms().setValue(r,"morphTargetBaseInfluence",A),c.getUniforms().setValue(r,"morphTargetInfluences",d)}c.getUniforms().setValue(r,"morphTargetsTexture",v.texture,t),c.getUniforms().setValue(r,"morphTargetsTextureSize",v.size)}return{update:s}}function mj(r,e,t,n){let i=new WeakMap;function s(c){const d=n.render.frame,m=c.geometry,y=e.get(c,m);if(i.get(y)!==d&&(e.update(y),i.set(y,d)),c.isInstancedMesh&&(c.hasEventListener("dispose",l)===!1&&c.addEventListener("dispose",l),i.get(c)!==d&&(t.update(c.instanceMatrix,r.ARRAY_BUFFER),c.instanceColor!==null&&t.update(c.instanceColor,r.ARRAY_BUFFER),i.set(c,d))),c.isSkinnedMesh){const v=c.skeleton;i.get(v)!==d&&(v.update(),i.set(v,d))}return y}function a(){i=new WeakMap}function l(c){const d=c.target;d.removeEventListener("dispose",l),t.remove(d.instanceMatrix),d.instanceColor!==null&&t.remove(d.instanceColor)}return{update:s,dispose:a}}const WP=new Li,rD=new ya(1,1),XP=new Jg,YP=new aT,jP=new _p,aD=[],oD=[],lD=new Float32Array(16),uD=new Float32Array(9),cD=new Float32Array(4);function oy(r,e,t){const n=r[0];if(n<=0||n>0)return r;const i=e*t;let s=aD[i];if(s===void 0&&(s=new Float32Array(i),aD[i]=s),e!==0){n.toArray(s,0);for(let a=1,l=0;a!==e;++a)l+=t,r[a].toArray(s,l)}return s}function js(r,e){if(r.length!==e.length)return!1;for(let t=0,n=r.length;t<n;t++)if(r[t]!==e[t])return!1;return!0}function Zs(r,e){for(let t=0,n=e.length;t<n;t++)r[t]=e[t]}function iM(r,e){let t=oD[e];t===void 0&&(t=new Int32Array(e),oD[e]=t);for(let n=0;n!==e;++n)t[n]=r.allocateTextureUnit();return t}function gj(r,e){const t=this.cache;t[0]!==e&&(r.uniform1f(this.addr,e),t[0]=e)}function yj(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2f(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(js(t,e))return;r.uniform2fv(this.addr,e),Zs(t,e)}}function vj(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3f(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else if(e.r!==void 0)(t[0]!==e.r||t[1]!==e.g||t[2]!==e.b)&&(r.uniform3f(this.addr,e.r,e.g,e.b),t[0]=e.r,t[1]=e.g,t[2]=e.b);else{if(js(t,e))return;r.uniform3fv(this.addr,e),Zs(t,e)}}function _j(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4f(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(js(t,e))return;r.uniform4fv(this.addr,e),Zs(t,e)}}function xj(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(js(t,e))return;r.uniformMatrix2fv(this.addr,!1,e),Zs(t,e)}else{if(js(t,n))return;cD.set(n),r.uniformMatrix2fv(this.addr,!1,cD),Zs(t,n)}}function Sj(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(js(t,e))return;r.uniformMatrix3fv(this.addr,!1,e),Zs(t,e)}else{if(js(t,n))return;uD.set(n),r.uniformMatrix3fv(this.addr,!1,uD),Zs(t,n)}}function bj(r,e){const t=this.cache,n=e.elements;if(n===void 0){if(js(t,e))return;r.uniformMatrix4fv(this.addr,!1,e),Zs(t,e)}else{if(js(t,n))return;lD.set(n),r.uniformMatrix4fv(this.addr,!1,lD),Zs(t,n)}}function Tj(r,e){const t=this.cache;t[0]!==e&&(r.uniform1i(this.addr,e),t[0]=e)}function Mj(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2i(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(js(t,e))return;r.uniform2iv(this.addr,e),Zs(t,e)}}function Ej(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3i(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(js(t,e))return;r.uniform3iv(this.addr,e),Zs(t,e)}}function Aj(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4i(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(js(t,e))return;r.uniform4iv(this.addr,e),Zs(t,e)}}function Rj(r,e){const t=this.cache;t[0]!==e&&(r.uniform1ui(this.addr,e),t[0]=e)}function Nj(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y)&&(r.uniform2ui(this.addr,e.x,e.y),t[0]=e.x,t[1]=e.y);else{if(js(t,e))return;r.uniform2uiv(this.addr,e),Zs(t,e)}}function Cj(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z)&&(r.uniform3ui(this.addr,e.x,e.y,e.z),t[0]=e.x,t[1]=e.y,t[2]=e.z);else{if(js(t,e))return;r.uniform3uiv(this.addr,e),Zs(t,e)}}function wj(r,e){const t=this.cache;if(e.x!==void 0)(t[0]!==e.x||t[1]!==e.y||t[2]!==e.z||t[3]!==e.w)&&(r.uniform4ui(this.addr,e.x,e.y,e.z,e.w),t[0]=e.x,t[1]=e.y,t[2]=e.z,t[3]=e.w);else{if(js(t,e))return;r.uniform4uiv(this.addr,e),Zs(t,e)}}function Dj(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i);let s;this.type===r.SAMPLER_2D_SHADOW?(rD.compareFunction=W_,s=rD):s=WP,t.setTexture2D(e||s,i)}function Uj(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture3D(e||YP,i)}function Lj(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTextureCube(e||jP,i)}function Bj(r,e,t){const n=this.cache,i=t.allocateTextureUnit();n[0]!==i&&(r.uniform1i(this.addr,i),n[0]=i),t.setTexture2DArray(e||XP,i)}function Oj(r){switch(r){case 5126:return gj;case 35664:return yj;case 35665:return vj;case 35666:return _j;case 35674:return xj;case 35675:return Sj;case 35676:return bj;case 5124:case 35670:return Tj;case 35667:case 35671:return Mj;case 35668:case 35672:return Ej;case 35669:case 35673:return Aj;case 5125:return Rj;case 36294:return Nj;case 36295:return Cj;case 36296:return wj;case 35678:case 36198:case 36298:case 36306:case 35682:return Dj;case 35679:case 36299:case 36307:return Uj;case 35680:case 36300:case 36308:case 36293:return Lj;case 36289:case 36303:case 36311:case 36292:return Bj}}function Pj(r,e){r.uniform1fv(this.addr,e)}function Ij(r,e){const t=oy(e,this.size,2);r.uniform2fv(this.addr,t)}function Fj(r,e){const t=oy(e,this.size,3);r.uniform3fv(this.addr,t)}function zj(r,e){const t=oy(e,this.size,4);r.uniform4fv(this.addr,t)}function Vj(r,e){const t=oy(e,this.size,4);r.uniformMatrix2fv(this.addr,!1,t)}function Gj(r,e){const t=oy(e,this.size,9);r.uniformMatrix3fv(this.addr,!1,t)}function Hj(r,e){const t=oy(e,this.size,16);r.uniformMatrix4fv(this.addr,!1,t)}function kj(r,e){r.uniform1iv(this.addr,e)}function qj(r,e){r.uniform2iv(this.addr,e)}function Wj(r,e){r.uniform3iv(this.addr,e)}function Xj(r,e){r.uniform4iv(this.addr,e)}function Yj(r,e){r.uniform1uiv(this.addr,e)}function jj(r,e){r.uniform2uiv(this.addr,e)}function Zj(r,e){r.uniform3uiv(this.addr,e)}function Kj(r,e){r.uniform4uiv(this.addr,e)}function Qj(r,e,t){const n=this.cache,i=e.length,s=iM(t,i);js(n,s)||(r.uniform1iv(this.addr,s),Zs(n,s));for(let a=0;a!==i;++a)t.setTexture2D(e[a]||WP,s[a])}function Jj(r,e,t){const n=this.cache,i=e.length,s=iM(t,i);js(n,s)||(r.uniform1iv(this.addr,s),Zs(n,s));for(let a=0;a!==i;++a)t.setTexture3D(e[a]||YP,s[a])}function $j(r,e,t){const n=this.cache,i=e.length,s=iM(t,i);js(n,s)||(r.uniform1iv(this.addr,s),Zs(n,s));for(let a=0;a!==i;++a)t.setTextureCube(e[a]||jP,s[a])}function eZ(r,e,t){const n=this.cache,i=e.length,s=iM(t,i);js(n,s)||(r.uniform1iv(this.addr,s),Zs(n,s));for(let a=0;a!==i;++a)t.setTexture2DArray(e[a]||XP,s[a])}function tZ(r){switch(r){case 5126:return Pj;case 35664:return Ij;case 35665:return Fj;case 35666:return zj;case 35674:return Vj;case 35675:return Gj;case 35676:return Hj;case 5124:case 35670:return kj;case 35667:case 35671:return qj;case 35668:case 35672:return Wj;case 35669:case 35673:return Xj;case 5125:return Yj;case 36294:return jj;case 36295:return Zj;case 36296:return Kj;case 35678:case 36198:case 36298:case 36306:case 35682:return Qj;case 35679:case 36299:case 36307:return Jj;case 35680:case 36300:case 36308:case 36293:return $j;case 36289:case 36303:case 36311:case 36292:return eZ}}class nZ{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.setValue=Oj(t.type)}}class iZ{constructor(e,t,n){this.id=e,this.addr=n,this.cache=[],this.type=t.type,this.size=t.size,this.setValue=tZ(t.type)}}class sZ{constructor(e){this.id=e,this.seq=[],this.map={}}setValue(e,t,n){const i=this.seq;for(let s=0,a=i.length;s!==a;++s){const l=i[s];l.setValue(e,t[l.id],n)}}}const mA=/(\w+)(\])?(\[|\.)?/g;function hD(r,e){r.seq.push(e),r.map[e.id]=e}function rZ(r,e,t){const n=r.name,i=n.length;for(mA.lastIndex=0;;){const s=mA.exec(n),a=mA.lastIndex;let l=s[1];const c=s[2]==="]",d=s[3];if(c&&(l=l|0),d===void 0||d==="["&&a+2===i){hD(t,d===void 0?new nZ(l,r,e):new iZ(l,r,e));break}else{let y=t.map[l];y===void 0&&(y=new sZ(l),hD(t,y)),t=y}}}class ub{constructor(e,t){this.seq=[],this.map={};const n=e.getProgramParameter(t,e.ACTIVE_UNIFORMS);for(let i=0;i<n;++i){const s=e.getActiveUniform(t,i),a=e.getUniformLocation(t,s.name);rZ(s,a,this)}}setValue(e,t,n,i){const s=this.map[t];s!==void 0&&s.setValue(e,n,i)}setOptional(e,t,n){const i=t[n];i!==void 0&&this.setValue(e,n,i)}static upload(e,t,n,i){for(let s=0,a=t.length;s!==a;++s){const l=t[s],c=n[l.id];c.needsUpdate!==!1&&l.setValue(e,c.value,i)}}static seqWithValue(e,t){const n=[];for(let i=0,s=e.length;i!==s;++i){const a=e[i];a.id in t&&n.push(a)}return n}}function fD(r,e,t){const n=r.createShader(e);return r.shaderSource(n,t),r.compileShader(n),n}const aZ=37297;let oZ=0;function lZ(r,e){const t=r.split(`
`),n=[],i=Math.max(e-6,0),s=Math.min(e+6,t.length);for(let a=i;a<s;a++){const l=a+1;n.push(`${l===e?">":" "} ${l}: ${t[a]}`)}return n.join(`
`)}const dD=new Qt;function uZ(r){on._getMatrix(dD,on.workingColorSpace,r);const e=`mat3( ${dD.elements.map(t=>t.toFixed(4))} )`;switch(on.getTransfer(r)){case g_:return[e,"LinearTransferOETF"];case $n:return[e,"sRGBTransferOETF"];default:return console.warn("THREE.WebGLProgram: Unsupported color space: ",r),[e,"LinearTransferOETF"]}}function pD(r,e,t){const n=r.getShaderParameter(e,r.COMPILE_STATUS),i=r.getShaderInfoLog(e).trim();if(n&&i==="")return"";const s=/ERROR: 0:(\d+)/.exec(i);if(s){const a=parseInt(s[1]);return t.toUpperCase()+`

`+i+`

`+lZ(r.getShaderSource(e),a)}else return i}function cZ(r,e){const t=uZ(e);return[`vec4 ${r}( vec4 value ) {`,`	return ${t[1]}( vec4( value.rgb * ${t[0]}, value.a ) );`,"}"].join(`
`)}function hZ(r,e){let t;switch(e){case N1:t="Linear";break;case C1:t="Reinhard";break;case w1:t="Cineon";break;case jb:t="ACESFilmic";break;case D1:t="AgX";break;case U1:t="Neutral";break;case JD:t="Custom";break;default:console.warn("THREE.WebGLProgram: Unsupported toneMapping:",e),t="Linear"}return"vec3 "+r+"( vec3 color ) { return "+t+"ToneMapping( color ); }"}const QS=new Y;function fZ(){on.getLuminanceCoefficients(QS);const r=QS.x.toFixed(4),e=QS.y.toFixed(4),t=QS.z.toFixed(4);return["float luminance( const in vec3 rgb ) {",`	const vec3 weights = vec3( ${r}, ${e}, ${t} );`,"	return dot( weights, rgb );","}"].join(`
`)}function dZ(r){return[r.extensionClipCullDistance?"#extension GL_ANGLE_clip_cull_distance : require":"",r.extensionMultiDraw?"#extension GL_ANGLE_multi_draw : require":""].filter(e_).join(`
`)}function pZ(r){const e=[];for(const t in r){const n=r[t];n!==!1&&e.push("#define "+t+" "+n)}return e.join(`
`)}function mZ(r,e){const t={},n=r.getProgramParameter(e,r.ACTIVE_ATTRIBUTES);for(let i=0;i<n;i++){const s=r.getActiveAttrib(e,i),a=s.name;let l=1;s.type===r.FLOAT_MAT2&&(l=2),s.type===r.FLOAT_MAT3&&(l=3),s.type===r.FLOAT_MAT4&&(l=4),t[a]={type:s.type,location:r.getAttribLocation(e,a),locationSize:l}}return t}function e_(r){return r!==""}function mD(r,e){const t=e.numSpotLightShadows+e.numSpotLightMaps-e.numSpotLightShadowsWithMaps;return r.replace(/NUM_DIR_LIGHTS/g,e.numDirLights).replace(/NUM_SPOT_LIGHTS/g,e.numSpotLights).replace(/NUM_SPOT_LIGHT_MAPS/g,e.numSpotLightMaps).replace(/NUM_SPOT_LIGHT_COORDS/g,t).replace(/NUM_RECT_AREA_LIGHTS/g,e.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,e.numPointLights).replace(/NUM_HEMI_LIGHTS/g,e.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,e.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS_WITH_MAPS/g,e.numSpotLightShadowsWithMaps).replace(/NUM_SPOT_LIGHT_SHADOWS/g,e.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,e.numPointLightShadows)}function gD(r,e){return r.replace(/NUM_CLIPPING_PLANES/g,e.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,e.numClippingPlanes-e.numClipIntersection)}const gZ=/^[ \t]*#include +<([\w\d./]+)>/gm;function f1(r){return r.replace(gZ,vZ)}const yZ=new Map;function vZ(r,e){let t=_n[e];if(t===void 0){const n=yZ.get(e);if(n!==void 0)t=_n[n],console.warn('THREE.WebGLRenderer: Shader chunk "%s" has been deprecated. Use "%s" instead.',e,n);else throw new Error("Can not resolve #include <"+e+">")}return f1(t)}const _Z=/#pragma unroll_loop_start\s+for\s*\(\s*int\s+i\s*=\s*(\d+)\s*;\s*i\s*<\s*(\d+)\s*;\s*i\s*\+\+\s*\)\s*{([\s\S]+?)}\s+#pragma unroll_loop_end/g;function yD(r){return r.replace(_Z,xZ)}function xZ(r,e,t,n){let i="";for(let s=parseInt(e);s<parseInt(t);s++)i+=n.replace(/\[\s*i\s*\]/g,"[ "+s+" ]").replace(/UNROLLED_LOOP_INDEX/g,s);return i}function vD(r){let e=`precision ${r.precision} float;
	precision ${r.precision} int;
	precision ${r.precision} sampler2D;
	precision ${r.precision} samplerCube;
	precision ${r.precision} sampler3D;
	precision ${r.precision} sampler2DArray;
	precision ${r.precision} sampler2DShadow;
	precision ${r.precision} samplerCubeShadow;
	precision ${r.precision} sampler2DArrayShadow;
	precision ${r.precision} isampler2D;
	precision ${r.precision} isampler3D;
	precision ${r.precision} isamplerCube;
	precision ${r.precision} isampler2DArray;
	precision ${r.precision} usampler2D;
	precision ${r.precision} usampler3D;
	precision ${r.precision} usamplerCube;
	precision ${r.precision} usampler2DArray;
	`;return r.precision==="highp"?e+=`
#define HIGH_PRECISION`:r.precision==="mediump"?e+=`
#define MEDIUM_PRECISION`:r.precision==="lowp"&&(e+=`
#define LOW_PRECISION`),e}function SZ(r){let e="SHADOWMAP_TYPE_BASIC";return r.shadowMapType===F_?e="SHADOWMAP_TYPE_PCF":r.shadowMapType===t_?e="SHADOWMAP_TYPE_PCF_SOFT":r.shadowMapType===ua&&(e="SHADOWMAP_TYPE_VSM"),e}function bZ(r){let e="ENVMAP_TYPE_CUBE";if(r.envMap)switch(r.envMapMode){case va:case Wa:e="ENVMAP_TYPE_CUBE";break;case Ic:e="ENVMAP_TYPE_CUBE_UV";break}return e}function TZ(r){let e="ENVMAP_MODE_REFLECTION";if(r.envMap)switch(r.envMapMode){case Wa:e="ENVMAP_MODE_REFRACTION";break}return e}function MZ(r){let e="ENVMAP_BLENDING_NONE";if(r.envMap)switch(r.combine){case Kg:e="ENVMAP_BLENDING_MULTIPLY";break;case A1:e="ENVMAP_BLENDING_MIX";break;case R1:e="ENVMAP_BLENDING_ADD";break}return e}function EZ(r){const e=r.envMapCubeUVHeight;if(e===null)return null;const t=Math.log2(e)-2,n=1/e;return{texelWidth:1/(3*Math.max(Math.pow(2,t),7*16)),texelHeight:n,maxMip:t}}function AZ(r,e,t,n){const i=r.getContext(),s=t.defines;let a=t.vertexShader,l=t.fragmentShader;const c=SZ(t),d=bZ(t),m=TZ(t),y=MZ(t),v=EZ(t),x=dZ(t),S=pZ(s),A=i.createProgram();let E,M,C=t.glslVersion?"#version "+t.glslVersion+`
`:"";t.isRawShaderMaterial?(E=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,S].filter(e_).join(`
`),E.length>0&&(E+=`
`),M=["#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,S].filter(e_).join(`
`),M.length>0&&(M+=`
`)):(E=[vD(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,S,t.extensionClipCullDistance?"#define USE_CLIP_DISTANCE":"",t.batching?"#define USE_BATCHING":"",t.batchingColor?"#define USE_BATCHING_COLOR":"",t.instancing?"#define USE_INSTANCING":"",t.instancingColor?"#define USE_INSTANCING_COLOR":"",t.instancingMorph?"#define USE_INSTANCING_MORPH":"",t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.map?"#define USE_MAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+m:"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.displacementMap?"#define USE_DISPLACEMENTMAP":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.mapUv?"#define MAP_UV "+t.mapUv:"",t.alphaMapUv?"#define ALPHAMAP_UV "+t.alphaMapUv:"",t.lightMapUv?"#define LIGHTMAP_UV "+t.lightMapUv:"",t.aoMapUv?"#define AOMAP_UV "+t.aoMapUv:"",t.emissiveMapUv?"#define EMISSIVEMAP_UV "+t.emissiveMapUv:"",t.bumpMapUv?"#define BUMPMAP_UV "+t.bumpMapUv:"",t.normalMapUv?"#define NORMALMAP_UV "+t.normalMapUv:"",t.displacementMapUv?"#define DISPLACEMENTMAP_UV "+t.displacementMapUv:"",t.metalnessMapUv?"#define METALNESSMAP_UV "+t.metalnessMapUv:"",t.roughnessMapUv?"#define ROUGHNESSMAP_UV "+t.roughnessMapUv:"",t.anisotropyMapUv?"#define ANISOTROPYMAP_UV "+t.anisotropyMapUv:"",t.clearcoatMapUv?"#define CLEARCOATMAP_UV "+t.clearcoatMapUv:"",t.clearcoatNormalMapUv?"#define CLEARCOAT_NORMALMAP_UV "+t.clearcoatNormalMapUv:"",t.clearcoatRoughnessMapUv?"#define CLEARCOAT_ROUGHNESSMAP_UV "+t.clearcoatRoughnessMapUv:"",t.iridescenceMapUv?"#define IRIDESCENCEMAP_UV "+t.iridescenceMapUv:"",t.iridescenceThicknessMapUv?"#define IRIDESCENCE_THICKNESSMAP_UV "+t.iridescenceThicknessMapUv:"",t.sheenColorMapUv?"#define SHEEN_COLORMAP_UV "+t.sheenColorMapUv:"",t.sheenRoughnessMapUv?"#define SHEEN_ROUGHNESSMAP_UV "+t.sheenRoughnessMapUv:"",t.specularMapUv?"#define SPECULARMAP_UV "+t.specularMapUv:"",t.specularColorMapUv?"#define SPECULAR_COLORMAP_UV "+t.specularColorMapUv:"",t.specularIntensityMapUv?"#define SPECULAR_INTENSITYMAP_UV "+t.specularIntensityMapUv:"",t.transmissionMapUv?"#define TRANSMISSIONMAP_UV "+t.transmissionMapUv:"",t.thicknessMapUv?"#define THICKNESSMAP_UV "+t.thicknessMapUv:"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.flatShading?"#define FLAT_SHADED":"",t.skinning?"#define USE_SKINNING":"",t.morphTargets?"#define USE_MORPHTARGETS":"",t.morphNormals&&t.flatShading===!1?"#define USE_MORPHNORMALS":"",t.morphColors?"#define USE_MORPHCOLORS":"",t.morphTargetsCount>0?"#define MORPHTARGETS_TEXTURE_STRIDE "+t.morphTextureStride:"",t.morphTargetsCount>0?"#define MORPHTARGETS_COUNT "+t.morphTargetsCount:"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.sizeAttenuation?"#define USE_SIZEATTENUATION":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING","	attribute mat4 instanceMatrix;","#endif","#ifdef USE_INSTANCING_COLOR","	attribute vec3 instanceColor;","#endif","#ifdef USE_INSTANCING_MORPH","	uniform sampler2D morphTexture;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_UV1","	attribute vec2 uv1;","#endif","#ifdef USE_UV2","	attribute vec2 uv2;","#endif","#ifdef USE_UV3","	attribute vec2 uv3;","#endif","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#if defined( USE_COLOR_ALPHA )","	attribute vec4 color;","#elif defined( USE_COLOR )","	attribute vec3 color;","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(e_).join(`
`),M=[vD(t),"#define SHADER_TYPE "+t.shaderType,"#define SHADER_NAME "+t.shaderName,S,t.useFog&&t.fog?"#define USE_FOG":"",t.useFog&&t.fogExp2?"#define FOG_EXP2":"",t.alphaToCoverage?"#define ALPHA_TO_COVERAGE":"",t.map?"#define USE_MAP":"",t.matcap?"#define USE_MATCAP":"",t.envMap?"#define USE_ENVMAP":"",t.envMap?"#define "+d:"",t.envMap?"#define "+m:"",t.envMap?"#define "+y:"",v?"#define CUBEUV_TEXEL_WIDTH "+v.texelWidth:"",v?"#define CUBEUV_TEXEL_HEIGHT "+v.texelHeight:"",v?"#define CUBEUV_MAX_MIP "+v.maxMip+".0":"",t.lightMap?"#define USE_LIGHTMAP":"",t.aoMap?"#define USE_AOMAP":"",t.bumpMap?"#define USE_BUMPMAP":"",t.normalMap?"#define USE_NORMALMAP":"",t.normalMapObjectSpace?"#define USE_NORMALMAP_OBJECTSPACE":"",t.normalMapTangentSpace?"#define USE_NORMALMAP_TANGENTSPACE":"",t.emissiveMap?"#define USE_EMISSIVEMAP":"",t.anisotropy?"#define USE_ANISOTROPY":"",t.anisotropyMap?"#define USE_ANISOTROPYMAP":"",t.clearcoat?"#define USE_CLEARCOAT":"",t.clearcoatMap?"#define USE_CLEARCOATMAP":"",t.clearcoatRoughnessMap?"#define USE_CLEARCOAT_ROUGHNESSMAP":"",t.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",t.dispersion?"#define USE_DISPERSION":"",t.iridescence?"#define USE_IRIDESCENCE":"",t.iridescenceMap?"#define USE_IRIDESCENCEMAP":"",t.iridescenceThicknessMap?"#define USE_IRIDESCENCE_THICKNESSMAP":"",t.specularMap?"#define USE_SPECULARMAP":"",t.specularColorMap?"#define USE_SPECULAR_COLORMAP":"",t.specularIntensityMap?"#define USE_SPECULAR_INTENSITYMAP":"",t.roughnessMap?"#define USE_ROUGHNESSMAP":"",t.metalnessMap?"#define USE_METALNESSMAP":"",t.alphaMap?"#define USE_ALPHAMAP":"",t.alphaTest?"#define USE_ALPHATEST":"",t.alphaHash?"#define USE_ALPHAHASH":"",t.sheen?"#define USE_SHEEN":"",t.sheenColorMap?"#define USE_SHEEN_COLORMAP":"",t.sheenRoughnessMap?"#define USE_SHEEN_ROUGHNESSMAP":"",t.transmission?"#define USE_TRANSMISSION":"",t.transmissionMap?"#define USE_TRANSMISSIONMAP":"",t.thicknessMap?"#define USE_THICKNESSMAP":"",t.vertexTangents&&t.flatShading===!1?"#define USE_TANGENT":"",t.vertexColors||t.instancingColor||t.batchingColor?"#define USE_COLOR":"",t.vertexAlphas?"#define USE_COLOR_ALPHA":"",t.vertexUv1s?"#define USE_UV1":"",t.vertexUv2s?"#define USE_UV2":"",t.vertexUv3s?"#define USE_UV3":"",t.pointsUvs?"#define USE_POINTS_UV":"",t.gradientMap?"#define USE_GRADIENTMAP":"",t.flatShading?"#define FLAT_SHADED":"",t.doubleSided?"#define DOUBLE_SIDED":"",t.flipSided?"#define FLIP_SIDED":"",t.shadowMapEnabled?"#define USE_SHADOWMAP":"",t.shadowMapEnabled?"#define "+c:"",t.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",t.numLightProbes>0?"#define USE_LIGHT_PROBES":"",t.decodeVideoTexture?"#define DECODE_VIDEO_TEXTURE":"",t.decodeVideoTextureEmissive?"#define DECODE_VIDEO_TEXTURE_EMISSIVE":"",t.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",t.reverseDepthBuffer?"#define USE_REVERSEDEPTHBUF":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",t.toneMapping!==Gr?"#define TONE_MAPPING":"",t.toneMapping!==Gr?_n.tonemapping_pars_fragment:"",t.toneMapping!==Gr?hZ("toneMapping",t.toneMapping):"",t.dithering?"#define DITHERING":"",t.opaque?"#define OPAQUE":"",_n.colorspace_pars_fragment,cZ("linearToOutputTexel",t.outputColorSpace),fZ(),t.useDepthPacking?"#define DEPTH_PACKING "+t.depthPacking:"",`
`].filter(e_).join(`
`)),a=f1(a),a=mD(a,t),a=gD(a,t),l=f1(l),l=mD(l,t),l=gD(l,t),a=yD(a),l=yD(l),t.isRawShaderMaterial!==!0&&(C=`#version 300 es
`,E=[x,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+E,M=["#define varying in",t.glslVersion===PA?"":"layout(location = 0) out highp vec4 pc_fragColor;",t.glslVersion===PA?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+M);const w=C+E+a,D=C+M+l,z=fD(i,i.VERTEX_SHADER,w),B=fD(i,i.FRAGMENT_SHADER,D);i.attachShader(A,z),i.attachShader(A,B),t.index0AttributeName!==void 0?i.bindAttribLocation(A,0,t.index0AttributeName):t.morphTargets===!0&&i.bindAttribLocation(A,0,"position"),i.linkProgram(A);function F(Z){if(r.debug.checkShaderErrors){const ue=i.getProgramInfoLog(A).trim(),se=i.getShaderInfoLog(z).trim(),pe=i.getShaderInfoLog(B).trim();let Se=!0,V=!0;if(i.getProgramParameter(A,i.LINK_STATUS)===!1)if(Se=!1,typeof r.debug.onShaderError=="function")r.debug.onShaderError(i,A,z,B);else{const Q=pD(i,z,"vertex"),J=pD(i,B,"fragment");console.error("THREE.WebGLProgram: Shader Error "+i.getError()+" - VALIDATE_STATUS "+i.getProgramParameter(A,i.VALIDATE_STATUS)+`

Material Name: `+Z.name+`
Material Type: `+Z.type+`

Program Info Log: `+ue+`
`+Q+`
`+J)}else ue!==""?console.warn("THREE.WebGLProgram: Program Info Log:",ue):(se===""||pe==="")&&(V=!1);V&&(Z.diagnostics={runnable:Se,programLog:ue,vertexShader:{log:se,prefix:E},fragmentShader:{log:pe,prefix:M}})}i.deleteShader(z),i.deleteShader(B),H=new ub(i,A),I=mZ(i,A)}let H;this.getUniforms=function(){return H===void 0&&F(this),H};let I;this.getAttributes=function(){return I===void 0&&F(this),I};let P=t.rendererExtensionParallelShaderCompile===!1;return this.isReady=function(){return P===!1&&(P=i.getProgramParameter(A,aZ)),P},this.destroy=function(){n.releaseStatesOfProgram(this),i.deleteProgram(A),this.program=void 0},this.type=t.shaderType,this.name=t.shaderName,this.id=oZ++,this.cacheKey=e,this.usedTimes=1,this.program=A,this.vertexShader=z,this.fragmentShader=B,this}let RZ=0;class NZ{constructor(){this.shaderCache=new Map,this.materialCache=new Map}update(e){const t=e.vertexShader,n=e.fragmentShader,i=this._getShaderStage(t),s=this._getShaderStage(n),a=this._getShaderCacheForMaterial(e);return a.has(i)===!1&&(a.add(i),i.usedTimes++),a.has(s)===!1&&(a.add(s),s.usedTimes++),this}remove(e){const t=this.materialCache.get(e);for(const n of t)n.usedTimes--,n.usedTimes===0&&this.shaderCache.delete(n.code);return this.materialCache.delete(e),this}getVertexShaderID(e){return this._getShaderStage(e.vertexShader).id}getFragmentShaderID(e){return this._getShaderStage(e.fragmentShader).id}dispose(){this.shaderCache.clear(),this.materialCache.clear()}_getShaderCacheForMaterial(e){const t=this.materialCache;let n=t.get(e);return n===void 0&&(n=new Set,t.set(e,n)),n}_getShaderStage(e){const t=this.shaderCache;let n=t.get(e);return n===void 0&&(n=new CZ(e),t.set(e,n)),n}}class CZ{constructor(e){this.id=RZ++,this.code=e,this.usedTimes=0}}function wZ(r,e,t,n,i,s,a){const l=new zg,c=new NZ,d=new Set,m=[],y=i.logarithmicDepthBuffer,v=i.vertexTextures;let x=i.precision;const S={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"};function A(I){return d.add(I),I===0?"uv":`uv${I}`}function E(I,P,Z,ue,se){const pe=ue.fog,Se=se.geometry,V=I.isMeshStandardMaterial?ue.environment:null,Q=(I.isMeshStandardMaterial?t:e).get(I.envMap||V),J=Q&&Q.mapping===Ic?Q.image.height:null,ve=S[I.type];I.precision!==null&&(x=i.getMaxPrecision(I.precision),x!==I.precision&&console.warn("THREE.WebGLProgram.getParameters:",I.precision,"not supported, using",x,"instead."));const X=Se.morphAttributes.position||Se.morphAttributes.normal||Se.morphAttributes.color,re=X!==void 0?X.length:0;let we=0;Se.morphAttributes.position!==void 0&&(we=1),Se.morphAttributes.normal!==void 0&&(we=2),Se.morphAttributes.color!==void 0&&(we=3);let Fe,oe,De,je;if(ve){const Dn=Ll[ve];Fe=Dn.vertexShader,oe=Dn.fragmentShader}else Fe=I.vertexShader,oe=I.fragmentShader,c.update(I),De=c.getVertexShaderID(I),je=c.getFragmentShaderID(I);const nt=r.getRenderTarget(),lt=r.state.buffers.depth.getReversed(),nn=se.isInstancedMesh===!0,Pt=se.isBatchedMesh===!0,mn=!!I.map,An=!!I.matcap,$t=!!Q,ne=!!I.aoMap,oi=!!I.lightMap,Ze=!!I.bumpMap,Ge=!!I.normalMap,He=!!I.displacementMap,at=!!I.emissiveMap,Ie=!!I.metalnessMap,j=!!I.roughnessMap,G=I.anisotropy>0,de=I.clearcoat>0,Le=I.dispersion>0,ke=I.iridescence>0,Be=I.sheen>0,ct=I.transmission>0,it=G&&!!I.anisotropyMap,ot=de&&!!I.clearcoatMap,xn=de&&!!I.clearcoatNormalMap,et=de&&!!I.clearcoatRoughnessMap,St=ke&&!!I.iridescenceMap,Rt=ke&&!!I.iridescenceThicknessMap,Nt=Be&&!!I.sheenColorMap,ht=Be&&!!I.sheenRoughnessMap,dn=!!I.specularMap,kt=!!I.specularColorMap,zn=!!I.specularIntensityMap,fe=ct&&!!I.transmissionMap,mt=ct&&!!I.thicknessMap,Ue=!!I.gradientMap,Ke=!!I.alphaMap,yt=I.alphaTest>0,gt=!!I.alphaHash,Jt=!!I.extensions;let Qn=Gr;I.toneMapped&&(nt===null||nt.isXRRenderTarget===!0)&&(Qn=r.toneMapping);const Ci={shaderID:ve,shaderType:I.type,shaderName:I.name,vertexShader:Fe,fragmentShader:oe,defines:I.defines,customVertexShaderID:De,customFragmentShaderID:je,isRawShaderMaterial:I.isRawShaderMaterial===!0,glslVersion:I.glslVersion,precision:x,batching:Pt,batchingColor:Pt&&se._colorsTexture!==null,instancing:nn,instancingColor:nn&&se.instanceColor!==null,instancingMorph:nn&&se.morphTexture!==null,supportsVertexTextures:v,outputColorSpace:nt===null?r.outputColorSpace:nt.isXRRenderTarget===!0?nt.texture.colorSpace:xo,alphaToCoverage:!!I.alphaToCoverage,map:mn,matcap:An,envMap:$t,envMapMode:$t&&Q.mapping,envMapCubeUVHeight:J,aoMap:ne,lightMap:oi,bumpMap:Ze,normalMap:Ge,displacementMap:v&&He,emissiveMap:at,normalMapObjectSpace:Ge&&I.normalMapType===B1,normalMapTangentSpace:Ge&&I.normalMapType===Fu,metalnessMap:Ie,roughnessMap:j,anisotropy:G,anisotropyMap:it,clearcoat:de,clearcoatMap:ot,clearcoatNormalMap:xn,clearcoatRoughnessMap:et,dispersion:Le,iridescence:ke,iridescenceMap:St,iridescenceThicknessMap:Rt,sheen:Be,sheenColorMap:Nt,sheenRoughnessMap:ht,specularMap:dn,specularColorMap:kt,specularIntensityMap:zn,transmission:ct,transmissionMap:fe,thicknessMap:mt,gradientMap:Ue,opaque:I.transparent===!1&&I.blending===_o&&I.alphaToCoverage===!1,alphaMap:Ke,alphaTest:yt,alphaHash:gt,combine:I.combine,mapUv:mn&&A(I.map.channel),aoMapUv:ne&&A(I.aoMap.channel),lightMapUv:oi&&A(I.lightMap.channel),bumpMapUv:Ze&&A(I.bumpMap.channel),normalMapUv:Ge&&A(I.normalMap.channel),displacementMapUv:He&&A(I.displacementMap.channel),emissiveMapUv:at&&A(I.emissiveMap.channel),metalnessMapUv:Ie&&A(I.metalnessMap.channel),roughnessMapUv:j&&A(I.roughnessMap.channel),anisotropyMapUv:it&&A(I.anisotropyMap.channel),clearcoatMapUv:ot&&A(I.clearcoatMap.channel),clearcoatNormalMapUv:xn&&A(I.clearcoatNormalMap.channel),clearcoatRoughnessMapUv:et&&A(I.clearcoatRoughnessMap.channel),iridescenceMapUv:St&&A(I.iridescenceMap.channel),iridescenceThicknessMapUv:Rt&&A(I.iridescenceThicknessMap.channel),sheenColorMapUv:Nt&&A(I.sheenColorMap.channel),sheenRoughnessMapUv:ht&&A(I.sheenRoughnessMap.channel),specularMapUv:dn&&A(I.specularMap.channel),specularColorMapUv:kt&&A(I.specularColorMap.channel),specularIntensityMapUv:zn&&A(I.specularIntensityMap.channel),transmissionMapUv:fe&&A(I.transmissionMap.channel),thicknessMapUv:mt&&A(I.thicknessMap.channel),alphaMapUv:Ke&&A(I.alphaMap.channel),vertexTangents:!!Se.attributes.tangent&&(Ge||G),vertexColors:I.vertexColors,vertexAlphas:I.vertexColors===!0&&!!Se.attributes.color&&Se.attributes.color.itemSize===4,pointsUvs:se.isPoints===!0&&!!Se.attributes.uv&&(mn||Ke),fog:!!pe,useFog:I.fog===!0,fogExp2:!!pe&&pe.isFogExp2,flatShading:I.flatShading===!0,sizeAttenuation:I.sizeAttenuation===!0,logarithmicDepthBuffer:y,reverseDepthBuffer:lt,skinning:se.isSkinnedMesh===!0,morphTargets:Se.morphAttributes.position!==void 0,morphNormals:Se.morphAttributes.normal!==void 0,morphColors:Se.morphAttributes.color!==void 0,morphTargetsCount:re,morphTextureStride:we,numDirLights:P.directional.length,numPointLights:P.point.length,numSpotLights:P.spot.length,numSpotLightMaps:P.spotLightMap.length,numRectAreaLights:P.rectArea.length,numHemiLights:P.hemi.length,numDirLightShadows:P.directionalShadowMap.length,numPointLightShadows:P.pointShadowMap.length,numSpotLightShadows:P.spotShadowMap.length,numSpotLightShadowsWithMaps:P.numSpotLightShadowsWithMaps,numLightProbes:P.numLightProbes,numClippingPlanes:a.numPlanes,numClipIntersection:a.numIntersection,dithering:I.dithering,shadowMapEnabled:r.shadowMap.enabled&&Z.length>0,shadowMapType:r.shadowMap.type,toneMapping:Qn,decodeVideoTexture:mn&&I.map.isVideoTexture===!0&&on.getTransfer(I.map.colorSpace)===$n,decodeVideoTextureEmissive:at&&I.emissiveMap.isVideoTexture===!0&&on.getTransfer(I.emissiveMap.colorSpace)===$n,premultipliedAlpha:I.premultipliedAlpha,doubleSided:I.side===Fr,flipSided:I.side===Ti,useDepthPacking:I.depthPacking>=0,depthPacking:I.depthPacking||0,index0AttributeName:I.index0AttributeName,extensionClipCullDistance:Jt&&I.extensions.clipCullDistance===!0&&n.has("WEBGL_clip_cull_distance"),extensionMultiDraw:(Jt&&I.extensions.multiDraw===!0||Pt)&&n.has("WEBGL_multi_draw"),rendererExtensionParallelShaderCompile:n.has("KHR_parallel_shader_compile"),customProgramCacheKey:I.customProgramCacheKey()};return Ci.vertexUv1s=d.has(1),Ci.vertexUv2s=d.has(2),Ci.vertexUv3s=d.has(3),d.clear(),Ci}function M(I){const P=[];if(I.shaderID?P.push(I.shaderID):(P.push(I.customVertexShaderID),P.push(I.customFragmentShaderID)),I.defines!==void 0)for(const Z in I.defines)P.push(Z),P.push(I.defines[Z]);return I.isRawShaderMaterial===!1&&(C(P,I),w(P,I),P.push(r.outputColorSpace)),P.push(I.customProgramCacheKey),P.join()}function C(I,P){I.push(P.precision),I.push(P.outputColorSpace),I.push(P.envMapMode),I.push(P.envMapCubeUVHeight),I.push(P.mapUv),I.push(P.alphaMapUv),I.push(P.lightMapUv),I.push(P.aoMapUv),I.push(P.bumpMapUv),I.push(P.normalMapUv),I.push(P.displacementMapUv),I.push(P.emissiveMapUv),I.push(P.metalnessMapUv),I.push(P.roughnessMapUv),I.push(P.anisotropyMapUv),I.push(P.clearcoatMapUv),I.push(P.clearcoatNormalMapUv),I.push(P.clearcoatRoughnessMapUv),I.push(P.iridescenceMapUv),I.push(P.iridescenceThicknessMapUv),I.push(P.sheenColorMapUv),I.push(P.sheenRoughnessMapUv),I.push(P.specularMapUv),I.push(P.specularColorMapUv),I.push(P.specularIntensityMapUv),I.push(P.transmissionMapUv),I.push(P.thicknessMapUv),I.push(P.combine),I.push(P.fogExp2),I.push(P.sizeAttenuation),I.push(P.morphTargetsCount),I.push(P.morphAttributeCount),I.push(P.numDirLights),I.push(P.numPointLights),I.push(P.numSpotLights),I.push(P.numSpotLightMaps),I.push(P.numHemiLights),I.push(P.numRectAreaLights),I.push(P.numDirLightShadows),I.push(P.numPointLightShadows),I.push(P.numSpotLightShadows),I.push(P.numSpotLightShadowsWithMaps),I.push(P.numLightProbes),I.push(P.shadowMapType),I.push(P.toneMapping),I.push(P.numClippingPlanes),I.push(P.numClipIntersection),I.push(P.depthPacking)}function w(I,P){l.disableAll(),P.supportsVertexTextures&&l.enable(0),P.instancing&&l.enable(1),P.instancingColor&&l.enable(2),P.instancingMorph&&l.enable(3),P.matcap&&l.enable(4),P.envMap&&l.enable(5),P.normalMapObjectSpace&&l.enable(6),P.normalMapTangentSpace&&l.enable(7),P.clearcoat&&l.enable(8),P.iridescence&&l.enable(9),P.alphaTest&&l.enable(10),P.vertexColors&&l.enable(11),P.vertexAlphas&&l.enable(12),P.vertexUv1s&&l.enable(13),P.vertexUv2s&&l.enable(14),P.vertexUv3s&&l.enable(15),P.vertexTangents&&l.enable(16),P.anisotropy&&l.enable(17),P.alphaHash&&l.enable(18),P.batching&&l.enable(19),P.dispersion&&l.enable(20),P.batchingColor&&l.enable(21),I.push(l.mask),l.disableAll(),P.fog&&l.enable(0),P.useFog&&l.enable(1),P.flatShading&&l.enable(2),P.logarithmicDepthBuffer&&l.enable(3),P.reverseDepthBuffer&&l.enable(4),P.skinning&&l.enable(5),P.morphTargets&&l.enable(6),P.morphNormals&&l.enable(7),P.morphColors&&l.enable(8),P.premultipliedAlpha&&l.enable(9),P.shadowMapEnabled&&l.enable(10),P.doubleSided&&l.enable(11),P.flipSided&&l.enable(12),P.useDepthPacking&&l.enable(13),P.dithering&&l.enable(14),P.transmission&&l.enable(15),P.sheen&&l.enable(16),P.opaque&&l.enable(17),P.pointsUvs&&l.enable(18),P.decodeVideoTexture&&l.enable(19),P.decodeVideoTextureEmissive&&l.enable(20),P.alphaToCoverage&&l.enable(21),I.push(l.mask)}function D(I){const P=S[I.type];let Z;if(P){const ue=Ll[P];Z=MU.clone(ue.uniforms)}else Z=I.uniforms;return Z}function z(I,P){let Z;for(let ue=0,se=m.length;ue<se;ue++){const pe=m[ue];if(pe.cacheKey===P){Z=pe,++Z.usedTimes;break}}return Z===void 0&&(Z=new AZ(r,P,I,s),m.push(Z)),Z}function B(I){if(--I.usedTimes===0){const P=m.indexOf(I);m[P]=m[m.length-1],m.pop(),I.destroy()}}function F(I){c.remove(I)}function H(){c.dispose()}return{getParameters:E,getProgramCacheKey:M,getUniforms:D,acquireProgram:z,releaseProgram:B,releaseShaderCache:F,programs:m,dispose:H}}function DZ(){let r=new WeakMap;function e(a){return r.has(a)}function t(a){let l=r.get(a);return l===void 0&&(l={},r.set(a,l)),l}function n(a){r.delete(a)}function i(a,l,c){r.get(a)[l]=c}function s(){r=new WeakMap}return{has:e,get:t,remove:n,update:i,dispose:s}}function UZ(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.material.id!==e.material.id?r.material.id-e.material.id:r.z!==e.z?r.z-e.z:r.id-e.id}function _D(r,e){return r.groupOrder!==e.groupOrder?r.groupOrder-e.groupOrder:r.renderOrder!==e.renderOrder?r.renderOrder-e.renderOrder:r.z!==e.z?e.z-r.z:r.id-e.id}function xD(){const r=[];let e=0;const t=[],n=[],i=[];function s(){e=0,t.length=0,n.length=0,i.length=0}function a(y,v,x,S,A,E){let M=r[e];return M===void 0?(M={id:y.id,object:y,geometry:v,material:x,groupOrder:S,renderOrder:y.renderOrder,z:A,group:E},r[e]=M):(M.id=y.id,M.object=y,M.geometry=v,M.material=x,M.groupOrder=S,M.renderOrder=y.renderOrder,M.z=A,M.group=E),e++,M}function l(y,v,x,S,A,E){const M=a(y,v,x,S,A,E);x.transmission>0?n.push(M):x.transparent===!0?i.push(M):t.push(M)}function c(y,v,x,S,A,E){const M=a(y,v,x,S,A,E);x.transmission>0?n.unshift(M):x.transparent===!0?i.unshift(M):t.unshift(M)}function d(y,v){t.length>1&&t.sort(y||UZ),n.length>1&&n.sort(v||_D),i.length>1&&i.sort(v||_D)}function m(){for(let y=e,v=r.length;y<v;y++){const x=r[y];if(x.id===null)break;x.id=null,x.object=null,x.geometry=null,x.material=null,x.group=null}}return{opaque:t,transmissive:n,transparent:i,init:s,push:l,unshift:c,finish:m,sort:d}}function LZ(){let r=new WeakMap;function e(n,i){const s=r.get(n);let a;return s===void 0?(a=new xD,r.set(n,[a])):i>=s.length?(a=new xD,s.push(a)):a=s[i],a}function t(){r=new WeakMap}return{get:e,dispose:t}}function BZ(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={direction:new Y,color:new ft};break;case"SpotLight":t={position:new Y,direction:new Y,color:new ft,distance:0,coneCos:0,penumbraCos:0,decay:0};break;case"PointLight":t={position:new Y,color:new ft,distance:0,decay:0};break;case"HemisphereLight":t={direction:new Y,skyColor:new ft,groundColor:new ft};break;case"RectAreaLight":t={color:new ft,position:new Y,halfWidth:new Y,halfHeight:new Y};break}return r[e.id]=t,t}}}function OZ(){const r={};return{get:function(e){if(r[e.id]!==void 0)return r[e.id];let t;switch(e.type){case"DirectionalLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xe};break;case"SpotLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xe};break;case"PointLight":t={shadowIntensity:1,shadowBias:0,shadowNormalBias:0,shadowRadius:1,shadowMapSize:new Xe,shadowCameraNear:1,shadowCameraFar:1e3};break}return r[e.id]=t,t}}}let PZ=0;function IZ(r,e){return(e.castShadow?2:0)-(r.castShadow?2:0)+(e.map?1:0)-(r.map?1:0)}function FZ(r){const e=new BZ,t=OZ(),n={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1,numSpotMaps:-1,numLightProbes:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadow:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotLightMap:[],spotShadow:[],spotShadowMap:[],spotLightMatrix:[],rectArea:[],rectAreaLTC1:null,rectAreaLTC2:null,point:[],pointShadow:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numSpotLightShadowsWithMaps:0,numLightProbes:0};for(let d=0;d<9;d++)n.probe.push(new Y);const i=new Y,s=new Mt,a=new Mt;function l(d){let m=0,y=0,v=0;for(let I=0;I<9;I++)n.probe[I].set(0,0,0);let x=0,S=0,A=0,E=0,M=0,C=0,w=0,D=0,z=0,B=0,F=0;d.sort(IZ);for(let I=0,P=d.length;I<P;I++){const Z=d[I],ue=Z.color,se=Z.intensity,pe=Z.distance,Se=Z.shadow&&Z.shadow.map?Z.shadow.map.texture:null;if(Z.isAmbientLight)m+=ue.r*se,y+=ue.g*se,v+=ue.b*se;else if(Z.isLightProbe){for(let V=0;V<9;V++)n.probe[V].addScaledVector(Z.sh.coefficients[V],se);F++}else if(Z.isDirectionalLight){const V=e.get(Z);if(V.color.copy(Z.color).multiplyScalar(Z.intensity),Z.castShadow){const Q=Z.shadow,J=t.get(Z);J.shadowIntensity=Q.intensity,J.shadowBias=Q.bias,J.shadowNormalBias=Q.normalBias,J.shadowRadius=Q.radius,J.shadowMapSize=Q.mapSize,n.directionalShadow[x]=J,n.directionalShadowMap[x]=Se,n.directionalShadowMatrix[x]=Z.shadow.matrix,C++}n.directional[x]=V,x++}else if(Z.isSpotLight){const V=e.get(Z);V.position.setFromMatrixPosition(Z.matrixWorld),V.color.copy(ue).multiplyScalar(se),V.distance=pe,V.coneCos=Math.cos(Z.angle),V.penumbraCos=Math.cos(Z.angle*(1-Z.penumbra)),V.decay=Z.decay,n.spot[A]=V;const Q=Z.shadow;if(Z.map&&(n.spotLightMap[z]=Z.map,z++,Q.updateMatrices(Z),Z.castShadow&&B++),n.spotLightMatrix[A]=Q.matrix,Z.castShadow){const J=t.get(Z);J.shadowIntensity=Q.intensity,J.shadowBias=Q.bias,J.shadowNormalBias=Q.normalBias,J.shadowRadius=Q.radius,J.shadowMapSize=Q.mapSize,n.spotShadow[A]=J,n.spotShadowMap[A]=Se,D++}A++}else if(Z.isRectAreaLight){const V=e.get(Z);V.color.copy(ue).multiplyScalar(se),V.halfWidth.set(Z.width*.5,0,0),V.halfHeight.set(0,Z.height*.5,0),n.rectArea[E]=V,E++}else if(Z.isPointLight){const V=e.get(Z);if(V.color.copy(Z.color).multiplyScalar(Z.intensity),V.distance=Z.distance,V.decay=Z.decay,Z.castShadow){const Q=Z.shadow,J=t.get(Z);J.shadowIntensity=Q.intensity,J.shadowBias=Q.bias,J.shadowNormalBias=Q.normalBias,J.shadowRadius=Q.radius,J.shadowMapSize=Q.mapSize,J.shadowCameraNear=Q.camera.near,J.shadowCameraFar=Q.camera.far,n.pointShadow[S]=J,n.pointShadowMap[S]=Se,n.pointShadowMatrix[S]=Z.shadow.matrix,w++}n.point[S]=V,S++}else if(Z.isHemisphereLight){const V=e.get(Z);V.skyColor.copy(Z.color).multiplyScalar(se),V.groundColor.copy(Z.groundColor).multiplyScalar(se),n.hemi[M]=V,M++}}E>0&&(r.has("OES_texture_float_linear")===!0?(n.rectAreaLTC1=_t.LTC_FLOAT_1,n.rectAreaLTC2=_t.LTC_FLOAT_2):(n.rectAreaLTC1=_t.LTC_HALF_1,n.rectAreaLTC2=_t.LTC_HALF_2)),n.ambient[0]=m,n.ambient[1]=y,n.ambient[2]=v;const H=n.hash;(H.directionalLength!==x||H.pointLength!==S||H.spotLength!==A||H.rectAreaLength!==E||H.hemiLength!==M||H.numDirectionalShadows!==C||H.numPointShadows!==w||H.numSpotShadows!==D||H.numSpotMaps!==z||H.numLightProbes!==F)&&(n.directional.length=x,n.spot.length=A,n.rectArea.length=E,n.point.length=S,n.hemi.length=M,n.directionalShadow.length=C,n.directionalShadowMap.length=C,n.pointShadow.length=w,n.pointShadowMap.length=w,n.spotShadow.length=D,n.spotShadowMap.length=D,n.directionalShadowMatrix.length=C,n.pointShadowMatrix.length=w,n.spotLightMatrix.length=D+z-B,n.spotLightMap.length=z,n.numSpotLightShadowsWithMaps=B,n.numLightProbes=F,H.directionalLength=x,H.pointLength=S,H.spotLength=A,H.rectAreaLength=E,H.hemiLength=M,H.numDirectionalShadows=C,H.numPointShadows=w,H.numSpotShadows=D,H.numSpotMaps=z,H.numLightProbes=F,n.version=PZ++)}function c(d,m){let y=0,v=0,x=0,S=0,A=0;const E=m.matrixWorldInverse;for(let M=0,C=d.length;M<C;M++){const w=d[M];if(w.isDirectionalLight){const D=n.directional[y];D.direction.setFromMatrixPosition(w.matrixWorld),i.setFromMatrixPosition(w.target.matrixWorld),D.direction.sub(i),D.direction.transformDirection(E),y++}else if(w.isSpotLight){const D=n.spot[x];D.position.setFromMatrixPosition(w.matrixWorld),D.position.applyMatrix4(E),D.direction.setFromMatrixPosition(w.matrixWorld),i.setFromMatrixPosition(w.target.matrixWorld),D.direction.sub(i),D.direction.transformDirection(E),x++}else if(w.isRectAreaLight){const D=n.rectArea[S];D.position.setFromMatrixPosition(w.matrixWorld),D.position.applyMatrix4(E),a.identity(),s.copy(w.matrixWorld),s.premultiply(E),a.extractRotation(s),D.halfWidth.set(w.width*.5,0,0),D.halfHeight.set(0,w.height*.5,0),D.halfWidth.applyMatrix4(a),D.halfHeight.applyMatrix4(a),S++}else if(w.isPointLight){const D=n.point[v];D.position.setFromMatrixPosition(w.matrixWorld),D.position.applyMatrix4(E),v++}else if(w.isHemisphereLight){const D=n.hemi[A];D.direction.setFromMatrixPosition(w.matrixWorld),D.direction.transformDirection(E),A++}}}return{setup:l,setupView:c,state:n}}function SD(r){const e=new FZ(r),t=[],n=[];function i(m){d.camera=m,t.length=0,n.length=0}function s(m){t.push(m)}function a(m){n.push(m)}function l(){e.setup(t)}function c(m){e.setupView(t,m)}const d={lightsArray:t,shadowsArray:n,camera:null,lights:e,transmissionRenderTarget:{}};return{init:i,state:d,setupLights:l,setupLightsView:c,pushLight:s,pushShadow:a}}function zZ(r){let e=new WeakMap;function t(i,s=0){const a=e.get(i);let l;return a===void 0?(l=new SD(r),e.set(i,[l])):s>=a.length?(l=new SD(r),a.push(l)):l=a[s],l}function n(){e=new WeakMap}return{get:t,dispose:n}}const VZ=`void main() {
	gl_Position = vec4( position, 1.0 );
}`,GZ=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
	const float samples = float( VSM_SAMPLES );
	float mean = 0.0;
	float squared_mean = 0.0;
	float uvStride = samples <= 1.0 ? 0.0 : 2.0 / ( samples - 1.0 );
	float uvStart = samples <= 1.0 ? 0.0 : - 1.0;
	for ( float i = 0.0; i < samples; i ++ ) {
		float uvOffset = uvStart + i * uvStride;
		#ifdef HORIZONTAL_PASS
			vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( uvOffset, 0.0 ) * radius ) / resolution ) );
			mean += distribution.x;
			squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
		#else
			float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0, uvOffset ) * radius ) / resolution ) );
			mean += depth;
			squared_mean += depth * depth;
		#endif
	}
	mean = mean / samples;
	squared_mean = squared_mean / samples;
	float std_dev = sqrt( squared_mean - mean * mean );
	gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`;function HZ(r,e,t){let n=new ty;const i=new Xe,s=new Xe,a=new Ot,l=new nR({depthPacking:aU}),c=new iR,d={},m=t.maxTextureSize,y={[pa]:Ti,[Ti]:pa,[Fr]:Fr},v=new Hl({defines:{VSM_SAMPLES:8},uniforms:{shadow_pass:{value:null},resolution:{value:new Xe},radius:{value:4}},vertexShader:VZ,fragmentShader:GZ}),x=v.clone();x.defines.HORIZONTAL_PASS=1;const S=new fn;S.setAttribute("position",new Kn(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));const A=new bi(S,v),E=this;this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=F_;let M=this.type;this.render=function(B,F,H){if(E.enabled===!1||E.autoUpdate===!1&&E.needsUpdate===!1||B.length===0)return;const I=r.getRenderTarget(),P=r.getActiveCubeFace(),Z=r.getActiveMipmapLevel(),ue=r.state;ue.setBlending(Ga),ue.buffers.color.setClear(1,1,1,1),ue.buffers.depth.setTest(!0),ue.setScissorTest(!1);const se=M!==ua&&this.type===ua,pe=M===ua&&this.type!==ua;for(let Se=0,V=B.length;Se<V;Se++){const Q=B[Se],J=Q.shadow;if(J===void 0){console.warn("THREE.WebGLShadowMap:",Q,"has no shadow.");continue}if(J.autoUpdate===!1&&J.needsUpdate===!1)continue;i.copy(J.mapSize);const ve=J.getFrameExtents();if(i.multiply(ve),s.copy(J.mapSize),(i.x>m||i.y>m)&&(i.x>m&&(s.x=Math.floor(m/ve.x),i.x=s.x*ve.x,J.mapSize.x=s.x),i.y>m&&(s.y=Math.floor(m/ve.y),i.y=s.y*ve.y,J.mapSize.y=s.y)),J.map===null||se===!0||pe===!0){const re=this.type!==ua?{minFilter:Si,magFilter:Si}:{};J.map!==null&&J.map.dispose(),J.map=new Gl(i.x,i.y,re),J.map.texture.name=Q.name+".shadowMap",J.camera.updateProjectionMatrix()}r.setRenderTarget(J.map),r.clear();const X=J.getViewportCount();for(let re=0;re<X;re++){const we=J.getViewport(re);a.set(s.x*we.x,s.y*we.y,s.x*we.z,s.y*we.w),ue.viewport(a),J.updateMatrices(Q,re),n=J.getFrustum(),D(F,H,J.camera,Q,this.type)}J.isPointLightShadow!==!0&&this.type===ua&&C(J,H),J.needsUpdate=!1}M=this.type,E.needsUpdate=!1,r.setRenderTarget(I,P,Z)};function C(B,F){const H=e.update(A);v.defines.VSM_SAMPLES!==B.blurSamples&&(v.defines.VSM_SAMPLES=B.blurSamples,x.defines.VSM_SAMPLES=B.blurSamples,v.needsUpdate=!0,x.needsUpdate=!0),B.mapPass===null&&(B.mapPass=new Gl(i.x,i.y)),v.uniforms.shadow_pass.value=B.map.texture,v.uniforms.resolution.value=B.mapSize,v.uniforms.radius.value=B.radius,r.setRenderTarget(B.mapPass),r.clear(),r.renderBufferDirect(F,null,H,v,A,null),x.uniforms.shadow_pass.value=B.mapPass.texture,x.uniforms.resolution.value=B.mapSize,x.uniforms.radius.value=B.radius,r.setRenderTarget(B.map),r.clear(),r.renderBufferDirect(F,null,H,x,A,null)}function w(B,F,H,I){let P=null;const Z=H.isPointLight===!0?B.customDistanceMaterial:B.customDepthMaterial;if(Z!==void 0)P=Z;else if(P=H.isPointLight===!0?c:l,r.localClippingEnabled&&F.clipShadows===!0&&Array.isArray(F.clippingPlanes)&&F.clippingPlanes.length!==0||F.displacementMap&&F.displacementScale!==0||F.alphaMap&&F.alphaTest>0||F.map&&F.alphaTest>0){const ue=P.uuid,se=F.uuid;let pe=d[ue];pe===void 0&&(pe={},d[ue]=pe);let Se=pe[se];Se===void 0&&(Se=P.clone(),pe[se]=Se,F.addEventListener("dispose",z)),P=Se}if(P.visible=F.visible,P.wireframe=F.wireframe,I===ua?P.side=F.shadowSide!==null?F.shadowSide:F.side:P.side=F.shadowSide!==null?F.shadowSide:y[F.side],P.alphaMap=F.alphaMap,P.alphaTest=F.alphaTest,P.map=F.map,P.clipShadows=F.clipShadows,P.clippingPlanes=F.clippingPlanes,P.clipIntersection=F.clipIntersection,P.displacementMap=F.displacementMap,P.displacementScale=F.displacementScale,P.displacementBias=F.displacementBias,P.wireframeLinewidth=F.wireframeLinewidth,P.linewidth=F.linewidth,H.isPointLight===!0&&P.isMeshDistanceMaterial===!0){const ue=r.properties.get(P);ue.light=H}return P}function D(B,F,H,I,P){if(B.visible===!1)return;if(B.layers.test(F.layers)&&(B.isMesh||B.isLine||B.isPoints)&&(B.castShadow||B.receiveShadow&&P===ua)&&(!B.frustumCulled||n.intersectsObject(B))){B.modelViewMatrix.multiplyMatrices(H.matrixWorldInverse,B.matrixWorld);const se=e.update(B),pe=B.material;if(Array.isArray(pe)){const Se=se.groups;for(let V=0,Q=Se.length;V<Q;V++){const J=Se[V],ve=pe[J.materialIndex];if(ve&&ve.visible){const X=w(B,ve,I,P);B.onBeforeShadow(r,B,F,H,se,X,J),r.renderBufferDirect(H,null,se,X,B,J),B.onAfterShadow(r,B,F,H,se,X,J)}}}else if(pe.visible){const Se=w(B,pe,I,P);B.onBeforeShadow(r,B,F,H,se,Se,null),r.renderBufferDirect(H,null,se,Se,B,null),B.onAfterShadow(r,B,F,H,se,Se,null)}}const ue=B.children;for(let se=0,pe=ue.length;se<pe;se++)D(ue[se],F,H,I,P)}function z(B){B.target.removeEventListener("dispose",z);for(const H in d){const I=d[H],P=B.target.uuid;P in I&&(I[P].dispose(),delete I[P])}}}const kZ={[Tg]:Mg,[Eg]:Ng,[Ag]:Cg,[Pc]:Rg,[Mg]:Tg,[Ng]:Eg,[Cg]:Ag,[Rg]:Pc};function qZ(r,e){function t(){let fe=!1;const mt=new Ot;let Ue=null;const Ke=new Ot(0,0,0,0);return{setMask:function(yt){Ue!==yt&&!fe&&(r.colorMask(yt,yt,yt,yt),Ue=yt)},setLocked:function(yt){fe=yt},setClear:function(yt,gt,Jt,Qn,Ci){Ci===!0&&(yt*=Qn,gt*=Qn,Jt*=Qn),mt.set(yt,gt,Jt,Qn),Ke.equals(mt)===!1&&(r.clearColor(yt,gt,Jt,Qn),Ke.copy(mt))},reset:function(){fe=!1,Ue=null,Ke.set(-1,0,0,0)}}}function n(){let fe=!1,mt=!1,Ue=null,Ke=null,yt=null;return{setReversed:function(gt){if(mt!==gt){const Jt=e.get("EXT_clip_control");gt?Jt.clipControlEXT(Jt.LOWER_LEFT_EXT,Jt.ZERO_TO_ONE_EXT):Jt.clipControlEXT(Jt.LOWER_LEFT_EXT,Jt.NEGATIVE_ONE_TO_ONE_EXT),mt=gt;const Qn=yt;yt=null,this.setClear(Qn)}},getReversed:function(){return mt},setTest:function(gt){gt?nt(r.DEPTH_TEST):lt(r.DEPTH_TEST)},setMask:function(gt){Ue!==gt&&!fe&&(r.depthMask(gt),Ue=gt)},setFunc:function(gt){if(mt&&(gt=kZ[gt]),Ke!==gt){switch(gt){case Tg:r.depthFunc(r.NEVER);break;case Mg:r.depthFunc(r.ALWAYS);break;case Eg:r.depthFunc(r.LESS);break;case Pc:r.depthFunc(r.LEQUAL);break;case Ag:r.depthFunc(r.EQUAL);break;case Rg:r.depthFunc(r.GEQUAL);break;case Ng:r.depthFunc(r.GREATER);break;case Cg:r.depthFunc(r.NOTEQUAL);break;default:r.depthFunc(r.LEQUAL)}Ke=gt}},setLocked:function(gt){fe=gt},setClear:function(gt){yt!==gt&&(mt&&(gt=1-gt),r.clearDepth(gt),yt=gt)},reset:function(){fe=!1,Ue=null,Ke=null,yt=null,mt=!1}}}function i(){let fe=!1,mt=null,Ue=null,Ke=null,yt=null,gt=null,Jt=null,Qn=null,Ci=null;return{setTest:function(Dn){fe||(Dn?nt(r.STENCIL_TEST):lt(r.STENCIL_TEST))},setMask:function(Dn){mt!==Dn&&!fe&&(r.stencilMask(Dn),mt=Dn)},setFunc:function(Dn,Mr,ds){(Ue!==Dn||Ke!==Mr||yt!==ds)&&(r.stencilFunc(Dn,Mr,ds),Ue=Dn,Ke=Mr,yt=ds)},setOp:function(Dn,Mr,ds){(gt!==Dn||Jt!==Mr||Qn!==ds)&&(r.stencilOp(Dn,Mr,ds),gt=Dn,Jt=Mr,Qn=ds)},setLocked:function(Dn){fe=Dn},setClear:function(Dn){Ci!==Dn&&(r.clearStencil(Dn),Ci=Dn)},reset:function(){fe=!1,mt=null,Ue=null,Ke=null,yt=null,gt=null,Jt=null,Qn=null,Ci=null}}}const s=new t,a=new n,l=new i,c=new WeakMap,d=new WeakMap;let m={},y={},v=new WeakMap,x=[],S=null,A=!1,E=null,M=null,C=null,w=null,D=null,z=null,B=null,F=new ft(0,0,0),H=0,I=!1,P=null,Z=null,ue=null,se=null,pe=null;const Se=r.getParameter(r.MAX_COMBINED_TEXTURE_IMAGE_UNITS);let V=!1,Q=0;const J=r.getParameter(r.VERSION);J.indexOf("WebGL")!==-1?(Q=parseFloat(/^WebGL (\d)/.exec(J)[1]),V=Q>=1):J.indexOf("OpenGL ES")!==-1&&(Q=parseFloat(/^OpenGL ES (\d)/.exec(J)[1]),V=Q>=2);let ve=null,X={};const re=r.getParameter(r.SCISSOR_BOX),we=r.getParameter(r.VIEWPORT),Fe=new Ot().fromArray(re),oe=new Ot().fromArray(we);function De(fe,mt,Ue,Ke){const yt=new Uint8Array(4),gt=r.createTexture();r.bindTexture(fe,gt),r.texParameteri(fe,r.TEXTURE_MIN_FILTER,r.NEAREST),r.texParameteri(fe,r.TEXTURE_MAG_FILTER,r.NEAREST);for(let Jt=0;Jt<Ue;Jt++)fe===r.TEXTURE_3D||fe===r.TEXTURE_2D_ARRAY?r.texImage3D(mt,0,r.RGBA,1,1,Ke,0,r.RGBA,r.UNSIGNED_BYTE,yt):r.texImage2D(mt+Jt,0,r.RGBA,1,1,0,r.RGBA,r.UNSIGNED_BYTE,yt);return gt}const je={};je[r.TEXTURE_2D]=De(r.TEXTURE_2D,r.TEXTURE_2D,1),je[r.TEXTURE_CUBE_MAP]=De(r.TEXTURE_CUBE_MAP,r.TEXTURE_CUBE_MAP_POSITIVE_X,6),je[r.TEXTURE_2D_ARRAY]=De(r.TEXTURE_2D_ARRAY,r.TEXTURE_2D_ARRAY,1,1),je[r.TEXTURE_3D]=De(r.TEXTURE_3D,r.TEXTURE_3D,1,1),s.setClear(0,0,0,1),a.setClear(1),l.setClear(0),nt(r.DEPTH_TEST),a.setFunc(Pc),Ze(!1),Ge(fb),nt(r.CULL_FACE),ne(Ga);function nt(fe){m[fe]!==!0&&(r.enable(fe),m[fe]=!0)}function lt(fe){m[fe]!==!1&&(r.disable(fe),m[fe]=!1)}function nn(fe,mt){return y[fe]!==mt?(r.bindFramebuffer(fe,mt),y[fe]=mt,fe===r.DRAW_FRAMEBUFFER&&(y[r.FRAMEBUFFER]=mt),fe===r.FRAMEBUFFER&&(y[r.DRAW_FRAMEBUFFER]=mt),!0):!1}function Pt(fe,mt){let Ue=x,Ke=!1;if(fe){Ue=v.get(mt),Ue===void 0&&(Ue=[],v.set(mt,Ue));const yt=fe.textures;if(Ue.length!==yt.length||Ue[0]!==r.COLOR_ATTACHMENT0){for(let gt=0,Jt=yt.length;gt<Jt;gt++)Ue[gt]=r.COLOR_ATTACHMENT0+gt;Ue.length=yt.length,Ke=!0}}else Ue[0]!==r.BACK&&(Ue[0]=r.BACK,Ke=!0);Ke&&r.drawBuffers(Ue)}function mn(fe){return S!==fe?(r.useProgram(fe),S=fe,!0):!1}const An={[_r]:r.FUNC_ADD,[Fb]:r.FUNC_SUBTRACT,[zb]:r.FUNC_REVERSE_SUBTRACT};An[M1]=r.MIN,An[E1]=r.MAX;const $t={[Cu]:r.ZERO,[Vb]:r.ONE,[Gb]:r.SRC_COLOR,[Sg]:r.SRC_ALPHA,[Yb]:r.SRC_ALPHA_SATURATE,[Wb]:r.DST_COLOR,[kb]:r.DST_ALPHA,[Hb]:r.ONE_MINUS_SRC_COLOR,[bg]:r.ONE_MINUS_SRC_ALPHA,[Xb]:r.ONE_MINUS_DST_COLOR,[qb]:r.ONE_MINUS_DST_ALPHA,[jD]:r.CONSTANT_COLOR,[ZD]:r.ONE_MINUS_CONSTANT_COLOR,[KD]:r.CONSTANT_ALPHA,[QD]:r.ONE_MINUS_CONSTANT_ALPHA};function ne(fe,mt,Ue,Ke,yt,gt,Jt,Qn,Ci,Dn){if(fe===Ga){A===!0&&(lt(r.BLEND),A=!1);return}if(A===!1&&(nt(r.BLEND),A=!0),fe!==Vd){if(fe!==E||Dn!==I){if((M!==_r||D!==_r)&&(r.blendEquation(r.FUNC_ADD),M=_r,D=_r),Dn)switch(fe){case _o:r.blendFuncSeparate(r.ONE,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case Yd:r.blendFunc(r.ONE,r.ONE);break;case jd:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case Zd:r.blendFuncSeparate(r.ZERO,r.SRC_COLOR,r.ZERO,r.SRC_ALPHA);break;default:console.error("THREE.WebGLState: Invalid blending: ",fe);break}else switch(fe){case _o:r.blendFuncSeparate(r.SRC_ALPHA,r.ONE_MINUS_SRC_ALPHA,r.ONE,r.ONE_MINUS_SRC_ALPHA);break;case Yd:r.blendFunc(r.SRC_ALPHA,r.ONE);break;case jd:r.blendFuncSeparate(r.ZERO,r.ONE_MINUS_SRC_COLOR,r.ZERO,r.ONE);break;case Zd:r.blendFunc(r.ZERO,r.SRC_COLOR);break;default:console.error("THREE.WebGLState: Invalid blending: ",fe);break}C=null,w=null,z=null,B=null,F.set(0,0,0),H=0,E=fe,I=Dn}return}yt=yt||mt,gt=gt||Ue,Jt=Jt||Ke,(mt!==M||yt!==D)&&(r.blendEquationSeparate(An[mt],An[yt]),M=mt,D=yt),(Ue!==C||Ke!==w||gt!==z||Jt!==B)&&(r.blendFuncSeparate($t[Ue],$t[Ke],$t[gt],$t[Jt]),C=Ue,w=Ke,z=gt,B=Jt),(Qn.equals(F)===!1||Ci!==H)&&(r.blendColor(Qn.r,Qn.g,Qn.b,Ci),F.copy(Qn),H=Ci),E=fe,I=!1}function oi(fe,mt){fe.side===Fr?lt(r.CULL_FACE):nt(r.CULL_FACE);let Ue=fe.side===Ti;mt&&(Ue=!Ue),Ze(Ue),fe.blending===_o&&fe.transparent===!1?ne(Ga):ne(fe.blending,fe.blendEquation,fe.blendSrc,fe.blendDst,fe.blendEquationAlpha,fe.blendSrcAlpha,fe.blendDstAlpha,fe.blendColor,fe.blendAlpha,fe.premultipliedAlpha),a.setFunc(fe.depthFunc),a.setTest(fe.depthTest),a.setMask(fe.depthWrite),s.setMask(fe.colorWrite);const Ke=fe.stencilWrite;l.setTest(Ke),Ke&&(l.setMask(fe.stencilWriteMask),l.setFunc(fe.stencilFunc,fe.stencilRef,fe.stencilFuncMask),l.setOp(fe.stencilFail,fe.stencilZFail,fe.stencilZPass)),at(fe.polygonOffset,fe.polygonOffsetFactor,fe.polygonOffsetUnits),fe.alphaToCoverage===!0?nt(r.SAMPLE_ALPHA_TO_COVERAGE):lt(r.SAMPLE_ALPHA_TO_COVERAGE)}function Ze(fe){P!==fe&&(fe?r.frontFace(r.CW):r.frontFace(r.CCW),P=fe)}function Ge(fe){fe!==S1?(nt(r.CULL_FACE),fe!==Z&&(fe===fb?r.cullFace(r.BACK):fe===b1?r.cullFace(r.FRONT):r.cullFace(r.FRONT_AND_BACK))):lt(r.CULL_FACE),Z=fe}function He(fe){fe!==ue&&(V&&r.lineWidth(fe),ue=fe)}function at(fe,mt,Ue){fe?(nt(r.POLYGON_OFFSET_FILL),(se!==mt||pe!==Ue)&&(r.polygonOffset(mt,Ue),se=mt,pe=Ue)):lt(r.POLYGON_OFFSET_FILL)}function Ie(fe){fe?nt(r.SCISSOR_TEST):lt(r.SCISSOR_TEST)}function j(fe){fe===void 0&&(fe=r.TEXTURE0+Se-1),ve!==fe&&(r.activeTexture(fe),ve=fe)}function G(fe,mt,Ue){Ue===void 0&&(ve===null?Ue=r.TEXTURE0+Se-1:Ue=ve);let Ke=X[Ue];Ke===void 0&&(Ke={type:void 0,texture:void 0},X[Ue]=Ke),(Ke.type!==fe||Ke.texture!==mt)&&(ve!==Ue&&(r.activeTexture(Ue),ve=Ue),r.bindTexture(fe,mt||je[fe]),Ke.type=fe,Ke.texture=mt)}function de(){const fe=X[ve];fe!==void 0&&fe.type!==void 0&&(r.bindTexture(fe.type,null),fe.type=void 0,fe.texture=void 0)}function Le(){try{r.compressedTexImage2D(...arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function ke(){try{r.compressedTexImage3D(...arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function Be(){try{r.texSubImage2D(...arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function ct(){try{r.texSubImage3D(...arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function it(){try{r.compressedTexSubImage2D(...arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function ot(){try{r.compressedTexSubImage3D(...arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function xn(){try{r.texStorage2D(...arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function et(){try{r.texStorage3D(...arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function St(){try{r.texImage2D(...arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function Rt(){try{r.texImage3D(...arguments)}catch(fe){console.error("THREE.WebGLState:",fe)}}function Nt(fe){Fe.equals(fe)===!1&&(r.scissor(fe.x,fe.y,fe.z,fe.w),Fe.copy(fe))}function ht(fe){oe.equals(fe)===!1&&(r.viewport(fe.x,fe.y,fe.z,fe.w),oe.copy(fe))}function dn(fe,mt){let Ue=d.get(mt);Ue===void 0&&(Ue=new WeakMap,d.set(mt,Ue));let Ke=Ue.get(fe);Ke===void 0&&(Ke=r.getUniformBlockIndex(mt,fe.name),Ue.set(fe,Ke))}function kt(fe,mt){const Ke=d.get(mt).get(fe);c.get(mt)!==Ke&&(r.uniformBlockBinding(mt,Ke,fe.__bindingPointIndex),c.set(mt,Ke))}function zn(){r.disable(r.BLEND),r.disable(r.CULL_FACE),r.disable(r.DEPTH_TEST),r.disable(r.POLYGON_OFFSET_FILL),r.disable(r.SCISSOR_TEST),r.disable(r.STENCIL_TEST),r.disable(r.SAMPLE_ALPHA_TO_COVERAGE),r.blendEquation(r.FUNC_ADD),r.blendFunc(r.ONE,r.ZERO),r.blendFuncSeparate(r.ONE,r.ZERO,r.ONE,r.ZERO),r.blendColor(0,0,0,0),r.colorMask(!0,!0,!0,!0),r.clearColor(0,0,0,0),r.depthMask(!0),r.depthFunc(r.LESS),a.setReversed(!1),r.clearDepth(1),r.stencilMask(4294967295),r.stencilFunc(r.ALWAYS,0,4294967295),r.stencilOp(r.KEEP,r.KEEP,r.KEEP),r.clearStencil(0),r.cullFace(r.BACK),r.frontFace(r.CCW),r.polygonOffset(0,0),r.activeTexture(r.TEXTURE0),r.bindFramebuffer(r.FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.useProgram(null),r.lineWidth(1),r.scissor(0,0,r.canvas.width,r.canvas.height),r.viewport(0,0,r.canvas.width,r.canvas.height),m={},ve=null,X={},y={},v=new WeakMap,x=[],S=null,A=!1,E=null,M=null,C=null,w=null,D=null,z=null,B=null,F=new ft(0,0,0),H=0,I=!1,P=null,Z=null,ue=null,se=null,pe=null,Fe.set(0,0,r.canvas.width,r.canvas.height),oe.set(0,0,r.canvas.width,r.canvas.height),s.reset(),a.reset(),l.reset()}return{buffers:{color:s,depth:a,stencil:l},enable:nt,disable:lt,bindFramebuffer:nn,drawBuffers:Pt,useProgram:mn,setBlending:ne,setMaterial:oi,setFlipSided:Ze,setCullFace:Ge,setLineWidth:He,setPolygonOffset:at,setScissorTest:Ie,activeTexture:j,bindTexture:G,unbindTexture:de,compressedTexImage2D:Le,compressedTexImage3D:ke,texImage2D:St,texImage3D:Rt,updateUBOMapping:dn,uniformBlockBinding:kt,texStorage2D:xn,texStorage3D:et,texSubImage2D:Be,texSubImage3D:ct,compressedTexSubImage2D:it,compressedTexSubImage3D:ot,scissor:Nt,viewport:ht,reset:zn}}function WZ(r,e,t,n,i,s,a){const l=e.has("WEBGL_multisampled_render_to_texture")?e.get("WEBGL_multisampled_render_to_texture"):null,c=typeof navigator>"u"?!1:/OculusBrowser/g.test(navigator.userAgent),d=new Xe,m=new WeakMap;let y;const v=new WeakMap;let x=!1;try{x=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function S(j,G){return x?new OffscreenCanvas(j,G):y_("canvas")}function A(j,G,de){let Le=1;const ke=Ie(j);if((ke.width>de||ke.height>de)&&(Le=de/Math.max(ke.width,ke.height)),Le<1)if(typeof HTMLImageElement<"u"&&j instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&j instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&j instanceof ImageBitmap||typeof VideoFrame<"u"&&j instanceof VideoFrame){const Be=Math.floor(Le*ke.width),ct=Math.floor(Le*ke.height);y===void 0&&(y=S(Be,ct));const it=G?S(Be,ct):y;return it.width=Be,it.height=ct,it.getContext("2d").drawImage(j,0,0,Be,ct),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+ke.width+"x"+ke.height+") to ("+Be+"x"+ct+")."),it}else return"data"in j&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+ke.width+"x"+ke.height+")."),j;return j}function E(j){return j.generateMipmaps}function M(j){r.generateMipmap(j)}function C(j){return j.isWebGLCubeRenderTarget?r.TEXTURE_CUBE_MAP:j.isWebGL3DRenderTarget?r.TEXTURE_3D:j.isWebGLArrayRenderTarget||j.isCompressedArrayTexture?r.TEXTURE_2D_ARRAY:r.TEXTURE_2D}function w(j,G,de,Le,ke=!1){if(j!==null){if(r[j]!==void 0)return r[j];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+j+"'")}let Be=G;if(G===r.RED&&(de===r.FLOAT&&(Be=r.R32F),de===r.HALF_FLOAT&&(Be=r.R16F),de===r.UNSIGNED_BYTE&&(Be=r.R8)),G===r.RED_INTEGER&&(de===r.UNSIGNED_BYTE&&(Be=r.R8UI),de===r.UNSIGNED_SHORT&&(Be=r.R16UI),de===r.UNSIGNED_INT&&(Be=r.R32UI),de===r.BYTE&&(Be=r.R8I),de===r.SHORT&&(Be=r.R16I),de===r.INT&&(Be=r.R32I)),G===r.RG&&(de===r.FLOAT&&(Be=r.RG32F),de===r.HALF_FLOAT&&(Be=r.RG16F),de===r.UNSIGNED_BYTE&&(Be=r.RG8)),G===r.RG_INTEGER&&(de===r.UNSIGNED_BYTE&&(Be=r.RG8UI),de===r.UNSIGNED_SHORT&&(Be=r.RG16UI),de===r.UNSIGNED_INT&&(Be=r.RG32UI),de===r.BYTE&&(Be=r.RG8I),de===r.SHORT&&(Be=r.RG16I),de===r.INT&&(Be=r.RG32I)),G===r.RGB_INTEGER&&(de===r.UNSIGNED_BYTE&&(Be=r.RGB8UI),de===r.UNSIGNED_SHORT&&(Be=r.RGB16UI),de===r.UNSIGNED_INT&&(Be=r.RGB32UI),de===r.BYTE&&(Be=r.RGB8I),de===r.SHORT&&(Be=r.RGB16I),de===r.INT&&(Be=r.RGB32I)),G===r.RGBA_INTEGER&&(de===r.UNSIGNED_BYTE&&(Be=r.RGBA8UI),de===r.UNSIGNED_SHORT&&(Be=r.RGBA16UI),de===r.UNSIGNED_INT&&(Be=r.RGBA32UI),de===r.BYTE&&(Be=r.RGBA8I),de===r.SHORT&&(Be=r.RGBA16I),de===r.INT&&(Be=r.RGBA32I)),G===r.RGB&&de===r.UNSIGNED_INT_5_9_9_9_REV&&(Be=r.RGB9_E5),G===r.RGBA){const ct=ke?g_:on.getTransfer(Le);de===r.FLOAT&&(Be=r.RGBA32F),de===r.HALF_FLOAT&&(Be=r.RGBA16F),de===r.UNSIGNED_BYTE&&(Be=ct===$n?r.SRGB8_ALPHA8:r.RGBA8),de===r.UNSIGNED_SHORT_4_4_4_4&&(Be=r.RGBA4),de===r.UNSIGNED_SHORT_5_5_5_1&&(Be=r.RGB5_A1)}return(Be===r.R16F||Be===r.R32F||Be===r.RG16F||Be===r.RG32F||Be===r.RGBA16F||Be===r.RGBA32F)&&e.get("EXT_color_buffer_float"),Be}function D(j,G){let de;return j?G===null||G===di||G===Ha?de=r.DEPTH24_STENCIL8:G===Ri?de=r.DEPTH32F_STENCIL8:G===jo&&(de=r.DEPTH24_STENCIL8,console.warn("DepthTexture: 16 bit depth attachment is not supported with stencil. Using 24-bit attachment.")):G===null||G===di||G===Ha?de=r.DEPTH_COMPONENT24:G===Ri?de=r.DEPTH_COMPONENT32F:G===jo&&(de=r.DEPTH_COMPONENT16),de}function z(j,G){return E(j)===!0||j.isFramebufferTexture&&j.minFilter!==Si&&j.minFilter!==Zn?Math.log2(Math.max(G.width,G.height))+1:j.mipmaps!==void 0&&j.mipmaps.length>0?j.mipmaps.length:j.isCompressedTexture&&Array.isArray(j.image)?G.mipmaps.length:1}function B(j){const G=j.target;G.removeEventListener("dispose",B),H(G),G.isVideoTexture&&m.delete(G)}function F(j){const G=j.target;G.removeEventListener("dispose",F),P(G)}function H(j){const G=n.get(j);if(G.__webglInit===void 0)return;const de=j.source,Le=v.get(de);if(Le){const ke=Le[G.__cacheKey];ke.usedTimes--,ke.usedTimes===0&&I(j),Object.keys(Le).length===0&&v.delete(de)}n.remove(j)}function I(j){const G=n.get(j);r.deleteTexture(G.__webglTexture);const de=j.source,Le=v.get(de);delete Le[G.__cacheKey],a.memory.textures--}function P(j){const G=n.get(j);if(j.depthTexture&&(j.depthTexture.dispose(),n.remove(j.depthTexture)),j.isWebGLCubeRenderTarget)for(let Le=0;Le<6;Le++){if(Array.isArray(G.__webglFramebuffer[Le]))for(let ke=0;ke<G.__webglFramebuffer[Le].length;ke++)r.deleteFramebuffer(G.__webglFramebuffer[Le][ke]);else r.deleteFramebuffer(G.__webglFramebuffer[Le]);G.__webglDepthbuffer&&r.deleteRenderbuffer(G.__webglDepthbuffer[Le])}else{if(Array.isArray(G.__webglFramebuffer))for(let Le=0;Le<G.__webglFramebuffer.length;Le++)r.deleteFramebuffer(G.__webglFramebuffer[Le]);else r.deleteFramebuffer(G.__webglFramebuffer);if(G.__webglDepthbuffer&&r.deleteRenderbuffer(G.__webglDepthbuffer),G.__webglMultisampledFramebuffer&&r.deleteFramebuffer(G.__webglMultisampledFramebuffer),G.__webglColorRenderbuffer)for(let Le=0;Le<G.__webglColorRenderbuffer.length;Le++)G.__webglColorRenderbuffer[Le]&&r.deleteRenderbuffer(G.__webglColorRenderbuffer[Le]);G.__webglDepthRenderbuffer&&r.deleteRenderbuffer(G.__webglDepthRenderbuffer)}const de=j.textures;for(let Le=0,ke=de.length;Le<ke;Le++){const Be=n.get(de[Le]);Be.__webglTexture&&(r.deleteTexture(Be.__webglTexture),a.memory.textures--),n.remove(de[Le])}n.remove(j)}let Z=0;function ue(){Z=0}function se(){const j=Z;return j>=i.maxTextures&&console.warn("THREE.WebGLTextures: Trying to use "+j+" texture units while this GPU supports only "+i.maxTextures),Z+=1,j}function pe(j){const G=[];return G.push(j.wrapS),G.push(j.wrapT),G.push(j.wrapR||0),G.push(j.magFilter),G.push(j.minFilter),G.push(j.anisotropy),G.push(j.internalFormat),G.push(j.format),G.push(j.type),G.push(j.generateMipmaps),G.push(j.premultiplyAlpha),G.push(j.flipY),G.push(j.unpackAlignment),G.push(j.colorSpace),G.join()}function Se(j,G){const de=n.get(j);if(j.isVideoTexture&&He(j),j.isRenderTargetTexture===!1&&j.version>0&&de.__version!==j.version){const Le=j.image;if(Le===null)console.warn("THREE.WebGLRenderer: Texture marked for update but no image data found.");else if(Le.complete===!1)console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete");else{oe(de,j,G);return}}t.bindTexture(r.TEXTURE_2D,de.__webglTexture,r.TEXTURE0+G)}function V(j,G){const de=n.get(j);if(j.version>0&&de.__version!==j.version){oe(de,j,G);return}t.bindTexture(r.TEXTURE_2D_ARRAY,de.__webglTexture,r.TEXTURE0+G)}function Q(j,G){const de=n.get(j);if(j.version>0&&de.__version!==j.version){oe(de,j,G);return}t.bindTexture(r.TEXTURE_3D,de.__webglTexture,r.TEXTURE0+G)}function J(j,G){const de=n.get(j);if(j.version>0&&de.__version!==j.version){De(de,j,G);return}t.bindTexture(r.TEXTURE_CUBE_MAP,de.__webglTexture,r.TEXTURE0+G)}const ve={[zl]:r.REPEAT,[da]:r.CLAMP_TO_EDGE,[Fc]:r.MIRRORED_REPEAT},X={[Si]:r.NEAREST,[V_]:r.NEAREST_MIPMAP_NEAREST,[Ol]:r.NEAREST_MIPMAP_LINEAR,[Zn]:r.LINEAR,[ef]:r.LINEAR_MIPMAP_NEAREST,[xr]:r.LINEAR_MIPMAP_LINEAR},re={[eT]:r.NEVER,[rT]:r.ALWAYS,[q_]:r.LESS,[W_]:r.LEQUAL,[tT]:r.EQUAL,[sT]:r.GEQUAL,[nT]:r.GREATER,[iT]:r.NOTEQUAL};function we(j,G){if(G.type===Ri&&e.has("OES_texture_float_linear")===!1&&(G.magFilter===Zn||G.magFilter===ef||G.magFilter===Ol||G.magFilter===xr||G.minFilter===Zn||G.minFilter===ef||G.minFilter===Ol||G.minFilter===xr)&&console.warn("THREE.WebGLRenderer: Unable to use linear filtering with floating point textures. OES_texture_float_linear not supported on this device."),r.texParameteri(j,r.TEXTURE_WRAP_S,ve[G.wrapS]),r.texParameteri(j,r.TEXTURE_WRAP_T,ve[G.wrapT]),(j===r.TEXTURE_3D||j===r.TEXTURE_2D_ARRAY)&&r.texParameteri(j,r.TEXTURE_WRAP_R,ve[G.wrapR]),r.texParameteri(j,r.TEXTURE_MAG_FILTER,X[G.magFilter]),r.texParameteri(j,r.TEXTURE_MIN_FILTER,X[G.minFilter]),G.compareFunction&&(r.texParameteri(j,r.TEXTURE_COMPARE_MODE,r.COMPARE_REF_TO_TEXTURE),r.texParameteri(j,r.TEXTURE_COMPARE_FUNC,re[G.compareFunction])),e.has("EXT_texture_filter_anisotropic")===!0){if(G.magFilter===Si||G.minFilter!==Ol&&G.minFilter!==xr||G.type===Ri&&e.has("OES_texture_float_linear")===!1)return;if(G.anisotropy>1||n.get(G).__currentAnisotropy){const de=e.get("EXT_texture_filter_anisotropic");r.texParameterf(j,de.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(G.anisotropy,i.getMaxAnisotropy())),n.get(G).__currentAnisotropy=G.anisotropy}}}function Fe(j,G){let de=!1;j.__webglInit===void 0&&(j.__webglInit=!0,G.addEventListener("dispose",B));const Le=G.source;let ke=v.get(Le);ke===void 0&&(ke={},v.set(Le,ke));const Be=pe(G);if(Be!==j.__cacheKey){ke[Be]===void 0&&(ke[Be]={texture:r.createTexture(),usedTimes:0},a.memory.textures++,de=!0),ke[Be].usedTimes++;const ct=ke[j.__cacheKey];ct!==void 0&&(ke[j.__cacheKey].usedTimes--,ct.usedTimes===0&&I(G)),j.__cacheKey=Be,j.__webglTexture=ke[Be].texture}return de}function oe(j,G,de){let Le=r.TEXTURE_2D;(G.isDataArrayTexture||G.isCompressedArrayTexture)&&(Le=r.TEXTURE_2D_ARRAY),G.isData3DTexture&&(Le=r.TEXTURE_3D);const ke=Fe(j,G),Be=G.source;t.bindTexture(Le,j.__webglTexture,r.TEXTURE0+de);const ct=n.get(Be);if(Be.version!==ct.__version||ke===!0){t.activeTexture(r.TEXTURE0+de);const it=on.getPrimaries(on.workingColorSpace),ot=G.colorSpace===Ia?null:on.getPrimaries(G.colorSpace),xn=G.colorSpace===Ia||it===ot?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,G.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,G.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,G.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,xn);let et=A(G.image,!1,i.maxTextureSize);et=at(G,et);const St=s.convert(G.format,G.colorSpace),Rt=s.convert(G.type);let Nt=w(G.internalFormat,St,Rt,G.colorSpace,G.isVideoTexture);we(Le,G);let ht;const dn=G.mipmaps,kt=G.isVideoTexture!==!0,zn=ct.__version===void 0||ke===!0,fe=Be.dataReady,mt=z(G,et);if(G.isDepthTexture)Nt=D(G.format===qa,G.type),zn&&(kt?t.texStorage2D(r.TEXTURE_2D,1,Nt,et.width,et.height):t.texImage2D(r.TEXTURE_2D,0,Nt,et.width,et.height,0,St,Rt,null));else if(G.isDataTexture)if(dn.length>0){kt&&zn&&t.texStorage2D(r.TEXTURE_2D,mt,Nt,dn[0].width,dn[0].height);for(let Ue=0,Ke=dn.length;Ue<Ke;Ue++)ht=dn[Ue],kt?fe&&t.texSubImage2D(r.TEXTURE_2D,Ue,0,0,ht.width,ht.height,St,Rt,ht.data):t.texImage2D(r.TEXTURE_2D,Ue,Nt,ht.width,ht.height,0,St,Rt,ht.data);G.generateMipmaps=!1}else kt?(zn&&t.texStorage2D(r.TEXTURE_2D,mt,Nt,et.width,et.height),fe&&t.texSubImage2D(r.TEXTURE_2D,0,0,0,et.width,et.height,St,Rt,et.data)):t.texImage2D(r.TEXTURE_2D,0,Nt,et.width,et.height,0,St,Rt,et.data);else if(G.isCompressedTexture)if(G.isCompressedArrayTexture){kt&&zn&&t.texStorage3D(r.TEXTURE_2D_ARRAY,mt,Nt,dn[0].width,dn[0].height,et.depth);for(let Ue=0,Ke=dn.length;Ue<Ke;Ue++)if(ht=dn[Ue],G.format!==Ni)if(St!==null)if(kt){if(fe)if(G.layerUpdates.size>0){const yt=kA(ht.width,ht.height,G.format,G.type);for(const gt of G.layerUpdates){const Jt=ht.data.subarray(gt*yt/ht.data.BYTES_PER_ELEMENT,(gt+1)*yt/ht.data.BYTES_PER_ELEMENT);t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,Ue,0,0,gt,ht.width,ht.height,1,St,Jt)}G.clearLayerUpdates()}else t.compressedTexSubImage3D(r.TEXTURE_2D_ARRAY,Ue,0,0,0,ht.width,ht.height,et.depth,St,ht.data)}else t.compressedTexImage3D(r.TEXTURE_2D_ARRAY,Ue,Nt,ht.width,ht.height,et.depth,0,ht.data,0,0);else console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()");else kt?fe&&t.texSubImage3D(r.TEXTURE_2D_ARRAY,Ue,0,0,0,ht.width,ht.height,et.depth,St,Rt,ht.data):t.texImage3D(r.TEXTURE_2D_ARRAY,Ue,Nt,ht.width,ht.height,et.depth,0,St,Rt,ht.data)}else{kt&&zn&&t.texStorage2D(r.TEXTURE_2D,mt,Nt,dn[0].width,dn[0].height);for(let Ue=0,Ke=dn.length;Ue<Ke;Ue++)ht=dn[Ue],G.format!==Ni?St!==null?kt?fe&&t.compressedTexSubImage2D(r.TEXTURE_2D,Ue,0,0,ht.width,ht.height,St,ht.data):t.compressedTexImage2D(r.TEXTURE_2D,Ue,Nt,ht.width,ht.height,0,ht.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):kt?fe&&t.texSubImage2D(r.TEXTURE_2D,Ue,0,0,ht.width,ht.height,St,Rt,ht.data):t.texImage2D(r.TEXTURE_2D,Ue,Nt,ht.width,ht.height,0,St,Rt,ht.data)}else if(G.isDataArrayTexture)if(kt){if(zn&&t.texStorage3D(r.TEXTURE_2D_ARRAY,mt,Nt,et.width,et.height,et.depth),fe)if(G.layerUpdates.size>0){const Ue=kA(et.width,et.height,G.format,G.type);for(const Ke of G.layerUpdates){const yt=et.data.subarray(Ke*Ue/et.data.BYTES_PER_ELEMENT,(Ke+1)*Ue/et.data.BYTES_PER_ELEMENT);t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,Ke,et.width,et.height,1,St,Rt,yt)}G.clearLayerUpdates()}else t.texSubImage3D(r.TEXTURE_2D_ARRAY,0,0,0,0,et.width,et.height,et.depth,St,Rt,et.data)}else t.texImage3D(r.TEXTURE_2D_ARRAY,0,Nt,et.width,et.height,et.depth,0,St,Rt,et.data);else if(G.isData3DTexture)kt?(zn&&t.texStorage3D(r.TEXTURE_3D,mt,Nt,et.width,et.height,et.depth),fe&&t.texSubImage3D(r.TEXTURE_3D,0,0,0,0,et.width,et.height,et.depth,St,Rt,et.data)):t.texImage3D(r.TEXTURE_3D,0,Nt,et.width,et.height,et.depth,0,St,Rt,et.data);else if(G.isFramebufferTexture){if(zn)if(kt)t.texStorage2D(r.TEXTURE_2D,mt,Nt,et.width,et.height);else{let Ue=et.width,Ke=et.height;for(let yt=0;yt<mt;yt++)t.texImage2D(r.TEXTURE_2D,yt,Nt,Ue,Ke,0,St,Rt,null),Ue>>=1,Ke>>=1}}else if(dn.length>0){if(kt&&zn){const Ue=Ie(dn[0]);t.texStorage2D(r.TEXTURE_2D,mt,Nt,Ue.width,Ue.height)}for(let Ue=0,Ke=dn.length;Ue<Ke;Ue++)ht=dn[Ue],kt?fe&&t.texSubImage2D(r.TEXTURE_2D,Ue,0,0,St,Rt,ht):t.texImage2D(r.TEXTURE_2D,Ue,Nt,St,Rt,ht);G.generateMipmaps=!1}else if(kt){if(zn){const Ue=Ie(et);t.texStorage2D(r.TEXTURE_2D,mt,Nt,Ue.width,Ue.height)}fe&&t.texSubImage2D(r.TEXTURE_2D,0,0,0,St,Rt,et)}else t.texImage2D(r.TEXTURE_2D,0,Nt,St,Rt,et);E(G)&&M(Le),ct.__version=Be.version,G.onUpdate&&G.onUpdate(G)}j.__version=G.version}function De(j,G,de){if(G.image.length!==6)return;const Le=Fe(j,G),ke=G.source;t.bindTexture(r.TEXTURE_CUBE_MAP,j.__webglTexture,r.TEXTURE0+de);const Be=n.get(ke);if(ke.version!==Be.__version||Le===!0){t.activeTexture(r.TEXTURE0+de);const ct=on.getPrimaries(on.workingColorSpace),it=G.colorSpace===Ia?null:on.getPrimaries(G.colorSpace),ot=G.colorSpace===Ia||ct===it?r.NONE:r.BROWSER_DEFAULT_WEBGL;r.pixelStorei(r.UNPACK_FLIP_Y_WEBGL,G.flipY),r.pixelStorei(r.UNPACK_PREMULTIPLY_ALPHA_WEBGL,G.premultiplyAlpha),r.pixelStorei(r.UNPACK_ALIGNMENT,G.unpackAlignment),r.pixelStorei(r.UNPACK_COLORSPACE_CONVERSION_WEBGL,ot);const xn=G.isCompressedTexture||G.image[0].isCompressedTexture,et=G.image[0]&&G.image[0].isDataTexture,St=[];for(let Ke=0;Ke<6;Ke++)!xn&&!et?St[Ke]=A(G.image[Ke],!0,i.maxCubemapSize):St[Ke]=et?G.image[Ke].image:G.image[Ke],St[Ke]=at(G,St[Ke]);const Rt=St[0],Nt=s.convert(G.format,G.colorSpace),ht=s.convert(G.type),dn=w(G.internalFormat,Nt,ht,G.colorSpace),kt=G.isVideoTexture!==!0,zn=Be.__version===void 0||Le===!0,fe=ke.dataReady;let mt=z(G,Rt);we(r.TEXTURE_CUBE_MAP,G);let Ue;if(xn){kt&&zn&&t.texStorage2D(r.TEXTURE_CUBE_MAP,mt,dn,Rt.width,Rt.height);for(let Ke=0;Ke<6;Ke++){Ue=St[Ke].mipmaps;for(let yt=0;yt<Ue.length;yt++){const gt=Ue[yt];G.format!==Ni?Nt!==null?kt?fe&&t.compressedTexSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,yt,0,0,gt.width,gt.height,Nt,gt.data):t.compressedTexImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,yt,dn,gt.width,gt.height,0,gt.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):kt?fe&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,yt,0,0,gt.width,gt.height,Nt,ht,gt.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,yt,dn,gt.width,gt.height,0,Nt,ht,gt.data)}}}else{if(Ue=G.mipmaps,kt&&zn){Ue.length>0&&mt++;const Ke=Ie(St[0]);t.texStorage2D(r.TEXTURE_CUBE_MAP,mt,dn,Ke.width,Ke.height)}for(let Ke=0;Ke<6;Ke++)if(et){kt?fe&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,0,0,St[Ke].width,St[Ke].height,Nt,ht,St[Ke].data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,dn,St[Ke].width,St[Ke].height,0,Nt,ht,St[Ke].data);for(let yt=0;yt<Ue.length;yt++){const Jt=Ue[yt].image[Ke].image;kt?fe&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,yt+1,0,0,Jt.width,Jt.height,Nt,ht,Jt.data):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,yt+1,dn,Jt.width,Jt.height,0,Nt,ht,Jt.data)}}else{kt?fe&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,0,0,Nt,ht,St[Ke]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,0,dn,Nt,ht,St[Ke]);for(let yt=0;yt<Ue.length;yt++){const gt=Ue[yt];kt?fe&&t.texSubImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,yt+1,0,0,Nt,ht,gt.image[Ke]):t.texImage2D(r.TEXTURE_CUBE_MAP_POSITIVE_X+Ke,yt+1,dn,Nt,ht,gt.image[Ke])}}}E(G)&&M(r.TEXTURE_CUBE_MAP),Be.__version=ke.version,G.onUpdate&&G.onUpdate(G)}j.__version=G.version}function je(j,G,de,Le,ke,Be){const ct=s.convert(de.format,de.colorSpace),it=s.convert(de.type),ot=w(de.internalFormat,ct,it,de.colorSpace),xn=n.get(G),et=n.get(de);if(et.__renderTarget=G,!xn.__hasExternalTextures){const St=Math.max(1,G.width>>Be),Rt=Math.max(1,G.height>>Be);ke===r.TEXTURE_3D||ke===r.TEXTURE_2D_ARRAY?t.texImage3D(ke,Be,ot,St,Rt,G.depth,0,ct,it,null):t.texImage2D(ke,Be,ot,St,Rt,0,ct,it,null)}t.bindFramebuffer(r.FRAMEBUFFER,j),Ge(G)?l.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,Le,ke,et.__webglTexture,0,Ze(G)):(ke===r.TEXTURE_2D||ke>=r.TEXTURE_CUBE_MAP_POSITIVE_X&&ke<=r.TEXTURE_CUBE_MAP_NEGATIVE_Z)&&r.framebufferTexture2D(r.FRAMEBUFFER,Le,ke,et.__webglTexture,Be),t.bindFramebuffer(r.FRAMEBUFFER,null)}function nt(j,G,de){if(r.bindRenderbuffer(r.RENDERBUFFER,j),G.depthBuffer){const Le=G.depthTexture,ke=Le&&Le.isDepthTexture?Le.type:null,Be=D(G.stencilBuffer,ke),ct=G.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,it=Ze(G);Ge(G)?l.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,it,Be,G.width,G.height):de?r.renderbufferStorageMultisample(r.RENDERBUFFER,it,Be,G.width,G.height):r.renderbufferStorage(r.RENDERBUFFER,Be,G.width,G.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,ct,r.RENDERBUFFER,j)}else{const Le=G.textures;for(let ke=0;ke<Le.length;ke++){const Be=Le[ke],ct=s.convert(Be.format,Be.colorSpace),it=s.convert(Be.type),ot=w(Be.internalFormat,ct,it,Be.colorSpace),xn=Ze(G);de&&Ge(G)===!1?r.renderbufferStorageMultisample(r.RENDERBUFFER,xn,ot,G.width,G.height):Ge(G)?l.renderbufferStorageMultisampleEXT(r.RENDERBUFFER,xn,ot,G.width,G.height):r.renderbufferStorage(r.RENDERBUFFER,ot,G.width,G.height)}}r.bindRenderbuffer(r.RENDERBUFFER,null)}function lt(j,G){if(G&&G.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(t.bindFramebuffer(r.FRAMEBUFFER,j),!(G.depthTexture&&G.depthTexture.isDepthTexture))throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");const Le=n.get(G.depthTexture);Le.__renderTarget=G,(!Le.__webglTexture||G.depthTexture.image.width!==G.width||G.depthTexture.image.height!==G.height)&&(G.depthTexture.image.width=G.width,G.depthTexture.image.height=G.height,G.depthTexture.needsUpdate=!0),Se(G.depthTexture,0);const ke=Le.__webglTexture,Be=Ze(G);if(G.depthTexture.format===ka)Ge(G)?l.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,ke,0,Be):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_ATTACHMENT,r.TEXTURE_2D,ke,0);else if(G.depthTexture.format===qa)Ge(G)?l.framebufferTexture2DMultisampleEXT(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,ke,0,Be):r.framebufferTexture2D(r.FRAMEBUFFER,r.DEPTH_STENCIL_ATTACHMENT,r.TEXTURE_2D,ke,0);else throw new Error("Unknown depthTexture format")}function nn(j){const G=n.get(j),de=j.isWebGLCubeRenderTarget===!0;if(G.__boundDepthTexture!==j.depthTexture){const Le=j.depthTexture;if(G.__depthDisposeCallback&&G.__depthDisposeCallback(),Le){const ke=()=>{delete G.__boundDepthTexture,delete G.__depthDisposeCallback,Le.removeEventListener("dispose",ke)};Le.addEventListener("dispose",ke),G.__depthDisposeCallback=ke}G.__boundDepthTexture=Le}if(j.depthTexture&&!G.__autoAllocateDepthBuffer){if(de)throw new Error("target.depthTexture not supported in Cube render targets");lt(G.__webglFramebuffer,j)}else if(de){G.__webglDepthbuffer=[];for(let Le=0;Le<6;Le++)if(t.bindFramebuffer(r.FRAMEBUFFER,G.__webglFramebuffer[Le]),G.__webglDepthbuffer[Le]===void 0)G.__webglDepthbuffer[Le]=r.createRenderbuffer(),nt(G.__webglDepthbuffer[Le],j,!1);else{const ke=j.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,Be=G.__webglDepthbuffer[Le];r.bindRenderbuffer(r.RENDERBUFFER,Be),r.framebufferRenderbuffer(r.FRAMEBUFFER,ke,r.RENDERBUFFER,Be)}}else if(t.bindFramebuffer(r.FRAMEBUFFER,G.__webglFramebuffer),G.__webglDepthbuffer===void 0)G.__webglDepthbuffer=r.createRenderbuffer(),nt(G.__webglDepthbuffer,j,!1);else{const Le=j.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,ke=G.__webglDepthbuffer;r.bindRenderbuffer(r.RENDERBUFFER,ke),r.framebufferRenderbuffer(r.FRAMEBUFFER,Le,r.RENDERBUFFER,ke)}t.bindFramebuffer(r.FRAMEBUFFER,null)}function Pt(j,G,de){const Le=n.get(j);G!==void 0&&je(Le.__webglFramebuffer,j,j.texture,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,0),de!==void 0&&nn(j)}function mn(j){const G=j.texture,de=n.get(j),Le=n.get(G);j.addEventListener("dispose",F);const ke=j.textures,Be=j.isWebGLCubeRenderTarget===!0,ct=ke.length>1;if(ct||(Le.__webglTexture===void 0&&(Le.__webglTexture=r.createTexture()),Le.__version=G.version,a.memory.textures++),Be){de.__webglFramebuffer=[];for(let it=0;it<6;it++)if(G.mipmaps&&G.mipmaps.length>0){de.__webglFramebuffer[it]=[];for(let ot=0;ot<G.mipmaps.length;ot++)de.__webglFramebuffer[it][ot]=r.createFramebuffer()}else de.__webglFramebuffer[it]=r.createFramebuffer()}else{if(G.mipmaps&&G.mipmaps.length>0){de.__webglFramebuffer=[];for(let it=0;it<G.mipmaps.length;it++)de.__webglFramebuffer[it]=r.createFramebuffer()}else de.__webglFramebuffer=r.createFramebuffer();if(ct)for(let it=0,ot=ke.length;it<ot;it++){const xn=n.get(ke[it]);xn.__webglTexture===void 0&&(xn.__webglTexture=r.createTexture(),a.memory.textures++)}if(j.samples>0&&Ge(j)===!1){de.__webglMultisampledFramebuffer=r.createFramebuffer(),de.__webglColorRenderbuffer=[],t.bindFramebuffer(r.FRAMEBUFFER,de.__webglMultisampledFramebuffer);for(let it=0;it<ke.length;it++){const ot=ke[it];de.__webglColorRenderbuffer[it]=r.createRenderbuffer(),r.bindRenderbuffer(r.RENDERBUFFER,de.__webglColorRenderbuffer[it]);const xn=s.convert(ot.format,ot.colorSpace),et=s.convert(ot.type),St=w(ot.internalFormat,xn,et,ot.colorSpace,j.isXRRenderTarget===!0),Rt=Ze(j);r.renderbufferStorageMultisample(r.RENDERBUFFER,Rt,St,j.width,j.height),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+it,r.RENDERBUFFER,de.__webglColorRenderbuffer[it])}r.bindRenderbuffer(r.RENDERBUFFER,null),j.depthBuffer&&(de.__webglDepthRenderbuffer=r.createRenderbuffer(),nt(de.__webglDepthRenderbuffer,j,!0)),t.bindFramebuffer(r.FRAMEBUFFER,null)}}if(Be){t.bindTexture(r.TEXTURE_CUBE_MAP,Le.__webglTexture),we(r.TEXTURE_CUBE_MAP,G);for(let it=0;it<6;it++)if(G.mipmaps&&G.mipmaps.length>0)for(let ot=0;ot<G.mipmaps.length;ot++)je(de.__webglFramebuffer[it][ot],j,G,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+it,ot);else je(de.__webglFramebuffer[it],j,G,r.COLOR_ATTACHMENT0,r.TEXTURE_CUBE_MAP_POSITIVE_X+it,0);E(G)&&M(r.TEXTURE_CUBE_MAP),t.unbindTexture()}else if(ct){for(let it=0,ot=ke.length;it<ot;it++){const xn=ke[it],et=n.get(xn);t.bindTexture(r.TEXTURE_2D,et.__webglTexture),we(r.TEXTURE_2D,xn),je(de.__webglFramebuffer,j,xn,r.COLOR_ATTACHMENT0+it,r.TEXTURE_2D,0),E(xn)&&M(r.TEXTURE_2D)}t.unbindTexture()}else{let it=r.TEXTURE_2D;if((j.isWebGL3DRenderTarget||j.isWebGLArrayRenderTarget)&&(it=j.isWebGL3DRenderTarget?r.TEXTURE_3D:r.TEXTURE_2D_ARRAY),t.bindTexture(it,Le.__webglTexture),we(it,G),G.mipmaps&&G.mipmaps.length>0)for(let ot=0;ot<G.mipmaps.length;ot++)je(de.__webglFramebuffer[ot],j,G,r.COLOR_ATTACHMENT0,it,ot);else je(de.__webglFramebuffer,j,G,r.COLOR_ATTACHMENT0,it,0);E(G)&&M(it),t.unbindTexture()}j.depthBuffer&&nn(j)}function An(j){const G=j.textures;for(let de=0,Le=G.length;de<Le;de++){const ke=G[de];if(E(ke)){const Be=C(j),ct=n.get(ke).__webglTexture;t.bindTexture(Be,ct),M(Be),t.unbindTexture()}}}const $t=[],ne=[];function oi(j){if(j.samples>0){if(Ge(j)===!1){const G=j.textures,de=j.width,Le=j.height;let ke=r.COLOR_BUFFER_BIT;const Be=j.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT,ct=n.get(j),it=G.length>1;if(it)for(let ot=0;ot<G.length;ot++)t.bindFramebuffer(r.FRAMEBUFFER,ct.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ot,r.RENDERBUFFER,null),t.bindFramebuffer(r.FRAMEBUFFER,ct.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+ot,r.TEXTURE_2D,null,0);t.bindFramebuffer(r.READ_FRAMEBUFFER,ct.__webglMultisampledFramebuffer),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,ct.__webglFramebuffer);for(let ot=0;ot<G.length;ot++){if(j.resolveDepthBuffer&&(j.depthBuffer&&(ke|=r.DEPTH_BUFFER_BIT),j.stencilBuffer&&j.resolveStencilBuffer&&(ke|=r.STENCIL_BUFFER_BIT)),it){r.framebufferRenderbuffer(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.RENDERBUFFER,ct.__webglColorRenderbuffer[ot]);const xn=n.get(G[ot]).__webglTexture;r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,xn,0)}r.blitFramebuffer(0,0,de,Le,0,0,de,Le,ke,r.NEAREST),c===!0&&($t.length=0,ne.length=0,$t.push(r.COLOR_ATTACHMENT0+ot),j.depthBuffer&&j.resolveDepthBuffer===!1&&($t.push(Be),ne.push(Be),r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,ne)),r.invalidateFramebuffer(r.READ_FRAMEBUFFER,$t))}if(t.bindFramebuffer(r.READ_FRAMEBUFFER,null),t.bindFramebuffer(r.DRAW_FRAMEBUFFER,null),it)for(let ot=0;ot<G.length;ot++){t.bindFramebuffer(r.FRAMEBUFFER,ct.__webglMultisampledFramebuffer),r.framebufferRenderbuffer(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0+ot,r.RENDERBUFFER,ct.__webglColorRenderbuffer[ot]);const xn=n.get(G[ot]).__webglTexture;t.bindFramebuffer(r.FRAMEBUFFER,ct.__webglFramebuffer),r.framebufferTexture2D(r.DRAW_FRAMEBUFFER,r.COLOR_ATTACHMENT0+ot,r.TEXTURE_2D,xn,0)}t.bindFramebuffer(r.DRAW_FRAMEBUFFER,ct.__webglMultisampledFramebuffer)}else if(j.depthBuffer&&j.resolveDepthBuffer===!1&&c){const G=j.stencilBuffer?r.DEPTH_STENCIL_ATTACHMENT:r.DEPTH_ATTACHMENT;r.invalidateFramebuffer(r.DRAW_FRAMEBUFFER,[G])}}}function Ze(j){return Math.min(i.maxSamples,j.samples)}function Ge(j){const G=n.get(j);return j.samples>0&&e.has("WEBGL_multisampled_render_to_texture")===!0&&G.__useRenderToTexture!==!1}function He(j){const G=a.render.frame;m.get(j)!==G&&(m.set(j,G),j.update())}function at(j,G){const de=j.colorSpace,Le=j.format,ke=j.type;return j.isCompressedTexture===!0||j.isVideoTexture===!0||de!==xo&&de!==Ia&&(on.getTransfer(de)===$n?(Le!==Ni||ke!==Xi)&&console.warn("THREE.WebGLTextures: sRGB encoded textures have to use RGBAFormat and UnsignedByteType."):console.error("THREE.WebGLTextures: Unsupported texture color space:",de)),G}function Ie(j){return typeof HTMLImageElement<"u"&&j instanceof HTMLImageElement?(d.width=j.naturalWidth||j.width,d.height=j.naturalHeight||j.height):typeof VideoFrame<"u"&&j instanceof VideoFrame?(d.width=j.displayWidth,d.height=j.displayHeight):(d.width=j.width,d.height=j.height),d}this.allocateTextureUnit=se,this.resetTextureUnits=ue,this.setTexture2D=Se,this.setTexture2DArray=V,this.setTexture3D=Q,this.setTextureCube=J,this.rebindTextures=Pt,this.setupRenderTarget=mn,this.updateRenderTargetMipmap=An,this.updateMultisampleRenderTarget=oi,this.setupDepthRenderbuffer=nn,this.setupFrameBufferTexture=je,this.useMultisampledRTT=Ge}function ZP(r,e){function t(n,i=Ia){let s;const a=on.getTransfer(i);if(n===Xi)return r.UNSIGNED_BYTE;if(n===G_)return r.UNSIGNED_SHORT_4_4_4_4;if(n===H_)return r.UNSIGNED_SHORT_5_5_5_1;if(n===k_)return r.UNSIGNED_INT_5_9_9_9_REV;if(n===tf)return r.BYTE;if(n===nf)return r.SHORT;if(n===jo)return r.UNSIGNED_SHORT;if(n===Xs)return r.INT;if(n===di)return r.UNSIGNED_INT;if(n===Ri)return r.FLOAT;if(n===Ys)return r.HALF_FLOAT;if(n===Zb)return r.ALPHA;if(n===Qg)return r.RGB;if(n===Ni)return r.RGBA;if(n===Kb)return r.LUMINANCE;if(n===Qb)return r.LUMINANCE_ALPHA;if(n===ka)return r.DEPTH_COMPONENT;if(n===qa)return r.DEPTH_STENCIL;if(n===gp)return r.RED;if(n===ff)return r.RED_INTEGER;if(n===lf)return r.RG;if(n===yp)return r.RG_INTEGER;if(n===vp)return r.RGBA_INTEGER;if(n===sf||n===wc||n===Dc||n===Uc)if(a===$n)if(s=e.get("WEBGL_compressed_texture_s3tc_srgb"),s!==null){if(n===sf)return s.COMPRESSED_SRGB_S3TC_DXT1_EXT;if(n===wc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;if(n===Dc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;if(n===Uc)return s.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT}else return null;else if(s=e.get("WEBGL_compressed_texture_s3tc"),s!==null){if(n===sf)return s.COMPRESSED_RGB_S3TC_DXT1_EXT;if(n===wc)return s.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(n===Dc)return s.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(n===Uc)return s.COMPRESSED_RGBA_S3TC_DXT5_EXT}else return null;if(n===wg||n===Dg||n===Ug||n===Lg)if(s=e.get("WEBGL_compressed_texture_pvrtc"),s!==null){if(n===wg)return s.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(n===Dg)return s.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(n===Ug)return s.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(n===Lg)return s.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}else return null;if(n===Bg||n===Kd||n===Qd)if(s=e.get("WEBGL_compressed_texture_etc"),s!==null){if(n===Bg||n===Kd)return a===$n?s.COMPRESSED_SRGB8_ETC2:s.COMPRESSED_RGB8_ETC2;if(n===Qd)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC:s.COMPRESSED_RGBA8_ETC2_EAC}else return null;if(n===Jd||n===$d||n===ep||n===tp||n===np||n===ip||n===sp||n===rp||n===ap||n===op||n===lp||n===up||n===cp||n===hp)if(s=e.get("WEBGL_compressed_texture_astc"),s!==null){if(n===Jd)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:s.COMPRESSED_RGBA_ASTC_4x4_KHR;if(n===$d)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:s.COMPRESSED_RGBA_ASTC_5x4_KHR;if(n===ep)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:s.COMPRESSED_RGBA_ASTC_5x5_KHR;if(n===tp)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:s.COMPRESSED_RGBA_ASTC_6x5_KHR;if(n===np)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:s.COMPRESSED_RGBA_ASTC_6x6_KHR;if(n===ip)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:s.COMPRESSED_RGBA_ASTC_8x5_KHR;if(n===sp)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:s.COMPRESSED_RGBA_ASTC_8x6_KHR;if(n===rp)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:s.COMPRESSED_RGBA_ASTC_8x8_KHR;if(n===ap)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:s.COMPRESSED_RGBA_ASTC_10x5_KHR;if(n===op)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:s.COMPRESSED_RGBA_ASTC_10x6_KHR;if(n===lp)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:s.COMPRESSED_RGBA_ASTC_10x8_KHR;if(n===up)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:s.COMPRESSED_RGBA_ASTC_10x10_KHR;if(n===cp)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:s.COMPRESSED_RGBA_ASTC_12x10_KHR;if(n===hp)return a===$n?s.COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:s.COMPRESSED_RGBA_ASTC_12x12_KHR}else return null;if(n===rf||n===db||n===pb)if(s=e.get("EXT_texture_compression_bptc"),s!==null){if(n===rf)return a===$n?s.COMPRESSED_SRGB_ALPHA_BPTC_UNORM_EXT:s.COMPRESSED_RGBA_BPTC_UNORM_EXT;if(n===db)return s.COMPRESSED_RGB_BPTC_SIGNED_FLOAT_EXT;if(n===pb)return s.COMPRESSED_RGB_BPTC_UNSIGNED_FLOAT_EXT}else return null;if(n===Jb||n===Og||n===Pg||n===Ig)if(s=e.get("EXT_texture_compression_rgtc"),s!==null){if(n===rf)return s.COMPRESSED_RED_RGTC1_EXT;if(n===Og)return s.COMPRESSED_SIGNED_RED_RGTC1_EXT;if(n===Pg)return s.COMPRESSED_RED_GREEN_RGTC2_EXT;if(n===Ig)return s.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT}else return null;return n===Ha?r.UNSIGNED_INT_24_8:r[n]!==void 0?r[n]:null}return{convert:t}}const XZ=`
void main() {

	gl_Position = vec4( position, 1.0 );

}`,YZ=`
uniform sampler2DArray depthColor;
uniform float depthWidth;
uniform float depthHeight;

void main() {

	vec2 coord = vec2( gl_FragCoord.x / depthWidth, gl_FragCoord.y / depthHeight );

	if ( coord.x >= 1.0 ) {

		gl_FragDepth = texture( depthColor, vec3( coord.x - 1.0, coord.y, 1 ) ).r;

	} else {

		gl_FragDepth = texture( depthColor, vec3( coord.x, coord.y, 0 ) ).r;

	}

}`;class jZ{constructor(){this.texture=null,this.mesh=null,this.depthNear=0,this.depthFar=0}init(e,t,n){if(this.texture===null){const i=new Li,s=e.properties.get(i);s.__webglTexture=t.texture,(t.depthNear!==n.depthNear||t.depthFar!==n.depthFar)&&(this.depthNear=t.depthNear,this.depthFar=t.depthFar),this.texture=i}}getMesh(e){if(this.texture!==null&&this.mesh===null){const t=e.cameras[0].viewport,n=new Hl({vertexShader:XZ,fragmentShader:YZ,uniforms:{depthColor:{value:this.texture},depthWidth:{value:t.z},depthHeight:{value:t.w}}});this.mesh=new bi(new Sp(20,20),n)}return this.mesh}reset(){this.texture=null,this.mesh=null}getDepthTexture(){return this.texture}}class ZZ extends bo{constructor(e,t){super();const n=this;let i=null,s=1,a=null,l="local-floor",c=1,d=null,m=null,y=null,v=null,x=null,S=null;const A=new jZ,E=t.getContextAttributes();let M=null,C=null;const w=[],D=[],z=new Xe;let B=null;const F=new us;F.viewport=new Ot;const H=new us;H.viewport=new Ot;const I=[F,H],P=new vR;let Z=null,ue=null;this.cameraAutoUpdate=!0,this.enabled=!1,this.isPresenting=!1,this.getController=function(oe){let De=w[oe];return De===void 0&&(De=new i_,w[oe]=De),De.getTargetRaySpace()},this.getControllerGrip=function(oe){let De=w[oe];return De===void 0&&(De=new i_,w[oe]=De),De.getGripSpace()},this.getHand=function(oe){let De=w[oe];return De===void 0&&(De=new i_,w[oe]=De),De.getHandSpace()};function se(oe){const De=D.indexOf(oe.inputSource);if(De===-1)return;const je=w[De];je!==void 0&&(je.update(oe.inputSource,oe.frame,d||a),je.dispatchEvent({type:oe.type,data:oe.inputSource}))}function pe(){i.removeEventListener("select",se),i.removeEventListener("selectstart",se),i.removeEventListener("selectend",se),i.removeEventListener("squeeze",se),i.removeEventListener("squeezestart",se),i.removeEventListener("squeezeend",se),i.removeEventListener("end",pe),i.removeEventListener("inputsourceschange",Se);for(let oe=0;oe<w.length;oe++){const De=D[oe];De!==null&&(D[oe]=null,w[oe].disconnect(De))}Z=null,ue=null,A.reset(),e.setRenderTarget(M),x=null,v=null,y=null,i=null,C=null,Fe.stop(),n.isPresenting=!1,e.setPixelRatio(B),e.setSize(z.width,z.height,!1),n.dispatchEvent({type:"sessionend"})}this.setFramebufferScaleFactor=function(oe){s=oe,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change framebuffer scale while presenting.")},this.setReferenceSpaceType=function(oe){l=oe,n.isPresenting===!0&&console.warn("THREE.WebXRManager: Cannot change reference space type while presenting.")},this.getReferenceSpace=function(){return d||a},this.setReferenceSpace=function(oe){d=oe},this.getBaseLayer=function(){return v!==null?v:x},this.getBinding=function(){return y},this.getFrame=function(){return S},this.getSession=function(){return i},this.setSession=async function(oe){if(i=oe,i!==null){if(M=e.getRenderTarget(),i.addEventListener("select",se),i.addEventListener("selectstart",se),i.addEventListener("selectend",se),i.addEventListener("squeeze",se),i.addEventListener("squeezestart",se),i.addEventListener("squeezeend",se),i.addEventListener("end",pe),i.addEventListener("inputsourceschange",Se),E.xrCompatible!==!0&&await t.makeXRCompatible(),B=e.getPixelRatio(),e.getSize(z),typeof XRWebGLBinding<"u"&&"createProjectionLayer"in XRWebGLBinding.prototype){let je=null,nt=null,lt=null;E.depth&&(lt=E.stencil?t.DEPTH24_STENCIL8:t.DEPTH_COMPONENT24,je=E.stencil?qa:ka,nt=E.stencil?Ha:di);const nn={colorFormat:t.RGBA8,depthFormat:lt,scaleFactor:s};y=new XRWebGLBinding(i,t),v=y.createProjectionLayer(nn),i.updateRenderState({layers:[v]}),e.setPixelRatio(1),e.setSize(v.textureWidth,v.textureHeight,!1),C=new Gl(v.textureWidth,v.textureHeight,{format:Ni,type:Xi,depthTexture:new ya(v.textureWidth,v.textureHeight,nt,void 0,void 0,void 0,void 0,void 0,void 0,je),stencilBuffer:E.stencil,colorSpace:e.outputColorSpace,samples:E.antialias?4:0,resolveDepthBuffer:v.ignoreDepthValues===!1,resolveStencilBuffer:v.ignoreDepthValues===!1})}else{const je={antialias:E.antialias,alpha:!0,depth:E.depth,stencil:E.stencil,framebufferScaleFactor:s};x=new XRWebGLLayer(i,t,je),i.updateRenderState({baseLayer:x}),e.setPixelRatio(1),e.setSize(x.framebufferWidth,x.framebufferHeight,!1),C=new Gl(x.framebufferWidth,x.framebufferHeight,{format:Ni,type:Xi,colorSpace:e.outputColorSpace,stencilBuffer:E.stencil,resolveDepthBuffer:x.ignoreDepthValues===!1,resolveStencilBuffer:x.ignoreDepthValues===!1})}C.isXRRenderTarget=!0,this.setFoveation(c),d=null,a=await i.requestReferenceSpace(l),Fe.setContext(i),Fe.start(),n.isPresenting=!0,n.dispatchEvent({type:"sessionstart"})}},this.getEnvironmentBlendMode=function(){if(i!==null)return i.environmentBlendMode},this.getDepthTexture=function(){return A.getDepthTexture()};function Se(oe){for(let De=0;De<oe.removed.length;De++){const je=oe.removed[De],nt=D.indexOf(je);nt>=0&&(D[nt]=null,w[nt].disconnect(je))}for(let De=0;De<oe.added.length;De++){const je=oe.added[De];let nt=D.indexOf(je);if(nt===-1){for(let nn=0;nn<w.length;nn++)if(nn>=D.length){D.push(je),nt=nn;break}else if(D[nn]===null){D[nn]=je,nt=nn;break}if(nt===-1)break}const lt=w[nt];lt&&lt.connect(je)}}const V=new Y,Q=new Y;function J(oe,De,je){V.setFromMatrixPosition(De.matrixWorld),Q.setFromMatrixPosition(je.matrixWorld);const nt=V.distanceTo(Q),lt=De.projectionMatrix.elements,nn=je.projectionMatrix.elements,Pt=lt[14]/(lt[10]-1),mn=lt[14]/(lt[10]+1),An=(lt[9]+1)/lt[5],$t=(lt[9]-1)/lt[5],ne=(lt[8]-1)/lt[0],oi=(nn[8]+1)/nn[0],Ze=Pt*ne,Ge=Pt*oi,He=nt/(-ne+oi),at=He*-ne;if(De.matrixWorld.decompose(oe.position,oe.quaternion,oe.scale),oe.translateX(at),oe.translateZ(He),oe.matrixWorld.compose(oe.position,oe.quaternion,oe.scale),oe.matrixWorldInverse.copy(oe.matrixWorld).invert(),lt[10]===-1)oe.projectionMatrix.copy(De.projectionMatrix),oe.projectionMatrixInverse.copy(De.projectionMatrixInverse);else{const Ie=Pt+He,j=mn+He,G=Ze-at,de=Ge+(nt-at),Le=An*mn/j*Ie,ke=$t*mn/j*Ie;oe.projectionMatrix.makePerspective(G,de,Le,ke,Ie,j),oe.projectionMatrixInverse.copy(oe.projectionMatrix).invert()}}function ve(oe,De){De===null?oe.matrixWorld.copy(oe.matrix):oe.matrixWorld.multiplyMatrices(De.matrixWorld,oe.matrix),oe.matrixWorldInverse.copy(oe.matrixWorld).invert()}this.updateCamera=function(oe){if(i===null)return;let De=oe.near,je=oe.far;A.texture!==null&&(A.depthNear>0&&(De=A.depthNear),A.depthFar>0&&(je=A.depthFar)),P.near=H.near=F.near=De,P.far=H.far=F.far=je,(Z!==P.near||ue!==P.far)&&(i.updateRenderState({depthNear:P.near,depthFar:P.far}),Z=P.near,ue=P.far),F.layers.mask=oe.layers.mask|2,H.layers.mask=oe.layers.mask|4,P.layers.mask=F.layers.mask|H.layers.mask;const nt=oe.parent,lt=P.cameras;ve(P,nt);for(let nn=0;nn<lt.length;nn++)ve(lt[nn],nt);lt.length===2?J(P,F,H):P.projectionMatrix.copy(F.projectionMatrix),X(oe,P,nt)};function X(oe,De,je){je===null?oe.matrix.copy(De.matrixWorld):(oe.matrix.copy(je.matrixWorld),oe.matrix.invert(),oe.matrix.multiply(De.matrixWorld)),oe.matrix.decompose(oe.position,oe.quaternion,oe.scale),oe.updateMatrixWorld(!0),oe.projectionMatrix.copy(De.projectionMatrix),oe.projectionMatrixInverse.copy(De.projectionMatrixInverse),oe.isPerspectiveCamera&&(oe.fov=fp*2*Math.atan(1/oe.projectionMatrix.elements[5]),oe.zoom=1)}this.getCamera=function(){return P},this.getFoveation=function(){if(!(v===null&&x===null))return c},this.setFoveation=function(oe){c=oe,v!==null&&(v.fixedFoveation=oe),x!==null&&x.fixedFoveation!==void 0&&(x.fixedFoveation=oe)},this.hasDepthSensing=function(){return A.texture!==null},this.getDepthSensingMesh=function(){return A.getMesh(P)};let re=null;function we(oe,De){if(m=De.getViewerPose(d||a),S=De,m!==null){const je=m.views;x!==null&&(e.setRenderTargetFramebuffer(C,x.framebuffer),e.setRenderTarget(C));let nt=!1;je.length!==P.cameras.length&&(P.cameras.length=0,nt=!0);for(let Pt=0;Pt<je.length;Pt++){const mn=je[Pt];let An=null;if(x!==null)An=x.getViewport(mn);else{const ne=y.getViewSubImage(v,mn);An=ne.viewport,Pt===0&&(e.setRenderTargetTextures(C,ne.colorTexture,ne.depthStencilTexture),e.setRenderTarget(C))}let $t=I[Pt];$t===void 0&&($t=new us,$t.layers.enable(Pt),$t.viewport=new Ot,I[Pt]=$t),$t.matrix.fromArray(mn.transform.matrix),$t.matrix.decompose($t.position,$t.quaternion,$t.scale),$t.projectionMatrix.fromArray(mn.projectionMatrix),$t.projectionMatrixInverse.copy($t.projectionMatrix).invert(),$t.viewport.set(An.x,An.y,An.width,An.height),Pt===0&&(P.matrix.copy($t.matrix),P.matrix.decompose(P.position,P.quaternion,P.scale)),nt===!0&&P.cameras.push($t)}const lt=i.enabledFeatures;if(lt&&lt.includes("depth-sensing")&&i.depthUsage=="gpu-optimized"&&y){const Pt=y.getDepthInformation(je[0]);Pt&&Pt.isValid&&Pt.texture&&A.init(e,Pt,i.renderState)}}for(let je=0;je<w.length;je++){const nt=D[je],lt=w[je];nt!==null&&lt!==void 0&&lt.update(nt,De,d||a)}re&&re(oe,De),De.detectedPlanes&&n.dispatchEvent({type:"planesdetected",data:De}),S=null}const Fe=new qP;Fe.setAnimationLoop(we),this.setAnimationLoop=function(oe){re=oe},this.dispose=function(){}}}const Rd=new _a,KZ=new Mt;function QZ(r,e){function t(E,M){E.matrixAutoUpdate===!0&&E.updateMatrix(),M.value.copy(E.matrix)}function n(E,M){M.color.getRGB(E.fogColor.value,TU(r)),M.isFog?(E.fogNear.value=M.near,E.fogFar.value=M.far):M.isFogExp2&&(E.fogDensity.value=M.density)}function i(E,M,C,w,D){M.isMeshBasicMaterial||M.isMeshLambertMaterial?s(E,M):M.isMeshToonMaterial?(s(E,M),y(E,M)):M.isMeshPhongMaterial?(s(E,M),m(E,M)):M.isMeshStandardMaterial?(s(E,M),v(E,M),M.isMeshPhysicalMaterial&&x(E,M,D)):M.isMeshMatcapMaterial?(s(E,M),S(E,M)):M.isMeshDepthMaterial?s(E,M):M.isMeshDistanceMaterial?(s(E,M),A(E,M)):M.isMeshNormalMaterial?s(E,M):M.isLineBasicMaterial?(a(E,M),M.isLineDashedMaterial&&l(E,M)):M.isPointsMaterial?c(E,M,C,w):M.isSpriteMaterial?d(E,M):M.isShadowMaterial?(E.color.value.copy(M.color),E.opacity.value=M.opacity):M.isShaderMaterial&&(M.uniformsNeedUpdate=!1)}function s(E,M){E.opacity.value=M.opacity,M.color&&E.diffuse.value.copy(M.color),M.emissive&&E.emissive.value.copy(M.emissive).multiplyScalar(M.emissiveIntensity),M.map&&(E.map.value=M.map,t(M.map,E.mapTransform)),M.alphaMap&&(E.alphaMap.value=M.alphaMap,t(M.alphaMap,E.alphaMapTransform)),M.bumpMap&&(E.bumpMap.value=M.bumpMap,t(M.bumpMap,E.bumpMapTransform),E.bumpScale.value=M.bumpScale,M.side===Ti&&(E.bumpScale.value*=-1)),M.normalMap&&(E.normalMap.value=M.normalMap,t(M.normalMap,E.normalMapTransform),E.normalScale.value.copy(M.normalScale),M.side===Ti&&E.normalScale.value.negate()),M.displacementMap&&(E.displacementMap.value=M.displacementMap,t(M.displacementMap,E.displacementMapTransform),E.displacementScale.value=M.displacementScale,E.displacementBias.value=M.displacementBias),M.emissiveMap&&(E.emissiveMap.value=M.emissiveMap,t(M.emissiveMap,E.emissiveMapTransform)),M.specularMap&&(E.specularMap.value=M.specularMap,t(M.specularMap,E.specularMapTransform)),M.alphaTest>0&&(E.alphaTest.value=M.alphaTest);const C=e.get(M),w=C.envMap,D=C.envMapRotation;w&&(E.envMap.value=w,Rd.copy(D),Rd.x*=-1,Rd.y*=-1,Rd.z*=-1,w.isCubeTexture&&w.isRenderTargetTexture===!1&&(Rd.y*=-1,Rd.z*=-1),E.envMapRotation.value.setFromMatrix4(KZ.makeRotationFromEuler(Rd)),E.flipEnvMap.value=w.isCubeTexture&&w.isRenderTargetTexture===!1?-1:1,E.reflectivity.value=M.reflectivity,E.ior.value=M.ior,E.refractionRatio.value=M.refractionRatio),M.lightMap&&(E.lightMap.value=M.lightMap,E.lightMapIntensity.value=M.lightMapIntensity,t(M.lightMap,E.lightMapTransform)),M.aoMap&&(E.aoMap.value=M.aoMap,E.aoMapIntensity.value=M.aoMapIntensity,t(M.aoMap,E.aoMapTransform))}function a(E,M){E.diffuse.value.copy(M.color),E.opacity.value=M.opacity,M.map&&(E.map.value=M.map,t(M.map,E.mapTransform))}function l(E,M){E.dashSize.value=M.dashSize,E.totalSize.value=M.dashSize+M.gapSize,E.scale.value=M.scale}function c(E,M,C,w){E.diffuse.value.copy(M.color),E.opacity.value=M.opacity,E.size.value=M.size*C,E.scale.value=w*.5,M.map&&(E.map.value=M.map,t(M.map,E.uvTransform)),M.alphaMap&&(E.alphaMap.value=M.alphaMap,t(M.alphaMap,E.alphaMapTransform)),M.alphaTest>0&&(E.alphaTest.value=M.alphaTest)}function d(E,M){E.diffuse.value.copy(M.color),E.opacity.value=M.opacity,E.rotation.value=M.rotation,M.map&&(E.map.value=M.map,t(M.map,E.mapTransform)),M.alphaMap&&(E.alphaMap.value=M.alphaMap,t(M.alphaMap,E.alphaMapTransform)),M.alphaTest>0&&(E.alphaTest.value=M.alphaTest)}function m(E,M){E.specular.value.copy(M.specular),E.shininess.value=Math.max(M.shininess,1e-4)}function y(E,M){M.gradientMap&&(E.gradientMap.value=M.gradientMap)}function v(E,M){E.metalness.value=M.metalness,M.metalnessMap&&(E.metalnessMap.value=M.metalnessMap,t(M.metalnessMap,E.metalnessMapTransform)),E.roughness.value=M.roughness,M.roughnessMap&&(E.roughnessMap.value=M.roughnessMap,t(M.roughnessMap,E.roughnessMapTransform)),M.envMap&&(E.envMapIntensity.value=M.envMapIntensity)}function x(E,M,C){E.ior.value=M.ior,M.sheen>0&&(E.sheenColor.value.copy(M.sheenColor).multiplyScalar(M.sheen),E.sheenRoughness.value=M.sheenRoughness,M.sheenColorMap&&(E.sheenColorMap.value=M.sheenColorMap,t(M.sheenColorMap,E.sheenColorMapTransform)),M.sheenRoughnessMap&&(E.sheenRoughnessMap.value=M.sheenRoughnessMap,t(M.sheenRoughnessMap,E.sheenRoughnessMapTransform))),M.clearcoat>0&&(E.clearcoat.value=M.clearcoat,E.clearcoatRoughness.value=M.clearcoatRoughness,M.clearcoatMap&&(E.clearcoatMap.value=M.clearcoatMap,t(M.clearcoatMap,E.clearcoatMapTransform)),M.clearcoatRoughnessMap&&(E.clearcoatRoughnessMap.value=M.clearcoatRoughnessMap,t(M.clearcoatRoughnessMap,E.clearcoatRoughnessMapTransform)),M.clearcoatNormalMap&&(E.clearcoatNormalMap.value=M.clearcoatNormalMap,t(M.clearcoatNormalMap,E.clearcoatNormalMapTransform),E.clearcoatNormalScale.value.copy(M.clearcoatNormalScale),M.side===Ti&&E.clearcoatNormalScale.value.negate())),M.dispersion>0&&(E.dispersion.value=M.dispersion),M.iridescence>0&&(E.iridescence.value=M.iridescence,E.iridescenceIOR.value=M.iridescenceIOR,E.iridescenceThicknessMinimum.value=M.iridescenceThicknessRange[0],E.iridescenceThicknessMaximum.value=M.iridescenceThicknessRange[1],M.iridescenceMap&&(E.iridescenceMap.value=M.iridescenceMap,t(M.iridescenceMap,E.iridescenceMapTransform)),M.iridescenceThicknessMap&&(E.iridescenceThicknessMap.value=M.iridescenceThicknessMap,t(M.iridescenceThicknessMap,E.iridescenceThicknessMapTransform))),M.transmission>0&&(E.transmission.value=M.transmission,E.transmissionSamplerMap.value=C.texture,E.transmissionSamplerSize.value.set(C.width,C.height),M.transmissionMap&&(E.transmissionMap.value=M.transmissionMap,t(M.transmissionMap,E.transmissionMapTransform)),E.thickness.value=M.thickness,M.thicknessMap&&(E.thicknessMap.value=M.thicknessMap,t(M.thicknessMap,E.thicknessMapTransform)),E.attenuationDistance.value=M.attenuationDistance,E.attenuationColor.value.copy(M.attenuationColor)),M.anisotropy>0&&(E.anisotropyVector.value.set(M.anisotropy*Math.cos(M.anisotropyRotation),M.anisotropy*Math.sin(M.anisotropyRotation)),M.anisotropyMap&&(E.anisotropyMap.value=M.anisotropyMap,t(M.anisotropyMap,E.anisotropyMapTransform))),E.specularIntensity.value=M.specularIntensity,E.specularColor.value.copy(M.specularColor),M.specularColorMap&&(E.specularColorMap.value=M.specularColorMap,t(M.specularColorMap,E.specularColorMapTransform)),M.specularIntensityMap&&(E.specularIntensityMap.value=M.specularIntensityMap,t(M.specularIntensityMap,E.specularIntensityMapTransform))}function S(E,M){M.matcap&&(E.matcap.value=M.matcap)}function A(E,M){const C=e.get(M).light;E.referencePosition.value.setFromMatrixPosition(C.matrixWorld),E.nearDistance.value=C.shadow.camera.near,E.farDistance.value=C.shadow.camera.far}return{refreshFogUniforms:n,refreshMaterialUniforms:i}}function JZ(r,e,t,n){let i={},s={},a=[];const l=r.getParameter(r.MAX_UNIFORM_BUFFER_BINDINGS);function c(C,w){const D=w.program;n.uniformBlockBinding(C,D)}function d(C,w){let D=i[C.id];D===void 0&&(S(C),D=m(C),i[C.id]=D,C.addEventListener("dispose",E));const z=w.program;n.updateUBOMapping(C,z);const B=e.render.frame;s[C.id]!==B&&(v(C),s[C.id]=B)}function m(C){const w=y();C.__bindingPointIndex=w;const D=r.createBuffer(),z=C.__size,B=C.usage;return r.bindBuffer(r.UNIFORM_BUFFER,D),r.bufferData(r.UNIFORM_BUFFER,z,B),r.bindBuffer(r.UNIFORM_BUFFER,null),r.bindBufferBase(r.UNIFORM_BUFFER,w,D),D}function y(){for(let C=0;C<l;C++)if(a.indexOf(C)===-1)return a.push(C),C;return console.error("THREE.WebGLRenderer: Maximum number of simultaneously usable uniforms groups reached."),0}function v(C){const w=i[C.id],D=C.uniforms,z=C.__cache;r.bindBuffer(r.UNIFORM_BUFFER,w);for(let B=0,F=D.length;B<F;B++){const H=Array.isArray(D[B])?D[B]:[D[B]];for(let I=0,P=H.length;I<P;I++){const Z=H[I];if(x(Z,B,I,z)===!0){const ue=Z.__offset,se=Array.isArray(Z.value)?Z.value:[Z.value];let pe=0;for(let Se=0;Se<se.length;Se++){const V=se[Se],Q=A(V);typeof V=="number"||typeof V=="boolean"?(Z.__data[0]=V,r.bufferSubData(r.UNIFORM_BUFFER,ue+pe,Z.__data)):V.isMatrix3?(Z.__data[0]=V.elements[0],Z.__data[1]=V.elements[1],Z.__data[2]=V.elements[2],Z.__data[3]=0,Z.__data[4]=V.elements[3],Z.__data[5]=V.elements[4],Z.__data[6]=V.elements[5],Z.__data[7]=0,Z.__data[8]=V.elements[6],Z.__data[9]=V.elements[7],Z.__data[10]=V.elements[8],Z.__data[11]=0):(V.toArray(Z.__data,pe),pe+=Q.storage/Float32Array.BYTES_PER_ELEMENT)}r.bufferSubData(r.UNIFORM_BUFFER,ue,Z.__data)}}}r.bindBuffer(r.UNIFORM_BUFFER,null)}function x(C,w,D,z){const B=C.value,F=w+"_"+D;if(z[F]===void 0)return typeof B=="number"||typeof B=="boolean"?z[F]=B:z[F]=B.clone(),!0;{const H=z[F];if(typeof B=="number"||typeof B=="boolean"){if(H!==B)return z[F]=B,!0}else if(H.equals(B)===!1)return H.copy(B),!0}return!1}function S(C){const w=C.uniforms;let D=0;const z=16;for(let F=0,H=w.length;F<H;F++){const I=Array.isArray(w[F])?w[F]:[w[F]];for(let P=0,Z=I.length;P<Z;P++){const ue=I[P],se=Array.isArray(ue.value)?ue.value:[ue.value];for(let pe=0,Se=se.length;pe<Se;pe++){const V=se[pe],Q=A(V),J=D%z,ve=J%Q.boundary,X=J+ve;D+=ve,X!==0&&z-X<Q.storage&&(D+=z-X),ue.__data=new Float32Array(Q.storage/Float32Array.BYTES_PER_ELEMENT),ue.__offset=D,D+=Q.storage}}}const B=D%z;return B>0&&(D+=z-B),C.__size=D,C.__cache={},this}function A(C){const w={boundary:0,storage:0};return typeof C=="number"||typeof C=="boolean"?(w.boundary=4,w.storage=4):C.isVector2?(w.boundary=8,w.storage=8):C.isVector3||C.isColor?(w.boundary=16,w.storage=12):C.isVector4?(w.boundary=16,w.storage=16):C.isMatrix3?(w.boundary=48,w.storage=48):C.isMatrix4?(w.boundary=64,w.storage=64):C.isTexture?console.warn("THREE.WebGLRenderer: Texture samplers can not be part of an uniforms group."):console.warn("THREE.WebGLRenderer: Unsupported uniform value type.",C),w}function E(C){const w=C.target;w.removeEventListener("dispose",E);const D=a.indexOf(w.__bindingPointIndex);a.splice(D,1),r.deleteBuffer(i[w.id]),delete i[w.id],delete s[w.id]}function M(){for(const C in i)r.deleteBuffer(i[C]);a=[],i={},s={}}return{bind:c,update:d,dispose:M}}class KP{constructor(e={}){const{canvas:t=F1(),context:n=null,depth:i=!0,stencil:s=!1,alpha:a=!1,antialias:l=!1,premultipliedAlpha:c=!0,preserveDrawingBuffer:d=!1,powerPreference:m="default",failIfMajorPerformanceCaveat:y=!1,reverseDepthBuffer:v=!1}=e;this.isWebGLRenderer=!0;let x;if(n!==null){if(typeof WebGLRenderingContext<"u"&&n instanceof WebGLRenderingContext)throw new Error("THREE.WebGLRenderer: WebGL 1 is not supported since r163.");x=n.getContextAttributes().alpha}else x=a;const S=new Uint32Array(4),A=new Int32Array(4);let E=null,M=null;const C=[],w=[];this.domElement=t,this.debug={checkShaderErrors:!0,onShaderError:null},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.toneMapping=Gr,this.toneMappingExposure=1,this.transmissionResolutionScale=1;const D=this;let z=!1;this._outputColorSpace=wt;let B=0,F=0,H=null,I=-1,P=null;const Z=new Ot,ue=new Ot;let se=null;const pe=new ft(0);let Se=0,V=t.width,Q=t.height,J=1,ve=null,X=null;const re=new Ot(0,0,V,Q),we=new Ot(0,0,V,Q);let Fe=!1;const oe=new ty;let De=!1,je=!1;const nt=new Mt,lt=new Mt,nn=new Y,Pt=new Ot,mn={background:null,fog:null,environment:null,overrideMaterial:null,isScene:!0};let An=!1;function $t(){return H===null?J:1}let ne=n;function oi(q,he){return t.getContext(q,he)}try{const q={alpha:!0,depth:i,stencil:s,antialias:l,premultipliedAlpha:c,preserveDrawingBuffer:d,powerPreference:m,failIfMajorPerformanceCaveat:y};if("setAttribute"in t&&t.setAttribute("data-engine",`three.js r${Zg}`),t.addEventListener("webglcontextlost",Ke,!1),t.addEventListener("webglcontextrestored",yt,!1),t.addEventListener("webglcontextcreationerror",gt,!1),ne===null){const he="webgl2";if(ne=oi(he,q),ne===null)throw oi(he)?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.")}}catch(q){throw console.error("THREE.WebGLRenderer: "+q.message),q}let Ze,Ge,He,at,Ie,j,G,de,Le,ke,Be,ct,it,ot,xn,et,St,Rt,Nt,ht,dn,kt,zn,fe;function mt(){Ze=new cj(ne),Ze.init(),kt=new ZP(ne,Ze),Ge=new ij(ne,Ze,e,kt),He=new qZ(ne,Ze),Ge.reverseDepthBuffer&&v&&He.buffers.depth.setReversed(!0),at=new dj(ne),Ie=new DZ,j=new WZ(ne,Ze,He,Ie,Ge,kt,at),G=new rj(D),de=new uj(D),Le=new _W(ne),zn=new tj(ne,Le),ke=new hj(ne,Le,at,zn),Be=new mj(ne,ke,Le,at),Nt=new pj(ne,Ge,j),et=new sj(Ie),ct=new wZ(D,G,de,Ze,Ge,zn,et),it=new QZ(D,Ie),ot=new LZ,xn=new zZ(Ze),Rt=new ej(D,G,de,He,Be,x,c),St=new HZ(D,Be,Ge),fe=new JZ(ne,at,Ge,He),ht=new nj(ne,Ze,at),dn=new fj(ne,Ze,at),at.programs=ct.programs,D.capabilities=Ge,D.extensions=Ze,D.properties=Ie,D.renderLists=ot,D.shadowMap=St,D.state=He,D.info=at}mt();const Ue=new ZZ(D,ne);this.xr=Ue,this.getContext=function(){return ne},this.getContextAttributes=function(){return ne.getContextAttributes()},this.forceContextLoss=function(){const q=Ze.get("WEBGL_lose_context");q&&q.loseContext()},this.forceContextRestore=function(){const q=Ze.get("WEBGL_lose_context");q&&q.restoreContext()},this.getPixelRatio=function(){return J},this.setPixelRatio=function(q){q!==void 0&&(J=q,this.setSize(V,Q,!1))},this.getSize=function(q){return q.set(V,Q)},this.setSize=function(q,he,Ae=!0){if(Ue.isPresenting){console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting.");return}V=q,Q=he,t.width=Math.floor(q*J),t.height=Math.floor(he*J),Ae===!0&&(t.style.width=q+"px",t.style.height=he+"px"),this.setViewport(0,0,q,he)},this.getDrawingBufferSize=function(q){return q.set(V*J,Q*J).floor()},this.setDrawingBufferSize=function(q,he,Ae){V=q,Q=he,J=Ae,t.width=Math.floor(q*Ae),t.height=Math.floor(he*Ae),this.setViewport(0,0,q,he)},this.getCurrentViewport=function(q){return q.copy(Z)},this.getViewport=function(q){return q.copy(re)},this.setViewport=function(q,he,Ae,Re){q.isVector4?re.set(q.x,q.y,q.z,q.w):re.set(q,he,Ae,Re),He.viewport(Z.copy(re).multiplyScalar(J).round())},this.getScissor=function(q){return q.copy(we)},this.setScissor=function(q,he,Ae,Re){q.isVector4?we.set(q.x,q.y,q.z,q.w):we.set(q,he,Ae,Re),He.scissor(ue.copy(we).multiplyScalar(J).round())},this.getScissorTest=function(){return Fe},this.setScissorTest=function(q){He.setScissorTest(Fe=q)},this.setOpaqueSort=function(q){ve=q},this.setTransparentSort=function(q){X=q},this.getClearColor=function(q){return q.copy(Rt.getClearColor())},this.setClearColor=function(){Rt.setClearColor(...arguments)},this.getClearAlpha=function(){return Rt.getClearAlpha()},this.setClearAlpha=function(){Rt.setClearAlpha(...arguments)},this.clear=function(q=!0,he=!0,Ae=!0){let Re=0;if(q){let ye=!1;if(H!==null){const $e=H.texture.format;ye=$e===vp||$e===yp||$e===ff}if(ye){const $e=H.texture.type,ut=$e===Xi||$e===di||$e===jo||$e===Ha||$e===G_||$e===H_,dt=Rt.getClearColor(),bt=Rt.getClearAlpha(),Wt=dt.r,It=dt.g,Ut=dt.b;ut?(S[0]=Wt,S[1]=It,S[2]=Ut,S[3]=bt,ne.clearBufferuiv(ne.COLOR,0,S)):(A[0]=Wt,A[1]=It,A[2]=Ut,A[3]=bt,ne.clearBufferiv(ne.COLOR,0,A))}else Re|=ne.COLOR_BUFFER_BIT}he&&(Re|=ne.DEPTH_BUFFER_BIT),Ae&&(Re|=ne.STENCIL_BUFFER_BIT,this.state.buffers.stencil.setMask(4294967295)),ne.clear(Re)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",Ke,!1),t.removeEventListener("webglcontextrestored",yt,!1),t.removeEventListener("webglcontextcreationerror",gt,!1),Rt.dispose(),ot.dispose(),xn.dispose(),Ie.dispose(),G.dispose(),de.dispose(),Be.dispose(),zn.dispose(),fe.dispose(),ct.dispose(),Ue.dispose(),Ue.removeEventListener("sessionstart",ts),Ue.removeEventListener("sessionend",ps),Qs.stop()};function Ke(q){q.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),z=!0}function yt(){console.log("THREE.WebGLRenderer: Context Restored."),z=!1;const q=at.autoReset,he=St.enabled,Ae=St.autoUpdate,Re=St.needsUpdate,ye=St.type;mt(),at.autoReset=q,St.enabled=he,St.autoUpdate=Ae,St.needsUpdate=Re,St.type=ye}function gt(q){console.error("THREE.WebGLRenderer: A WebGL context could not be created. Reason: ",q.statusMessage)}function Jt(q){const he=q.target;he.removeEventListener("dispose",Jt),Qn(he)}function Qn(q){Ci(q),Ie.remove(q)}function Ci(q){const he=Ie.get(q).programs;he!==void 0&&(he.forEach(function(Ae){ct.releaseProgram(Ae)}),q.isShaderMaterial&&ct.releaseShaderCache(q))}this.renderBufferDirect=function(q,he,Ae,Re,ye,$e){he===null&&(he=mn);const ut=ye.isMesh&&ye.matrixWorld.determinant()<0,dt=Xl(q,he,Ae,Re,ye);He.setMaterial(Re,ut);let bt=Ae.index,Wt=1;if(Re.wireframe===!0){if(bt=ke.getWireframeAttribute(Ae),bt===void 0)return;Wt=2}const It=Ae.drawRange,Ut=Ae.attributes.position;let Sn=It.start*Wt,Pn=(It.start+It.count)*Wt;$e!==null&&(Sn=Math.max(Sn,$e.start*Wt),Pn=Math.min(Pn,($e.start+$e.count)*Wt)),bt!==null?(Sn=Math.max(Sn,0),Pn=Math.min(Pn,bt.count)):Ut!=null&&(Sn=Math.max(Sn,0),Pn=Math.min(Pn,Ut.count));const wi=Pn-Sn;if(wi<0||wi===1/0)return;zn.setup(ye,Re,dt,Ae,bt);let Tn,Rn=ht;if(bt!==null&&(Tn=Le.get(bt),Rn=dn,Rn.setIndex(Tn)),ye.isMesh)Re.wireframe===!0?(He.setLineWidth(Re.wireframeLinewidth*$t()),Rn.setMode(ne.LINES)):Rn.setMode(ne.TRIANGLES);else if(ye.isLine){let zt=Re.linewidth;zt===void 0&&(zt=1),He.setLineWidth(zt*$t()),ye.isLineSegments?Rn.setMode(ne.LINES):ye.isLineLoop?Rn.setMode(ne.LINE_LOOP):Rn.setMode(ne.LINE_STRIP)}else ye.isPoints?Rn.setMode(ne.POINTS):ye.isSprite&&Rn.setMode(ne.TRIANGLES);if(ye.isBatchedMesh)if(ye._multiDrawInstances!==null)Il("THREE.WebGLRenderer: renderMultiDrawInstances has been deprecated and will be removed in r184. Append to renderMultiDraw arguments and use indirection."),Rn.renderMultiDrawInstances(ye._multiDrawStarts,ye._multiDrawCounts,ye._multiDrawCount,ye._multiDrawInstances);else if(Ze.get("WEBGL_multi_draw"))Rn.renderMultiDraw(ye._multiDrawStarts,ye._multiDrawCounts,ye._multiDrawCount);else{const zt=ye._multiDrawStarts,Bi=ye._multiDrawCounts,Ln=ye._multiDrawCount,Os=bt?Le.get(bt).bytesPerElement:1,To=Ie.get(Re).currentProgram.getUniforms();for(let li=0;li<Ln;li++)To.setValue(ne,"_gl_DrawID",li),Rn.render(zt[li]/Os,Bi[li])}else if(ye.isInstancedMesh)Rn.renderInstances(Sn,wi,ye.count);else if(Ae.isInstancedBufferGeometry){const zt=Ae._maxInstanceCount!==void 0?Ae._maxInstanceCount:1/0,Bi=Math.min(Ae.instanceCount,zt);Rn.renderInstances(Sn,wi,Bi)}else Rn.render(Sn,wi)};function Dn(q,he,Ae){q.transparent===!0&&q.side===Fr&&q.forceSinglePass===!1?(q.side=Ti,q.needsUpdate=!0,ii(q,he,Ae),q.side=pa,q.needsUpdate=!0,ii(q,he,Ae),q.side=Fr):ii(q,he,Ae)}this.compile=function(q,he,Ae=null){Ae===null&&(Ae=q),M=xn.get(Ae),M.init(he),w.push(M),Ae.traverseVisible(function(ye){ye.isLight&&ye.layers.test(he.layers)&&(M.pushLight(ye),ye.castShadow&&M.pushShadow(ye))}),q!==Ae&&q.traverseVisible(function(ye){ye.isLight&&ye.layers.test(he.layers)&&(M.pushLight(ye),ye.castShadow&&M.pushShadow(ye))}),M.setupLights();const Re=new Set;return q.traverse(function(ye){if(!(ye.isMesh||ye.isPoints||ye.isLine||ye.isSprite))return;const $e=ye.material;if($e)if(Array.isArray($e))for(let ut=0;ut<$e.length;ut++){const dt=$e[ut];Dn(dt,Ae,ye),Re.add(dt)}else Dn($e,Ae,ye),Re.add($e)}),M=w.pop(),Re},this.compileAsync=function(q,he,Ae=null){const Re=this.compile(q,he,Ae);return new Promise(ye=>{function $e(){if(Re.forEach(function(ut){Ie.get(ut).currentProgram.isReady()&&Re.delete(ut)}),Re.size===0){ye(q);return}setTimeout($e,10)}Ze.get("KHR_parallel_shader_compile")!==null?$e():setTimeout($e,10)})};let Mr=null;function ds(q){Mr&&Mr(q)}function ts(){Qs.stop()}function ps(){Qs.start()}const Qs=new qP;Qs.setAnimationLoop(ds),typeof self<"u"&&Qs.setContext(self),this.setAnimationLoop=function(q){Mr=q,Ue.setAnimationLoop(q),q===null?Qs.stop():Qs.start()},Ue.addEventListener("sessionstart",ts),Ue.addEventListener("sessionend",ps),this.render=function(q,he){if(he!==void 0&&he.isCamera!==!0){console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.");return}if(z===!0)return;if(q.matrixWorldAutoUpdate===!0&&q.updateMatrixWorld(),he.parent===null&&he.matrixWorldAutoUpdate===!0&&he.updateMatrixWorld(),Ue.enabled===!0&&Ue.isPresenting===!0&&(Ue.cameraAutoUpdate===!0&&Ue.updateCamera(he),he=Ue.getCamera()),q.isScene===!0&&q.onBeforeRender(D,q,he,H),M=xn.get(q,w.length),M.init(he),w.push(M),lt.multiplyMatrices(he.projectionMatrix,he.matrixWorldInverse),oe.setFromProjectionMatrix(lt),je=this.localClippingEnabled,De=et.init(this.clippingPlanes,je),E=ot.get(q,C.length),E.init(),C.push(E),Ue.enabled===!0&&Ue.isPresenting===!0){const $e=D.xr.getDepthSensingMesh();$e!==null&&Er($e,he,-1/0,D.sortObjects)}Er(q,he,0,D.sortObjects),E.finish(),D.sortObjects===!0&&E.sort(ve,X),An=Ue.enabled===!1||Ue.isPresenting===!1||Ue.hasDepthSensing()===!1,An&&Rt.addToRenderList(E,q),this.info.render.frame++,De===!0&&et.beginShadows();const Ae=M.state.shadowsArray;St.render(Ae,q,he),De===!0&&et.endShadows(),this.info.autoReset===!0&&this.info.reset();const Re=E.opaque,ye=E.transmissive;if(M.setupLights(),he.isArrayCamera){const $e=he.cameras;if(ye.length>0)for(let ut=0,dt=$e.length;ut<dt;ut++){const bt=$e[ut];Ka(Re,ye,q,bt)}An&&Rt.render(q);for(let ut=0,dt=$e.length;ut<dt;ut++){const bt=$e[ut];vf(E,q,bt,bt.viewport)}}else ye.length>0&&Ka(Re,ye,q,he),An&&Rt.render(q),vf(E,q,he);H!==null&&F===0&&(j.updateMultisampleRenderTarget(H),j.updateRenderTargetMipmap(H)),q.isScene===!0&&q.onAfterRender(D,q,he),zn.resetDefaultState(),I=-1,P=null,w.pop(),w.length>0?(M=w[w.length-1],De===!0&&et.setGlobalState(D.clippingPlanes,M.state.camera)):M=null,C.pop(),C.length>0?E=C[C.length-1]:E=null};function Er(q,he,Ae,Re){if(q.visible===!1)return;if(q.layers.test(he.layers)){if(q.isGroup)Ae=q.renderOrder;else if(q.isLOD)q.autoUpdate===!0&&q.update(he);else if(q.isLight)M.pushLight(q),q.castShadow&&M.pushShadow(q);else if(q.isSprite){if(!q.frustumCulled||oe.intersectsSprite(q)){Re&&Pt.setFromMatrixPosition(q.matrixWorld).applyMatrix4(lt);const ut=Be.update(q),dt=q.material;dt.visible&&E.push(q,ut,dt,Ae,Pt.z,null)}}else if((q.isMesh||q.isLine||q.isPoints)&&(!q.frustumCulled||oe.intersectsObject(q))){const ut=Be.update(q),dt=q.material;if(Re&&(q.boundingSphere!==void 0?(q.boundingSphere===null&&q.computeBoundingSphere(),Pt.copy(q.boundingSphere.center)):(ut.boundingSphere===null&&ut.computeBoundingSphere(),Pt.copy(ut.boundingSphere.center)),Pt.applyMatrix4(q.matrixWorld).applyMatrix4(lt)),Array.isArray(dt)){const bt=ut.groups;for(let Wt=0,It=bt.length;Wt<It;Wt++){const Ut=bt[Wt],Sn=dt[Ut.materialIndex];Sn&&Sn.visible&&E.push(q,ut,Sn,Ae,Pt.z,Ut)}}else dt.visible&&E.push(q,ut,dt,Ae,Pt.z,null)}}const $e=q.children;for(let ut=0,dt=$e.length;ut<dt;ut++)Er($e[ut],he,Ae,Re)}function vf(q,he,Ae,Re){const ye=q.opaque,$e=q.transmissive,ut=q.transparent;M.setupLightsView(Ae),De===!0&&et.setGlobalState(D.clippingPlanes,Ae),Re&&He.viewport(Z.copy(Re)),ye.length>0&&or(ye,he,Ae),$e.length>0&&or($e,he,Ae),ut.length>0&&or(ut,he,Ae),He.buffers.depth.setTest(!0),He.buffers.depth.setMask(!0),He.buffers.color.setMask(!0),He.setPolygonOffset(!1)}function Ka(q,he,Ae,Re){if((Ae.isScene===!0?Ae.overrideMaterial:null)!==null)return;M.state.transmissionRenderTarget[Re.id]===void 0&&(M.state.transmissionRenderTarget[Re.id]=new Gl(1,1,{generateMipmaps:!0,type:Ze.has("EXT_color_buffer_half_float")||Ze.has("EXT_color_buffer_float")?Ys:Xi,minFilter:xr,samples:4,stencilBuffer:s,resolveDepthBuffer:!1,resolveStencilBuffer:!1,colorSpace:on.workingColorSpace}));const $e=M.state.transmissionRenderTarget[Re.id],ut=Re.viewport||Z;$e.setSize(ut.z*D.transmissionResolutionScale,ut.w*D.transmissionResolutionScale);const dt=D.getRenderTarget();D.setRenderTarget($e),D.getClearColor(pe),Se=D.getClearAlpha(),Se<1&&D.setClearColor(16777215,.5),D.clear(),An&&Rt.render(Ae);const bt=D.toneMapping;D.toneMapping=Gr;const Wt=Re.viewport;if(Re.viewport!==void 0&&(Re.viewport=void 0),M.setupLightsView(Re),De===!0&&et.setGlobalState(D.clippingPlanes,Re),or(q,Ae,Re),j.updateMultisampleRenderTarget($e),j.updateRenderTargetMipmap($e),Ze.has("WEBGL_multisampled_render_to_texture")===!1){let It=!1;for(let Ut=0,Sn=he.length;Ut<Sn;Ut++){const Pn=he[Ut],wi=Pn.object,Tn=Pn.geometry,Rn=Pn.material,zt=Pn.group;if(Rn.side===Fr&&wi.layers.test(Re.layers)){const Bi=Rn.side;Rn.side=Ti,Rn.needsUpdate=!0,Qa(wi,Ae,Re,Tn,Rn,zt),Rn.side=Bi,Rn.needsUpdate=!0,It=!0}}It===!0&&(j.updateMultisampleRenderTarget($e),j.updateRenderTargetMipmap($e))}D.setRenderTarget(dt),D.setClearColor(pe,Se),Wt!==void 0&&(Re.viewport=Wt),D.toneMapping=bt}function or(q,he,Ae){const Re=he.isScene===!0?he.overrideMaterial:null;for(let ye=0,$e=q.length;ye<$e;ye++){const ut=q[ye],dt=ut.object,bt=ut.geometry,Wt=ut.group;let It=ut.material;It.allowOverride===!0&&Re!==null&&(It=Re),dt.layers.test(Ae.layers)&&Qa(dt,he,Ae,bt,It,Wt)}}function Qa(q,he,Ae,Re,ye,$e){q.onBeforeRender(D,he,Ae,Re,ye,$e),q.modelViewMatrix.multiplyMatrices(Ae.matrixWorldInverse,q.matrixWorld),q.normalMatrix.getNormalMatrix(q.modelViewMatrix),ye.onBeforeRender(D,he,Ae,Re,q,$e),ye.transparent===!0&&ye.side===Fr&&ye.forceSinglePass===!1?(ye.side=Ti,ye.needsUpdate=!0,D.renderBufferDirect(Ae,he,Re,ye,q,$e),ye.side=pa,ye.needsUpdate=!0,D.renderBufferDirect(Ae,he,Re,ye,q,$e),ye.side=Fr):D.renderBufferDirect(Ae,he,Re,ye,q,$e),q.onAfterRender(D,he,Ae,Re,ye,$e)}function ii(q,he,Ae){he.isScene!==!0&&(he=mn);const Re=Ie.get(q),ye=M.state.lights,$e=M.state.shadowsArray,ut=ye.state.version,dt=ct.getParameters(q,ye.state,$e,he,Ae),bt=ct.getProgramCacheKey(dt);let Wt=Re.programs;Re.environment=q.isMeshStandardMaterial?he.environment:null,Re.fog=he.fog,Re.envMap=(q.isMeshStandardMaterial?de:G).get(q.envMap||Re.environment),Re.envMapRotation=Re.environment!==null&&q.envMap===null?he.environmentRotation:q.envMapRotation,Wt===void 0&&(q.addEventListener("dispose",Jt),Wt=new Map,Re.programs=Wt);let It=Wt.get(bt);if(It!==void 0){if(Re.currentProgram===It&&Re.lightsStateVersion===ut)return $a(q,dt),It}else dt.uniforms=ct.getUniforms(q),q.onBeforeCompile(dt,D),It=ct.acquireProgram(dt,bt),Wt.set(bt,It),Re.uniforms=dt.uniforms;const Ut=Re.uniforms;return(!q.isShaderMaterial&&!q.isRawShaderMaterial||q.clipping===!0)&&(Ut.clippingPlanes=et.uniform),$a(q,dt),Re.needsLights=ns(q),Re.lightsStateVersion=ut,Re.needsLights&&(Ut.ambientLightColor.value=ye.state.ambient,Ut.lightProbe.value=ye.state.probe,Ut.directionalLights.value=ye.state.directional,Ut.directionalLightShadows.value=ye.state.directionalShadow,Ut.spotLights.value=ye.state.spot,Ut.spotLightShadows.value=ye.state.spotShadow,Ut.rectAreaLights.value=ye.state.rectArea,Ut.ltc_1.value=ye.state.rectAreaLTC1,Ut.ltc_2.value=ye.state.rectAreaLTC2,Ut.pointLights.value=ye.state.point,Ut.pointLightShadows.value=ye.state.pointShadow,Ut.hemisphereLights.value=ye.state.hemi,Ut.directionalShadowMap.value=ye.state.directionalShadowMap,Ut.directionalShadowMatrix.value=ye.state.directionalShadowMatrix,Ut.spotShadowMap.value=ye.state.spotShadowMap,Ut.spotLightMatrix.value=ye.state.spotLightMatrix,Ut.spotLightMap.value=ye.state.spotLightMap,Ut.pointShadowMap.value=ye.state.pointShadowMap,Ut.pointShadowMatrix.value=ye.state.pointShadowMatrix),Re.currentProgram=It,Re.uniformsList=null,It}function Ja(q){if(q.uniformsList===null){const he=q.currentProgram.getUniforms();q.uniformsList=ub.seqWithValue(he.seq,q.uniforms)}return q.uniformsList}function $a(q,he){const Ae=Ie.get(q);Ae.outputColorSpace=he.outputColorSpace,Ae.batching=he.batching,Ae.batchingColor=he.batchingColor,Ae.instancing=he.instancing,Ae.instancingColor=he.instancingColor,Ae.instancingMorph=he.instancingMorph,Ae.skinning=he.skinning,Ae.morphTargets=he.morphTargets,Ae.morphNormals=he.morphNormals,Ae.morphColors=he.morphColors,Ae.morphTargetsCount=he.morphTargetsCount,Ae.numClippingPlanes=he.numClippingPlanes,Ae.numIntersection=he.numClipIntersection,Ae.vertexAlphas=he.vertexAlphas,Ae.vertexTangents=he.vertexTangents,Ae.toneMapping=he.toneMapping}function Xl(q,he,Ae,Re,ye){he.isScene!==!0&&(he=mn),j.resetTextureUnits();const $e=he.fog,ut=Re.isMeshStandardMaterial?he.environment:null,dt=H===null?D.outputColorSpace:H.isXRRenderTarget===!0?H.texture.colorSpace:xo,bt=(Re.isMeshStandardMaterial?de:G).get(Re.envMap||ut),Wt=Re.vertexColors===!0&&!!Ae.attributes.color&&Ae.attributes.color.itemSize===4,It=!!Ae.attributes.tangent&&(!!Re.normalMap||Re.anisotropy>0),Ut=!!Ae.morphAttributes.position,Sn=!!Ae.morphAttributes.normal,Pn=!!Ae.morphAttributes.color;let wi=Gr;Re.toneMapped&&(H===null||H.isXRRenderTarget===!0)&&(wi=D.toneMapping);const Tn=Ae.morphAttributes.position||Ae.morphAttributes.normal||Ae.morphAttributes.color,Rn=Tn!==void 0?Tn.length:0,zt=Ie.get(Re),Bi=M.state.lights;if(De===!0&&(je===!0||q!==P)){const Ms=q===P&&Re.id===I;et.setState(Re,q,Ms)}let Ln=!1;Re.version===zt.__version?(zt.needsLights&&zt.lightsStateVersion!==Bi.state.version||zt.outputColorSpace!==dt||ye.isBatchedMesh&&zt.batching===!1||!ye.isBatchedMesh&&zt.batching===!0||ye.isBatchedMesh&&zt.batchingColor===!0&&ye.colorTexture===null||ye.isBatchedMesh&&zt.batchingColor===!1&&ye.colorTexture!==null||ye.isInstancedMesh&&zt.instancing===!1||!ye.isInstancedMesh&&zt.instancing===!0||ye.isSkinnedMesh&&zt.skinning===!1||!ye.isSkinnedMesh&&zt.skinning===!0||ye.isInstancedMesh&&zt.instancingColor===!0&&ye.instanceColor===null||ye.isInstancedMesh&&zt.instancingColor===!1&&ye.instanceColor!==null||ye.isInstancedMesh&&zt.instancingMorph===!0&&ye.morphTexture===null||ye.isInstancedMesh&&zt.instancingMorph===!1&&ye.morphTexture!==null||zt.envMap!==bt||Re.fog===!0&&zt.fog!==$e||zt.numClippingPlanes!==void 0&&(zt.numClippingPlanes!==et.numPlanes||zt.numIntersection!==et.numIntersection)||zt.vertexAlphas!==Wt||zt.vertexTangents!==It||zt.morphTargets!==Ut||zt.morphNormals!==Sn||zt.morphColors!==Pn||zt.toneMapping!==wi||zt.morphTargetsCount!==Rn)&&(Ln=!0):(Ln=!0,zt.__version=Re.version);let Os=zt.currentProgram;Ln===!0&&(Os=ii(Re,he,ye));let To=!1,li=!1,Mo=!1;const si=Os.getUniforms(),Ps=zt.uniforms;if(He.useProgram(Os.program)&&(To=!0,li=!0,Mo=!0),Re.id!==I&&(I=Re.id,li=!0),To||P!==q){He.buffers.depth.getReversed()?(nt.copy(q.projectionMatrix),$F(nt),ez(nt),si.setValue(ne,"projectionMatrix",nt)):si.setValue(ne,"projectionMatrix",q.projectionMatrix),si.setValue(ne,"viewMatrix",q.matrixWorldInverse);const Es=si.map.cameraPosition;Es!==void 0&&Es.setValue(ne,nn.setFromMatrixPosition(q.matrixWorld)),Ge.logarithmicDepthBuffer&&si.setValue(ne,"logDepthBufFC",2/(Math.log(q.far+1)/Math.LN2)),(Re.isMeshPhongMaterial||Re.isMeshToonMaterial||Re.isMeshLambertMaterial||Re.isMeshBasicMaterial||Re.isMeshStandardMaterial||Re.isShaderMaterial)&&si.setValue(ne,"isOrthographic",q.isOrthographicCamera===!0),P!==q&&(P=q,li=!0,Mo=!0)}if(ye.isSkinnedMesh){si.setOptional(ne,ye,"bindMatrix"),si.setOptional(ne,ye,"bindMatrixInverse");const Ms=ye.skeleton;Ms&&(Ms.boneTexture===null&&Ms.computeBoneTexture(),si.setValue(ne,"boneTexture",Ms.boneTexture,j))}ye.isBatchedMesh&&(si.setOptional(ne,ye,"batchingTexture"),si.setValue(ne,"batchingTexture",ye._matricesTexture,j),si.setOptional(ne,ye,"batchingIdTexture"),si.setValue(ne,"batchingIdTexture",ye._indirectTexture,j),si.setOptional(ne,ye,"batchingColorTexture"),ye._colorsTexture!==null&&si.setValue(ne,"batchingColorTexture",ye._colorsTexture,j));const is=Ae.morphAttributes;if((is.position!==void 0||is.normal!==void 0||is.color!==void 0)&&Nt.update(ye,Ae,Os),(li||zt.receiveShadow!==ye.receiveShadow)&&(zt.receiveShadow=ye.receiveShadow,si.setValue(ne,"receiveShadow",ye.receiveShadow)),Re.isMeshGouraudMaterial&&Re.envMap!==null&&(Ps.envMap.value=bt,Ps.flipEnvMap.value=bt.isCubeTexture&&bt.isRenderTargetTexture===!1?-1:1),Re.isMeshStandardMaterial&&Re.envMap===null&&he.environment!==null&&(Ps.envMapIntensity.value=he.environmentIntensity),li&&(si.setValue(ne,"toneMappingExposure",D.toneMappingExposure),zt.needsLights&&il(Ps,Mo),$e&&Re.fog===!0&&it.refreshFogUniforms(Ps,$e),it.refreshMaterialUniforms(Ps,Re,J,Q,M.state.transmissionRenderTarget[q.id]),ub.upload(ne,Ja(zt),Ps,j)),Re.isShaderMaterial&&Re.uniformsNeedUpdate===!0&&(ub.upload(ne,Ja(zt),Ps,j),Re.uniformsNeedUpdate=!1),Re.isSpriteMaterial&&si.setValue(ne,"center",ye.center),si.setValue(ne,"modelViewMatrix",ye.modelViewMatrix),si.setValue(ne,"normalMatrix",ye.normalMatrix),si.setValue(ne,"modelMatrix",ye.matrixWorld),Re.isShaderMaterial||Re.isRawShaderMaterial){const Ms=Re.uniformsGroups;for(let Es=0,lr=Ms.length;Es<lr;Es++){const Eo=Ms[Es];fe.update(Eo,Os),fe.bind(Eo,Os)}}return Os}function il(q,he){q.ambientLightColor.needsUpdate=he,q.lightProbe.needsUpdate=he,q.directionalLights.needsUpdate=he,q.directionalLightShadows.needsUpdate=he,q.pointLights.needsUpdate=he,q.pointLightShadows.needsUpdate=he,q.spotLights.needsUpdate=he,q.spotLightShadows.needsUpdate=he,q.rectAreaLights.needsUpdate=he,q.hemisphereLights.needsUpdate=he}function ns(q){return q.isMeshLambertMaterial||q.isMeshToonMaterial||q.isMeshPhongMaterial||q.isMeshStandardMaterial||q.isShadowMaterial||q.isShaderMaterial&&q.lights===!0}this.getActiveCubeFace=function(){return B},this.getActiveMipmapLevel=function(){return F},this.getRenderTarget=function(){return H},this.setRenderTargetTextures=function(q,he,Ae){const Re=Ie.get(q);Re.__autoAllocateDepthBuffer=q.resolveDepthBuffer===!1,Re.__autoAllocateDepthBuffer===!1&&(Re.__useRenderToTexture=!1),Ie.get(q.texture).__webglTexture=he,Ie.get(q.depthTexture).__webglTexture=Re.__autoAllocateDepthBuffer?void 0:Ae,Re.__hasExternalTextures=!0},this.setRenderTargetFramebuffer=function(q,he){const Ae=Ie.get(q);Ae.__webglFramebuffer=he,Ae.__useDefaultFramebuffer=he===void 0};const qc=ne.createFramebuffer();this.setRenderTarget=function(q,he=0,Ae=0){H=q,B=he,F=Ae;let Re=!0,ye=null,$e=!1,ut=!1;if(q){const bt=Ie.get(q);if(bt.__useDefaultFramebuffer!==void 0)He.bindFramebuffer(ne.FRAMEBUFFER,null),Re=!1;else if(bt.__webglFramebuffer===void 0)j.setupRenderTarget(q);else if(bt.__hasExternalTextures)j.rebindTextures(q,Ie.get(q.texture).__webglTexture,Ie.get(q.depthTexture).__webglTexture);else if(q.depthBuffer){const Ut=q.depthTexture;if(bt.__boundDepthTexture!==Ut){if(Ut!==null&&Ie.has(Ut)&&(q.width!==Ut.image.width||q.height!==Ut.image.height))throw new Error("WebGLRenderTarget: Attached DepthTexture is initialized to the incorrect size.");j.setupDepthRenderbuffer(q)}}const Wt=q.texture;(Wt.isData3DTexture||Wt.isDataArrayTexture||Wt.isCompressedArrayTexture)&&(ut=!0);const It=Ie.get(q).__webglFramebuffer;q.isWebGLCubeRenderTarget?(Array.isArray(It[he])?ye=It[he][Ae]:ye=It[he],$e=!0):q.samples>0&&j.useMultisampledRTT(q)===!1?ye=Ie.get(q).__webglMultisampledFramebuffer:Array.isArray(It)?ye=It[Ae]:ye=It,Z.copy(q.viewport),ue.copy(q.scissor),se=q.scissorTest}else Z.copy(re).multiplyScalar(J).floor(),ue.copy(we).multiplyScalar(J).floor(),se=Fe;if(Ae!==0&&(ye=qc),He.bindFramebuffer(ne.FRAMEBUFFER,ye)&&Re&&He.drawBuffers(q,ye),He.viewport(Z),He.scissor(ue),He.setScissorTest(se),$e){const bt=Ie.get(q.texture);ne.framebufferTexture2D(ne.FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_CUBE_MAP_POSITIVE_X+he,bt.__webglTexture,Ae)}else if(ut){const bt=Ie.get(q.texture),Wt=he;ne.framebufferTextureLayer(ne.FRAMEBUFFER,ne.COLOR_ATTACHMENT0,bt.__webglTexture,Ae,Wt)}else if(q!==null&&Ae!==0){const bt=Ie.get(q.texture);ne.framebufferTexture2D(ne.FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_2D,bt.__webglTexture,Ae)}I=-1},this.readRenderTargetPixels=function(q,he,Ae,Re,ye,$e,ut){if(!(q&&q.isWebGLRenderTarget)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");return}let dt=Ie.get(q).__webglFramebuffer;if(q.isWebGLCubeRenderTarget&&ut!==void 0&&(dt=dt[ut]),dt){He.bindFramebuffer(ne.FRAMEBUFFER,dt);try{const bt=q.texture,Wt=bt.format,It=bt.type;if(!Ge.textureFormatReadable(Wt)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");return}if(!Ge.textureTypeReadable(It)){console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");return}he>=0&&he<=q.width-Re&&Ae>=0&&Ae<=q.height-ye&&ne.readPixels(he,Ae,Re,ye,kt.convert(Wt),kt.convert(It),$e)}finally{const bt=H!==null?Ie.get(H).__webglFramebuffer:null;He.bindFramebuffer(ne.FRAMEBUFFER,bt)}}},this.readRenderTargetPixelsAsync=async function(q,he,Ae,Re,ye,$e,ut){if(!(q&&q.isWebGLRenderTarget))throw new Error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.");let dt=Ie.get(q).__webglFramebuffer;if(q.isWebGLCubeRenderTarget&&ut!==void 0&&(dt=dt[ut]),dt)if(he>=0&&he<=q.width-Re&&Ae>=0&&Ae<=q.height-ye){He.bindFramebuffer(ne.FRAMEBUFFER,dt);const bt=q.texture,Wt=bt.format,It=bt.type;if(!Ge.textureFormatReadable(Wt))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in RGBA or implementation defined format.");if(!Ge.textureTypeReadable(It))throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: renderTarget is not in UnsignedByteType or implementation defined type.");const Ut=ne.createBuffer();ne.bindBuffer(ne.PIXEL_PACK_BUFFER,Ut),ne.bufferData(ne.PIXEL_PACK_BUFFER,$e.byteLength,ne.STREAM_READ),ne.readPixels(he,Ae,Re,ye,kt.convert(Wt),kt.convert(It),0);const Sn=H!==null?Ie.get(H).__webglFramebuffer:null;He.bindFramebuffer(ne.FRAMEBUFFER,Sn);const Pn=ne.fenceSync(ne.SYNC_GPU_COMMANDS_COMPLETE,0);return ne.flush(),await JF(ne,Pn,4),ne.bindBuffer(ne.PIXEL_PACK_BUFFER,Ut),ne.getBufferSubData(ne.PIXEL_PACK_BUFFER,0,$e),ne.deleteBuffer(Ut),ne.deleteSync(Pn),$e}else throw new Error("THREE.WebGLRenderer.readRenderTargetPixelsAsync: requested read bounds are out of range.")},this.copyFramebufferToTexture=function(q,he=null,Ae=0){const Re=Math.pow(2,-Ae),ye=Math.floor(q.image.width*Re),$e=Math.floor(q.image.height*Re),ut=he!==null?he.x:0,dt=he!==null?he.y:0;j.setTexture2D(q,0),ne.copyTexSubImage2D(ne.TEXTURE_2D,Ae,0,0,ut,dt,ye,$e),He.unbindTexture()};const Wc=ne.createFramebuffer(),eo=ne.createFramebuffer();this.copyTextureToTexture=function(q,he,Ae=null,Re=null,ye=0,$e=null){$e===null&&(ye!==0?(Il("WebGLRenderer: copyTextureToTexture function signature has changed to support src and dst mipmap levels."),$e=ye,ye=0):$e=0);let ut,dt,bt,Wt,It,Ut,Sn,Pn,wi;const Tn=q.isCompressedTexture?q.mipmaps[$e]:q.image;if(Ae!==null)ut=Ae.max.x-Ae.min.x,dt=Ae.max.y-Ae.min.y,bt=Ae.isBox3?Ae.max.z-Ae.min.z:1,Wt=Ae.min.x,It=Ae.min.y,Ut=Ae.isBox3?Ae.min.z:0;else{const is=Math.pow(2,-ye);ut=Math.floor(Tn.width*is),dt=Math.floor(Tn.height*is),q.isDataArrayTexture?bt=Tn.depth:q.isData3DTexture?bt=Math.floor(Tn.depth*is):bt=1,Wt=0,It=0,Ut=0}Re!==null?(Sn=Re.x,Pn=Re.y,wi=Re.z):(Sn=0,Pn=0,wi=0);const Rn=kt.convert(he.format),zt=kt.convert(he.type);let Bi;he.isData3DTexture?(j.setTexture3D(he,0),Bi=ne.TEXTURE_3D):he.isDataArrayTexture||he.isCompressedArrayTexture?(j.setTexture2DArray(he,0),Bi=ne.TEXTURE_2D_ARRAY):(j.setTexture2D(he,0),Bi=ne.TEXTURE_2D),ne.pixelStorei(ne.UNPACK_FLIP_Y_WEBGL,he.flipY),ne.pixelStorei(ne.UNPACK_PREMULTIPLY_ALPHA_WEBGL,he.premultiplyAlpha),ne.pixelStorei(ne.UNPACK_ALIGNMENT,he.unpackAlignment);const Ln=ne.getParameter(ne.UNPACK_ROW_LENGTH),Os=ne.getParameter(ne.UNPACK_IMAGE_HEIGHT),To=ne.getParameter(ne.UNPACK_SKIP_PIXELS),li=ne.getParameter(ne.UNPACK_SKIP_ROWS),Mo=ne.getParameter(ne.UNPACK_SKIP_IMAGES);ne.pixelStorei(ne.UNPACK_ROW_LENGTH,Tn.width),ne.pixelStorei(ne.UNPACK_IMAGE_HEIGHT,Tn.height),ne.pixelStorei(ne.UNPACK_SKIP_PIXELS,Wt),ne.pixelStorei(ne.UNPACK_SKIP_ROWS,It),ne.pixelStorei(ne.UNPACK_SKIP_IMAGES,Ut);const si=q.isDataArrayTexture||q.isData3DTexture,Ps=he.isDataArrayTexture||he.isData3DTexture;if(q.isDepthTexture){const is=Ie.get(q),Ms=Ie.get(he),Es=Ie.get(is.__renderTarget),lr=Ie.get(Ms.__renderTarget);He.bindFramebuffer(ne.READ_FRAMEBUFFER,Es.__webglFramebuffer),He.bindFramebuffer(ne.DRAW_FRAMEBUFFER,lr.__webglFramebuffer);for(let Eo=0;Eo<bt;Eo++)si&&(ne.framebufferTextureLayer(ne.READ_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,Ie.get(q).__webglTexture,ye,Ut+Eo),ne.framebufferTextureLayer(ne.DRAW_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,Ie.get(he).__webglTexture,$e,wi+Eo)),ne.blitFramebuffer(Wt,It,ut,dt,Sn,Pn,ut,dt,ne.DEPTH_BUFFER_BIT,ne.NEAREST);He.bindFramebuffer(ne.READ_FRAMEBUFFER,null),He.bindFramebuffer(ne.DRAW_FRAMEBUFFER,null)}else if(ye!==0||q.isRenderTargetTexture||Ie.has(q)){const is=Ie.get(q),Ms=Ie.get(he);He.bindFramebuffer(ne.READ_FRAMEBUFFER,Wc),He.bindFramebuffer(ne.DRAW_FRAMEBUFFER,eo);for(let Es=0;Es<bt;Es++)si?ne.framebufferTextureLayer(ne.READ_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,is.__webglTexture,ye,Ut+Es):ne.framebufferTexture2D(ne.READ_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_2D,is.__webglTexture,ye),Ps?ne.framebufferTextureLayer(ne.DRAW_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,Ms.__webglTexture,$e,wi+Es):ne.framebufferTexture2D(ne.DRAW_FRAMEBUFFER,ne.COLOR_ATTACHMENT0,ne.TEXTURE_2D,Ms.__webglTexture,$e),ye!==0?ne.blitFramebuffer(Wt,It,ut,dt,Sn,Pn,ut,dt,ne.COLOR_BUFFER_BIT,ne.NEAREST):Ps?ne.copyTexSubImage3D(Bi,$e,Sn,Pn,wi+Es,Wt,It,ut,dt):ne.copyTexSubImage2D(Bi,$e,Sn,Pn,Wt,It,ut,dt);He.bindFramebuffer(ne.READ_FRAMEBUFFER,null),He.bindFramebuffer(ne.DRAW_FRAMEBUFFER,null)}else Ps?q.isDataTexture||q.isData3DTexture?ne.texSubImage3D(Bi,$e,Sn,Pn,wi,ut,dt,bt,Rn,zt,Tn.data):he.isCompressedArrayTexture?ne.compressedTexSubImage3D(Bi,$e,Sn,Pn,wi,ut,dt,bt,Rn,Tn.data):ne.texSubImage3D(Bi,$e,Sn,Pn,wi,ut,dt,bt,Rn,zt,Tn):q.isDataTexture?ne.texSubImage2D(ne.TEXTURE_2D,$e,Sn,Pn,ut,dt,Rn,zt,Tn.data):q.isCompressedTexture?ne.compressedTexSubImage2D(ne.TEXTURE_2D,$e,Sn,Pn,Tn.width,Tn.height,Rn,Tn.data):ne.texSubImage2D(ne.TEXTURE_2D,$e,Sn,Pn,ut,dt,Rn,zt,Tn);ne.pixelStorei(ne.UNPACK_ROW_LENGTH,Ln),ne.pixelStorei(ne.UNPACK_IMAGE_HEIGHT,Os),ne.pixelStorei(ne.UNPACK_SKIP_PIXELS,To),ne.pixelStorei(ne.UNPACK_SKIP_ROWS,li),ne.pixelStorei(ne.UNPACK_SKIP_IMAGES,Mo),$e===0&&he.generateMipmaps&&ne.generateMipmap(Bi),He.unbindTexture()},this.copyTextureToTexture3D=function(q,he,Ae=null,Re=null,ye=0){return Il('WebGLRenderer: copyTextureToTexture3D function has been deprecated. Use "copyTextureToTexture" instead.'),this.copyTextureToTexture(q,he,Ae,Re,ye)},this.initRenderTarget=function(q){Ie.get(q).__webglFramebuffer===void 0&&j.setupRenderTarget(q)},this.initTexture=function(q){q.isCubeTexture?j.setTextureCube(q,0):q.isData3DTexture?j.setTexture3D(q,0):q.isDataArrayTexture||q.isCompressedArrayTexture?j.setTexture2DArray(q,0):j.setTexture2D(q,0),He.unbindTexture()},this.resetState=function(){B=0,F=0,H=null,He.reset(),zn.reset()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}get coordinateSystem(){return zr}get outputColorSpace(){return this._outputColorSpace}set outputColorSpace(e){this._outputColorSpace=e;const t=this.getContext();t.drawingBufferColorSpace=on._getDrawingBufferColorSpace(e),t.unpackColorSpace=on._getUnpackColorSpace()}}const $Z=Object.freeze(Object.defineProperty({__proto__:null,ACESFilmicToneMapping:jb,AddEquation:_r,AddOperation:R1,AdditiveAnimationBlendMode:L1,AdditiveBlending:Yd,AgXToneMapping:D1,AlphaFormat:Zb,AlwaysCompare:rT,AlwaysDepth:Mg,AlwaysStencilFunc:gb,AmbientLight:pR,AnimationAction:i3,AnimationClip:M_,AnimationLoader:TV,AnimationMixer:QV,AnimationObjectGroup:ZV,AnimationUtils:_V,ArcCurve:BU,ArrayCamera:vR,ArrowHelper:x4,AttachedBindMode:OA,Audio:t3,AudioAnalyser:zV,AudioContext:yR,AudioListener:PV,AudioLoader:LV,AxesHelper:S4,BackSide:Ti,BasicDepthPacking:rU,BasicShadowMap:T1,BatchedMesh:wU,Bone:H1,BooleanKeyframeTrack:bp,Box2:a4,Box3:ga,Box3Helper:v4,BoxGeometry:Hc,BoxHelper:y4,BufferAttribute:Kn,BufferGeometry:fn,BufferGeometryLoader:e3,ByteType:tf,Cache:Cc,Camera:X_,CameraHelper:g4,CanvasTexture:Hz,CapsuleGeometry:gT,CatmullRomCurve3:OU,CineonToneMapping:w1,CircleGeometry:yT,ClampToEdgeWrapping:da,Clock:_R,Color:ft,ColorKeyframeTrack:lR,ColorManagement:on,CompressedArrayTexture:Vz,CompressedCubeTexture:Gz,CompressedTexture:pT,CompressedTextureLoader:MV,ConeGeometry:vT,ConstantAlphaFactor:KD,ConstantColorFactor:jD,Controls:T4,CubeCamera:V1,CubeReflectionMapping:va,CubeRefractionMapping:Wa,CubeTexture:_p,CubeTextureLoader:EV,CubeUVReflectionMapping:Ic,CubicBezierCurve:W1,CubicBezierCurve3:PU,CubicInterpolant:jU,CullFaceBack:fb,CullFaceFront:b1,CullFaceFrontBack:yF,CullFaceNone:S1,Curve:ql,CurvePath:FU,CustomBlending:Vd,CustomToneMapping:JD,CylinderGeometry:xp,Cylindrical:r4,Data3DTexture:aT,DataArrayTexture:Jg,DataTexture:Fl,DataTextureLoader:AV,DataUtils:mz,DecrementStencilOp:cU,DecrementWrapStencilOp:fU,DefaultLoadingManager:QU,DepthFormat:ka,DepthStencilFormat:qa,DepthTexture:ya,DetachedBindMode:$D,DirectionalLight:dR,DirectionalLightHelper:m4,DiscreteInterpolant:ZU,DodecahedronGeometry:_T,DoubleSide:Fr,DstAlphaFactor:kb,DstColorFactor:Wb,DynamicCopyUsage:DF,DynamicDrawUsage:Od,DynamicReadUsage:NF,EdgesGeometry:zU,EllipseCurve:mT,EqualCompare:tT,EqualDepth:Ag,EqualStencilFunc:gU,EquirectangularReflectionMapping:Pu,EquirectangularRefractionMapping:Iu,Euler:_a,EventDispatcher:bo,ExtrudeGeometry:xT,FileLoader:zc,Float16BufferAttribute:z1,Float32BufferAttribute:Et,FloatType:Ri,Fog:cT,FogExp2:uT,FramebufferTexture:k1,FrontSide:pa,Frustum:ty,GLBufferAttribute:i4,GLSL1:LF,GLSL3:PA,GreaterCompare:nT,GreaterDepth:Ng,GreaterEqualCompare:sT,GreaterEqualDepth:Rg,GreaterEqualStencilFunc:xU,GreaterStencilFunc:vU,GridHelper:d4,Group:cg,HalfFloatType:Ys,HemisphereLight:cR,HemisphereLightHelper:f4,IcosahedronGeometry:ST,ImageBitmapLoader:UV,ImageLoader:E_,ImageUtils:SU,IncrementStencilOp:uU,IncrementWrapStencilOp:hU,InstancedBufferAttribute:Qo,InstancedBufferGeometry:$U,InstancedInterleavedBuffer:r3,InstancedMesh:CU,Int16BufferAttribute:xz,Int32BufferAttribute:Sz,Int8BufferAttribute:yz,IntType:Xs,InterleavedBuffer:Y_,InterleavedBufferAttribute:uf,Interpolant:K_,InterpolateDiscrete:p_,InterpolateLinear:mb,InterpolateSmooth:eb,InvertStencilOp:dU,KeepStencilOp:Xh,KeyframeTrack:nl,LOD:RU,LatheGeometry:j_,Layers:zg,LessCompare:q_,LessDepth:Eg,LessEqualCompare:W_,LessEqualDepth:Pc,LessEqualStencilFunc:yU,LessStencilFunc:mU,Light:pf,LightProbe:gR,Line:cf,Line3:o4,LineBasicMaterial:qr,LineCurve:X1,LineCurve3:IU,LineDashedMaterial:rR,LineLoop:DU,LineSegments:Xu,LinearFilter:Zn,LinearInterpolant:oR,LinearMipMapLinearFilter:eU,LinearMipMapNearestFilter:xF,LinearMipmapLinearFilter:xr,LinearMipmapNearestFilter:ef,LinearSRGBColorSpace:xo,LinearToneMapping:N1,LinearTransfer:g_,Loader:ja,LoaderUtils:GA,LoadingManager:uR,LoopOnce:nU,LoopPingPong:sU,LoopRepeat:iU,LuminanceAlphaFormat:Qb,LuminanceFormat:Kb,MOUSE:mF,Material:ar,MaterialLoader:DT,MathUtils:P1,Matrix2:J_,Matrix3:Qt,Matrix4:Mt,MaxEquation:E1,Mesh:bi,MeshBasicMaterial:fa,MeshDepthMaterial:nR,MeshDistanceMaterial:iR,MeshLambertMaterial:tR,MeshMatcapMaterial:sR,MeshNormalMaterial:eR,MeshPhongMaterial:J1,MeshPhysicalMaterial:Q1,MeshStandardMaterial:NT,MeshToonMaterial:$1,MinEquation:M1,MirroredRepeatWrapping:Fc,MixOperation:A1,MultiplyBlending:Zd,MultiplyOperation:Kg,NearestFilter:Si,NearestMipMapLinearFilter:_F,NearestMipMapNearestFilter:vF,NearestMipmapLinearFilter:Ol,NearestMipmapNearestFilter:V_,NeutralToneMapping:U1,NeverCompare:eT,NeverDepth:Tg,NeverStencilFunc:pU,NoBlending:Ga,NoColorSpace:Ia,NoToneMapping:Gr,NormalAnimationBlendMode:$b,NormalBlending:_o,NotEqualCompare:iT,NotEqualDepth:Cg,NotEqualStencilFunc:_U,NumberKeyframeTrack:b_,Object3D:Hn,ObjectLoader:wV,ObjectSpaceNormalMap:B1,OctahedronGeometry:Z_,OneFactor:Vb,OneMinusConstantAlphaFactor:QD,OneMinusConstantColorFactor:ZD,OneMinusDstAlphaFactor:qb,OneMinusDstColorFactor:Xb,OneMinusSrcAlphaFactor:bg,OneMinusSrcColorFactor:Hb,OrthographicCamera:Mp,PCFShadowMap:F_,PCFSoftShadowMap:t_,PMREMGenerator:h1,Path:v_,PerspectiveCamera:us,Plane:wu,PlaneGeometry:Sp,PlaneHelper:_4,PointLight:fR,PointLightHelper:c4,Points:UU,PointsMaterial:dT,PolarGridHelper:p4,PolyhedronGeometry:df,PositionalAudio:FV,PropertyBinding:kn,PropertyMixer:n3,QuadraticBezierCurve:Y1,QuadraticBezierCurve3:j1,Quaternion:ma,QuaternionKeyframeTrack:Q_,QuaternionLinearInterpolant:KU,RED_GREEN_RGTC2_Format:Pg,RED_RGTC1_Format:Jb,REVISION:Zg,RGBADepthPacking:aU,RGBAFormat:Ni,RGBAIntegerFormat:vp,RGBA_ASTC_10x10_Format:up,RGBA_ASTC_10x5_Format:ap,RGBA_ASTC_10x6_Format:op,RGBA_ASTC_10x8_Format:lp,RGBA_ASTC_12x10_Format:cp,RGBA_ASTC_12x12_Format:hp,RGBA_ASTC_4x4_Format:Jd,RGBA_ASTC_5x4_Format:$d,RGBA_ASTC_5x5_Format:ep,RGBA_ASTC_6x5_Format:tp,RGBA_ASTC_6x6_Format:np,RGBA_ASTC_8x5_Format:ip,RGBA_ASTC_8x6_Format:sp,RGBA_ASTC_8x8_Format:rp,RGBA_BPTC_Format:rf,RGBA_ETC2_EAC_Format:Qd,RGBA_PVRTC_2BPPV1_Format:Lg,RGBA_PVRTC_4BPPV1_Format:Ug,RGBA_S3TC_DXT1_Format:wc,RGBA_S3TC_DXT3_Format:Dc,RGBA_S3TC_DXT5_Format:Uc,RGBDepthPacking:MF,RGBFormat:Qg,RGBIntegerFormat:tU,RGB_BPTC_SIGNED_Format:db,RGB_BPTC_UNSIGNED_Format:pb,RGB_ETC1_Format:Bg,RGB_ETC2_Format:Kd,RGB_PVRTC_2BPPV1_Format:Dg,RGB_PVRTC_4BPPV1_Format:wg,RGB_S3TC_DXT1_Format:sf,RGDepthPacking:EF,RGFormat:lf,RGIntegerFormat:yp,RawShaderMaterial:WU,Ray:$g,Raycaster:a3,RectAreaLight:mR,RedFormat:gp,RedIntegerFormat:ff,ReinhardToneMapping:C1,RenderTarget:tl,RenderTarget3D:JV,RenderTargetArray:$V,RepeatWrapping:zl,ReplaceStencilOp:lU,ReverseSubtractEquation:zb,RingGeometry:bT,SIGNED_RED_GREEN_RGTC2_Format:Ig,SIGNED_RED_RGTC1_Format:Og,SRGBColorSpace:wt,SRGBTransfer:$n,Scene:ey,ShaderChunk:_n,ShaderLib:Ll,ShaderMaterial:Hl,ShadowMaterial:K1,Shape:Hd,ShapeGeometry:TT,ShapePath:b4,ShapeUtils:Uu,ShortType:nf,Skeleton:fT,SkeletonHelper:u4,SkinnedMesh:NU,Source:Jh,Sphere:br,SphereGeometry:ny,Spherical:s4,SphericalHarmonics3:JU,SplineCurve:Z1,SpotLight:wT,SpotLightHelper:l4,Sprite:AU,SpriteMaterial:hT,SrcAlphaFactor:Sg,SrcAlphaSaturateFactor:Yb,SrcColorFactor:Gb,StaticCopyUsage:wF,StaticDrawUsage:Fg,StaticReadUsage:RF,StereoCamera:BV,StreamCopyUsage:UF,StreamDrawUsage:AF,StreamReadUsage:CF,StringKeyframeTrack:Tp,SubtractEquation:Fb,SubtractiveBlending:jd,TOUCH:gF,TangentSpaceNormalMap:Fu,TetrahedronGeometry:MT,Texture:Li,TextureLoader:CT,TextureUtils:N4,TimestampQuery:BF,TorusGeometry:ET,TorusKnotGeometry:AT,Triangle:Fa,TriangleFanDrawMode:TF,TriangleStripDrawMode:bF,TrianglesDrawMode:SF,TubeGeometry:RT,UVMapping:z_,Uint16BufferAttribute:oT,Uint32BufferAttribute:lT,Uint8BufferAttribute:vz,Uint8ClampedBufferAttribute:_z,Uniform:e4,UniformsGroup:n4,UniformsLib:_t,UniformsUtils:MU,UnsignedByteType:Xi,UnsignedInt248Type:Ha,UnsignedInt5999Type:k_,UnsignedIntType:di,UnsignedShort4444Type:G_,UnsignedShort5551Type:H_,UnsignedShortType:jo,VSMShadowMap:ua,Vector2:Xe,Vector3:Y,Vector4:Ot,VectorKeyframeTrack:T_,VideoFrameTexture:zz,VideoTexture:LU,WebGL3DRenderTarget:rz,WebGLArrayRenderTarget:sz,WebGLCoordinateSystem:zr,WebGLCubeRenderTarget:G1,WebGLRenderTarget:Gl,WebGLRenderer:KP,WebGLUtils:ZP,WebGPUCoordinateSystem:Vl,WebXRController:i_,WireframeGeometry:qU,WrapAroundEnding:m_,ZeroCurvatureEnding:Ld,ZeroFactor:Cu,ZeroSlopeEnding:Bd,ZeroStencilOp:oU,createCanvasElement:F1},Symbol.toStringTag,{value:"Module"}));var gA={exports:{}},Mc={};/**
 * @license React
 * react-reconciler-constants.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var bD;function eK(){return bD||(bD=1,Mc.ConcurrentRoot=1,Mc.ContinuousEventPriority=8,Mc.DefaultEventPriority=32,Mc.DiscreteEventPriority=2,Mc.IdleEventPriority=268435456,Mc.LegacyRoot=0,Mc.NoEventPriority=0),Mc}var TD;function tK(){return TD||(TD=1,gA.exports=eK()),gA.exports}var cb=tK(),yA={exports:{}},vA={},_A={exports:{}},xA={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var MD;function nK(){if(MD)return xA;MD=1;var r=jg();function e(y,v){return y===v&&(y!==0||1/y===1/v)||y!==y&&v!==v}var t=typeof Object.is=="function"?Object.is:e,n=r.useState,i=r.useEffect,s=r.useLayoutEffect,a=r.useDebugValue;function l(y,v){var x=v(),S=n({inst:{value:x,getSnapshot:v}}),A=S[0].inst,E=S[1];return s(function(){A.value=x,A.getSnapshot=v,c(A)&&E({inst:A})},[y,x,v]),i(function(){return c(A)&&E({inst:A}),y(function(){c(A)&&E({inst:A})})},[y]),a(x),x}function c(y){var v=y.getSnapshot;y=y.value;try{var x=v();return!t(y,x)}catch{return!0}}function d(y,v){return v()}var m=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?d:l;return xA.useSyncExternalStore=r.useSyncExternalStore!==void 0?r.useSyncExternalStore:m,xA}var ED;function iK(){return ED||(ED=1,_A.exports=nK()),_A.exports}/**
 * @license React
 * use-sync-external-store-shim/with-selector.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var AD;function sK(){if(AD)return vA;AD=1;var r=jg(),e=iK();function t(d,m){return d===m&&(d!==0||1/d===1/m)||d!==d&&m!==m}var n=typeof Object.is=="function"?Object.is:t,i=e.useSyncExternalStore,s=r.useRef,a=r.useEffect,l=r.useMemo,c=r.useDebugValue;return vA.useSyncExternalStoreWithSelector=function(d,m,y,v,x){var S=s(null);if(S.current===null){var A={hasValue:!1,value:null};S.current=A}else A=S.current;S=l(function(){function M(B){if(!C){if(C=!0,w=B,B=v(B),x!==void 0&&A.hasValue){var F=A.value;if(x(F,B))return D=F}return D=B}if(F=D,n(w,B))return F;var H=v(B);return x!==void 0&&x(F,H)?(w=B,F):(w=B,D=H)}var C=!1,w,D,z=y===void 0?null:y;return[function(){return M(m())},z===null?void 0:function(){return M(z())}]},[m,y,v,x]);var E=i(d,S[0],S[1]);return a(function(){A.hasValue=!0,A.value=E},[E]),c(E),E},vA}var RD;function rK(){return RD||(RD=1,yA.exports=sK()),yA.exports}var aK=rK();const oK=x1(aK),ND=r=>{let e;const t=new Set,n=(d,m)=>{const y=typeof d=="function"?d(e):d;if(!Object.is(y,e)){const v=e;e=m??(typeof y!="object"||y===null)?y:Object.assign({},e,y),t.forEach(x=>x(e,v))}},i=()=>e,l={setState:n,getState:i,getInitialState:()=>c,subscribe:d=>(t.add(d),()=>t.delete(d))},c=e=r(n,i,l);return l},lK=r=>r?ND(r):ND,{useSyncExternalStoreWithSelector:uK}=oK,cK=r=>r;function hK(r,e=cK,t){const n=uK(r.subscribe,r.getState,r.getInitialState,e,t);return oF.useDebugValue(n),n}const CD=(r,e)=>{const t=lK(r),n=(i,s=e)=>hK(t,i,s);return Object.assign(n,t),n},fK=(r,e)=>r?CD(r,e):CD;var SA={exports:{}},bA={exports:{}},TA={exports:{}},MA={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wD;function dK(){return wD||(wD=1,function(r){function e(V,Q){var J=V.length;V.push(Q);e:for(;0<J;){var ve=J-1>>>1,X=V[ve];if(0<i(X,Q))V[ve]=Q,V[J]=X,J=ve;else break e}}function t(V){return V.length===0?null:V[0]}function n(V){if(V.length===0)return null;var Q=V[0],J=V.pop();if(J!==Q){V[0]=J;e:for(var ve=0,X=V.length,re=X>>>1;ve<re;){var we=2*(ve+1)-1,Fe=V[we],oe=we+1,De=V[oe];if(0>i(Fe,J))oe<X&&0>i(De,Fe)?(V[ve]=De,V[oe]=J,ve=oe):(V[ve]=Fe,V[we]=J,ve=we);else if(oe<X&&0>i(De,J))V[ve]=De,V[oe]=J,ve=oe;else break e}}return Q}function i(V,Q){var J=V.sortIndex-Q.sortIndex;return J!==0?J:V.id-Q.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();r.unstable_now=function(){return a.now()-l}}var c=[],d=[],m=1,y=null,v=3,x=!1,S=!1,A=!1,E=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function w(V){for(var Q=t(d);Q!==null;){if(Q.callback===null)n(d);else if(Q.startTime<=V)n(d),Q.sortIndex=Q.expirationTime,e(c,Q);else break;Q=t(d)}}function D(V){if(A=!1,w(V),!S)if(t(c)!==null)S=!0,pe();else{var Q=t(d);Q!==null&&Se(D,Q.startTime-V)}}var z=!1,B=-1,F=5,H=-1;function I(){return!(r.unstable_now()-H<F)}function P(){if(z){var V=r.unstable_now();H=V;var Q=!0;try{e:{S=!1,A&&(A=!1,M(B),B=-1),x=!0;var J=v;try{t:{for(w(V),y=t(c);y!==null&&!(y.expirationTime>V&&I());){var ve=y.callback;if(typeof ve=="function"){y.callback=null,v=y.priorityLevel;var X=ve(y.expirationTime<=V);if(V=r.unstable_now(),typeof X=="function"){y.callback=X,w(V),Q=!0;break t}y===t(c)&&n(c),w(V)}else n(c);y=t(c)}if(y!==null)Q=!0;else{var re=t(d);re!==null&&Se(D,re.startTime-V),Q=!1}}break e}finally{y=null,v=J,x=!1}Q=void 0}}finally{Q?Z():z=!1}}}var Z;if(typeof C=="function")Z=function(){C(P)};else if(typeof MessageChannel<"u"){var ue=new MessageChannel,se=ue.port2;ue.port1.onmessage=P,Z=function(){se.postMessage(null)}}else Z=function(){E(P,0)};function pe(){z||(z=!0,Z())}function Se(V,Q){B=E(function(){V(r.unstable_now())},Q)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(V){V.callback=null},r.unstable_continueExecution=function(){S||x||(S=!0,pe())},r.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<V?Math.floor(1e3/V):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_getFirstCallbackNode=function(){return t(c)},r.unstable_next=function(V){switch(v){case 1:case 2:case 3:var Q=3;break;default:Q=v}var J=v;v=Q;try{return V()}finally{v=J}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(V,Q){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var J=v;v=V;try{return Q()}finally{v=J}},r.unstable_scheduleCallback=function(V,Q,J){var ve=r.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?ve+J:ve):J=ve,V){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=J+X,V={id:m++,callback:Q,priorityLevel:V,startTime:J,expirationTime:X,sortIndex:-1},J>ve?(V.sortIndex=J,e(d,V),t(c)===null&&V===t(d)&&(A?(M(B),B=-1):A=!0,Se(D,J-ve))):(V.sortIndex=X,e(c,V),S||x||(S=!0,pe())),V},r.unstable_shouldYield=I,r.unstable_wrapCallback=function(V){var Q=v;return function(){var J=v;v=Q;try{return V.apply(this,arguments)}finally{v=J}}}}(MA)),MA}var DD;function pK(){return DD||(DD=1,TA.exports=dK()),TA.exports}/**
 * @license React
 * react-reconciler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var UD;function mK(){return UD||(UD=1,function(r){r.exports=function(e){function t(h,f,_,T){return new Iy(h,f,_,T)}function n(){}function i(h){var f="https://react.dev/errors/"+h;if(1<arguments.length){f+="?args[]="+encodeURIComponent(arguments[1]);for(var _=2;_<arguments.length;_++)f+="&args[]="+encodeURIComponent(arguments[_])}return"Minified React error #"+h+"; visit "+f+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(h){return h===null||typeof h!="object"?null:(h=gl&&h[gl]||h["@@iterator"],typeof h=="function"?h:null)}function a(h){if(h==null)return null;if(typeof h=="function")return h.$$typeof===Gy?null:h.displayName||h.name||null;if(typeof h=="string")return h;switch(h){case lu:return"Fragment";case Ta:return"Portal";case em:return"Profiler";case Xf:return"StrictMode";case tm:return"Suspense";case hh:return"SuspenseList"}if(typeof h=="object")switch(h.$$typeof){case io:return(h.displayName||"Context")+".Provider";case zy:return(h._context.displayName||"Context")+".Consumer";case jf:var f=h.render;return h=h.displayName,h||(h=f.displayName||f.name||"",h=h!==""?"ForwardRef("+h+")":"ForwardRef"),h;case nm:return f=h.displayName||null,f!==null?f:a(h.type)||"Memo";case Ma:f=h._payload,h=h._init;try{return a(h(f))}catch{}}return null}function l(h){if(wo===void 0)try{throw Error()}catch(_){var f=_.stack.trim().match(/\n( *(at )?)/);wo=f&&f[1]||"",yl=-1<_.stack.indexOf(`
    at`)?" (<anonymous>)":-1<_.stack.indexOf("@")?"@unknown:0:0":""}return`
`+wo+h+yl}function c(h,f){if(!h||$u)return"";$u=!0;var _=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var T={DetermineComponentFrameRoot:function(){try{if(f){var vt=function(){throw Error()};if(Object.defineProperty(vt.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(vt,[])}catch(rn){var xt=rn}Reflect.construct(h,[],vt)}else{try{vt.call()}catch(rn){xt=rn}h.call(vt.prototype)}}else{try{throw Error()}catch(rn){xt=rn}(vt=h())&&typeof vt.catch=="function"&&vt.catch(function(){})}}catch(rn){if(rn&&xt&&typeof rn.stack=="string")return[rn.stack,xt.stack]}return[null,null]}};T.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var N=Object.getOwnPropertyDescriptor(T.DetermineComponentFrameRoot,"name");N&&N.configurable&&Object.defineProperty(T.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var U=T.DetermineComponentFrameRoot(),W=U[0],te=U[1];if(W&&te){var xe=W.split(`
`),qe=te.split(`
`);for(N=T=0;T<xe.length&&!xe[T].includes("DetermineComponentFrameRoot");)T++;for(;N<qe.length&&!qe[N].includes("DetermineComponentFrameRoot");)N++;if(T===xe.length||N===qe.length)for(T=xe.length-1,N=qe.length-1;1<=T&&0<=N&&xe[T]!==qe[N];)N--;for(;1<=T&&0<=N;T--,N--)if(xe[T]!==qe[N]){if(T!==1||N!==1)do if(T--,N--,0>N||xe[T]!==qe[N]){var st=`
`+xe[T].replace(" at new "," at ");return h.displayName&&st.includes("<anonymous>")&&(st=st.replace("<anonymous>",h.displayName)),st}while(1<=T&&0<=N);break}}}finally{$u=!1,Error.prepareStackTrace=_}return(_=h?h.displayName||h.name:"")?l(_):""}function d(h){switch(h.tag){case 26:case 27:case 5:return l(h.type);case 16:return l("Lazy");case 13:return l("Suspense");case 19:return l("SuspenseList");case 0:case 15:return h=c(h.type,!1),h;case 11:return h=c(h.type.render,!1),h;case 1:return h=c(h.type,!0),h;default:return""}}function m(h){try{var f="";do f+=d(h),h=h.return;while(h);return f}catch(_){return`
Error generating stack: `+_.message+`
`+_.stack}}function y(h){var f=h,_=h;if(h.alternate)for(;f.return;)f=f.return;else{h=f;do f=h,(f.flags&4098)!==0&&(_=f.return),h=f.return;while(h)}return f.tag===3?_:null}function v(h){if(y(h)!==h)throw Error(i(188))}function x(h){var f=h.alternate;if(!f){if(f=y(h),f===null)throw Error(i(188));return f!==h?null:h}for(var _=h,T=f;;){var N=_.return;if(N===null)break;var U=N.alternate;if(U===null){if(T=N.return,T!==null){_=T;continue}break}if(N.child===U.child){for(U=N.child;U;){if(U===_)return v(N),h;if(U===T)return v(N),f;U=U.sibling}throw Error(i(188))}if(_.return!==T.return)_=N,T=U;else{for(var W=!1,te=N.child;te;){if(te===_){W=!0,_=N,T=U;break}if(te===T){W=!0,T=N,_=U;break}te=te.sibling}if(!W){for(te=U.child;te;){if(te===_){W=!0,_=U,T=N;break}if(te===T){W=!0,T=U,_=N;break}te=te.sibling}if(!W)throw Error(i(189))}}if(_.alternate!==T)throw Error(i(190))}if(_.tag!==3)throw Error(i(188));return _.stateNode.current===_?h:f}function S(h){var f=h.tag;if(f===5||f===26||f===27||f===6)return h;for(h=h.child;h!==null;){if(f=S(h),f!==null)return f;h=h.sibling}return null}function A(h){var f=h.tag;if(f===5||f===26||f===27||f===6)return h;for(h=h.child;h!==null;){if(h.tag!==4&&(f=A(h),f!==null))return f;h=h.sibling}return null}function E(h){return{current:h}}function M(h){0>Sl||(h.current=Ki[Sl],Ki[Sl]=null,Sl--)}function C(h,f){Sl++,Ki[Sl]=h.current,h.current=f}function w(h){return h>>>=0,h===0?32:31-(xx(h)/Sx|0)|0}function D(h){var f=h&42;if(f!==0)return f;switch(h&-h){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return h&4194176;case 4194304:case 8388608:case 16777216:case 33554432:return h&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return h}}function z(h,f){var _=h.pendingLanes;if(_===0)return 0;var T=0,N=h.suspendedLanes,U=h.pingedLanes,W=h.warmLanes;h=h.finishedLanes!==0;var te=_&134217727;return te!==0?(_=te&~N,_!==0?T=D(_):(U&=te,U!==0?T=D(U):h||(W=te&~W,W!==0&&(T=D(W))))):(te=_&~N,te!==0?T=D(te):U!==0?T=D(U):h||(W=_&~W,W!==0&&(T=D(W)))),T===0?0:f!==0&&f!==T&&(f&N)===0&&(N=T&-T,W=f&-f,N>=W||N===32&&(W&4194176)!==0)?f:T}function B(h,f){return(h.pendingLanes&~(h.suspendedLanes&~h.pingedLanes)&f)===0}function F(h,f){switch(h){case 1:case 2:case 4:case 8:return f+250;case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function H(){var h=Uo;return Uo<<=1,(Uo&4194176)===0&&(Uo=128),h}function I(){var h=nc;return nc<<=1,(nc&62914560)===0&&(nc=4194304),h}function P(h){for(var f=[],_=0;31>_;_++)f.push(h);return f}function Z(h,f){h.pendingLanes|=f,f!==268435456&&(h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0)}function ue(h,f,_,T,N,U){var W=h.pendingLanes;h.pendingLanes=_,h.suspendedLanes=0,h.pingedLanes=0,h.warmLanes=0,h.expiredLanes&=_,h.entangledLanes&=_,h.errorRecoveryDisabledLanes&=_,h.shellSuspendCounter=0;var te=h.entanglements,xe=h.expirationTimes,qe=h.hiddenUpdates;for(_=W&~_;0<_;){var st=31-pr(_),vt=1<<st;te[st]=0,xe[st]=-1;var xt=qe[st];if(xt!==null)for(qe[st]=null,st=0;st<xt.length;st++){var rn=xt[st];rn!==null&&(rn.lane&=-536870913)}_&=~vt}T!==0&&se(h,T,0),U!==0&&N===0&&h.tag!==0&&(h.suspendedLanes|=U&~(W&~f))}function se(h,f,_){h.pendingLanes|=f,h.suspendedLanes&=~f;var T=31-pr(f);h.entangledLanes|=f,h.entanglements[T]=h.entanglements[T]|1073741824|_&4194218}function pe(h,f){var _=h.entangledLanes|=f;for(h=h.entanglements;_;){var T=31-pr(_),N=1<<T;N&f|h[T]&f&&(h[T]|=f),_&=~N}}function Se(h){return h&=-h,2<h?8<h?(h&134217727)!==0?32:268435456:8:2}function V(h){if(Ur&&typeof Ur.onCommitFiberRoot=="function")try{Ur.onCommitFiberRoot(Qi,h,void 0,(h.current.flags&128)===128)}catch{}}function Q(h){if(typeof Mx=="function"&&Ns(h),Ur&&typeof Ur.setStrictMode=="function")try{Ur.setStrictMode(Qi,h)}catch{}}function J(h,f){return h===f&&(h!==0||1/h===1/f)||h!==h&&f!==f}function ve(h,f){if(typeof h=="object"&&h!==null){var _=av.get(h);return _!==void 0?_:(f={value:h,source:f,stack:m(f)},av.set(h,f),f)}return{value:h,source:f,stack:m(f)}}function X(h,f){ic[sc++]=xh,ic[sc++]=rc,rc=h,xh=f}function re(h,f,_){Kr[Qr++]=ao,Kr[Qr++]=oo,Kr[Qr++]=mu,mu=h;var T=ao;h=oo;var N=32-pr(T)-1;T&=~(1<<N),_+=1;var U=32-pr(f)+N;if(30<U){var W=N-N%5;U=(T&(1<<W)-1).toString(32),T>>=W,N-=W,ao=1<<32-pr(f)+N|_<<N|T,oo=U+h}else ao=1<<U|_<<N|T,oo=h}function we(h){h.return!==null&&(X(h,1),re(h,1,0))}function Fe(h){for(;h===rc;)rc=ic[--sc],ic[sc]=null,xh=ic[--sc],ic[sc]=null;for(;h===mu;)mu=Kr[--Qr],Kr[Qr]=null,oo=Kr[--Qr],Kr[Qr]=null,ao=Kr[--Qr],Kr[Qr]=null}function oe(h,f){C(Lo,f),C(Sh,h),C(gs,null),h=z0(f),M(gs),C(gs,h)}function De(){M(gs),M(Sh),M(Lo)}function je(h){h.memoizedState!==null&&C(ac,h);var f=gs.current,_=mh(f,h.type);f!==_&&(C(Sh,h),C(gs,_))}function nt(h){Sh.current===h&&(M(gs),M(Sh)),ac.current===h&&(M(ac),fr?so._currentValue=cu:so._currentValue2=cu)}function lt(h){var f=Error(i(418,""));throw $t(ve(f,h)),id}function nn(h,f){if(!Hs)throw Error(i(175));cx(h.stateNode,h.type,h.memoizedProps,f,h)||lt(h)}function Pt(h){for(ks=h.return;ks;)switch(ks.tag){case 3:case 27:Cs=!0;return;case 5:case 13:Cs=!1;return;default:ks=ks.return}}function mn(h){if(!Hs||h!==ks)return!1;if(!Bn)return Pt(h),Bn=!0,!1;var f=!1;if(ui?h.tag!==3&&h.tag!==27&&(h.tag!==5||hm(h.type)&&!cn(h.type,h.memoizedProps))&&(f=!0):h.tag!==3&&(h.tag!==5||hm(h.type)&&!cn(h.type,h.memoizedProps))&&(f=!0),f&&qs&&lt(h),Pt(h),h.tag===13){if(!Hs)throw Error(i(316));if(h=h.memoizedState,h=h!==null?h.dehydrated:null,!h)throw Error(i(317));qs=fx(h)}else qs=ks?nv(h.stateNode):null;return!0}function An(){Hs&&(qs=ks=null,Bn=!1)}function $t(h){Ra===null?Ra=[h]:Ra.push(h)}function ne(){for(var h=oc,f=lo=oc=0;f<h;){var _=Na[f];Na[f++]=null;var T=Na[f];Na[f++]=null;var N=Na[f];Na[f++]=null;var U=Na[f];if(Na[f++]=null,T!==null&&N!==null){var W=T.pending;W===null?N.next=N:(N.next=W.next,W.next=N),T.pending=N}U!==0&&He(_,N,U)}}function oi(h,f,_,T){Na[oc++]=h,Na[oc++]=f,Na[oc++]=_,Na[oc++]=T,lo|=T,h.lanes|=T,h=h.alternate,h!==null&&(h.lanes|=T)}function Ze(h,f,_,T){return oi(h,f,_,T),at(h)}function Ge(h,f){return oi(h,null,null,f),at(h)}function He(h,f,_){h.lanes|=_;var T=h.alternate;T!==null&&(T.lanes|=_);for(var N=!1,U=h.return;U!==null;)U.childLanes|=_,T=U.alternate,T!==null&&(T.childLanes|=_),U.tag===22&&(h=U.stateNode,h===null||h._visibility&1||(N=!0)),h=U,U=U.return;N&&f!==null&&h.tag===3&&(U=h.stateNode,N=31-pr(_),U=U.hiddenUpdates,h=U[N],h===null?U[N]=[f]:h.push(f),f.lane=_|536870912)}function at(h){if(50<wh)throw wh=0,Am=null,Error(i(185));for(var f=h.return;f!==null;)h=f,f=h.return;return h.tag===3?h.stateNode:null}function Ie(h){h!==bl&&h.next===null&&(bl===null?sd=bl=h:bl=bl.next=h),pi=!0,lc||(lc=!0,Be(G))}function j(h,f){if(!ov&&pi){ov=!0;do for(var _=!1,T=sd;T!==null;){if(h!==0){var N=T.pendingLanes;if(N===0)var U=0;else{var W=T.suspendedLanes,te=T.pingedLanes;U=(1<<31-pr(42|h)+1)-1,U&=N&~(W&~te),U=U&201326677?U&201326677|1:U?U|2:0}U!==0&&(_=!0,ke(T,U))}else U=Nn,U=z(T,T===Xn?U:0),(U&3)===0||B(T,U)||(_=!0,ke(T,U));T=T.next}while(_);ov=!1}}function G(){pi=lc=!1;var h=0;bh!==0&&(k0()&&(h=bh),bh=0);for(var f=Aa(),_=null,T=sd;T!==null;){var N=T.next,U=de(T,f);U===0?(T.next=null,_===null?sd=N:_.next=N,N===null&&(bl=_)):(_=T,(h!==0||(U&3)!==0)&&(pi=!0)),T=N}j(h)}function de(h,f){for(var _=h.suspendedLanes,T=h.pingedLanes,N=h.expirationTimes,U=h.pendingLanes&-62914561;0<U;){var W=31-pr(U),te=1<<W,xe=N[W];xe===-1?((te&_)===0||(te&T)!==0)&&(N[W]=F(te,f)):xe<=f&&(h.expiredLanes|=te),U&=~te}if(f=Xn,_=Nn,_=z(h,h===f?_:0),T=h.callbackNode,_===0||h===f&&ri===2||h.cancelPendingCommit!==null)return T!==null&&T!==null&&mm(T),h.callbackNode=null,h.callbackPriority=0;if((_&3)===0||B(h,_)){if(f=_&-_,f===h.callbackPriority)return f;switch(T!==null&&mm(T),Se(_)){case 2:case 8:_=Tx;break;case 32:_=vm;break;case 268435456:_=gM;break;default:_=vm}return T=Le.bind(null,h),_=nd(_,T),h.callbackPriority=f,h.callbackNode=_,f}return T!==null&&T!==null&&mm(T),h.callbackPriority=2,h.callbackNode=null,2}function Le(h,f){var _=h.callbackNode;if(no()&&h.callbackNode!==_)return null;var T=Nn;return T=z(h,h===Xn?T:0),T===0?null:(iu(h,T,f),de(h,Aa()),h.callbackNode!=null&&h.callbackNode===_?Le.bind(null,h):null)}function ke(h,f){if(no())return null;iu(h,f,!0)}function Be(h){Xy?xl(function(){(Fn&6)!==0?nd(ym,h):h()}):nd(ym,h)}function ct(){return bh===0&&(bh=H()),bh}function it(h,f){if(Th===null){var _=Th=[];uc=0,Jr=ct(),cc={status:"pending",value:void 0,then:function(T){_.push(T)}}}return uc++,f.then(ot,ot),f}function ot(){if(--uc===0&&Th!==null){cc!==null&&(cc.status="fulfilled");var h=Th;Th=null,Jr=0,cc=null;for(var f=0;f<h.length;f++)(0,h[f])()}}function xn(h,f){var _=[],T={status:"pending",value:null,reason:null,then:function(N){_.push(N)}};return h.then(function(){T.status="fulfilled",T.value=f;for(var N=0;N<_.length;N++)(0,_[N])(f)},function(N){for(T.status="rejected",T.reason=N,N=0;N<_.length;N++)(0,_[N])(void 0)}),T}function et(h){h.updateQueue={baseState:h.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function St(h,f){h=h.updateQueue,f.updateQueue===h&&(f.updateQueue={baseState:h.baseState,firstBaseUpdate:h.firstBaseUpdate,lastBaseUpdate:h.lastBaseUpdate,shared:h.shared,callbacks:null})}function Rt(h){return{lane:h,tag:0,payload:null,callback:null,next:null}}function Nt(h,f,_){var T=h.updateQueue;if(T===null)return null;if(T=T.shared,(Fn&2)!==0){var N=T.pending;return N===null?f.next=f:(f.next=N.next,N.next=f),T.pending=f,f=at(h),He(h,null,_),f}return oi(h,T,f,_),at(h)}function ht(h,f,_){if(f=f.updateQueue,f!==null&&(f=f.shared,(_&4194176)!==0)){var T=f.lanes;T&=h.pendingLanes,_|=T,f.lanes=_,pe(h,_)}}function dn(h,f){var _=h.updateQueue,T=h.alternate;if(T!==null&&(T=T.updateQueue,_===T)){var N=null,U=null;if(_=_.firstBaseUpdate,_!==null){do{var W={lane:_.lane,tag:_.tag,payload:_.payload,callback:null,next:null};U===null?N=U=W:U=U.next=W,_=_.next}while(_!==null);U===null?N=U=f:U=U.next=f}else N=U=f;_={baseState:T.baseState,firstBaseUpdate:N,lastBaseUpdate:U,shared:T.shared,callbacks:T.callbacks},h.updateQueue=_;return}h=_.lastBaseUpdate,h===null?_.firstBaseUpdate=f:h.next=f,_.lastBaseUpdate=f}function kt(){if(hc){var h=cc;if(h!==null)throw h}}function zn(h,f,_,T){hc=!1;var N=h.updateQueue;Tl=!1;var U=N.firstBaseUpdate,W=N.lastBaseUpdate,te=N.shared.pending;if(te!==null){N.shared.pending=null;var xe=te,qe=xe.next;xe.next=null,W===null?U=qe:W.next=qe,W=xe;var st=h.alternate;st!==null&&(st=st.updateQueue,te=st.lastBaseUpdate,te!==W&&(te===null?st.firstBaseUpdate=qe:te.next=qe,st.lastBaseUpdate=xe))}if(U!==null){var vt=N.baseState;W=0,st=qe=xe=null,te=U;do{var xt=te.lane&-536870913,rn=xt!==te.lane;if(rn?(Nn&xt)===xt:(T&xt)===xt){xt!==0&&xt===Jr&&(hc=!0),st!==null&&(st=st.next={lane:0,tag:te.tag,payload:te.payload,callback:null,next:null});e:{var aa=h,Mu=te;xt=f;var Eu=_;switch(Mu.tag){case 1:if(aa=Mu.payload,typeof aa=="function"){vt=aa.call(Eu,vt,xt);break e}vt=aa;break e;case 3:aa.flags=aa.flags&-65537|128;case 0:if(aa=Mu.payload,xt=typeof aa=="function"?aa.call(Eu,vt,xt):aa,xt==null)break e;vt=$p({},vt,xt);break e;case 2:Tl=!0}}xt=te.callback,xt!==null&&(h.flags|=64,rn&&(h.flags|=8192),rn=N.callbacks,rn===null?N.callbacks=[xt]:rn.push(xt))}else rn={lane:xt,tag:te.tag,payload:te.payload,callback:te.callback,next:null},st===null?(qe=st=rn,xe=vt):st=st.next=rn,W|=xt;if(te=te.next,te===null){if(te=N.shared.pending,te===null)break;rn=te,te=rn.next,rn.next=null,N.lastBaseUpdate=rn,N.shared.pending=null}}while(!0);st===null&&(xe=vt),N.baseState=xe,N.firstBaseUpdate=qe,N.lastBaseUpdate=st,U===null&&(N.shared.lanes=0),sa|=W,h.lanes=W,h.memoizedState=vt}}function fe(h,f){if(typeof h!="function")throw Error(i(191,h));h.call(f)}function mt(h,f){var _=h.callbacks;if(_!==null)for(h.callbacks=null,h=0;h<_.length;h++)fe(_[h],f)}function Ue(h,f){if(Lr(h,f))return!0;if(typeof h!="object"||h===null||typeof f!="object"||f===null)return!1;var _=Object.keys(h),T=Object.keys(f);if(_.length!==T.length)return!1;for(T=0;T<_.length;T++){var N=_[T];if(!Bo.call(f,N)||!Lr(h[N],f[N]))return!1}return!0}function Ke(h){return h=h.status,h==="fulfilled"||h==="rejected"}function yt(){}function gt(h,f,_){switch(_=h[_],_===void 0?h.push(f):_!==f&&(f.then(yt,yt),f=_),f.status){case"fulfilled":return f.value;case"rejected":throw h=f.reason,h===Mh?Error(i(483)):h;default:if(typeof f.status=="string")f.then(yt,yt);else{if(h=Xn,h!==null&&100<h.shellSuspendCounter)throw Error(i(482));h=f,h.status="pending",h.then(function(T){if(f.status==="pending"){var N=f;N.status="fulfilled",N.value=T}},function(T){if(f.status==="pending"){var N=f;N.status="rejected",N.reason=T}})}switch(f.status){case"fulfilled":return f.value;case"rejected":throw h=f.reason,h===Mh?Error(i(483)):h}throw gu=f,Mh}}function Jt(){if(gu===null)throw Error(i(459));var h=gu;return gu=null,h}function Qn(h){var f=vu;return vu+=1,yu===null&&(yu=[]),gt(yu,h,f)}function Ci(h,f){f=f.props.ref,h.ref=f!==void 0?f:null}function Dn(h,f){throw f.$$typeof===uM?Error(i(525)):(h=Object.prototype.toString.call(f),Error(i(31,h==="[object Object]"?"object with keys {"+Object.keys(f).join(", ")+"}":h)))}function Mr(h){var f=h._init;return f(h._payload)}function ds(h){function f(Me,le){if(h){var Ce=Me.deletions;Ce===null?(Me.deletions=[le],Me.flags|=16):Ce.push(le)}}function _(Me,le){if(!h)return null;for(;le!==null;)f(Me,le),le=le.sibling;return null}function T(Me){for(var le=new Map;Me!==null;)Me.key!==null?le.set(Me.key,Me):le.set(Me.index,Me),Me=Me.sibling;return le}function N(Me,le){return Me=ba(Me,le),Me.index=0,Me.sibling=null,Me}function U(Me,le,Ce){return Me.index=Ce,h?(Ce=Me.alternate,Ce!==null?(Ce=Ce.index,Ce<le?(Me.flags|=33554434,le):Ce):(Me.flags|=33554434,le)):(Me.flags|=1048576,le)}function W(Me){return h&&Me.alternate===null&&(Me.flags|=33554434),Me}function te(Me,le,Ce,tt){return le===null||le.tag!==6?(le=Qp(Ce,Me.mode,tt),le.return=Me,le):(le=N(le,Ce),le.return=Me,le)}function xe(Me,le,Ce,tt){var Lt=Ce.type;return Lt===lu?st(Me,le,Ce.props.children,tt,Ce.key):le!==null&&(le.elementType===Lt||typeof Lt=="object"&&Lt!==null&&Lt.$$typeof===Ma&&Mr(Lt)===le.type)?(le=N(le,Ce.props),Ci(le,Ce),le.return=Me,le):(le=Co(Ce.type,Ce.key,Ce.props,null,Me.mode,tt),Ci(le,Ce),le.return=Me,le)}function qe(Me,le,Ce,tt){return le===null||le.tag!==4||le.stateNode.containerInfo!==Ce.containerInfo||le.stateNode.implementation!==Ce.implementation?(le=Fy(Ce,Me.mode,tt),le.return=Me,le):(le=N(le,Ce.children||[]),le.return=Me,le)}function st(Me,le,Ce,tt,Lt){return le===null||le.tag!==7?(le=Gi(Ce,Me.mode,tt,Lt),le.return=Me,le):(le=N(le,Ce),le.return=Me,le)}function vt(Me,le,Ce){if(typeof le=="string"&&le!==""||typeof le=="number"||typeof le=="bigint")return le=Qp(""+le,Me.mode,Ce),le.return=Me,le;if(typeof le=="object"&&le!==null){switch(le.$$typeof){case Wf:return Ce=Co(le.type,le.key,le.props,null,Me.mode,Ce),Ci(Ce,le),Ce.return=Me,Ce;case Ta:return le=Fy(le,Me.mode,Ce),le.return=Me,le;case Ma:var tt=le._init;return le=tt(le._payload),vt(Me,le,Ce)}if(fh(le)||s(le))return le=Gi(le,Me.mode,Ce,null),le.return=Me,le;if(typeof le.then=="function")return vt(Me,Qn(le),Ce);if(le.$$typeof===io)return vt(Me,wf(Me,le),Ce);Dn(Me,le)}return null}function xt(Me,le,Ce,tt){var Lt=le!==null?le.key:null;if(typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint")return Lt!==null?null:te(Me,le,""+Ce,tt);if(typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case Wf:return Ce.key===Lt?xe(Me,le,Ce,tt):null;case Ta:return Ce.key===Lt?qe(Me,le,Ce,tt):null;case Ma:return Lt=Ce._init,Ce=Lt(Ce._payload),xt(Me,le,Ce,tt)}if(fh(Ce)||s(Ce))return Lt!==null?null:st(Me,le,Ce,tt,null);if(typeof Ce.then=="function")return xt(Me,le,Qn(Ce),tt);if(Ce.$$typeof===io)return xt(Me,le,wf(Me,Ce),tt);Dn(Me,Ce)}return null}function rn(Me,le,Ce,tt,Lt){if(typeof tt=="string"&&tt!==""||typeof tt=="number"||typeof tt=="bigint")return Me=Me.get(Ce)||null,te(le,Me,""+tt,Lt);if(typeof tt=="object"&&tt!==null){switch(tt.$$typeof){case Wf:return Me=Me.get(tt.key===null?Ce:tt.key)||null,xe(le,Me,tt,Lt);case Ta:return Me=Me.get(tt.key===null?Ce:tt.key)||null,qe(le,Me,tt,Lt);case Ma:var Ei=tt._init;return tt=Ei(tt._payload),rn(Me,le,Ce,tt,Lt)}if(fh(tt)||s(tt))return Me=Me.get(Ce)||null,st(le,Me,tt,Lt,null);if(typeof tt.then=="function")return rn(Me,le,Ce,Qn(tt),Lt);if(tt.$$typeof===io)return rn(Me,le,Ce,wf(le,tt),Lt);Dn(le,tt)}return null}function aa(Me,le,Ce,tt){for(var Lt=null,Ei=null,Zt=le,Gn=le=0,Ji=null;Zt!==null&&Gn<Ce.length;Gn++){Zt.index>Gn?(Ji=Zt,Zt=null):Ji=Zt.sibling;var Mn=xt(Me,Zt,Ce[Gn],tt);if(Mn===null){Zt===null&&(Zt=Ji);break}h&&Zt&&Mn.alternate===null&&f(Me,Zt),le=U(Mn,le,Gn),Ei===null?Lt=Mn:Ei.sibling=Mn,Ei=Mn,Zt=Ji}if(Gn===Ce.length)return _(Me,Zt),Bn&&X(Me,Gn),Lt;if(Zt===null){for(;Gn<Ce.length;Gn++)Zt=vt(Me,Ce[Gn],tt),Zt!==null&&(le=U(Zt,le,Gn),Ei===null?Lt=Zt:Ei.sibling=Zt,Ei=Zt);return Bn&&X(Me,Gn),Lt}for(Zt=T(Zt);Gn<Ce.length;Gn++)Ji=rn(Zt,Me,Gn,Ce[Gn],tt),Ji!==null&&(h&&Ji.alternate!==null&&Zt.delete(Ji.key===null?Gn:Ji.key),le=U(Ji,le,Gn),Ei===null?Lt=Ji:Ei.sibling=Ji,Ei=Ji);return h&&Zt.forEach(function(Ho){return f(Me,Ho)}),Bn&&X(Me,Gn),Lt}function Mu(Me,le,Ce,tt){if(Ce==null)throw Error(i(151));for(var Lt=null,Ei=null,Zt=le,Gn=le=0,Ji=null,Mn=Ce.next();Zt!==null&&!Mn.done;Gn++,Mn=Ce.next()){Zt.index>Gn?(Ji=Zt,Zt=null):Ji=Zt.sibling;var Ho=xt(Me,Zt,Mn.value,tt);if(Ho===null){Zt===null&&(Zt=Ji);break}h&&Zt&&Ho.alternate===null&&f(Me,Zt),le=U(Ho,le,Gn),Ei===null?Lt=Ho:Ei.sibling=Ho,Ei=Ho,Zt=Ji}if(Mn.done)return _(Me,Zt),Bn&&X(Me,Gn),Lt;if(Zt===null){for(;!Mn.done;Gn++,Mn=Ce.next())Mn=vt(Me,Mn.value,tt),Mn!==null&&(le=U(Mn,le,Gn),Ei===null?Lt=Mn:Ei.sibling=Mn,Ei=Mn);return Bn&&X(Me,Gn),Lt}for(Zt=T(Zt);!Mn.done;Gn++,Mn=Ce.next())Mn=rn(Zt,Me,Gn,Mn.value,tt),Mn!==null&&(h&&Mn.alternate!==null&&Zt.delete(Mn.key===null?Gn:Mn.key),le=U(Mn,le,Gn),Ei===null?Lt=Mn:Ei.sibling=Mn,Ei=Mn);return h&&Zt.forEach(function(Rm){return f(Me,Rm)}),Bn&&X(Me,Gn),Lt}function Eu(Me,le,Ce,tt){if(typeof Ce=="object"&&Ce!==null&&Ce.type===lu&&Ce.key===null&&(Ce=Ce.props.children),typeof Ce=="object"&&Ce!==null){switch(Ce.$$typeof){case Wf:e:{for(var Lt=Ce.key;le!==null;){if(le.key===Lt){if(Lt=Ce.type,Lt===lu){if(le.tag===7){_(Me,le.sibling),tt=N(le,Ce.props.children),tt.return=Me,Me=tt;break e}}else if(le.elementType===Lt||typeof Lt=="object"&&Lt!==null&&Lt.$$typeof===Ma&&Mr(Lt)===le.type){_(Me,le.sibling),tt=N(le,Ce.props),Ci(tt,Ce),tt.return=Me,Me=tt;break e}_(Me,le);break}else f(Me,le);le=le.sibling}Ce.type===lu?(tt=Gi(Ce.props.children,Me.mode,tt,Ce.key),tt.return=Me,Me=tt):(tt=Co(Ce.type,Ce.key,Ce.props,null,Me.mode,tt),Ci(tt,Ce),tt.return=Me,Me=tt)}return W(Me);case Ta:e:{for(Lt=Ce.key;le!==null;){if(le.key===Lt)if(le.tag===4&&le.stateNode.containerInfo===Ce.containerInfo&&le.stateNode.implementation===Ce.implementation){_(Me,le.sibling),tt=N(le,Ce.children||[]),tt.return=Me,Me=tt;break e}else{_(Me,le);break}else f(Me,le);le=le.sibling}tt=Fy(Ce,Me.mode,tt),tt.return=Me,Me=tt}return W(Me);case Ma:return Lt=Ce._init,Ce=Lt(Ce._payload),Eu(Me,le,Ce,tt)}if(fh(Ce))return aa(Me,le,Ce,tt);if(s(Ce)){if(Lt=s(Ce),typeof Lt!="function")throw Error(i(150));return Ce=Lt.call(Ce),Mu(Me,le,Ce,tt)}if(typeof Ce.then=="function")return Eu(Me,le,Qn(Ce),tt);if(Ce.$$typeof===io)return Eu(Me,le,wf(Me,Ce),tt);Dn(Me,Ce)}return typeof Ce=="string"&&Ce!==""||typeof Ce=="number"||typeof Ce=="bigint"?(Ce=""+Ce,le!==null&&le.tag===6?(_(Me,le.sibling),tt=N(le,Ce),tt.return=Me,Me=tt):(_(Me,le),tt=Qp(Ce,Me.mode,tt),tt.return=Me,Me=tt),W(Me)):_(Me,le)}return function(Me,le,Ce,tt){try{vu=0;var Lt=Eu(Me,le,Ce,tt);return yu=null,Lt}catch(Zt){if(Zt===Mh)throw Zt;var Ei=t(29,Zt,null,Me.mode);return Ei.lanes=tt,Ei.return=Me,Ei}finally{}}}function ts(h,f){h=tr,C(Eh,h),C(mi,f),tr=h|f.baseLanes}function ps(){C(Eh,tr),C(mi,mi.current)}function Qs(){tr=Eh.current,M(mi),M(Eh)}function Er(h){var f=h.alternate;C(ys,ys.current&1),C($r,h),ci===null&&(f===null||mi.current!==null||f.memoizedState!==null)&&(ci=h)}function vf(h){if(h.tag===22){if(C(ys,ys.current),C($r,h),ci===null){var f=h.alternate;f!==null&&f.memoizedState!==null&&(ci=h)}}else Ka()}function Ka(){C(ys,ys.current),C($r,$r.current)}function or(h){M($r),ci===h&&(ci=null),M(ys)}function Qa(h){for(var f=h;f!==null;){if(f.tag===13){var _=f.memoizedState;if(_!==null&&(_=_.dehydrated,_===null||lm(_)||um(_)))return f}else if(f.tag===19&&f.memoizedProps.revealOrder!==void 0){if((f.flags&128)!==0)return f}else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===h)break;for(;f.sibling===null;){if(f.return===null||f.return===h)return null;f=f.return}f.sibling.return=f.return,f=f.sibling}return null}function ii(){throw Error(i(321))}function Ja(h,f){if(f===null)return!1;for(var _=0;_<f.length&&_<h.length;_++)if(!Lr(h[_],f[_]))return!1;return!0}function $a(h,f,_,T,N,U){return Ml=U,gn=f,f.memoizedState=null,f.updateQueue=null,f.lanes=0,jt.H=h===null||h.memoizedState===null?Su:mr,xu=!1,U=_(T,N),xu=!1,fc&&(U=il(f,_,T,N)),Xl(h),U}function Xl(h){jt.H=Hi;var f=Ht!==null&&Ht.next!==null;if(Ml=0,In=Ht=gn=null,Ca=!1,dc=0,ws=null,f)throw Error(i(300));h===null||hi||(h=h.dependencies,h!==null&&Cf(h)&&(hi=!0))}function il(h,f,_,T){gn=h;var N=0;do{if(fc&&(ws=null),dc=0,fc=!1,25<=N)throw Error(i(301));if(N+=1,In=Ht=null,h.updateQueue!=null){var U=h.updateQueue;U.lastEffect=null,U.events=null,U.stores=null,U.memoCache!=null&&(U.memoCache.index=0)}jt.H=ea,U=f(_,T)}while(fc);return U}function ns(){var h=jt.H,f=h.useState()[0];return f=typeof f.then=="function"?Ae(f):f,h=h.useState()[0],(Ht!==null?Ht.memoizedState:null)!==h&&(gn.flags|=1024),f}function qc(){var h=_m!==0;return _m=0,h}function Wc(h,f,_){f.updateQueue=h.updateQueue,f.flags&=-2053,h.lanes&=~_}function eo(h){if(Ca){for(h=h.memoizedState;h!==null;){var f=h.queue;f!==null&&(f.pending=null),h=h.next}Ca=!1}Ml=0,In=Ht=gn=null,fc=!1,dc=_m=0,ws=null}function q(){var h={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return In===null?gn.memoizedState=In=h:In=In.next=h,In}function he(){if(Ht===null){var h=gn.alternate;h=h!==null?h.memoizedState:null}else h=Ht.next;var f=In===null?gn.memoizedState:In.next;if(f!==null)In=f,Ht=h;else{if(h===null)throw gn.alternate===null?Error(i(467)):Error(i(310));Ht=h,h={memoizedState:Ht.memoizedState,baseState:Ht.baseState,baseQueue:Ht.baseQueue,queue:Ht.queue,next:null},In===null?gn.memoizedState=In=h:In=In.next=h}return In}function Ae(h){var f=dc;return dc+=1,ws===null&&(ws=[]),h=gt(ws,h,f),f=gn,(In===null?f.memoizedState:In.next)===null&&(f=f.alternate,jt.H=f===null||f.memoizedState===null?Su:mr),h}function Re(h){if(h!==null&&typeof h=="object"){if(typeof h.then=="function")return Ae(h);if(h.$$typeof===io)return Fs(h)}throw Error(i(438,String(h)))}function ye(h){var f=null,_=gn.updateQueue;if(_!==null&&(f=_.memoCache),f==null){var T=gn.alternate;T!==null&&(T=T.updateQueue,T!==null&&(T=T.memoCache,T!=null&&(f={data:T.data.map(function(N){return N.slice()}),index:0})))}if(f==null&&(f={data:[],index:0}),_===null&&(_=xm(),gn.updateQueue=_),_.memoCache=f,_=f.data[f.index],_===void 0)for(_=f.data[f.index]=Array(h),T=0;T<h;T++)_[T]=F0;return f.index++,_}function $e(h,f){return typeof f=="function"?f(h):f}function ut(h){var f=he();return dt(f,Ht,h)}function dt(h,f,_){var T=h.queue;if(T===null)throw Error(i(311));T.lastRenderedReducer=_;var N=h.baseQueue,U=T.pending;if(U!==null){if(N!==null){var W=N.next;N.next=U.next,U.next=W}f.baseQueue=N=U,T.pending=null}if(U=h.baseState,N===null)h.memoizedState=U;else{f=N.next;var te=W=null,xe=null,qe=f,st=!1;do{var vt=qe.lane&-536870913;if(vt!==qe.lane?(Nn&vt)===vt:(Ml&vt)===vt){var xt=qe.revertLane;if(xt===0)xe!==null&&(xe=xe.next={lane:0,revertLane:0,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null}),vt===Jr&&(st=!0);else if((Ml&xt)===xt){qe=qe.next,xt===Jr&&(st=!0);continue}else vt={lane:0,revertLane:qe.revertLane,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null},xe===null?(te=xe=vt,W=U):xe=xe.next=vt,gn.lanes|=xt,sa|=xt;vt=qe.action,xu&&_(U,vt),U=qe.hasEagerState?qe.eagerState:_(U,vt)}else xt={lane:vt,revertLane:qe.revertLane,action:qe.action,hasEagerState:qe.hasEagerState,eagerState:qe.eagerState,next:null},xe===null?(te=xe=xt,W=U):xe=xe.next=xt,gn.lanes|=vt,sa|=vt;qe=qe.next}while(qe!==null&&qe!==f);if(xe===null?W=U:xe.next=te,!Lr(U,h.memoizedState)&&(hi=!0,st&&(_=cc,_!==null)))throw _;h.memoizedState=U,h.baseState=W,h.baseQueue=xe,T.lastRenderedState=U}return N===null&&(T.lanes=0),[h.memoizedState,T.dispatch]}function bt(h){var f=he(),_=f.queue;if(_===null)throw Error(i(311));_.lastRenderedReducer=h;var T=_.dispatch,N=_.pending,U=f.memoizedState;if(N!==null){_.pending=null;var W=N=N.next;do U=h(U,W.action),W=W.next;while(W!==N);Lr(U,f.memoizedState)||(hi=!0),f.memoizedState=U,f.baseQueue===null&&(f.baseState=U),_.lastRenderedState=U}return[U,T]}function Wt(h,f,_){var T=gn,N=he(),U=Bn;if(U){if(_===void 0)throw Error(i(407));_=_()}else _=f();var W=!Lr((Ht||N).memoizedState,_);if(W&&(N.memoizedState=_,hi=!0),N=N.queue,uy(Sn.bind(null,T,N,h),[h]),N.getSnapshot!==f||W||In!==null&&In.memoizedState.tag&1){if(T.flags|=2048,lr(9,Ut.bind(null,T,N,_,f),{destroy:void 0},null),Xn===null)throw Error(i(349));U||(Ml&60)!==0||It(T,f,_)}return _}function It(h,f,_){h.flags|=16384,h={getSnapshot:f,value:_},f=gn.updateQueue,f===null?(f=xm(),gn.updateQueue=f,f.stores=[h]):(_=f.stores,_===null?f.stores=[h]:_.push(h))}function Ut(h,f,_,T){f.value=_,f.getSnapshot=T,Pn(f)&&wi(h)}function Sn(h,f,_){return _(function(){Pn(f)&&wi(h)})}function Pn(h){var f=h.getSnapshot;h=h.value;try{var _=f();return!Lr(h,_)}catch{return!0}}function wi(h){var f=Ge(h,2);f!==null&&Rs(f,h,2)}function Tn(h){var f=q();if(typeof h=="function"){var _=h;if(h=_(),xu){Q(!0);try{_()}finally{Q(!1)}}}return f.memoizedState=f.baseState=h,f.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:$e,lastRenderedState:h},f}function Rn(h,f,_,T){return h.baseState=_,dt(h,Ht,typeof T=="function"?T:$e)}function zt(h,f,_,T,N){if(Mf(h))throw Error(i(485));if(h=f.action,h!==null){var U={payload:N,action:h,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(W){U.listeners.push(W)}};jt.T!==null?_(!0):U.isTransition=!1,T(U),_=f.pending,_===null?(U.next=f.pending=U,Bi(f,U)):(U.next=_.next,f.pending=_.next=U)}}function Bi(h,f){var _=f.action,T=f.payload,N=h.state;if(f.isTransition){var U=jt.T,W={};jt.T=W;try{var te=_(N,T),xe=jt.S;xe!==null&&xe(W,te),Ln(h,f,te)}catch(qe){To(h,f,qe)}finally{jt.T=U}}else try{U=_(N,T),Ln(h,f,U)}catch(qe){To(h,f,qe)}}function Ln(h,f,_){_!==null&&typeof _=="object"&&typeof _.then=="function"?_.then(function(T){Os(h,f,T)},function(T){return To(h,f,T)}):Os(h,f,_)}function Os(h,f,_){f.status="fulfilled",f.value=_,li(f),h.state=_,f=h.pending,f!==null&&(_=f.next,_===f?h.pending=null:(_=_.next,f.next=_,Bi(h,_)))}function To(h,f,_){var T=h.pending;if(h.pending=null,T!==null){T=T.next;do f.status="rejected",f.reason=_,li(f),f=f.next;while(f!==T)}h.action=null}function li(h){h=h.listeners;for(var f=0;f<h.length;f++)(0,h[f])()}function Mo(h,f){return f}function si(h,f){if(Bn){var _=Xn.formState;if(_!==null){e:{var T=gn;if(Bn){if(qs){var N=tv(qs,Cs);if(N){qs=nv(N),T=ax(N);break e}}lt(T)}T=!1}T&&(f=_[0])}}_=q(),_.memoizedState=_.baseState=f,T={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Mo,lastRenderedState:f},_.queue=T,_=dy.bind(null,gn,T),T.dispatch=_,T=Tn(!1);var U=jc.bind(null,gn,!1,T.queue);return T=q(),N={state:f,dispatch:null,action:h,pending:null},T.queue=N,_=zt.bind(null,gn,N,U,_),N.dispatch=_,T.memoizedState=h,[f,_,!1]}function Ps(h){var f=he();return is(f,Ht,h)}function is(h,f,_){f=dt(h,f,Mo)[0],h=ut($e)[0],f=typeof f=="object"&&f!==null&&typeof f.then=="function"?Ae(f):f;var T=he(),N=T.queue,U=N.dispatch;return _!==T.memoizedState&&(gn.flags|=2048,lr(9,Ms.bind(null,N,_),{destroy:void 0},null)),[f,U,h]}function Ms(h,f){h.action=f}function Es(h){var f=he(),_=Ht;if(_!==null)return is(f,_,h);he(),f=f.memoizedState,_=he();var T=_.queue.dispatch;return _.memoizedState=h,[f,T,!1]}function lr(h,f,_,T){return h={tag:h,create:f,inst:_,deps:T,next:null},f=gn.updateQueue,f===null&&(f=xm(),gn.updateQueue=f),_=f.lastEffect,_===null?f.lastEffect=h.next=h:(T=_.next,_.next=h,h.next=T,f.lastEffect=h),h}function Eo(){return he().memoizedState}function _f(h,f,_,T){var N=q();gn.flags|=h,N.memoizedState=lr(1|f,_,{destroy:void 0},T===void 0?null:T)}function xf(h,f,_,T){var N=he();T=T===void 0?null:T;var U=N.memoizedState.inst;Ht!==null&&T!==null&&Ja(T,Ht.memoizedState.deps)?N.memoizedState=lr(f,_,U,T):(gn.flags|=h,N.memoizedState=lr(1|f,_,U,T))}function Dp(h,f){_f(8390656,8,h,f)}function uy(h,f){xf(2048,8,h,f)}function g0(h,f){return xf(4,2,h,f)}function Sf(h,f){return xf(4,4,h,f)}function Up(h,f){if(typeof f=="function"){h=h();var _=f(h);return function(){typeof _=="function"?_():f(null)}}if(f!=null)return h=h(),f.current=h,function(){f.current=null}}function Lp(h,f,_){_=_!=null?_.concat([h]):null,xf(4,4,Up.bind(null,f,h),_)}function Yl(){}function Zu(h,f){var _=he();f=f===void 0?null:f;var T=_.memoizedState;return f!==null&&Ja(f,T[1])?T[0]:(_.memoizedState=[h,f],h)}function cy(h,f){var _=he();f=f===void 0?null:f;var T=_.memoizedState;if(f!==null&&Ja(f,T[1]))return T[0];if(T=h(),xu){Q(!0);try{h()}finally{Q(!1)}}return _.memoizedState=[T,f],T}function bf(h,f,_){return _===void 0||(Ml&1073741824)!==0?h.memoizedState=f:(h.memoizedState=_,h=Uy(),gn.lanes|=h,sa|=h,_)}function hy(h,f,_,T){return Lr(_,f)?_:mi.current!==null?(h=bf(h,_,T),Lr(h,f)||(hi=!0),h):(Ml&42)===0?(hi=!0,h.memoizedState=_):(h=Uy(),gn.lanes|=h,sa|=h,f)}function Xc(h,f,_,T,N){var U=_l();$s(U!==0&&8>U?U:8);var W=jt.T,te={};jt.T=te,jc(h,!1,f,_);try{var xe=N(),qe=jt.S;if(qe!==null&&qe(te,xe),xe!==null&&typeof xe=="object"&&typeof xe.then=="function"){var st=xn(xe,T);jl(h,f,st,ji(h))}else jl(h,f,T,ji(h))}catch(vt){jl(h,f,{then:function(){},status:"rejected",reason:vt},ji())}finally{$s(U),jt.T=W}}function Ao(h){var f=h.memoizedState;if(f!==null)return f;f={memoizedState:cu,baseState:cu,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$e,lastRenderedState:cu},next:null};var _={};return f.next={memoizedState:_,baseState:_,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:$e,lastRenderedState:_},next:null},h.memoizedState=f,h=h.alternate,h!==null&&(h.memoizedState=f),f}function Tf(){return Fs(so)}function Yc(){return he().memoizedState}function sl(){return he().memoizedState}function fy(h){for(var f=h.return;f!==null;){switch(f.tag){case 24:case 3:var _=ji();h=Rt(_);var T=Nt(f,h,_);T!==null&&(Rs(T,f,_),ht(T,f,_)),f={cache:Jl()},h.payload=f;return}f=f.return}}function Bp(h,f,_){var T=ji();_={lane:T,revertLane:0,action:_,hasEagerState:!1,eagerState:null,next:null},Mf(h)?ur(f,_):(_=Ze(h,f,_,T),_!==null&&(Rs(_,h,T),Zl(_,f,T)))}function dy(h,f,_){var T=ji();jl(h,f,_,T)}function jl(h,f,_,T){var N={lane:T,revertLane:0,action:_,hasEagerState:!1,eagerState:null,next:null};if(Mf(h))ur(f,N);else{var U=h.alternate;if(h.lanes===0&&(U===null||U.lanes===0)&&(U=f.lastRenderedReducer,U!==null))try{var W=f.lastRenderedState,te=U(W,_);if(N.hasEagerState=!0,N.eagerState=te,Lr(te,W))return oi(h,f,N,0),Xn===null&&ne(),!1}catch{}finally{}if(_=Ze(h,f,N,T),_!==null)return Rs(_,h,T),Zl(_,f,T),!0}return!1}function jc(h,f,_,T){if(T={lane:2,revertLane:ct(),action:T,hasEagerState:!1,eagerState:null,next:null},Mf(h)){if(f)throw Error(i(479))}else f=Ze(h,_,T,2),f!==null&&Rs(f,h,2)}function Mf(h){var f=h.alternate;return h===gn||f!==null&&f===gn}function ur(h,f){fc=Ca=!0;var _=h.pending;_===null?f.next=f:(f.next=_.next,_.next=f),h.pending=f}function Zl(h,f,_){if((_&4194176)!==0){var T=f.lanes;T&=h.pendingLanes,_|=T,f.lanes=_,pe(h,_)}}function Zc(h,f,_,T){f=h.memoizedState,_=_(T,f),_=_==null?f:$p({},f,_),h.memoizedState=_,h.lanes===0&&(h.updateQueue.baseState=_)}function Kc(h,f,_,T,N,U,W){return h=h.stateNode,typeof h.shouldComponentUpdate=="function"?h.shouldComponentUpdate(T,U,W):f.prototype&&f.prototype.isPureReactComponent?!Ue(_,T)||!Ue(N,U):!0}function y0(h,f,_,T){h=f.state,typeof f.componentWillReceiveProps=="function"&&f.componentWillReceiveProps(_,T),typeof f.UNSAFE_componentWillReceiveProps=="function"&&f.UNSAFE_componentWillReceiveProps(_,T),f.state!==h&&Po.enqueueReplaceState(f,f.state,null)}function rl(h,f){var _=f;if("ref"in f){_={};for(var T in f)T!=="ref"&&(_[T]=f[T])}if(h=h.defaultProps){_===f&&(_=$p({},_));for(var N in h)_[N]===void 0&&(_[N]=h[N])}return _}function Qc(h,f){try{var _=h.onUncaughtError;_(f.value,{componentStack:f.stack})}catch(T){setTimeout(function(){throw T})}}function Jc(h,f,_){try{var T=h.onCaughtError;T(_.value,{componentStack:_.stack,errorBoundary:f.tag===1?f.stateNode:null})}catch(N){setTimeout(function(){throw N})}}function $c(h,f,_){return _=Rt(_),_.tag=3,_.payload={element:null},_.callback=function(){Qc(h,f)},_}function py(h){return h=Rt(h),h.tag=3,h}function v0(h,f,_,T){var N=_.type.getDerivedStateFromError;if(typeof N=="function"){var U=T.value;h.payload=function(){return N(U)},h.callback=function(){Jc(f,_,T)}}var W=_.stateNode;W!==null&&typeof W.componentDidCatch=="function"&&(h.callback=function(){Jc(f,_,T),typeof N!="function"&&(bu===null?bu=new Set([this]):bu.add(this));var te=T.stack;this.componentDidCatch(T.value,{componentStack:te!==null?te:""})})}function rM(h,f,_,T,N){if(_.flags|=32768,T!==null&&typeof T=="object"&&typeof T.then=="function"){if(f=_.alternate,f!==null&&Nf(f,_,N,!0),_=$r.current,_!==null){switch(_.tag){case 13:return ci===null?dl():_.alternate===null&&fi===0&&(fi=3),_.flags&=-257,_.flags|=65536,_.lanes=N,T===ad?_.flags|=16384:(f=_.updateQueue,f===null?_.updateQueue=new Set([T]):f.add(T),Ju(h,T,N)),!1;case 22:return _.flags|=65536,T===ad?_.flags|=16384:(f=_.updateQueue,f===null?(f={transitions:null,markerInstances:null,retryQueue:new Set([T])},_.updateQueue=f):(_=f.retryQueue,_===null?f.retryQueue=new Set([T]):_.add(T)),Ju(h,T,N)),!1}throw Error(i(435,_.tag))}return Ju(h,T,N),dl(),!1}if(Bn)return f=$r.current,f!==null?((f.flags&65536)===0&&(f.flags|=256),f.flags|=65536,f.lanes=N,T!==id&&(h=Error(i(422),{cause:T}),$t(ve(h,_)))):(T!==id&&(f=Error(i(423),{cause:T}),$t(ve(f,_))),h=h.current.alternate,h.flags|=65536,N&=-N,h.lanes|=N,T=ve(T,_),N=$c(h.stateNode,T,N),dn(h,N),fi!==4&&(fi=2)),!1;var U=Error(i(520),{cause:T});if(U=ve(U,_),mc===null?mc=[U]:mc.push(U),fi!==4&&(fi=2),f===null)return!0;T=ve(T,_),_=f;do{switch(_.tag){case 3:return _.flags|=65536,h=N&-N,_.lanes|=h,h=$c(_.stateNode,T,h),dn(_,h),!1;case 1:if(f=_.type,U=_.stateNode,(_.flags&128)===0&&(typeof f.getDerivedStateFromError=="function"||U!==null&&typeof U.componentDidCatch=="function"&&(bu===null||!bu.has(U))))return _.flags|=65536,N&=-N,_.lanes|=N,N=py(N),v0(N,h,_,T),dn(_,N),!1}_=_.return}while(_!==null);return!1}function Is(h,f,_,T){f.child=h===null?Oo(f,null,_,T):_u(f,h.child,_,T)}function Op(h,f,_,T,N){_=_.render;var U=f.ref;if("ref"in T){var W={};for(var te in T)te!=="ref"&&(W[te]=T[te])}else W=T;return Ql(f),T=$a(h,f,_,W,U,N),te=qc(),h!==null&&!hi?(Wc(h,f,N),al(h,f,N)):(Bn&&te&&we(f),f.flags|=1,Is(h,f,T,N),f.child)}function _0(h,f,_,T,N){if(h===null){var U=_.type;return typeof U=="function"&&!Gf(U)&&U.defaultProps===void 0&&_.compare===null?(f.tag=15,f.type=U,x0(h,f,U,T,N)):(h=Co(_.type,null,T,f,f.mode,N),h.ref=f.ref,h.return=f,f.child=h)}if(U=h.child,!_y(h,N)){var W=U.memoizedProps;if(_=_.compare,_=_!==null?_:Ue,_(W,T)&&h.ref===f.ref)return al(h,f,N)}return f.flags|=1,h=ba(U,T),h.ref=f.ref,h.return=f,f.child=h}function x0(h,f,_,T,N){if(h!==null){var U=h.memoizedProps;if(Ue(U,T)&&h.ref===f.ref)if(hi=!1,f.pendingProps=T=U,_y(h,N))(h.flags&131072)!==0&&(hi=!0);else return f.lanes=h.lanes,al(h,f,N)}return Pp(h,f,_,T,N)}function S0(h,f,_){var T=f.pendingProps,N=T.children,U=(f.stateNode._pendingVisibility&2)!==0,W=h!==null?h.memoizedState:null;if(Ef(h,f),T.mode==="hidden"||U){if((f.flags&128)!==0){if(T=W!==null?W.baseLanes|_:_,h!==null){for(N=f.child=h.child,U=0;N!==null;)U=U|N.lanes|N.childLanes,N=N.sibling;f.childLanes=U&~T}else f.childLanes=0,f.child=null;return b0(h,f,T,_)}if((_&536870912)!==0)f.memoizedState={baseLanes:0,cachePool:null},h!==null&&Fp(f,W!==null?W.cachePool:null),W!==null?ts(f,W):ps(),vf(f);else return f.lanes=f.childLanes=536870912,b0(h,f,W!==null?W.baseLanes|_:_,_)}else W!==null?(Fp(f,W.cachePool),ts(f,W),Ka(),f.memoizedState=null):(h!==null&&Fp(f,null),ps(),Ka());return Is(h,f,N,_),f.child}function b0(h,f,_,T){var N=Sy();return N=N===null?null:{parent:fr?gi._currentValue:gi._currentValue2,pool:N},f.memoizedState={baseLanes:_,cachePool:N},h!==null&&Fp(f,null),ps(),vf(f),h!==null&&Nf(h,f,T,!0),null}function Ef(h,f){var _=f.ref;if(_===null)h!==null&&h.ref!==null&&(f.flags|=2097664);else{if(typeof _!="function"&&typeof _!="object")throw Error(i(284));(h===null||h.ref!==_)&&(f.flags|=2097664)}}function Pp(h,f,_,T,N){return Ql(f),_=$a(h,f,_,T,void 0,N),T=qc(),h!==null&&!hi?(Wc(h,f,N),al(h,f,N)):(Bn&&T&&we(f),f.flags|=1,Is(h,f,_,N),f.child)}function T0(h,f,_,T,N,U){return Ql(f),f.updateQueue=null,_=il(f,T,_,N),Xl(h),T=qc(),h!==null&&!hi?(Wc(h,f,U),al(h,f,U)):(Bn&&T&&we(f),f.flags|=1,Is(h,f,_,U),f.child)}function M0(h,f,_,T,N){if(Ql(f),f.stateNode===null){var U=pu,W=_.contextType;typeof W=="object"&&W!==null&&(U=Fs(W)),U=new _(T,U),f.memoizedState=U.state!==null&&U.state!==void 0?U.state:null,U.updater=Po,f.stateNode=U,U._reactInternals=f,U=f.stateNode,U.props=T,U.state=f.memoizedState,U.refs={},et(f),W=_.contextType,U.context=typeof W=="object"&&W!==null?Fs(W):pu,U.state=f.memoizedState,W=_.getDerivedStateFromProps,typeof W=="function"&&(Zc(f,_,W,T),U.state=f.memoizedState),typeof _.getDerivedStateFromProps=="function"||typeof U.getSnapshotBeforeUpdate=="function"||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(W=U.state,typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount(),W!==U.state&&Po.enqueueReplaceState(U,U.state,null),zn(f,T,U,N),kt(),U.state=f.memoizedState),typeof U.componentDidMount=="function"&&(f.flags|=4194308),T=!0}else if(h===null){U=f.stateNode;var te=f.memoizedProps,xe=rl(_,te);U.props=xe;var qe=U.context,st=_.contextType;W=pu,typeof st=="object"&&st!==null&&(W=Fs(st));var vt=_.getDerivedStateFromProps;st=typeof vt=="function"||typeof U.getSnapshotBeforeUpdate=="function",te=f.pendingProps!==te,st||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(te||qe!==W)&&y0(f,U,T,W),Tl=!1;var xt=f.memoizedState;U.state=xt,zn(f,T,U,N),kt(),qe=f.memoizedState,te||xt!==qe||Tl?(typeof vt=="function"&&(Zc(f,_,vt,T),qe=f.memoizedState),(xe=Tl||Kc(f,_,xe,T,xt,qe,W))?(st||typeof U.UNSAFE_componentWillMount!="function"&&typeof U.componentWillMount!="function"||(typeof U.componentWillMount=="function"&&U.componentWillMount(),typeof U.UNSAFE_componentWillMount=="function"&&U.UNSAFE_componentWillMount()),typeof U.componentDidMount=="function"&&(f.flags|=4194308)):(typeof U.componentDidMount=="function"&&(f.flags|=4194308),f.memoizedProps=T,f.memoizedState=qe),U.props=T,U.state=qe,U.context=W,T=xe):(typeof U.componentDidMount=="function"&&(f.flags|=4194308),T=!1)}else{U=f.stateNode,St(h,f),W=f.memoizedProps,st=rl(_,W),U.props=st,vt=f.pendingProps,xt=U.context,qe=_.contextType,xe=pu,typeof qe=="object"&&qe!==null&&(xe=Fs(qe)),te=_.getDerivedStateFromProps,(qe=typeof te=="function"||typeof U.getSnapshotBeforeUpdate=="function")||typeof U.UNSAFE_componentWillReceiveProps!="function"&&typeof U.componentWillReceiveProps!="function"||(W!==vt||xt!==xe)&&y0(f,U,T,xe),Tl=!1,xt=f.memoizedState,U.state=xt,zn(f,T,U,N),kt();var rn=f.memoizedState;W!==vt||xt!==rn||Tl||h!==null&&h.dependencies!==null&&Cf(h.dependencies)?(typeof te=="function"&&(Zc(f,_,te,T),rn=f.memoizedState),(st=Tl||Kc(f,_,st,T,xt,rn,xe)||h!==null&&h.dependencies!==null&&Cf(h.dependencies))?(qe||typeof U.UNSAFE_componentWillUpdate!="function"&&typeof U.componentWillUpdate!="function"||(typeof U.componentWillUpdate=="function"&&U.componentWillUpdate(T,rn,xe),typeof U.UNSAFE_componentWillUpdate=="function"&&U.UNSAFE_componentWillUpdate(T,rn,xe)),typeof U.componentDidUpdate=="function"&&(f.flags|=4),typeof U.getSnapshotBeforeUpdate=="function"&&(f.flags|=1024)):(typeof U.componentDidUpdate!="function"||W===h.memoizedProps&&xt===h.memoizedState||(f.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||W===h.memoizedProps&&xt===h.memoizedState||(f.flags|=1024),f.memoizedProps=T,f.memoizedState=rn),U.props=T,U.state=rn,U.context=xe,T=st):(typeof U.componentDidUpdate!="function"||W===h.memoizedProps&&xt===h.memoizedState||(f.flags|=4),typeof U.getSnapshotBeforeUpdate!="function"||W===h.memoizedProps&&xt===h.memoizedState||(f.flags|=1024),T=!1)}return U=T,Ef(h,f),T=(f.flags&128)!==0,U||T?(U=f.stateNode,_=T&&typeof _.getDerivedStateFromError!="function"?null:U.render(),f.flags|=1,h!==null&&T?(f.child=_u(f,h.child,null,N),f.child=_u(f,null,_,N)):Is(h,f,_,N),f.memoizedState=U.state,h=f.child):h=al(h,f,N),h}function E0(h,f,_,T){return An(),f.flags|=256,Is(h,f,_,T),f.child}function my(h){return{baseLanes:h,cachePool:by()}}function Af(h,f,_){return h=h!==null?h.childLanes&~_:0,f&&(h|=ra),h}function A0(h,f,_){var T=f.pendingProps,N=!1,U=(f.flags&128)!==0,W;if((W=U)||(W=h!==null&&h.memoizedState===null?!1:(ys.current&2)!==0),W&&(N=!0,f.flags&=-129),W=(f.flags&32)!==0,f.flags&=-33,h===null){if(Bn){if(N?Er(f):Ka(),Bn){var te=qs,xe;(xe=te)&&(te=ux(te,Cs),te!==null?(f.memoizedState={dehydrated:te,treeContext:mu!==null?{id:ao,overflow:oo}:null,retryLane:536870912},xe=t(18,null,null,0),xe.stateNode=te,xe.return=f,f.child=xe,ks=f,qs=null,xe=!0):xe=!1),xe||lt(f)}if(te=f.memoizedState,te!==null&&(te=te.dehydrated,te!==null))return um(te)?f.lanes=16:f.lanes=536870912,null;or(f)}return te=T.children,T=T.fallback,N?(Ka(),N=f.mode,te=yy({mode:"hidden",children:te},N),T=Gi(T,N,_,null),te.return=f,T.return=f,te.sibling=T,f.child=te,N=f.child,N.memoizedState=my(_),N.childLanes=Af(h,W,_),f.memoizedState=Tm,T):(Er(f),gy(f,te))}if(xe=h.memoizedState,xe!==null&&(te=xe.dehydrated,te!==null)){if(U)f.flags&256?(Er(f),f.flags&=-257,f=Ip(h,f,_)):f.memoizedState!==null?(Ka(),f.child=h.child,f.flags|=128,f=null):(Ka(),N=T.fallback,te=f.mode,T=yy({mode:"visible",children:T.children},te),N=Gi(N,te,_,null),N.flags|=2,T.return=f,N.return=f,T.sibling=N,f.child=T,_u(f,h.child,null,_),T=f.child,T.memoizedState=my(_),T.childLanes=Af(h,W,_),f.memoizedState=Tm,f=N);else if(Er(f),um(te))W=sx(te).digest,T=Error(i(419)),T.stack="",T.digest=W,$t({value:T,source:null,stack:null}),f=Ip(h,f,_);else if(hi||Nf(h,f,_,!1),W=(_&h.childLanes)!==0,hi||W){if(W=Xn,W!==null){if(T=_&-_,(T&42)!==0)T=1;else switch(T){case 2:T=1;break;case 8:T=4;break;case 32:T=16;break;case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:T=64;break;case 268435456:T=134217728;break;default:T=0}if(T=(T&(W.suspendedLanes|_))!==0?0:T,T!==0&&T!==xe.retryLane)throw xe.retryLane=T,Ge(h,T),Rs(W,h,T),bm}lm(te)||dl(),f=Ip(h,f,_)}else lm(te)?(f.flags|=128,f.child=h.child,f=pl.bind(null,h),rx(te,f),f=null):(h=xe.treeContext,Hs&&(qs=lx(te),ks=f,Bn=!0,Ra=null,Cs=!1,h!==null&&(Kr[Qr++]=ao,Kr[Qr++]=oo,Kr[Qr++]=mu,ao=h.id,oo=h.overflow,mu=f)),f=gy(f,T.children),f.flags|=4096);return f}return N?(Ka(),N=T.fallback,te=f.mode,xe=h.child,U=xe.sibling,T=ba(xe,{mode:"hidden",children:T.children}),T.subtreeFlags=xe.subtreeFlags&31457280,U!==null?N=ba(U,N):(N=Gi(N,te,_,null),N.flags|=2),N.return=f,T.return=f,T.sibling=N,f.child=T,T=N,N=f.child,te=h.child.memoizedState,te===null?te=my(_):(xe=te.cachePool,xe!==null?(U=fr?gi._currentValue:gi._currentValue2,xe=xe.parent!==U?{parent:U,pool:U}:xe):xe=by(),te={baseLanes:te.baseLanes|_,cachePool:xe}),N.memoizedState=te,N.childLanes=Af(h,W,_),f.memoizedState=Tm,T):(Er(f),_=h.child,h=_.sibling,_=ba(_,{mode:"visible",children:T.children}),_.return=f,_.sibling=null,h!==null&&(W=f.deletions,W===null?(f.deletions=[h],f.flags|=16):W.push(h)),f.child=_,f.memoizedState=null,_)}function gy(h,f){return f=yy({mode:"visible",children:f},h.mode),f.return=h,h.child=f}function yy(h,f){return kf(h,f,0,null)}function Ip(h,f,_){return _u(f,h.child,null,_),h=gy(f,f.pendingProps.children),h.flags|=2,f.memoizedState=null,h}function R0(h,f,_){h.lanes|=f;var T=h.alternate;T!==null&&(T.lanes|=f),Rf(h.return,f,_)}function vy(h,f,_,T,N){var U=h.memoizedState;U===null?h.memoizedState={isBackwards:f,rendering:null,renderingStartTime:0,last:T,tail:_,tailMode:N}:(U.isBackwards=f,U.rendering=null,U.renderingStartTime=0,U.last=T,U.tail=_,U.tailMode=N)}function N0(h,f,_){var T=f.pendingProps,N=T.revealOrder,U=T.tail;if(Is(h,f,T.children,_),T=ys.current,(T&2)!==0)T=T&1|2,f.flags|=128;else{if(h!==null&&(h.flags&128)!==0)e:for(h=f.child;h!==null;){if(h.tag===13)h.memoizedState!==null&&R0(h,_,f);else if(h.tag===19)R0(h,_,f);else if(h.child!==null){h.child.return=h,h=h.child;continue}if(h===f)break e;for(;h.sibling===null;){if(h.return===null||h.return===f)break e;h=h.return}h.sibling.return=h.return,h=h.sibling}T&=1}switch(C(ys,T),N){case"forwards":for(_=f.child,N=null;_!==null;)h=_.alternate,h!==null&&Qa(h)===null&&(N=_),_=_.sibling;_=N,_===null?(N=f.child,f.child=null):(N=_.sibling,_.sibling=null),vy(f,!1,N,_,U);break;case"backwards":for(_=null,N=f.child,f.child=null;N!==null;){if(h=N.alternate,h!==null&&Qa(h)===null){f.child=N;break}h=N.sibling,N.sibling=_,_=N,N=h}vy(f,!0,_,null,U);break;case"together":vy(f,!1,null,null,void 0);break;default:f.memoizedState=null}return f.child}function al(h,f,_){if(h!==null&&(f.dependencies=h.dependencies),sa|=f.lanes,(_&f.childLanes)===0)if(h!==null){if(Nf(h,f,_,!1),(_&f.childLanes)===0)return null}else return null;if(h!==null&&f.child!==h.child)throw Error(i(153));if(f.child!==null){for(h=f.child,_=ba(h,h.pendingProps),f.child=_,_.return=f;h.sibling!==null;)h=h.sibling,_=_.sibling=ba(h,h.pendingProps),_.return=f;_.sibling=null}return f.child}function _y(h,f){return(h.lanes&f)!==0?!0:(h=h.dependencies,!!(h!==null&&Cf(h)))}function aM(h,f,_){switch(f.tag){case 3:oe(f,f.stateNode.containerInfo),Kl(f,gi,h.memoizedState.cache),An();break;case 27:case 5:je(f);break;case 4:oe(f,f.stateNode.containerInfo);break;case 10:Kl(f,f.type,f.memoizedProps.value);break;case 13:var T=f.memoizedState;if(T!==null)return T.dehydrated!==null?(Er(f),f.flags|=128,null):(_&f.child.childLanes)!==0?A0(h,f,_):(Er(f),h=al(h,f,_),h!==null?h.sibling:null);Er(f);break;case 19:var N=(h.flags&128)!==0;if(T=(_&f.childLanes)!==0,T||(Nf(h,f,_,!1),T=(_&f.childLanes)!==0),N){if(T)return N0(h,f,_);f.flags|=128}if(N=f.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),C(ys,ys.current),T)break;return null;case 22:case 23:return f.lanes=0,S0(h,f,_);case 24:Kl(f,gi,h.memoizedState.cache)}return al(h,f,_)}function C0(h,f,_){if(h!==null)if(h.memoizedProps!==f.pendingProps)hi=!0;else{if(!_y(h,_)&&(f.flags&128)===0)return hi=!1,aM(h,f,_);hi=(h.flags&131072)!==0}else hi=!1,Bn&&(f.flags&1048576)!==0&&re(f,xh,f.index);switch(f.lanes=0,f.tag){case 16:e:{h=f.pendingProps;var T=f.elementType,N=T._init;if(T=N(T._payload),f.type=T,typeof T=="function")Gf(T)?(h=rl(T,h),f.tag=1,f=M0(null,f,T,h,_)):(f.tag=0,f=Pp(null,f,T,h,_));else{if(T!=null){if(N=T.$$typeof,N===jf){f.tag=11,f=Op(null,f,T,h,_);break e}else if(N===nm){f.tag=14,f=_0(null,f,T,h,_);break e}}throw f=a(T)||T,Error(i(306,f,""))}}return f;case 0:return Pp(h,f,f.type,f.pendingProps,_);case 1:return T=f.type,N=rl(T,f.pendingProps),M0(h,f,T,N,_);case 3:e:{if(oe(f,f.stateNode.containerInfo),h===null)throw Error(i(387));var U=f.pendingProps;N=f.memoizedState,T=N.element,St(h,f),zn(f,U,null,_);var W=f.memoizedState;if(U=W.cache,Kl(f,gi,U),U!==N.cache&&Ku(f,[gi],_,!0),kt(),U=W.element,Hs&&N.isDehydrated)if(N={element:U,isDehydrated:!1,cache:W.cache},f.updateQueue.baseState=N,f.memoizedState=N,f.flags&256){f=E0(h,f,U,_);break e}else if(U!==T){T=ve(Error(i(424)),f),$t(T),f=E0(h,f,U,_);break e}else for(Hs&&(qs=ox(f.stateNode.containerInfo),ks=f,Bn=!0,Ra=null,Cs=!0),_=Oo(f,null,U,_),f.child=_;_;)_.flags=_.flags&-3|4096,_=_.sibling;else{if(An(),U===T){f=al(h,f,_);break e}Is(h,f,U,_)}f=f.child}return f;case 26:if(Zr)return Ef(h,f),h===null?(_=rv(f.type,null,f.pendingProps,null))?f.memoizedState=_:Bn||(f.stateNode=pm(f.type,f.pendingProps,Lo.current,f)):f.memoizedState=rv(f.type,h.memoizedProps,f.pendingProps,h.memoizedState),null;case 27:if(ui)return je(f),h===null&&ui&&Bn&&(T=f.stateNode=ro(f.type,f.pendingProps,Lo.current,gs.current,!1),ks=f,Cs=!0,qs=cm(T)),T=f.pendingProps.children,h!==null||Bn?Is(h,f,T,_):f.child=_u(f,null,T,_),Ef(h,f),f.child;case 5:return h===null&&Bn&&(fm(f.type,f.pendingProps,gs.current),(N=T=qs)&&(T=dM(T,f.type,f.pendingProps,Cs),T!==null?(f.stateNode=T,ks=f,qs=cm(T),Cs=!1,N=!0):N=!1),N||lt(f)),je(f),N=f.type,U=f.pendingProps,W=h!==null?h.memoizedProps:null,T=U.children,cn(N,U)?T=null:W!==null&&cn(N,W)&&(f.flags|=32),f.memoizedState!==null&&(N=$a(h,f,ns,null,null,_),fr?so._currentValue=N:so._currentValue2=N),Ef(h,f),Is(h,f,T,_),f.child;case 6:return h===null&&Bn&&(px(f.pendingProps,gs.current),(h=_=qs)&&(_=iv(_,f.pendingProps,Cs),_!==null?(f.stateNode=_,ks=f,qs=null,h=!0):h=!1),h||lt(f)),null;case 13:return A0(h,f,_);case 4:return oe(f,f.stateNode.containerInfo),T=f.pendingProps,h===null?f.child=_u(f,null,T,_):Is(h,f,T,_),f.child;case 11:return Op(h,f,f.type,f.pendingProps,_);case 7:return Is(h,f,f.pendingProps,_),f.child;case 8:return Is(h,f,f.pendingProps.children,_),f.child;case 12:return Is(h,f,f.pendingProps.children,_),f.child;case 10:return T=f.pendingProps,Kl(f,f.type,T.value),Is(h,f,T.children,_),f.child;case 9:return N=f.type._context,T=f.pendingProps.children,Ql(f),N=Fs(N),T=T(N),f.flags|=1,Is(h,f,T,_),f.child;case 14:return _0(h,f,f.type,f.pendingProps,_);case 15:return x0(h,f,f.type,f.pendingProps,_);case 19:return N0(h,f,_);case 22:return S0(h,f,_);case 24:return Ql(f),T=Fs(gi),h===null?(N=Sy(),N===null&&(N=Xn,U=Jl(),N.pooledCache=U,U.refCount++,U!==null&&(N.pooledCacheLanes|=_),N=U),f.memoizedState={parent:T,cache:N},et(f),Kl(f,gi,N)):((h.lanes&_)!==0&&(St(h,f),zn(f,null,null,_),kt()),N=h.memoizedState,U=f.memoizedState,N.parent!==T?(N={parent:T,cache:T},f.memoizedState=N,f.lanes===0&&(f.memoizedState=f.updateQueue.baseState=N),Kl(f,gi,T)):(T=U.cache,Kl(f,gi,T),T!==N.cache&&Ku(f,[gi],_,!0))),Is(h,f,f.pendingProps.children,_),f.child;case 29:throw f.pendingProps}throw Error(i(156,f.tag))}function Kl(h,f,_){fr?(C(El,f._currentValue),f._currentValue=_):(C(El,f._currentValue2),f._currentValue2=_)}function ol(h){var f=El.current;fr?h._currentValue=f:h._currentValue2=f,M(El)}function Rf(h,f,_){for(;h!==null;){var T=h.alternate;if((h.childLanes&f)!==f?(h.childLanes|=f,T!==null&&(T.childLanes|=f)):T!==null&&(T.childLanes&f)!==f&&(T.childLanes|=f),h===_)break;h=h.return}}function Ku(h,f,_,T){var N=h.child;for(N!==null&&(N.return=h);N!==null;){var U=N.dependencies;if(U!==null){var W=N.child;U=U.firstContext;e:for(;U!==null;){var te=U;U=N;for(var xe=0;xe<f.length;xe++)if(te.context===f[xe]){U.lanes|=_,te=U.alternate,te!==null&&(te.lanes|=_),Rf(U.return,_,h),T||(W=null);break e}U=te.next}}else if(N.tag===18){if(W=N.return,W===null)throw Error(i(341));W.lanes|=_,U=W.alternate,U!==null&&(U.lanes|=_),Rf(W,_,h),W=null}else W=N.child;if(W!==null)W.return=N;else for(W=N;W!==null;){if(W===h){W=null;break}if(N=W.sibling,N!==null){N.return=W.return,W=N;break}W=W.return}N=W}}function Nf(h,f,_,T){h=null;for(var N=f,U=!1;N!==null;){if(!U){if((N.flags&524288)!==0)U=!0;else if((N.flags&262144)!==0)break}if(N.tag===10){var W=N.alternate;if(W===null)throw Error(i(387));if(W=W.memoizedProps,W!==null){var te=N.type;Lr(N.pendingProps.value,W.value)||(h!==null?h.push(te):h=[te])}}else if(N===ac.current){if(W=N.alternate,W===null)throw Error(i(387));W.memoizedState.memoizedState!==N.memoizedState.memoizedState&&(h!==null?h.push(so):h=[so])}N=N.return}h!==null&&Ku(f,h,_,T),f.flags|=262144}function Cf(h){for(h=h.firstContext;h!==null;){var f=h.context;if(!Lr(fr?f._currentValue:f._currentValue2,h.memoizedValue))return!0;h=h.next}return!1}function Ql(h){co=h,ta=null,h=h.dependencies,h!==null&&(h.firstContext=null)}function Fs(h){return xy(co,h)}function wf(h,f){return co===null&&Ql(h),xy(h,f)}function xy(h,f){var _=fr?f._currentValue:f._currentValue2;if(f={context:f,memoizedValue:_,next:null},ta===null){if(h===null)throw Error(i(308));ta=f,h.dependencies={lanes:0,firstContext:f},h.flags|=524288}else ta=ta.next=f;return _}function Jl(){return{controller:new Ah,data:new Map,refCount:0}}function Df(h){h.refCount--,h.refCount===0&&Ex(Ax,function(){h.controller.abort()})}function Sy(){var h=Io.current;return h!==null?h:Xn.pooledCache}function Fp(h,f){f===null?C(Io,Io.current):C(Io,f.pool)}function by(){var h=Sy();return h===null?null:{parent:fr?gi._currentValue:gi._currentValue2,pool:h}}function Ar(h){h.flags|=4}function eh(h,f){if(h!==null&&h.child===f.child)return!1;if((f.flags&16)!==0)return!0;for(h=f.child;h!==null;){if((h.flags&13878)!==0||(h.subtreeFlags&13878)!==0)return!0;h=h.sibling}return!1}function Qu(h,f,_,T){if(ms)for(_=f.child;_!==null;){if(_.tag===5||_.tag===6)Kf(h,_.stateNode);else if(!(_.tag===4||ui&&_.tag===27)&&_.child!==null){_.child.return=_,_=_.child;continue}if(_===f)break;for(;_.sibling===null;){if(_.return===null||_.return===f)return;_=_.return}_.sibling.return=_.return,_=_.sibling}else if(Ea)for(var N=f.child;N!==null;){if(N.tag===5){var U=N.stateNode;_&&T&&(U=$y(U,N.type,N.memoizedProps)),Kf(h,U)}else if(N.tag===6)U=N.stateNode,_&&T&&(U=ev(U,N.memoizedProps)),Kf(h,U);else if(N.tag!==4){if(N.tag===22&&N.memoizedState!==null)U=N.child,U!==null&&(U.return=N),Qu(h,N,!0,!0);else if(N.child!==null){N.child.return=N,N=N.child;continue}}if(N===f)break;for(;N.sibling===null;){if(N.return===null||N.return===f)return;N=N.return}N.sibling.return=N.return,N=N.sibling}}function w0(h,f,_,T){if(Ea)for(var N=f.child;N!==null;){if(N.tag===5){var U=N.stateNode;_&&T&&(U=$y(U,N.type,N.memoizedProps)),Jy(h,U)}else if(N.tag===6)U=N.stateNode,_&&T&&(U=ev(U,N.memoizedProps)),Jy(h,U);else if(N.tag!==4){if(N.tag===22&&N.memoizedState!==null)U=N.child,U!==null&&(U.return=N),w0(h,N,!(N.memoizedProps!==null&&N.memoizedProps.mode==="manual"),!0);else if(N.child!==null){N.child.return=N,N=N.child;continue}}if(N===f)break;for(;N.sibling===null;){if(N.return===null||N.return===f)return;N=N.return}N.sibling.return=N.return,N=N.sibling}}function Uf(h,f){if(Ea&&eh(h,f)){h=f.stateNode;var _=h.containerInfo,T=Qf();w0(T,f,!1,!1),h.pendingChildren=T,Ar(f),om(_,T)}}function zp(h,f,_,T){if(ms)h.memoizedProps!==T&&Ar(f);else if(Ea){var N=h.stateNode,U=h.memoizedProps;if((h=eh(h,f))||U!==T){var W=gs.current;U=yh(N,_,U,T,!h,null),U===N?f.stateNode=N:(vl(U,_,T,W)&&Ar(f),f.stateNode=U,h?Qu(U,f,!1,!1):Ar(f))}else f.stateNode=N}}function Vp(h,f,_){if(qy(f,_)){if(h.flags|=16777216,!rm(f,_))if(su())h.flags|=8192;else throw gu=ad,rd}else h.flags&=-16777217}function Gp(h,f){if(yx(f)){if(h.flags|=16777216,!tc(f))if(su())h.flags|=8192;else throw gu=ad,rd}else h.flags&=-16777217}function th(h,f){f!==null&&(h.flags|=4),h.flags&16384&&(f=h.tag!==22?I():536870912,h.lanes|=f,Vo|=f)}function nh(h,f){if(!Bn)switch(h.tailMode){case"hidden":f=h.tail;for(var _=null;f!==null;)f.alternate!==null&&(_=f),f=f.sibling;_===null?h.tail=null:_.sibling=null;break;case"collapsed":_=h.tail;for(var T=null;_!==null;)_.alternate!==null&&(T=_),_=_.sibling;T===null?f||h.tail===null?h.tail=null:h.tail.sibling=null:T.sibling=null}}function Di(h){var f=h.alternate!==null&&h.alternate.child===h.child,_=0,T=0;if(f)for(var N=h.child;N!==null;)_|=N.lanes|N.childLanes,T|=N.subtreeFlags&31457280,T|=N.flags&31457280,N.return=h,N=N.sibling;else for(N=h.child;N!==null;)_|=N.lanes|N.childLanes,T|=N.subtreeFlags,T|=N.flags,N.return=h,N=N.sibling;return h.subtreeFlags|=T,h.childLanes=_,f}function D0(h,f,_){var T=f.pendingProps;switch(Fe(f),f.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Di(f),null;case 1:return Di(f),null;case 3:return _=f.stateNode,T=null,h!==null&&(T=h.memoizedState.cache),f.memoizedState.cache!==T&&(f.flags|=2048),ol(gi),De(),_.pendingContext&&(_.context=_.pendingContext,_.pendingContext=null),(h===null||h.child===null)&&(mn(f)?Ar(f):h===null||h.memoizedState.isDehydrated&&(f.flags&256)===0||(f.flags|=1024,Ra!==null&&(zf(Ra),Ra=null))),Uf(h,f),Di(f),null;case 26:if(Zr){_=f.type;var N=f.memoizedState;return h===null?(Ar(f),N!==null?(Di(f),Gp(f,N)):(Di(f),Vp(f,_,T))):N?N!==h.memoizedState?(Ar(f),Di(f),Gp(f,N)):(Di(f),f.flags&=-16777217):(ms?h.memoizedProps!==T&&Ar(f):zp(h,f,_,T),Di(f),Vp(f,_,T)),null}case 27:if(ui){if(nt(f),_=Lo.current,N=f.type,h!==null&&f.stateNode!=null)ms?h.memoizedProps!==T&&Ar(f):zp(h,f,N,T);else{if(!T){if(f.stateNode===null)throw Error(i(166));return Di(f),null}h=gs.current,mn(f)?nn(f,h):(h=ro(N,T,_,h,!0),f.stateNode=h,Ar(f))}return Di(f),null}case 5:if(nt(f),_=f.type,h!==null&&f.stateNode!=null)zp(h,f,_,T);else{if(!T){if(f.stateNode===null)throw Error(i(166));return Di(f),null}h=gs.current,mn(f)?nn(f,h):(N=ky(_,T,Lo.current,h,f),Qu(N,f,!1,!1),f.stateNode=N,vl(N,_,T,h)&&Ar(f))}return Di(f),Vp(f,f.type,f.pendingProps),null;case 6:if(h&&f.stateNode!=null)_=h.memoizedProps,ms?_!==T&&Ar(f):Ea&&(_!==T?(f.stateNode=Jn(T,Lo.current,gs.current,f),Ar(f)):f.stateNode=h.stateNode);else{if(typeof T!="string"&&f.stateNode===null)throw Error(i(166));if(h=Lo.current,_=gs.current,mn(f)){if(!Hs)throw Error(i(176));if(h=f.stateNode,_=f.memoizedProps,T=null,N=ks,N!==null)switch(N.tag){case 27:case 5:T=N.memoizedProps}sv(h,_,f,T)||lt(f)}else f.stateNode=Jn(T,h,_,f)}return Di(f),null;case 13:if(T=f.memoizedState,h===null||h.memoizedState!==null&&h.memoizedState.dehydrated!==null){if(N=mn(f),T!==null&&T.dehydrated!==null){if(h===null){if(!N)throw Error(i(318));if(!Hs)throw Error(i(344));if(N=f.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(i(317));hx(N,f)}else An(),(f.flags&128)===0&&(f.memoizedState=null),f.flags|=4;Di(f),N=!1}else Ra!==null&&(zf(Ra),Ra=null),N=!0;if(!N)return f.flags&256?(or(f),f):(or(f),null)}if(or(f),(f.flags&128)!==0)return f.lanes=_,f;if(_=T!==null,h=h!==null&&h.memoizedState!==null,_){T=f.child,N=null,T.alternate!==null&&T.alternate.memoizedState!==null&&T.alternate.memoizedState.cachePool!==null&&(N=T.alternate.memoizedState.cachePool.pool);var U=null;T.memoizedState!==null&&T.memoizedState.cachePool!==null&&(U=T.memoizedState.cachePool.pool),U!==N&&(T.flags|=2048)}return _!==h&&_&&(f.child.flags|=8192),th(f,f.updateQueue),Di(f),null;case 4:return De(),Uf(h,f),h===null&&Zi(f.stateNode.containerInfo),Di(f),null;case 10:return ol(f.type),Di(f),null;case 19:if(M(ys),N=f.memoizedState,N===null)return Di(f),null;if(T=(f.flags&128)!==0,U=N.rendering,U===null)if(T)nh(N,!1);else{if(fi!==0||h!==null&&(h.flags&128)!==0)for(h=f.child;h!==null;){if(U=Qa(h),U!==null){for(f.flags|=128,nh(N,!1),h=U.updateQueue,f.updateQueue=h,th(f,h),f.subtreeFlags=0,h=_,_=f.child;_!==null;)Hf(_,h),_=_.sibling;return C(ys,ys.current&1|2),f.child}h=h.sibling}N.tail!==null&&Aa()>Ch&&(f.flags|=128,T=!0,nh(N,!1),f.lanes=4194304)}else{if(!T)if(h=Qa(U),h!==null){if(f.flags|=128,T=!0,h=h.updateQueue,f.updateQueue=h,th(f,h),nh(N,!0),N.tail===null&&N.tailMode==="hidden"&&!U.alternate&&!Bn)return Di(f),null}else 2*Aa()-N.renderingStartTime>Ch&&_!==536870912&&(f.flags|=128,T=!0,nh(N,!1),f.lanes=4194304);N.isBackwards?(U.sibling=f.child,f.child=U):(h=N.last,h!==null?h.sibling=U:f.child=U,N.last=U)}return N.tail!==null?(f=N.tail,N.rendering=f,N.tail=f.sibling,N.renderingStartTime=Aa(),f.sibling=null,h=ys.current,C(ys,T?h&1|2:h&1),f):(Di(f),null);case 22:case 23:return or(f),Qs(),T=f.memoizedState!==null,h!==null?h.memoizedState!==null!==T&&(f.flags|=8192):T&&(f.flags|=8192),T?(_&536870912)!==0&&(f.flags&128)===0&&(Di(f),f.subtreeFlags&6&&(f.flags|=8192)):Di(f),_=f.updateQueue,_!==null&&th(f,_.retryQueue),_=null,h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(_=h.memoizedState.cachePool.pool),T=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(T=f.memoizedState.cachePool.pool),T!==_&&(f.flags|=2048),h!==null&&M(Io),null;case 24:return _=null,h!==null&&(_=h.memoizedState.cache),f.memoizedState.cache!==_&&(f.flags|=2048),ol(gi),Di(f),null;case 25:return null}throw Error(i(156,f.tag))}function oM(h,f){switch(Fe(f),f.tag){case 1:return h=f.flags,h&65536?(f.flags=h&-65537|128,f):null;case 3:return ol(gi),De(),h=f.flags,(h&65536)!==0&&(h&128)===0?(f.flags=h&-65537|128,f):null;case 26:case 27:case 5:return nt(f),null;case 13:if(or(f),h=f.memoizedState,h!==null&&h.dehydrated!==null){if(f.alternate===null)throw Error(i(340));An()}return h=f.flags,h&65536?(f.flags=h&-65537|128,f):null;case 19:return M(ys),null;case 4:return De(),null;case 10:return ol(f.type),null;case 22:case 23:return or(f),Qs(),h!==null&&M(Io),h=f.flags,h&65536?(f.flags=h&-65537|128,f):null;case 24:return ol(gi),null;case 25:return null;default:return null}}function U0(h,f){switch(Fe(f),f.tag){case 3:ol(gi),De();break;case 26:case 27:case 5:nt(f);break;case 4:De();break;case 13:or(f);break;case 19:M(ys);break;case 10:ol(f.type);break;case 22:case 23:or(f),Qs(),h!==null&&M(Io);break;case 24:ol(gi)}}function Lf(h,f){try{var _=f.updateQueue,T=_!==null?_.lastEffect:null;if(T!==null){var N=T.next;_=N;do{if((_.tag&h)===h){T=void 0;var U=_.create,W=_.inst;T=U(),W.destroy=T}_=_.next}while(_!==N)}}catch(te){qn(f,f.return,te)}}function $l(h,f,_){try{var T=f.updateQueue,N=T!==null?T.lastEffect:null;if(N!==null){var U=N.next;T=U;do{if((T.tag&h)===h){var W=T.inst,te=W.destroy;if(te!==void 0){W.destroy=void 0,N=f;var xe=_;try{te()}catch(qe){qn(N,xe,qe)}}}T=T.next}while(T!==U)}}catch(qe){qn(f,f.return,qe)}}function L0(h){var f=h.updateQueue;if(f!==null){var _=h.stateNode;try{mt(f,_)}catch(T){qn(h,h.return,T)}}}function Rr(h,f,_){_.props=rl(h.type,h.memoizedProps),_.state=h.memoizedState;try{_.componentWillUnmount()}catch(T){qn(h,f,T)}}function to(h,f){try{var _=h.ref;if(_!==null){var T=h.stateNode;switch(h.tag){case 26:case 27:case 5:var N=ph(T);break;default:N=T}typeof _=="function"?h.refCleanup=_(N):_.current=N}}catch(U){qn(h,f,U)}}function Nr(h,f){var _=h.ref,T=h.refCleanup;if(_!==null)if(typeof T=="function")try{T()}catch(N){qn(h,f,N)}finally{h.refCleanup=null,h=h.alternate,h!=null&&(h.refCleanup=null)}else if(typeof _=="function")try{_(null)}catch(N){qn(h,f,N)}else _.current=null}function Ty(h){var f=h.type,_=h.memoizedProps,T=h.stateNode;try{hM(T,f,_,h)}catch(N){qn(h,h.return,N)}}function My(h,f,_){try{K0(h.stateNode,h.type,_,f,h)}catch(T){qn(h,h.return,T)}}function Ey(h){return h.tag===5||h.tag===3||(Zr?h.tag===26:!1)||(ui?h.tag===27:!1)||h.tag===4}function Bf(h){e:for(;;){for(;h.sibling===null;){if(h.return===null||Ey(h.return))return null;h=h.return}for(h.sibling.return=h.return,h=h.sibling;h.tag!==5&&h.tag!==6&&(!ui||h.tag!==27)&&h.tag!==18;){if(h.flags&2||h.child===null||h.tag===4)continue e;h.child.return=h,h=h.child}if(!(h.flags&2))return h.stateNode}}function Ay(h,f,_){var T=h.tag;if(T===5||T===6)h=h.stateNode,f?J0(_,h,f):Zy(_,h);else if(!(T===4||ui&&T===27)&&(h=h.child,h!==null))for(Ay(h,f,_),h=h.sibling;h!==null;)Ay(h,f,_),h=h.sibling}function ll(h,f,_){var T=h.tag;if(T===5||T===6)h=h.stateNode,f?Q0(_,h,f):j0(_,h);else if(!(T===4||ui&&T===27)&&(h=h.child,h!==null))for(ll(h,f,_),h=h.sibling;h!==null;)ll(h,f,_),h=h.sibling}function Hp(h,f,_){h=h.containerInfo;try{vh(h,_)}catch(T){qn(f,f.return,T)}}function Of(h,f){for(im(h.containerInfo),sn=f;sn!==null;)if(h=sn,f=h.child,(h.subtreeFlags&1028)!==0&&f!==null)f.return=h,sn=f;else for(;sn!==null;){h=sn;var _=h.alternate;switch(f=h.flags,h.tag){case 0:break;case 11:case 15:break;case 1:if((f&1024)!==0&&_!==null){f=void 0;var T=h,N=_.memoizedProps;_=_.memoizedState;var U=T.stateNode;try{var W=rl(T.type,N,T.elementType===T.type);f=U.getSnapshotBeforeUpdate(W,_),U.__reactInternalSnapshotBeforeUpdate=f}catch(te){qn(T,T.return,te)}}break;case 3:(f&1024)!==0&&ms&&ix(h.stateNode.containerInfo);break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((f&1024)!==0)throw Error(i(163))}if(f=h.sibling,f!==null){f.return=h.return,sn=f;break}sn=h.return}return W=bn,bn=!1,W}function kp(h,f,_){var T=_.flags;switch(_.tag){case 0:case 11:case 15:cl(h,_),T&4&&Lf(5,_);break;case 1:if(cl(h,_),T&4)if(h=_.stateNode,f===null)try{h.componentDidMount()}catch(te){qn(_,_.return,te)}else{var N=rl(_.type,f.memoizedProps);f=f.memoizedState;try{h.componentDidUpdate(N,f,h.__reactInternalSnapshotBeforeUpdate)}catch(te){qn(_,_.return,te)}}T&64&&L0(_),T&512&&to(_,_.return);break;case 3:if(cl(h,_),T&64&&(T=_.updateQueue,T!==null)){if(h=null,_.child!==null)switch(_.child.tag){case 27:case 5:h=ph(_.child.stateNode);break;case 1:h=_.child.stateNode}try{mt(T,h)}catch(te){qn(_,_.return,te)}}break;case 26:if(Zr){cl(h,_),T&512&&to(_,_.return);break}case 27:case 5:cl(h,_),f===null&&T&4&&Ty(_),T&512&&to(_,_.return);break;case 12:cl(h,_);break;case 13:cl(h,_),T&4&&qp(h,_);break;case 22:if(N=_.memoizedState!==null||Fo,!N){f=f!==null&&f.memoizedState!==null||ki;var U=Fo,W=ki;Fo=N,(ki=f)&&!W?hl(h,_,(_.subtreeFlags&8772)!==0):cl(h,_),Fo=U,ki=W}T&512&&(_.memoizedProps.mode==="manual"?to(_,_.return):Nr(_,_.return));break;default:cl(h,_)}}function Ry(h){var f=h.alternate;f!==null&&(h.alternate=null,Ry(f)),h.child=null,h.deletions=null,h.sibling=null,h.tag===5&&(f=h.stateNode,f!==null&&cM(f)),h.stateNode=null,h.return=null,h.dependencies=null,h.memoizedProps=null,h.memoizedState=null,h.pendingProps=null,h.stateNode=null,h.updateQueue=null}function zs(h,f,_){for(_=_.child;_!==null;)eu(h,f,_),_=_.sibling}function eu(h,f,_){if(Ur&&typeof Ur.onCommitFiberUnmount=="function")try{Ur.onCommitFiberUnmount(Qi,_)}catch{}switch(_.tag){case 26:if(Zr){ki||Nr(_,f),zs(h,f,_),_.memoizedState?ec(_.memoizedState):_.stateNode&&_h(_.stateNode);break}case 27:if(ui){ki||Nr(_,f);var T=Vt,N=pn;Vt=_.stateNode,zs(h,f,_),du(_.stateNode),Vt=T,pn=N;break}case 5:ki||Nr(_,f);case 6:if(ms){if(T=Vt,N=pn,Vt=null,zs(h,f,_),Vt=T,pn=N,Vt!==null)if(pn)try{$0(Vt,_.stateNode)}catch(U){qn(_,f,U)}else try{Ky(Vt,_.stateNode)}catch(U){qn(_,f,U)}}else zs(h,f,_);break;case 18:ms&&Vt!==null&&(pn?Jf(Vt,_.stateNode):dx(Vt,_.stateNode));break;case 4:ms?(T=Vt,N=pn,Vt=_.stateNode.containerInfo,pn=!0,zs(h,f,_),Vt=T,pn=N):(Ea&&Hp(_.stateNode,_,Qf()),zs(h,f,_));break;case 0:case 11:case 14:case 15:ki||$l(2,_,f),ki||$l(4,_,f),zs(h,f,_);break;case 1:ki||(Nr(_,f),T=_.stateNode,typeof T.componentWillUnmount=="function"&&Rr(_,f,T)),zs(h,f,_);break;case 21:zs(h,f,_);break;case 22:ki||Nr(_,f),ki=(T=ki)||_.memoizedState!==null,zs(h,f,_),ki=T;break;default:zs(h,f,_)}}function qp(h,f){if(Hs&&f.memoizedState===null&&(h=f.alternate,h!==null&&(h=h.memoizedState,h!==null&&(h=h.dehydrated,h!==null))))try{mM(h)}catch(_){qn(f,f.return,_)}}function B0(h){switch(h.tag){case 13:case 19:var f=h.stateNode;return f===null&&(f=h.stateNode=new Wn),f;case 22:return h=h.stateNode,f=h._retryCache,f===null&&(f=h._retryCache=new Wn),f;default:throw Error(i(435,h.tag))}}function ul(h,f){var _=B0(h);f.forEach(function(T){var N=ou.bind(null,h,T);_.has(T)||(_.add(T),T.then(N,N))})}function cr(h,f){var _=f.deletions;if(_!==null)for(var T=0;T<_.length;T++){var N=_[T],U=h,W=f;if(ms){var te=W;e:for(;te!==null;){switch(te.tag){case 27:case 5:Vt=te.stateNode,pn=!1;break e;case 3:Vt=te.stateNode.containerInfo,pn=!0;break e;case 4:Vt=te.stateNode.containerInfo,pn=!0;break e}te=te.return}if(Vt===null)throw Error(i(160));eu(U,W,N),Vt=null,pn=!1}else eu(U,W,N);U=N.alternate,U!==null&&(U.return=null),N.return=null}if(f.subtreeFlags&13878)for(f=f.child;f!==null;)Ny(f,h),f=f.sibling}function Ny(h,f){var _=h.alternate,T=h.flags;switch(h.tag){case 0:case 11:case 14:case 15:cr(f,h),Cr(h),T&4&&($l(3,h,h.return),Lf(3,h),$l(5,h,h.return));break;case 1:cr(f,h),Cr(h),T&512&&(ki||_===null||Nr(_,_.return)),T&64&&Fo&&(h=h.updateQueue,h!==null&&(T=h.callbacks,T!==null&&(_=h.shared.hiddenCallbacks,h.shared.hiddenCallbacks=_===null?T:_.concat(T))));break;case 26:if(Zr){var N=Pi;cr(f,h),Cr(h),T&512&&(ki||_===null||Nr(_,_.return)),T&4&&(T=_!==null?_.memoizedState:null,f=h.memoizedState,_===null?f===null?h.stateNode===null?h.stateNode=ed(N,h.type,h.memoizedProps,h):td(N,h.type,h.stateNode):h.stateNode=mx(N,f,h.memoizedProps):T!==f?(T===null?_.stateNode!==null&&_h(_.stateNode):ec(T),f===null?td(N,h.type,h.stateNode):mx(N,f,h.memoizedProps)):f===null&&h.stateNode!==null&&My(h,h.memoizedProps,_.memoizedProps));break}case 27:if(ui&&T&4&&h.alternate===null){N=h.stateNode;var U=h.memoizedProps;try{fu(N),_x(h.type,U,N,h)}catch(st){qn(h,h.return,st)}}case 5:if(cr(f,h),Cr(h),T&512&&(ki||_===null||Nr(_,_.return)),ms){if(h.flags&32){f=h.stateNode;try{Qy(f)}catch(st){qn(h,h.return,st)}}T&4&&h.stateNode!=null&&(f=h.memoizedProps,My(h,f,_!==null?_.memoizedProps:f)),T&1024&&(uv=!0)}break;case 6:if(cr(f,h),Cr(h),T&4&&ms){if(h.stateNode===null)throw Error(i(162));T=h.memoizedProps,_=_!==null?_.memoizedProps:T,f=h.stateNode;try{Z0(f,_,T)}catch(st){qn(h,h.return,st)}}break;case 3:if(Zr?(gx(),N=Pi,Pi=dm(f.containerInfo),cr(f,h),Pi=N):cr(f,h),Cr(h),T&4){if(ms&&Hs&&_!==null&&_.memoizedState.isDehydrated)try{pM(f.containerInfo)}catch(st){qn(h,h.return,st)}if(Ea){T=f.containerInfo,_=f.pendingChildren;try{vh(T,_)}catch(st){qn(h,h.return,st)}}}uv&&(uv=!1,O0(h));break;case 4:Zr?(_=Pi,Pi=dm(h.stateNode.containerInfo),cr(f,h),Cr(h),Pi=_):(cr(f,h),Cr(h)),T&4&&Ea&&Hp(h.stateNode,h,h.stateNode.pendingChildren);break;case 12:cr(f,h),Cr(h);break;case 13:cr(f,h),Cr(h),h.child.flags&8192&&h.memoizedState!==null!=(_!==null&&_.memoizedState!==null)&&(gr=Aa()),T&4&&(T=h.updateQueue,T!==null&&(h.updateQueue=null,ul(h,T)));break;case 22:T&512&&(ki||_===null||Nr(_,_.return)),N=h.memoizedState!==null;var W=_!==null&&_.memoizedState!==null,te=Fo,xe=ki;if(Fo=te||N,ki=xe||W,cr(f,h),ki=xe,Fo=te,Cr(h),f=h.stateNode,f._current=h,f._visibility&=-3,f._visibility|=f._pendingVisibility&2,T&8192&&(f._visibility=N?f._visibility&-2:f._visibility|1,N&&(f=Fo||ki,_===null||W||f||ih(h)),ms&&(h.memoizedProps===null||h.memoizedProps.mode!=="manual"))){e:if(_=null,ms)for(f=h;;){if(f.tag===5||Zr&&f.tag===26||ui&&f.tag===27){if(_===null){W=_=f;try{U=W.stateNode,N?ex(U):nx(W.stateNode,W.memoizedProps)}catch(st){qn(W,W.return,st)}}}else if(f.tag===6){if(_===null){W=f;try{var qe=W.stateNode;N?tx(qe):fM(qe,W.memoizedProps)}catch(st){qn(W,W.return,st)}}}else if((f.tag!==22&&f.tag!==23||f.memoizedState===null||f===h)&&f.child!==null){f.child.return=f,f=f.child;continue}if(f===h)break e;for(;f.sibling===null;){if(f.return===null||f.return===h)break e;_===f&&(_=null),f=f.return}_===f&&(_=null),f.sibling.return=f.return,f=f.sibling}}T&4&&(T=h.updateQueue,T!==null&&(_=T.retryQueue,_!==null&&(T.retryQueue=null,ul(h,_))));break;case 19:cr(f,h),Cr(h),T&4&&(T=h.updateQueue,T!==null&&(h.updateQueue=null,ul(h,T)));break;case 21:break;default:cr(f,h),Cr(h)}}function Cr(h){var f=h.flags;if(f&2){try{if(ms&&(!ui||h.tag!==27)){e:{for(var _=h.return;_!==null;){if(Ey(_)){var T=_;break e}_=_.return}throw Error(i(160))}switch(T.tag){case 27:if(ui){var N=T.stateNode,U=Bf(h);ll(h,U,N);break}case 5:var W=T.stateNode;T.flags&32&&(Qy(W),T.flags&=-33);var te=Bf(h);ll(h,te,W);break;case 3:case 4:var xe=T.stateNode.containerInfo,qe=Bf(h);Ay(h,qe,xe);break;default:throw Error(i(161))}}}catch(st){qn(h,h.return,st)}h.flags&=-3}f&4096&&(h.flags&=-4097)}function O0(h){if(h.subtreeFlags&1024)for(h=h.child;h!==null;){var f=h;O0(f),f.tag===5&&f.flags&1024&&am(f.stateNode),h=h.sibling}}function cl(h,f){if(f.subtreeFlags&8772)for(f=f.child;f!==null;)kp(h,f.alternate,f),f=f.sibling}function ih(h){for(h=h.child;h!==null;){var f=h;switch(f.tag){case 0:case 11:case 14:case 15:$l(4,f,f.return),ih(f);break;case 1:Nr(f,f.return);var _=f.stateNode;typeof _.componentWillUnmount=="function"&&Rr(f,f.return,_),ih(f);break;case 26:case 27:case 5:Nr(f,f.return),ih(f);break;case 22:Nr(f,f.return),f.memoizedState===null&&ih(f);break;default:ih(f)}h=h.sibling}}function hl(h,f,_){for(_=_&&(f.subtreeFlags&8772)!==0,f=f.child;f!==null;){var T=f.alternate,N=h,U=f,W=U.flags;switch(U.tag){case 0:case 11:case 15:hl(N,U,_),Lf(4,U);break;case 1:if(hl(N,U,_),T=U,N=T.stateNode,typeof N.componentDidMount=="function")try{N.componentDidMount()}catch(qe){qn(T,T.return,qe)}if(T=U,N=T.updateQueue,N!==null){var te=T.stateNode;try{var xe=N.shared.hiddenCallbacks;if(xe!==null)for(N.shared.hiddenCallbacks=null,N=0;N<xe.length;N++)fe(xe[N],te)}catch(qe){qn(T,T.return,qe)}}_&&W&64&&L0(U),to(U,U.return);break;case 26:case 27:case 5:hl(N,U,_),_&&T===null&&W&4&&Ty(U),to(U,U.return);break;case 12:hl(N,U,_);break;case 13:hl(N,U,_),_&&W&4&&qp(N,U);break;case 22:U.memoizedState===null&&hl(N,U,_),to(U,U.return);break;default:hl(N,U,_)}f=f.sibling}}function Wp(h,f){var _=null;h!==null&&h.memoizedState!==null&&h.memoizedState.cachePool!==null&&(_=h.memoizedState.cachePool.pool),h=null,f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(h=f.memoizedState.cachePool.pool),h!==_&&(h!=null&&h.refCount++,_!=null&&Df(_))}function Pf(h,f){h=null,f.alternate!==null&&(h=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==h&&(f.refCount++,h!=null&&Df(h))}function As(h,f,_,T){if(f.subtreeFlags&10256)for(f=f.child;f!==null;)Cy(h,f,_,T),f=f.sibling}function Cy(h,f,_,T){var N=f.flags;switch(f.tag){case 0:case 11:case 15:As(h,f,_,T),N&2048&&Lf(9,f);break;case 3:As(h,f,_,T),N&2048&&(h=null,f.alternate!==null&&(h=f.alternate.memoizedState.cache),f=f.memoizedState.cache,f!==h&&(f.refCount++,h!=null&&Df(h)));break;case 12:if(N&2048){As(h,f,_,T),h=f.stateNode;try{var U=f.memoizedProps,W=U.id,te=U.onPostCommit;typeof te=="function"&&te(W,f.alternate===null?"mount":"update",h.passiveEffectDuration,-0)}catch(xe){qn(f,f.return,xe)}}else As(h,f,_,T);break;case 23:break;case 22:U=f.stateNode,f.memoizedState!==null?U._visibility&4?As(h,f,_,T):Js(h,f):U._visibility&4?As(h,f,_,T):(U._visibility|=4,Vs(h,f,_,T,(f.subtreeFlags&10256)!==0)),N&2048&&Wp(f.alternate,f);break;case 24:As(h,f,_,T),N&2048&&Pf(f.alternate,f);break;default:As(h,f,_,T)}}function Vs(h,f,_,T,N){for(N=N&&(f.subtreeFlags&10256)!==0,f=f.child;f!==null;){var U=h,W=f,te=_,xe=T,qe=W.flags;switch(W.tag){case 0:case 11:case 15:Vs(U,W,te,xe,N),Lf(8,W);break;case 23:break;case 22:var st=W.stateNode;W.memoizedState!==null?st._visibility&4?Vs(U,W,te,xe,N):Js(U,W):(st._visibility|=4,Vs(U,W,te,xe,N)),N&&qe&2048&&Wp(W.alternate,W);break;case 24:Vs(U,W,te,xe,N),N&&qe&2048&&Pf(W.alternate,W);break;default:Vs(U,W,te,xe,N)}f=f.sibling}}function Js(h,f){if(f.subtreeFlags&10256)for(f=f.child;f!==null;){var _=h,T=f,N=T.flags;switch(T.tag){case 22:Js(_,T),N&2048&&Wp(T.alternate,T);break;case 24:Js(_,T),N&2048&&Pf(T.alternate,T);break;default:Js(_,T)}f=f.sibling}}function xa(h){if(h.subtreeFlags&na)for(h=h.child;h!==null;)Xp(h),h=h.sibling}function Xp(h){switch(h.tag){case 26:xa(h),h.flags&na&&(h.memoizedState!==null?vx(Pi,h.memoizedState,h.memoizedProps):dr(h.type,h.memoizedProps));break;case 5:xa(h),h.flags&na&&dr(h.type,h.memoizedProps);break;case 3:case 4:if(Zr){var f=Pi;Pi=dm(h.stateNode.containerInfo),xa(h),Pi=f}else xa(h);break;case 22:h.memoizedState===null&&(f=h.alternate,f!==null&&f.memoizedState!==null?(f=na,na=16777216,xa(h),na=f):xa(h));break;default:xa(h)}}function If(h){var f=h.alternate;if(f!==null&&(h=f.child,h!==null)){f.child=null;do f=h.sibling,h.sibling=null,h=f;while(h!==null)}}function tu(h){var f=h.deletions;if((h.flags&16)!==0){if(f!==null)for(var _=0;_<f.length;_++){var T=f[_];sn=T,wy(T,h)}If(h)}if(h.subtreeFlags&10256)for(h=h.child;h!==null;)Yp(h),h=h.sibling}function Yp(h){switch(h.tag){case 0:case 11:case 15:tu(h),h.flags&2048&&$l(9,h,h.return);break;case 3:tu(h);break;case 12:tu(h);break;case 22:var f=h.stateNode;h.memoizedState!==null&&f._visibility&4&&(h.return===null||h.return.tag!==13)?(f._visibility&=-5,fl(h)):tu(h);break;default:tu(h)}}function fl(h){var f=h.deletions;if((h.flags&16)!==0){if(f!==null)for(var _=0;_<f.length;_++){var T=f[_];sn=T,wy(T,h)}If(h)}for(h=h.child;h!==null;){switch(f=h,f.tag){case 0:case 11:case 15:$l(8,f,f.return),fl(f);break;case 22:_=f.stateNode,_._visibility&4&&(_._visibility&=-5,fl(f));break;default:fl(f)}h=h.sibling}}function wy(h,f){for(;sn!==null;){var _=sn;switch(_.tag){case 0:case 11:case 15:$l(8,_,f);break;case 23:case 22:if(_.memoizedState!==null&&_.memoizedState.cachePool!==null){var T=_.memoizedState.cachePool.pool;T!=null&&T.refCount++}break;case 24:Df(_.memoizedState.cache)}if(T=_.child,T!==null)T.return=_,sn=T;else e:for(_=h;sn!==null;){T=sn;var N=T.sibling,U=T.return;if(Ry(T),T===_){sn=null;break e}if(N!==null){N.return=U,sn=N;break e}sn=U}}}function sh(h){var f=G0(h);if(f!=null){if(typeof f.memoizedProps["data-testname"]!="string")throw Error(i(364));return f}if(h=Yy(h),h===null)throw Error(i(362));return h.stateNode.current}function nu(h,f){var _=h.tag;switch(f.$$typeof){case Nh:if(h.type===f.value)return!0;break;case wa:e:{for(f=f.value,h=[h,0],_=0;_<h.length;){var T=h[_++],N=T.tag,U=h[_++],W=f[U];if(N!==5&&N!==26&&N!==27||!gh(T)){for(;W!=null&&nu(T,W);)U++,W=f[U];if(U===f.length){f=!0;break e}else for(T=T.child;T!==null;)h.push(T,U),T=T.sibling}}f=!1}return f;case Mi:if((_===5||_===26||_===27)&&W0(h.stateNode,f.value))return!0;break;case zo:if((_===5||_===6||_===26||_===27)&&(h=q0(h),h!==null&&0<=h.indexOf(f.value)))return!0;break;case ho:if((_===5||_===26||_===27)&&(h=h.memoizedProps["data-testname"],typeof h=="string"&&h.toLowerCase()===f.value.toLowerCase()))return!0;break;default:throw Error(i(365))}return!1}function Dy(h){switch(h.$$typeof){case Nh:return"<"+(a(h.value)||"Unknown")+">";case wa:return":has("+(Dy(h)||"")+")";case Mi:return'[role="'+h.value+'"]';case zo:return'"'+h.value+'"';case ho:return'[data-testname="'+h.value+'"]';default:throw Error(i(365))}}function wr(h,f){var _=[];h=[h,0];for(var T=0;T<h.length;){var N=h[T++],U=N.tag,W=h[T++],te=f[W];if(U!==5&&U!==26&&U!==27||!gh(N)){for(;te!=null&&nu(N,te);)W++,te=f[W];if(W===f.length)_.push(N);else for(N=N.child;N!==null;)h.push(N,W),N=N.sibling}}return _}function Ff(h,f){if(!hu)throw Error(i(363));h=sh(h),h=wr(h,f),f=[],h=Array.from(h);for(var _=0;_<h.length;){var T=h[_++],N=T.tag;if(N===5||N===26||N===27)gh(T)||f.push(T.stateNode);else for(T=T.child;T!==null;)h.push(T),T=T.sibling}return f}function ji(){if((Fn&2)!==0&&Nn!==0)return Nn&-Nn;if(jt.T!==null){var h=Jr;return h!==0?h:ct()}return H0()}function Uy(){ra===0&&(ra=(Nn&536870912)===0||Bn?H():536870912);var h=$r.current;return h!==null&&(h.flags|=32),ra}function Rs(h,f,_){(h===Xn&&ri===2||h.cancelPendingCommit!==null)&&(Gs(h,0),Dr(h,Nn,ra,!1)),Z(h,_),((Fn&2)===0||h!==Xn)&&(h===Xn&&((Fn&2)===0&&(Al|=_),fi===4&&Dr(h,Nn,ra,!1)),Ie(h))}function iu(h,f,_){if((Fn&6)!==0)throw Error(i(327));var T=!_&&(f&60)===0&&(f&h.expiredLanes)===0||B(h,f),N=T?By(h,f):Zp(h,f,!0),U=T;do{if(N===0){ia&&!T&&Dr(h,f,0,!1);break}else if(N===6)Dr(h,f,0,!Ua);else{if(_=h.current.alternate,U&&!rh(_)){N=Zp(h,f,!1),U=!1;continue}if(N===2){if(U=f,h.errorRecoveryDisabledLanes&U)var W=0;else W=h.pendingLanes&-536870913,W=W!==0?W:W&536870912?536870912:0;if(W!==0){f=W;e:{var te=h;N=mc;var xe=Hs&&te.current.memoizedState.isDehydrated;if(xe&&(Gs(te,W).flags|=256),W=Zp(te,W,!1),W!==2){if(vs&&!xe){te.errorRecoveryDisabledLanes|=U,Al|=U,N=4;break e}U=qi,qi=N,U!==null&&zf(U)}N=W}if(U=!1,N!==2)continue}}if(N===1){Gs(h,0),Dr(h,f,0,!0);break}e:{switch(T=h,N){case 0:case 1:throw Error(i(345));case 4:if((f&4194176)===f){Dr(T,f,ra,!Ua);break e}break;case 2:qi=null;break;case 3:case 5:break;default:throw Error(i(329))}if(T.finishedWork=_,T.finishedLanes=f,(f&62914560)===f&&(U=gr+300-Aa(),10<U)){if(Dr(T,f,ra,!Ua),z(T,0)!==0)break e;T.timeoutHandle=rs(jp.bind(null,T,_,qi,ld,Mm,f,ra,Al,Vo,Ua,2,-0,0),U);break e}jp(T,_,qi,ld,Mm,f,ra,Al,Vo,Ua,0,-0,0)}}break}while(!0);Ie(h)}function zf(h){qi===null?qi=h:qi.push.apply(qi,h)}function jp(h,f,_,T,N,U,W,te,xe,qe,st,vt,xt){var rn=f.subtreeFlags;if((rn&8192||(rn&16785408)===16785408)&&(Wy(),Xp(f),f=as(),f!==null)){h.cancelPendingCommit=f(ru.bind(null,h,_,T,N,W,te,xe,1,vt,xt)),Dr(h,U,W,!qe);return}ru(h,_,T,N,W,te,xe,st,vt,xt)}function rh(h){for(var f=h;;){var _=f.tag;if((_===0||_===11||_===15)&&f.flags&16384&&(_=f.updateQueue,_!==null&&(_=_.stores,_!==null)))for(var T=0;T<_.length;T++){var N=_[T],U=N.getSnapshot;N=N.value;try{if(!Lr(U(),N))return!1}catch{return!1}}if(_=f.child,f.subtreeFlags&16384&&_!==null)_.return=f,f=_;else{if(f===h)break;for(;f.sibling===null;){if(f.return===null||f.return===h)return!0;f=f.return}f.sibling.return=f.return,f=f.sibling}}return!0}function Dr(h,f,_,T){f&=~od,f&=~Al,h.suspendedLanes|=f,h.pingedLanes&=~f,T&&(h.warmLanes|=f),T=h.expirationTimes;for(var N=f;0<N;){var U=31-pr(N),W=1<<U;T[U]=-1,N&=~W}_!==0&&se(h,_,f)}function Vf(){return(Fn&6)===0?(j(0),!1):!0}function ah(){if(qt!==null){if(ri===0)var h=qt.return;else h=qt,ta=co=null,eo(h),yu=null,vu=0,h=qt;for(;h!==null;)U0(h.alternate,h),h=h.return;qt=null}}function Gs(h,f){h.finishedWork=null,h.finishedLanes=0;var _=h.timeoutHandle;_!==uu&&(h.timeoutHandle=uu,sm(_)),_=h.cancelPendingCommit,_!==null&&(h.cancelPendingCommit=null,_()),ah(),Xn=h,qt=_=ba(h.current,null),Nn=f,ri=0,er=null,Ua=!1,ia=B(h,f),vs=!1,Vo=ra=od=Al=sa=fi=0,qi=mc=null,Mm=!1,(f&8)!==0&&(f|=f&32);var T=h.entangledLanes;if(T!==0)for(h=h.entanglements,T&=f;0<T;){var N=31-pr(T),U=1<<N;f|=h[N],T&=~U}return tr=f,ne(),_}function Xr(h,f){gn=null,jt.H=Hi,f===Mh?(f=Jt(),ri=3):f===rd?(f=Jt(),ri=4):ri=f===bm?8:f!==null&&typeof f=="object"&&typeof f.then=="function"?6:1,er=f,qt===null&&(fi=1,Qc(h,ve(f,h.current)))}function su(){var h=$r.current;return h===null?!0:(Nn&4194176)===Nn?ci===null:(Nn&62914560)===Nn||(Nn&536870912)!==0?h===ci:!1}function Ro(){var h=jt.H;return jt.H=Hi,h===null?Hi:h}function No(){var h=jt.A;return jt.A=Rh,h}function dl(){fi=4,Ua||(Nn&4194176)!==Nn&&$r.current!==null||(ia=!0),(sa&134217727)===0&&(Al&134217727)===0||Xn===null||Dr(Xn,Nn,ra,!1)}function Zp(h,f,_){var T=Fn;Fn|=2;var N=Ro(),U=No();(Xn!==h||Nn!==f)&&(ld=null,Gs(h,f)),f=!1;var W=fi;e:do try{if(ri!==0&&qt!==null){var te=qt,xe=er;switch(ri){case 8:ah(),W=6;break e;case 3:case 2:case 6:$r.current===null&&(f=!0);var qe=ri;if(ri=0,er=null,Sa(h,te,xe,qe),_&&ia){W=0;break e}break;default:qe=ri,ri=0,er=null,Sa(h,te,xe,qe)}}Ly(),W=fi;break}catch(st){Xr(h,st)}while(!0);return f&&h.shellSuspendCounter++,ta=co=null,Fn=T,jt.H=N,jt.A=U,qt===null&&(Xn=null,Nn=0,ne()),W}function Ly(){for(;qt!==null;)Oi(qt)}function By(h,f){var _=Fn;Fn|=2;var T=Ro(),N=No();Xn!==h||Nn!==f?(ld=null,Ch=Aa()+500,Gs(h,f)):ia=B(h,f);e:do try{if(ri!==0&&qt!==null){f=qt;var U=er;t:switch(ri){case 1:ri=0,er=null,Sa(h,f,U,1);break;case 2:if(Ke(U)){ri=0,er=null,Vn(f);break}f=function(){ri===2&&Xn===h&&(ri=7),Ie(h)},U.then(f,f);break e;case 3:ri=7;break e;case 4:ri=5;break e;case 7:Ke(U)?(ri=0,er=null,Vn(f)):(ri=0,er=null,Sa(h,f,U,7));break;case 5:var W=null;switch(qt.tag){case 26:W=qt.memoizedState;case 5:case 27:var te=qt,xe=te.type,qe=te.pendingProps;if(W?tc(W):rm(xe,qe)){ri=0,er=null;var st=te.sibling;if(st!==null)qt=st;else{var vt=te.return;vt!==null?(qt=vt,Yr(vt)):qt=null}break t}}ri=0,er=null,Sa(h,f,U,5);break;case 6:ri=0,er=null,Sa(h,f,U,6);break;case 8:ah(),fi=6;break e;default:throw Error(i(462))}}hr();break}catch(xt){Xr(h,xt)}while(!0);return ta=co=null,jt.H=T,jt.A=N,Fn=_,qt!==null?0:(Xn=null,Nn=0,ne(),fi)}function hr(){for(;qt!==null&&!bx();)Oi(qt)}function Oi(h){var f=C0(h.alternate,h,tr);h.memoizedProps=h.pendingProps,f===null?Yr(h):qt=f}function Vn(h){var f=h,_=f.alternate;switch(f.tag){case 15:case 0:f=T0(_,f,f.pendingProps,f.type,void 0,Nn);break;case 11:f=T0(_,f,f.pendingProps,f.type.render,f.ref,Nn);break;case 5:eo(f);default:U0(_,f),f=qt=Hf(f,tr),f=C0(_,f,tr)}h.memoizedProps=h.pendingProps,f===null?Yr(h):qt=f}function Sa(h,f,_,T){ta=co=null,eo(f),yu=null,vu=0;var N=f.return;try{if(rM(h,N,f,_,Nn)){fi=1,Qc(h,ve(_,h.current)),qt=null;return}}catch(U){if(N!==null)throw qt=N,U;fi=1,Qc(h,ve(_,h.current)),qt=null;return}f.flags&32768?(Bn||T===1?h=!0:ia||(Nn&536870912)!==0?h=!1:(Ua=h=!0,(T===2||T===3||T===6)&&(T=$r.current,T!==null&&T.tag===13&&(T.flags|=16384))),Kp(f,h)):Yr(f)}function Yr(h){var f=h;do{if((f.flags&32768)!==0){Kp(f,Ua);return}h=f.return;var _=D0(f.alternate,f,tr);if(_!==null){qt=_;return}if(f=f.sibling,f!==null){qt=f;return}qt=f=h}while(f!==null);fi===0&&(fi=5)}function Kp(h,f){do{var _=oM(h.alternate,h);if(_!==null){_.flags&=32767,qt=_;return}if(_=h.return,_!==null&&(_.flags|=32768,_.subtreeFlags=0,_.deletions=null),!f&&(h=h.sibling,h!==null)){qt=h;return}qt=h=_}while(h!==null);fi=6,qt=null}function ru(h,f,_,T,N,U,W,te,xe,qe){var st=jt.T,vt=_l();try{$s(2),jt.T=null,P0(h,f,_,T,vt,N,U,W,te,xe,qe)}finally{jt.T=st,$s(vt)}}function P0(h,f,_,T,N,U,W,te){do no();while(Go!==null);if((Fn&6)!==0)throw Error(i(327));var xe=h.finishedWork;if(T=h.finishedLanes,xe===null)return null;if(h.finishedWork=null,h.finishedLanes=0,xe===h.current)throw Error(i(177));h.callbackNode=null,h.callbackPriority=0,h.cancelPendingCommit=null;var qe=xe.lanes|xe.childLanes;if(qe|=lo,ue(h,T,qe,U,W,te),h===Xn&&(qt=Xn=null,Nn=0),(xe.subtreeFlags&10256)===0&&(xe.flags&10256)===0||fo||(fo=!0,Tu=qe,Em=_,ml(vm,function(){return no(),null})),_=(xe.flags&15990)!==0,(xe.subtreeFlags&15990)!==0||_?(_=jt.T,jt.T=null,U=_l(),$s(2),W=Fn,Fn|=4,Of(h,xe),Ny(xe,h),V0(h.containerInfo),h.current=xe,kp(h,xe.alternate,xe),gm(),Fn=W,$s(U),jt.T=_):h.current=xe,fo?(fo=!1,Go=h,gc=T):Oy(h,qe),qe=h.pendingLanes,qe===0&&(bu=null),V(xe.stateNode),Ie(h),f!==null)for(N=h.onRecoverableError,xe=0;xe<f.length;xe++)qe=f[xe],N(qe.value,{componentStack:qe.stack});return(gc&3)!==0&&no(),qe=h.pendingLanes,(T&4194218)!==0&&(qe&42)!==0?h===Am?wh++:(wh=0,Am=h):wh=0,j(0),null}function Oy(h,f){(h.pooledCacheLanes&=f)===0&&(f=h.pooledCache,f!=null&&(h.pooledCache=null,Df(f)))}function no(){if(Go!==null){var h=Go,f=Tu;Tu=0;var _=Se(gc),T=32>_?32:_;_=jt.T;var N=_l();try{if($s(T),jt.T=null,Go===null)var U=!1;else{T=Em,Em=null;var W=Go,te=gc;if(Go=null,gc=0,(Fn&6)!==0)throw Error(i(331));var xe=Fn;if(Fn|=4,Yp(W.current),Cy(W,W.current,te,T),Fn=xe,j(0,!1),Ur&&typeof Ur.onPostCommitFiberRoot=="function")try{Ur.onPostCommitFiberRoot(Qi,W)}catch{}U=!0}return U}finally{$s(N),jt.T=_,Oy(h,f)}}return!1}function oh(h,f,_){f=ve(_,f),f=$c(h.stateNode,f,2),h=Nt(h,f,2),h!==null&&(Z(h,2),Ie(h))}function qn(h,f,_){if(h.tag===3)oh(h,h,_);else for(;f!==null;){if(f.tag===3){oh(f,h,_);break}else if(f.tag===1){var T=f.stateNode;if(typeof f.type.getDerivedStateFromError=="function"||typeof T.componentDidCatch=="function"&&(bu===null||!bu.has(T))){h=ve(_,h),_=py(2),T=Nt(f,_,2),T!==null&&(v0(_,T,f,h),Z(T,2),Ie(T));break}}f=f.return}}function Ju(h,f,_){var T=h.pingCache;if(T===null){T=h.pingCache=new Da;var N=new Set;T.set(f,N)}else N=T.get(f),N===void 0&&(N=new Set,T.set(f,N));N.has(_)||(vs=!0,N.add(_),h=Py.bind(null,h,f,_),f.then(h,h))}function Py(h,f,_){var T=h.pingCache;T!==null&&T.delete(f),h.pingedLanes|=h.suspendedLanes&_,h.warmLanes&=~_,Xn===h&&(Nn&_)===_&&(fi===4||fi===3&&(Nn&62914560)===Nn&&300>Aa()-gr?(Fn&2)===0&&Gs(h,0):od|=_,Vo===Nn&&(Vo=0)),Ie(h)}function au(h,f){f===0&&(f=I()),h=Ge(h,f),h!==null&&(Z(h,f),Ie(h))}function pl(h){var f=h.memoizedState,_=0;f!==null&&(_=f.retryLane),au(h,_)}function ou(h,f){var _=0;switch(h.tag){case 13:var T=h.stateNode,N=h.memoizedState;N!==null&&(_=N.retryLane);break;case 19:T=h.stateNode;break;case 22:T=h.stateNode._retryCache;break;default:throw Error(i(314))}T!==null&&T.delete(f),au(h,_)}function ml(h,f){return nd(h,f)}function Iy(h,f,_,T){this.tag=h,this.key=_,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=f,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=T,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Gf(h){return h=h.prototype,!(!h||!h.isReactComponent)}function ba(h,f){var _=h.alternate;return _===null?(_=t(h.tag,f,h.key,h.mode),_.elementType=h.elementType,_.type=h.type,_.stateNode=h.stateNode,_.alternate=h,h.alternate=_):(_.pendingProps=f,_.type=h.type,_.flags=0,_.subtreeFlags=0,_.deletions=null),_.flags=h.flags&31457280,_.childLanes=h.childLanes,_.lanes=h.lanes,_.child=h.child,_.memoizedProps=h.memoizedProps,_.memoizedState=h.memoizedState,_.updateQueue=h.updateQueue,f=h.dependencies,_.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext},_.sibling=h.sibling,_.index=h.index,_.ref=h.ref,_.refCleanup=h.refCleanup,_}function Hf(h,f){h.flags&=31457282;var _=h.alternate;return _===null?(h.childLanes=0,h.lanes=f,h.child=null,h.subtreeFlags=0,h.memoizedProps=null,h.memoizedState=null,h.updateQueue=null,h.dependencies=null,h.stateNode=null):(h.childLanes=_.childLanes,h.lanes=_.lanes,h.child=_.child,h.subtreeFlags=0,h.deletions=null,h.memoizedProps=_.memoizedProps,h.memoizedState=_.memoizedState,h.updateQueue=_.updateQueue,h.type=_.type,f=_.dependencies,h.dependencies=f===null?null:{lanes:f.lanes,firstContext:f.firstContext}),h}function Co(h,f,_,T,N,U){var W=0;if(T=h,typeof h=="function")Gf(h)&&(W=1);else if(typeof h=="string")W=Zr&&ui?$f(h,_,gs.current)?26:Do(h)?27:5:Zr?$f(h,_,gs.current)?26:5:ui&&Do(h)?27:5;else e:switch(h){case lu:return Gi(_.children,N,U,f);case Xf:W=8,N|=24;break;case em:return h=t(12,_,f,N|2),h.elementType=em,h.lanes=U,h;case tm:return h=t(13,_,f,N),h.elementType=tm,h.lanes=U,h;case hh:return h=t(19,_,f,N),h.elementType=hh,h.lanes=U,h;case Vy:return kf(_,N,U,f);default:if(typeof h=="object"&&h!==null)switch(h.$$typeof){case Yf:case io:W=10;break e;case zy:W=9;break e;case jf:W=11;break e;case nm:W=14;break e;case Ma:W=16,T=null;break e}W=29,_=Error(i(130,h===null?"null":typeof h,"")),T=null}return f=t(W,_,f,N),f.elementType=h,f.type=T,f.lanes=U,f}function Gi(h,f,_,T){return h=t(7,h,T,f),h.lanes=_,h}function kf(h,f,_,T){h=t(22,h,T,f),h.elementType=Vy,h.lanes=_;var N={_visibility:1,_pendingVisibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null,_current:null,detach:function(){var U=N._current;if(U===null)throw Error(i(456));if((N._pendingVisibility&2)===0){var W=Ge(U,2);W!==null&&(N._pendingVisibility|=2,Rs(W,U,2))}},attach:function(){var U=N._current;if(U===null)throw Error(i(456));if((N._pendingVisibility&2)!==0){var W=Ge(U,2);W!==null&&(N._pendingVisibility&=-3,Rs(W,U,2))}}};return h.stateNode=N,h}function Qp(h,f,_){return h=t(6,h,null,f),h.lanes=_,h}function Fy(h,f,_){return f=t(4,h.children!==null?h.children:[],h.key,f),f.lanes=_,f.stateNode={containerInfo:h.containerInfo,pendingChildren:null,implementation:h.implementation},f}function lM(h,f,_,T,N,U,W,te){this.tag=1,this.containerInfo=h,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=uu,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=P(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.finishedLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=P(0),this.hiddenUpdates=P(null),this.identifierPrefix=T,this.onUncaughtError=N,this.onCaughtError=U,this.onRecoverableError=W,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=te,this.incompleteTransitions=new Map}function I0(h,f,_,T,N,U,W,te,xe,qe,st,vt){return h=new lM(h,f,_,W,te,xe,qe,vt),f=1,U===!0&&(f|=24),U=t(3,null,null,f),h.current=U,U.stateNode=h,f=Jl(),f.refCount++,h.pooledCache=f,f.refCount++,U.memoizedState={element:T,isDehydrated:_,cache:f},et(U),h}function ss(h){return h?(h=pu,h):pu}function Jp(h){var f=h._reactInternals;if(f===void 0)throw typeof h.render=="function"?Error(i(188)):(h=Object.keys(h).join(","),Error(i(268,h)));return h=x(f),h=h!==null?S(h):null,h===null?null:ph(h.stateNode)}function lh(h,f,_,T,N,U){N=ss(N),T.context===null?T.context=N:T.pendingContext=N,T=Rt(f),T.payload={element:_},U=U===void 0?null:U,U!==null&&(T.callback=U),_=Nt(h,T,f),_!==null&&(Rs(_,h,f),ht(_,h,f))}function uh(h,f){if(h=h.memoizedState,h!==null&&h.dehydrated!==null){var _=h.retryLane;h.retryLane=_!==0&&_<f?_:f}}function qf(h,f){uh(h,f),(h=h.alternate)&&uh(h,f)}var un={},ch=jg(),jr=pK(),$p=Object.assign,uM=Symbol.for("react.element"),Wf=Symbol.for("react.transitional.element"),Ta=Symbol.for("react.portal"),lu=Symbol.for("react.fragment"),Xf=Symbol.for("react.strict_mode"),em=Symbol.for("react.profiler"),Yf=Symbol.for("react.provider"),zy=Symbol.for("react.consumer"),io=Symbol.for("react.context"),jf=Symbol.for("react.forward_ref"),tm=Symbol.for("react.suspense"),hh=Symbol.for("react.suspense_list"),nm=Symbol.for("react.memo"),Ma=Symbol.for("react.lazy"),Vy=Symbol.for("react.offscreen"),F0=Symbol.for("react.memo_cache_sentinel"),gl=Symbol.iterator,Gy=Symbol.for("react.client.reference"),jt=ch.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,wo,yl,$u=!1,fh=Array.isArray,Hy=e.rendererVersion,Zf=e.rendererPackageName,dh=e.extraDevToolsConfig,ph=e.getPublicInstance,z0=e.getRootHostContext,mh=e.getChildHostContext,im=e.prepareForCommit,V0=e.resetAfterCommit,ky=e.createInstance,Kf=e.appendInitialChild,vl=e.finalizeInitialChildren,cn=e.shouldSetTextContent,Jn=e.createTextInstance,rs=e.scheduleTimeout,sm=e.cancelTimeout,uu=e.noTimeout,fr=e.isPrimaryRenderer;e.warnsIfNotActing;var ms=e.supportsMutation,Ea=e.supportsPersistence,Hs=e.supportsHydration,G0=e.getInstanceFromNode;e.beforeActiveInstanceBlur,e.afterActiveInstanceBlur;var Zi=e.preparePortalMount;e.prepareScopeUpdate,e.getInstanceFromScope;var $s=e.setCurrentUpdatePriority,_l=e.getCurrentUpdatePriority,H0=e.resolveUpdatePriority;e.resolveEventType,e.resolveEventTimeStamp;var k0=e.shouldAttemptEagerTransition,cM=e.detachDeletedInstance;e.requestPostPaintCallback;var qy=e.maySuspendCommit,rm=e.preloadInstance,Wy=e.startSuspendingCommit,dr=e.suspendInstance,as=e.waitForCommitToBeReady,cu=e.NotPendingTransition,so=e.HostTransitionContext,am=e.resetFormInstance;e.bindToConsole;var Xy=e.supportsMicrotasks,xl=e.scheduleMicrotask,hu=e.supportsTestSelectors,Yy=e.findFiberRoot,jy=e.getBoundingRect,q0=e.getTextContent,gh=e.isHiddenSubtree,W0=e.matchAccessibilityRole,X0=e.setFocusIfFocusable,Y0=e.setupIntersectionObserver,j0=e.appendChild,Zy=e.appendChildToContainer,Z0=e.commitTextUpdate,hM=e.commitMount,K0=e.commitUpdate,Q0=e.insertBefore,J0=e.insertInContainerBefore,Ky=e.removeChild,$0=e.removeChildFromContainer,Qy=e.resetTextContent,ex=e.hideInstance,tx=e.hideTextInstance,nx=e.unhideInstance,fM=e.unhideTextInstance,ix=e.clearContainer,yh=e.cloneInstance,Qf=e.createContainerChildSet,Jy=e.appendChildToContainerChildSet,om=e.finalizeContainerChildren,vh=e.replaceContainerChildren,$y=e.cloneHiddenInstance,ev=e.cloneHiddenTextInstance,lm=e.isSuspenseInstancePending,um=e.isSuspenseInstanceFallback,sx=e.getSuspenseInstanceFallbackErrorDetails,rx=e.registerSuspenseInstanceRetry,tv=e.canHydrateFormStateMarker,ax=e.isFormStateMarkerMatching,nv=e.getNextHydratableSibling,cm=e.getFirstHydratableChild,ox=e.getFirstHydratableChildWithinContainer,lx=e.getFirstHydratableChildWithinSuspenseInstance,dM=e.canHydrateInstance,iv=e.canHydrateTextInstance,ux=e.canHydrateSuspenseInstance,cx=e.hydrateInstance,sv=e.hydrateTextInstance,hx=e.hydrateSuspenseInstance,fx=e.getNextHydratableInstanceAfterSuspenseInstance,pM=e.commitHydratedContainer,mM=e.commitHydratedSuspenseInstance,dx=e.clearSuspenseBoundary,Jf=e.clearSuspenseBoundaryFromContainer,hm=e.shouldDeleteUnhydratedTailInstances;e.diffHydratedPropsForDevWarnings,e.diffHydratedTextForDevWarnings,e.describeHydratableInstanceForDevWarnings;var fm=e.validateHydratableInstance,px=e.validateHydratableTextInstance,Zr=e.supportsResources,$f=e.isHostHoistableType,dm=e.getHoistableRoot,rv=e.getResource,mx=e.acquireResource,ec=e.releaseResource,ed=e.hydrateHoistable,td=e.mountHoistable,_h=e.unmountHoistable,pm=e.createHoistableInstance,gx=e.prepareToCommitHoistables,yx=e.mayResourceSuspendCommit,tc=e.preloadResource,vx=e.suspendResource,ui=e.supportsSingletons,ro=e.resolveSingletonInstance,fu=e.clearSingleton,_x=e.acquireSingletonInstance,du=e.releaseSingletonInstance,Do=e.isHostSingletonType,Ki=[],Sl=-1,pu={},pr=Math.clz32?Math.clz32:w,xx=Math.log,Sx=Math.LN2,Uo=128,nc=4194304,nd=jr.unstable_scheduleCallback,mm=jr.unstable_cancelCallback,bx=jr.unstable_shouldYield,gm=jr.unstable_requestPaint,Aa=jr.unstable_now,ym=jr.unstable_ImmediatePriority,Tx=jr.unstable_UserBlockingPriority,vm=jr.unstable_NormalPriority,gM=jr.unstable_IdlePriority,Mx=jr.log,Ns=jr.unstable_setDisableYieldValue,Qi=null,Ur=null,Lr=typeof Object.is=="function"?Object.is:J,av=new WeakMap,ic=[],sc=0,rc=null,xh=0,Kr=[],Qr=0,mu=null,ao=1,oo="",gs=E(null),Sh=E(null),Lo=E(null),ac=E(null),ks=null,qs=null,Bn=!1,Ra=null,Cs=!1,id=Error(i(519)),Na=[],oc=0,lo=0,sd=null,bl=null,lc=!1,pi=!1,ov=!1,bh=0,Th=null,uc=0,Jr=0,cc=null,Tl=!1,hc=!1,Bo=Object.prototype.hasOwnProperty,Mh=Error(i(460)),rd=Error(i(474)),ad={then:function(){}},gu=null,yu=null,vu=0,_u=ds(!0),Oo=ds(!1),mi=E(null),Eh=E(0),$r=E(null),ci=null,ys=E(0),Ml=0,gn=null,Ht=null,In=null,Ca=!1,fc=!1,xu=!1,_m=0,dc=0,ws=null,uo=0,xm=function(){return{lastEffect:null,events:null,stores:null,memoCache:null}},Hi={readContext:Fs,use:Re,useCallback:ii,useContext:ii,useEffect:ii,useImperativeHandle:ii,useLayoutEffect:ii,useInsertionEffect:ii,useMemo:ii,useReducer:ii,useRef:ii,useState:ii,useDebugValue:ii,useDeferredValue:ii,useTransition:ii,useSyncExternalStore:ii,useId:ii};Hi.useCacheRefresh=ii,Hi.useMemoCache=ii,Hi.useHostTransitionStatus=ii,Hi.useFormState=ii,Hi.useActionState=ii,Hi.useOptimistic=ii;var Su={readContext:Fs,use:Re,useCallback:function(h,f){return q().memoizedState=[h,f===void 0?null:f],h},useContext:Fs,useEffect:Dp,useImperativeHandle:function(h,f,_){_=_!=null?_.concat([h]):null,_f(4194308,4,Up.bind(null,f,h),_)},useLayoutEffect:function(h,f){return _f(4194308,4,h,f)},useInsertionEffect:function(h,f){_f(4,2,h,f)},useMemo:function(h,f){var _=q();f=f===void 0?null:f;var T=h();if(xu){Q(!0);try{h()}finally{Q(!1)}}return _.memoizedState=[T,f],T},useReducer:function(h,f,_){var T=q();if(_!==void 0){var N=_(f);if(xu){Q(!0);try{_(f)}finally{Q(!1)}}}else N=f;return T.memoizedState=T.baseState=N,h={pending:null,lanes:0,dispatch:null,lastRenderedReducer:h,lastRenderedState:N},T.queue=h,h=h.dispatch=Bp.bind(null,gn,h),[T.memoizedState,h]},useRef:function(h){var f=q();return h={current:h},f.memoizedState=h},useState:function(h){h=Tn(h);var f=h.queue,_=dy.bind(null,gn,f);return f.dispatch=_,[h.memoizedState,_]},useDebugValue:Yl,useDeferredValue:function(h,f){var _=q();return bf(_,h,f)},useTransition:function(){var h=Tn(!1);return h=Xc.bind(null,gn,h.queue,!0,!1),q().memoizedState=h,[!1,h]},useSyncExternalStore:function(h,f,_){var T=gn,N=q();if(Bn){if(_===void 0)throw Error(i(407));_=_()}else{if(_=f(),Xn===null)throw Error(i(349));(Nn&60)!==0||It(T,f,_)}N.memoizedState=_;var U={value:_,getSnapshot:f};return N.queue=U,Dp(Sn.bind(null,T,U,h),[h]),T.flags|=2048,lr(9,Ut.bind(null,T,U,_,f),{destroy:void 0},null),_},useId:function(){var h=q(),f=Xn.identifierPrefix;if(Bn){var _=oo,T=ao;_=(T&~(1<<32-pr(T)-1)).toString(32)+_,f=":"+f+"R"+_,_=_m++,0<_&&(f+="H"+_.toString(32)),f+=":"}else _=uo++,f=":"+f+"r"+_.toString(32)+":";return h.memoizedState=f},useCacheRefresh:function(){return q().memoizedState=fy.bind(null,gn)}};Su.useMemoCache=ye,Su.useHostTransitionStatus=Tf,Su.useFormState=si,Su.useActionState=si,Su.useOptimistic=function(h){var f=q();f.memoizedState=f.baseState=h;var _={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return f.queue=_,f=jc.bind(null,gn,!0,_),_.dispatch=f,[h,f]};var mr={readContext:Fs,use:Re,useCallback:Zu,useContext:Fs,useEffect:uy,useImperativeHandle:Lp,useInsertionEffect:g0,useLayoutEffect:Sf,useMemo:cy,useReducer:ut,useRef:Eo,useState:function(){return ut($e)},useDebugValue:Yl,useDeferredValue:function(h,f){var _=he();return hy(_,Ht.memoizedState,h,f)},useTransition:function(){var h=ut($e)[0],f=he().memoizedState;return[typeof h=="boolean"?h:Ae(h),f]},useSyncExternalStore:Wt,useId:Yc};mr.useCacheRefresh=sl,mr.useMemoCache=ye,mr.useHostTransitionStatus=Tf,mr.useFormState=Ps,mr.useActionState=Ps,mr.useOptimistic=function(h,f){var _=he();return Rn(_,Ht,h,f)};var ea={readContext:Fs,use:Re,useCallback:Zu,useContext:Fs,useEffect:uy,useImperativeHandle:Lp,useInsertionEffect:g0,useLayoutEffect:Sf,useMemo:cy,useReducer:bt,useRef:Eo,useState:function(){return bt($e)},useDebugValue:Yl,useDeferredValue:function(h,f){var _=he();return Ht===null?bf(_,h,f):hy(_,Ht.memoizedState,h,f)},useTransition:function(){var h=bt($e)[0],f=he().memoizedState;return[typeof h=="boolean"?h:Ae(h),f]},useSyncExternalStore:Wt,useId:Yc};ea.useCacheRefresh=sl,ea.useMemoCache=ye,ea.useHostTransitionStatus=Tf,ea.useFormState=Es,ea.useActionState=Es,ea.useOptimistic=function(h,f){var _=he();return Ht!==null?Rn(_,Ht,h,f):(_.baseState=h,[h,_.queue.dispatch])};var Po={isMounted:function(h){return(h=h._reactInternals)?y(h)===h:!1},enqueueSetState:function(h,f,_){h=h._reactInternals;var T=ji(),N=Rt(T);N.payload=f,_!=null&&(N.callback=_),f=Nt(h,N,T),f!==null&&(Rs(f,h,T),ht(f,h,T))},enqueueReplaceState:function(h,f,_){h=h._reactInternals;var T=ji(),N=Rt(T);N.tag=1,N.payload=f,_!=null&&(N.callback=_),f=Nt(h,N,T),f!==null&&(Rs(f,h,T),ht(f,h,T))},enqueueForceUpdate:function(h,f){h=h._reactInternals;var _=ji(),T=Rt(_);T.tag=2,f!=null&&(T.callback=f),f=Nt(h,T,_),f!==null&&(Rs(f,h,_),ht(f,h,_))}},Sm=typeof reportError=="function"?reportError:function(h){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var f=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof h=="object"&&h!==null&&typeof h.message=="string"?String(h.message):String(h),error:h});if(!window.dispatchEvent(f))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",h);return}console.error(h)},bm=Error(i(461)),hi=!1,Tm={dehydrated:null,treeContext:null,retryLane:0},El=E(null),co=null,ta=null,Ah=typeof AbortController<"u"?AbortController:function(){var h=[],f=this.signal={aborted:!1,addEventListener:function(_,T){h.push(T)}};this.abort=function(){f.aborted=!0,h.forEach(function(_){return _()})}},Ex=jr.unstable_scheduleCallback,Ax=jr.unstable_NormalPriority,gi={$$typeof:io,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0},lv=jt.S;jt.S=function(h,f){typeof f=="object"&&f!==null&&typeof f.then=="function"&&it(h,f),lv!==null&&lv(h,f)};var Io=E(null),Fo=!1,ki=!1,uv=!1,Wn=typeof WeakSet=="function"?WeakSet:Set,sn=null,bn=!1,Vt=null,pn=!1,Pi=null,na=8192,Rh={getCacheForType:function(h){var f=Fs(gi),_=f.data.get(h);return _===void 0&&(_=h(),f.data.set(h,_)),_}},Nh=0,wa=1,Mi=2,ho=3,zo=4;if(typeof Symbol=="function"&&Symbol.for){var pc=Symbol.for;Nh=pc("selector.component"),wa=pc("selector.has_pseudo_class"),Mi=pc("selector.role"),ho=pc("selector.test_id"),zo=pc("selector.text")}var Da=typeof WeakMap=="function"?WeakMap:Map,Fn=0,Xn=null,qt=null,Nn=0,ri=0,er=null,Ua=!1,ia=!1,vs=!1,tr=0,fi=0,sa=0,Al=0,od=0,ra=0,Vo=0,mc=null,qi=null,Mm=!1,gr=0,Ch=1/0,ld=null,bu=null,fo=!1,Go=null,gc=0,Tu=0,Em=null,wh=0,Am=null;return un.attemptContinuousHydration=function(h){if(h.tag===13){var f=Ge(h,67108864);f!==null&&Rs(f,h,67108864),qf(h,67108864)}},un.attemptHydrationAtCurrentPriority=function(h){if(h.tag===13){var f=ji(),_=Ge(h,f);_!==null&&Rs(_,h,f),qf(h,f)}},un.attemptSynchronousHydration=function(h){switch(h.tag){case 3:if(h=h.stateNode,h.current.memoizedState.isDehydrated){var f=D(h.pendingLanes);if(f!==0){for(h.pendingLanes|=2,h.entangledLanes|=2;f;){var _=1<<31-pr(f);h.entanglements[1]|=_,f&=~_}Ie(h),(Fn&6)===0&&(Ch=Aa()+500,j(0))}}break;case 13:f=Ge(h,2),f!==null&&Rs(f,h,2),Vf(),qf(h,2)}},un.batchedUpdates=function(h,f){return h(f)},un.createComponentSelector=function(h){return{$$typeof:Nh,value:h}},un.createContainer=function(h,f,_,T,N,U,W,te,xe,qe){return I0(h,f,!1,null,_,T,U,W,te,xe,qe,null)},un.createHasPseudoClassSelector=function(h){return{$$typeof:wa,value:h}},un.createHydrationContainer=function(h,f,_,T,N,U,W,te,xe,qe,st,vt,xt){return h=I0(_,T,!0,h,N,U,te,xe,qe,st,vt,xt),h.context=ss(null),_=h.current,T=ji(),N=Rt(T),N.callback=f??null,Nt(_,N,T),h.current.lanes=T,Z(h,T),Ie(h),h},un.createPortal=function(h,f,_){var T=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:Ta,key:T==null?null:""+T,children:h,containerInfo:f,implementation:_}},un.createRoleSelector=function(h){return{$$typeof:Mi,value:h}},un.createTestNameSelector=function(h){return{$$typeof:ho,value:h}},un.createTextSelector=function(h){return{$$typeof:zo,value:h}},un.defaultOnCaughtError=function(h){console.error(h)},un.defaultOnRecoverableError=function(h){Sm(h)},un.defaultOnUncaughtError=function(h){Sm(h)},un.deferredUpdates=function(h){var f=jt.T,_=_l();try{return $s(32),jt.T=null,h()}finally{$s(_),jt.T=f}},un.discreteUpdates=function(h,f,_,T,N){var U=jt.T,W=_l();try{return $s(2),jt.T=null,h(f,_,T,N)}finally{$s(W),jt.T=U,Fn===0&&(Ch=Aa()+500)}},un.findAllNodes=Ff,un.findBoundingRects=function(h,f){if(!hu)throw Error(i(363));f=Ff(h,f),h=[];for(var _=0;_<f.length;_++)h.push(jy(f[_]));for(f=h.length-1;0<f;f--){_=h[f];for(var T=_.x,N=T+_.width,U=_.y,W=U+_.height,te=f-1;0<=te;te--)if(f!==te){var xe=h[te],qe=xe.x,st=qe+xe.width,vt=xe.y,xt=vt+xe.height;if(T>=qe&&U>=vt&&N<=st&&W<=xt){h.splice(f,1);break}else if(T!==qe||_.width!==xe.width||xt<U||vt>W){if(!(U!==vt||_.height!==xe.height||st<T||qe>N)){qe>T&&(xe.width+=qe-T,xe.x=T),st<N&&(xe.width=N-qe),h.splice(f,1);break}}else{vt>U&&(xe.height+=vt-U,xe.y=U),xt<W&&(xe.height=W-vt),h.splice(f,1);break}}}return h},un.findHostInstance=Jp,un.findHostInstanceWithNoPortals=function(h){return h=x(h),h=h!==null?A(h):null,h===null?null:ph(h.stateNode)},un.findHostInstanceWithWarning=function(h){return Jp(h)},un.flushPassiveEffects=no,un.flushSyncFromReconciler=function(h){var f=Fn;Fn|=1;var _=jt.T,T=_l();try{if($s(2),jt.T=null,h)return h()}finally{$s(T),jt.T=_,Fn=f,(Fn&6)===0&&j(0)}},un.flushSyncWork=Vf,un.focusWithin=function(h,f){if(!hu)throw Error(i(363));for(h=sh(h),f=wr(h,f),f=Array.from(f),h=0;h<f.length;){var _=f[h++],T=_.tag;if(!gh(_)){if((T===5||T===26||T===27)&&X0(_.stateNode))return!0;for(_=_.child;_!==null;)f.push(_),_=_.sibling}}return!1},un.getFindAllNodesFailureDescription=function(h,f){if(!hu)throw Error(i(363));var _=0,T=[];h=[sh(h),0];for(var N=0;N<h.length;){var U=h[N++],W=U.tag,te=h[N++],xe=f[te];if((W!==5&&W!==26&&W!==27||!gh(U))&&(nu(U,xe)&&(T.push(Dy(xe)),te++,te>_&&(_=te)),te<f.length))for(U=U.child;U!==null;)h.push(U,te),U=U.sibling}if(_<f.length){for(h=[];_<f.length;_++)h.push(Dy(f[_]));return`findAllNodes was able to match part of the selector:
  `+(T.join(" > ")+`

No matching component was found for:
  `)+h.join(" > ")}return null},un.getPublicRootInstance=function(h){if(h=h.current,!h.child)return null;switch(h.child.tag){case 27:case 5:return ph(h.child.stateNode);default:return h.child.stateNode}},un.injectIntoDevTools=function(){var h={bundleType:0,version:Hy,rendererPackageName:Zf,currentDispatcherRef:jt,findFiberByHostInstance:G0,reconcilerVersion:"19.0.0"};if(dh!==null&&(h.rendererConfig=dh),typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u")h=!1;else{var f=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(f.isDisabled||!f.supportsFiber)h=!0;else{try{Qi=f.inject(h),Ur=f}catch{}h=!!f.checkDCE}}return h},un.isAlreadyRendering=function(){return!1},un.observeVisibleRects=function(h,f,_,T){if(!hu)throw Error(i(363));h=Ff(h,f);var N=Y0(h,_,T).disconnect;return{disconnect:function(){N()}}},un.shouldError=function(){return null},un.shouldSuspend=function(){return!1},un.startHostTransition=function(h,f,_,T){if(h.tag!==5)throw Error(i(476));var N=Ao(h).queue;Xc(h,N,f,cu,_===null?n:function(){var U=Ao(h).next.queue;return jl(h,U,{},ji()),_(T)})},un.updateContainer=function(h,f,_,T){var N=f.current,U=ji();return lh(N,U,h,f,_,T),U},un.updateContainerSync=function(h,f,_,T){return f.tag===0&&no(),lh(f.current,2,h,f,_,T),2},un},r.exports.default=r.exports,Object.defineProperty(r.exports,"__esModule",{value:!0})}(bA)),bA.exports}var LD;function gK(){return LD||(LD=1,SA.exports=mK()),SA.exports}var yK=gK();const vK=x1(yK);var EA={exports:{}},AA={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var BD;function _K(){return BD||(BD=1,function(r){function e(V,Q){var J=V.length;V.push(Q);e:for(;0<J;){var ve=J-1>>>1,X=V[ve];if(0<i(X,Q))V[ve]=Q,V[J]=X,J=ve;else break e}}function t(V){return V.length===0?null:V[0]}function n(V){if(V.length===0)return null;var Q=V[0],J=V.pop();if(J!==Q){V[0]=J;e:for(var ve=0,X=V.length,re=X>>>1;ve<re;){var we=2*(ve+1)-1,Fe=V[we],oe=we+1,De=V[oe];if(0>i(Fe,J))oe<X&&0>i(De,Fe)?(V[ve]=De,V[oe]=J,ve=oe):(V[ve]=Fe,V[we]=J,ve=we);else if(oe<X&&0>i(De,J))V[ve]=De,V[oe]=J,ve=oe;else break e}}return Q}function i(V,Q){var J=V.sortIndex-Q.sortIndex;return J!==0?J:V.id-Q.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var s=performance;r.unstable_now=function(){return s.now()}}else{var a=Date,l=a.now();r.unstable_now=function(){return a.now()-l}}var c=[],d=[],m=1,y=null,v=3,x=!1,S=!1,A=!1,E=typeof setTimeout=="function"?setTimeout:null,M=typeof clearTimeout=="function"?clearTimeout:null,C=typeof setImmediate<"u"?setImmediate:null;function w(V){for(var Q=t(d);Q!==null;){if(Q.callback===null)n(d);else if(Q.startTime<=V)n(d),Q.sortIndex=Q.expirationTime,e(c,Q);else break;Q=t(d)}}function D(V){if(A=!1,w(V),!S)if(t(c)!==null)S=!0,pe();else{var Q=t(d);Q!==null&&Se(D,Q.startTime-V)}}var z=!1,B=-1,F=5,H=-1;function I(){return!(r.unstable_now()-H<F)}function P(){if(z){var V=r.unstable_now();H=V;var Q=!0;try{e:{S=!1,A&&(A=!1,M(B),B=-1),x=!0;var J=v;try{t:{for(w(V),y=t(c);y!==null&&!(y.expirationTime>V&&I());){var ve=y.callback;if(typeof ve=="function"){y.callback=null,v=y.priorityLevel;var X=ve(y.expirationTime<=V);if(V=r.unstable_now(),typeof X=="function"){y.callback=X,w(V),Q=!0;break t}y===t(c)&&n(c),w(V)}else n(c);y=t(c)}if(y!==null)Q=!0;else{var re=t(d);re!==null&&Se(D,re.startTime-V),Q=!1}}break e}finally{y=null,v=J,x=!1}Q=void 0}}finally{Q?Z():z=!1}}}var Z;if(typeof C=="function")Z=function(){C(P)};else if(typeof MessageChannel<"u"){var ue=new MessageChannel,se=ue.port2;ue.port1.onmessage=P,Z=function(){se.postMessage(null)}}else Z=function(){E(P,0)};function pe(){z||(z=!0,Z())}function Se(V,Q){B=E(function(){V(r.unstable_now())},Q)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(V){V.callback=null},r.unstable_continueExecution=function(){S||x||(S=!0,pe())},r.unstable_forceFrameRate=function(V){0>V||125<V?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):F=0<V?Math.floor(1e3/V):5},r.unstable_getCurrentPriorityLevel=function(){return v},r.unstable_getFirstCallbackNode=function(){return t(c)},r.unstable_next=function(V){switch(v){case 1:case 2:case 3:var Q=3;break;default:Q=v}var J=v;v=Q;try{return V()}finally{v=J}},r.unstable_pauseExecution=function(){},r.unstable_requestPaint=function(){},r.unstable_runWithPriority=function(V,Q){switch(V){case 1:case 2:case 3:case 4:case 5:break;default:V=3}var J=v;v=V;try{return Q()}finally{v=J}},r.unstable_scheduleCallback=function(V,Q,J){var ve=r.unstable_now();switch(typeof J=="object"&&J!==null?(J=J.delay,J=typeof J=="number"&&0<J?ve+J:ve):J=ve,V){case 1:var X=-1;break;case 2:X=250;break;case 5:X=1073741823;break;case 4:X=1e4;break;default:X=5e3}return X=J+X,V={id:m++,callback:Q,priorityLevel:V,startTime:J,expirationTime:X,sortIndex:-1},J>ve?(V.sortIndex=J,e(d,V),t(c)===null&&V===t(d)&&(A?(M(B),B=-1):A=!0,Se(D,J-ve))):(V.sortIndex=X,e(c,V),S||x||(S=!0,pe())),V},r.unstable_shouldYield=I,r.unstable_wrapCallback=function(V){var Q=v;return function(){var J=v;v=Q;try{return V.apply(this,arguments)}finally{v=J}}}}(AA)),AA}var OD;function xK(){return OD||(OD=1,EA.exports=_K()),EA.exports}var PD=xK();const SK=r=>typeof r=="object"&&typeof r.then=="function",zd=[];function QP(r,e,t=(n,i)=>n===i){if(r===e)return!0;if(!r||!e)return!1;const n=r.length;if(e.length!==n)return!1;for(let i=0;i<n;i++)if(!t(r[i],e[i]))return!1;return!0}function JP(r,e=null,t=!1,n={}){e===null&&(e=[r]);for(const s of zd)if(QP(e,s.keys,s.equal)){if(t)return;if(Object.prototype.hasOwnProperty.call(s,"error"))throw s.error;if(Object.prototype.hasOwnProperty.call(s,"response"))return n.lifespan&&n.lifespan>0&&(s.timeout&&clearTimeout(s.timeout),s.timeout=setTimeout(s.remove,n.lifespan)),s.response;if(!t)throw s.promise}const i={keys:e,equal:n.equal,remove:()=>{const s=zd.indexOf(i);s!==-1&&zd.splice(s,1)},promise:(SK(r)?r:r(...e)).then(s=>{i.response=s,n.lifespan&&n.lifespan>0&&(i.timeout=setTimeout(i.remove,n.lifespan))}).catch(s=>i.error=s)};if(zd.push(i),!t)throw i.promise}const bK=(r,e,t)=>JP(r,e,!1,t),TK=(r,e,t)=>void JP(r,e,!0,t),MK=r=>{if(r===void 0||r.length===0)zd.splice(0,zd.length);else{const e=zd.find(t=>QP(r,t.keys,t.equal));e&&e.remove()}};function IN(r,e,t){if(!r)return;if(t(r)===!0)return r;let n=e?r.return:r.child;for(;n;){const i=IN(n,e,t);if(i)return i;n=e?null:n.sibling}}function $P(r){try{return Object.defineProperties(r,{_currentRenderer:{get(){return null},set(){}},_currentRenderer2:{get(){return null},set(){}}})}catch{return r}}const FN=$P(Tt.createContext(null));class eI extends Tt.Component{render(){return Tt.createElement(FN.Provider,{value:this._reactInternals},this.props.children)}}function tI(){const r=Tt.useContext(FN);if(r===null)throw new Error("its-fine: useFiber must be called within a <FiberProvider />!");const e=Tt.useId();return Tt.useMemo(()=>{for(const t of[r,r==null?void 0:r.alternate]){if(!t)continue;const n=IN(t,!1,i=>{let s=i.memoizedState;for(;s;){if(s.memoizedState===e)return!0;s=s.next}});if(n)return n}},[r,e])}const EK=Symbol.for("react.context"),AK=r=>r!==null&&typeof r=="object"&&"$$typeof"in r&&r.$$typeof===EK;function RK(){const r=tI(),[e]=Tt.useState(()=>new Map);e.clear();let t=r;for(;t;){const n=t.type;AK(n)&&n!==FN&&!e.has(n)&&e.set(n,Tt.use($P(n))),t=t.return}return e}function NK(){const r=RK();return Tt.useMemo(()=>Array.from(r.keys()).reduce((e,t)=>n=>Tt.createElement(e,null,Tt.createElement(t.Provider,{...n,value:r.get(t)})),e=>Tt.createElement(eI,{...e})),[r])}function nI(r){let e=r.root;for(;e.getState().previousRoot;)e=e.getState().previousRoot;return e}const iI=r=>r&&r.isOrthographicCamera,CK=r=>r&&r.hasOwnProperty("current"),wK=r=>r!=null&&(typeof r=="string"||typeof r=="number"||r.isColor),p0=((r,e)=>typeof window<"u"&&(((r=window.document)==null?void 0:r.createElement)||((e=window.navigator)==null?void 0:e.product)==="ReactNative"))()?Tt.useLayoutEffect:Tt.useEffect;function sI(r){const e=Tt.useRef(r);return p0(()=>void(e.current=r),[r]),e}function DK(){const r=tI(),e=NK();return Tt.useMemo(()=>({children:t})=>{const i=!!IN(r,!0,s=>s.type===Tt.StrictMode)?Tt.StrictMode:Tt.Fragment;return xi.jsx(i,{children:xi.jsx(e,{children:t})})},[r,e])}function UK({set:r}){return p0(()=>(r(new Promise(()=>null)),()=>r(!1)),[r]),null}const LK=(r=>(r=class extends Tt.Component{constructor(...t){super(...t),this.state={error:!1}}componentDidCatch(t){this.props.set(t)}render(){return this.state.error?null:this.props.children}},r.getDerivedStateFromError=()=>({error:!0}),r))();function rI(r){var e;const t=typeof window<"u"?(e=window.devicePixelRatio)!=null?e:2:1;return Array.isArray(r)?Math.min(Math.max(r[0],t),r[1]):r}function sg(r){var e;return(e=r.__r3f)==null?void 0:e.root.getState()}const Wi={obj:r=>r===Object(r)&&!Wi.arr(r)&&typeof r!="function",fun:r=>typeof r=="function",str:r=>typeof r=="string",num:r=>typeof r=="number",boo:r=>typeof r=="boolean",und:r=>r===void 0,nul:r=>r===null,arr:r=>Array.isArray(r),equ(r,e,{arrays:t="shallow",objects:n="reference",strict:i=!0}={}){if(typeof r!=typeof e||!!r!=!!e)return!1;if(Wi.str(r)||Wi.num(r)||Wi.boo(r))return r===e;const s=Wi.obj(r);if(s&&n==="reference")return r===e;const a=Wi.arr(r);if(a&&t==="reference")return r===e;if((a||s)&&r===e)return!0;let l;for(l in r)if(!(l in e))return!1;if(s&&t==="shallow"&&n==="shallow"){for(l in i?e:r)if(!Wi.equ(r[l],e[l],{strict:i,objects:"reference"}))return!1}else for(l in i?e:r)if(r[l]!==e[l])return!1;if(Wi.und(l)){if(a&&r.length===0&&e.length===0||s&&Object.keys(r).length===0&&Object.keys(e).length===0)return!0;if(r!==e)return!1}return!0}};function BK(r){const e={nodes:{},materials:{},meshes:{}};return r&&r.traverse(t=>{t.name&&(e.nodes[t.name]=t),t.material&&!e.materials[t.material.name]&&(e.materials[t.material.name]=t.material),t.isMesh&&!e.meshes[t.name]&&(e.meshes[t.name]=t)}),e}function OK(r){r.type!=="Scene"&&(r.dispose==null||r.dispose());for(const e in r){const t=r[e];(t==null?void 0:t.type)!=="Scene"&&(t==null||t.dispose==null||t.dispose())}}const aI=["children","key","ref"];function PK(r){const e={};for(const t in r)aI.includes(t)||(e[t]=r[t]);return e}function Bb(r,e,t,n){const i=r;let s=i==null?void 0:i.__r3f;return s||(s={root:e,type:t,parent:null,children:[],props:PK(n),object:i,eventCount:0,handlers:{},isHidden:!1},i&&(i.__r3f=s)),s}function I_(r,e){let t=r[e];if(!e.includes("-"))return{root:r,key:e,target:t};t=r;for(const i of e.split("-")){var n;e=i,r=t,t=(n=t)==null?void 0:n[e]}return{root:r,key:e,target:t}}const ID=/-\d+$/;function Ob(r,e){if(Wi.str(e.props.attach)){if(ID.test(e.props.attach)){const i=e.props.attach.replace(ID,""),{root:s,key:a}=I_(r.object,i);Array.isArray(s[a])||(s[a]=[])}const{root:t,key:n}=I_(r.object,e.props.attach);e.previousAttach=t[n],t[n]=e.object}else Wi.fun(e.props.attach)&&(e.previousAttach=e.props.attach(r.object,e.object))}function Pb(r,e){if(Wi.str(e.props.attach)){const{root:t,key:n}=I_(r.object,e.props.attach),i=e.previousAttach;i===void 0?delete t[n]:t[n]=i}else e.previousAttach==null||e.previousAttach(r.object,e.object);delete e.previousAttach}const d1=[...aI,"args","dispose","attach","object","onUpdate","dispose"],FD=new Map;function IK(r){let e=FD.get(r.constructor);try{e||(e=new r.constructor,FD.set(r.constructor,e))}catch{}return e}function FK(r,e){const t={};for(const n in e)if(!d1.includes(n)&&!Wi.equ(e[n],r.props[n])){t[n]=e[n];for(const i in e)i.startsWith(`${n}-`)&&(t[i]=e[i])}for(const n in r.props){if(d1.includes(n)||e.hasOwnProperty(n))continue;const{root:i,key:s}=I_(r.object,n);if(i.constructor&&i.constructor.length===0){const a=IK(i);Wi.und(a)||(t[s]=a[s])}else t[s]=0}return t}const zK=["map","emissiveMap","sheenColorMap","specularColorMap","envMap"],VK=/^on(Pointer|Click|DoubleClick|ContextMenu|Wheel)/;function Qh(r,e){var t;const n=r.__r3f,i=n&&nI(n).getState(),s=n==null?void 0:n.eventCount;for(const l in e){let c=e[l];if(d1.includes(l))continue;if(n&&VK.test(l)){typeof c=="function"?n.handlers[l]=c:delete n.handlers[l],n.eventCount=Object.keys(n.handlers).length;continue}if(c===void 0)continue;let{root:d,key:m,target:y}=I_(r,l);if(y instanceof zg&&c instanceof zg)y.mask=c.mask;else if(y instanceof ft&&wK(c))y.set(c);else if(y!==null&&typeof y=="object"&&typeof y.set=="function"&&typeof y.copy=="function"&&c!=null&&c.constructor&&y.constructor===c.constructor)y.copy(c);else if(y!==null&&typeof y=="object"&&typeof y.set=="function"&&Array.isArray(c))typeof y.fromArray=="function"?y.fromArray(c):y.set(...c);else if(y!==null&&typeof y=="object"&&typeof y.set=="function"&&typeof c=="number")typeof y.setScalar=="function"?y.setScalar(c):y.set(c);else{var a;d[m]=c,i&&!i.linear&&zK.includes(m)&&(a=d[m])!=null&&a.isTexture&&d[m].format===Ni&&d[m].type===Xi&&(d[m].colorSpace=wt)}}if(n!=null&&n.parent&&i!=null&&i.internal&&(t=n.object)!=null&&t.isObject3D&&s!==n.eventCount){const l=n.object,c=i.internal.interaction.indexOf(l);c>-1&&i.internal.interaction.splice(c,1),n.eventCount&&l.raycast!==null&&i.internal.interaction.push(l)}return n&&n.props.attach===void 0&&(n.object.isBufferGeometry?n.props.attach="geometry":n.object.isMaterial&&(n.props.attach="material")),n&&ly(n),r}function ly(r){var e;if(!r.parent)return;r.props.onUpdate==null||r.props.onUpdate(r.object);const t=(e=r.root)==null||e.getState==null?void 0:e.getState();t&&t.internal.frames===0&&t.invalidate()}function GK(r,e){r.manual||(iI(r)?(r.left=e.width/-2,r.right=e.width/2,r.top=e.height/2,r.bottom=e.height/-2):r.aspect=e.width/e.height,r.updateProjectionMatrix())}const ca=r=>r==null?void 0:r.isObject3D;function JS(r){return(r.eventObject||r.object).uuid+"/"+r.index+r.instanceId}function oI(r,e,t,n){const i=t.get(e);i&&(t.delete(e),t.size===0&&(r.delete(n),i.target.releasePointerCapture(n)))}function HK(r,e){const{internal:t}=r.getState();t.interaction=t.interaction.filter(n=>n!==e),t.initialHits=t.initialHits.filter(n=>n!==e),t.hovered.forEach((n,i)=>{(n.eventObject===e||n.object===e)&&t.hovered.delete(i)}),t.capturedMap.forEach((n,i)=>{oI(t.capturedMap,e,n,i)})}function kK(r){function e(c){const{internal:d}=r.getState(),m=c.offsetX-d.initialClick[0],y=c.offsetY-d.initialClick[1];return Math.round(Math.sqrt(m*m+y*y))}function t(c){return c.filter(d=>["Move","Over","Enter","Out","Leave"].some(m=>{var y;return(y=d.__r3f)==null?void 0:y.handlers["onPointer"+m]}))}function n(c,d){const m=r.getState(),y=new Set,v=[],x=d?d(m.internal.interaction):m.internal.interaction;for(let M=0;M<x.length;M++){const C=sg(x[M]);C&&(C.raycaster.camera=void 0)}m.previousRoot||m.events.compute==null||m.events.compute(c,m);function S(M){const C=sg(M);if(!C||!C.events.enabled||C.raycaster.camera===null)return[];if(C.raycaster.camera===void 0){var w;C.events.compute==null||C.events.compute(c,C,(w=C.previousRoot)==null?void 0:w.getState()),C.raycaster.camera===void 0&&(C.raycaster.camera=null)}return C.raycaster.camera?C.raycaster.intersectObject(M,!0):[]}let A=x.flatMap(S).sort((M,C)=>{const w=sg(M.object),D=sg(C.object);return!w||!D?M.distance-C.distance:D.events.priority-w.events.priority||M.distance-C.distance}).filter(M=>{const C=JS(M);return y.has(C)?!1:(y.add(C),!0)});m.events.filter&&(A=m.events.filter(A,m));for(const M of A){let C=M.object;for(;C;){var E;(E=C.__r3f)!=null&&E.eventCount&&v.push({...M,eventObject:C}),C=C.parent}}if("pointerId"in c&&m.internal.capturedMap.has(c.pointerId))for(let M of m.internal.capturedMap.get(c.pointerId).values())y.has(JS(M.intersection))||v.push(M.intersection);return v}function i(c,d,m,y){if(c.length){const v={stopped:!1};for(const x of c){let S=sg(x.object);if(S||x.object.traverseAncestors(A=>{const E=sg(A);if(E)return S=E,!1}),S){const{raycaster:A,pointer:E,camera:M,internal:C}=S,w=new Y(E.x,E.y,0).unproject(M),D=I=>{var P,Z;return(P=(Z=C.capturedMap.get(I))==null?void 0:Z.has(x.eventObject))!=null?P:!1},z=I=>{const P={intersection:x,target:d.target};C.capturedMap.has(I)?C.capturedMap.get(I).set(x.eventObject,P):C.capturedMap.set(I,new Map([[x.eventObject,P]])),d.target.setPointerCapture(I)},B=I=>{const P=C.capturedMap.get(I);P&&oI(C.capturedMap,x.eventObject,P,I)};let F={};for(let I in d){let P=d[I];typeof P!="function"&&(F[I]=P)}let H={...x,...F,pointer:E,intersections:c,stopped:v.stopped,delta:m,unprojectedPoint:w,ray:A.ray,camera:M,stopPropagation(){const I="pointerId"in d&&C.capturedMap.get(d.pointerId);if((!I||I.has(x.eventObject))&&(H.stopped=v.stopped=!0,C.hovered.size&&Array.from(C.hovered.values()).find(P=>P.eventObject===x.eventObject))){const P=c.slice(0,c.indexOf(x));s([...P,x])}},target:{hasPointerCapture:D,setPointerCapture:z,releasePointerCapture:B},currentTarget:{hasPointerCapture:D,setPointerCapture:z,releasePointerCapture:B},nativeEvent:d};if(y(H),v.stopped===!0)break}}}return c}function s(c){const{internal:d}=r.getState();for(const m of d.hovered.values())if(!c.length||!c.find(y=>y.object===m.object&&y.index===m.index&&y.instanceId===m.instanceId)){const v=m.eventObject.__r3f;if(d.hovered.delete(JS(m)),v!=null&&v.eventCount){const x=v.handlers,S={...m,intersections:c};x.onPointerOut==null||x.onPointerOut(S),x.onPointerLeave==null||x.onPointerLeave(S)}}}function a(c,d){for(let m=0;m<d.length;m++){const y=d[m].__r3f;y==null||y.handlers.onPointerMissed==null||y.handlers.onPointerMissed(c)}}function l(c){switch(c){case"onPointerLeave":case"onPointerCancel":return()=>s([]);case"onLostPointerCapture":return d=>{const{internal:m}=r.getState();"pointerId"in d&&m.capturedMap.has(d.pointerId)&&requestAnimationFrame(()=>{m.capturedMap.has(d.pointerId)&&(m.capturedMap.delete(d.pointerId),s([]))})}}return function(m){const{onPointerMissed:y,internal:v}=r.getState();v.lastEvent.current=m;const x=c==="onPointerMove",S=c==="onClick"||c==="onContextMenu"||c==="onDoubleClick",E=n(m,x?t:void 0),M=S?e(m):0;c==="onPointerDown"&&(v.initialClick=[m.offsetX,m.offsetY],v.initialHits=E.map(w=>w.eventObject)),S&&!E.length&&M<=2&&(a(m,v.interaction),y&&y(m)),x&&s(E);function C(w){const D=w.eventObject,z=D.__r3f;if(!(z!=null&&z.eventCount))return;const B=z.handlers;if(x){if(B.onPointerOver||B.onPointerEnter||B.onPointerOut||B.onPointerLeave){const F=JS(w),H=v.hovered.get(F);H?H.stopped&&w.stopPropagation():(v.hovered.set(F,w),B.onPointerOver==null||B.onPointerOver(w),B.onPointerEnter==null||B.onPointerEnter(w))}B.onPointerMove==null||B.onPointerMove(w)}else{const F=B[c];F?(!S||v.initialHits.includes(D))&&(a(m,v.interaction.filter(H=>!v.initialHits.includes(H))),F(w)):S&&v.initialHits.includes(D)&&a(m,v.interaction.filter(H=>!v.initialHits.includes(H)))}}i(E,m,M,C)}}return{handlePointer:l}}const zD=r=>!!(r!=null&&r.render),lI=Tt.createContext(null),qK=(r,e)=>{const t=fK((l,c)=>{const d=new Y,m=new Y,y=new Y;function v(M=c().camera,C=m,w=c().size){const{width:D,height:z,top:B,left:F}=w,H=D/z;C.isVector3?y.copy(C):y.set(...C);const I=M.getWorldPosition(d).distanceTo(y);if(iI(M))return{width:D/M.zoom,height:z/M.zoom,top:B,left:F,factor:1,distance:I,aspect:H};{const P=M.fov*Math.PI/180,Z=2*Math.tan(P/2)*I,ue=Z*(D/z);return{width:ue,height:Z,top:B,left:F,factor:D/ue,distance:I,aspect:H}}}let x;const S=M=>l(C=>({performance:{...C.performance,current:M}})),A=new Xe;return{set:l,get:c,gl:null,camera:null,raycaster:null,events:{priority:1,enabled:!0,connected:!1},scene:null,xr:null,invalidate:(M=1)=>r(c(),M),advance:(M,C)=>e(M,C,c()),legacy:!1,linear:!1,flat:!1,controls:null,clock:new _R,pointer:A,mouse:A,frameloop:"always",onPointerMissed:void 0,performance:{current:1,min:.5,max:1,debounce:200,regress:()=>{const M=c();x&&clearTimeout(x),M.performance.current!==M.performance.min&&S(M.performance.min),x=setTimeout(()=>S(c().performance.max),M.performance.debounce)}},size:{width:0,height:0,top:0,left:0},viewport:{initialDpr:0,dpr:0,width:0,height:0,top:0,left:0,aspect:0,distance:0,factor:0,getCurrentViewport:v},setEvents:M=>l(C=>({...C,events:{...C.events,...M}})),setSize:(M,C,w=0,D=0)=>{const z=c().camera,B={width:M,height:C,top:w,left:D};l(F=>({size:B,viewport:{...F.viewport,...v(z,m,B)}}))},setDpr:M=>l(C=>{const w=rI(M);return{viewport:{...C.viewport,dpr:w,initialDpr:C.viewport.initialDpr||w}}}),setFrameloop:(M="always")=>{const C=c().clock;C.stop(),C.elapsedTime=0,M!=="never"&&(C.start(),C.elapsedTime=0),l(()=>({frameloop:M}))},previousRoot:void 0,internal:{interaction:[],hovered:new Map,subscribers:[],initialClick:[0,0],initialHits:[],capturedMap:new Map,lastEvent:Tt.createRef(),active:!1,frames:0,priority:0,subscribe:(M,C,w)=>{const D=c().internal;return D.priority=D.priority+(C>0?1:0),D.subscribers.push({ref:M,priority:C,store:w}),D.subscribers=D.subscribers.sort((z,B)=>z.priority-B.priority),()=>{const z=c().internal;z!=null&&z.subscribers&&(z.priority=z.priority-(C>0?1:0),z.subscribers=z.subscribers.filter(B=>B.ref!==M))}}}}}),n=t.getState();let i=n.size,s=n.viewport.dpr,a=n.camera;return t.subscribe(()=>{const{camera:l,size:c,viewport:d,gl:m,set:y}=t.getState();if(c.width!==i.width||c.height!==i.height||d.dpr!==s){i=c,s=d.dpr,GK(l,c),d.dpr>0&&m.setPixelRatio(d.dpr);const v=typeof HTMLCanvasElement<"u"&&m.domElement instanceof HTMLCanvasElement;m.setSize(c.width,c.height,v)}l!==a&&(a=l,y(v=>({viewport:{...v.viewport,...v.viewport.getCurrentViewport(l)}})))}),t.subscribe(l=>r(l)),t};function uI(){const r=Tt.useContext(lI);if(!r)throw new Error("R3F: Hooks can only be used within the Canvas component!");return r}function xg(r=t=>t,e){return uI()(r,e)}function cI(r,e=0){const t=uI(),n=t.getState().internal.subscribe,i=sI(r);return p0(()=>n(i,e,t),[e,n,t]),null}const VD=new WeakMap,WK=r=>{var e;return typeof r=="function"&&(r==null||(e=r.prototype)==null?void 0:e.constructor)===r};function hI(r,e){return function(t,...n){let i;return WK(t)?(i=VD.get(t),i||(i=new t,VD.set(t,i))):i=t,r&&r(i),Promise.all(n.map(s=>new Promise((a,l)=>i.load(s,c=>{ca(c==null?void 0:c.scene)&&Object.assign(c,BK(c.scene)),a(c)},e,c=>l(new Error(`Could not load ${s}: ${c==null?void 0:c.message}`))))))}}function m0(r,e,t,n){const i=Array.isArray(e)?e:[e],s=bK(hI(t,n),[r,...i],{equal:Wi.equ});return Array.isArray(e)?s:s[0]}m0.preload=function(r,e,t){const n=Array.isArray(e)?e:[e];return TK(hI(t),[r,...n])};m0.clear=function(r,e){const t=Array.isArray(e)?e:[e];return MK([r,...t])};function XK(r){const e=vK(r);return e.injectIntoDevTools({bundleType:0,rendererPackageName:"@react-three/fiber",version:Tt.version}),e}const fI=0,Yg={},YK=/^three(?=[A-Z])/,sM=r=>`${r[0].toUpperCase()}${r.slice(1)}`;let jK=0;const ZK=r=>typeof r=="function";function KK(r){if(ZK(r)){const e=`${jK++}`;return Yg[e]=r,e}else Object.assign(Yg,r)}function dI(r,e){const t=sM(r),n=Yg[t];if(r!=="primitive"&&!n)throw new Error(`R3F: ${t} is not part of the THREE namespace! Did you forget to extend? See: https://docs.pmnd.rs/react-three-fiber/api/objects#using-3rd-party-objects-declaratively`);if(r==="primitive"&&!e.object)throw new Error("R3F: Primitives without 'object' are invalid!");if(e.args!==void 0&&!Array.isArray(e.args))throw new Error("R3F: The args prop must be an array!")}function QK(r,e,t){var n;return r=sM(r)in Yg?r:r.replace(YK,""),dI(r,e),r==="primitive"&&(n=e.object)!=null&&n.__r3f&&delete e.object.__r3f,Bb(e.object,t,r,e)}function JK(r){if(!r.isHidden){var e;r.props.attach&&(e=r.parent)!=null&&e.object?Pb(r.parent,r):ca(r.object)&&(r.object.visible=!1),r.isHidden=!0,ly(r)}}function pI(r){if(r.isHidden){var e;r.props.attach&&(e=r.parent)!=null&&e.object?Ob(r.parent,r):ca(r.object)&&r.props.visible!==!1&&(r.object.visible=!0),r.isHidden=!1,ly(r)}}function zN(r,e,t){const n=e.root.getState();if(!(!r.parent&&r.object!==n.scene)){if(!e.object){var i,s;const a=Yg[sM(e.type)];e.object=(i=e.props.object)!=null?i:new a(...(s=e.props.args)!=null?s:[]),e.object.__r3f=e}if(Qh(e.object,e.props),e.props.attach)Ob(r,e);else if(ca(e.object)&&ca(r.object)){const a=r.object.children.indexOf(t==null?void 0:t.object);if(t&&a!==-1){const l=r.object.children.indexOf(e.object);if(l!==-1){r.object.children.splice(l,1);const c=l<a?a-1:a;r.object.children.splice(c,0,e.object)}else e.object.parent=r.object,r.object.children.splice(a,0,e.object),e.object.dispatchEvent({type:"added"}),r.object.dispatchEvent({type:"childadded",child:e.object})}else r.object.add(e.object)}for(const a of e.children)zN(e,a);ly(e)}}function RA(r,e){e&&(e.parent=r,r.children.push(e),zN(r,e))}function GD(r,e,t){if(!e||!t)return;e.parent=r;const n=r.children.indexOf(t);n!==-1?r.children.splice(n,0,e):r.children.push(e),zN(r,e,t)}function mI(r){if(typeof r.dispose=="function"){const e=()=>{try{r.dispose()}catch{}};typeof IS_REACT_ACT_ENVIRONMENT<"u"?e():PD.unstable_scheduleCallback(PD.unstable_IdlePriority,e)}}function p1(r,e,t){if(!e)return;e.parent=null;const n=r.children.indexOf(e);n!==-1&&r.children.splice(n,1),e.props.attach?Pb(r,e):ca(e.object)&&ca(r.object)&&(r.object.remove(e.object),HK(nI(e),e.object));const i=e.props.dispose!==null&&t!==!1;for(let s=e.children.length-1;s>=0;s--){const a=e.children[s];p1(e,a,i)}e.children.length=0,delete e.object.__r3f,i&&e.type!=="primitive"&&e.object.type!=="Scene"&&mI(e.object),t===void 0&&ly(e)}function $K(r,e){for(const t of[r,r.alternate])if(t!==null)if(typeof t.ref=="function"){t.refCleanup==null||t.refCleanup();const n=t.ref(e);typeof n=="function"&&(t.refCleanup=n)}else t.ref&&(t.ref.current=e)}const hb=[];function eQ(){for(const[t]of hb){const n=t.parent;if(n){t.props.attach?Pb(n,t):ca(t.object)&&ca(n.object)&&n.object.remove(t.object);for(const i of t.children)i.props.attach?Pb(t,i):ca(i.object)&&ca(t.object)&&t.object.remove(i.object)}t.isHidden&&pI(t),t.object.__r3f&&delete t.object.__r3f,t.type!=="primitive"&&mI(t.object)}for(const[t,n,i]of hb){t.props=n;const s=t.parent;if(s){var r,e;const a=Yg[sM(t.type)];t.object=(r=t.props.object)!=null?r:new a(...(e=t.props.args)!=null?e:[]),t.object.__r3f=t,$K(i,t.object),Qh(t.object,t.props),t.props.attach?Ob(s,t):ca(t.object)&&ca(s.object)&&s.object.add(t.object);for(const l of t.children)l.props.attach?Ob(t,l):ca(l.object)&&ca(t.object)&&t.object.add(l.object);ly(t)}}hb.length=0}const NA=()=>{},HD={};let $S=fI;const tQ=0,nQ=4,m1=XK({isPrimaryRenderer:!1,warnsIfNotActing:!1,supportsMutation:!0,supportsPersistence:!1,supportsHydration:!1,createInstance:QK,removeChild:p1,appendChild:RA,appendInitialChild:RA,insertBefore:GD,appendChildToContainer(r,e){const t=r.getState().scene.__r3f;!e||!t||RA(t,e)},removeChildFromContainer(r,e){const t=r.getState().scene.__r3f;!e||!t||p1(t,e)},insertInContainerBefore(r,e,t){const n=r.getState().scene.__r3f;!e||!t||!n||GD(n,e,t)},getRootHostContext:()=>HD,getChildHostContext:()=>HD,commitUpdate(r,e,t,n,i){var s,a,l;dI(e,n);let c=!1;if((r.type==="primitive"&&t.object!==n.object||((s=n.args)==null?void 0:s.length)!==((a=t.args)==null?void 0:a.length)||(l=n.args)!=null&&l.some((m,y)=>{var v;return m!==((v=t.args)==null?void 0:v[y])}))&&(c=!0),c)hb.push([r,{...n},i]);else{const m=FK(r,n);Object.keys(m).length&&(Object.assign(r.props,m),Qh(r.object,m))}(i.sibling===null||(i.flags&nQ)===tQ)&&eQ()},finalizeInitialChildren:()=>!1,commitMount(){},getPublicInstance:r=>r==null?void 0:r.object,prepareForCommit:()=>null,preparePortalMount:r=>Bb(r.getState().scene,r,"",{}),resetAfterCommit:()=>{},shouldSetTextContent:()=>!1,clearContainer:()=>!1,hideInstance:JK,unhideInstance:pI,createTextInstance:NA,hideTextInstance:NA,unhideTextInstance:NA,scheduleTimeout:typeof setTimeout=="function"?setTimeout:void 0,cancelTimeout:typeof clearTimeout=="function"?clearTimeout:void 0,noTimeout:-1,getInstanceFromNode:()=>null,beforeActiveInstanceBlur(){},afterActiveInstanceBlur(){},detachDeletedInstance(){},prepareScopeUpdate(){},getInstanceFromScope:()=>null,shouldAttemptEagerTransition:()=>!1,trackSchedulerEvent:()=>{},resolveEventType:()=>null,resolveEventTimeStamp:()=>-1.1,requestPostPaintCallback(){},maySuspendCommit:()=>!1,preloadInstance:()=>!0,startSuspendingCommit(){},suspendInstance(){},waitForCommitToBeReady:()=>null,NotPendingTransition:null,HostTransitionContext:Tt.createContext(null),setCurrentUpdatePriority(r){$S=r},getCurrentUpdatePriority(){return $S},resolveUpdatePriority(){var r;if($S!==fI)return $S;switch(typeof window<"u"&&((r=window.event)==null?void 0:r.type)){case"click":case"contextmenu":case"dblclick":case"pointercancel":case"pointerdown":case"pointerup":return cb.DiscreteEventPriority;case"pointermove":case"pointerout":case"pointerover":case"pointerenter":case"pointerleave":case"wheel":return cb.ContinuousEventPriority;default:return cb.DefaultEventPriority}},resetFormInstance(){}}),mp=new Map,rg={objects:"shallow",strict:!1};function iQ(r,e){if(!e&&typeof HTMLCanvasElement<"u"&&r instanceof HTMLCanvasElement&&r.parentElement){const{width:t,height:n,top:i,left:s}=r.parentElement.getBoundingClientRect();return{width:t,height:n,top:i,left:s}}else if(!e&&typeof OffscreenCanvas<"u"&&r instanceof OffscreenCanvas)return{width:r.width,height:r.height,top:0,left:0};return{width:0,height:0,top:0,left:0,...e}}function sQ(r){const e=mp.get(r),t=e==null?void 0:e.fiber,n=e==null?void 0:e.store;e&&console.warn("R3F.createRoot should only be called once!");const i=typeof reportError=="function"?reportError:console.error,s=n||qK(v1,qD),a=t||m1.createContainer(s,cb.ConcurrentRoot,null,!1,null,"",i,i,i,null);e||mp.set(r,{fiber:a,store:s});let l,c,d=!1,m=null;return{async configure(y={}){let v;m=new Promise(re=>v=re);let{gl:x,size:S,scene:A,events:E,onCreated:M,shadows:C=!1,linear:w=!1,flat:D=!1,legacy:z=!1,orthographic:B=!1,frameloop:F="always",dpr:H=[1,2],performance:I,raycaster:P,camera:Z,onPointerMissed:ue}=y,se=s.getState(),pe=se.gl;if(!se.gl){const re={canvas:r,powerPreference:"high-performance",antialias:!0,alpha:!0},we=typeof x=="function"?await x(re):x;zD(we)?pe=we:pe=new KP({...re,...x}),se.set({gl:pe})}let Se=se.raycaster;Se||se.set({raycaster:Se=new a3});const{params:V,...Q}=P||{};if(Wi.equ(Q,Se,rg)||Qh(Se,{...Q}),Wi.equ(V,Se.params,rg)||Qh(Se,{params:{...Se.params,...V}}),!se.camera||se.camera===c&&!Wi.equ(c,Z,rg)){c=Z;const re=Z==null?void 0:Z.isCamera,we=re?Z:B?new Mp(0,0,0,0,.1,1e3):new us(75,0,.1,1e3);re||(we.position.z=5,Z&&(Qh(we,Z),we.manual||("aspect"in Z||"left"in Z||"right"in Z||"bottom"in Z||"top"in Z)&&(we.manual=!0,we.updateProjectionMatrix())),!se.camera&&!(Z!=null&&Z.rotation)&&we.lookAt(0,0,0)),se.set({camera:we}),Se.camera=we}if(!se.scene){let re;A!=null&&A.isScene?(re=A,Bb(re,s,"",{})):(re=new ey,Bb(re,s,"",{}),A&&Qh(re,A)),se.set({scene:re})}E&&!se.events.handlers&&se.set({events:E(s)});const J=iQ(r,S);if(Wi.equ(J,se.size,rg)||se.setSize(J.width,J.height,J.top,J.left),H&&se.viewport.dpr!==rI(H)&&se.setDpr(H),se.frameloop!==F&&se.setFrameloop(F),se.onPointerMissed||se.set({onPointerMissed:ue}),I&&!Wi.equ(I,se.performance,rg)&&se.set(re=>({performance:{...re.performance,...I}})),!se.xr){var ve;const re=(oe,De)=>{const je=s.getState();je.frameloop!=="never"&&qD(oe,!0,je,De)},we=()=>{const oe=s.getState();oe.gl.xr.enabled=oe.gl.xr.isPresenting,oe.gl.xr.setAnimationLoop(oe.gl.xr.isPresenting?re:null),oe.gl.xr.isPresenting||v1(oe)},Fe={connect(){const oe=s.getState().gl;oe.xr.addEventListener("sessionstart",we),oe.xr.addEventListener("sessionend",we)},disconnect(){const oe=s.getState().gl;oe.xr.removeEventListener("sessionstart",we),oe.xr.removeEventListener("sessionend",we)}};typeof((ve=pe.xr)==null?void 0:ve.addEventListener)=="function"&&Fe.connect(),se.set({xr:Fe})}if(pe.shadowMap){const re=pe.shadowMap.enabled,we=pe.shadowMap.type;if(pe.shadowMap.enabled=!!C,Wi.boo(C))pe.shadowMap.type=t_;else if(Wi.str(C)){var X;const Fe={basic:T1,percentage:F_,soft:t_,variance:ua};pe.shadowMap.type=(X=Fe[C])!=null?X:t_}else Wi.obj(C)&&Object.assign(pe.shadowMap,C);(re!==pe.shadowMap.enabled||we!==pe.shadowMap.type)&&(pe.shadowMap.needsUpdate=!0)}return on.enabled=!z,d||(pe.outputColorSpace=w?xo:wt,pe.toneMapping=D?Gr:jb),se.legacy!==z&&se.set(()=>({legacy:z})),se.linear!==w&&se.set(()=>({linear:w})),se.flat!==D&&se.set(()=>({flat:D})),x&&!Wi.fun(x)&&!zD(x)&&!Wi.equ(x,pe,rg)&&Qh(pe,x),l=M,d=!0,v(),this},render(y){return!d&&!m&&this.configure(),m.then(()=>{m1.updateContainer(xi.jsx(rQ,{store:s,children:y,onCreated:l,rootElement:r}),a,null,()=>{})}),s},unmount(){gI(r)}}}function rQ({store:r,children:e,onCreated:t,rootElement:n}){return p0(()=>{const i=r.getState();i.set(s=>({internal:{...s.internal,active:!0}})),t&&t(i),r.getState().events.connected||i.events.connect==null||i.events.connect(n)},[]),xi.jsx(lI.Provider,{value:r,children:e})}function gI(r,e){const t=mp.get(r),n=t==null?void 0:t.fiber;if(n){const i=t==null?void 0:t.store.getState();i&&(i.internal.active=!1),m1.updateContainer(null,n,null,()=>{i&&setTimeout(()=>{try{var s,a,l,c;i.events.disconnect==null||i.events.disconnect(),(s=i.gl)==null||(a=s.renderLists)==null||a.dispose==null||a.dispose(),(l=i.gl)==null||l.forceContextLoss==null||l.forceContextLoss(),(c=i.gl)!=null&&c.xr&&i.xr.disconnect(),OK(i.scene),mp.delete(r)}catch{}},500)})}}const aQ=new Set,oQ=new Set,lQ=new Set;function CA(r,e){if(r.size)for(const{callback:t}of r.values())t(e)}function d_(r,e){switch(r){case"before":return CA(aQ,e);case"after":return CA(oQ,e);case"tail":return CA(lQ,e)}}let wA,DA;function g1(r,e,t){let n=e.clock.getDelta();e.frameloop==="never"&&typeof r=="number"&&(n=r-e.clock.elapsedTime,e.clock.oldTime=e.clock.elapsedTime,e.clock.elapsedTime=r),wA=e.internal.subscribers;for(let i=0;i<wA.length;i++)DA=wA[i],DA.ref.current(DA.store.getState(),n,t);return!e.internal.priority&&e.gl.render&&e.gl.render(e.scene,e.camera),e.internal.frames=Math.max(0,e.internal.frames-1),e.frameloop==="always"?1:e.internal.frames}let Ib=!1,y1=!1,UA,kD,ag;function yI(r){kD=requestAnimationFrame(yI),Ib=!0,UA=0,d_("before",r),y1=!0;for(const t of mp.values()){var e;ag=t.store.getState(),ag.internal.active&&(ag.frameloop==="always"||ag.internal.frames>0)&&!((e=ag.gl.xr)!=null&&e.isPresenting)&&(UA+=g1(r,ag))}if(y1=!1,d_("after",r),UA===0)return d_("tail",r),Ib=!1,cancelAnimationFrame(kD)}function v1(r,e=1){var t;if(!r)return mp.forEach(n=>v1(n.store.getState(),e));(t=r.gl.xr)!=null&&t.isPresenting||!r.internal.active||r.frameloop==="never"||(e>1?r.internal.frames=Math.min(60,r.internal.frames+e):y1?r.internal.frames=2:r.internal.frames=1,Ib||(Ib=!0,requestAnimationFrame(yI)))}function qD(r,e=!0,t,n){if(e&&d_("before",r),t)g1(r,t,n);else for(const i of mp.values())g1(r,i.store.getState());e&&d_("after",r)}const LA={onClick:["click",!1],onContextMenu:["contextmenu",!1],onDoubleClick:["dblclick",!1],onWheel:["wheel",!0],onPointerDown:["pointerdown",!0],onPointerUp:["pointerup",!0],onPointerLeave:["pointerleave",!0],onPointerMove:["pointermove",!0],onPointerCancel:["pointercancel",!0],onLostPointerCapture:["lostpointercapture",!0]};function uQ(r){const{handlePointer:e}=kK(r);return{priority:1,enabled:!0,compute(t,n,i){n.pointer.set(t.offsetX/n.size.width*2-1,-(t.offsetY/n.size.height)*2+1),n.raycaster.setFromCamera(n.pointer,n.camera)},connected:void 0,handlers:Object.keys(LA).reduce((t,n)=>({...t,[n]:e(n)}),{}),update:()=>{var t;const{events:n,internal:i}=r.getState();(t=i.lastEvent)!=null&&t.current&&n.handlers&&n.handlers.onPointerMove(i.lastEvent.current)},connect:t=>{const{set:n,events:i}=r.getState();if(i.disconnect==null||i.disconnect(),n(s=>({events:{...s.events,connected:t}})),i.handlers)for(const s in i.handlers){const a=i.handlers[s],[l,c]=LA[s];t.addEventListener(l,a,{passive:c})}},disconnect:()=>{const{set:t,events:n}=r.getState();if(n.connected){if(n.handlers)for(const i in n.handlers){const s=n.handlers[i],[a]=LA[i];n.connected.removeEventListener(a,s)}t(i=>({events:{...i.events,connected:void 0}}))}}}}function WD(r,e){let t;return(...n)=>{window.clearTimeout(t),t=window.setTimeout(()=>r(...n),e)}}function cQ({debounce:r,scroll:e,polyfill:t,offsetSize:n}={debounce:0,scroll:!1,offsetSize:!1}){const i=t||(typeof window>"u"?class{}:window.ResizeObserver);if(!i)throw new Error("This browser does not support ResizeObserver out of the box. See: https://github.com/react-spring/react-use-measure/#resize-observer-polyfills");const[s,a]=Tt.useState({left:0,top:0,width:0,height:0,bottom:0,right:0,x:0,y:0}),l=Tt.useRef({element:null,scrollContainers:null,resizeObserver:null,lastBounds:s,orientationHandler:null}),c=r?typeof r=="number"?r:r.scroll:null,d=r?typeof r=="number"?r:r.resize:null,m=Tt.useRef(!1);Tt.useEffect(()=>(m.current=!0,()=>void(m.current=!1)));const[y,v,x]=Tt.useMemo(()=>{const M=()=>{if(!l.current.element)return;const{left:C,top:w,width:D,height:z,bottom:B,right:F,x:H,y:I}=l.current.element.getBoundingClientRect(),P={left:C,top:w,width:D,height:z,bottom:B,right:F,x:H,y:I};l.current.element instanceof HTMLElement&&n&&(P.height=l.current.element.offsetHeight,P.width=l.current.element.offsetWidth),Object.freeze(P),m.current&&!pQ(l.current.lastBounds,P)&&a(l.current.lastBounds=P)};return[M,d?WD(M,d):M,c?WD(M,c):M]},[a,n,c,d]);function S(){l.current.scrollContainers&&(l.current.scrollContainers.forEach(M=>M.removeEventListener("scroll",x,!0)),l.current.scrollContainers=null),l.current.resizeObserver&&(l.current.resizeObserver.disconnect(),l.current.resizeObserver=null),l.current.orientationHandler&&("orientation"in screen&&"removeEventListener"in screen.orientation?screen.orientation.removeEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.removeEventListener("orientationchange",l.current.orientationHandler))}function A(){l.current.element&&(l.current.resizeObserver=new i(x),l.current.resizeObserver.observe(l.current.element),e&&l.current.scrollContainers&&l.current.scrollContainers.forEach(M=>M.addEventListener("scroll",x,{capture:!0,passive:!0})),l.current.orientationHandler=()=>{x()},"orientation"in screen&&"addEventListener"in screen.orientation?screen.orientation.addEventListener("change",l.current.orientationHandler):"onorientationchange"in window&&window.addEventListener("orientationchange",l.current.orientationHandler))}const E=M=>{!M||M===l.current.element||(S(),l.current.element=M,l.current.scrollContainers=vI(M),A())};return fQ(x,!!e),hQ(v),Tt.useEffect(()=>{S(),A()},[e,x,v]),Tt.useEffect(()=>S,[]),[E,s,y]}function hQ(r){Tt.useEffect(()=>{const e=r;return window.addEventListener("resize",e),()=>void window.removeEventListener("resize",e)},[r])}function fQ(r,e){Tt.useEffect(()=>{if(e){const t=r;return window.addEventListener("scroll",t,{capture:!0,passive:!0}),()=>void window.removeEventListener("scroll",t,!0)}},[r,e])}function vI(r){const e=[];if(!r||r===document.body)return e;const{overflow:t,overflowX:n,overflowY:i}=window.getComputedStyle(r);return[t,n,i].some(s=>s==="auto"||s==="scroll")&&e.push(r),[...e,...vI(r.parentElement)]}const dQ=["x","y","top","bottom","left","right","width","height"],pQ=(r,e)=>dQ.every(t=>r[t]===e[t]);function mQ({ref:r,children:e,fallback:t,resize:n,style:i,gl:s,events:a=uQ,eventSource:l,eventPrefix:c,shadows:d,linear:m,flat:y,legacy:v,orthographic:x,frameloop:S,dpr:A,performance:E,raycaster:M,camera:C,scene:w,onPointerMissed:D,onCreated:z,...B}){Tt.useMemo(()=>KK($Z),[]);const F=DK(),[H,I]=cQ({scroll:!0,debounce:{scroll:50,resize:0},...n}),P=Tt.useRef(null),Z=Tt.useRef(null);Tt.useImperativeHandle(r,()=>P.current);const ue=sI(D),[se,pe]=Tt.useState(!1),[Se,V]=Tt.useState(!1);if(se)throw se;if(Se)throw Se;const Q=Tt.useRef(null);p0(()=>{const ve=P.current;if(I.width>0&&I.height>0&&ve){Q.current||(Q.current=sQ(ve));async function X(){await Q.current.configure({gl:s,scene:w,events:a,shadows:d,linear:m,flat:y,legacy:v,orthographic:x,frameloop:S,dpr:A,performance:E,raycaster:M,camera:C,size:I,onPointerMissed:(...re)=>ue.current==null?void 0:ue.current(...re),onCreated:re=>{re.events.connect==null||re.events.connect(l?CK(l)?l.current:l:Z.current),c&&re.setEvents({compute:(we,Fe)=>{const oe=we[c+"X"],De=we[c+"Y"];Fe.pointer.set(oe/Fe.size.width*2-1,-(De/Fe.size.height)*2+1),Fe.raycaster.setFromCamera(Fe.pointer,Fe.camera)}}),z==null||z(re)}}),Q.current.render(xi.jsx(F,{children:xi.jsx(LK,{set:V,children:xi.jsx(Tt.Suspense,{fallback:xi.jsx(UK,{set:pe}),children:e??null})})}))}X()}}),Tt.useEffect(()=>{const ve=P.current;if(ve)return()=>gI(ve)},[]);const J=l?"none":"auto";return xi.jsx("div",{ref:Z,style:{position:"relative",width:"100%",height:"100%",overflow:"hidden",pointerEvents:J,...i},...B,children:xi.jsx("div",{ref:H,style:{width:"100%",height:"100%"},children:xi.jsx("canvas",{ref:P,style:{display:"block"},children:t})})})}function gQ(r){return xi.jsx(eI,{children:xi.jsx(mQ,{...r})})}function _1(){return _1=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},_1.apply(null,arguments)}const BA=r=>r===Object(r)&&!Array.isArray(r)&&typeof r!="function";function VN(r,e){const t=xg(s=>s.gl),n=m0(CT,BA(r)?Object.values(r):r);return Tt.useLayoutEffect(()=>{e==null||e(n)},[e]),Tt.useEffect(()=>{if("initTexture"in t){let s=[];Array.isArray(n)?s=n:n instanceof Li?s=[n]:BA(n)&&(s=Object.values(n)),s.forEach(a=>{a instanceof Li&&t.initTexture(a)})}},[t,n]),Tt.useMemo(()=>{if(BA(r)){const s={};let a=0;for(const l in r)s[l]=n[a++];return s}else return n},[r,n])}VN.preload=r=>m0.preload(CT,r);VN.clear=r=>m0.clear(CT,r);function yQ(r,e,t){const n=xg(v=>v.size),i=xg(v=>v.viewport),s=typeof r=="number"?r:n.width*i.dpr,a=n.height*i.dpr,l=(typeof r=="number"?t:r)||{},{samples:c=0,depth:d,...m}=l,y=Tt.useMemo(()=>{const v=new Gl(s,a,{minFilter:Zn,magFilter:Zn,type:Ys,...m});return d&&(v.depthTexture=new ya(s,a,Ri)),v.samples=c,v},[]);return Tt.useLayoutEffect(()=>{y.setSize(s,a),c&&(y.samples=c)},[c,y,s,a]),Tt.useEffect(()=>()=>y.dispose(),[]),y}const vQ=r=>typeof r=="function",_Q=Tt.forwardRef(({envMap:r,resolution:e=256,frames:t=1/0,makeDefault:n,children:i,...s},a)=>{const l=xg(({set:E})=>E),c=xg(({camera:E})=>E),d=xg(({size:E})=>E),m=Tt.useRef(null);Tt.useImperativeHandle(a,()=>m.current,[]);const y=Tt.useRef(null),v=yQ(e);Tt.useLayoutEffect(()=>{s.manual||(m.current.aspect=d.width/d.height)},[d,s]),Tt.useLayoutEffect(()=>{m.current.updateProjectionMatrix()});let x=0,S=null;const A=vQ(i);return cI(E=>{A&&(t===1/0||x<t)&&(y.current.visible=!1,E.gl.setRenderTarget(v),S=E.scene.background,r&&(E.scene.background=r),E.gl.render(E.scene,m.current),E.scene.background=S,E.gl.setRenderTarget(null),y.current.visible=!0,x++)}),Tt.useLayoutEffect(()=>{if(n){const E=c;return l(()=>({camera:m.current})),()=>l(()=>({camera:E}))}},[m,n,l]),Tt.createElement(Tt.Fragment,null,Tt.createElement("perspectiveCamera",_1({ref:m},s),!A&&i),Tt.createElement("group",{ref:y},A&&i(v.texture)))});function xQ(){return xi.jsxs(xi.Fragment,{children:[xi.jsx("ambientLight",{intensity:.7}),xi.jsx("directionalLight",{intensity:2,position:[25,10,10]})]})}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */L.BRDF_GGX;L.BRDF_Lambert;L.BasicShadowFilter;L.Break;L.Continue;L.DFGApprox;L.D_GGX;L.Discard;L.EPSILON;L.F_Schlick;L.Fn;L.INFINITY;L.If;L.Loop;L.NodeShaderStage;L.NodeType;L.NodeUpdateType;L.NodeAccess;L.PCFShadowFilter;L.PCFSoftShadowFilter;L.PI;L.PI2;L.Return;L.Schlick_to_F0;L.ScriptableNodeResources;L.ShaderNode;L.TBNViewMatrix;L.VSMShadowFilter;L.V_GGX_SmithCorrelated;L.abs;L.acesFilmicToneMapping;L.acos;L.add;L.addNodeElement;L.agxToneMapping;L.all;L.alphaT;L.and;L.anisotropy;L.anisotropyB;L.anisotropyT;L.any;L.append;L.array;L.arrayBuffer;L.asin;L.assign;L.atan;L.atan2;L.atomicAdd;L.atomicAnd;L.atomicFunc;L.atomicMax;L.atomicMin;L.atomicOr;L.atomicStore;L.atomicSub;L.atomicXor;L.atomicLoad;L.attenuationColor;L.attenuationDistance;L.attribute;L.attributeArray;L.backgroundBlurriness;L.backgroundIntensity;L.backgroundRotation;L.batch;L.billboarding;L.bitAnd;L.bitNot;L.bitOr;L.bitXor;L.bitangentGeometry;L.bitangentLocal;L.bitangentView;L.bitangentWorld;L.bitcast;L.blendBurn;L.blendColor;L.blendDodge;L.blendOverlay;L.blendScreen;L.blur;L.bool;L.buffer;L.bufferAttribute;L.bumpMap;L.burn;L.bvec2;L.bvec3;L.bvec4;L.bypass;L.cache;L.call;L.cameraFar;L.cameraIndex;L.cameraNear;L.cameraNormalMatrix;L.cameraPosition;L.cameraProjectionMatrix;L.cameraProjectionMatrixInverse;L.cameraViewMatrix;L.cameraWorldMatrix;L.cbrt;L.cdl;L.ceil;L.checker;L.cineonToneMapping;L.clamp;L.clearcoat;L.clearcoatRoughness;L.code;L.color;L.colorSpaceToWorking;L.colorToDirection;L.compute;L.computeSkinning;L.cond;L.Const;L.context;L.convert;L.convertColorSpace;L.convertToTexture;L.cos;L.cross;L.cubeTexture;L.dFdx;L.dFdy;L.dashSize;L.debug;L.defaultBuildStages;L.defaultShaderStages;L.defined;L.degrees;L.deltaTime;L.densityFog;L.densityFogFactor;L.depth;L.depthPass;L.difference;L.diffuseColor;L.directPointLight;L.directionToColor;L.dispersion;L.distance;L.div;L.dodge;L.dot;L.drawIndex;L.dynamicBufferAttribute;L.element;L.emissive;L.equal;L.equals;L.equirectUV;L.exp;L.exp2;L.expression;L.faceDirection;L.faceForward;L.faceforward;L.float;L.floor;L.fog;const XD=L.fract;L.frameGroup;L.frameId;L.frontFacing;L.fwidth;L.gain;L.gapSize;L.getConstNodeType;L.getCurrentStack;L.getDirection;L.getDistanceAttenuation;L.getGeometryRoughness;L.getNormalFromDepth;L.getParallaxCorrectNormal;L.getRoughness;L.getScreenPosition;L.getShIrradianceAt;L.getTextureIndex;L.getViewPosition;L.glsl;L.glslFn;L.grayscale;L.greaterThan;L.greaterThanEqual;L.hash;L.highpModelNormalViewMatrix;L.highpModelViewMatrix;L.hue;L.instance;L.instanceIndex;L.instancedArray;L.instancedBufferAttribute;L.instancedDynamicBufferAttribute;L.instancedMesh;L.int;L.inverseSqrt;L.inversesqrt;L.invocationLocalIndex;L.invocationSubgroupIndex;L.ior;L.iridescence;L.iridescenceIOR;L.iridescenceThickness;L.ivec2;L.ivec3;L.ivec4;L.js;L.label;L.length;L.lengthSq;L.lessThan;L.lessThanEqual;L.lightPosition;L.lightTargetDirection;L.lightTargetPosition;L.lightViewPosition;L.lightingContext;L.lights;L.linearDepth;L.linearToneMapping;L.localId;L.globalId;L.log;L.log2;L.logarithmicDepthToViewZ;L.loop;L.luminance;L.mediumpModelViewMatrix;L.mat2;L.mat3;L.mat4;L.matcapUV;L.materialAO;L.materialAlphaTest;L.materialAnisotropy;L.materialAnisotropyVector;L.materialAttenuationColor;L.materialAttenuationDistance;L.materialClearcoat;L.materialClearcoatNormal;L.materialClearcoatRoughness;L.materialColor;L.materialDispersion;L.materialEmissive;L.materialIOR;L.materialIridescence;L.materialIridescenceIOR;L.materialIridescenceThickness;L.materialLightMap;L.materialLineDashOffset;L.materialLineDashSize;L.materialLineGapSize;L.materialLineScale;L.materialLineWidth;L.materialMetalness;L.materialNormal;L.materialOpacity;L.materialPointSize;L.materialReference;L.materialReflectivity;L.materialRefractionRatio;L.materialRotation;L.materialRoughness;L.materialSheen;L.materialSheenRoughness;L.materialShininess;L.materialSpecular;L.materialSpecularColor;L.materialSpecularIntensity;L.materialSpecularStrength;L.materialThickness;L.materialTransmission;L.max;L.maxMipLevel;L.metalness;L.min;L.mix;L.mixElement;L.mod;L.modInt;L.modelDirection;L.modelNormalMatrix;L.modelPosition;L.modelRadius;L.modelScale;L.modelViewMatrix;L.modelViewPosition;L.modelViewProjection;L.modelWorldMatrix;L.modelWorldMatrixInverse;L.morphReference;L.mrt;L.mul;L.mx_aastep;L.mx_cell_noise_float;L.mx_contrast;L.mx_fractal_noise_float;L.mx_fractal_noise_vec2;L.mx_fractal_noise_vec3;L.mx_fractal_noise_vec4;L.mx_hsvtorgb;L.mx_noise_float;L.mx_noise_vec3;L.mx_noise_vec4;L.mx_ramplr;L.mx_ramptb;L.mx_rgbtohsv;L.mx_safepower;L.mx_splitlr;L.mx_splittb;L.mx_srgb_texture_to_lin_rec709;L.mx_transform_uv;L.mx_worley_noise_float;L.mx_worley_noise_vec2;L.mx_worley_noise_vec3;L.negate;L.neutralToneMapping;L.nodeArray;L.nodeImmutable;L.nodeObject;L.nodeObjects;L.nodeProxy;L.normalFlat;L.normalGeometry;L.normalLocal;L.normalMap;L.normalView;L.normalWorld;L.normalize;L.not;L.notEqual;L.numWorkgroups;L.objectDirection;L.objectGroup;L.objectPosition;L.objectRadius;L.objectScale;L.objectViewPosition;L.objectWorldMatrix;L.oneMinus;L.or;L.orthographicDepthToViewZ;L.oscSawtooth;L.oscSine;L.oscSquare;L.oscTriangle;L.output;L.outputStruct;L.overlay;L.overloadingFn;L.parabola;L.parallaxDirection;L.parallaxUV;L.parameter;L.pass;L.passTexture;L.pcurve;L.perspectiveDepthToViewZ;L.pmremTexture;L.pointUV;L.pointWidth;L.positionGeometry;L.positionLocal;L.positionPrevious;L.positionView;L.positionViewDirection;L.positionWorld;L.positionWorldDirection;L.posterize;L.pow;L.pow2;L.pow3;L.pow4;L.property;L.radians;L.rand;L.range;L.rangeFog;L.rangeFogFactor;L.reciprocal;L.lightProjectionUV;L.reference;L.referenceBuffer;L.reflect;L.reflectVector;L.reflectView;L.reflector;L.refract;L.refractVector;L.refractView;L.reinhardToneMapping;L.remainder;L.remap;L.remapClamp;L.renderGroup;L.renderOutput;L.rendererReference;L.rotate;L.rotateUV;L.roughness;L.round;L.rtt;L.sRGBTransferEOTF;L.sRGBTransferOETF;L.sampler;L.samplerComparison;L.saturate;L.saturation;L.screen;L.screenCoordinate;L.screenSize;L.screenUV;L.scriptable;L.scriptableValue;L.select;L.setCurrentStack;L.shaderStages;L.shadow;L.pointShadow;L.shadowPositionWorld;L.sharedUniformGroup;L.shapeCircle;L.sheen;L.sheenRoughness;L.shiftLeft;L.shiftRight;L.shininess;L.sign;L.sin;L.sinc;L.skinning;L.smoothstep;L.smoothstepElement;L.specularColor;L.specularF90;L.spherizeUV;L.split;L.spritesheetUV;L.sqrt;L.stack;L.step;L.storage;L.storageBarrier;L.storageObject;L.storageTexture;L.string;L.struct;L.sub;L.subgroupIndex;L.subgroupSize;L.tan;L.tangentGeometry;L.tangentLocal;L.tangentView;L.tangentWorld;L.temp;const SQ=L.texture;L.texture3D;L.textureBarrier;L.textureBicubic;L.textureCubeUV;L.textureLoad;L.textureSize;L.textureStore;L.thickness;L.threshold;L.time;L.timerDelta;L.timerGlobal;L.timerLocal;L.toOutputColorSpace;L.toWorkingColorSpace;L.toneMapping;L.toneMappingExposure;L.toonOutlinePass;L.transformDirection;L.transformNormal;L.transformNormalToView;L.transformedBentNormalView;L.transformedBitangentView;L.transformedBitangentWorld;L.transformedClearcoatNormalView;L.transformedNormalView;L.transformedNormalWorld;L.transformedTangentView;L.transformedTangentWorld;L.transmission;L.transpose;L.tri;L.tri3;L.triNoise3D;L.triplanarTexture;L.triplanarTextures;L.trunc;L.tslFn;L.uint;const bQ=L.uniform;L.uniformArray;L.uniformGroup;L.uniforms;L.userData;const YD=L.uv;L.uvec2;L.uvec3;L.uvec4;L.Var;L.varying;L.varyingProperty;L.vec2;L.vec3;const TQ=L.vec4;L.vectorComponents;L.velocity;L.vertexColor;L.vertexIndex;L.vibrance;L.viewZToLogarithmicDepth;L.viewZToOrthographicDepth;L.viewZToPerspectiveDepth;L.viewport;L.viewportBottomLeft;L.viewportCoordinate;L.viewportDepthTexture;L.viewportLinearDepth;L.viewportMipTexture;L.viewportResolution;L.viewportSafeUV;L.viewportSharedTexture;L.viewportSize;L.viewportTexture;L.viewportTopLeft;L.viewportUV;L.wgsl;L.wgslFn;L.workgroupArray;L.workgroupBarrier;L.workgroupId;L.workingToColorSpace;L.xor;class MQ extends fn{constructor(e=(i,s,a)=>a.set(i,s,Math.cos(i)*Math.sin(s)),t=8,n=8){super(),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:n};const i=[],s=[],a=[],l=[],c=1e-5,d=new Y,m=new Y,y=new Y,v=new Y,x=new Y,S=t+1;for(let A=0;A<=n;A++){const E=A/n;for(let M=0;M<=t;M++){const C=M/t;e(C,E,m),s.push(m.x,m.y,m.z),C-c>=0?(e(C-c,E,y),v.subVectors(m,y)):(e(C+c,E,y),v.subVectors(y,m)),E-c>=0?(e(C,E-c,y),x.subVectors(m,y)):(e(C,E+c,y),x.subVectors(y,m)),d.crossVectors(v,x).normalize(),a.push(d.x,d.y,d.z),l.push(C,E)}}for(let A=0;A<n;A++)for(let E=0;E<t;E++){const M=A*S+E,C=A*S+E+1,w=(A+1)*S+E+1,D=(A+1)*S+E;i.push(M,C,D),i.push(C,w,D)}this.setIndex(i),this.setAttribute("position",new Et(s,3)),this.setAttribute("normal",new Et(a,3)),this.setAttribute("uv",new Et(l,2))}copy(e){return super.copy(e),this.parameters=Object.assign({},e.parameters),this}}function EQ(r,e,t,n,i){const s=1-i;return r*s*s*s+3*e*s*s*i+3*t*s*i*i+n*i*i*i}function AQ(r){return EQ(100,1,1,1,r)}const RQ=function(r,e,t){const n=AQ(e),i=n*Math.sin(r*Math.PI*2),s=n*Math.cos(r*Math.PI*2),a=-1*(e-.5)*20;t.set(i,s,a)};function NQ(){const r=VN("vortex.png");r.colorSpace=wt,r.minFilter=Zn,r.magFilter=Zn,r.wrapS=zl,r.wrapT=zl,r.repeat.set(1,1);const e=Tt.useMemo(()=>new MQ(RQ,128,128),[]),t=bQ(10.5),n=()=>{let s=XD(YD().x.add(t)),a=XD(YD().y.add(t)),l=TQ(s,a,0,1);return SQ(r,l)},i=Tt.useMemo(()=>new CO({roughness:.5,metalness:.5}),[]);return cI(s=>{t.value=-1*s.clock.getElapsedTime()*.05,i.colorNode=n()}),xi.jsx("group",{position:[0,38,48],rotation:[1.5,0,0],children:xi.jsx("mesh",{geometry:e,material:i})})}function CQ(){const r=Tt.useRef(null);return Tt.useEffect(()=>{if(!(r!=null&&r.current))return;const e=1.05;r.current.position.set(0,46*e,52*e),r.current.lookAt(0,-14,18)},[]),xi.jsxs(xi.Fragment,{children:[xi.jsx(_Q,{ref:r,makeDefault:!0,fov:75}),xi.jsx(xQ,{}),xi.jsx(NQ,{})]})}function wQ(){return xi.jsx(gQ,{gl:async r=>{const e=new vW(r);return await e.init(),e},children:xi.jsx(CQ,{})})}pF.createRoot(document.getElementById("root")).render(xi.jsx(Tt.StrictMode,{children:xi.jsx(wQ,{})}));
